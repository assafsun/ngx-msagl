(self.webpackChunkmsagl=self.webpackChunkmsagl||[]).push([[179],{9602:(D,T,h)=>{"use strict";var p={};h.r(p),h.d(p,{forceCenter:()=>cY,forceCollide:()=>YO,forceLink:()=>KO,forceManyBody:()=>$O,forceRadial:()=>FY,forceSimulation:()=>JO,forceX:()=>BY,forceY:()=>kY});var I={};h.r(I),h.d(I,{dispatch:()=>Wm});var C={};function w(r){return"function"==typeof r}function E(r){const t=r(n=>{Error.call(n),n.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}h.r(C),h.d(C,{interval:()=>VY,now:()=>qa,timeout:()=>zm,timer:()=>ad,timerFlush:()=>eO});const R=E(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function d(r,e){if(r){const t=r.indexOf(e);0<=t&&r.splice(t,1)}}class f{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:n}=this;if(w(n))try{n()}catch(s){e=s instanceof R?s.errors:[s]}const{_teardowns:i}=this;if(i){this._teardowns=null;for(const s of i)try{y(s)}catch(o){e=null!=e?e:[],o instanceof R?e=[...e,...o.errors]:e.push(o)}}if(e)throw new R(e)}}add(e){var t;if(e&&e!==this)if(this.closed)y(e);else{if(e instanceof f){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&d(t,e)}remove(e){const{_teardowns:t}=this;t&&d(t,e),e instanceof f&&e._removeParent(this)}}f.EMPTY=(()=>{const r=new f;return r.closed=!0,r})();const v=f.EMPTY;function g(r){return r instanceof f||r&&"closed"in r&&w(r.remove)&&w(r.add)&&w(r.unsubscribe)}function y(r){w(r)?r():r.unsubscribe()}const m={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},O={setTimeout(...r){const{delegate:e}=O;return((null==e?void 0:e.setTimeout)||setTimeout)(...r)},clearTimeout(r){const{delegate:e}=O;return((null==e?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function P(r){O.setTimeout(()=>{const{onUnhandledError:e}=m;if(!e)throw r;e(r)})}function N(){}const M=_("C",void 0,void 0);function _(r,e,t){return{kind:r,value:e,error:t}}let K=null;function Q(r){if(m.useDeprecatedSynchronousErrorHandling){const e=!K;if(e&&(K={errorThrown:!1,error:null}),r(),e){const{errorThrown:t,error:n}=K;if(K=null,t)throw n}}else r()}class X extends f{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,g(e)&&e.add(this)):this.destination=V}static create(e,t,n){return new re(e,t,n)}next(e){this.isStopped?k(function Y(r){return _("N",r,void 0)}(e),this):this._next(e)}error(e){this.isStopped?k(function B(r){return _("E",void 0,r)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?k(M,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class re extends X{constructor(e,t,n){let i;if(super(),w(e))i=e;else if(e){let s;({next:i,error:t,complete:n}=e),this&&m.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe()):s=e,i=null==i?void 0:i.bind(s),t=null==t?void 0:t.bind(s),n=null==n?void 0:n.bind(s)}this.destination={next:i?U(i):N,error:U(null!=t?t:W),complete:n?U(n):N}}}function U(r,e){return(...t)=>{try{r(...t)}catch(n){m.useDeprecatedSynchronousErrorHandling?function ne(r){m.useDeprecatedSynchronousErrorHandling&&K&&(K.errorThrown=!0,K.error=r)}(n):P(n)}}}function W(r){throw r}function k(r,e){const{onStoppedNotification:t}=m;t&&O.setTimeout(()=>t(r,e))}const V={closed:!0,next:N,error:W,complete:N},H="function"==typeof Symbol&&Symbol.observable||"@@observable";function $(r){return r}let z=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){const n=new r;return n.source=this,n.operator=t,n}subscribe(t,n,i){const s=function ge(r){return r&&r instanceof X||function fe(r){return r&&w(r.next)&&w(r.error)&&w(r.complete)}(r)&&g(r)}(t)?t:new re(t,n,i);return Q(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return new(n=le(n))((i,s)=>{let o;o=this.subscribe(a=>{try{t(a)}catch(l){s(l),null==o||o.unsubscribe()}},s,i)})}_subscribe(t){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(t)}[H](){return this}pipe(...t){return function j(r){return 0===r.length?$:1===r.length?r[0]:function(t){return r.reduce((n,i)=>i(n),t)}}(t)(this)}toPromise(t){return new(t=le(t))((n,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>n(s))})}}return r.create=e=>new r(e),r})();function le(r){var e;return null!==(e=null!=r?r:m.Promise)&&void 0!==e?e:Promise}const Ee=E(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ye=(()=>{class r extends z{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const n=new Se(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new Ee}next(t){Q(()=>{if(this._throwIfClosed(),!this.isStopped){const n=this.observers.slice();for(const i of n)i.next(t)}})}error(t){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:n,isStopped:i,observers:s}=this;return n||i?v:(s.push(t),new f(()=>d(s,t)))}_checkFinalizedStatuses(t){const{hasError:n,thrownError:i,isStopped:s}=this;n?t.error(i):s&&t.complete()}asObservable(){const t=new z;return t.source=this,t}}return r.create=(e,t)=>new Se(e,t),r})();class Se extends ye{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:v}}function xe(r){return w(null==r?void 0:r.lift)}function ae(r){return e=>{if(xe(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class ue extends X{constructor(e,t,n,i,s){super(e),this.onFinalize=s,this._next=t?function(o){try{t(o)}catch(a){e.error(a)}}:super._next,this._error=i?function(o){try{i(o)}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(o){e.error(o)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function pe(r,e){return ae((t,n)=>{let i=0;t.subscribe(new ue(n,s=>{n.next(r.call(e,s,i++))}))})}function Ht(r){return this instanceof Ht?(this.v=r,this):new Ht(r)}function ea(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=t.apply(r,e||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(b){n[b]&&(i[b]=function(L){return new Promise(function(F,G){s.push([b,L,F,G])>1||a(b,L)})})}function a(b,L){try{!function l(b){b.value instanceof Ht?Promise.resolve(b.value.v).then(c,u):S(s[0][2],b)}(n[b](L))}catch(F){S(s[0][3],F)}}function c(b){a("next",b)}function u(b){a("throw",b)}function S(b,L){b(L),s.shift(),s.length&&a(s[0][0],s[0][1])}}function df(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=r[Symbol.asyncIterator];return e?e.call(r):(r=function is(r){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,l){!function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=r[s](o)).done,o.value)})}}}const Hr=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function xi(r){return w(null==r?void 0:r.then)}function Py(r){return w(r[H])}function Ny(r){return Symbol.asyncIterator&&w(null==r?void 0:r[Symbol.asyncIterator])}function Dy(r){return new TypeError(`You provided ${null!==r&&"object"==typeof r?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ly=function SP(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function xy(r){return w(null==r?void 0:r[Ly])}function My(r){return ea(this,arguments,function*(){const t=r.getReader();try{for(;;){const{value:n,done:i}=yield Ht(t.read());if(i)return yield Ht(void 0);yield yield Ht(n)}}finally{t.releaseLock()}})}function _y(r){return w(null==r?void 0:r.getReader)}function si(r){if(r instanceof z)return r;if(null!=r){if(Py(r))return function AP(r){return new z(e=>{const t=r[H]();if(w(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(r);if(Hr(r))return function RP(r){return new z(e=>{for(let t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}(r);if(xi(r))return function CP(r){return new z(e=>{r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,P)})}(r);if(Ny(r))return Fy(r);if(xy(r))return function IP(r){return new z(e=>{for(const t of r)if(e.next(t),e.closed)return;e.complete()})}(r);if(_y(r))return function OP(r){return Fy(My(r))}(r)}throw Dy(r)}function Fy(r){return new z(e=>{(function bP(r,e){var t,n,i,s;return function vn(r,e,t,n){return new(t||(t=Promise))(function(s,o){function a(u){try{c(n.next(u))}catch(S){o(S)}}function l(u){try{c(n.throw(u))}catch(S){o(S)}}function c(u){u.done?s(u.value):function i(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=df(r);!(n=yield t.next()).done;)if(e.next(n.value),e.closed)return}catch(o){i={error:o}}finally{try{n&&!n.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})})(r,e).catch(t=>e.error(t))})}function os(r,e,t,n=0,i=!1){const s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function hn(r,e,t=1/0){return w(e)?hn((n,i)=>pe((s,o)=>e(n,s,i,o))(si(r(n,i))),t):("number"==typeof e&&(t=e),ae((n,i)=>function TP(r,e,t,n,i,s,o,a){const l=[];let c=0,u=0,S=!1;const b=()=>{S&&!l.length&&!c&&e.complete()},L=G=>c<n?F(G):l.push(G),F=G=>{s&&e.next(G),c++;let J=!1;si(t(G,u++)).subscribe(new ue(e,te=>{null==i||i(te),s?L(te):e.next(te)},()=>{J=!0},void 0,()=>{if(J)try{for(c--;l.length&&c<n;){const te=l.shift();o?os(e,o,()=>F(te)):F(te)}b()}catch(te){e.error(te)}}))};return r.subscribe(new ue(e,L,()=>{S=!0,b()})),()=>{null==a||a()}}(n,i,r,t)))}function Nl(r=1/0){return hn($,r)}const as=new z(r=>r.complete());function Ef(r){return r[r.length-1]}function Dl(r){return function NP(r){return r&&w(r.schedule)}(Ef(r))?r.pop():void 0}function ky(r,e=0){return ae((t,n)=>{t.subscribe(new ue(n,i=>os(n,r,()=>n.next(i),e),()=>os(n,r,()=>n.complete(),e),i=>os(n,r,()=>n.error(i),e)))})}function Gy(r,e=0){return ae((t,n)=>{n.add(r.schedule(()=>t.subscribe(n),e))})}function Vy(r,e){if(!r)throw new Error("Iterable cannot be null");return new z(t=>{os(t,e,()=>{const n=r[Symbol.asyncIterator]();os(t,e,()=>{n.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function Pn(r,e){return e?function BP(r,e){if(null!=r){if(Py(r))return function LP(r,e){return si(r).pipe(Gy(e),ky(e))}(r,e);if(Hr(r))return function MP(r,e){return new z(t=>{let n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}(r,e);if(xi(r))return function xP(r,e){return si(r).pipe(Gy(e),ky(e))}(r,e);if(Ny(r))return Vy(r,e);if(xy(r))return function _P(r,e){return new z(t=>{let n;return os(t,e,()=>{n=r[Ly](),os(t,e,()=>{let i,s;try{({value:i,done:s}=n.next())}catch(o){return void t.error(o)}s?t.complete():t.next(i)},0,!0)}),()=>w(null==n?void 0:n.return)&&n.return()})}(r,e);if(_y(r))return function FP(r,e){return Vy(My(r),e)}(r,e)}throw Dy(r)}(r,e):si(r)}function Ou(r){return r<=0?()=>as:ae((e,t)=>{let n=0;e.subscribe(new ue(t,i=>{++n<=r&&(t.next(i),r<=n&&t.complete())}))})}function yf(r,e,...t){return!0===e?(r(),null):!1===e?null:e(...t).pipe(Ou(1)).subscribe(()=>r())}function At(r){for(let e in r)if(r[e]===At)return e;throw Error("Could not find renamed property on target object.")}function wf(r,e){for(const t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function vt(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(vt).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const e=r.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function vf(r,e){return null==r||""===r?null===e?"":e:null==e||""===e?r:r+" "+e}const GP=At({__forward_ref__:At});function Sf(r){return r.__forward_ref__=Sf,r.toString=function(){return vt(this())},r}function $e(r){return function Yy(r){return"function"==typeof r&&r.hasOwnProperty(GP)&&r.__forward_ref__===Sf}(r)?r():r}class ft extends Error{constructor(e,t){super(function Af(r,e){return`NG0${Math.abs(r)}${e?": "+e:""}`}(e,t)),this.code=e}}function We(r){return"string"==typeof r?r:null==r?"":String(r)}function Kn(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():We(r)}function bu(r,e){const t=e?` in ${e}`:"";throw new ft(-201,`No provider for ${Kn(r)} found${t}`)}function pr(r,e){null==r&&function Dt(r,e,t,n){throw new Error(`ASSERTION ERROR: ${r}`+(null==n?"":` [Expected=> ${t} ${n} ${e} <=Actual]`))}(e,r,null,"!=")}function Ke(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function ir(r){return{providers:r.providers||[],imports:r.imports||[]}}function Rf(r){return Uy(r,Tu)||Uy(r,jy)}function Uy(r,e){return r.hasOwnProperty(e)?r[e]:null}function Wy(r){return r&&(r.hasOwnProperty(Cf)||r.hasOwnProperty(zP))?r[Cf]:null}const Tu=At({\u0275prov:At}),Cf=At({\u0275inj:At}),jy=At({ngInjectableDef:At}),zP=At({ngInjectorDef:At});var Ue=(()=>((Ue=Ue||{})[Ue.Default=0]="Default",Ue[Ue.Host=1]="Host",Ue[Ue.Self=2]="Self",Ue[Ue.SkipSelf=4]="SkipSelf",Ue[Ue.Optional=8]="Optional",Ue))();let If;function Fs(r){const e=If;return If=r,e}function zy(r,e,t){const n=Rf(r);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:t&Ue.Optional?null:void 0!==e?e:void bu(vt(r),"Injector")}function Bs(r){return{toString:r}.toString()}var oi=(()=>((oi=oi||{})[oi.OnPush=0]="OnPush",oi[oi.Default=1]="Default",oi))(),Mi=(()=>{return(r=Mi||(Mi={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",Mi;var r})();const JP="undefined"!=typeof globalThis&&globalThis,$P="undefined"!=typeof window&&window,qP="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,St=JP||"undefined"!=typeof global&&global||$P||qP,ta={},Rt=[],Pu=At({\u0275cmp:At}),Of=At({\u0275dir:At}),bf=At({\u0275pipe:At}),Ky=At({\u0275mod:At}),cs=At({\u0275fac:At}),Ll=At({__NG_ELEMENT_ID__:At});let QP=0;function ks(r){return Bs(()=>{const t={},n={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===oi.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||Rt,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||Mi.Emulated,id:"c",styles:r.styles||Rt,_:null,setInput:null,schemas:r.schemas||null,tView:null},i=r.directives,s=r.features,o=r.pipes;return n.id+=QP++,n.inputs=Qy(r.inputs,t),n.outputs=Qy(r.outputs),s&&s.forEach(a=>a(n)),n.directiveDefs=i?()=>("function"==typeof i?i():i).map(Jy):null,n.pipeDefs=o?()=>("function"==typeof o?o():o).map($y):null,n})}function Jy(r){return Mn(r)||function Gs(r){return r[Of]||null}(r)}function $y(r){return function mo(r){return r[bf]||null}(r)}const qy={};function mr(r){return Bs(()=>{const e={type:r.type,bootstrap:r.bootstrap||Rt,declarations:r.declarations||Rt,imports:r.imports||Rt,exports:r.exports||Rt,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(qy[r.id]=r.type),e})}function Qy(r,e){if(null==r)return ta;const t={};for(const n in r)if(r.hasOwnProperty(n)){let i=r[n],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),t[i]=n,e&&(e[i]=s)}return t}const dn=ks;function Mn(r){return r[Pu]||null}function Yr(r,e){const t=r[Ky]||null;if(!t&&!0===e)throw new Error(`Type ${vt(r)} does not have '\u0275mod' property.`);return t}function _i(r){return Array.isArray(r)&&"object"==typeof r[1]}function li(r){return Array.isArray(r)&&!0===r[1]}function Nf(r){return 0!=(8&r.flags)}function xu(r){return 2==(2&r.flags)}function Mu(r){return 1==(1&r.flags)}function ci(r){return null!==r.template}function rN(r){return 0!=(512&r[2])}function vo(r,e){return r.hasOwnProperty(cs)?r[cs]:null}class oN{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function Vs(){return Zy}function Zy(r){return r.type.prototype.ngOnChanges&&(r.setInput=lN),aN}function aN(){const r=tw(this),e=null==r?void 0:r.current;if(e){const t=r.previous;if(t===ta)r.previous=e;else for(let n in e)t[n]=e[n];r.current=null,this.ngOnChanges(e)}}function lN(r,e,t,n){const i=tw(r)||function cN(r,e){return r[ew]=e}(r,{previous:ta,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[t],l=o[a];s[a]=new oN(l&&l.currentValue,e,o===ta),r[n]=e}Vs.ngInherit=!0;const ew="__ngSimpleChanges__";function tw(r){return r[ew]||null}let _f;function Yt(r){return!!r.listen}const nw={createRenderer:(r,e)=>function Ff(){return void 0!==_f?_f:"undefined"!=typeof document?document:void 0}()};function sn(r){for(;Array.isArray(r);)r=r[0];return r}function _u(r,e){return sn(e[r])}function jr(r,e){return sn(e[r.index])}function Bf(r,e){return r.data[e]}function yr(r,e){const t=e[r];return _i(t)?t:t[0]}function rw(r){return 4==(4&r[2])}function kf(r){return 128==(128&r[2])}function Hs(r,e){return null==e?null:r[e]}function iw(r){r[18]=0}function Gf(r,e){r[5]+=e;let t=r,n=r[3];for(;null!==n&&(1===e&&1===t[5]||-1===e&&0===t[5]);)n[5]+=e,t=n,n=n[3]}const Ve={lFrame:dw(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function sw(){return Ve.bindingsEnabled}function we(){return Ve.lFrame.lView}function at(){return Ve.lFrame.tView}function us(r){return Ve.lFrame.contextLView=r,r[8]}function fn(){let r=ow();for(;null!==r&&64===r.type;)r=r.parent;return r}function ow(){return Ve.lFrame.currentTNode}function Fi(r,e){const t=Ve.lFrame;t.currentTNode=r,t.isParent=e}function Vf(){return Ve.lFrame.isParent}function Hf(){Ve.lFrame.isParent=!1}function Fu(){return Ve.isInCheckNoChangesMode}function Bu(r){Ve.isInCheckNoChangesMode=r}function aa(){return Ve.lFrame.bindingIndex++}function ON(r,e){const t=Ve.lFrame;t.bindingIndex=t.bindingRootIndex=r,Yf(e)}function Yf(r){Ve.lFrame.currentDirectiveIndex=r}function cw(){return Ve.lFrame.currentQueryIndex}function Wf(r){Ve.lFrame.currentQueryIndex=r}function TN(r){const e=r[1];return 2===e.type?e.declTNode:1===e.type?r[6]:null}function uw(r,e,t){if(t&Ue.SkipSelf){let i=e,s=r;for(;!(i=i.parent,null!==i||t&Ue.Host||(i=TN(s),null===i||(s=s[15],10&i.type))););if(null===i)return!1;e=i,r=s}const n=Ve.lFrame=hw();return n.currentTNode=e,n.lView=r,!0}function ku(r){const e=hw(),t=r[1];Ve.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function hw(){const r=Ve.lFrame,e=null===r?null:r.child;return null===e?dw(r):e}function dw(r){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=e),e}function fw(){const r=Ve.lFrame;return Ve.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const gw=fw;function Gu(){const r=fw();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function $n(){return Ve.lFrame.selectedIndex}function Ys(r){Ve.lFrame.selectedIndex=r}function Ut(){const r=Ve.lFrame;return Bf(r.tView,r.selectedIndex)}function Jt(){Ve.lFrame.currentNamespace="svg"}function Vu(r,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){const s=r.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(r.contentHooks||(r.contentHooks=[])).push(-t,o),a&&((r.contentHooks||(r.contentHooks=[])).push(t,a),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(t,a)),l&&(r.viewHooks||(r.viewHooks=[])).push(-t,l),c&&((r.viewHooks||(r.viewHooks=[])).push(t,c),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(t,c)),null!=u&&(r.destroyHooks||(r.destroyHooks=[])).push(t,u)}}function Hu(r,e,t){pw(r,e,3,t)}function Yu(r,e,t,n){(3&r[2])===t&&pw(r,e,t,n)}function jf(r,e){let t=r[2];(3&t)===e&&(t&=2047,t+=1,r[2]=t)}function pw(r,e,t,n){const s=null!=n?n:-1,o=e.length-1;let a=0;for(let l=void 0!==n?65535&r[18]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=n&&a>=n)break}else e[l]<0&&(r[18]+=65536),(a<s||-1==s)&&(FN(r,t,e,l),r[18]=(4294901760&r[18])+l+2),l++}function FN(r,e,t,n){const i=t[n]<0,s=t[n+1],a=r[i?-t[n]:t[n]];if(i){if(r[2]>>11<r[18]>>16&&(3&r[2])===e){r[2]+=2048;try{s.call(a)}finally{}}}else try{s.call(a)}finally{}}class Bl{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function Uu(r,e,t){const n=Yt(r);let i=0;for(;i<t.length;){const s=t[i];if("number"==typeof s){if(0!==s)break;i++;const o=t[i++],a=t[i++],l=t[i++];n?r.setAttribute(e,a,l,o):e.setAttributeNS(o,a,l)}else{const o=s,a=t[++i];Kf(o)?n&&r.setProperty(e,o,a):n?r.setAttribute(e,o,a):e.setAttribute(o,a),i++}}return i}function mw(r){return 3===r||4===r||6===r}function Kf(r){return 64===r.charCodeAt(0)}function Wu(r,e){if(null!==e&&0!==e.length)if(null===r||0===r.length)r=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){const i=e[n];"number"==typeof i?t=i:0===t||Ew(r,t,i,null,-1===t||2===t?e[++n]:null)}}return r}function Ew(r,e,t,n,i){let s=0,o=r.length;if(-1===e)o=-1;else for(;s<r.length;){const a=r[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<r.length;){const a=r[s];if("number"==typeof a)break;if(a===t){if(null===n)return void(null!==i&&(r[s+1]=i));if(n===r[s+1])return void(r[s+2]=i)}s++,null!==n&&s++,null!==i&&s++}-1!==o&&(r.splice(o,0,e),s=o+1),r.splice(s++,0,t),null!==n&&r.splice(s++,0,n),null!==i&&r.splice(s++,0,i)}function yw(r){return-1!==r}function la(r){return 32767&r}function ca(r,e){let t=function HN(r){return r>>16}(r),n=e;for(;t>0;)n=n[15],t--;return n}let Jf=!0;function ju(r){const e=Jf;return Jf=r,e}let YN=0;function Gl(r,e){const t=qf(r,e);if(-1!==t)return t;const n=e[1];n.firstCreatePass&&(r.injectorIndex=e.length,$f(n.data,r),$f(e,null),$f(n.blueprint,null));const i=zu(r,e),s=r.injectorIndex;if(yw(i)){const o=la(i),a=ca(i,e),l=a[1].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=i,s}function $f(r,e){r.push(0,0,0,0,0,0,0,0,e)}function qf(r,e){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===e[r.injectorIndex+8]?-1:r.injectorIndex}function zu(r,e){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let t=0,n=null,i=e;for(;null!==i;){const s=i[1],o=s.type;if(n=2===o?s.declTNode:1===o?i[6]:null,null===n)return-1;if(t++,i=i[15],-1!==n.injectorIndex)return n.injectorIndex|t<<16}return-1}function Ku(r,e,t){!function UN(r,e,t){let n;"string"==typeof t?n=t.charCodeAt(0)||0:t.hasOwnProperty(Ll)&&(n=t[Ll]),null==n&&(n=t[Ll]=YN++);const i=255&n;e.data[r+(i>>5)]|=1<<i}(r,e,t)}function Sw(r,e,t){if(t&Ue.Optional)return r;bu(e,"NodeInjector")}function Aw(r,e,t,n){if(t&Ue.Optional&&void 0===n&&(n=null),0==(t&(Ue.Self|Ue.Host))){const i=r[9],s=Fs(void 0);try{return i?i.get(e,n,t&Ue.Optional):zy(e,n,t&Ue.Optional)}finally{Fs(s)}}return Sw(n,e,t)}function Rw(r,e,t,n=Ue.Default,i){if(null!==r){const s=function KN(r){if("string"==typeof r)return r.charCodeAt(0)||0;const e=r.hasOwnProperty(Ll)?r[Ll]:void 0;return"number"==typeof e?e>=0?255&e:jN:e}(t);if("function"==typeof s){if(!uw(e,r,n))return n&Ue.Host?Sw(i,t,n):Aw(e,t,n,i);try{const o=s(n);if(null!=o||n&Ue.Optional)return o;bu(t)}finally{gw()}}else if("number"==typeof s){let o=null,a=qf(r,e),l=-1,c=n&Ue.Host?e[16][6]:null;for((-1===a||n&Ue.SkipSelf)&&(l=-1===a?zu(r,e):e[a+8],-1!==l&&Ow(n,!1)?(o=e[1],a=la(l),e=ca(l,e)):a=-1);-1!==a;){const u=e[1];if(Iw(s,a,u.data)){const S=zN(a,e,t,o,n,c);if(S!==Cw)return S}l=e[a+8],-1!==l&&Ow(n,e[1].data[a+8]===c)&&Iw(s,a,e)?(o=u,a=la(l),e=ca(l,e)):a=-1}}}return Aw(e,t,n,i)}const Cw={};function jN(){return new ua(fn(),we())}function zN(r,e,t,n,i,s){const o=e[1],a=o.data[r+8],u=Ju(a,o,t,null==n?xu(a)&&Jf:n!=o&&0!=(3&a.type),i&Ue.Host&&s===a);return null!==u?Vl(e,o,u,a):Cw}function Ju(r,e,t,n,i){const s=r.providerIndexes,o=e.data,a=1048575&s,l=r.directiveStart,u=s>>20,b=i?a+u:r.directiveEnd;for(let L=n?a:a+u;L<b;L++){const F=o[L];if(L<l&&t===F||L>=l&&F.type===t)return L}if(i){const L=o[l];if(L&&ci(L)&&L.type===t)return l}return null}function Vl(r,e,t,n){let i=r[t];const s=e.data;if(function BN(r){return r instanceof Bl}(i)){const o=i;o.resolving&&function VP(r,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${r}`:"";throw new ft(-200,`Circular dependency in DI detected for ${r}${t}`)}(Kn(s[t]));const a=ju(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Fs(o.injectImpl):null;uw(r,n,Ue.Default);try{i=r[t]=o.factory(void 0,s,r,n),e.firstCreatePass&&t>=n.directiveStart&&function _N(r,e,t){const{ngOnChanges:n,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(n){const o=Zy(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(r,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,o)}i&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-r,i),s&&((t.preOrderHooks||(t.preOrderHooks=[])).push(r,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,s))}(t,s[t],e)}finally{null!==l&&Fs(l),ju(a),o.resolving=!1,gw()}}return i}function Iw(r,e,t){return!!(t[e+(r>>5)]&1<<r)}function Ow(r,e){return!(r&Ue.Self||r&Ue.Host&&e)}class ua{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Rw(this._tNode,this._lView,e,n,t)}}const da="__parameters__";function ga(r,e,t){return Bs(()=>{const n=function Xf(r){return function(...t){if(r){const n=r(...t);for(const i in n)this[i]=n[i]}}}(e);function i(...s){if(this instanceof i)return n.apply(this,s),this;const o=new i(...s);return a.annotation=o,a;function a(l,c,u){const S=l.hasOwnProperty(da)?l[da]:Object.defineProperty(l,da,{value:[]})[da];for(;S.length<=u;)S.push(null);return(S[u]=S[u]||[]).push(o),l}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=r,i.annotationCls=i,i})}class Ge{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Ke({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const qN=new Ge("AnalyzeForEntryComponents");function zr(r,e){void 0===e&&(e=r);for(let t=0;t<r.length;t++){let n=r[t];Array.isArray(n)?(e===r&&(e=r.slice(0,t)),zr(n,e)):e!==r&&e.push(n)}return e}function Bi(r,e){r.forEach(t=>Array.isArray(t)?Bi(t,e):e(t))}function Tw(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function $u(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function Wl(r,e){const t=[];for(let n=0;n<r;n++)t.push(e);return t}function wr(r,e,t){let n=pa(r,e);return n>=0?r[1|n]=t:(n=~n,function ZN(r,e,t,n){let i=r.length;if(i==e)r.push(t,n);else if(1===i)r.push(n,r[0]),r[0]=t;else{for(i--,r.push(r[i-1],r[i]);i>e;)r[i]=r[i-2],i--;r[e]=t,r[e+1]=n}}(r,n,e,t)),n}function eg(r,e){const t=pa(r,e);if(t>=0)return r[1|t]}function pa(r,e){return function Dw(r,e,t){let n=0,i=r.length>>t;for(;i!==n;){const s=n+(i-n>>1),o=r[s<<t];if(e===o)return s<<t;o>e?i=s:n=s+1}return~(i<<t)}(r,e,1)}const jl={},ng="__NG_DI_FLAG__",Qu="ngTempTokenPath",a0=/\n/gm,xw="__source",c0=At({provide:String,useValue:At});let zl;function Mw(r){const e=zl;return zl=r,e}function u0(r,e=Ue.Default){if(void 0===zl)throw new ft(203,"");return null===zl?zy(r,void 0,e):zl.get(r,e&Ue.Optional?null:void 0,e)}function Le(r,e=Ue.Default){return(function KP(){return If}()||u0)($e(r),e)}const Xu=Le;function rg(r){const e=[];for(let t=0;t<r.length;t++){const n=$e(r[t]);if(Array.isArray(n)){if(0===n.length)throw new ft(900,"");let i,s=Ue.Default;for(let o=0;o<n.length;o++){const a=n[o],l=h0(a);"number"==typeof l?-1===l?i=a.token:s|=l:i=a}e.push(Le(i,s))}else e.push(Le(n))}return e}function Kl(r,e){return r[ng]=e,r.prototype[ng]=e,r}function h0(r){return r[ng]}const Zu=Kl(ga("Inject",r=>({token:r})),-1),ui=Kl(ga("Optional"),8),ma=Kl(ga("SkipSelf"),4);const ev="__ngContext__";function Fn(r,e){r[ev]=e}function fg(r){const e=function Xl(r){return r[ev]||null}(r);return e?Array.isArray(e)?e:e.lView:null}function pg(r){return r.ngOriginalError}function oD(r,...e){r.error(...e)}class Ao{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=function sD(r){return r&&r.ngErrorLogger||oD}(e);n(this._console,"ERROR",e),t&&n(this._console,"ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&pg(e);for(;t&&pg(t);)t=pg(t);return t||null}}const mD=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(St))();function wa(r){return r.ownerDocument}function Vi(r){return r instanceof Function?r():r}var Sr=(()=>((Sr=Sr||{})[Sr.Important=1]="Important",Sr[Sr.DashCase=2]="DashCase",Sr))();function Eg(r,e){return undefined(r,e)}function Zl(r){const e=r[3];return li(e)?e[3]:e}function yg(r){return cv(r[13])}function wg(r){return cv(r[4])}function cv(r){for(;null!==r&&!li(r);)r=r[4];return r}function Sa(r,e,t,n,i){if(null!=n){let s,o=!1;li(n)?s=n:_i(n)&&(o=!0,n=n[0]);const a=sn(n);0===r&&null!==t?null==i?pv(e,t,a):Ro(e,t,a,i||null,!0):1===r&&null!==t?Ro(e,t,a,i||null,!0):2===r?function Av(r,e,t){const n=ih(r,e);n&&function PD(r,e,t,n){Yt(r)?r.removeChild(e,t,n):e.removeChild(t)}(r,n,e,t)}(e,a,o):3===r&&e.destroyNode(a),null!=s&&function LD(r,e,t,n,i){const s=t[7];s!==sn(t)&&Sa(e,r,n,s,i);for(let a=10;a<t.length;a++){const l=t[a];ec(l[1],l,r,e,n,s)}}(e,r,s,t,i)}}function Sg(r,e,t){if(Yt(r))return r.createElement(e,t);{const n=null!==t?function fN(r){const e=r.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(t):null;return null===n?r.createElement(e):r.createElementNS(n,e)}}function hv(r,e){const t=r[9],n=t.indexOf(e),i=e[3];1024&e[2]&&(e[2]&=-1025,Gf(i,-1)),t.splice(n,1)}function Ag(r,e){if(r.length<=10)return;const t=10+e,n=r[t];if(n){const i=n[17];null!==i&&i!==r&&hv(i,n),e>0&&(r[t-1][4]=n[4]);const s=$u(r,10+e);!function SD(r,e){ec(r,e,e[11],2,null,null),e[0]=null,e[6]=null}(n[1],n);const o=s[19];null!==o&&o.detachView(s[1]),n[3]=null,n[4]=null,n[2]&=-129}return n}function dv(r,e){if(!(256&e[2])){const t=e[11];Yt(t)&&t.destroyNode&&ec(r,e,t,3,null,null),function CD(r){let e=r[13];if(!e)return Rg(r[1],r);for(;e;){let t=null;if(_i(e))t=e[13];else{const n=e[10];n&&(t=n)}if(!t){for(;e&&!e[4]&&e!==r;)_i(e)&&Rg(e[1],e),e=e[3];null===e&&(e=r),_i(e)&&Rg(e[1],e),t=e&&e[4]}e=t}}(e)}}function Rg(r,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function TD(r,e){let t;if(null!=r&&null!=(t=r.destroyHooks))for(let n=0;n<t.length;n+=2){const i=e[t[n]];if(!(i instanceof Bl)){const s=t[n+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],l=s[o+1];try{l.call(a)}finally{}}else try{s.call(i)}finally{}}}}(r,e),function bD(r,e){const t=r.cleanup,n=e[7];let i=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+1],a="function"==typeof o?o(e):sn(e[o]),l=n[i=t[s+2]],c=t[s+3];"boolean"==typeof c?a.removeEventListener(t[s],l,c):c>=0?n[i=c]():n[i=-c].unsubscribe(),s+=2}else{const o=n[i=t[s+1]];t[s].call(o)}if(null!==n){for(let s=i+1;s<n.length;s++)n[s]();e[7]=null}}(r,e),1===e[1].type&&Yt(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&li(e[3])){t!==e[3]&&hv(t,e);const n=e[19];null!==n&&n.detachView(r)}}}function fv(r,e,t){return function gv(r,e,t){let n=e;for(;null!==n&&40&n.type;)n=(e=n).parent;if(null===n)return t[0];if(2&n.flags){const i=r.data[n.directiveStart].encapsulation;if(i===Mi.None||i===Mi.Emulated)return null}return jr(n,t)}(r,e.parent,t)}function Ro(r,e,t,n,i){Yt(r)?r.insertBefore(e,t,n,i):e.insertBefore(t,n,i)}function pv(r,e,t){Yt(r)?r.appendChild(e,t):e.appendChild(t)}function mv(r,e,t,n,i){null!==n?Ro(r,e,t,n,i):pv(r,e,t)}function ih(r,e){return Yt(r)?r.parentNode(e):e.parentNode}function Ev(r,e,t){return wv(r,e,t)}let wv=function yv(r,e,t){return 40&r.type?jr(r,t):null};function sh(r,e,t,n){const i=fv(r,n,e),s=e[11],a=Ev(n.parent||e[6],n,e);if(null!=i)if(Array.isArray(t))for(let l=0;l<t.length;l++)mv(s,i,t[l],a,!1);else mv(s,i,t,a,!1)}function oh(r,e){if(null!==e){const t=e.type;if(3&t)return jr(e,r);if(4&t)return Ig(-1,r[e.index]);if(8&t){const n=e.child;if(null!==n)return oh(r,n);{const i=r[e.index];return li(i)?Ig(-1,i):sn(i)}}if(32&t)return Eg(e,r)()||sn(r[e.index]);{const n=Sv(r,e);return null!==n?Array.isArray(n)?n[0]:oh(Zl(r[16]),n):oh(r,e.next)}}return null}function Sv(r,e){return null!==e?r[16][6].projection[e.projection]:null}function Ig(r,e){const t=10+r+1;if(t<e.length){const n=e[t],i=n[1].firstChild;if(null!==i)return oh(n,i)}return e[7]}function Og(r,e,t,n,i,s,o){for(;null!=t;){const a=n[t.index],l=t.type;if(o&&0===e&&(a&&Fn(sn(a),n),t.flags|=4),64!=(64&t.flags))if(8&l)Og(r,e,t.child,n,i,s,!1),Sa(e,r,i,a,s);else if(32&l){const c=Eg(t,n);let u;for(;u=c();)Sa(e,r,i,u,s);Sa(e,r,i,a,s)}else 16&l?Rv(r,e,n,t,i,s):Sa(e,r,i,a,s);t=o?t.projectionNext:t.next}}function ec(r,e,t,n,i,s){Og(t,n,r.firstChild,e,i,s,!1)}function Rv(r,e,t,n,i,s){const o=t[16],l=o[6].projection[n.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Sa(e,r,i,l[c],s);else Og(r,e,l,o[3],i,s,!0)}function Cv(r,e,t){Yt(r)?r.setAttribute(e,"style",t):e.style.cssText=t}function bg(r,e,t){Yt(r)?""===t?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t):e.className=t}function Iv(r,e,t){let n=r.length;for(;;){const i=r.indexOf(e,t);if(-1===i)return i;if(0===i||r.charCodeAt(i-1)<=32){const s=e.length;if(i+s===n||r.charCodeAt(i+s)<=32)return i}t=i+1}}const Ov="ng-template";function MD(r,e,t){let n=0;for(;n<r.length;){let i=r[n++];if(t&&"class"===i){if(i=r[n],-1!==Iv(i.toLowerCase(),e,0))return!0}else if(1===i){for(;n<r.length&&"string"==typeof(i=r[n++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function bv(r){return 4===r.type&&r.value!==Ov}function _D(r,e,t){return e===(4!==r.type||t?r.value:Ov)}function FD(r,e,t){let n=4;const i=r.attrs||[],s=function GD(r){for(let e=0;e<r.length;e++)if(mw(r[e]))return e;return r.length}(i);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&n){if(n=2|1&n,""!==l&&!_D(r,l,t)||""===l&&1===e.length){if(hi(n))return!1;o=!0}}else{const c=8&n?l:e[++a];if(8&n&&null!==r.attrs){if(!MD(r.attrs,c,t)){if(hi(n))return!1;o=!0}continue}const S=BD(8&n?"class":l,i,bv(r),t);if(-1===S){if(hi(n))return!1;o=!0;continue}if(""!==c){let b;b=S>s?"":i[S+1].toLowerCase();const L=8&n?b:null;if(L&&-1!==Iv(L,c,0)||2&n&&c!==b){if(hi(n))return!1;o=!0}}}}else{if(!o&&!hi(n)&&!hi(l))return!1;if(o&&hi(l))continue;o=!1,n=l|1&n}}return hi(n)||o}function hi(r){return 0==(1&r)}function BD(r,e,t,n){if(null===e)return-1;let i=0;if(n||!t){let s=!1;for(;i<e.length;){const o=e[i];if(o===r)return i;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=s?1:2}return-1}return function VD(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){const n=r[t];if("number"==typeof n)return-1;if(n===e)return t;t++}return-1}(e,r)}function Tv(r,e,t=!1){for(let n=0;n<e.length;n++)if(FD(r,e[n],t))return!0;return!1}function HD(r,e){e:for(let t=0;t<e.length;t++){const n=e[t];if(r.length===n.length){for(let i=0;i<r.length;i++)if(r[i]!==n[i])continue e;return!0}}return!1}function Pv(r,e){return r?":not("+e.trim()+")":e}function YD(r){let e=r[0],t=1,n=2,i="",s=!1;for(;t<r.length;){let o=r[t];if("string"==typeof o)if(2&n){const a=r[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?i+="."+o:4&n&&(i+=" "+o);else""!==i&&!hi(o)&&(e+=Pv(s,i),i=""),n=o,s=s||!hi(n);t++}return""!==i&&(e+=Pv(s,i)),e}const je={};function pt(r){Nv(at(),we(),$n()+r,Fu())}function Nv(r,e,t,n){if(!n)if(3==(3&e[2])){const s=r.preOrderCheckHooks;null!==s&&Hu(e,s,t)}else{const s=r.preOrderHooks;null!==s&&Yu(e,s,0,t)}Ys(t)}function ah(r,e){return r<<17|e<<2}function di(r){return r>>17&32767}function Tg(r){return 2|r}function fs(r){return(131068&r)>>2}function Pg(r,e){return-131069&r|e<<2}function Ng(r){return 1|r}function Hv(r,e){const t=r.contentQueries;if(null!==t)for(let n=0;n<t.length;n+=2){const i=t[n],s=t[n+1];if(-1!==s){const o=r.data[s];Wf(i),o.contentQueries(2,e[s],s)}}}function tc(r,e,t,n,i,s,o,a,l,c){const u=e.blueprint.slice();return u[0]=i,u[2]=140|n,iw(u),u[3]=u[15]=r,u[8]=t,u[10]=o||r&&r[10],u[11]=a||r&&r[11],u[12]=l||r&&r[12]||null,u[9]=c||r&&r[9]||null,u[6]=s,u[16]=2==e.type?r[16]:u,u}function Aa(r,e,t,n,i){let s=r.data[e];if(null===s)s=function Gg(r,e,t,n,i){const s=ow(),o=Vf(),l=r.data[e]=function oL(r,e,t,n,i,s){return{type:t,index:n,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,n,i);return null===r.firstChild&&(r.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l)),l}(r,e,t,n,i),function IN(){return Ve.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=t,s.value=n,s.attrs=i;const o=function Fl(){const r=Ve.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Fi(s,!0),s}function Ra(r,e,t,n){if(0===t)return-1;const i=e.length;for(let s=0;s<t;s++)e.push(n),r.blueprint.push(n),r.data.push(null);return i}function nc(r,e,t){ku(e);try{const n=r.viewQuery;null!==n&&Jg(1,n,t);const i=r.template;null!==i&&Yv(r,e,i,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Hv(r,e),r.staticViewQueries&&Jg(2,r.viewQuery,t);const s=r.components;null!==s&&function rL(r,e){for(let t=0;t<e.length;t++)CL(r,e[t])}(e,s)}catch(n){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),n}finally{e[2]&=-5,Gu()}}function Ca(r,e,t,n){const i=e[2];if(256==(256&i))return;ku(e);const s=Fu();try{iw(e),function aw(r){return Ve.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==t&&Yv(r,e,t,2,n);const o=3==(3&i);if(!s)if(o){const c=r.preOrderCheckHooks;null!==c&&Hu(e,c,null)}else{const c=r.preOrderHooks;null!==c&&Yu(e,c,0,null),jf(e,0)}if(function AL(r){for(let e=yg(r);null!==e;e=wg(e)){if(!e[2])continue;const t=e[9];for(let n=0;n<t.length;n++){const i=t[n],s=i[3];0==(1024&i[2])&&Gf(s,1),i[2]|=1024}}}(e),function SL(r){for(let e=yg(r);null!==e;e=wg(e))for(let t=10;t<e.length;t++){const n=e[t],i=n[1];kf(n)&&Ca(i,n,i.template,n[8])}}(e),null!==r.contentQueries&&Hv(r,e),!s)if(o){const c=r.contentCheckHooks;null!==c&&Hu(e,c)}else{const c=r.contentHooks;null!==c&&Yu(e,c,1),jf(e,1)}!function tL(r,e){const t=r.hostBindingOpCodes;if(null!==t)try{for(let n=0;n<t.length;n++){const i=t[n];if(i<0)Ys(~i);else{const s=i,o=t[++n],a=t[++n];ON(o,s),a(2,e[s])}}}finally{Ys(-1)}}(r,e);const a=r.components;null!==a&&function nL(r,e){for(let t=0;t<e.length;t++)RL(r,e[t])}(e,a);const l=r.viewQuery;if(null!==l&&Jg(2,l,n),!s)if(o){const c=r.viewCheckHooks;null!==c&&Hu(e,c)}else{const c=r.viewHooks;null!==c&&Yu(e,c,2),jf(e,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),s||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,Gf(e[3],-1))}finally{Gu()}}function iL(r,e,t,n){const i=e[10],s=!Fu(),o=rw(e);try{s&&!o&&i.begin&&i.begin(),o&&nc(r,e,n),Ca(r,e,t,n)}finally{s&&!o&&i.end&&i.end()}}function Yv(r,e,t,n,i){const s=$n(),o=2&n;try{Ys(-1),o&&e.length>20&&Nv(r,e,20,Fu()),t(n,i)}finally{Ys(s)}}function Uv(r,e,t){if(Nf(e)){const i=e.directiveEnd;for(let s=e.directiveStart;s<i;s++){const o=r.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function Vg(r,e,t){!sw()||(function fL(r,e,t,n){const i=t.directiveStart,s=t.directiveEnd;r.firstCreatePass||Gl(t,e),Fn(n,e);const o=t.initialInputs;for(let a=i;a<s;a++){const l=r.data[a],c=ci(l);c&&yL(e,t,l);const u=Vl(e,r,a,t);Fn(u,e),null!==o&&wL(0,a-i,u,l,0,o),c&&(yr(t.index,e)[8]=u)}}(r,e,t,jr(t,e)),128==(128&t.flags)&&function gL(r,e,t){const n=t.directiveStart,i=t.directiveEnd,o=t.index,a=function bN(){return Ve.lFrame.currentDirectiveIndex}();try{Ys(o);for(let l=n;l<i;l++){const c=r.data[l],u=e[l];Yf(l),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&Qv(c,u)}}finally{Ys(-1),Yf(a)}}(r,e,t))}function Hg(r,e,t=jr){const n=e.localNames;if(null!==n){let i=e.index+1;for(let s=0;s<n.length;s+=2){const o=n[s+1],a=-1===o?t(e,r):r[o];r[i++]=a}}}function Wv(r){const e=r.tView;return null===e||e.incompleteFirstPass?r.tView=uh(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):e}function uh(r,e,t,n,i,s,o,a,l,c){const u=20+n,S=u+i,b=function sL(r,e){const t=[];for(let n=0;n<e;n++)t.push(n<r?null:je);return t}(u,S),L="function"==typeof c?c():c;return b[1]={type:r,blueprint:b,template:t,queries:null,viewQuery:a,declTNode:e,data:b.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:S,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:L,incompleteFirstPass:!1}}function Kv(r,e,t,n){const i=rS(e);null===t?i.push(n):(i.push(t),r.firstCreatePass&&iS(r).push(n,i.length-1))}function Jv(r,e,t){for(let n in r)if(r.hasOwnProperty(n)){const i=r[n];(t=null===t?{}:t).hasOwnProperty(n)?t[n].push(e,i):t[n]=[e,i]}return t}function Yg(r,e,t,n){let i=!1;if(sw()){const s=function pL(r,e,t){const n=r.directiveRegistry;let i=null;if(n)for(let s=0;s<n.length;s++){const o=n[s];Tv(t,o.selectors,!1)&&(i||(i=[]),Ku(Gl(t,e),r,o.type),ci(o)?(Xv(r,t),i.unshift(o)):i.push(o))}return i}(r,e,t),o=null===n?null:{"":-1};if(null!==s){i=!0,Zv(t,r.data.length,s.length);for(let u=0;u<s.length;u++){const S=s[u];S.providersResolver&&S.providersResolver(S)}let a=!1,l=!1,c=Ra(r,e,s.length,null);for(let u=0;u<s.length;u++){const S=s[u];t.mergedAttrs=Wu(t.mergedAttrs,S.hostAttrs),eS(r,t,e,c,S),EL(c,S,o),null!==S.contentQueries&&(t.flags|=8),(null!==S.hostBindings||null!==S.hostAttrs||0!==S.hostVars)&&(t.flags|=128);const b=S.type.prototype;!a&&(b.ngOnChanges||b.ngOnInit||b.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(t.index),a=!0),!l&&(b.ngOnChanges||b.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t.index),l=!0),c++}!function aL(r,e){const n=e.directiveEnd,i=r.data,s=e.attrs,o=[];let a=null,l=null;for(let c=e.directiveStart;c<n;c++){const u=i[c],S=u.inputs,b=null===s||bv(e)?null:vL(S,s);o.push(b),a=Jv(S,c,a),l=Jv(u.outputs,c,l)}null!==a&&(a.hasOwnProperty("class")&&(e.flags|=16),a.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=o,e.inputs=a,e.outputs=l}(r,t)}o&&function mL(r,e,t){if(e){const n=r.localNames=[];for(let i=0;i<e.length;i+=2){const s=t[e[i+1]];if(null==s)throw new ft(-301,!1);n.push(e[i],s)}}}(t,n,o)}return t.mergedAttrs=Wu(t.mergedAttrs,t.attrs),i}function qv(r,e,t,n,i,s){const o=s.hostBindings;if(o){let a=r.hostBindingOpCodes;null===a&&(a=r.hostBindingOpCodes=[]);const l=~e.index;(function dL(r){let e=r.length;for(;e>0;){const t=r[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=l&&a.push(l),a.push(n,i,o)}}function Qv(r,e){null!==r.hostBindings&&r.hostBindings(1,e)}function Xv(r,e){e.flags|=2,(r.components||(r.components=[])).push(e.index)}function EL(r,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=r;ci(e)&&(t[""]=r)}}function Zv(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function eS(r,e,t,n,i){r.data[n]=i;const s=i.factory||(i.factory=vo(i.type)),o=new Bl(s,ci(i),null);r.blueprint[n]=o,t[n]=o,qv(r,e,0,n,Ra(r,t,i.hostVars,je),i)}function yL(r,e,t){const n=jr(e,r),i=Wv(t),s=r[10],o=hh(r,tc(r,i,null,t.onPush?64:16,n,e,s,s.createRenderer(n,t),null,null));r[e.index]=o}function Hi(r,e,t,n,i,s){const o=jr(r,e);!function Ug(r,e,t,n,i,s,o){if(null==s)Yt(r)?r.removeAttribute(e,i,t):e.removeAttribute(i);else{const a=null==o?We(s):o(s,n||"",i);Yt(r)?r.setAttribute(e,i,a,t):t?e.setAttributeNS(t,i,a):e.setAttribute(i,a)}}(e[11],o,s,r.value,t,n,i)}function wL(r,e,t,n,i,s){const o=s[e];if(null!==o){const a=n.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],S=o[l++];null!==a?n.setInput(t,S,c,u):t[u]=S}}}function vL(r,e){let t=null,n=0;for(;n<e.length;){const i=e[n];if(0!==i)if(5!==i){if("number"==typeof i)break;r.hasOwnProperty(i)&&(null===t&&(t=[]),t.push(i,r[i],e[n+1])),n+=2}else n+=2;else n+=4}return t}function tS(r,e,t,n){return new Array(r,!0,!1,e,null,0,n,t,null,null)}function RL(r,e){const t=yr(e,r);if(kf(t)){const n=t[1];80&t[2]?Ca(n,t,n.template,t[8]):t[5]>0&&Wg(t)}}function Wg(r){for(let n=yg(r);null!==n;n=wg(n))for(let i=10;i<n.length;i++){const s=n[i];if(1024&s[2]){const o=s[1];Ca(o,s,o.template,s[8])}else s[5]>0&&Wg(s)}const t=r[1].components;if(null!==t)for(let n=0;n<t.length;n++){const i=yr(t[n],r);kf(i)&&i[5]>0&&Wg(i)}}function CL(r,e){const t=yr(e,r),n=t[1];(function IL(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])})(n,t),nc(n,t,t[8])}function hh(r,e){return r[13]?r[14][4]=e:r[13]=e,r[14]=e,e}function jg(r){for(;r;){r[2]|=64;const e=Zl(r);if(rN(r)&&!e)return r;r=e}return null}function Kg(r,e,t){const n=e[10];n.begin&&n.begin();try{Ca(r,e,r.template,t)}catch(i){throw oS(e,i),i}finally{n.end&&n.end()}}function nS(r){!function zg(r){for(let e=0;e<r.components.length;e++){const t=r.components[e],n=fg(t),i=n[1];iL(i,n,i.template,t)}}(r[8])}function Jg(r,e,t){Wf(0),e(r,t)}const PL=(()=>Promise.resolve(null))();function rS(r){return r[7]||(r[7]=[])}function iS(r){return r.cleanup||(r.cleanup=[])}function oS(r,e){const t=r[9],n=t?t.get(Ao,null):null;n&&n.handleError(e)}function aS(r,e,t,n,i){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],l=e[o],c=r.data[o];null!==c.setInput?c.setInput(l,i,n,a):l[a]=i}}function gs(r,e,t){const n=_u(e,r);!function uv(r,e,t){Yt(r)?r.setValue(e,t):e.textContent=t}(r[11],n,t)}function dh(r,e,t){let n=t?r.styles:null,i=t?r.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=vf(i,a):2==s&&(n=vf(n,a+": "+e[++o]+";"))}t?r.styles=n:r.stylesWithoutHost=n,t?r.classes=i:r.classesWithoutHost=i}const $g=new Ge("INJECTOR",-1);class lS{get(e,t=jl){if(t===jl){const n=new Error(`NullInjectorError: No provider for ${vt(e)}!`);throw n.name="NullInjectorError",n}return t}}const qg=new Ge("Set Injector scope."),rc={},LL={};let Qg;function cS(){return void 0===Qg&&(Qg=new lS),Qg}function uS(r,e=null,t=null,n){const i=hS(r,e,t,n);return i._resolveInjectorDefTypes(),i}function hS(r,e=null,t=null,n){return new xL(r,t,e||cS(),n)}class xL{constructor(e,t,n,i=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const s=[];t&&Bi(t,a=>this.processProvider(a,e,t)),Bi([e],a=>this.processInjectorType(a,[],s)),this.records.set($g,Ia(void 0,this));const o=this.records.get(qg);this.scope=null!=o?o.value:null,this.source=i||("object"==typeof e?null:vt(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=jl,n=Ue.Default){this.assertNotDestroyed();const i=Mw(this),s=Fs(void 0);try{if(!(n&Ue.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function HL(r){return"function"==typeof r||"object"==typeof r&&r instanceof Ge}(e)&&Rf(e);a=l&&this.injectableDefInScope(l)?Ia(Xg(e),rc):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(n&Ue.Self?cS():this.parent).get(e,t=n&Ue.Optional&&t===jl?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[Qu]=o[Qu]||[]).unshift(vt(e)),i)throw o;return function d0(r,e,t,n){const i=r[Qu];throw e[xw]&&i.unshift(e[xw]),r.message=function f0(r,e,t,n=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let i=vt(e);if(Array.isArray(e))i=e.map(vt).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):vt(a)))}i=`{${s.join(", ")}}`}return`${t}${n?"("+n+")":""}[${i}]: ${r.replace(a0,"\n  ")}`}("\n"+r.message,i,t,n),r.ngTokenPath=i,r[Qu]=null,r}(o,e,"R3InjectorError",this.source)}throw o}finally{Fs(s),Mw(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((n,i)=>e.push(vt(i))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ft(205,!1)}processInjectorType(e,t,n){if(!(e=$e(e)))return!1;let i=Wy(e);const s=null==i&&e.ngModule||void 0,o=void 0===s?e:s,a=-1!==n.indexOf(o);if(void 0!==s&&(i=Wy(s)),null==i)return!1;if(null!=i.imports&&!a){let u;n.push(o);try{Bi(i.imports,S=>{this.processInjectorType(S,t,n)&&(void 0===u&&(u=[]),u.push(S))})}finally{}if(void 0!==u)for(let S=0;S<u.length;S++){const{ngModule:b,providers:L}=u[S];Bi(L,F=>this.processProvider(F,b,L||Rt))}}this.injectorDefTypes.add(o);const l=vo(o)||(()=>new o);this.records.set(o,Ia(l,rc));const c=i.providers;if(null!=c&&!a){const u=e;Bi(c,S=>this.processProvider(S,u,c))}return void 0!==s&&void 0!==e.providers}processProvider(e,t,n){let i=Oa(e=$e(e))?e:$e(e&&e.provide);const s=function _L(r,e,t){return fS(r)?Ia(void 0,r.useValue):Ia(function dS(r,e,t){let n;if(Oa(r)){const i=$e(r);return vo(i)||Xg(i)}if(fS(r))n=()=>$e(r.useValue);else if(function BL(r){return!(!r||!r.useFactory)}(r))n=()=>r.useFactory(...rg(r.deps||[]));else if(function FL(r){return!(!r||!r.useExisting)}(r))n=()=>Le($e(r.useExisting));else{const i=$e(r&&(r.useClass||r.provide));if(!function GL(r){return!!r.deps}(r))return vo(i)||Xg(i);n=()=>new i(...rg(r.deps))}return n}(r),rc)}(e);if(Oa(e)||!0!==e.multi)this.records.get(i);else{let o=this.records.get(i);o||(o=Ia(void 0,rc,!0),o.factory=()=>rg(o.multi),this.records.set(i,o)),i=e,o.multi.push(e)}this.records.set(i,s)}hydrate(e,t){return t.value===rc&&(t.value=LL,t.value=t.factory()),"object"==typeof t.value&&t.value&&function VL(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=$e(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Xg(r){const e=Rf(r),t=null!==e?e.factory:vo(r);if(null!==t)return t;if(r instanceof Ge)throw new ft(204,!1);if(r instanceof Function)return function ML(r){const e=r.length;if(e>0)throw Wl(e,"?"),new ft(204,!1);const t=function WP(r){const e=r&&(r[Tu]||r[jy]);if(e){const t=function jP(r){if(r.hasOwnProperty("name"))return r.name;const e=(""+r).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(r);return null!==t?()=>t.factory(r):()=>new r}(r);throw new ft(204,!1)}function Ia(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function fS(r){return null!==r&&"object"==typeof r&&c0 in r}function Oa(r){return"function"==typeof r}let ar=(()=>{class r{static create(t,n){var i;if(Array.isArray(t))return uS({name:""},n,t,"");{const s=null!==(i=t.name)&&void 0!==i?i:"";return uS({name:s},t.parent,t.providers,s)}}}return r.THROW_IF_NOT_FOUND=jl,r.NULL=new lS,r.\u0275prov=Ke({token:r,providedIn:"any",factory:()=>Le($g)}),r.__NG_ELEMENT_ID__=-1,r})();function $L(r,e){Vu(fg(r)[1],fn())}function tp(r){let e=function IS(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),t=!0;const n=[r];for(;e;){let i;if(ci(r))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new ft(903,"");i=e.\u0275dir}if(i){if(t){n.push(i);const o=r;o.inputs=np(r.inputs),o.declaredInputs=np(r.declaredInputs),o.outputs=np(r.outputs);const a=i.hostBindings;a&&ZL(r,a);const l=i.viewQuery,c=i.contentQueries;if(l&&QL(r,l),c&&XL(r,c),wf(r.inputs,i.inputs),wf(r.declaredInputs,i.declaredInputs),wf(r.outputs,i.outputs),ci(i)&&i.data.animation){const u=r.data;u.animation=(u.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(r),a===tp&&(t=!1)}}e=Object.getPrototypeOf(e)}!function qL(r){let e=0,t=null;for(let n=r.length-1;n>=0;n--){const i=r[n];i.hostVars=e+=i.hostVars,i.hostAttrs=Wu(i.hostAttrs,t=Wu(t,i.hostAttrs))}}(n)}function np(r){return r===ta?{}:r===Rt?[]:r}function QL(r,e){const t=r.viewQuery;r.viewQuery=t?(n,i)=>{e(n,i),t(n,i)}:e}function XL(r,e){const t=r.contentQueries;r.contentQueries=t?(n,i,s)=>{e(n,i,s),t(n,i,s)}:e}function ZL(r,e){const t=r.hostBindings;r.hostBindings=t?(n,i)=>{e(n,i),t(n,i)}:e}let fh=null;function ba(){if(!fh){const r=St.Symbol;if(r&&r.iterator)fh=r.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(fh=n)}}}return fh}function ic(r){return!!function rp(r){return null!==r&&("function"==typeof r||"object"==typeof r)}(r)&&(Array.isArray(r)||!(r instanceof Map)&&ba()in r)}function Bn(r,e,t){return!Object.is(r[e],t)&&(r[e]=t,!0)}function on(r,e,t,n){const i=we();return Bn(i,aa(),e)&&(at(),Hi(Ut(),i,r,e,t,n)),on}function $t(r,e,t,n,i,s,o,a){const l=we(),c=at(),u=r+20,S=c.firstCreatePass?function ox(r,e,t,n,i,s,o,a,l){const c=e.consts,u=Aa(e,r,4,o||null,Hs(c,a));Yg(e,t,u,Hs(c,l)),Vu(e,u);const S=u.tViews=uh(2,u,n,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),S.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,n,i,s,o):c.data[u];Fi(S,!1);const b=l[11].createComment("");sh(c,l,b,S),Fn(b,l),hh(l,l[u]=tS(b,l,b,S)),Mu(S)&&Vg(c,l,S),null!=o&&Hg(l,S,a)}function De(r,e=Ue.Default){const t=we();return null===t?Le(r,e):Rw(fn(),t,$e(r),e)}function lp(){throw new Error("invalid")}function ht(r,e,t){const n=we();return Bn(n,aa(),e)&&function Ar(r,e,t,n,i,s,o,a){const l=jr(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[n])?(aS(r,t,u,n,i),xu(e)&&function cL(r,e){const t=yr(e,r);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(n=function lL(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(n),i=null!=o?o(i,e.value||"",n):i,Yt(s)?s.setProperty(l,n,i):Kf(n)||(l.setProperty?l.setProperty(n,i):l[n]=i))}(at(),Ut(),n,r,e,n[11],t,!1),ht}function cp(r,e,t,n,i){const o=i?"class":"style";aS(r,t,e.inputs[o],o,n)}function Ot(r,e,t,n){const i=we(),s=at(),o=20+r,a=i[11],l=i[o]=Sg(a,e,function MN(){return Ve.lFrame.currentNamespace}()),c=s.firstCreatePass?function Tx(r,e,t,n,i,s,o){const a=e.consts,c=Aa(e,r,2,i,Hs(a,s));return Yg(e,t,c,Hs(a,o)),null!==c.attrs&&dh(c,c.attrs,!1),null!==c.mergedAttrs&&dh(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,i,0,e,t,n):s.data[o];Fi(c,!0);const u=c.mergedAttrs;null!==u&&Uu(a,l,u);const S=c.classes;null!==S&&bg(a,l,S);const b=c.styles;return null!==b&&Cv(a,l,b),64!=(64&c.flags)&&sh(s,i,l,c),0===function wN(){return Ve.lFrame.elementDepthCount}()&&Fn(l,i),function vN(){Ve.lFrame.elementDepthCount++}(),Mu(c)&&(Vg(s,i,c),Uv(s,c,i)),null!==n&&Hg(i,c),Ot}function Mt(){let r=fn();Vf()?Hf():(r=r.parent,Fi(r,!1));const e=r;!function SN(){Ve.lFrame.elementDepthCount--}();const t=at();return t.firstCreatePass&&(Vu(t,r),Nf(r)&&t.queries.elementEnd(r)),null!=e.classesWithoutHost&&function GN(r){return 0!=(16&r.flags)}(e)&&cp(t,e,we(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function VN(r){return 0!=(32&r.flags)}(e)&&cp(t,e,we(),e.stylesWithoutHost,!1),Mt}function Rr(r,e,t,n){return Ot(r,e,t,n),Mt(),Rr}function up(r,e,t){const n=we(),i=at(),s=r+20,o=i.firstCreatePass?function Px(r,e,t,n,i){const s=e.consts,o=Hs(s,n),a=Aa(e,r,8,"ng-container",o);return null!==o&&dh(a,o,!0),Yg(e,t,a,Hs(s,i)),null!==e.queries&&e.queries.elementStart(e,a),a}(s,i,n,e,t):i.data[s];Fi(o,!0);const a=n[s]=n[11].createComment("");return sh(i,n,a,o),Fn(a,n),Mu(o)&&(Vg(i,n,o),Uv(i,o,n)),null!=t&&Hg(n,o),up}function hp(){let r=fn();const e=at();return Vf()?Hf():(r=r.parent,Fi(r,!1)),e.firstCreatePass&&(Vu(e,r),Nf(r)&&e.queries.elementEnd(r)),hp}function zs(r,e,t){return up(r,e,t),hp(),zs}function oc(){return we()}function mh(r){return!!r&&"function"==typeof r.then}const zS=function jS(r){return!!r&&"function"==typeof r.subscribe};function Cr(r,e,t,n){const i=we(),s=at(),o=fn();return function JS(r,e,t,n,i,s,o,a){const l=Mu(n),u=r.firstCreatePass&&iS(r),S=e[8],b=rS(e);let L=!0;if(3&n.type||a){const J=jr(n,e),te=a?a(J):J,ie=b.length,he=a?Ce=>a(sn(Ce[n.index])):n.index;if(Yt(t)){let Ce=null;if(!a&&l&&(Ce=function Nx(r,e,t,n){const i=r.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const o=i[s];if(o===t&&i[s+1]===n){const a=e[7],l=i[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(r,e,i,n.index)),null!==Ce)(Ce.__ngLastListenerFn__||Ce).__ngNextListenerFn__=s,Ce.__ngLastListenerFn__=s,L=!1;else{s=dp(n,e,S,s,!1);const be=t.listen(te,i,s);b.push(s,be),u&&u.push(i,he,ie,ie+1)}}else s=dp(n,e,S,s,!0),te.addEventListener(i,s,o),b.push(s),u&&u.push(i,he,ie,o)}else s=dp(n,e,S,s,!1);const F=n.outputs;let G;if(L&&null!==F&&(G=F[i])){const J=G.length;if(J)for(let te=0;te<J;te+=2){const Je=e[G[te]][G[te+1]].subscribe(s),rt=b.length;b.push(s,Je),u&&u.push(i,n.index,rt,-(rt+1))}}}(s,i,i[11],o,r,e,!!t,n),Cr}function $S(r,e,t,n){try{return!1!==t(n)}catch(i){return oS(r,i),!1}}function dp(r,e,t,n,i){return function s(o){if(o===Function)return n;const a=2&r.flags?yr(r.index,e):e;0==(32&e[2])&&jg(a);let l=$S(e,0,n,o),c=s.__ngNextListenerFn__;for(;c;)l=$S(e,0,c,o)&&l,c=c.__ngNextListenerFn__;return i&&!1===l&&(o.preventDefault(),o.returnValue=!1),l}}function dt(r=1){return function PN(r){return(Ve.lFrame.contextLView=function NN(r,e){for(;r>0;)e=e[15],r--;return e}(r,Ve.lFrame.contextLView))[8]}(r)}function Dx(r,e){let t=null;const n=function kD(r){const e=r.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(r);for(let i=0;i<e.length;i++){const s=e[i];if("*"!==s){if(null===n?Tv(r,s,!0):HD(n,s))return i}else t=i}return t}function fp(r){const e=we()[16][6];if(!e.projection){const n=e.projection=Wl(r?r.length:1,null),i=n.slice();let s=e.child;for(;null!==s;){const o=r?Dx(s,r):0;null!==o&&(i[o]?i[o].projectionNext=s:n[o]=s,i[o]=s),s=s.next}}}function Eh(r,e=0,t){const n=we(),i=at(),s=Aa(i,20+r,16,null,t||null);null===s.projection&&(s.projection=e),Hf(),64!=(64&s.flags)&&function DD(r,e,t){Rv(e[11],0,e,t,fv(r,t,e),Ev(t.parent||e[6],t,e))}(i,n,s)}function sA(r,e,t,n,i){const s=r[t+1],o=null===e;let a=n?di(s):fs(s),l=!1;for(;0!==a&&(!1===l||o);){const u=r[a+1];Mx(r[a],e)&&(l=!0,r[a+1]=n?Ng(u):Tg(u)),a=n?di(u):fs(u)}l&&(r[t+1]=n?Tg(s):Ng(s))}function Mx(r,e){return null===r||null==e||(Array.isArray(r)?r[1]:r)===e||!(!Array.isArray(r)||"string"!=typeof e)&&pa(r,e)>=0}function ac(r,e,t){return gi(r,e,t,!1),ac}function Io(r,e){return gi(r,e,null,!0),Io}function gi(r,e,t,n){const i=we(),s=at(),o=function ds(r){const e=Ve.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}(2);s.firstUpdatePass&&function fA(r,e,t,n){const i=r.data;if(null===i[t+1]){const s=i[$n()],o=function dA(r,e){return e>=r.expandoStartIndex}(r,t);(function EA(r,e){return 0!=(r.flags&(e?16:32))})(s,n)&&null===e&&!o&&(e=!1),e=function Ux(r,e,t,n){const i=function Uf(r){const e=Ve.lFrame.currentDirectiveIndex;return-1===e?null:r[e]}(r);let s=n?e.residualClasses:e.residualStyles;if(null===i)0===(n?e.classBindings:e.styleBindings)&&(t=lc(t=pp(null,r,e,t,n),e.attrs,n),s=null);else{const o=e.directiveStylingLast;if(-1===o||r[o]!==i)if(t=pp(i,r,e,t,n),null===s){let l=function Wx(r,e,t){const n=t?e.classBindings:e.styleBindings;if(0!==fs(n))return r[di(n)]}(r,e,n);void 0!==l&&Array.isArray(l)&&(l=pp(null,r,e,l[1],n),l=lc(l,e.attrs,n),function jx(r,e,t,n){r[di(t?e.classBindings:e.styleBindings)]=n}(r,e,n,l))}else s=function zx(r,e,t){let n;const i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++)n=lc(n,r[s].hostAttrs,t);return lc(n,e.attrs,t)}(r,e,n)}return void 0!==s&&(n?e.residualClasses=s:e.residualStyles=s),t}(i,s,e,n),function Lx(r,e,t,n,i,s){let o=s?e.classBindings:e.styleBindings,a=di(o),l=fs(o);r[n]=t;let u,c=!1;if(Array.isArray(t)){const S=t;u=S[1],(null===u||pa(S,u)>0)&&(c=!0)}else u=t;if(i)if(0!==l){const b=di(r[a+1]);r[n+1]=ah(b,a),0!==b&&(r[b+1]=Pg(r[b+1],n)),r[a+1]=function jD(r,e){return 131071&r|e<<17}(r[a+1],n)}else r[n+1]=ah(a,0),0!==a&&(r[a+1]=Pg(r[a+1],n)),a=n;else r[n+1]=ah(l,0),0===a?a=n:r[l+1]=Pg(r[l+1],n),l=n;c&&(r[n+1]=Tg(r[n+1])),sA(r,u,n,!0),sA(r,u,n,!1),function xx(r,e,t,n,i){const s=i?r.residualClasses:r.residualStyles;null!=s&&"string"==typeof e&&pa(s,e)>=0&&(t[n+1]=Ng(t[n+1]))}(e,u,r,n,s),o=ah(a,l),s?e.classBindings=o:e.styleBindings=o}(i,s,e,t,o,n)}}(s,r,o,n),e!==je&&Bn(i,o,e)&&function pA(r,e,t,n,i,s,o,a){if(!(3&e.type))return;const l=r.data,c=l[a+1];yh(function xv(r){return 1==(1&r)}(c)?mA(l,e,t,i,fs(c),o):void 0)||(yh(s)||function Lv(r){return 2==(2&r)}(c)&&(s=mA(l,null,t,i,a,o)),function xD(r,e,t,n,i){const s=Yt(r);if(e)i?s?r.addClass(t,n):t.classList.add(n):s?r.removeClass(t,n):t.classList.remove(n);else{let o=-1===n.indexOf("-")?void 0:Sr.DashCase;if(null==i)s?r.removeStyle(t,n,o):t.style.removeProperty(n);else{const a="string"==typeof i&&i.endsWith("!important");a&&(i=i.slice(0,-10),o|=Sr.Important),s?r.setStyle(t,n,i,o):t.style.setProperty(n,i,a?"important":"")}}}(n,o,_u($n(),t),i,s))}(s,s.data[$n()],i,i[11],r,i[o+1]=function $x(r,e){return null==r||("string"==typeof e?r+=e:"object"==typeof r&&(r=vt(function vr(r){return r instanceof class So{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?r.changingThisBreaksApplicationSecurity:r}(r)))),r}(e,t),n,o)}function pp(r,e,t,n,i){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],n=lc(n,s.hostAttrs,i),s!==r);)a++;return null!==r&&(t.directiveStylingLast=a),n}function lc(r,e,t){const n=t?1:2;let i=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?i=o:i===n&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),wr(r,o,!!t||e[++s]))}return void 0===r?null:r}function mA(r,e,t,n,i,s){const o=null===e;let a;for(;i>0;){const l=r[i],c=Array.isArray(l),u=c?l[1]:l,S=null===u;let b=t[i+1];b===je&&(b=S?Rt:void 0);let L=S?eg(b,n):u===n?b:void 0;if(c&&!yh(L)&&(L=eg(l,n)),yh(L)&&(a=L,o))return a;const F=r[i+1];i=o?di(F):fs(F)}if(null!==e){let l=s?e.residualClasses:e.residualStyles;null!=l&&(a=eg(l,n))}return a}function yh(r){return void 0!==r}function mp(r,e=""){const t=we(),n=at(),i=r+20,s=n.firstCreatePass?Aa(n,i,1,e,null):n.data[i],o=t[i]=function vg(r,e){return Yt(r)?r.createText(e):r.createTextNode(e)}(t[11],e);sh(n,t,o,s),Fi(s,!1)}function Ep(r){return wh("",r,""),Ep}function wh(r,e,t){const n=we(),i=function Pa(r,e,t,n){return Bn(r,aa(),t)?e+We(t)+n:je}(n,r,e,t);return i!==je&&gs(n,$n(),i),wh}const vh="en-US";let GA=vh;class uR{}class y_{resolveComponentFactory(e){throw function E_(r){const e=Error(`No component factory found for ${vt(r)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=r,e}(e)}}let fc=(()=>{class r{}return r.NULL=new y_,r})();function w_(){return Ha(fn(),we())}function Ha(r,e){return new mi(jr(r,e))}let mi=(()=>{class r{constructor(t){this.nativeElement=t}}return r.__NG_ELEMENT_ID__=w_,r})();function v_(r){return r instanceof mi?r.nativeElement:r}class dR{}let R_=(()=>{class r{}return r.\u0275prov=Ke({token:r,providedIn:"root",factory:()=>null}),r})();class bo{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const C_=new bo("13.3.3"),Cp={};function Oh(r,e,t,n,i=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&n.push(sn(s)),li(s))for(let a=10;a<s.length;a++){const l=s[a],c=l[1].firstChild;null!==c&&Oh(l[1],l,c,n)}const o=t.type;if(8&o)Oh(r,e,t.child,n);else if(32&o){const a=Eg(t,e);let l;for(;l=a();)n.push(l)}else if(16&o){const a=Sv(e,t);if(Array.isArray(a))n.push(...a);else{const l=Zl(e[16]);Oh(l[1],l,a,n,!0)}}t=i?t.projectionNext:t.next}return n}class gc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Oh(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(li(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Ag(e,n),$u(t,n))}this._attachedToViewContainer=!1}dv(this._lView[1],this._lView)}onDestroy(e){Kv(this._lView[1],this._lView,null,e)}markForCheck(){jg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Kg(this._lView[1],this._lView,this.context)}checkNoChanges(){!function bL(r,e,t){Bu(!0);try{Kg(r,e,t)}finally{Bu(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new ft(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function RD(r,e){ec(r,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ft(902,"");this._appRef=e}}class I_ extends gc{constructor(e){super(e),this._view=e}detectChanges(){nS(this._view)}checkNoChanges(){!function TL(r){Bu(!0);try{nS(r)}finally{Bu(!1)}}(this._view)}get context(){return null}}class fR extends fc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Mn(e);return new Ip(t,this.ngModule)}}function gR(r){const e=[];for(let t in r)r.hasOwnProperty(t)&&e.push({propName:r[t],templateName:t});return e}class Ip extends uR{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function UD(r){return r.map(YD).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return gR(this.componentDef.inputs)}get outputs(){return gR(this.componentDef.outputs)}create(e,t,n,i){const s=(i=i||this.ngModule)?function b_(r,e){return{get:(t,n,i)=>{const s=r.get(t,Cp,i);return s!==Cp||n===Cp?s:e.get(t,n,i)}}}(e,i.injector):e,o=s.get(dR,nw),a=s.get(R_,null),l=o.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",u=n?function zv(r,e,t){if(Yt(r))return r.selectRootElement(e,t===Mi.ShadowDom);let n="string"==typeof e?r.querySelector(e):e;return n.textContent="",n}(l,n,this.componentDef.encapsulation):Sg(o.createRenderer(null,this.componentDef),c,function O_(r){const e=r.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(c)),S=this.componentDef.onPush?576:528,b=function CS(r,e){return{components:[],scheduler:r||mD,clean:PL,playerHandler:e||null,flags:0}}(),L=uh(0,null,null,1,0,null,null,null,null,null),F=tc(null,L,b,S,null,null,o,l,a,s);let G,J;ku(F);try{const te=function AS(r,e,t,n,i,s){const o=t[1];t[20]=r;const l=Aa(o,20,2,"#host",null),c=l.mergedAttrs=e.hostAttrs;null!==c&&(dh(l,c,!0),null!==r&&(Uu(i,r,c),null!==l.classes&&bg(i,r,l.classes),null!==l.styles&&Cv(i,r,l.styles)));const u=n.createRenderer(r,e),S=tc(t,Wv(e),null,e.onPush?64:16,t[20],l,n,u,s||null,null);return o.firstCreatePass&&(Ku(Gl(l,t),o,e.type),Xv(o,l),Zv(l,t.length,1)),hh(t,S),t[20]=S}(u,this.componentDef,F,o,l);if(u)if(n)Uu(l,u,["ng-version",C_.full]);else{const{attrs:ie,classes:he}=function WD(r){const e=[],t=[];let n=1,i=2;for(;n<r.length;){let s=r[n];if("string"==typeof s)2===i?""!==s&&e.push(s,r[++n]):8===i&&t.push(s);else{if(!hi(i))break;i=s}n++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);ie&&Uu(l,u,ie),he&&he.length>0&&bg(l,u,he.join(" "))}if(J=Bf(L,20),void 0!==t){const ie=J.projection=[];for(let he=0;he<this.ngContentSelectors.length;he++){const Ce=t[he];ie.push(null!=Ce?Array.from(Ce):null)}}G=function RS(r,e,t,n,i){const s=t[1],o=function hL(r,e,t){const n=fn();r.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),eS(r,n,e,Ra(r,e,1,null),t));const i=Vl(e,r,n.directiveStart,n);Fn(i,e);const s=jr(n,e);return s&&Fn(s,e),i}(s,t,e);if(n.components.push(o),r[8]=o,i&&i.forEach(l=>l(o,e)),e.contentQueries){const l=fn();e.contentQueries(1,o,l.directiveStart)}const a=fn();return!s.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Ys(a.index),qv(t[1],a,0,a.directiveStart,a.directiveEnd,e),Qv(e,o)),o}(te,this.componentDef,F,b,[$L]),nc(L,F,null)}finally{Gu()}return new P_(this.componentType,G,Ha(J,F),F,J)}}class P_ extends class m_{}{constructor(e,t,n,i,s){super(),this.location=n,this._rootLView=i,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new I_(i),this.componentType=e}get injector(){return new ua(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class ps{}class pR{}const Ya=new Map;class yR extends ps{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new fR(this);const n=Yr(e);this._bootstrapComponents=Vi(n.bootstrap),this._r3Injector=hS(e,t,[{provide:ps,useValue:this},{provide:fc,useValue:this.componentFactoryResolver}],vt(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=ar.THROW_IF_NOT_FOUND,n=Ue.Default){return e===ar||e===ps||e===$g?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Op extends pR{constructor(e){super(),this.moduleType=e,null!==Yr(e)&&function D_(r){const e=new Set;!function t(n){const i=Yr(n,!0),s=i.id;null!==s&&(function mR(r,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${r} - ${vt(e)} vs ${vt(e.name)}`)}(s,Ya.get(s),n),Ya.set(s,n));const o=Vi(i.imports);for(const a of o)e.has(a)||(e.add(a),t(a))}(r)}(e)}create(e){return new yR(this.moduleType,e)}}function Ua(r,e,t,n){return function wR(r,e,t,n,i,s){const o=e+t;return Bn(r,o,i)?function Yi(r,e,t){return r[e]=t}(r,o+1,s?n.call(s,i):n(i)):function pc(r,e){const t=r[e];return t===je?void 0:t}(r,o+1)}(we(),function Jn(){const r=Ve.lFrame;let e=r.bindingRootIndex;return-1===e&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}(),r,e,t,n)}function bp(r){return e=>{setTimeout(r,void 0,e)}}const _t=class J_ extends ye{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var i,s,o;let a=e,l=t||(()=>null),c=n;if(e&&"object"==typeof e){const S=e;a=null===(i=S.next)||void 0===i?void 0:i.bind(S),l=null===(s=S.error)||void 0===s?void 0:s.bind(S),c=null===(o=S.complete)||void 0===o?void 0:o.bind(S)}this.__isAsync&&(l=bp(l),a&&(a=bp(a)),c&&(c=bp(c)));const u=super.subscribe({next:a,error:l,complete:c});return e instanceof f&&e.add(u),u}};function $_(){return this._results[ba()]()}class Tp{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ba(),n=Tp.prototype;n[t]||(n[t]=$_)}get changes(){return this._changes||(this._changes=new _t)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const i=zr(e);(this._changesDetected=!function QN(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++){let i=r[n],s=e[n];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(n._results,i,t))&&(n._results=i,n.length=i.length,n.last=i[this.length-1],n.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let ms=(()=>{class r{}return r.__NG_ELEMENT_ID__=X_,r})();const q_=ms,Q_=class extends q_{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=tc(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const s=this._declarationLView[19];return null!==s&&(n[19]=s.createEmbeddedView(t)),nc(t,n,e),new gc(n)}};function X_(){return bh(fn(),we())}function bh(r,e){return 4&r.type?new Q_(e,r,Ha(r,e)):null}let Ei=(()=>{class r{}return r.__NG_ELEMENT_ID__=Z_,r})();function Z_(){return OR(fn(),we())}const e1=Ei,CR=class extends e1{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Ha(this._hostTNode,this._hostLView)}get injector(){return new ua(this._hostTNode,this._hostLView)}get parentInjector(){const e=zu(this._hostTNode,this._hostLView);if(yw(e)){const t=ca(e,this._hostLView),n=la(e);return new ua(t[1].data[n+8],t)}return new ua(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=IR(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const i=e.createEmbeddedView(t||{});return this.insert(i,n),i}createComponent(e,t,n,i,s){const o=e&&!function Ul(r){return"function"==typeof r}(e);let a;if(o)a=t;else{const S=t||{};a=S.index,n=S.injector,i=S.projectableNodes,s=S.ngModuleRef}const l=o?e:new Ip(Mn(e)),c=n||this.parentInjector;if(!s&&null==l.ngModule){const b=(o?c:this.parentInjector).get(ps,null);b&&(s=b)}const u=l.create(c,i,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const n=e._lView,i=n[1];if(function yN(r){return li(r[3])}(n)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const S=n[3],b=new CR(S,S[6],S[3]);b.detach(b.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function ID(r,e,t,n){const i=10+n,s=t.length;n>0&&(t[i-1][4]=e),n<s-10?(e[4]=t[i],Tw(t,10+n,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[17];null!==o&&t!==o&&function OD(r,e){const t=r[9];e[16]!==e[3][3][16]&&(r[2]=!0),null===t?r[9]=[e]:t.push(e)}(o,e);const a=e[19];null!==a&&a.insertView(r),e[2]|=128}(i,n,o,s);const a=Ig(s,o),l=n[11],c=ih(l,o[7]);return null!==c&&function AD(r,e,t,n,i,s){n[0]=i,n[6]=e,ec(r,n,t,1,i,s)}(i,o[6],l,n,c,a),e.attachToViewContainerRef(),Tw(Pp(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=IR(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Ag(this._lContainer,t);n&&($u(Pp(this._lContainer),t),dv(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Ag(this._lContainer,t);return n&&null!=$u(Pp(this._lContainer),t)?new gc(n):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function IR(r){return r[8]}function Pp(r){return r[8]||(r[8]=[])}function OR(r,e){let t;const n=e[r.index];if(li(n))t=n;else{let i;if(8&r.type)i=sn(n);else{const s=e[11];i=s.createComment("");const o=jr(r,e);Ro(s,ih(s,o),i,function ND(r,e){return Yt(r)?r.nextSibling(e):e.nextSibling}(s,o),!1)}e[r.index]=t=tS(n,e,i,r),hh(e,t)}return new CR(t,r,e)}class Np{constructor(e){this.queryList=e,this.matches=null}clone(){return new Np(this.queryList)}setDirty(){this.queryList.setDirty()}}class Dp{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let s=0;s<n;s++){const o=t.getByIndex(s);i.push(this.queries[o.indexInDeclarationView].clone())}return new Dp(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==DR(e,t).matches&&this.queries[t].setDirty()}}class bR{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Lp{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const i=null!==t?t.length:0,s=this.getByIndex(n).embeddedTView(e,i);s&&(s.indexInDeclarationView=n,null!==t?t.push(s):t=[s])}return null!==t?new Lp(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class xp{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new xp(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let i=0;i<n.length;i++){const s=n[i];this.matchTNodeWithReadOption(e,t,r1(t,s)),this.matchTNodeWithReadOption(e,t,Ju(t,e,s,!1,!1))}else n===ms?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Ju(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const i=this.metadata.read;if(null!==i)if(i===mi||i===Ei||i===ms&&4&t.type)this.addMatch(t.index,-2);else{const s=Ju(t,e,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function r1(r,e){const t=r.localNames;if(null!==t)for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1];return null}function o1(r,e,t,n){return-1===t?function s1(r,e){return 11&r.type?Ha(r,e):4&r.type?bh(r,e):null}(e,r):-2===t?function a1(r,e,t){return t===mi?Ha(e,r):t===ms?bh(e,r):t===Ei?OR(e,r):void 0}(r,e,n):Vl(r,r[1],t,e)}function TR(r,e,t,n){const i=e[19].queries[n];if(null===i.matches){const s=r.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:o1(e,s[c],o[l+1],t.metadata.read))}i.matches=a}return i.matches}function Mp(r,e,t,n){const i=r.queries.getByIndex(t),s=i.matches;if(null!==s){const o=TR(r,e,i,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)n.push(o[a/2]);else{const c=s[a+1],u=e[-l];for(let S=10;S<u.length;S++){const b=u[S];b[17]===b[3]&&Mp(b[1],b,c,n)}if(null!==u[9]){const S=u[9];for(let b=0;b<S.length;b++){const L=S[b];Mp(L[1],L,c,n)}}}}}return n}function yi(r){const e=we(),t=at(),n=cw();Wf(n+1);const i=DR(t,n);if(r.dirty&&rw(e)===(2==(2&i.metadata.flags))){if(null===i.matches)r.reset([]);else{const s=i.crossesNgTemplate?Mp(t,e,n,[]):TR(t,e,i,n);r.reset(s,v_),r.notifyOnChanges()}return!0}return!1}function _p(r,e,t){const n=at();n.firstCreatePass&&(NR(n,new bR(r,e,t),-1),2==(2&e)&&(n.staticViewQueries=!0)),PR(n,we(),e)}function Es(r,e,t,n){const i=at();if(i.firstCreatePass){const s=fn();NR(i,new bR(e,t,n),s.index),function c1(r,e){const t=r.contentQueries||(r.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(r.queries.length-1,e)}(i,r),2==(2&t)&&(i.staticContentQueries=!0)}PR(i,we(),t)}function wi(){return function l1(r,e){return r[19].queries[e].queryList}(we(),cw())}function PR(r,e,t){const n=new Tp(4==(4&t));Kv(r,e,n,n.destroy),null===e[19]&&(e[19]=new Dp),e[19].queries.push(new Np(n))}function NR(r,e,t){null===r.queries&&(r.queries=new Lp),r.queries.track(new xp(e,t))}function DR(r,e){return r.queries.getByIndex(e)}function Fp(r,e){return bh(r,e)}function Nh(...r){}const Yp=new Ge("Application Initializer");let Up=(()=>{class r{constructor(t){this.appInits=t,this.resolve=Nh,this.reject=Nh,this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}runInitializers(){if(this.initialized)return;const t=[],n=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const s=this.appInits[i]();if(mh(s))t.push(s);else if(zS(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{n()}).catch(i=>{this.reject(i)}),0===t.length&&n(),this.initialized=!0}}return r.\u0275fac=function(t){return new(t||r)(Le(Yp,8))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const yc=new Ge("AppId",{providedIn:"root",factory:function JR(){return`${Wp()}${Wp()}${Wp()}`}});function Wp(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const $R=new Ge("Platform Initializer"),jp=new Ge("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),qR=new Ge("appBootstrapListener");let O1=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const ys=new Ge("LocaleId",{providedIn:"root",factory:()=>Xu(ys,Ue.Optional|Ue.SkipSelf)||function b1(){return"undefined"!=typeof $localize&&$localize.locale||vh}()});class P1{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let QR=(()=>{class r{compileModuleSync(t){return new Op(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const n=this.compileModuleSync(t),s=Vi(Yr(t).declarations).reduce((o,a)=>{const l=Mn(a);return l&&o.push(new Ip(l)),o},[]);return new P1(n,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const D1=(()=>Promise.resolve(0))();function zp(r){"undefined"==typeof Zone?D1.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class mn{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new _t(!1),this.onMicrotaskEmpty=new _t(!1),this.onStable=new _t(!1),this.onError=new _t(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!n&&t,i.shouldCoalesceRunChangeDetection=n,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function L1(){let r=St.requestAnimationFrame,e=St.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&e){const t=r[Zone.__symbol__("OriginalDelegate")];t&&(r=t);const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function _1(r){const e=()=>{!function M1(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(St,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,Jp(r),r.isCheckStableRunning=!0,Kp(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),Jp(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,n,i,s,o,a)=>{try{return XR(r),t.invokeTask(i,s,o,a)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||r.shouldCoalesceRunChangeDetection)&&e(),ZR(r)}},onInvoke:(t,n,i,s,o,a,l)=>{try{return XR(r),t.invoke(i,s,o,a,l)}finally{r.shouldCoalesceRunChangeDetection&&e(),ZR(r)}},onHasTask:(t,n,i,s)=>{t.hasTask(i,s),n===i&&("microTask"==s.change?(r._hasPendingMicrotasks=s.microTask,Jp(r),Kp(r)):"macroTask"==s.change&&(r.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,n,i,s)=>(t.handleError(i,s),r.runOutsideAngular(()=>r.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!mn.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(mn.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,x1,Nh,Nh);try{return s.runTask(o,t,n)}finally{s.cancelTask(o)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const x1={};function Kp(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Jp(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function XR(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function ZR(r){r._nesting--,Kp(r)}class F1{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new _t,this.onMicrotaskEmpty=new _t,this.onStable=new _t,this.onError=new _t}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,i){return e.apply(t,n)}}let $p=(()=>{class r{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{mn.assertNotInAngularZone(),zp(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())zp(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(n=>!n.updateCb||!n.updateCb(t)||(clearTimeout(n.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,n,i){let s=-1;n&&n>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},n)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:i})}whenStable(t,n,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,n,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,n,i){return[]}}return r.\u0275fac=function(t){return new(t||r)(Le(mn))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),B1=(()=>{class r{constructor(){this._applications=new Map,qp.addToWindow(this)}registerApplication(t,n){this._applications.set(t,n)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,n=!0){return qp.findTestabilityInTree(this,t,n)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();class k1{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let vi,qp=new k1;const eC=new Ge("AllowMultipleToken");class tC{constructor(e,t){this.name=e,this.token=t}}function nC(r,e,t=[]){const n=`Platform: ${e}`,i=new Ge(n);return(s=[])=>{let o=rC();if(!o||o.injector.get(eC,!1))if(r)r(t.concat(s).concat({provide:i,useValue:!0}));else{const a=t.concat(s).concat({provide:i,useValue:!0},{provide:qg,useValue:"platform"});!function Y1(r){if(vi&&!vi.destroyed&&!vi.injector.get(eC,!1))throw new ft(400,"");vi=r.get(W1);const e=r.get($R,null);e&&e.forEach(t=>t())}(ar.create({providers:a,name:n}))}return function U1(r){const e=rC();if(!e)throw new ft(401,"");return e}()}}function rC(){return vi&&!vi.destroyed?vi:null}let W1=(()=>{class r{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,n){const a=function j1(r,e){let t;return t="noop"===r?new F1:("zone.js"===r?void 0:r)||new mn({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(n?n.ngZone:void 0,{ngZoneEventCoalescing:n&&n.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:n&&n.ngZoneRunCoalescing||!1}),l=[{provide:mn,useValue:a}];return a.run(()=>{const c=ar.create({providers:l,parent:this.injector,name:t.moduleType.name}),u=t.create(c),S=u.injector.get(Ao,null);if(!S)throw new ft(402,"");return a.runOutsideAngular(()=>{const b=a.onError.subscribe({next:L=>{S.handleError(L)}});u.onDestroy(()=>{Xp(this._modules,u),b.unsubscribe()})}),function z1(r,e,t){try{const n=t();return mh(n)?n.catch(i=>{throw e.runOutsideAngular(()=>r.handleError(i)),i}):n}catch(n){throw e.runOutsideAngular(()=>r.handleError(n)),n}}(S,a,()=>{const b=u.injector.get(Up);return b.runInitializers(),b.donePromise.then(()=>(function vM(r){pr(r,"Expected localeId to be defined"),"string"==typeof r&&(GA=r.toLowerCase().replace(/_/g,"-"))}(u.injector.get(ys,vh)||vh),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,n=[]){const i=iC({},n);return function V1(r,e,t){const n=new Op(t);return Promise.resolve(n)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(t){const n=t.injector.get(Qp);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>n.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new ft(403,"");t.instance.ngDoBootstrap(n)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ft(404,"");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(t){return new(t||r)(Le(ar))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function iC(r,e){return Array.isArray(e)?e.reduce(iC,r):Object.assign(Object.assign({},r),e)}let Qp=(()=>{class r{constructor(t,n,i,s){this._zone=t,this._injector=n,this._exceptionHandler=i,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new z(l=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{l.next(this._stable),l.complete()})}),a=new z(l=>{let c;this._zone.runOutsideAngular(()=>{c=this._zone.onStable.subscribe(()=>{mn.assertNotInAngularZone(),zp(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,l.next(!0))})})});const u=this._zone.onUnstable.subscribe(()=>{mn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{l.next(!1)}))});return()=>{c.unsubscribe(),u.unsubscribe()}});this.isStable=function kP(...r){const e=Dl(r),t=function DP(r,e){return"number"==typeof Ef(r)?r.pop():e}(r,1/0),n=r;return n.length?1===n.length?si(n[0]):Nl(t)(Pn(n,e)):as}(o,a.pipe(function Hy(r={}){const{connector:e=(()=>new ye),resetOnError:t=!0,resetOnComplete:n=!0,resetOnRefCountZero:i=!0}=r;return s=>{let o=null,a=null,l=null,c=0,u=!1,S=!1;const b=()=>{null==a||a.unsubscribe(),a=null},L=()=>{b(),o=l=null,u=S=!1},F=()=>{const G=o;L(),null==G||G.unsubscribe()};return ae((G,J)=>{c++,!S&&!u&&b();const te=l=null!=l?l:e();J.add(()=>{c--,0===c&&!S&&!u&&(a=yf(F,i))}),te.subscribe(J),o||(o=new re({next:ie=>te.next(ie),error:ie=>{S=!0,b(),a=yf(L,t,ie),te.error(ie)},complete:()=>{u=!0,b(),a=yf(L,n),te.complete()}}),Pn(G).subscribe(o))})(s)}}()))}bootstrap(t,n){if(!this._initStatus.done)throw new ft(405,"");let i;i=t instanceof uR?t:this._injector.get(fc).resolveComponentFactory(t),this.componentTypes.push(i.componentType);const s=function H1(r){return r.isBoundToModule}(i)?void 0:this._injector.get(ps),a=i.create(ar.NULL,[],n||i.selector,s),l=a.location.nativeElement,c=a.injector.get($p,null),u=c&&a.injector.get(B1);return c&&u&&u.registerApplication(l,c),a.onDestroy(()=>{this.detachView(a.hostView),Xp(this.components,a),u&&u.unregisterApplication(l)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new ft(101,"");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const n=t;this._views.push(n),n.attachToAppRef(this)}detachView(t){const n=t;Xp(this._views,n),n.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(qR,[]).concat(this._bootstrapListeners).forEach(i=>i(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(t){return new(t||r)(Le(mn),Le(ar),Le(Ao),Le(Up))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Xp(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}let oC=!0,aC=!1,Dh=(()=>{class r{}return r.__NG_ELEMENT_ID__=q1,r})();function q1(r){return function Q1(r,e,t){if(xu(r)&&!t){const n=yr(r.index,e);return new gc(n,n)}return 47&r.type?new gc(e[16],e):null}(fn(),we(),16==(16&r))}class hC{constructor(){}supports(e){return ic(e)}create(e){return new rF(e)}}const nF=(r,e)=>e;class rF{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||nF}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,i=0,s=null;for(;t||n;){const o=!n||t&&t.currentIndex<fC(n,i,s)?t:n,a=fC(o,i,s),l=o.currentIndex;if(o===n)i--,n=n._nextRemoved;else if(t=t._next,null==o.previousIndex)i++;else{s||(s=[]);const c=a-i,u=l-i;if(c!=u){for(let b=0;b<c;b++){const L=b<s.length?s[b]:s[b]=0,F=L+b;u<=F&&F<c&&(s[b]=L+1)}s[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!ic(e))throw new ft(900,"");return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,s,o,t=this._itHead,n=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(n&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),n=!0),t=t._next}else i=0,function sx(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{const t=r[ba()]();let n;for(;!(n=t.next()).done;)e(n.value)}}(e,a=>{o=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,o)?(n&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,i),n=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,i){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,i)):e=this._addAfter(new iF(t,n),s,i),e}_verifyReinsertion(e,t,n,i){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==s?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,s=e._nextRemoved;return null===i?this._removalsHead=s:i._nextRemoved=s,null===s?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new dC),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new dC),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class iF{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class sF{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class dC{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new sF,this.map.set(t,n)),n.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function fC(r,e,t){const n=r.previousIndex;if(null===n)return n;let i=0;return t&&n<t.length&&(i=t[n]),n+e+i}function pC(){return new Mh([new hC])}let Mh=(()=>{class r{constructor(t){this.factories=t}static create(t,n){if(null!=n){const i=n.factories.slice();t=t.concat(i)}return new r(t)}static extend(t){return{provide:r,useFactory:n=>r.create(t,n||pC()),deps:[[r,new ma,new ui]]}}find(t){const n=this.factories.find(i=>i.supports(t));if(null!=n)return n;throw new ft(901,"")}}return r.\u0275prov=Ke({token:r,providedIn:"root",factory:pC}),r})();const uF=nC(null,"core",[]);let hF=(()=>{class r{constructor(t){}}return r.\u0275fac=function(t){return new(t||r)(Le(Qp))},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({}),r})(),_h=null;function Ks(){return _h}const qt=new Ge("DocumentToken");let Po=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:function(){return function pF(){return Le(EC)}()},providedIn:"platform"}),r})();const mF=new Ge("Location Initialized");let EC=(()=>{class r extends Po{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ks().getBaseHref(this._doc)}onPopState(t){const n=Ks().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){const n=Ks().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,n,i){yC()?this._history.pushState(t,n,i):this.location.hash=i}replaceState(t,n,i){yC()?this._history.replaceState(t,n,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return r.\u0275fac=function(t){return new(t||r)(Le(qt))},r.\u0275prov=Ke({token:r,factory:function(){return function EF(){return new EC(Le(qt))}()},providedIn:"platform"}),r})();function yC(){return!!window.history.pushState}function rm(r,e){if(0==r.length)return e;if(0==e.length)return r;let t=0;return r.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?r+e.substring(1):1==t?r+e:r+"/"+e}function wC(r){const e=r.match(/#|\?|$/),t=e&&e.index||r.length;return r.slice(0,t-("/"===r[t-1]?1:0))+r.slice(t)}function ws(r){return r&&"?"!==r[0]?"?"+r:r}let ja=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:function(){return function yF(r){const e=Le(qt).location;return new vC(Le(Po),e&&e.origin||"")}()},providedIn:"root"}),r})();const im=new Ge("appBaseHref");let vC=(()=>{class r extends ja{constructor(t,n){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==n&&(n=this._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=n}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return rm(this._baseHref,t)}path(t=!1){const n=this._platformLocation.pathname+ws(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${n}${i}`:n}pushState(t,n,i,s){const o=this.prepareExternalUrl(i+ws(s));this._platformLocation.pushState(t,n,o)}replaceState(t,n,i,s){const o=this.prepareExternalUrl(i+ws(s));this._platformLocation.replaceState(t,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var n,i;null===(i=(n=this._platformLocation).historyGo)||void 0===i||i.call(n,t)}}return r.\u0275fac=function(t){return new(t||r)(Le(Po),Le(im,8))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),wF=(()=>{class r extends ja{constructor(t,n){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=n&&(this._baseHref=n)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let n=this._platformLocation.hash;return null==n&&(n="#"),n.length>0?n.substring(1):n}prepareExternalUrl(t){const n=rm(this._baseHref,t);return n.length>0?"#"+n:n}pushState(t,n,i,s){let o=this.prepareExternalUrl(i+ws(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,n,o)}replaceState(t,n,i,s){let o=this.prepareExternalUrl(i+ws(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var n,i;null===(i=(n=this._platformLocation).historyGo)||void 0===i||i.call(n,t)}}return r.\u0275fac=function(t){return new(t||r)(Le(Po),Le(im,8))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),sm=(()=>{class r{constructor(t,n){this._subject=new _t,this._urlChangeListeners=[],this._platformStrategy=t;const i=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=wC(SC(i)),this._platformStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+ws(n))}normalize(t){return r.stripTrailingSlash(function SF(r,e){return r&&e.startsWith(r)?e.substring(r.length):e}(this._baseHref,SC(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,n="",i=null){this._platformStrategy.pushState(i,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ws(n)),i)}replaceState(t,n="",i=null){this._platformStrategy.replaceState(i,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ws(n)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var n,i;null===(i=(n=this._platformStrategy).historyGo)||void 0===i||i.call(n,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}))}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(i=>i(t,n))}subscribe(t,n,i){return this._subject.subscribe({next:t,error:n,complete:i})}}return r.normalizeQueryParams=ws,r.joinWithSlash=rm,r.stripTrailingSlash=wC,r.\u0275fac=function(t){return new(t||r)(Le(ja),Le(Po))},r.\u0275prov=Ke({token:r,factory:function(){return function vF(){return new sm(Le(ja),Le(Po))}()},providedIn:"root"}),r})();function SC(r){return r.replace(/\/index.html$/,"")}class aB{constructor(e,t,n,i){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let NC=(()=>{class r{constructor(t,n,i){this._viewContainer=t,this._template=n,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const n=this._viewContainer;t.forEachOperation((i,s,o)=>{if(null==i.previousIndex)n.createEmbeddedView(this._template,new aB(i.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)n.remove(null===s?void 0:s);else if(null!==s){const a=n.get(s);n.move(a,o),DC(a,i)}});for(let i=0,s=n.length;i<s;i++){const a=n.get(i).context;a.index=i,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{DC(n.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,n){return!0}}return r.\u0275fac=function(t){return new(t||r)(De(Ei),De(ms),De(Mh))},r.\u0275dir=dn({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),r})();function DC(r,e){r.context.$implicit=e.item}let pm=(()=>{class r{constructor(t,n){this._viewContainer=t,this._context=new lB,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){LC("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){LC("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,n){return!0}}return r.\u0275fac=function(t){return new(t||r)(De(Ei),De(ms))},r.\u0275dir=dn({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),r})();class lB{constructor(){this.$implicit=null,this.ngIf=null}}function LC(r,e){if(e&&!e.createEmbeddedView)throw new Error(`${r} must be a TemplateRef, but received '${vt(e)}'.`)}let MC=(()=>{class r{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(t){if(t.ngTemplateOutlet){const n=this._viewContainerRef;this._viewRef&&n.remove(n.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?n.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return r.\u0275fac=function(t){return new(t||r)(De(Ei))},r.\u0275dir=dn({type:r,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[Vs]}),r})(),vm=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({}),r})();const FC="browser";let kB=(()=>{class r{}return r.\u0275prov=Ke({token:r,providedIn:"root",factory:()=>new GB(Le(qt),window)}),r})();class GB{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function VB(r,e){const t=r.getElementById(e)||r.getElementsByName(e)[0];if(t)return t;if("function"==typeof r.createTreeWalker&&r.body&&(r.body.createShadowRoot||r.body.attachShadow)){const n=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let i=n.currentNode;for(;i;){const s=i.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(n-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=BC(this.window.history)||BC(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function BC(r){return Object.getOwnPropertyDescriptor(r,"scrollRestoration")}class Sm extends class YB extends class gF{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function fF(r){_h||(_h=r)}(new Sm)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function UB(){return Ac=Ac||document.querySelector("base"),Ac?Ac.getAttribute("href"):null}();return null==t?null:function WB(r){jh=jh||document.createElement("a"),jh.setAttribute("href",r);const e=jh.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Ac=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function iB(r,e){e=encodeURIComponent(e);for(const t of r.split(";")){const n=t.indexOf("="),[i,s]=-1==n?[t,""]:[t.slice(0,n),t.slice(n+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let jh,Ac=null;const kC=new Ge("TRANSITION_ID"),zB=[{provide:Yp,useFactory:function jB(r,e,t){return()=>{t.get(Up).donePromise.then(()=>{const n=Ks(),i=e.querySelectorAll(`style[ng-transition="${r}"]`);for(let s=0;s<i.length;s++)n.remove(i[s])})}},deps:[kC,qt,ar],multi:!0}];class Am{static init(){!function G1(r){qp=r}(new Am)}addToWindow(e){St.getAngularTestability=(n,i=!0)=>{const s=e.findTestabilityInTree(n,i);if(null==s)throw new Error("Could not find testability for element.");return s},St.getAllAngularTestabilities=()=>e.getAllTestabilities(),St.getAllAngularRootElements=()=>e.getAllRootElements(),St.frameworkStabilizers||(St.frameworkStabilizers=[]),St.frameworkStabilizers.push(n=>{const i=St.getAllAngularTestabilities();let s=i.length,o=!1;const a=function(l){o=o||l,s--,0==s&&n(o)};i.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,n){if(null==t)return null;const i=e.getTestability(t);return null!=i?i:n?Ks().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let KB=(()=>{class r{build(){return new XMLHttpRequest}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();const zh=new Ge("EventManagerPlugins");let Kh=(()=>{class r{constructor(t,n){this._zone=n,this._eventNameToPlugin=new Map,t.forEach(i=>i.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,n,i){return this._findPluginFor(n).addEventListener(t,n,i)}addGlobalEventListener(t,n,i){return this._findPluginFor(n).addGlobalEventListener(t,n,i)}getZone(){return this._zone}_findPluginFor(t){const n=this._eventNameToPlugin.get(t);if(n)return n;const i=this._plugins;for(let s=0;s<i.length;s++){const o=i[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return r.\u0275fac=function(t){return new(t||r)(Le(zh),Le(mn))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();class GC{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const i=Ks().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,n)}}let VC=(()=>{class r{constructor(){this._stylesSet=new Set}addStyles(t){const n=new Set;t.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),n.add(i))}),this.onStylesAdded(n)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),Rc=(()=>{class r extends VC{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,n,i){t.forEach(s=>{const o=this._doc.createElement("style");o.textContent=s,i.push(n.appendChild(o))})}addHost(t){const n=[];this._addStylesToHost(this._stylesSet,t,n),this._hostNodes.set(t,n)}removeHost(t){const n=this._hostNodes.get(t);n&&n.forEach(HC),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((n,i)=>{this._addStylesToHost(t,i,n)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(HC))}}return r.\u0275fac=function(t){return new(t||r)(Le(qt))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();function HC(r){Ks().remove(r)}const Rm={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Cm=/%COMP%/g;function Jh(r,e,t){for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?Jh(r,i,t):(i=i.replace(Cm,r),t.push(i))}return t}function WC(r){return e=>{if("__ngUnwrap__"===e)return r;!1===r(e)&&(e.preventDefault(),e.returnValue=!1)}}let Im=(()=>{class r{constructor(t,n,i){this.eventManager=t,this.sharedStylesHost=n,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new Om(t)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;switch(n.encapsulation){case Mi.Emulated:{let i=this.rendererByCompId.get(n.id);return i||(i=new ZB(this.eventManager,this.sharedStylesHost,n,this.appId),this.rendererByCompId.set(n.id,i)),i.applyToHost(t),i}case 1:case Mi.ShadowDom:return new e2(this.eventManager,this.sharedStylesHost,t,n);default:if(!this.rendererByCompId.has(n.id)){const i=Jh(n.id,n.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(n.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return r.\u0275fac=function(t){return new(t||r)(Le(Kh),Le(Rc),Le(yc))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();class Om{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(Rm[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,i){if(i){t=i+":"+t;const s=Rm[i];s?e.setAttributeNS(s,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const i=Rm[n];i?e.removeAttributeNS(i,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,i){i&(Sr.DashCase|Sr.Important)?e.style.setProperty(t,n,i&Sr.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Sr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,WC(n)):this.eventManager.addEventListener(e,t,WC(n))}}class ZB extends Om{constructor(e,t,n,i){super(e),this.component=n;const s=Jh(i+"-"+n.id,n.styles,[]);t.addStyles(s),this.contentAttr=function qB(r){return"_ngcontent-%COMP%".replace(Cm,r)}(i+"-"+n.id),this.hostAttr=function QB(r){return"_nghost-%COMP%".replace(Cm,r)}(i+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class e2 extends Om{constructor(e,t,n,i){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Jh(i.id,i.styles,[]);for(let o=0;o<s.length;o++){const a=document.createElement("style");a.textContent=s[o],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let t2=(()=>{class r extends GC{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,i){return t.addEventListener(n,i,!1),()=>this.removeEventListener(t,n,i)}removeEventListener(t,n,i){return t.removeEventListener(n,i)}}return r.\u0275fac=function(t){return new(t||r)(Le(qt))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();const zC=["alt","control","meta","shift"],r2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},KC={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},i2={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let s2=(()=>{class r extends GC{constructor(t){super(t)}supports(t){return null!=r.parseEventName(t)}addEventListener(t,n,i){const s=r.parseEventName(n),o=r.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ks().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const n=t.toLowerCase().split("."),i=n.shift();if(0===n.length||"keydown"!==i&&"keyup"!==i)return null;const s=r._normalizeKey(n.pop());let o="";if(zC.forEach(l=>{const c=n.indexOf(l);c>-1&&(n.splice(c,1),o+=l+".")}),o+=s,0!=n.length||0===s.length)return null;const a={};return a.domEventName=i,a.fullKey=o,a}static getEventFullKey(t){let n="",i=function o2(r){let e=r.key;if(null==e){if(e=r.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===r.location&&KC.hasOwnProperty(e)&&(e=KC[e]))}return r2[e]||e}(t);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),zC.forEach(s=>{s!=i&&i2[s](t)&&(n+=s+".")}),n+=i,n}static eventCallback(t,n,i){return s=>{r.getEventFullKey(s)===t&&i.runGuarded(()=>n(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return r.\u0275fac=function(t){return new(t||r)(Le(qt))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();const u2=nC(uF,"browser",[{provide:jp,useValue:FC},{provide:$R,useValue:function a2(){Sm.makeCurrent(),Am.init()},multi:!0},{provide:qt,useFactory:function c2(){return function gN(r){_f=r}(document),document},deps:[]}]),h2=[{provide:qg,useValue:"root"},{provide:Ao,useFactory:function l2(){return new Ao},deps:[]},{provide:zh,useClass:t2,multi:!0,deps:[qt,mn,jp]},{provide:zh,useClass:s2,multi:!0,deps:[qt]},{provide:Im,useClass:Im,deps:[Kh,Rc,yc]},{provide:dR,useExisting:Im},{provide:VC,useExisting:Rc},{provide:Rc,useClass:Rc,deps:[qt]},{provide:$p,useClass:$p,deps:[mn]},{provide:Kh,useClass:Kh,deps:[zh,mn]},{provide:class HB{},useClass:KB,deps:[]}];let d2=(()=>{class r{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:r,providers:[{provide:yc,useValue:t.appId},{provide:kC,useExisting:yc},zB]}}}return r.\u0275fac=function(t){return new(t||r)(Le(r,12))},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({providers:h2,imports:[vm,hF]}),r})();"undefined"!=typeof window&&window;let QC=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({}),r})();const XC=new bo("13.0.2");let Pm;try{Pm="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(r){Pm=!1}let ZC=(()=>{class r{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function BB(r){return r===FC}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Pm)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return r.\u0275fac=function(t){return new(t||r)(Le(jp))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const iI="cdk-high-contrast-black-on-white",sI="cdk-high-contrast-white-on-black",Lm="cdk-high-contrast-active";let V2=(()=>{class r{constructor(t,n){this._platform=t,this._document=n}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const n=this._document.defaultView||window,i=n&&n.getComputedStyle?n.getComputedStyle(t):null,s=(i&&i.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(Lm),t.remove(iI),t.remove(sI),this._hasCheckedHighContrastMode=!0;const n=this.getHighContrastMode();1===n?(t.add(Lm),t.add(iI)):2===n&&(t.add(Lm),t.add(sI))}}}return r.\u0275fac=function(t){return new(t||r)(Le(ZC),Le(qt))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const oI=new bo("13.0.2"),Y2=new Ge("mat-sanity-checks",{providedIn:"root",factory:function H2(){return!0}});let qh=(()=>{class r{constructor(t,n,i){this._hasDoneGlobalChecks=!1,this._document=i,t._applyBodyHighContrastModeCssClasses(),this._sanityChecks=n,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!(!function J1(){return aC=!0,oC}()||function O2(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);const n=getComputedStyle(t);n&&"none"!==n.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),t.remove()}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&oI.full!==XC.full&&console.warn("The Angular Material version ("+oI.full+") does not match the Angular CDK version ("+XC.full+").\nPlease ensure the versions of these two packages exactly match.")}}return r.\u0275fac=function(t){return new(t||r)(Le(V2),Le(Y2,8),Le(qt))},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({imports:[[QC],QC]}),r})();function U2(r,e){return class extends r{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const n=t||this.defaultColor;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),n&&this._elementRef.nativeElement.classList.add(`mat-${n}`),this._color=n)}}}const $2=["*",[["mat-toolbar-row"]]],q2=["*","mat-toolbar-row"],Q2=U2(class{constructor(r){this._elementRef=r}});let X2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=dn({type:r,selectors:[["mat-toolbar-row"]],hostAttrs:[1,"mat-toolbar-row"],exportAs:["matToolbarRow"]}),r})(),Z2=(()=>{class r extends Q2{constructor(t,n,i){super(t),this._platform=n,this._document=i}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){}}return r.\u0275fac=function(t){return new(t||r)(De(mi),De(ZC),De(qt))},r.\u0275cmp=ks({type:r,selectors:[["mat-toolbar"]],contentQueries:function(t,n,i){if(1&t&&Es(i,X2,5),2&t){let s;yi(s=wi())&&(n._toolbarRows=s)}},hostAttrs:[1,"mat-toolbar"],hostVars:4,hostBindings:function(t,n){2&t&&Io("mat-toolbar-multiple-rows",n._toolbarRows.length>0)("mat-toolbar-single-row",0===n._toolbarRows.length)},inputs:{color:"color"},exportAs:["matToolbar"],features:[tp],ngContentSelectors:q2,decls:2,vars:0,template:function(t,n){1&t&&(fp($2),Eh(0),Eh(1,1))},styles:[".cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}\n"],encapsulation:2,changeDetection:0}),r})(),ek=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({imports:[[qh],qh]}),r})();function ke(...r){return Pn(r,Dl(r))}function Oc(r,e){const t=w(r)?r:()=>r,n=i=>i.error(t());return new z(e?i=>e.schedule(n,0,i):n)}const{isArray:tk}=Array,{getPrototypeOf:nk,prototype:rk,keys:ik}=Object;const{isArray:ok}=Array;function Mm(r){return pe(e=>function ak(r,e){return ok(e)?r(...e):r(e)}(r,e))}function kn(r,e,t){const n=w(r)||e||t?{next:r,error:e,complete:t}:r;return n?ae((i,s)=>{var o;null===(o=n.subscribe)||void 0===o||o.call(n);let a=!0;i.subscribe(new ue(s,l=>{var c;null===(c=n.next)||void 0===c||c.call(n,l),s.next(l)},()=>{var l;a=!1,null===(l=n.complete)||void 0===l||l.call(n),s.complete()},l=>{var c;a=!1,null===(c=n.error)||void 0===c||c.call(n,l),s.error(l)},()=>{var l,c;a&&(null===(l=n.unsubscribe)||void 0===l||l.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):$}function Ss(r){return ae((e,t)=>{let s,n=null,i=!1;n=e.subscribe(new ue(t,void 0,void 0,o=>{s=si(r(o,Ss(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}function Ka(r,e){return w(e)?hn(r,e,1):hn(r,1)}function Do(r,e){return ae((t,n)=>{let i=0;t.subscribe(new ue(n,s=>r.call(e,s,i++)&&n.next(s)))})}let Ck=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({imports:[[qh],qh]}),r})();var Ik=h(655);function Ok(r,e){return{type:7,name:r,definitions:e,options:{}}}function bk(r,e=null){return{type:4,styles:e,timings:r}}function CI(r){return{type:6,styles:r,offset:null}}function Tk(r,e,t=null){return{type:1,expr:r,animation:e,options:t}}function Pk(){}function km(r){return null==r?Pk:function(){return this.querySelector(r)}}function Dk(){return[]}function OI(r){return null==r?Dk:function(){return this.querySelectorAll(r)}}function bI(r){return function(){return this.matches(r)}}function TI(r){return new Array(r.length)}function Zh(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}function Fk(r,e,t,n,i,s){for(var a,o=0,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],n[o]=a):t[o]=new Zh(r,s[o]);for(;o<l;++o)(a=e[o])&&(i[o]=a)}function Bk(r,e,t,n,i,s,o){var a,l,L,c={},u=e.length,S=s.length,b=new Array(u);for(a=0;a<u;++a)(l=e[a])&&(b[a]=L="$"+o.call(l,l.__data__,a,e),L in c?i[a]=l:c[L]=l);for(a=0;a<S;++a)(l=c[L="$"+o.call(r,s[a],a,s)])?(n[a]=l,l.__data__=s[a],c[L]=null):t[a]=new Zh(r,s[a]);for(a=0;a<u;++a)(l=e[a])&&c[b[a]]===l&&(i[a]=l)}function Wk(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}Zh.prototype={constructor:Zh,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};var Gm="http://www.w3.org/1999/xhtml";const NI={svg:"http://www.w3.org/2000/svg",xhtml:Gm,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ed(r){var e=r+="",t=e.indexOf(":");return t>=0&&"xmlns"!==(e=r.slice(0,t))&&(r=r.slice(t+1)),NI.hasOwnProperty(e)?{space:NI[e],local:r}:r}function Qk(r){return function(){this.removeAttribute(r)}}function Xk(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Zk(r,e){return function(){this.setAttribute(r,e)}}function eG(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function tG(r,e){return function(){var t=e.apply(this,arguments);null==t?this.removeAttribute(r):this.setAttribute(r,t)}}function nG(r,e){return function(){var t=e.apply(this,arguments);null==t?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,t)}}function DI(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function iG(r){return function(){this.style.removeProperty(r)}}function sG(r,e,t){return function(){this.style.setProperty(r,e,t)}}function oG(r,e,t){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(r):this.style.setProperty(r,n,t)}}function Ja(r,e){return r.style.getPropertyValue(e)||DI(r).getComputedStyle(r,null).getPropertyValue(e)}function lG(r){return function(){delete this[r]}}function cG(r,e){return function(){this[r]=e}}function uG(r,e){return function(){var t=e.apply(this,arguments);null==t?delete this[r]:this[r]=t}}function LI(r){return r.trim().split(/^|\s+/)}function Vm(r){return r.classList||new xI(r)}function xI(r){this._node=r,this._names=LI(r.getAttribute("class")||"")}function MI(r,e){for(var t=Vm(r),n=-1,i=e.length;++n<i;)t.add(e[n])}function _I(r,e){for(var t=Vm(r),n=-1,i=e.length;++n<i;)t.remove(e[n])}function dG(r){return function(){MI(this,r)}}function fG(r){return function(){_I(this,r)}}function gG(r,e){return function(){(e.apply(this,arguments)?MI:_I)(this,r)}}function mG(){this.textContent=""}function EG(r){return function(){this.textContent=r}}function yG(r){return function(){var e=r.apply(this,arguments);this.textContent=null==e?"":e}}function vG(){this.innerHTML=""}function SG(r){return function(){this.innerHTML=r}}function AG(r){return function(){var e=r.apply(this,arguments);this.innerHTML=null==e?"":e}}function CG(){this.nextSibling&&this.parentNode.appendChild(this)}function OG(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function TG(r){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Gm&&e.documentElement.namespaceURI===Gm?e.createElement(r):e.createElementNS(t,r)}}function PG(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function FI(r){var e=ed(r);return(e.local?PG:TG)(e)}function DG(){return null}function xG(){var r=this.parentNode;r&&r.removeChild(this)}function _G(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function FG(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}xI.prototype={add:function(r){this._names.indexOf(r)<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};var BI={},xo=null;function VG(r,e,t){return r=kI(r,e,t),function(n){var i=n.relatedTarget;(!i||i!==this&&!(8&i.compareDocumentPosition(this)))&&r.call(this,n)}}function kI(r,e,t){return function(n){var i=xo;xo=n;try{r.call(this,this.__data__,e,t)}finally{xo=i}}}function HG(r){return r.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function YG(r){return function(){var e=this.__on;if(e){for(var s,t=0,n=-1,i=e.length;t<i;++t)s=e[t],r.type&&s.type!==r.type||s.name!==r.name?e[++n]=s:this.removeEventListener(s.type,s.listener,s.capture);++n?e.length=n:delete this.__on}}}function UG(r,e,t){var n=BI.hasOwnProperty(r.type)?VG:kI;return function(i,s,o){var l,a=this.__on,c=n(e,s,o);if(a)for(var u=0,S=a.length;u<S;++u)if((l=a[u]).type===r.type&&l.name===r.name)return this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=t),void(l.value=e);this.addEventListener(r.type,c,t),l={type:r.type,name:r.name,value:e,listener:c,capture:t},a?a.push(l):this.__on=[l]}}function GI(r,e,t){var n=DI(r),i=n.CustomEvent;"function"==typeof i?i=new i(e,t):(i=n.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),r.dispatchEvent(i)}function jG(r,e){return function(){return GI(this,r,e)}}function zG(r,e){return function(){return GI(this,r,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(BI={mouseenter:"mouseover",mouseleave:"mouseout"}));var VI=[null];function Ir(r,e){this._groups=r,this._parents=e}function HI(){return new Ir([[document.documentElement]],VI)}Ir.prototype=HI.prototype={constructor:Ir,select:function Nk(r){"function"!=typeof r&&(r=km(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var l,c,s=e[i],o=s.length,a=n[i]=new Array(o),u=0;u<o;++u)(l=s[u])&&(c=r.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new Ir(n,this._parents)},selectAll:function Lk(r){"function"!=typeof r&&(r=OI(r));for(var e=this._groups,t=e.length,n=[],i=[],s=0;s<t;++s)for(var l,o=e[s],a=o.length,c=0;c<a;++c)(l=o[c])&&(n.push(r.call(l,l.__data__,c,o)),i.push(l));return new Ir(n,i)},filter:function xk(r){"function"!=typeof r&&(r=bI(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var l,s=e[i],o=s.length,a=n[i]=[],c=0;c<o;++c)(l=s[c])&&r.call(l,l.__data__,c,s)&&a.push(l);return new Ir(n,this._parents)},data:function kk(r,e){if(!r)return L=new Array(this.size()),c=-1,this.each(function(Je){L[++c]=Je}),L;var t=e?Bk:Fk,n=this._parents,i=this._groups;"function"!=typeof r&&(r=function _k(r){return function(){return r}}(r));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=n[c],S=i[c],b=S.length,L=r.call(u,u&&u.__data__,c,n),F=L.length,G=a[c]=new Array(F),J=o[c]=new Array(F);t(u,S,G,J,l[c]=new Array(b),L,e);for(var Ce,be,ie=0,he=0;ie<F;++ie)if(Ce=G[ie]){for(ie>=he&&(he=ie+1);!(be=J[he])&&++he<F;);Ce._next=be||null}}return(o=new Ir(o,n))._enter=a,o._exit=l,o},enter:function Mk(){return new Ir(this._enter||this._groups.map(TI),this._parents)},exit:function Gk(){return new Ir(this._exit||this._groups.map(TI),this._parents)},join:function Vk(r,e,t){var n=this.enter(),i=this,s=this.exit();return n="function"==typeof r?r(n):n.append(r+""),null!=e&&(i=e(i)),null==t?s.remove():t(s),n&&i?n.merge(i).order():i},merge:function Hk(r){for(var e=this._groups,t=r._groups,n=e.length,s=Math.min(n,t.length),o=new Array(n),a=0;a<s;++a)for(var b,l=e[a],c=t[a],u=l.length,S=o[a]=new Array(u),L=0;L<u;++L)(b=l[L]||c[L])&&(S[L]=b);for(;a<n;++a)o[a]=e[a];return new Ir(o,this._parents)},order:function Yk(){for(var r=this._groups,e=-1,t=r.length;++e<t;)for(var o,n=r[e],i=n.length-1,s=n[i];--i>=0;)(o=n[i])&&(s&&4^o.compareDocumentPosition(s)&&s.parentNode.insertBefore(o,s),s=o);return this},sort:function Uk(r){function e(S,b){return S&&b?r(S.__data__,b.__data__):!S-!b}r||(r=Wk);for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s){for(var c,o=t[s],a=o.length,l=i[s]=new Array(a),u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new Ir(i,this._parents).order()},call:function jk(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this},nodes:function zk(){var r=new Array(this.size()),e=-1;return this.each(function(){r[++e]=this}),r},node:function Kk(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var n=r[e],i=0,s=n.length;i<s;++i){var o=n[i];if(o)return o}return null},size:function Jk(){var r=0;return this.each(function(){++r}),r},empty:function $k(){return!this.node()},each:function qk(r){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var a,i=e[t],s=0,o=i.length;s<o;++s)(a=i[s])&&r.call(a,a.__data__,s,i);return this},attr:function rG(r,e){var t=ed(r);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((null==e?t.local?Xk:Qk:"function"==typeof e?t.local?nG:tG:t.local?eG:Zk)(t,e))},style:function aG(r,e,t){return arguments.length>1?this.each((null==e?iG:"function"==typeof e?oG:sG)(r,e,null==t?"":t)):Ja(this.node(),r)},property:function hG(r,e){return arguments.length>1?this.each((null==e?lG:"function"==typeof e?uG:cG)(r,e)):this.node()[r]},classed:function pG(r,e){var t=LI(r+"");if(arguments.length<2){for(var n=Vm(this.node()),i=-1,s=t.length;++i<s;)if(!n.contains(t[i]))return!1;return!0}return this.each(("function"==typeof e?gG:e?dG:fG)(t,e))},text:function wG(r){return arguments.length?this.each(null==r?mG:("function"==typeof r?yG:EG)(r)):this.node().textContent},html:function RG(r){return arguments.length?this.each(null==r?vG:("function"==typeof r?AG:SG)(r)):this.node().innerHTML},raise:function IG(){return this.each(CG)},lower:function bG(){return this.each(OG)},append:function NG(r){var e="function"==typeof r?r:FI(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function LG(r,e){var t="function"==typeof r?r:FI(r),n=null==e?DG:"function"==typeof e?e:km(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function MG(){return this.each(xG)},clone:function BG(r){return this.select(r?FG:_G)},datum:function kG(r){return arguments.length?this.property("__data__",r):this.node().__data__},on:function WG(r,e,t){var i,o,n=HG(r+""),s=n.length;if(!(arguments.length<2)){for(a=e?UG:YG,null==t&&(t=!1),i=0;i<s;++i)this.each(a(n[i],e,t));return this}var a=this.node().__on;if(a)for(var u,l=0,c=a.length;l<c;++l)for(i=0,u=a[l];i<s;++i)if((o=n[i]).type===u.type&&o.name===u.name)return u.value},dispatch:function KG(r,e){return this.each(("function"==typeof e?zG:jG)(r,e))}};const Pc=HI;function YI(r){return"string"==typeof r?new Ir([[document.querySelector(r)]],[document.documentElement]):new Ir([[r]],VI)}function UI(r,e,t){r._context.bezierCurveTo((2*r._x0+r._x1)/3,(2*r._y0+r._y1)/3,(r._x0+2*r._x1)/3,(r._y0+2*r._y1)/3,(r._x0+4*r._x1+e)/6,(r._y0+4*r._y1+t)/6)}function td(r){this._context=r}function JG(r){return new td(r)}function WI(r,e){this._basis=new td(r),this._beta=e}td.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:UI(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:UI(this,r,e)}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=e}},WI.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var r=this._x,e=this._y,t=r.length-1;if(t>0)for(var l,n=r[0],i=e[0],s=r[t]-n,o=e[t]-i,a=-1;++a<=t;)this._basis.point(this._beta*r[a]+(1-this._beta)*(n+(l=a/t)*s),this._beta*e[a]+(1-this._beta)*(i+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(r,e){this._x.push(+r),this._y.push(+e)}};const $G=function r(e){function t(n){return 1===e?new td(n):new WI(n,e)}return t.beta=function(n){return r(+n)},t}(.85);var Hm=Math.PI,Ym=2*Hm,Mo=1e-6,qG=Ym-Mo;function Um(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function jI(){return new Um}Um.prototype=jI.prototype={constructor:Um,moveTo:function(r,e){this._+="M"+(this._x0=this._x1=+r)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(r,e){this._+="L"+(this._x1=+r)+","+(this._y1=+e)},quadraticCurveTo:function(r,e,t,n){this._+="Q"+ +r+","+ +e+","+(this._x1=+t)+","+(this._y1=+n)},bezierCurveTo:function(r,e,t,n,i,s){this._+="C"+ +r+","+ +e+","+ +t+","+ +n+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(r,e,t,n,i){var s=this._x1,o=this._y1,a=(t=+t)-(r=+r),l=(n=+n)-(e=+e),c=s-r,u=o-e,S=c*c+u*u;if((i=+i)<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=r)+","+(this._y1=e);else if(S>Mo)if(Math.abs(u*a-l*c)>Mo&&i){var b=t-s,L=n-o,F=a*a+l*l,G=b*b+L*L,J=Math.sqrt(F),te=Math.sqrt(S),ie=i*Math.tan((Hm-Math.acos((F+S-G)/(2*J*te)))/2),he=ie/te,Ce=ie/J;Math.abs(he-1)>Mo&&(this._+="L"+(r+he*c)+","+(e+he*u)),this._+="A"+i+","+i+",0,0,"+ +(u*b>c*L)+","+(this._x1=r+Ce*a)+","+(this._y1=e+Ce*l)}else this._+="L"+(this._x1=r)+","+(this._y1=e)},arc:function(r,e,t,n,i,s){r=+r,e=+e,s=!!s;var o=(t=+t)*Math.cos(n),a=t*Math.sin(n),l=r+o,c=e+a,u=1^s,S=s?n-i:i-n;if(t<0)throw new Error("negative radius: "+t);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>Mo||Math.abs(this._y1-c)>Mo)&&(this._+="L"+l+","+c),t&&(S<0&&(S=S%Ym+Ym),S>qG?this._+="A"+t+","+t+",0,1,"+u+","+(r-o)+","+(e-a)+"A"+t+","+t+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):S>Mo&&(this._+="A"+t+","+t+",0,"+ +(S>=Hm)+","+u+","+(this._x1=r+t*Math.cos(i))+","+(this._y1=e+t*Math.sin(i))))},rect:function(r,e,t,n){this._+="M"+(this._x0=this._x1=+r)+","+(this._y0=this._y1=+e)+"h"+ +t+"v"+ +n+"h"+-t+"Z"},toString:function(){return this._}};const QG=jI;function nd(r){return function(){return r}}function zI(r){this._context=r}function XG(r){return new zI(r)}function ZG(r){return r[0]}function eV(r){return r[1]}zI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;default:this._context.lineTo(r,e)}}};var KI=Math.PI;function $I(r){return(1-Math.cos(KI*r))/2}var nV={value:function(){}};function qI(){for(var n,r=0,e=arguments.length,t={};r<e;++r){if(!(n=arguments[r]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new rd(t)}function rd(r){this._=r}function rV(r,e){return r.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}function iV(r,e){for(var i,t=0,n=r.length;t<n;++t)if((i=r[t]).name===e)return i.value}function QI(r,e,t){for(var n=0,i=r.length;n<i;++n)if(r[n].name===e){r[n]=nV,r=r.slice(0,n).concat(r.slice(n+1));break}return null!=t&&r.push({name:e,value:t}),r}rd.prototype=qI.prototype={constructor:rd,on:function(r,e){var i,t=this._,n=rV(r+"",t),s=-1,o=n.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(r=n[s]).type)t[i]=QI(t[i],r.name,e);else if(null==e)for(i in t)t[i]=QI(t[i],r.name,null);return this}for(;++s<o;)if((i=(r=n[s]).type)&&(i=iV(t[i],r.name)))return i},copy:function(){var r={},e=this._;for(var t in e)r[t]=e[t].slice();return new rd(r)},call:function(r,e){if((i=arguments.length-2)>0)for(var i,s,t=new Array(i),n=0;n<i;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(n=0,i=(s=this._[r]).length;n<i;++n)s[n].value.apply(e,t)},apply:function(r,e,t){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],i=0,s=n.length;i<s;++i)n[i].value.apply(e,t)}};const Wm=qI;var id,Lc,$a=0,Nc=0,Dc=0,sd=0,_o=0,od=0,xc="object"==typeof performance&&performance.now?performance:Date,ZI="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function qa(){return _o||(ZI(sV),_o=xc.now()+od)}function sV(){_o=0}function Mc(){this._call=this._time=this._next=null}function ad(r,e,t){var n=new Mc;return n.restart(r,e,t),n}function eO(){qa(),++$a;for(var e,r=id;r;)(e=_o-r._time)>=0&&r._call.call(null,e),r=r._next;--$a}function tO(){_o=(sd=xc.now())+od,$a=Nc=0;try{eO()}finally{$a=0,function aV(){for(var r,t,e=id,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(t=e._next,e._next=null,e=r?r._next=t:id=t);Lc=r,jm(n)}(),_o=0}}function oV(){var r=xc.now(),e=r-sd;e>1e3&&(od-=e,sd=r)}function jm(r){$a||(Nc&&(Nc=clearTimeout(Nc)),r-_o>24?(r<1/0&&(Nc=setTimeout(tO,r-xc.now()-od)),Dc&&(Dc=clearInterval(Dc))):(Dc||(sd=xc.now(),Dc=setInterval(oV,1e3)),$a=1,ZI(tO)))}function zm(r,e,t){var n=new Mc;return n.restart(function(i){n.stop(),r(i+e)},e=null==e?0:+e,t),n}Mc.prototype=ad.prototype={constructor:Mc,restart:function(r,e,t){if("function"!=typeof r)throw new TypeError("callback is not a function");t=(null==t?qa():+t)+(null==e?0:+e),!this._next&&Lc!==this&&(Lc?Lc._next=this:id=this,Lc=this),this._call=r,this._time=t,jm()},stop:function(){this._call&&(this._call=null,this._time=1/0,jm())}};var lV=Wm("start","end","cancel","interrupt"),cV=[];function ud(r,e,t,n,i,s){var o=r.__transition;if(o){if(t in o)return}else r.__transition={};!function uV(r,e,t){var i,n=r.__transition;function o(c){var u,S,b,L;if(1!==t.state)return l();for(u in n)if((L=n[u]).name===t.name){if(3===L.state)return zm(o);4===L.state?(L.state=6,L.timer.stop(),L.on.call("interrupt",r,r.__data__,L.index,L.group),delete n[u]):+u<e&&(L.state=6,L.timer.stop(),L.on.call("cancel",r,r.__data__,L.index,L.group),delete n[u])}if(zm(function(){3===t.state&&(t.state=4,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=2,t.on.call("start",r,r.__data__,t.index,t.group),2===t.state){for(t.state=3,i=new Array(b=t.tween.length),u=0,S=-1;u<b;++u)(L=t.tween[u].value.call(r,r.__data__,t.index,t.group))&&(i[++S]=L);i.length=S+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=5,1),S=-1,b=i.length;++S<b;)i[S].call(r,u);5===t.state&&(t.on.call("end",r,r.__data__,t.index,t.group),l())}function l(){for(var c in t.state=6,t.timer.stop(),delete n[e],n)return;delete r.__transition}n[e]=t,t.timer=ad(function s(c){t.state=1,t.timer.restart(o,t.delay,t.time),t.delay<=c&&o(c-t.delay)},0,t.time)}(r,t,{name:e,index:n,group:i,on:lV,tween:cV,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function $m(r,e){var t=Ri(r,e);if(t.state>0)throw new Error("too late; already scheduled");return t}function As(r,e){var t=Ri(r,e);if(t.state>3)throw new Error("too late; already running");return t}function Ri(r,e){var t=r.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Qs(r,e){return r=+r,e=+e,function(t){return r*(1-t)+e*t}}var _c,Qm,aO,hd,sO=180/Math.PI,qm={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oO(r,e,t,n,i,s){var o,a,l;return(o=Math.sqrt(r*r+e*e))&&(r/=o,e/=o),(l=r*t+e*n)&&(t-=r*l,n-=e*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),r*n<e*t&&(r=-r,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,r)*sO,skewX:Math.atan(l)*sO,scaleX:o,scaleY:a}}function lO(r,e,t,n){function i(c){return c.length?c.pop()+" ":""}return function(c,u){var S=[],b=[];return c=r(c),u=r(u),function s(c,u,S,b,L,F){if(c!==S||u!==b){var G=L.push("translate(",null,e,null,t);F.push({i:G-4,x:Qs(c,S)},{i:G-2,x:Qs(u,b)})}else(S||b)&&L.push("translate("+S+e+b+t)}(c.translateX,c.translateY,u.translateX,u.translateY,S,b),function o(c,u,S,b){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),b.push({i:S.push(i(S)+"rotate(",null,n)-2,x:Qs(c,u)})):u&&S.push(i(S)+"rotate("+u+n)}(c.rotate,u.rotate,S,b),function a(c,u,S,b){c!==u?b.push({i:S.push(i(S)+"skewX(",null,n)-2,x:Qs(c,u)}):u&&S.push(i(S)+"skewX("+u+n)}(c.skewX,u.skewX,S,b),function l(c,u,S,b,L,F){if(c!==S||u!==b){var G=L.push(i(L)+"scale(",null,",",null,")");F.push({i:G-4,x:Qs(c,S)},{i:G-2,x:Qs(u,b)})}else(1!==S||1!==b)&&L.push(i(L)+"scale("+S+","+b+")")}(c.scaleX,c.scaleY,u.scaleX,u.scaleY,S,b),c=u=null,function(L){for(var J,F=-1,G=b.length;++F<G;)S[(J=b[F]).i]=J.x(L);return S.join("")}}}var pV=lO(function fV(r){return"none"===r?qm:(_c||(_c=document.createElement("DIV"),Qm=document.documentElement,aO=document.defaultView),_c.style.transform=r,r=aO.getComputedStyle(Qm.appendChild(_c),null).getPropertyValue("transform"),Qm.removeChild(_c),oO(+(r=r.slice(7,-1).split(","))[0],+r[1],+r[2],+r[3],+r[4],+r[5]))},"px, ","px)","deg)"),mV=lO(function gV(r){return null!=r&&(hd||(hd=document.createElementNS("http://www.w3.org/2000/svg","g")),hd.setAttribute("transform",r),r=hd.transform.baseVal.consolidate())?oO((r=r.matrix).a,r.b,r.c,r.d,r.e,r.f):qm},", ",")",")");function EV(r,e){var t,n;return function(){var i=As(this,r),s=i.tween;if(s!==t)for(var o=0,a=(n=t=s).length;o<a;++o)if(n[o].name===e){(n=n.slice()).splice(o,1);break}i.tween=n}}function yV(r,e,t){var n,i;if("function"!=typeof t)throw new Error;return function(){var s=As(this,r),o=s.tween;if(o!==n){i=(n=o).slice();for(var a={name:e,value:t},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=a;break}l===c&&i.push(a)}s.tween=i}}function Xm(r,e,t){var n=r._id;return r.each(function(){var i=As(this,n);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Ri(i,n).value[e]}}function Zm(r,e,t){r.prototype=e.prototype=t,t.constructor=r}function cO(r,e){var t=Object.create(r.prototype);for(var n in e)t[n]=e[n];return t}function Fc(){}var dd=1/.7,Qa="\\s*([+-]?\\d+)\\s*",kc="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ji="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vV=/^#([0-9a-f]{3,8})$/,SV=new RegExp("^rgb\\("+[Qa,Qa,Qa]+"\\)$"),AV=new RegExp("^rgb\\("+[ji,ji,ji]+"\\)$"),RV=new RegExp("^rgba\\("+[Qa,Qa,Qa,kc]+"\\)$"),CV=new RegExp("^rgba\\("+[ji,ji,ji,kc]+"\\)$"),IV=new RegExp("^hsl\\("+[kc,ji,ji]+"\\)$"),OV=new RegExp("^hsla\\("+[kc,ji,ji,kc]+"\\)$"),uO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function hO(){return this.rgb().formatHex()}function dO(){return this.rgb().formatRgb()}function Gc(r){var e,t;return r=(r+"").trim().toLowerCase(),(e=vV.exec(r))?(t=e[1].length,e=parseInt(e[1],16),6===t?fO(e):3===t?new Or(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===t?fd(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===t?fd(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=SV.exec(r))?new Or(e[1],e[2],e[3],1):(e=AV.exec(r))?new Or(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=RV.exec(r))?fd(e[1],e[2],e[3],e[4]):(e=CV.exec(r))?fd(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=IV.exec(r))?mO(e[1],e[2]/100,e[3]/100,1):(e=OV.exec(r))?mO(e[1],e[2]/100,e[3]/100,e[4]):uO.hasOwnProperty(r)?fO(uO[r]):"transparent"===r?new Or(NaN,NaN,NaN,0):null}function fO(r){return new Or(r>>16&255,r>>8&255,255&r,1)}function fd(r,e,t,n){return n<=0&&(r=e=t=NaN),new Or(r,e,t,n)}function TV(r){return r instanceof Fc||(r=Gc(r)),r?new Or((r=r.rgb()).r,r.g,r.b,r.opacity):new Or}function gd(r,e,t,n){return 1===arguments.length?TV(r):new Or(r,e,t,null==n?1:n)}function Or(r,e,t,n){this.r=+r,this.g=+e,this.b=+t,this.opacity=+n}function gO(){return"#"+eE(this.r)+eE(this.g)+eE(this.b)}function pO(){var r=this.opacity;return(1===(r=isNaN(r)?1:Math.max(0,Math.min(1,r)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===r?")":", "+r+")")}function eE(r){return((r=Math.max(0,Math.min(255,Math.round(r)||0)))<16?"0":"")+r.toString(16)}function mO(r,e,t,n){return n<=0?r=e=t=NaN:t<=0||t>=1?r=e=NaN:e<=0&&(r=NaN),new zi(r,e,t,n)}function EO(r){if(r instanceof zi)return new zi(r.h,r.s,r.l,r.opacity);if(r instanceof Fc||(r=Gc(r)),!r)return new zi;if(r instanceof zi)return r;var e=(r=r.rgb()).r/255,t=r.g/255,n=r.b/255,i=Math.min(e,t,n),s=Math.max(e,t,n),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(t-n)/a+6*(t<n):t===s?(n-e)/a+2:(e-t)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new zi(o,a,l,r.opacity)}function zi(r,e,t,n){this.h=+r,this.s=+e,this.l=+t,this.opacity=+n}function tE(r,e,t){return 255*(r<60?e+(t-e)*r/60:r<180?t:r<240?e+(t-e)*(240-r)/60:e)}function yO(r,e,t,n,i){var s=r*r,o=s*r;return((1-3*r+3*s-o)*e+(4-6*s+3*o)*t+(1+3*r+3*s-3*o)*n+o*i)/6}function wO(r){return function(){return r}}function SO(r,e){var t=e-r;return t?function vO(r,e){return function(t){return r+t*e}}(r,t):wO(isNaN(r)?e:r)}Zm(Fc,Gc,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:hO,formatHex:hO,formatHsl:function bV(){return EO(this).formatHsl()},formatRgb:dO,toString:dO}),Zm(Or,gd,cO(Fc,{brighter:function(r){return r=null==r?dd:Math.pow(dd,r),new Or(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=null==r?.7:Math.pow(.7,r),new Or(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gO,formatHex:gO,formatRgb:pO,toString:pO})),Zm(zi,function PV(r,e,t,n){return 1===arguments.length?EO(r):new zi(r,e,t,null==n?1:n)},cO(Fc,{brighter:function(r){return r=null==r?dd:Math.pow(dd,r),new zi(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=null==r?.7:Math.pow(.7,r),new zi(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+360*(this.h<0),e=isNaN(r)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*e,i=2*t-n;return new Or(tE(r>=240?r-240:r+120,i,n),tE(r,i,n),tE(r<120?r+240:r-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return(1===(r=isNaN(r)?1:Math.max(0,Math.min(1,r)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===r?")":", "+r+")")}}));const AO=function r(e){var t=function xV(r){return 1==(r=+r)?SO:function(e,t){return t-e?function LV(r,e,t){return r=Math.pow(r,t),e=Math.pow(e,t)-r,t=1/t,function(n){return Math.pow(r+n*e,t)}}(e,t,r):wO(isNaN(e)?t:e)}}(e);function n(i,s){var o=t((i=gd(i)).r,(s=gd(s)).r),a=t(i.g,s.g),l=t(i.b,s.b),c=SO(i.opacity,s.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return n.gamma=r,n}(1);function RO(r){return function(e){var o,a,t=e.length,n=new Array(t),i=new Array(t),s=new Array(t);for(o=0;o<t;++o)a=gd(e[o]),n[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return n=r(n),i=r(i),s=r(s),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=s(l),a+""}}}RO(function NV(r){var e=r.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),i=r[n],s=r[n+1];return yO((t-n/e)*e,n>0?r[n-1]:2*i-s,i,s,n<e-1?r[n+2]:2*s-i)}}),RO(function DV(r){var e=r.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*e);return yO((t-n/e)*e,r[(n+e-1)%e],r[n%e],r[(n+1)%e],r[(n+2)%e])}});var nE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rE=new RegExp(nE.source,"g");function FV(r,e){var n,i,s,t=nE.lastIndex=rE.lastIndex=0,o=-1,a=[],l=[];for(r+="",e+="";(n=nE.exec(r))&&(i=rE.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:Qs(n,i)})),t=rE.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?function _V(r){return function(e){return r(e)+""}}(l[0].x):function MV(r){return function(){return r}}(e):(e=l.length,function(c){for(var S,u=0;u<e;++u)a[(S=l[u]).i]=S.x(c);return a.join("")})}function CO(r,e){var t;return("number"==typeof e?Qs:e instanceof Gc?AO:(t=Gc(e))?(e=t,AO):FV)(r,e)}function BV(r){return function(){this.removeAttribute(r)}}function kV(r){return function(){this.removeAttributeNS(r.space,r.local)}}function GV(r,e,t){var n,s,i=t+"";return function(){var o=this.getAttribute(r);return o===i?null:o===n?s:s=e(n=o,t)}}function VV(r,e,t){var n,s,i=t+"";return function(){var o=this.getAttributeNS(r.space,r.local);return o===i?null:o===n?s:s=e(n=o,t)}}function HV(r,e,t){var n,i,s;return function(){var o,l,a=t(this);return null==a?void this.removeAttribute(r):(o=this.getAttribute(r))===(l=a+"")?null:o===n&&l===i?s:(i=l,s=e(n=o,a))}}function YV(r,e,t){var n,i,s;return function(){var o,l,a=t(this);return null==a?void this.removeAttributeNS(r.space,r.local):(o=this.getAttributeNS(r.space,r.local))===(l=a+"")?null:o===n&&l===i?s:(i=l,s=e(n=o,a))}}function WV(r,e){return function(t){this.setAttribute(r,e.call(this,t))}}function jV(r,e){return function(t){this.setAttributeNS(r.space,r.local,e.call(this,t))}}function zV(r,e){var t,n;function i(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&jV(r,s)),t}return i._value=e,i}function KV(r,e){var t,n;function i(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&WV(r,s)),t}return i._value=e,i}function $V(r,e){return function(){$m(this,r).delay=+e.apply(this,arguments)}}function qV(r,e){return e=+e,function(){$m(this,r).delay=e}}function XV(r,e){return function(){As(this,r).duration=+e.apply(this,arguments)}}function ZV(r,e){return e=+e,function(){As(this,r).duration=e}}function tH(r,e){if("function"!=typeof e)throw new Error;return function(){As(this,r).ease=e}}function oH(r,e,t){var n,i,s=function sH(r){return(r+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(e)?$m:As;return function(){var o=s(this,r),a=o.on;a!==n&&(i=(n=a).copy()).on(e,t),o.on=i}}var dH=Pc.prototype.constructor;function IO(r){return function(){this.style.removeProperty(r)}}function wH(r,e,t){return function(n){this.style.setProperty(r,e.call(this,n),t)}}function vH(r,e,t){var n,i;function s(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&wH(r,o,t)),n}return s._value=e,s}function IH(r){return function(e){this.textContent=r.call(this,e)}}function OH(r){var e,t;function n(){var i=r.apply(this,arguments);return i!==t&&(e=(t=i)&&IH(i)),e}return n._value=r,n}var NH=0;function Rs(r,e,t,n){this._groups=r,this._parents=e,this._name=t,this._id=n}function OO(){return++NH}var Xa=Pc.prototype;Rs.prototype=function DH(r){return Pc().transition(r)}.prototype={constructor:Rs,select:function uH(r){var e=this._name,t=this._id;"function"!=typeof r&&(r=km(r));for(var n=this._groups,i=n.length,s=new Array(i),o=0;o<i;++o)for(var u,S,a=n[o],l=a.length,c=s[o]=new Array(l),b=0;b<l;++b)(u=a[b])&&(S=r.call(u,u.__data__,b,a))&&("__data__"in u&&(S.__data__=u.__data__),c[b]=S,ud(c[b],e,t,b,c,Ri(u,t)));return new Rs(s,this._parents,e,t)},selectAll:function hH(r){var e=this._name,t=this._id;"function"!=typeof r&&(r=OI(r));for(var n=this._groups,i=n.length,s=[],o=[],a=0;a<i;++a)for(var u,l=n[a],c=l.length,S=0;S<c;++S)if(u=l[S]){for(var L,b=r.call(u,u.__data__,S,l),F=Ri(u,t),G=0,J=b.length;G<J;++G)(L=b[G])&&ud(L,e,t,G,b,F);s.push(b),o.push(u)}return new Rs(s,o,e,t)},filter:function rH(r){"function"!=typeof r&&(r=bI(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var l,s=e[i],o=s.length,a=n[i]=[],c=0;c<o;++c)(l=s[c])&&r.call(l,l.__data__,c,s)&&a.push(l);return new Rs(n,this._parents,this._name,this._id)},merge:function iH(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,t=r._groups,n=e.length,s=Math.min(n,t.length),o=new Array(n),a=0;a<s;++a)for(var b,l=e[a],c=t[a],u=l.length,S=o[a]=new Array(u),L=0;L<u;++L)(b=l[L]||c[L])&&(S[L]=b);for(;a<n;++a)o[a]=e[a];return new Rs(o,this._parents,this._name,this._id)},selection:function fH(){return new dH(this._groups,this._parents)},transition:function TH(){for(var r=this._name,e=this._id,t=OO(),n=this._groups,i=n.length,s=0;s<i;++s)for(var l,o=n[s],a=o.length,c=0;c<a;++c)if(l=o[c]){var u=Ri(l,e);ud(l,r,t,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Rs(n,this._parents,r,t)},call:Xa.call,nodes:Xa.nodes,node:Xa.node,size:Xa.size,empty:Xa.empty,each:Xa.each,on:function aH(r,e){var t=this._id;return arguments.length<2?Ri(this.node(),t).on.on(r):this.each(oH(t,r,e))},attr:function UV(r,e){var t=ed(r),n="transform"===t?mV:CO;return this.attrTween(r,"function"==typeof e?(t.local?YV:HV)(t,n,Xm(this,"attr."+r,e)):null==e?(t.local?kV:BV)(t):(t.local?VV:GV)(t,n,e))},attrTween:function JV(r,e){var t="attr."+r;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;var n=ed(r);return this.tween(t,(n.local?zV:KV)(n,e))},style:function yH(r,e,t){var n="transform"==(r+="")?pV:CO;return null==e?this.styleTween(r,function gH(r,e){var t,n,i;return function(){var s=Ja(this,r),o=(this.style.removeProperty(r),Ja(this,r));return s===o?null:s===t&&o===n?i:i=e(t=s,n=o)}}(r,n)).on("end.style."+r,IO(r)):"function"==typeof e?this.styleTween(r,function mH(r,e,t){var n,i,s;return function(){var o=Ja(this,r),a=t(this),l=a+"";return null==a&&(this.style.removeProperty(r),l=a=Ja(this,r)),o===l?null:o===n&&l===i?s:(i=l,s=e(n=o,a))}}(r,n,Xm(this,"style."+r,e))).each(function EH(r,e){var t,n,i,a,s="style."+e,o="end."+s;return function(){var l=As(this,r),c=l.on,u=null==l.value[s]?a||(a=IO(e)):void 0;(c!==t||i!==u)&&(n=(t=c).copy()).on(o,i=u),l.on=n}}(this._id,r)):this.styleTween(r,function pH(r,e,t){var n,s,i=t+"";return function(){var o=Ja(this,r);return o===i?null:o===n?s:s=e(n=o,t)}}(r,n,e),t).on("end.style."+r,null)},styleTween:function SH(r,e,t){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,vH(r,e,null==t?"":t))},text:function CH(r){return this.tween("text","function"==typeof r?function RH(r){return function(){var e=r(this);this.textContent=null==e?"":e}}(Xm(this,"text",r)):function AH(r){return function(){this.textContent=r}}(null==r?"":r+""))},textTween:function bH(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==r)return this.tween(e,null);if("function"!=typeof r)throw new Error;return this.tween(e,OH(r))},remove:function cH(){return this.on("end.remove",function lH(r){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==r)return;e&&e.removeChild(this)}}(this._id))},tween:function wV(r,e){var t=this._id;if(r+="",arguments.length<2){for(var o,n=Ri(this.node(),t).tween,i=0,s=n.length;i<s;++i)if((o=n[i]).name===r)return o.value;return null}return this.each((null==e?EV:yV)(t,r,e))},delay:function QV(r){var e=this._id;return arguments.length?this.each(("function"==typeof r?$V:qV)(e,r)):Ri(this.node(),e).delay},duration:function eH(r){var e=this._id;return arguments.length?this.each(("function"==typeof r?XV:ZV)(e,r)):Ri(this.node(),e).duration},ease:function nH(r){var e=this._id;return arguments.length?this.each(tH(e,r)):Ri(this.node(),e).ease},end:function PH(){var r,e,t=this,n=t._id,i=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0==--i&&s()}};t.each(function(){var c=As(this,n),u=c.on;u!==r&&((e=(r=u).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e})})}};var iE={time:null,delay:0,duration:250,ease:function LH(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}};function xH(r,e){for(var t;!(t=r.__transition)||!(t=t[e]);)if(!(r=r.parentNode))return iE.time=qa(),iE;return t}Pc.prototype.interrupt=function dV(r){return this.each(function(){!function hV(r,e){var n,i,o,t=r.__transition,s=!0;if(t){for(o in e=null==e?null:e+"",t)(n=t[o]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete t[o]):s=!1;s&&delete r.__transition}}(this,r)})},Pc.prototype.transition=function MH(r){var e,t;r instanceof Rs?(e=r._id,r=r._name):(e=OO(),(t=iE).time=qa(),r=null==r?null:r+"");for(var n=this._groups,i=n.length,s=0;s<i;++s)for(var l,o=n[s],a=o.length,c=0;c<a;++c)(l=o[c])&&ud(l,r,e,c,o,t||xH(l,e));return new Rs(n,this._parents,r,e)};const FH=["addListener","removeListener"],BH=["addEventListener","removeEventListener"],kH=["on","off"];function sE(r,e,t,n){if(w(t)&&(n=t,t=void 0),n)return sE(r,e,t).pipe(Mm(n));const[i,s]=function HH(r){return w(r.addEventListener)&&w(r.removeEventListener)}(r)?BH.map(o=>a=>r[o](e,a,t)):function GH(r){return w(r.addListener)&&w(r.removeListener)}(r)?FH.map(bO(r,e)):function VH(r){return w(r.on)&&w(r.off)}(r)?kH.map(bO(r,e)):[];if(!i&&Hr(r))return hn(o=>sE(o,e,t))(si(r));if(!i)throw new TypeError("Invalid event target");return new z(o=>{const a=(...l)=>o.next(1<l.length?l:l[0]);return i(a),()=>s(a)})}function bO(r,e){return t=>n=>r[t](e,n)}const pd=E(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function TO(r){return ae((e,t)=>{let n=!1;e.subscribe(new ue(t,i=>{n=!0,t.next(i)},()=>{n||t.next(r),t.complete()}))})}function PO(r=YH){return ae((e,t)=>{let n=!1;e.subscribe(new ue(t,i=>{n=!0,t.next(i)},()=>n?t.complete():t.error(r())))})}function YH(){return new pd}function Fo(r,e){const t=arguments.length>=2;return n=>n.pipe(r?Do((i,s)=>r(i,s,n)):$,Ou(1),t?TO(e):PO(()=>new pd))}class UH extends f{constructor(e,t){super()}schedule(e,t=0){return this}}const md={setInterval(...r){const{delegate:e}=md;return((null==e?void 0:e.setInterval)||setInterval)(...r)},clearInterval(r){const{delegate:e}=md;return((null==e?void 0:e.clearInterval)||clearInterval)(r)},delegate:void 0},NO={now:()=>(NO.delegate||Date).now(),delegate:void 0};class Vc{constructor(e,t=Vc.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}Vc.now=NO.now;const zH=new class jH extends Vc{constructor(e,t=Vc.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}(class WH extends UH{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,n=0){return md.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;md.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,n=!1;try{this.work(e)}catch(s){n=!0,i=s||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,d(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});function tY(r){return void 0===r}function sY(r){if(Array.isArray(r)){for(var e=0,t=Array(r.length);e<r.length;e++)t[e]=r[e];return t}return Array.from(r)}function oY(r){return Array.isArray(r)?r:Array.from(r)}function Hc(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=function(S,b){return{a:S.a*b.a+S.c*b.b,c:S.a*b.c+S.c*b.d,e:S.a*b.e+S.c*b.f+S.e,b:S.b*b.a+S.d*b.b,d:S.b*b.c+S.d*b.d,f:S.b*b.e+S.d*b.f+S.f}};switch((e=Array.isArray(e[0])?e[0]:e).length){case 0:throw new Error("no matrices provided");case 1:return e[0];case 2:return n(e[0],e[1]);default:var i=e,s=oY(i),o=s[0],a=s[1],l=s.slice(2),c=n(o,a);return Hc.apply(void 0,[c].concat(sY(l)))}}function xO(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{a:1,c:0,e:r,b:0,d:1,f:e}}"function"==typeof Symbol&&Symbol,Math,Math,Math,Math;class MO extends Map{constructor(e,t=BO){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(oE(this,e))}has(e){return super.has(oE(this,e))}set(e,t){return super.set(function _O({_intern:r,_key:e},t){const n=e(t);return r.has(n)?r.get(n):(r.set(n,t),t)}(this,e),t)}delete(e){return super.delete(function FO({_intern:r,_key:e},t){const n=e(t);return r.has(n)&&(t=r.get(n),r.delete(n)),t}(this,e))}}function oE({_intern:r,_key:e},t){const n=e(t);return r.has(n)?r.get(n):t}function BO(r){return null!==r&&"object"==typeof r?r.valueOf():r}function lY(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r)}return this}Set;const kO=Symbol("implicit");function GO(){var r=new MO,e=[],t=[],n=kO;function i(s){let o=r.get(s);if(void 0===o){if(n!==kO)return n;r.set(s,o=e.push(s)-1)}return t[o%t.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],r=new MO;for(const o of s)r.has(o)||r.set(o,e.push(o)-1);return i},i.range=function(s){return arguments.length?(t=Array.from(s),i):t.slice()},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return GO(e,t).unknown(n)},lY.apply(i,arguments),i}var el=h(9695);function cY(r,e){var t;function n(){var i,o,s=t.length,a=0,l=0;for(i=0;i<s;++i)a+=(o=t[i]).x,l+=o.y;for(a=a/s-r,l=l/s-e,i=0;i<s;++i)(o=t[i]).x-=a,o.y-=l}return null==r&&(r=0),null==e&&(e=0),n.initialize=function(i){t=i},n.x=function(i){return arguments.length?(r=+i,n):r},n.y=function(i){return arguments.length?(e=+i,n):e},n}function yn(r){return function(){return r}}function Xs(){return 1e-6*(Math.random()-.5)}function VO(r,e,t,n){if(isNaN(e)||isNaN(t))return r;var i,S,b,L,F,G,J,te,ie,s=r._root,o={data:n},a=r._x0,l=r._y0,c=r._x1,u=r._y1;if(!s)return r._root=o,r;for(;s.length;)if((G=e>=(S=(a+c)/2))?a=S:c=S,(J=t>=(b=(l+u)/2))?l=b:u=b,i=s,!(s=s[te=J<<1|G]))return i[te]=o,r;if(L=+r._x.call(null,s.data),F=+r._y.call(null,s.data),e===L&&t===F)return o.next=s,i?i[te]=o:r._root=o,r;do{i=i?i[te]=new Array(4):r._root=new Array(4),(G=e>=(S=(a+c)/2))?a=S:c=S,(J=t>=(b=(l+u)/2))?l=b:u=b}while((te=J<<1|G)==(ie=(F>=b)<<1|L>=S));return i[ie]=s,i[te]=o,r}function Zn(r,e,t,n,i){this.node=r,this.x0=e,this.y0=t,this.x1=n,this.y1=i}function AY(r){return r[0]}function CY(r){return r[1]}function aE(r,e,t){var n=new lE(null==e?AY:e,null==t?CY:t,NaN,NaN,NaN,NaN);return null==r?n:n.addAll(r)}function lE(r,e,t,n,i,s){this._x=r,this._y=e,this._x0=t,this._y0=n,this._x1=i,this._y1=s,this._root=void 0}function HO(r){for(var e={data:r.data},t=e;r=r.next;)t=t.next={data:r.data};return e}var er=aE.prototype=lE.prototype;function OY(r){return r.x+r.vx}function bY(r){return r.y+r.vy}function YO(r){var e,t,n=1,i=1;function s(){for(var l,u,S,b,L,F,G,c=e.length,J=0;J<i;++J)for(u=aE(e,OY,bY).visitAfter(o),l=0;l<c;++l)G=(F=t[(S=e[l]).index])*F,b=S.x+S.vx,L=S.y+S.vy,u.visit(te);function te(ie,he,Ce,be,Je){var rt=ie.data,zn=ie.r,zt=F+zn;if(!rt)return he>b+zt||be<b-zt||Ce>L+zt||Je<L-zt;if(rt.index>S.index){var ri=b-rt.x-rt.vx,ii=L-rt.y-rt.vy,Vr=ri*ri+ii*ii;Vr<zt*zt&&(0===ri&&(Vr+=(ri=Xs())*ri),0===ii&&(Vr+=(ii=Xs())*ii),Vr=(zt-(Vr=Math.sqrt(Vr)))/Vr*n,S.vx+=(ri*=Vr)*(zt=(zn*=zn)/(G+zn)),S.vy+=(ii*=Vr)*zt,rt.vx-=ri*(zt=1-zt),rt.vy-=ii*zt)}}}function o(l){if(l.data)return l.r=t[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function a(){if(e){var l,u,c=e.length;for(t=new Array(c),l=0;l<c;++l)t[(u=e[l]).index]=+r(u,l,e)}}return"function"!=typeof r&&(r=yn(null==r?1:+r)),s.initialize=function(l){e=l,a()},s.iterations=function(l){return arguments.length?(i=+l,s):i},s.strength=function(l){return arguments.length?(n=+l,s):n},s.radius=function(l){return arguments.length?(r="function"==typeof l?l:yn(+l),a(),s):r},s}er.copy=function(){var t,n,r=new lE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root;if(!e)return r;if(!e.length)return r._root=HO(e),r;for(t=[{source:e,target:r._root=new Array(4)}];e=t.pop();)for(var i=0;i<4;++i)(n=e.source[i])&&(n.length?t.push({source:n,target:e.target[i]=new Array(4)}):e.target[i]=HO(n));return r},er.add=function uY(r){var e=+this._x.call(null,r),t=+this._y.call(null,r);return VO(this.cover(e,t),e,t,r)},er.addAll=function hY(r){var e,t,i,s,n=r.length,o=new Array(n),a=new Array(n),l=1/0,c=1/0,u=-1/0,S=-1/0;for(t=0;t<n;++t)isNaN(i=+this._x.call(null,e=r[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=i,a[t]=s,i<l&&(l=i),i>u&&(u=i),s<c&&(c=s),s>S&&(S=s));if(l>u||c>S)return this;for(this.cover(l,c).cover(u,S),t=0;t<n;++t)VO(this,o[t],a[t],r[t]);return this},er.cover=function dY(r,e){if(isNaN(r=+r)||isNaN(e=+e))return this;var t=this._x0,n=this._y0,i=this._x1,s=this._y1;if(isNaN(t))i=(t=Math.floor(r))+1,s=(n=Math.floor(e))+1;else{for(var l,c,o=i-t,a=this._root;t>r||r>=i||n>e||e>=s;)switch(c=(e<n)<<1|r<t,l=new Array(4),l[c]=a,a=l,o*=2,c){case 0:i=t+o,s=n+o;break;case 1:t=i-o,s=n+o;break;case 2:i=t+o,n=s-o;break;case 3:t=i-o,n=s-o}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=n,this._x1=i,this._y1=s,this},er.data=function fY(){var r=[];return this.visit(function(e){if(!e.length)do{r.push(e.data)}while(e=e.next)}),r},er.extent=function gY(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},er.find=function pY(r,e,t){var n,o,a,l,c,F,G,i=this._x0,s=this._y0,u=this._x1,S=this._y1,b=[],L=this._root;for(L&&b.push(new Zn(L,i,s,u,S)),null==t?t=1/0:(i=r-t,s=e-t,u=r+t,S=e+t,t*=t);F=b.pop();)if(!(!(L=F.node)||(o=F.x0)>u||(a=F.y0)>S||(l=F.x1)<i||(c=F.y1)<s))if(L.length){var J=(o+l)/2,te=(a+c)/2;b.push(new Zn(L[3],J,te,l,c),new Zn(L[2],o,te,J,c),new Zn(L[1],J,a,l,te),new Zn(L[0],o,a,J,te)),(G=(e>=te)<<1|r>=J)&&(F=b[b.length-1],b[b.length-1]=b[b.length-1-G],b[b.length-1-G]=F)}else{var ie=r-+this._x.call(null,L.data),he=e-+this._y.call(null,L.data),Ce=ie*ie+he*he;if(Ce<t){var be=Math.sqrt(t=Ce);i=r-be,s=e-be,u=r+be,S=e+be,n=L.data}}return n},er.remove=function mY(r){if(isNaN(u=+this._x.call(null,r))||isNaN(S=+this._y.call(null,r)))return this;var e,n,i,s,u,S,b,L,F,G,J,te,t=this._root,o=this._x0,a=this._y0,l=this._x1,c=this._y1;if(!t)return this;if(t.length)for(;;){if((F=u>=(b=(o+l)/2))?o=b:l=b,(G=S>=(L=(a+c)/2))?a=L:c=L,e=t,!(t=t[J=G<<1|F]))return this;if(!t.length)break;(e[J+1&3]||e[J+2&3]||e[J+3&3])&&(n=e,te=J)}for(;t.data!==r;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[J]=s:delete e[J],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[te]=t:this._root=t),this):(this._root=s,this)},er.removeAll=function EY(r){for(var e=0,t=r.length;e<t;++e)this.remove(r[e]);return this},er.root=function yY(){return this._root},er.size=function wY(){var r=0;return this.visit(function(e){if(!e.length)do{++r}while(e=e.next)}),r},er.visit=function vY(r){var t,i,s,o,a,l,e=[],n=this._root;for(n&&e.push(new Zn(n,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!r(n=t.node,s=t.x0,o=t.y0,a=t.x1,l=t.y1)&&n.length){var c=(s+a)/2,u=(o+l)/2;(i=n[3])&&e.push(new Zn(i,c,u,a,l)),(i=n[2])&&e.push(new Zn(i,s,u,c,l)),(i=n[1])&&e.push(new Zn(i,c,o,a,u)),(i=n[0])&&e.push(new Zn(i,s,o,c,u))}return this},er.visitAfter=function SY(r){var n,e=[],t=[];for(this._root&&e.push(new Zn(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var i=n.node;if(i.length){var s,o=n.x0,a=n.y0,l=n.x1,c=n.y1,u=(o+l)/2,S=(a+c)/2;(s=i[0])&&e.push(new Zn(s,o,a,u,S)),(s=i[1])&&e.push(new Zn(s,u,a,l,S)),(s=i[2])&&e.push(new Zn(s,o,S,u,c)),(s=i[3])&&e.push(new Zn(s,u,S,l,c))}t.push(n)}for(;n=t.pop();)r(n.node,n.x0,n.y0,n.x1,n.y1);return this},er.x=function RY(r){return arguments.length?(this._x=r,this):this._x},er.y=function IY(r){return arguments.length?(this._y=r,this):this._y};var qr="$";function Ed(){}function UO(r,e){var t=new Ed;if(r instanceof Ed)r.each(function(a,l){t.set(l,a)});else if(Array.isArray(r)){var s,n=-1,i=r.length;if(null==e)for(;++n<i;)t.set(n,r[n]);else for(;++n<i;)t.set(e(s=r[n],n,r),s)}else if(r)for(var o in r)t.set(o,r[o]);return t}Ed.prototype=UO.prototype={constructor:Ed,has:function(r){return qr+r in this},get:function(r){return this[qr+r]},set:function(r,e){return this[qr+r]=e,this},remove:function(r){var e=qr+r;return e in this&&delete this[e]},clear:function(){for(var r in this)r[0]===qr&&delete this[r]},keys:function(){var r=[];for(var e in this)e[0]===qr&&r.push(e.slice(1));return r},values:function(){var r=[];for(var e in this)e[0]===qr&&r.push(this[e]);return r},entries:function(){var r=[];for(var e in this)e[0]===qr&&r.push({key:e.slice(1),value:this[e]});return r},size:function(){var r=0;for(var e in this)e[0]===qr&&++r;return r},empty:function(){for(var r in this)if(r[0]===qr)return!1;return!0},each:function(r){for(var e in this)e[0]===qr&&r(this[e],e.slice(1),this)}};const cE=UO;function yd(){}var Bo=cE.prototype;function DY(r){return r.index}function zO(r,e){var t=r.get(e);if(!t)throw new Error("missing: "+e);return t}function KO(r){var n,s,o,a,l,e=DY,t=function u(G){return 1/Math.min(a[G.source.index],a[G.target.index])},i=yn(30),c=1;function S(G){for(var J=0,te=r.length;J<c;++J)for(var he,Ce,be,Je,rt,zn,zt,ie=0;ie<te;++ie)Je=(be=(he=r[ie]).target).x+be.vx-(Ce=he.source).x-Ce.vx||Xs(),rt=be.y+be.vy-Ce.y-Ce.vy||Xs(),rt*=zn=((zn=Math.sqrt(Je*Je+rt*rt))-s[ie])/zn*G*n[ie],be.vx-=(Je*=zn)*(zt=l[ie]),be.vy-=rt*zt,Ce.vx+=Je*(zt=1-zt),Ce.vy+=rt*zt}function b(){if(o){var G,he,J=o.length,te=r.length,ie=cE(o,e);for(G=0,a=new Array(J);G<te;++G)(he=r[G]).index=G,"object"!=typeof he.source&&(he.source=zO(ie,he.source)),"object"!=typeof he.target&&(he.target=zO(ie,he.target)),a[he.source.index]=(a[he.source.index]||0)+1,a[he.target.index]=(a[he.target.index]||0)+1;for(G=0,l=new Array(te);G<te;++G)l[G]=a[(he=r[G]).source.index]/(a[he.source.index]+a[he.target.index]);n=new Array(te),L(),s=new Array(te),F()}}function L(){if(o)for(var G=0,J=r.length;G<J;++G)n[G]=+t(r[G],G,r)}function F(){if(o)for(var G=0,J=r.length;G<J;++G)s[G]=+i(r[G],G,r)}return null==r&&(r=[]),S.initialize=function(G){o=G,b()},S.links=function(G){return arguments.length?(r=G,b(),S):r},S.id=function(G){return arguments.length?(e=G,S):e},S.iterations=function(G){return arguments.length?(c=+G,S):c},S.strength=function(G){return arguments.length?(t="function"==typeof G?G:yn(+G),L(),S):t},S.distance=function(G){return arguments.length?(i="function"==typeof G?G:yn(+G),F(),S):i},S}function LY(r){return r.x}function xY(r){return r.y}yd.prototype=function NY(r,e){var t=new yd;if(r instanceof yd)r.each(function(s){t.add(s)});else if(r){var n=-1,i=r.length;if(null==e)for(;++n<i;)t.add(r[n]);else for(;++n<i;)t.add(e(r[n],n,r))}return t}.prototype={constructor:yd,has:Bo.has,add:function(r){return this[qr+(r+="")]=r,this},remove:Bo.remove,clear:Bo.clear,values:Bo.keys,size:Bo.size,empty:Bo.empty,each:Bo.each};var _Y=Math.PI*(3-Math.sqrt(5));function JO(r){var e,t=1,n=.001,i=1-Math.pow(n,1/300),s=0,o=.6,a=cE(),l=ad(u),c=Wm("tick","end");function u(){S(),c.call("tick",e),t<n&&(l.stop(),c.call("end",e))}function S(F){var G,te,J=r.length;void 0===F&&(F=1);for(var ie=0;ie<F;++ie)for(t+=(s-t)*i,a.each(function(he){he(t)}),G=0;G<J;++G)null==(te=r[G]).fx?te.x+=te.vx*=o:(te.x=te.fx,te.vx=0),null==te.fy?te.y+=te.vy*=o:(te.y=te.fy,te.vy=0);return e}function b(){for(var J,F=0,G=r.length;F<G;++F){if((J=r[F]).index=F,null!=J.fx&&(J.x=J.fx),null!=J.fy&&(J.y=J.fy),isNaN(J.x)||isNaN(J.y)){var te=10*Math.sqrt(F),ie=F*_Y;J.x=te*Math.cos(ie),J.y=te*Math.sin(ie)}(isNaN(J.vx)||isNaN(J.vy))&&(J.vx=J.vy=0)}}function L(F){return F.initialize&&F.initialize(r),F}return null==r&&(r=[]),b(),e={tick:S,restart:function(){return l.restart(u),e},stop:function(){return l.stop(),e},nodes:function(F){return arguments.length?(r=F,b(),a.each(L),e):r},alpha:function(F){return arguments.length?(t=+F,e):t},alphaMin:function(F){return arguments.length?(n=+F,e):n},alphaDecay:function(F){return arguments.length?(i=+F,e):+i},alphaTarget:function(F){return arguments.length?(s=+F,e):s},velocityDecay:function(F){return arguments.length?(o=1-F,e):1-o},force:function(F,G){return arguments.length>1?(null==G?a.remove(F):a.set(F,L(G)),e):a.get(F)},find:function(F,G,J){var he,Ce,be,Je,rt,te=0,ie=r.length;for(null==J?J=1/0:J*=J,te=0;te<ie;++te)(be=(he=F-(Je=r[te]).x)*he+(Ce=G-Je.y)*Ce)<J&&(rt=Je,J=be);return rt},on:function(F,G){return arguments.length>1?(c.on(F,G),e):c.on(F)}}}function $O(){var r,e,t,i,n=yn(-30),s=1,o=1/0,a=.81;function l(b){var L,F=r.length,G=aE(r,LY,xY).visitAfter(u);for(t=b,L=0;L<F;++L)e=r[L],G.visit(S)}function c(){if(r){var b,F,L=r.length;for(i=new Array(L),b=0;b<L;++b)i[(F=r[b]).index]=+n(F,b,r)}}function u(b){var F,G,te,ie,he,L=0,J=0;if(b.length){for(te=ie=he=0;he<4;++he)(F=b[he])&&(G=Math.abs(F.value))&&(L+=F.value,J+=G,te+=G*F.x,ie+=G*F.y);b.x=te/J,b.y=ie/J}else{(F=b).x=F.data.x,F.y=F.data.y;do{L+=i[F.data.index]}while(F=F.next)}b.value=L}function S(b,L,F,G){if(!b.value)return!0;var J=b.x-e.x,te=b.y-e.y,ie=G-L,he=J*J+te*te;if(ie*ie/a<he)return he<o&&(0===J&&(he+=(J=Xs())*J),0===te&&(he+=(te=Xs())*te),he<s&&(he=Math.sqrt(s*he)),e.vx+=J*b.value*t/he,e.vy+=te*b.value*t/he),!0;if(!(b.length||he>=o)){(b.data!==e||b.next)&&(0===J&&(he+=(J=Xs())*J),0===te&&(he+=(te=Xs())*te),he<s&&(he=Math.sqrt(s*he)));do{b.data!==e&&(e.vx+=J*(ie=i[b.data.index]*t/he),e.vy+=te*ie)}while(b=b.next)}}return l.initialize=function(b){r=b,c()},l.strength=function(b){return arguments.length?(n="function"==typeof b?b:yn(+b),c(),l):n},l.distanceMin=function(b){return arguments.length?(s=b*b,l):Math.sqrt(s)},l.distanceMax=function(b){return arguments.length?(o=b*b,l):Math.sqrt(o)},l.theta=function(b){return arguments.length?(a=b*b,l):Math.sqrt(a)},l}function FY(r,e,t){var n,s,o,i=yn(.1);function a(c){for(var u=0,S=n.length;u<S;++u){var b=n[u],L=b.x-e||1e-6,F=b.y-t||1e-6,G=Math.sqrt(L*L+F*F),J=(o[u]-G)*s[u]*c/G;b.vx+=L*J,b.vy+=F*J}}function l(){if(n){var c,u=n.length;for(s=new Array(u),o=new Array(u),c=0;c<u;++c)o[c]=+r(n[c],c,n),s[c]=isNaN(o[c])?0:+i(n[c],c,n)}}return"function"!=typeof r&&(r=yn(+r)),null==e&&(e=0),null==t&&(t=0),a.initialize=function(c){n=c,l()},a.strength=function(c){return arguments.length?(i="function"==typeof c?c:yn(+c),l(),a):i},a.radius=function(c){return arguments.length?(r="function"==typeof c?c:yn(+c),l(),a):r},a.x=function(c){return arguments.length?(e=+c,a):e},a.y=function(c){return arguments.length?(t=+c,a):t},a}function BY(r){var t,n,i,e=yn(.1);function s(a){for(var u,l=0,c=t.length;l<c;++l)(u=t[l]).vx+=(i[l]-u.x)*n[l]*a}function o(){if(t){var a,l=t.length;for(n=new Array(l),i=new Array(l),a=0;a<l;++a)n[a]=isNaN(i[a]=+r(t[a],a,t))?0:+e(t[a],a,t)}}return"function"!=typeof r&&(r=yn(null==r?0:+r)),s.initialize=function(a){t=a,o()},s.strength=function(a){return arguments.length?(e="function"==typeof a?a:yn(+a),o(),s):e},s.x=function(a){return arguments.length?(r="function"==typeof a?a:yn(+a),o(),s):r},s}function kY(r){var t,n,i,e=yn(.1);function s(a){for(var u,l=0,c=t.length;l<c;++l)(u=t[l]).vy+=(i[l]-u.y)*n[l]*a}function o(){if(t){var a,l=t.length;for(n=new Array(l),i=new Array(l),a=0;a<l;++a)n[a]=isNaN(i[a]=+r(t[a],a,t))?0:+e(t[a],a,t)}}return"function"!=typeof r&&(r=yn(null==r?0:+r)),s.initialize=function(a){t=a,o()},s.strength=function(a){return arguments.length?(e="function"==typeof a?a:yn(+a),o(),s):e},s.y=function(a){return arguments.length?(r="function"==typeof a?a:yn(+a),o(),s):r},s}var GY=h(7824);function VY(r,e,t){var n=new Mc,i=e;return null==e?(n.restart(r,e,t),n):(e=+e,t=null==t?qa():+t,n.restart(function s(o){o+=i,n.restart(s,i+=e,t),r(o)},e,t),n)}const HY=["linkTemplate"],YY=["nodeTemplate"],UY=["clusterTemplate"],WY=["defsTemplate"],jY=["miniMapNodeTemplate"],zY=["nodeElement"],KY=["linkElement"];function JY(r,e){1&r&&(Jt(),zs(0,14)),2&r&&ht("ngTemplateOutlet",dt(2).defsTemplate)}function $Y(r,e){if(1&r&&(Jt(),Rr(0,"path",15)),2&r){const t=e.$implicit;on("d",t.textPath)("id",t.id)}}const Yc=function(r){return{$implicit:r}};function qY(r,e){if(1&r&&(Jt(),zs(0,20)),2&r){const t=dt().$implicit;ht("ngTemplateOutlet",dt(2).clusterTemplate)("ngTemplateOutletContext",Ua(2,Yc,t))}}function QY(r,e){if(1&r&&(Jt(),Ot(0,"g",21),Rr(1,"rect"),Ot(2,"text",22),mp(3),Mt()()),2&r){const t=dt().$implicit;pt(1),on("width",t.dimension.width)("height",t.dimension.height)("fill",null==t.data?null:t.data.color),pt(1),on("x",10)("y",t.dimension.height/2),pt(1),wh(" ",t.label," ")}}function XY(r,e){if(1&r){const t=oc();Jt(),Ot(0,"g",16,17),Cr("click",function(){const s=us(t).$implicit;return dt(2).onClick(s)}),$t(2,qY,1,4,"ng-container",18),$t(3,QY,4,6,"g",19),Mt()}if(2&r){const t=e.$implicit,n=dt(2);Io("old-node",n.animate&&n.oldClusters.has(t.id)),ht("id",t.id),on("transform",t.transform),pt(2),ht("ngIf",n.clusterTemplate),pt(1),ht("ngIf",!n.clusterTemplate)}}function ZY(r,e){if(1&r&&(Jt(),zs(0,20)),2&r){const t=dt().$implicit;ht("ngTemplateOutlet",dt(2).linkTemplate)("ngTemplateOutletContext",Ua(2,Yc,t))}}function e3(r,e){1&r&&(Jt(),Rr(0,"path",26)),2&r&&on("d",dt().$implicit.line)}function t3(r,e){if(1&r&&(Jt(),Ot(0,"g",23,24),$t(2,ZY,1,4,"ng-container",18),$t(3,e3,1,1,"path",25),Mt()),2&r){const t=e.$implicit,n=dt(2);ht("id",t.id),pt(2),ht("ngIf",n.linkTemplate),pt(1),ht("ngIf",!n.linkTemplate)}}function n3(r,e){if(1&r&&(Jt(),zs(0,20)),2&r){const t=dt().$implicit;ht("ngTemplateOutlet",dt(2).nodeTemplate)("ngTemplateOutletContext",Ua(2,Yc,t))}}function r3(r,e){if(1&r&&(Jt(),Rr(0,"circle",30)),2&r){const t=dt().$implicit;on("cx",t.dimension.width/2)("cy",t.dimension.height/2)("fill",null==t.data?null:t.data.color)}}function s3(r,e){if(1&r){const t=oc();Jt(),Ot(0,"g",27,28),Cr("click",function(){const s=us(t).$implicit;return dt(2).onClick(s)})("mousedown",function(i){const o=us(t).$implicit;return dt(2).onNodeMouseDown(i,o)}),$t(2,n3,1,4,"ng-container",18),$t(3,r3,1,3,"circle",29),Mt()}if(2&r){const t=e.$implicit,n=dt(2);Io("old-node",n.animate&&n.oldNodes.has(t.id)),ht("id",t.id),on("transform",t.transform),pt(2),ht("ngIf",n.nodeTemplate),pt(1),ht("ngIf",!n.nodeTemplate)}}function o3(r,e){if(1&r){const t=oc();Jt(),Ot(0,"g",4),Cr("touchstart",function(i){return us(t),dt().onTouchStart(i)})("touchend",function(i){return us(t),dt().onTouchEnd(i)}),Ot(1,"defs"),$t(2,JY,1,1,"ng-container",5),$t(3,$Y,1,2,"path",6),Mt(),Ot(4,"rect",7),Cr("mousedown",function(){return us(t),dt().isPanning=!0}),Mt(),Eh(5),Ot(6,"g",8),$t(7,XY,4,6,"g",9),Mt(),Ot(8,"g",10),$t(9,t3,4,3,"g",11),Mt(),Ot(10,"g",12),$t(11,s3,4,6,"g",13),Mt()()}if(2&r){const t=dt();on("transform",t.transform),pt(2),ht("ngIf",t.defsTemplate),pt(1),ht("ngForOf",t.graph.edges),pt(1),on("width",100*t.dims.width)("height",100*t.dims.height)("transform","translate("+50*(-t.dims.width||0)+","+50*(-t.dims.height||0)+")"),pt(3),ht("ngForOf",t.graph.clusters)("ngForTrackBy",t.trackNodeBy),pt(2),ht("ngForOf",t.graph.edges)("ngForTrackBy",t.trackLinkBy),pt(2),ht("ngForOf",t.graph.nodes)("ngForTrackBy",t.trackNodeBy)}}function a3(r,e){if(1&r&&(Jt(),zs(0,20)),2&r){const t=dt().$implicit;ht("ngTemplateOutlet",dt(2).miniMapNodeTemplate)("ngTemplateOutletContext",Ua(2,Yc,t))}}function l3(r,e){if(1&r&&(Jt(),zs(0,20)),2&r){const t=dt().$implicit;ht("ngTemplateOutlet",dt(2).nodeTemplate)("ngTemplateOutletContext",Ua(2,Yc,t))}}function c3(r,e){if(1&r&&(Jt(),Rr(0,"circle",30)),2&r){const t=dt().$implicit,n=dt(2);on("cx",t.dimension.width/2/n.minimapScaleCoefficient)("cy",t.dimension.height/2/n.minimapScaleCoefficient)("fill",null==t.data?null:t.data.color)}}function u3(r,e){if(1&r&&(Jt(),Ot(0,"g",36,28),$t(2,a3,1,4,"ng-container",18),$t(3,l3,1,4,"ng-container",18),$t(4,c3,1,3,"circle",29),Mt()),2&r){const t=e.$implicit,n=dt(2);Io("old-node",n.animate&&n.oldNodes.has(t.id)),ht("id",t.id),on("transform",t.transform),pt(2),ht("ngIf",n.miniMapNodeTemplate),pt(1),ht("ngIf",!n.miniMapNodeTemplate&&n.nodeTemplate),pt(1),ht("ngIf",!n.nodeTemplate&&!n.miniMapNodeTemplate)}}function h3(r,e){if(1&r){const t=oc();Jt(),Ot(0,"g",31)(1,"rect",32),Cr("mousedown",function(i){return us(t),dt().onMinimapPanTo(i)}),Mt(),Ot(2,"g")(3,"g",33),$t(4,u3,5,7,"g",34),Mt(),Ot(5,"rect",35),Cr("mousedown",function(){return us(t),dt().onMinimapDragMouseDown()}),Mt()()()}if(2&r){const t=dt();on("transform",t.minimapTransform)("clip-path","url(#"+t.minimapClipPathId+")"),pt(1),on("width",t.graphDims.width/t.minimapScaleCoefficient)("height",t.graphDims.height/t.minimapScaleCoefficient),pt(1),ac("transform","translate("+-t.minimapOffsetX/t.minimapScaleCoefficient+"px,"+-t.minimapOffsetY/t.minimapScaleCoefficient+"px)"),pt(1),ac("transform","scale("+1/t.minimapScaleCoefficient+")"),pt(1),ht("ngForOf",t.graph.nodes)("ngForTrackBy",t.trackNodeBy),pt(1),Io("panning",t.isMinimapPanning),on("transform","translate("+t.panOffsetX/t.zoomLevel/-t.minimapScaleCoefficient+","+t.panOffsetY/t.zoomLevel/-t.minimapScaleCoefficient+")")("width",t.width/t.minimapScaleCoefficient/t.zoomLevel)("height",t.height/t.minimapScaleCoefficient/t.zoomLevel)}}const f3=["*"],qO={};function Cs(){let r=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);return r=`a${r}`,qO[r]?Cs():(qO[r]=!0,r)}var tl=(()=>{return(r=tl||(tl={})).Both="both",r.Horizontal="horizontal",r.Vertical="vertical",tl;var r})(),nl=(()=>{return(r=nl||(nl={})).UpperLeft="UpperLeft",r.UpperRight="UpperRight",nl;var r})();function g3(r,e,t){t=t||{};let n,i,s,o=null,a=0;function l(){a=!1===t.leading?0:+new Date,o=null,s=r.apply(n,i)}return function(){const c=+new Date;!a&&!1===t.leading&&(a=c);const u=e-(c-a);return n=this,i=arguments,u<=0?(clearTimeout(o),o=null,a=c,s=r.apply(n,i)):!o&&!1!==t.trailing&&(o=setTimeout(l,u)),s}}function p3(r,e){return function(n,i,s){return{configurable:!0,enumerable:s.enumerable,get:function(){return Object.defineProperty(this,i,{configurable:!0,enumerable:s.enumerable,value:g3(s.value,r,e)}),this[i]}}}}let QO=[{name:"vivid",selectable:!0,group:"Ordinal",domain:["#647c8a","#3f51b5","#2196f3","#00b862","#afdf0a","#a7b61a","#f3e562","#ff9800","#ff5722","#ff4514"]},{name:"natural",selectable:!0,group:"Ordinal",domain:["#bf9d76","#e99450","#d89f59","#f2dfa7","#a5d7c6","#7794b1","#afafaf","#707160","#ba9383","#d9d5c3"]},{name:"cool",selectable:!0,group:"Ordinal",domain:["#a8385d","#7aa3e5","#a27ea8","#aae3f5","#adcded","#a95963","#8796c0","#7ed3ed","#50abcc","#ad6886"]},{name:"fire",selectable:!0,group:"Ordinal",domain:["#ff3d00","#bf360c","#ff8f00","#ff6f00","#ff5722","#e65100","#ffca28","#ffab00"]},{name:"solar",selectable:!0,group:"Continuous",domain:["#fff8e1","#ffecb3","#ffe082","#ffd54f","#ffca28","#ffc107","#ffb300","#ffa000","#ff8f00","#ff6f00"]},{name:"air",selectable:!0,group:"Continuous",domain:["#e1f5fe","#b3e5fc","#81d4fa","#4fc3f7","#29b6f6","#03a9f4","#039be5","#0288d1","#0277bd","#01579b"]},{name:"aqua",selectable:!0,group:"Continuous",domain:["#e0f7fa","#b2ebf2","#80deea","#4dd0e1","#26c6da","#00bcd4","#00acc1","#0097a7","#00838f","#006064"]},{name:"flame",selectable:!1,group:"Ordinal",domain:["#A10A28","#D3342D","#EF6D49","#FAAD67","#FDDE90","#DBED91","#A9D770","#6CBA67","#2C9653","#146738"]},{name:"ocean",selectable:!1,group:"Ordinal",domain:["#1D68FB","#33C0FC","#4AFFFE","#AFFFFF","#FFFC63","#FDBD2D","#FC8A25","#FA4F1E","#FA141B","#BA38D1"]},{name:"forest",selectable:!1,group:"Ordinal",domain:["#55C22D","#C1F33D","#3CC099","#AFFFFF","#8CFC9D","#76CFFA","#BA60FB","#EE6490","#C42A1C","#FC9F32"]},{name:"horizon",selectable:!1,group:"Ordinal",domain:["#2597FB","#65EBFD","#99FDD0","#FCEE4B","#FEFCFA","#FDD6E3","#FCB1A8","#EF6F7B","#CB96E8","#EFDEE0"]},{name:"neons",selectable:!1,group:"Ordinal",domain:["#FF3333","#FF33FF","#CC33FF","#0000FF","#33CCFF","#33FFFF","#33FF66","#CCFF33","#FFCC00","#FF6600"]},{name:"picnic",selectable:!1,group:"Ordinal",domain:["#FAC51D","#66BD6D","#FAA026","#29BB9C","#E96B56","#55ACD2","#B7332F","#2C83C9","#9166B8","#92E7E8"]},{name:"night",selectable:!1,group:"Ordinal",domain:["#2B1B5A","#501356","#183356","#28203F","#391B3C","#1E2B3C","#120634","#2D0432","#051932","#453080","#75267D","#2C507D","#4B3880","#752F7D","#35547D"]},{name:"nightLights",selectable:!1,group:"Ordinal",domain:["#4e31a5","#9c25a7","#3065ab","#57468b","#904497","#46648b","#32118d","#a00fb3","#1052a2","#6e51bd","#b63cc3","#6c97cb","#8671c1","#b455be","#7496c3"]}];class m3{constructor(e,t,n){"string"==typeof e&&(e=QO.find(i=>i.name===e)),this.colorDomain=e.domain,this.domain=t,this.customColors=n,this.scale=this.generateColorScheme(e,this.domain)}generateColorScheme(e,t){return"string"==typeof e&&(e=QO.find(n=>n.name===e)),GO().range(e.domain).domain(t)}getColor(e){if(null==e)throw new Error("Value can not be null");if("function"==typeof this.customColors)return this.customColors(e);const t=e.toString();let n;return this.customColors&&this.customColors.length>0&&(n=this.customColors.find(i=>i.name.toLowerCase()===t.toLowerCase())),n?n.value:this.scale(e)}}let y3=(()=>{class r{constructor(t,n){this.element=t,this.zone=n,this.visible=new _t,this.isVisible=!1,this.runCheck()}destroy(){clearTimeout(this.timeout)}onVisibilityChange(){this.zone.run(()=>{this.isVisible=!0,this.visible.emit(!0)})}runCheck(){const t=()=>{if(!this.element)return;const{offsetHeight:n,offsetWidth:i}=this.element.nativeElement;n&&i?(clearTimeout(this.timeout),this.onVisibilityChange()):(clearTimeout(this.timeout),this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>t(),100)}))};this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>t())})}}return r.\u0275fac=function(t){return new(t||r)(De(mi),De(mn))},r.\u0275dir=dn({type:r,selectors:[["visibility-observer"]],outputs:{visible:"visible"}}),r})();var rl=(()=>{return(r=rl||(rl={})).LEFT_TO_RIGHT="LR",r.RIGHT_TO_LEFT="RL",r.TOP_TO_BOTTOM="TB",r.BOTTOM_TO_TOM="BT",rl;var r})();function il(r){return"string"==typeof r?{id:r,x:0,y:0}:r}function ZO(r,e){return"number"==typeof e?r[e]:e}const eb={dagre:class w3{constructor(){this.defaultSettings={orientation:rl.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}run(e){this.createDagreGraph(e),el.layout(this.dagreGraph),e.edgeLabels=this.dagreGraph._edgeLabels;for(const t in this.dagreGraph._nodes){const n=this.dagreGraph._nodes[t],i=e.nodes.find(s=>s.id===n.id);i.position={x:n.x,y:n.y},i.dimension={width:n.width,height:n.height}}return e}updateEdge(e,t){const n=e.nodes.find(l=>l.id===t.source),i=e.nodes.find(l=>l.id===t.target),s=n.position.y<=i.position.y?-1:1;return t.points=[{x:n.position.x,y:n.position.y-s*(n.dimension.height/2)},{x:i.position.x,y:i.position.y+s*(i.dimension.height/2)}],e}createDagreGraph(e){const t=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new el.graphlib.Graph({compound:t.compound,multigraph:t.multigraph}),this.dagreGraph.setGraph({rankdir:t.orientation,marginx:t.marginX,marginy:t.marginY,edgesep:t.edgePadding,ranksep:t.rankPadding,nodesep:t.nodePadding,align:t.align,acyclicer:t.acyclicer,ranker:t.ranker,multigraph:t.multigraph,compound:t.compound}),this.dagreGraph.setDefaultEdgeLabel(()=>({})),this.dagreNodes=e.nodes.map(n=>{const i=Object.assign({},n);return i.width=n.dimension.width,i.height=n.dimension.height,i.x=n.position.x,i.y=n.position.y,i}),this.dagreEdges=e.edges.map(n=>{const i=Object.assign({},n);return i.id||(i.id=Cs()),i});for(const n of this.dagreNodes)n.width||(n.width=20),n.height||(n.height=30),this.dagreGraph.setNode(n.id,n);for(const n of this.dagreEdges)t.multigraph?this.dagreGraph.setEdge(n.source,n.target,n,n.id):this.dagreGraph.setEdge(n.source,n.target);return this.dagreGraph}},dagreCluster:class v3{constructor(){this.defaultSettings={orientation:rl.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}run(e){this.createDagreGraph(e),el.layout(this.dagreGraph),e.edgeLabels=this.dagreGraph._edgeLabels;const t=n=>{const i=this.dagreGraph._nodes[n.id];return Object.assign(Object.assign({},n),{position:{x:i.x,y:i.y},dimension:{width:i.width,height:i.height}})};return e.clusters=(e.clusters||[]).map(t),e.nodes=e.nodes.map(t),e}updateEdge(e,t){const n=e.nodes.find(l=>l.id===t.source),i=e.nodes.find(l=>l.id===t.target),s=n.position.y<=i.position.y?-1:1;return t.points=[{x:n.position.x,y:n.position.y-s*(n.dimension.height/2)},{x:i.position.x,y:i.position.y+s*(i.dimension.height/2)}],e}createDagreGraph(e){const t=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new el.graphlib.Graph({compound:t.compound,multigraph:t.multigraph}),this.dagreGraph.setGraph({rankdir:t.orientation,marginx:t.marginX,marginy:t.marginY,edgesep:t.edgePadding,ranksep:t.rankPadding,nodesep:t.nodePadding,align:t.align,acyclicer:t.acyclicer,ranker:t.ranker,multigraph:t.multigraph,compound:t.compound}),this.dagreGraph.setDefaultEdgeLabel(()=>({})),this.dagreNodes=e.nodes.map(n=>{const i=Object.assign({},n);return i.width=n.dimension.width,i.height=n.dimension.height,i.x=n.position.x,i.y=n.position.y,i}),this.dagreClusters=e.clusters||[],this.dagreEdges=e.edges.map(n=>{const i=Object.assign({},n);return i.id||(i.id=Cs()),i});for(const n of this.dagreNodes)this.dagreGraph.setNode(n.id,n);for(const n of this.dagreClusters)this.dagreGraph.setNode(n.id,n),n.childNodeIds.forEach(i=>{this.dagreGraph.setParent(i,n.id)});for(const n of this.dagreEdges)t.multigraph?this.dagreGraph.setEdge(n.source,n.target,n,n.id):this.dagreGraph.setEdge(n.source,n.target);return this.dagreGraph}},dagreNodesOnly:class A3{constructor(){this.defaultSettings={orientation:rl.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,curveDistance:20,multigraph:!0,compound:!0},this.settings={}}run(e){this.createDagreGraph(e),el.layout(this.dagreGraph),e.edgeLabels=this.dagreGraph._edgeLabels;for(const t in this.dagreGraph._nodes){const n=this.dagreGraph._nodes[t],i=e.nodes.find(s=>s.id===n.id);i.position={x:n.x,y:n.y},i.dimension={width:n.width,height:n.height}}for(const t of e.edges)this.updateEdge(e,t);return e}updateEdge(e,t){const n=e.nodes.find(F=>F.id===t.source),i=e.nodes.find(F=>F.id===t.target),s="BT"===this.settings.orientation||"TB"===this.settings.orientation?"y":"x",o="y"===s?"x":"y",a="y"===s?"height":"width",l=n.position[s]<=i.position[s]?-1:1,c={[o]:n.position[o],[s]:n.position[s]-l*(n.dimension[a]/2)},u={[o]:i.position[o],[s]:i.position[s]+l*(i.dimension[a]/2)},S=this.settings.curveDistance||this.defaultSettings.curveDistance;t.points=[c,{[o]:c[o],[s]:c[s]-l*S},{[o]:u[o],[s]:u[s]+l*S},u];const L=e.edgeLabels[`${t.source}\x01${t.target}\x01\0`];return L&&(L.points=t.points),e}createDagreGraph(e){const t=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new el.graphlib.Graph({compound:t.compound,multigraph:t.multigraph}),this.dagreGraph.setGraph({rankdir:t.orientation,marginx:t.marginX,marginy:t.marginY,edgesep:t.edgePadding,ranksep:t.rankPadding,nodesep:t.nodePadding,align:t.align,acyclicer:t.acyclicer,ranker:t.ranker,multigraph:t.multigraph,compound:t.compound}),this.dagreGraph.setDefaultEdgeLabel(()=>({})),this.dagreNodes=e.nodes.map(n=>{const i=Object.assign({},n);return i.width=n.dimension.width,i.height=n.dimension.height,i.x=n.position.x,i.y=n.position.y,i}),this.dagreEdges=e.edges.map(n=>{const i=Object.assign({},n);return i.id||(i.id=Cs()),i});for(const n of this.dagreNodes)n.width||(n.width=20),n.height||(n.height=30),this.dagreGraph.setNode(n.id,n);for(const n of this.dagreEdges)t.multigraph?this.dagreGraph.setEdge(n.source,n.target,n,n.id):this.dagreGraph.setEdge(n.source,n.target);return this.dagreGraph}},d3ForceDirected:class R3{constructor(){this.defaultSettings={force:JO().force("charge",$O().strength(-150)).force("collide",YO(5)),forceLink:KO().id(e=>e.id).distance(()=>100)},this.settings={},this.outputGraph$=new ye}run(e){return this.inputGraph=e,this.d3Graph={nodes:[...this.inputGraph.nodes.map(t=>Object.assign({},t))],edges:[...this.inputGraph.edges.map(t=>Object.assign({},t))]},this.outputGraph={nodes:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&this.settings.force.nodes(this.d3Graph.nodes).force("link",this.settings.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",()=>{this.outputGraph$.next(this.d3GraphToOutputGraph(this.d3Graph))}),this.outputGraph$.asObservable()}updateEdge(e,t){const n=Object.assign({},this.defaultSettings,this.settings);return n.force&&n.force.nodes(this.d3Graph.nodes).force("link",n.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",()=>{this.outputGraph$.next(this.d3GraphToOutputGraph(this.d3Graph))}),this.outputGraph$.asObservable()}d3GraphToOutputGraph(e){return this.outputGraph.nodes=this.d3Graph.nodes.map(t=>Object.assign(Object.assign({},t),{id:t.id||Cs(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:`translate(${t.x-(t.dimension&&t.dimension.width||20)/2||0}, ${t.y-(t.dimension&&t.dimension.height||20)/2||0})`})),this.outputGraph.edges=this.d3Graph.edges.map(t=>Object.assign(Object.assign({},t),{source:il(t.source).id,target:il(t.target).id,points:[{x:il(t.source).x,y:il(t.source).y},{x:il(t.target).x,y:il(t.target).y}]})),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph}onDragStart(e,t){this.settings.force.alphaTarget(.3).restart();const n=this.d3Graph.nodes.find(i=>i.id===e.id);!n||(this.draggingStart={x:t.x-n.x,y:t.y-n.y},n.fx=t.x-this.draggingStart.x,n.fy=t.y-this.draggingStart.y)}onDrag(e,t){if(!e)return;const n=this.d3Graph.nodes.find(i=>i.id===e.id);!n||(n.fx=t.x-this.draggingStart.x,n.fy=t.y-this.draggingStart.y)}onDragEnd(e,t){if(!e)return;const n=this.d3Graph.nodes.find(i=>i.id===e.id);!n||(this.settings.force.alphaTarget(0),n.fx=void 0,n.fy=void 0)}},colaForceDirected:class C3{constructor(){this.defaultSettings={force:(0,GY.d3adaptor)(Object.assign(Object.assign(Object.assign({},I),p),C)).linkDistance(150).avoidOverlaps(!0),viewDimensions:{width:600,height:600}},this.settings={},this.outputGraph$=new ye}run(e){return this.inputGraph=e,this.inputGraph.clusters||(this.inputGraph.clusters=[]),this.internalGraph={nodes:[...this.inputGraph.nodes.map(t=>Object.assign(Object.assign({},t),{width:t.dimension?t.dimension.width:20,height:t.dimension?t.dimension.height:20}))],groups:[...this.inputGraph.clusters.map(t=>({padding:5,groups:t.childNodeIds.map(n=>this.inputGraph.clusters.findIndex(i=>i.id===n)).filter(n=>n>=0),leaves:t.childNodeIds.map(n=>this.inputGraph.nodes.findIndex(i=>i.id===n)).filter(n=>n>=0)}))],links:[...this.inputGraph.edges.map(t=>{const n=this.inputGraph.nodes.findIndex(s=>t.source===s.id),i=this.inputGraph.nodes.findIndex(s=>t.target===s.id);if(-1!==n&&-1!==i)return Object.assign(Object.assign({},t),{source:n,target:i})}).filter(t=>!!t)],groupLinks:[...this.inputGraph.edges.map(t=>{const n=this.inputGraph.nodes.findIndex(s=>t.source===s.id),i=this.inputGraph.nodes.findIndex(s=>t.target===s.id);if(!(n>=0&&i>=0))return t}).filter(t=>!!t)]},this.outputGraph={nodes:[],clusters:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&(this.settings.force=this.settings.force.nodes(this.internalGraph.nodes).groups(this.internalGraph.groups).links(this.internalGraph.links).alpha(.5).on("tick",()=>{this.settings.onTickListener&&this.settings.onTickListener(this.internalGraph),this.outputGraph$.next(this.internalGraphToOutputGraph(this.internalGraph))}),this.settings.viewDimensions&&(this.settings.force=this.settings.force.size([this.settings.viewDimensions.width,this.settings.viewDimensions.height])),this.settings.forceModifierFn&&(this.settings.force=this.settings.forceModifierFn(this.settings.force)),this.settings.force.start()),this.outputGraph$.asObservable()}updateEdge(e,t){const n=Object.assign({},this.defaultSettings,this.settings);return n.force&&n.force.start(),this.outputGraph$.asObservable()}internalGraphToOutputGraph(e){return this.outputGraph.nodes=e.nodes.map(t=>Object.assign(Object.assign({},t),{id:t.id||Cs(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:`translate(${t.x-(t.dimension&&t.dimension.width||20)/2||0}, ${t.y-(t.dimension&&t.dimension.height||20)/2||0})`})),this.outputGraph.edges=e.links.map(t=>{const n=ZO(e.nodes,t.source),i=ZO(e.nodes,t.target);return Object.assign(Object.assign({},t),{source:n.id,target:i.id,points:[n.bounds.rayIntersection(i.bounds.cx(),i.bounds.cy()),i.bounds.rayIntersection(n.bounds.cx(),n.bounds.cy())]})}).concat(e.groupLinks.map(t=>{const n=e.nodes.find(a=>a.id===t.source),i=e.nodes.find(a=>a.id===t.target),s=n||e.groups.find(a=>a.id===t.source),o=i||e.groups.find(a=>a.id===t.target);return Object.assign(Object.assign({},t),{source:s.id,target:o.id,points:[s.bounds.rayIntersection(o.bounds.cx(),o.bounds.cy()),o.bounds.rayIntersection(s.bounds.cx(),s.bounds.cy())]})})),this.outputGraph.clusters=e.groups.map((t,n)=>Object.assign(Object.assign({},this.inputGraph.clusters[n]),{dimension:{width:t.bounds?t.bounds.width():20,height:t.bounds?t.bounds.height():20},position:{x:t.bounds?t.bounds.x+t.bounds.width()/2:0,y:t.bounds?t.bounds.y+t.bounds.height()/2:0}})),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph}onDragStart(e,t){const n=this.outputGraph.nodes.findIndex(s=>s.id===e.id),i=this.internalGraph.nodes[n];!i||(this.draggingStart={x:i.x-t.x,y:i.y-t.y},i.fixed=1,this.settings.force.start())}onDrag(e,t){if(!e)return;const n=this.outputGraph.nodes.findIndex(s=>s.id===e.id),i=this.internalGraph.nodes[n];!i||(i.x=this.draggingStart.x+t.x,i.y=this.draggingStart.y+t.y)}onDragEnd(e,t){if(!e)return;const n=this.outputGraph.nodes.findIndex(s=>s.id===e.id),i=this.internalGraph.nodes[n];!i||(i.fixed=0)}}};let tb=(()=>{class r{getLayout(t){if(eb[t])return new eb[t];throw new Error(`Unknown layout type '${t}'`)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),I3=(()=>{class r{constructor(){this.mouseWheelUp=new _t,this.mouseWheelDown=new _t}onMouseWheelChrome(t){this.mouseWheelFunc(t)}onMouseWheelFirefox(t){this.mouseWheelFunc(t)}onWheel(t){this.mouseWheelFunc(t)}onMouseWheelIE(t){this.mouseWheelFunc(t)}mouseWheelFunc(t){window.event&&(t=window.event);const n=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail||t.deltaY||t.deltaX)),s=t.wheelDelta?n<0:n>0;(t.wheelDelta?n>0:n<0)?this.mouseWheelUp.emit(t):s&&this.mouseWheelDown.emit(t),t.returnValue=!1,t.preventDefault&&t.preventDefault()}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=dn({type:r,selectors:[["","mouseWheel",""]],hostBindings:function(t,n){1&t&&Cr("mousewheel",function(s){return n.onMouseWheelChrome(s)})("DOMMouseScroll",function(s){return n.onMouseWheelFirefox(s)})("wheel",function(s){return n.onWheel(s)})("onmousewheel",function(s){return n.onMouseWheelIE(s)})},outputs:{mouseWheelUp:"mouseWheelUp",mouseWheelDown:"mouseWheelDown"}}),r})(),O3=(()=>{class r{constructor(t,n,i,s){this.el=t,this.zone=n,this.cd=i,this.layoutService=s,this.nodes=[],this.clusters=[],this.links=[],this.activeEntries=[],this.draggingEnabled=!0,this.panningEnabled=!0,this.panningAxis=tl.Both,this.enableZoom=!0,this.zoomSpeed=.1,this.minZoomLevel=.1,this.maxZoomLevel=4,this.autoZoom=!1,this.panOnZoom=!0,this.animate=!1,this.autoCenter=!1,this.enableTrackpadSupport=!1,this.showMiniMap=!1,this.miniMapMaxWidth=100,this.miniMapPosition=nl.UpperRight,this.scheme="cool",this.animations=!0,this.select=new _t,this.activate=new _t,this.deactivate=new _t,this.zoomChange=new _t,this.clickHandler=new _t,this.isMouseMoveCalled=!1,this.graphSubscription=new f,this.subscriptions=[],this.isPanning=!1,this.isDragging=!1,this.initialized=!1,this.graphDims={width:0,height:0},this._oldLinks=[],this.oldNodes=new Set,this.oldClusters=new Set,this.transformationMatrix={a:1,c:0,e:0,b:0,d:1,f:0},this._touchLastX=null,this._touchLastY=null,this.minimapScaleCoefficient=3,this.minimapOffsetX=0,this.minimapOffsetY=0,this.isMinimapPanning=!1,this.groupResultsBy=o=>o.label}get zoomLevel(){return this.transformationMatrix.a}set zoomLevel(t){this.zoomTo(Number(t))}get panOffsetX(){return this.transformationMatrix.e}set panOffsetX(t){this.panTo(Number(t),null)}get panOffsetY(){return this.transformationMatrix.f}set panOffsetY(t){this.panTo(null,Number(t))}ngOnInit(){this.update$&&this.subscriptions.push(this.update$.subscribe(()=>{this.update()})),this.center$&&this.subscriptions.push(this.center$.subscribe(()=>{this.center()})),this.zoomToFit$&&this.subscriptions.push(this.zoomToFit$.subscribe(()=>{this.zoomToFit()})),this.panToNode$&&this.subscriptions.push(this.panToNode$.subscribe(t=>{this.panToNodeId(t)})),this.minimapClipPathId=`minimapClip${Cs()}`}ngOnChanges(t){this.basicUpdate();const{layoutSettings:i}=t;this.setLayout(this.layout),i&&this.setLayoutSettings(this.layoutSettings),this.update()}setLayout(t){this.initialized=!1,t||(t="dagre"),"string"==typeof t&&(this.layout=this.layoutService.getLayout(t),this.setLayoutSettings(this.layoutSettings))}setLayoutSettings(t){this.layout&&"string"!=typeof this.layout&&(this.layout.settings=t)}ngOnDestroy(){this.unbindEvents(),this.visibilityObserver&&(this.visibilityObserver.visible.unsubscribe(),this.visibilityObserver.destroy());for(const t of this.subscriptions)t.unsubscribe();this.subscriptions=null}ngAfterViewInit(){this.bindWindowResizeEvent(),this.visibilityObserver=new y3(this.el,this.zone),this.visibilityObserver.visible.subscribe(this.update.bind(this)),setTimeout(()=>this.update())}update(){this.basicUpdate(),this.curve||(this.curve=$G.beta(1)),this.zone.run(()=>{this.dims=function E3({width:r,height:e}){let t=r,n=e;return t=Math.max(0,t),n=Math.max(0,n),{width:Math.floor(t),height:Math.floor(n)}}({width:this.width,height:this.height}),this.seriesDomain=this.getSeriesDomain(),this.setColors(),this.createGraph(),this.updateTransform(),this.initialized=!0})}createGraph(){this.graphSubscription.unsubscribe(),this.graphSubscription=new f;const t=n=>(n.meta||(n.meta={}),n.id||(n.id=Cs()),n.dimension?n.meta.forceDimensions=void 0===n.meta.forceDimensions||n.meta.forceDimensions:(n.dimension={width:this.nodeWidth?this.nodeWidth:30,height:this.nodeHeight?this.nodeHeight:30},n.meta.forceDimensions=!1),n.position={x:0,y:0},n.data=n.data?n.data:{},n);this.graph={nodes:this.nodes.length>0?[...this.nodes].map(t):[],clusters:this.clusters&&this.clusters.length>0?[...this.clusters].map(t):[],edges:this.links.length>0?[...this.links].map(n=>(n.id||(n.id=Cs()),n)):[]},requestAnimationFrame(()=>this.draw())}draw(){if(!this.layout||"string"==typeof this.layout)return;this.applyNodeDimensions();const t=this.layout.run(this.graph),n=t instanceof z?t:ke(t);this.graphSubscription.add(n.subscribe(i=>{this.graph=i,this.tick()})),0!==this.graph.nodes.length&&n.pipe(Fo()).subscribe(()=>this.applyNodeDimensions())}tick(){const t=new Set;this.graph.nodes.map(s=>{s.transform=`translate(${s.position.x-s.dimension.width/2||0}, ${s.position.y-s.dimension.height/2||0})`,s.data||(s.data={}),s.data.color=this.colors.getColor(this.groupResultsBy(s)),t.add(s.id)});const n=new Set;(this.graph.clusters||[]).map(s=>{s.transform=`translate(${s.position.x-s.dimension.width/2||0}, ${s.position.y-s.dimension.height/2||0})`,s.data||(s.data={}),s.data.color=this.colors.getColor(this.groupResultsBy(s)),n.add(s.id)}),setTimeout(()=>{this.oldNodes=t,this.oldClusters=n},500);const i=[];for(const s in this.graph.edgeLabels){const o=this.graph.edgeLabels[s],a=s.replace(/[^\w-]*/g,""),l=this.layout&&"string"!=typeof this.layout&&this.layout.settings&&this.layout.settings.multigraph;let c=this._oldLinks.find(l?G=>`${G.source}${G.target}${G.id}`===a:G=>`${G.source}${G.target}`===a);const u=this.graph.edges.find(l?G=>`${G.source}${G.target}${G.id}`===a:G=>`${G.source}${G.target}`===a);c?c.data&&u&&u.data&&JSON.stringify(c.data)!==JSON.stringify(u.data)&&(c.data=u.data):c=u||o,c.oldLine=c.line;const S=o.points,b=this.generateLine(S),L=Object.assign({},c);L.line=b,L.points=S,this.updateMidpointOnEdge(L,S);const F=S[Math.floor(S.length/2)];F&&(L.textTransform=`translate(${F.x||0},${F.y||0})`),L.textAngle=0,L.oldLine||(L.oldLine=L.line),this.calcDominantBaseline(L),i.push(L)}this.graph.edges=i,this.graph.edges&&(this._oldLinks=this.graph.edges.map(s=>{const o=Object.assign({},s);return o.oldLine=s.line,o})),this.updateMinimap(),this.autoZoom&&this.zoomToFit(),this.autoCenter&&this.center(),requestAnimationFrame(()=>this.redrawLines()),this.cd.markForCheck()}getMinimapTransform(){switch(this.miniMapPosition){case nl.UpperLeft:return"";case nl.UpperRight:return"translate("+(this.dims.width-this.graphDims.width/this.minimapScaleCoefficient)+",0)";default:return""}}updateGraphDims(){let t=1/0,n=-1/0,i=1/0,s=-1/0;for(let o=0;o<this.graph.nodes.length;o++){const a=this.graph.nodes[o];t=a.position.x<t?a.position.x:t,i=a.position.y<i?a.position.y:i,n=a.position.x+a.dimension.width>n?a.position.x+a.dimension.width:n,s=a.position.y+a.dimension.height>s?a.position.y+a.dimension.height:s}t-=100,i-=100,n+=100,s+=100,this.graphDims.width=n-t,this.graphDims.height=s-i,this.minimapOffsetX=t,this.minimapOffsetY=i}updateMinimap(){this.graph.nodes&&this.graph.nodes.length&&(this.updateGraphDims(),this.miniMapMaxWidth&&(this.minimapScaleCoefficient=this.graphDims.width/this.miniMapMaxWidth),this.miniMapMaxHeight&&(this.minimapScaleCoefficient=Math.max(this.minimapScaleCoefficient,this.graphDims.height/this.miniMapMaxHeight)),this.minimapTransform=this.getMinimapTransform())}applyNodeDimensions(){this.nodeElements&&this.nodeElements.length&&this.nodeElements.map(t=>{const n=t.nativeElement,i=this.graph.nodes.find(o=>o.id===n.id);if(!i)return;let s;try{if(s=n.getBBox(),!s.width||!s.height)return}catch(o){return}if(i.dimension.height=this.nodeHeight?i.dimension.height&&i.meta.forceDimensions?i.dimension.height:this.nodeHeight:i.dimension.height&&i.meta.forceDimensions?i.dimension.height:s.height,this.nodeMaxHeight&&(i.dimension.height=Math.max(i.dimension.height,this.nodeMaxHeight)),this.nodeMinHeight&&(i.dimension.height=Math.min(i.dimension.height,this.nodeMinHeight)),this.nodeWidth)i.dimension.width=i.dimension.width&&i.meta.forceDimensions?i.dimension.width:this.nodeWidth;else if(n.getElementsByTagName("text").length){let o;try{for(const a of n.getElementsByTagName("text")){const l=a.getBBox();o?(l.width>o.width&&(o.width=l.width),l.height>o.height&&(o.height=l.height)):o=l}}catch(a){return}i.dimension.width=i.dimension.width&&i.meta.forceDimensions?i.dimension.width:o.width+20}else i.dimension.width=i.dimension.width&&i.meta.forceDimensions?i.dimension.width:s.width;this.nodeMaxWidth&&(i.dimension.width=Math.max(i.dimension.width,this.nodeMaxWidth)),this.nodeMinWidth&&(i.dimension.width=Math.min(i.dimension.width,this.nodeMinWidth))})}redrawLines(t=this.animate){this.linkElements.map(n=>{const i=this.graph.edges.find(s=>s.id===n.nativeElement.id);i&&(YI(n.nativeElement).select(".line").attr("d",i.oldLine).transition().ease($I).duration(t?500:0).attr("d",i.line),YI(this.el.nativeElement).select(`#${i.id}`).attr("d",i.oldTextPath).transition().ease($I).duration(t?500:0).attr("d",i.textPath),this.updateMidpointOnEdge(i,i.points))})}calcDominantBaseline(t){const n=t.points[0],i=t.points[t.points.length-1];t.oldTextPath=t.textPath,i.x<n.x?(t.dominantBaseline="text-before-edge",t.textPath=this.generateLine([...t.points].reverse())):(t.dominantBaseline="text-after-edge",t.textPath=t.line)}generateLine(t){return function tV(){var r=ZG,e=eV,t=nd(!0),n=null,i=XG,s=null;function o(a){var l,u,b,c=a.length,S=!1;for(null==n&&(s=i(b=QG())),l=0;l<=c;++l)!(l<c&&t(u=a[l],l,a))===S&&((S=!S)?s.lineStart():s.lineEnd()),S&&s.point(+r(u,l,a),+e(u,l,a));if(b)return s=null,b+""||null}return o.x=function(a){return arguments.length?(r="function"==typeof a?a:nd(+a),o):r},o.y=function(a){return arguments.length?(e="function"==typeof a?a:nd(+a),o):e},o.defined=function(a){return arguments.length?(t="function"==typeof a?a:nd(!!a),o):t},o.curve=function(a){return arguments.length?(i=a,null!=n&&(s=i(n)),o):i},o.context=function(a){return arguments.length?(null==a?n=s=null:s=i(n=a),o):n},o}().x(i=>i.x).y(i=>i.y).curve(this.curve)(t)}onZoom(t,n){if(this.enableTrackpadSupport&&!t.ctrlKey)return void this.pan(-1*t.deltaX,-1*t.deltaY);const i=1+("in"===n?this.zoomSpeed:-this.zoomSpeed),s=this.zoomLevel*i;if(!(s<=this.minZoomLevel||s>=this.maxZoomLevel)&&this.enableZoom)if(!0===this.panOnZoom&&t){const o=t.clientX,a=t.clientY,l=this.el.nativeElement.querySelector("svg"),c=l.querySelector("g.chart"),u=l.createSVGPoint();u.x=o,u.y=a;const S=u.matrixTransform(c.getScreenCTM().inverse());this.pan(S.x,S.y,!0),this.zoom(i),this.pan(-S.x,-S.y,!0)}else this.zoom(i)}pan(t,n,i=!1){const s=i?1:this.zoomLevel;this.transformationMatrix=Hc(this.transformationMatrix,xO(t/s,n/s)),this.updateTransform()}panTo(t,n){null==t||isNaN(t)||null==n||isNaN(n)||(this.transformationMatrix=Hc(this.transformationMatrix,xO((-this.panOffsetX-t*this.zoomLevel+this.dims.width/2)/this.zoomLevel,(-this.panOffsetY-n*this.zoomLevel+this.dims.height/2)/this.zoomLevel)),this.updateTransform())}zoom(t){this.transformationMatrix=Hc(this.transformationMatrix,function nY(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return tY(e)&&(e=r),{a:r,c:0,e:0,b:0,d:e,f:0}}(t,t)),this.zoomChange.emit(this.zoomLevel),this.updateTransform()}zoomTo(t){this.transformationMatrix.a=isNaN(t)?this.transformationMatrix.a:Number(t),this.transformationMatrix.d=isNaN(t)?this.transformationMatrix.d:Number(t),this.zoomChange.emit(this.zoomLevel),this.updateTransform(),this.update()}onDrag(t){if(!this.draggingEnabled)return;const n=this.draggingNode;this.layout&&"string"!=typeof this.layout&&this.layout.onDrag&&this.layout.onDrag(n,t),n.position.x+=t.movementX/this.zoomLevel,n.position.y+=t.movementY/this.zoomLevel,n.transform=`translate(${n.position.x-n.dimension.width/2}, ${n.position.y-n.dimension.height/2})`;for(const o of this.graph.edges)if((o.target===n.id||o.source===n.id||o.target.id===n.id||o.source.id===n.id)&&this.layout&&"string"!=typeof this.layout){const a=this.layout.updateEdge(this.graph,o),l=a instanceof z?a:ke(a);this.graphSubscription.add(l.subscribe(c=>{this.graph=c,this.redrawEdge(o)}))}this.redrawLines(!1),this.updateMinimap()}redrawEdge(t){const n=this.generateLine(t.points);this.calcDominantBaseline(t),t.oldLine=t.line,t.line=n}updateTransform(){this.transform=function iY(r){return function LO(r){return"matrix("+r.a+","+r.b+","+r.c+","+r.d+","+r.e+","+r.f+")"}(r)}(function aY(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return{a:Math.round(r.a*e)/e,b:Math.round(r.b*e)/e,c:Math.round(r.c*e)/e,d:Math.round(r.d*e)/e,e:Math.round(r.e*e)/e,f:Math.round(r.f*e)/e}}(this.transformationMatrix,100))}onClick(t){this.select.emit(t)}onActivate(t){this.activeEntries.indexOf(t)>-1||(this.activeEntries=[t,...this.activeEntries],this.activate.emit({value:t,entries:this.activeEntries}))}onDeactivate(t){const n=this.activeEntries.indexOf(t);this.activeEntries.splice(n,1),this.activeEntries=[...this.activeEntries],this.deactivate.emit({value:t,entries:this.activeEntries})}getSeriesDomain(){return this.nodes.map(t=>this.groupResultsBy(t)).reduce((t,n)=>-1!==t.indexOf(n)?t:t.concat([n]),[]).sort()}trackLinkBy(t,n){return n.id}trackNodeBy(t,n){return n.id}setColors(){this.colors=new m3(this.scheme,this.seriesDomain,this.customColors)}onMouseMove(t){this.isMouseMoveCalled=!0,(this.isPanning||this.isMinimapPanning)&&this.panningEnabled?this.panWithConstraints(this.panningAxis,t):this.isDragging&&this.draggingEnabled&&this.onDrag(t)}onMouseDown(t){this.isMouseMoveCalled=!1}graphClick(t){this.isMouseMoveCalled||this.clickHandler.emit(t)}onTouchStart(t){this._touchLastX=t.changedTouches[0].clientX,this._touchLastY=t.changedTouches[0].clientY,this.isPanning=!0}onTouchMove(t){if(this.isPanning&&this.panningEnabled){const n=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,s=n-this._touchLastX,o=i-this._touchLastY;this._touchLastX=n,this._touchLastY=i,this.pan(s,o)}}onTouchEnd(t){this.isPanning=!1}onMouseUp(t){this.isDragging=!1,this.isPanning=!1,this.isMinimapPanning=!1,this.layout&&"string"!=typeof this.layout&&this.layout.onDragEnd&&this.layout.onDragEnd(this.draggingNode,t)}onNodeMouseDown(t,n){!this.draggingEnabled||(this.isDragging=!0,this.draggingNode=n,this.layout&&"string"!=typeof this.layout&&this.layout.onDragStart&&this.layout.onDragStart(n,t))}onMinimapDragMouseDown(){this.isMinimapPanning=!0}onMinimapPanTo(t){this.panTo((t.offsetX-(this.dims.width-(this.graphDims.width+this.minimapOffsetX)/this.minimapScaleCoefficient))*this.minimapScaleCoefficient,(t.offsetY+this.minimapOffsetY/this.minimapScaleCoefficient)*this.minimapScaleCoefficient),this.isMinimapPanning=!0}center(){this.panTo(this.graphDims.width/2,this.graphDims.height/2)}zoomToFit(){let i=Math.min(this.dims.height/this.graphDims.height,this.dims.width/this.graphDims.width,1);i<this.minZoomLevel&&(i=this.minZoomLevel),i>this.maxZoomLevel&&(i=this.maxZoomLevel),i!==this.zoomLevel&&(this.zoomLevel=i,this.updateTransform(),this.zoomChange.emit(this.zoomLevel))}panToNodeId(t){const n=this.graph.nodes.find(i=>i.id===t);!n||this.panTo(n.position.x,n.position.y)}panWithConstraints(t,n){let i=n.movementX,s=n.movementY;switch(this.isMinimapPanning&&(i=-this.minimapScaleCoefficient*i*this.zoomLevel,s=-this.minimapScaleCoefficient*s*this.zoomLevel),t){case tl.Horizontal:this.pan(i,0);break;case tl.Vertical:this.pan(0,s);break;default:this.pan(i,s)}}updateMidpointOnEdge(t,n){if(t&&n)if(n.length%2==1)t.midPoint=n[Math.floor(n.length/2)];else{const i=n[n.length/2],s=n[n.length/2-1];t.midPoint={x:(i.x+s.x)/2,y:(i.y+s.y)/2}}}basicUpdate(){if(this.view)this.width=this.view[0],this.height=this.view[1];else{const t=this.getContainerDims();t&&(this.width=t.width,this.height=t.height)}this.width||(this.width=600),this.height||(this.height=400),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this.cd&&this.cd.markForCheck()}getContainerDims(){let t,n;const i=this.el.nativeElement;if(null!==i.parentNode){const s=i.parentNode.getBoundingClientRect();t=s.width,n=s.height}return t&&n?{width:t,height:n}:null}unbindEvents(){this.resizeSubscription&&this.resizeSubscription.unsubscribe()}bindWindowResizeEvent(){const n=sE(window,"resize").pipe(function KH(r,e=zH){return ae((t,n)=>{let i=null,s=null,o=null;const a=()=>{if(i){i.unsubscribe(),i=null;const c=s;s=null,n.next(c)}};function l(){const c=o+r,u=e.now();if(u<c)return i=this.schedule(void 0,c-u),void n.add(i);a()}t.subscribe(new ue(n,c=>{s=c,o=e.now(),i||(i=e.schedule(l,r),n.add(i))},()=>{a(),n.complete()},void 0,()=>{s=i=null}))})}(200)).subscribe(i=>{this.update(),this.cd&&this.cd.markForCheck()});this.resizeSubscription=n}}return r.\u0275fac=function(t){return new(t||r)(De(mi),De(mn),De(Dh),De(tb))},r.\u0275cmp=ks({type:r,selectors:[["ngx-graph"]],contentQueries:function(t,n,i){if(1&t&&(Es(i,HY,5),Es(i,YY,5),Es(i,UY,5),Es(i,WY,5),Es(i,jY,5)),2&t){let s;yi(s=wi())&&(n.linkTemplate=s.first),yi(s=wi())&&(n.nodeTemplate=s.first),yi(s=wi())&&(n.clusterTemplate=s.first),yi(s=wi())&&(n.defsTemplate=s.first),yi(s=wi())&&(n.miniMapNodeTemplate=s.first)}},viewQuery:function(t,n){if(1&t&&(_p(zY,5),_p(KY,5)),2&t){let i;yi(i=wi())&&(n.nodeElements=i),yi(i=wi())&&(n.linkElements=i)}},hostBindings:function(t,n){1&t&&Cr("mousemove",function(s){return n.onMouseMove(s)},!1,wa)("mousedown",function(s){return n.onMouseDown(s)},!1,wa)("click",function(s){return n.graphClick(s)},!1,wa)("touchmove",function(s){return n.onTouchMove(s)},!1,wa)("mouseup",function(s){return n.onMouseUp(s)},!1,wa)},inputs:{nodes:"nodes",clusters:"clusters",links:"links",activeEntries:"activeEntries",curve:"curve",draggingEnabled:"draggingEnabled",nodeHeight:"nodeHeight",nodeMaxHeight:"nodeMaxHeight",nodeMinHeight:"nodeMinHeight",nodeWidth:"nodeWidth",nodeMinWidth:"nodeMinWidth",nodeMaxWidth:"nodeMaxWidth",panningEnabled:"panningEnabled",panningAxis:"panningAxis",enableZoom:"enableZoom",zoomSpeed:"zoomSpeed",minZoomLevel:"minZoomLevel",maxZoomLevel:"maxZoomLevel",autoZoom:"autoZoom",panOnZoom:"panOnZoom",animate:"animate",autoCenter:"autoCenter",update$:"update$",center$:"center$",zoomToFit$:"zoomToFit$",panToNode$:"panToNode$",layout:"layout",layoutSettings:"layoutSettings",enableTrackpadSupport:"enableTrackpadSupport",showMiniMap:"showMiniMap",miniMapMaxWidth:"miniMapMaxWidth",miniMapMaxHeight:"miniMapMaxHeight",miniMapPosition:"miniMapPosition",view:"view",scheme:"scheme",customColors:"customColors",animations:"animations",groupResultsBy:"groupResultsBy",zoomLevel:"zoomLevel",panOffsetX:"panOffsetX",panOffsetY:"panOffsetY"},outputs:{select:"select",activate:"activate",deactivate:"deactivate",zoomChange:"zoomChange",clickHandler:"clickHandler"},features:[Vs],ngContentSelectors:f3,decls:6,vars:11,consts:[["mouseWheel","",1,"ngx-charts-outer",3,"mouseWheelUp","mouseWheelDown"],[1,"ngx-charts"],["class","graph chart",3,"touchstart","touchend",4,"ngIf"],["class","minimap",4,"ngIf"],[1,"graph","chart",3,"touchstart","touchend"],[3,"ngTemplateOutlet",4,"ngIf"],["class","text-path",4,"ngFor","ngForOf"],[1,"panning-rect",3,"mousedown"],[1,"clusters"],["class","node-group",3,"old-node","id","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"links"],["class","link-group",3,"id",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nodes"],["class","node-group",3,"old-node","id","click","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngTemplateOutlet"],[1,"text-path"],[1,"node-group",3,"id","click"],["clusterElement",""],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["class","node cluster",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"node","cluster"],["alignment-baseline","central"],[1,"link-group",3,"id"],["linkElement",""],["class","edge",4,"ngIf"],[1,"edge"],[1,"node-group",3,"id","click","mousedown"],["nodeElement",""],["r","10",4,"ngIf"],["r","10"],[1,"minimap"],[1,"minimap-background",3,"mousedown"],[1,"minimap-nodes"],["class","node-group",3,"old-node","id",4,"ngFor","ngForOf","ngForTrackBy"],[1,"minimap-drag",3,"mousedown"],[1,"node-group",3,"id"]],template:function(t,n){1&t&&(fp(),Ot(0,"div",0),Cr("mouseWheelUp",function(s){return n.onZoom(s,"in")})("mouseWheelDown",function(s){return n.onZoom(s,"out")}),Jt(),Ot(1,"svg",1),$t(2,o3,12,12,"g",2),Ot(3,"clipPath"),Rr(4,"rect"),Mt(),$t(5,h3,6,15,"g",3),Mt()()),2&t&&(ac("width",n.width,"px"),ht("@animationState","active")("@.disabled",!n.animations),pt(1),on("width",n.width)("height",n.height),pt(1),ht("ngIf",n.initialized&&n.graph),pt(1),on("id",n.minimapClipPathId),pt(1),on("width",n.graphDims.width/n.minimapScaleCoefficient)("height",n.graphDims.height/n.minimapScaleCoefficient),pt(1),ht("ngIf",n.showMiniMap))},directives:[I3,pm,MC,NC],styles:[".minimap .minimap-background{fill:#0000001a}.minimap .minimap-drag{fill:#0003;stroke:#fff;stroke-width:1px;stroke-dasharray:2px;stroke-dashoffset:2px;cursor:pointer}.minimap .minimap-drag.panning{fill:#0000004d}.minimap .minimap-nodes{opacity:.5;pointer-events:none}.graph{-webkit-user-select:none;user-select:none}.graph .edge{stroke:#666;fill:none}.graph .edge .edge-label{stroke:none;font-size:12px;fill:#251e1e}.graph .panning-rect{fill:#0000;cursor:move}.graph .node-group.old-node{transition:transform .5s ease-in-out}.graph .node-group .node:focus{outline:none}.graph .cluster rect{opacity:.2}\n"],encapsulation:2,data:{animation:[Ok("animationState",[Tk(":enter",[CI({opacity:0}),bk("500ms 100ms",CI({opacity:1}))])])]},changeDetection:0}),(0,Ik.__decorate)([p3(500)],r.prototype,"updateMinimap",null),r})(),b3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({providers:[tb],imports:[[vm]]}),r})(),T3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({imports:[[vm],b3]}),r})();class Ci extends ye{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function P3(...r){const e=Dl(r),t=function By(r){return w(Ef(r))?r.pop():void 0}(r),{args:n,keys:i}=function uI(r){if(1===r.length){const e=r[0];if(tk(e))return{args:e,keys:null};if(function sk(r){return r&&"object"==typeof r&&nk(r)===rk}(e)){const t=ik(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:r,keys:null}}(r);if(0===n.length)return Pn([],e);const s=new z(function N3(r,e,t=$){return n=>{nb(e,()=>{const{length:i}=r,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)nb(e,()=>{const c=Pn(r[l],e);let u=!1;c.subscribe(new ue(n,S=>{s[l]=S,u||(u=!0,a--),a||n.next(t(s.slice()))},()=>{--o||n.complete()}))},n)},n)}}(n,e,i?o=>function hI(r,e){return r.reduce((t,n,i)=>(t[n]=e[i],t),{})}(i,o):$));return t?s.pipe(Mm(t)):s}function nb(r,e,t){r?os(t,r,e):e()}function uE(...r){return function D3(){return Nl(1)}()(Pn(r,Dl(r)))}function rb(r){return new z(e=>{si(r()).subscribe(e)})}function ib(){return ae((r,e)=>{let t=null;r._refCount++;const n=new ue(e,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount)return void(t=null);const i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}class L3 extends z{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,xe(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new f;const t=this.getSubject();e.add(this.source.subscribe(new ue(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=f.EMPTY)}return e}refCount(){return ib()(this)}}function ko(r,e){return ae((t,n)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&n.complete();t.subscribe(new ue(n,l=>{null==i||i.unsubscribe();let c=0;const u=s++;si(r(l,u)).subscribe(i=new ue(n,S=>n.next(e?e(l,S,u,c++):S),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function M3(r,e,t,n,i){return(s,o)=>{let a=t,l=e,c=0;s.subscribe(new ue(o,u=>{const S=c++;l=a?r(l,u,S):(a=!0,u),n&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}function sb(r,e){return ae(M3(r,e,arguments.length>=2,!0))}function hE(r){return r<=0?()=>as:ae((e,t)=>{let n=[];e.subscribe(new ue(t,i=>{n.push(i),r<n.length&&n.shift()},()=>{for(const i of n)t.next(i);t.complete()},void 0,()=>{n=null}))})}class Is{constructor(e,t){this.id=e,this.url=t}}class dE extends Is{constructor(e,t,n="imperative",i=null){super(e,t),this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Uc extends Is{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ob extends Is{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class F3 extends Is{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class B3 extends Is{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class k3 extends Is{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class G3 extends Is{constructor(e,t,n,i,s){super(e,t),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class V3 extends Is{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class H3 extends Is{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ab{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class lb{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Y3{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U3{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class W3{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j3{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cb{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const et="primary";class z3{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function sl(r){return new z3(r)}const ub="ngNavigationCancelingError";function fE(r){const e=Error("NavigationCancelingError: "+r);return e[ub]=!0,e}function J3(r,e,t){const n=t.path.split("/");if(n.length>r.length||"full"===t.pathMatch&&(e.hasChildren()||n.length<r.length))return null;const i={};for(let s=0;s<n.length;s++){const o=n[s],a=r[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:r.slice(0,n.length),posParams:i}}function Ki(r,e){const t=r?Object.keys(r):void 0,n=e?Object.keys(e):void 0;if(!t||!n||t.length!=n.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!hb(r[i],e[i]))return!1;return!0}function hb(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;const t=[...r].sort(),n=[...e].sort();return t.every((i,s)=>n[s]===i)}return r===e}function db(r){return Array.prototype.concat.apply([],r)}function fb(r){return r.length>0?r[r.length-1]:null}function Dn(r,e){for(const t in r)r.hasOwnProperty(t)&&e(r[t],t)}function Ji(r){return zS(r)?r:mh(r)?Pn(Promise.resolve(r)):ke(r)}const Q3={exact:function mb(r,e,t){if(!Vo(r.segments,e.segments)||!wd(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(const n in e.children)if(!r.children[n]||!mb(r.children[n],e.children[n],t))return!1;return!0},subset:Eb},gb={exact:function X3(r,e){return Ki(r,e)},subset:function Z3(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>hb(r[t],e[t]))},ignored:()=>!0};function pb(r,e,t){return Q3[t.paths](r.root,e.root,t.matrixParams)&&gb[t.queryParams](r.queryParams,e.queryParams)&&!("exact"===t.fragment&&r.fragment!==e.fragment)}function Eb(r,e,t){return yb(r,e,e.segments,t)}function yb(r,e,t,n){if(r.segments.length>t.length){const i=r.segments.slice(0,t.length);return!(!Vo(i,t)||e.hasChildren()||!wd(i,t,n))}if(r.segments.length===t.length){if(!Vo(r.segments,t)||!wd(r.segments,t,n))return!1;for(const i in e.children)if(!r.children[i]||!Eb(r.children[i],e.children[i],n))return!1;return!0}{const i=t.slice(0,r.segments.length),s=t.slice(r.segments.length);return!!(Vo(r.segments,i)&&wd(r.segments,i,n)&&r.children[et])&&yb(r.children[et],e,s,n)}}function wd(r,e,t){return e.every((n,i)=>gb[t](r[i].parameters,n.parameters))}class Go{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sl(this.queryParams)),this._queryParamMap}toString(){return nU.serialize(this)}}class st{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Dn(t,(n,i)=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return vd(this)}}class Wc{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=sl(this.parameters)),this._parameterMap}toString(){return Rb(this)}}function Vo(r,e){return r.length===e.length&&r.every((t,n)=>t.path===e[n].path)}class wb{}class vb{parse(e){const t=new hU(e);return new Go(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${jc(e.root,!0)}`,n=function sU(r){const e=Object.keys(r).map(t=>{const n=r[t];return Array.isArray(n)?n.map(i=>`${Sd(t)}=${Sd(i)}`).join("&"):`${Sd(t)}=${Sd(n)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${n}${"string"==typeof e.fragment?`#${function rU(r){return encodeURI(r)}(e.fragment)}`:""}`}}const nU=new vb;function vd(r){return r.segments.map(e=>Rb(e)).join("/")}function jc(r,e){if(!r.hasChildren())return vd(r);if(e){const t=r.children[et]?jc(r.children[et],!1):"",n=[];return Dn(r.children,(i,s)=>{s!==et&&n.push(`${s}:${jc(i,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function tU(r,e){let t=[];return Dn(r.children,(n,i)=>{i===et&&(t=t.concat(e(n,i)))}),Dn(r.children,(n,i)=>{i!==et&&(t=t.concat(e(n,i)))}),t}(r,(n,i)=>i===et?[jc(r.children[et],!1)]:[`${i}:${jc(n,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[et]?`${vd(r)}/${t[0]}`:`${vd(r)}/(${t.join("//")})`}}function Sb(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Sd(r){return Sb(r).replace(/%3B/gi,";")}function gE(r){return Sb(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ad(r){return decodeURIComponent(r)}function Ab(r){return Ad(r.replace(/\+/g,"%20"))}function Rb(r){return`${gE(r.path)}${function iU(r){return Object.keys(r).map(e=>`;${gE(e)}=${gE(r[e])}`).join("")}(r.parameters)}`}const oU=/^[^\/()?;=#]+/;function Rd(r){const e=r.match(oU);return e?e[0]:""}const aU=/^[^=?&#]+/,cU=/^[^&#]+/;class hU{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new st([],{}):new st([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[et]=new st(e,t)),n}parseSegment(){const e=Rd(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Wc(Ad(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Rd(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const i=Rd(this.remaining);i&&(n=i,this.capture(n))}e[Ad(t)]=Ad(n)}parseQueryParam(e){const t=function lU(r){const e=r.match(aU);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const o=function uU(r){const e=r.match(cU);return e?e[0]:""}(this.remaining);o&&(n=o,this.capture(n))}const i=Ab(t),s=Ab(n);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=Rd(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let s;n.indexOf(":")>-1?(s=n.substr(0,n.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=et);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[et]:new st([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class Cb{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=pE(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){const t=pE(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=mE(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return mE(e,this._root).map(t=>t.value)}}function pE(r,e){if(r===e.value)return e;for(const t of e.children){const n=pE(r,t);if(n)return n}return null}function mE(r,e){if(r===e.value)return[e];for(const t of e.children){const n=mE(r,t);if(n.length)return n.unshift(e),n}return[]}class Os{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ol(r){const e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}class Ib extends Cb{constructor(e,t){super(e),this.snapshot=t,EE(this,e)}toString(){return this.snapshot.toString()}}function Ob(r,e){const t=function dU(r,e){const o=new Cd([],{},{},"",{},et,e,null,r.root,-1,{});return new Tb("",new Os(o,[]))}(r,e),n=new Ci([new Wc("",{})]),i=new Ci({}),s=new Ci({}),o=new Ci({}),a=new Ci(""),l=new al(n,i,o,a,s,et,e,t.root);return l.snapshot=t.root,new Ib(new Os(l,[]),t)}class al{constructor(e,t,n,i,s,o,a,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(pe(e=>sl(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(pe(e=>sl(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bb(r,e="emptyOnly"){const t=r.pathFromRoot;let n=0;if("always"!==e)for(n=t.length-1;n>=1;){const i=t[n],s=t[n-1];if(i.routeConfig&&""===i.routeConfig.path)n--;else{if(s.component)break;n--}}return function fU(r){return r.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(n))}class Cd{constructor(e,t,n,i,s,o,a,l,c,u,S){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=u,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=sl(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sl(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Tb extends Cb{constructor(e,t){super(t),this.url=e,EE(this,t)}toString(){return Pb(this._root)}}function EE(r,e){e.value._routerState=r,e.children.forEach(t=>EE(r,t))}function Pb(r){const e=r.children.length>0?` { ${r.children.map(Pb).join(", ")} } `:"";return`${r.value}${e}`}function yE(r){if(r.snapshot){const e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,Ki(e.queryParams,t.queryParams)||r.queryParams.next(t.queryParams),e.fragment!==t.fragment&&r.fragment.next(t.fragment),Ki(e.params,t.params)||r.params.next(t.params),function $3(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!Ki(r[t],e[t]))return!1;return!0}(e.url,t.url)||r.url.next(t.url),Ki(e.data,t.data)||r.data.next(t.data)}else r.snapshot=r._futureSnapshot,r.data.next(r._futureSnapshot.data)}function wE(r,e){const t=Ki(r.params,e.params)&&function eU(r,e){return Vo(r,e)&&r.every((t,n)=>Ki(t.parameters,e[n].parameters))}(r.url,e.url);return t&&!(!r.parent!=!e.parent)&&(!r.parent||wE(r.parent,e.parent))}function zc(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){const n=t.value;n._futureSnapshot=e.value;const i=function pU(r,e,t){return e.children.map(n=>{for(const i of t.children)if(r.shouldReuseRoute(n.value,i.value.snapshot))return zc(r,n,i);return zc(r,n)})}(r,e,t);return new Os(n,i)}{if(r.shouldAttach(e.value)){const s=r.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>zc(r,a)),o}}const n=function mU(r){return new al(new Ci(r.url),new Ci(r.params),new Ci(r.queryParams),new Ci(r.fragment),new Ci(r.data),r.outlet,r.component,r)}(e.value),i=e.children.map(s=>zc(r,s));return new Os(n,i)}}function Id(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function Kc(r){return"object"==typeof r&&null!=r&&r.outlets}function vE(r,e,t,n,i){let s={};if(n&&Dn(n,(a,l)=>{s[l]=Array.isArray(a)?a.map(c=>`${c}`):`${a}`}),r===e)return new Go(t,s,i);const o=Nb(r,e,t);return new Go(o,s,i)}function Nb(r,e,t){const n={};return Dn(r.children,(i,s)=>{n[s]=i===e?t:Nb(i,e,t)}),new st(r.segments,n)}class Db{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Id(n[0]))throw new Error("Root segment cannot have matrix parameters");const i=n.find(Kc);if(i&&i!==fb(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class SE{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Lb(r,e,t){if(r||(r=new st([],{})),0===r.segments.length&&r.hasChildren())return Od(r,e,t);const n=function AU(r,e,t){let n=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<r.segments.length;){if(n>=t.length)return s;const o=r.segments[i],a=t[n];if(Kc(a))break;const l=`${a}`,c=n<t.length-1?t[n+1]:null;if(i>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!Mb(l,c,o))return s;n+=2}else{if(!Mb(l,{},o))return s;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(r,e,t),i=t.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){const s=new st(r.segments.slice(0,n.pathIndex),{});return s.children[et]=new st(r.segments.slice(n.pathIndex),r.children),Od(s,0,i)}return n.match&&0===i.length?new st(r.segments,{}):n.match&&!r.hasChildren()?AE(r,e,t):n.match?Od(r,0,i):AE(r,e,t)}function Od(r,e,t){if(0===t.length)return new st(r.segments,{});{const n=function SU(r){return Kc(r[0])?r[0].outlets:{[et]:r}}(t),i={};return Dn(n,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=Lb(r.children[o],e,s))}),Dn(r.children,(s,o)=>{void 0===n[o]&&(i[o]=s)}),new st(r.segments,i)}}function AE(r,e,t){const n=r.segments.slice(0,e);let i=0;for(;i<t.length;){const s=t[i];if(Kc(s)){const l=RU(s.outlets);return new st(n,l)}if(0===i&&Id(t[0])){n.push(new Wc(r.segments[e].path,xb(t[0]))),i++;continue}const o=Kc(s)?s.outlets[et]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Id(a)?(n.push(new Wc(o,xb(a))),i+=2):(n.push(new Wc(o,{})),i++)}return new st(n,{})}function RU(r){const e={};return Dn(r,(t,n)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[n]=AE(new st([],{}),0,t))}),e}function xb(r){const e={};return Dn(r,(t,n)=>e[n]=`${t}`),e}function Mb(r,e,t){return r==t.path&&Ki(e,t.parameters)}class IU{constructor(e,t,n,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=i}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),yE(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const i=ol(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,i[o],n),delete i[o]}),Dn(i,(s,o)=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(e,t,n){const i=e.value,s=t?t.value:null;if(i===s)if(i.component){const o=n.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,n);else s&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,s=ol(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);if(n&&n.outlet){const o=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,s=ol(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const i=ol(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],n),this.forwardEvent(new j3(s.value.snapshot))}),e.children.length&&this.forwardEvent(new U3(e.value.snapshot))}activateRoutes(e,t,n){const i=e.value,s=t?t.value:null;if(yE(i),i===s)if(i.component){const o=n.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,n);else if(i.component){const o=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),yE(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=function OU(r){for(let e=r.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(i.snapshot),l=a?a.module.componentFactoryResolver:null;o.attachRef=null,o.route=i,o.resolver=l,o.outlet&&o.outlet.activateWith(i,l),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}class RE{constructor(e,t){this.routes=e,this.module=t}}function Zs(r){return"function"==typeof r}function Ho(r){return r instanceof Go}const Jc=Symbol("INITIAL_VALUE");function $c(){return ko(r=>P3(r.map(e=>e.pipe(Ou(1),function x3(...r){const e=Dl(r);return ae((t,n)=>{(e?uE(r,t,e):uE(r,t)).subscribe(n)})}(Jc)))).pipe(sb((e,t)=>{let n=!1;return t.reduce((i,s,o)=>i!==Jc?i:(s===Jc&&(n=!0),n||!1!==s&&o!==t.length-1&&!Ho(s)?i:s),e)},Jc),Do(e=>e!==Jc),pe(e=>Ho(e)?e:!0===e),Ou(1)))}class LU{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new qc,this.attachRef=null}}class qc{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new LU,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}let CE=(()=>{class r{constructor(t,n,i,s,o){this.parentContexts=t,this.location=n,this.resolver=i,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new _t,this.deactivateEvents=new _t,this.attachEvents=new _t,this.detachEvents=new _t,this.name=s||et,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const o=(n=n||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),a=this.parentContexts.getOrCreateContext(this.name).children,l=new xU(t,a,this.location.injector);this.activated=this.location.createComponent(o,this.location.length,l),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return r.\u0275fac=function(t){return new(t||r)(De(qc),De(Ei),De(fc),function Hl(r){return function WN(r,e){if("class"===e)return r.classes;if("style"===e)return r.styles;const t=r.attrs;if(t){const n=t.length;let i=0;for(;i<n;){const s=t[i];if(mw(s))break;if(0===s)i+=2;else if("number"==typeof s)for(i++;i<n&&"string"==typeof t[i];)i++;else{if(s===e)return t[i+1];i+=2}}}return null}(fn(),r)}("name"),De(Dh))},r.\u0275dir=dn({type:r,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),r})();class xU{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===al?this.route:e===qc?this.childContexts:this.parent.get(e,t)}}let _b=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=ks({type:r,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,n){1&t&&Rr(0,"router-outlet")},directives:[CE],encapsulation:2}),r})();function Fb(r,e=""){for(let t=0;t<r.length;t++){const n=r[t];MU(n,_U(e,n))}}function MU(r,e){r.children&&Fb(r.children,e)}function _U(r,e){return e?r||e.path?r&&!e.path?`${r}/`:!r&&e.path?e.path:`${r}/${e.path}`:"":r}function IE(r){const e=r.children&&r.children.map(IE),t=e?Object.assign(Object.assign({},r),{children:e}):Object.assign({},r);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==et&&(t.component=_b),t}function Qr(r){return r.outlet||et}function Bb(r,e){const t=r.filter(n=>Qr(n)===e);return t.push(...r.filter(n=>Qr(n)!==e)),t}const kb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function bd(r,e,t){var n;if(""===e.path)return"full"===e.pathMatch&&(r.hasChildren()||t.length>0)?Object.assign({},kb):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const s=(e.matcher||J3)(t,r,e);if(!s)return Object.assign({},kb);const o={};Dn(s.posParams,(l,c)=>{o[c]=l.path});const a=s.consumed.length>0?Object.assign(Object.assign({},o),s.consumed[s.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:s.consumed,remainingSegments:t.slice(s.consumed.length),parameters:a,positionalParamSegments:null!==(n=s.posParams)&&void 0!==n?n:{}}}function Td(r,e,t,n,i="corrected"){if(t.length>0&&function kU(r,e,t){return t.some(n=>Pd(r,e,n)&&Qr(n)!==et)}(r,t,n)){const o=new st(e,function BU(r,e,t,n){const i={};i[et]=n,n._sourceSegment=r,n._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&Qr(s)!==et){const o=new st([],{});o._sourceSegment=r,o._segmentIndexShift=e.length,i[Qr(s)]=o}return i}(r,e,n,new st(t,r.children)));return o._sourceSegment=r,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:[]}}if(0===t.length&&function GU(r,e,t){return t.some(n=>Pd(r,e,n))}(r,t,n)){const o=new st(r.segments,function FU(r,e,t,n,i,s){const o={};for(const a of n)if(Pd(r,t,a)&&!i[Qr(a)]){const l=new st([],{});l._sourceSegment=r,l._segmentIndexShift="legacy"===s?r.segments.length:e.length,o[Qr(a)]=l}return Object.assign(Object.assign({},i),o)}(r,e,t,n,r.children,i));return o._sourceSegment=r,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:t}}const s=new st(r.segments,r.children);return s._sourceSegment=r,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}function Pd(r,e,t){return(!(r.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function Gb(r,e,t,n){return!!(Qr(r)===n||n!==et&&Pd(e,t,r))&&("**"===r.path||bd(e,r,t).matched)}function Vb(r,e,t){return 0===e.length&&!r.children[t]}class Nd{constructor(e){this.segmentGroup=e||null}}class Hb{constructor(e){this.urlTree=e}}function Qc(r){return Oc(new Nd(r))}function Yb(r){return Oc(new Hb(r))}class UU{constructor(e,t,n,i,s){this.configLoader=t,this.urlSerializer=n,this.urlTree=i,this.config=s,this.allowRedirects=!0,this.ngModule=e.get(ps)}apply(){const e=Td(this.urlTree.root,[],[],this.config).segmentGroup,t=new st(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,et).pipe(pe(s=>this.createUrlTree(OE(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ss(s=>{if(s instanceof Hb)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Nd?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,et).pipe(pe(i=>this.createUrlTree(OE(i),e.queryParams,e.fragment))).pipe(Ss(i=>{throw i instanceof Nd?this.noMatchError(i):i}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const i=e.segments.length>0?new st([],{[et]:e}):e;return new Go(i,t,n)}expandSegmentGroup(e,t,n,i){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(pe(s=>new st([],s))):this.expandSegment(e,n,t,n.segments,i,!0)}expandChildren(e,t,n){const i=[];for(const s of Object.keys(n.children))"primary"===s?i.unshift(s):i.push(s);return Pn(i).pipe(Ka(s=>{const o=n.children[s],a=Bb(t,s);return this.expandSegmentGroup(e,a,o,s).pipe(pe(l=>({segment:l,outlet:s})))}),sb((s,o)=>(s[o.outlet]=o.segment,s),{}),function _3(r,e){const t=arguments.length>=2;return n=>n.pipe(r?Do((i,s)=>r(i,s,n)):$,hE(1),t?TO(e):PO(()=>new pd))}())}expandSegment(e,t,n,i,s,o){return Pn(n).pipe(Ka(a=>this.expandSegmentAgainstRoute(e,t,n,a,i,s,o).pipe(Ss(c=>{if(c instanceof Nd)return ke(null);throw c}))),Fo(a=>!!a),Ss((a,l)=>{if(a instanceof pd||"EmptyError"===a.name)return Vb(t,i,s)?ke(new st([],{})):Qc(t);throw a}))}expandSegmentAgainstRoute(e,t,n,i,s,o,a){return Gb(i,t,s,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,s,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,i,s,o):Qc(t):Qc(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,i,s,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,i,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,i){const s=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Yb(s):this.lineralizeSegments(n,s).pipe(hn(o=>{const a=new st(o,{});return this.expandSegment(e,a,t,o,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,i,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:u}=bd(t,i,s);if(!a)return Qc(t);const S=this.applyRedirectCommands(l,i.redirectTo,u);return i.redirectTo.startsWith("/")?Yb(S):this.lineralizeSegments(i,S).pipe(hn(b=>this.expandSegment(e,t,n,b.concat(c),o,!1)))}matchSegmentAgainstRoute(e,t,n,i,s){if("**"===n.path)return n.loadChildren?(n._loadedConfig?ke(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(pe(S=>(n._loadedConfig=S,new st(i,{})))):ke(new st(i,{}));const{matched:o,consumedSegments:a,remainingSegments:l}=bd(t,n,i);return o?this.getChildConfig(e,n,i).pipe(hn(u=>{const S=u.module,b=u.routes,{segmentGroup:L,slicedSegments:F}=Td(t,a,l,b),G=new st(L.segments,L.children);if(0===F.length&&G.hasChildren())return this.expandChildren(S,b,G).pipe(pe(he=>new st(a,he)));if(0===b.length&&0===F.length)return ke(new st(a,{}));const J=Qr(n)===s;return this.expandSegment(S,G,b,F,J?et:s,!0).pipe(pe(ie=>new st(a.concat(ie.segments),ie.children)))})):Qc(t)}getChildConfig(e,t,n){return t.children?ke(new RE(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?ke(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(hn(i=>i?this.configLoader.load(e.injector,t).pipe(pe(s=>(t._loadedConfig=s,s))):function HU(r){return Oc(fE(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))}(t))):ke(new RE([],e))}runCanLoadGuards(e,t,n){const i=t.canLoad;return i&&0!==i.length?ke(i.map(o=>{const a=e.get(o);let l;if(function TU(r){return r&&Zs(r.canLoad)}(a))l=a.canLoad(t,n);else{if(!Zs(a))throw new Error("Invalid CanLoad guard");l=a(t,n)}return Ji(l)})).pipe($c(),kn(o=>{if(!Ho(o))return;const a=fE(`Redirecting to "${this.urlSerializer.serialize(o)}"`);throw a.url=o,a}),pe(o=>!0===o)):ke(!0)}lineralizeSegments(e,t){let n=[],i=t.root;for(;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return ke(n);if(i.numberOfChildren>1||!i.children[et])return Oc(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e.redirectTo}'`));i=i.children[et]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,i){const s=this.createSegmentGroup(e,t.root,n,i);return new Go(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Dn(e,(i,s)=>{if("string"==typeof i&&i.startsWith(":")){const a=i.substring(1);n[s]=t[a]}else n[s]=i}),n}createSegmentGroup(e,t,n,i){const s=this.createSegments(e,t.segments,n,i);let o={};return Dn(t.children,(a,l)=>{o[l]=this.createSegmentGroup(e,a,n,i)}),new st(s,o)}createSegments(e,t,n,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,n))}findPosParam(e,t,n){const i=n[t.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return i}findOrReturn(e,t){let n=0;for(const i of t){if(i.path===e.path)return t.splice(n),i;n++}return e}}function OE(r){const e={};for(const n of Object.keys(r.children)){const s=OE(r.children[n]);(s.segments.length>0||s.hasChildren())&&(e[n]=s)}return function WU(r){if(1===r.numberOfChildren&&r.children[et]){const e=r.children[et];return new st(r.segments.concat(e.segments),e.children)}return r}(new st(r.segments,e))}class Ub{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Dd{constructor(e,t){this.component=e,this.route=t}}function zU(r,e,t){const n=r._root;return Xc(n,e?e._root:null,t,[n.value])}function Ld(r,e,t){const n=function JU(r){if(!r)return null;for(let e=r.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(n?n.module.injector:t).get(r)}function Xc(r,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=ol(e);return r.children.forEach(o=>{(function $U(r,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=r.value,o=e?e.value:null,a=t?t.getContext(r.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function qU(r,e,t){if("function"==typeof t)return t(r,e);switch(t){case"pathParamsChange":return!Vo(r.url,e.url);case"pathParamsOrQueryParamsChange":return!Vo(r.url,e.url)||!Ki(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wE(r,e)||!Ki(r.queryParams,e.queryParams);default:return!wE(r,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new Ub(n)):(s.data=o.data,s._resolvedData=o._resolvedData),Xc(r,e,s.component?a?a.children:null:t,n,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Dd(a.outlet.component,o))}else o&&Zc(e,a,i),i.canActivateChecks.push(new Ub(n)),Xc(r,null,s.component?a?a.children:null:t,n,i)})(o,s[o.value.outlet],t,n.concat([o.value]),i),delete s[o.value.outlet]}),Dn(s,(o,a)=>Zc(o,t.getContext(a),i)),i}function Zc(r,e,t){const n=ol(r),i=r.value;Dn(n,(s,o)=>{Zc(s,i.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new Dd(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}class sW{}function Wb(r){return new z(e=>e.error(r))}class aW{constructor(e,t,n,i,s,o){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=i,this.paramsInheritanceStrategy=s,this.relativeLinkResolution=o}recognize(){const e=Td(this.urlTree.root,[],[],this.config.filter(o=>void 0===o.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,et);if(null===t)return null;const n=new Cd([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},et,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new Os(n,t),s=new Tb(this.url,i);return this.inheritParamsAndData(s._root),s}inheritParamsAndData(e){const t=e.value,n=bb(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const s of Object.keys(t.children)){const o=t.children[s],a=Bb(e,s),l=this.processSegmentGroup(a,o,s);if(null===l)return null;n.push(...l)}const i=jb(n);return function lW(r){r.sort((e,t)=>e.value.outlet===et?-1:t.value.outlet===et?1:e.value.outlet.localeCompare(t.value.outlet))}(i),i}processSegment(e,t,n,i){for(const s of e){const o=this.processSegmentAgainstRoute(s,t,n,i);if(null!==o)return o}return Vb(t,n,i)?[]:null}processSegmentAgainstRoute(e,t,n,i){if(e.redirectTo||!Gb(e,t,n,i))return null;let s,o=[],a=[];if("**"===e.path){const L=n.length>0?fb(n).parameters:{};s=new Cd(n,L,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Jb(e),Qr(e),e.component,e,zb(t),Kb(t)+n.length,$b(e))}else{const L=bd(t,e,n);if(!L.matched)return null;o=L.consumedSegments,a=L.remainingSegments,s=new Cd(o,L.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Jb(e),Qr(e),e.component,e,zb(t),Kb(t)+o.length,$b(e))}const l=function cW(r){return r.children?r.children:r.loadChildren?r._loadedConfig.routes:[]}(e),{segmentGroup:c,slicedSegments:u}=Td(t,o,a,l.filter(L=>void 0===L.redirectTo),this.relativeLinkResolution);if(0===u.length&&c.hasChildren()){const L=this.processChildren(l,c);return null===L?null:[new Os(s,L)]}if(0===l.length&&0===u.length)return[new Os(s,[])];const S=Qr(e)===i,b=this.processSegment(l,c,u,S?et:i);return null===b?null:[new Os(s,b)]}}function uW(r){const e=r.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function jb(r){const e=[],t=new Set;for(const n of r){if(!uW(n)){e.push(n);continue}const i=e.find(s=>n.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...n.children),t.add(i)):e.push(n)}for(const n of t){const i=jb(n.children);e.push(new Os(n.value,i))}return e.filter(n=>!t.has(n))}function zb(r){let e=r;for(;e._sourceSegment;)e=e._sourceSegment;return e}function Kb(r){let e=r,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function Jb(r){return r.data||{}}function $b(r){return r.resolve||{}}function qb(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function bE(r){return ko(e=>{const t=r(e);return t?Pn(t).pipe(pe(()=>e)):ke(e)})}class yW extends class EW{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const TE=new Ge("ROUTES");class Qb{constructor(e,t,n,i){this.injector=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=i}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const i=this.loadModuleFactory(t.loadChildren).pipe(pe(s=>{this.onLoadEndListener&&this.onLoadEndListener(t);const o=s.create(e);return new RE(db(o.injector.get(TE,void 0,Ue.Self|Ue.Optional)).map(IE),o)}),Ss(s=>{throw t._loader$=void 0,s}));return t._loader$=new L3(i,()=>new ye).pipe(ib()),t._loader$}loadModuleFactory(e){return Ji(e()).pipe(hn(t=>t instanceof pR?ke(t):Pn(this.compiler.compileModuleAsync(t))))}}class vW{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function SW(r){throw r}function AW(r,e,t){return e.parse("/")}function Xb(r,e){return ke(null)}const RW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},CW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let br=(()=>{class r{constructor(t,n,i,s,o,a,l){this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=i,this.location=s,this.config=l,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new ye,this.errorHandler=SW,this.malformedUriErrorHandler=AW,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Xb,afterPreactivation:Xb},this.urlHandlingStrategy=new vW,this.routeReuseStrategy=new yW,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=o.get(ps),this.console=o.get(O1);const S=o.get(mn);this.isNgZoneEnabled=S instanceof mn&&mn.isInAngularZone(),this.resetConfig(l),this.currentUrlTree=function q3(){return new Go(new st([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Qb(o,a,b=>this.triggerEvent(new ab(b)),b=>this.triggerEvent(new lb(b))),this.routerState=Ob(this.currentUrlTree,this.rootComponentType),this.transitions=new Ci({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const n=this.events;return t.pipe(Do(i=>0!==i.id),pe(i=>Object.assign(Object.assign({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),ko(i=>{let s=!1,o=!1;return ke(i).pipe(kn(a=>{this.currentNavigation={id:a.id,initialUrl:a.currentRawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ko(a=>{const l=this.browserUrlTree.toString(),c=!this.navigated||a.extractedUrl.toString()!==l||l!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||c)&&this.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return Zb(a.source)&&(this.browserUrlTree=a.extractedUrl),ke(a).pipe(ko(S=>{const b=this.transitions.getValue();return n.next(new dE(S.id,this.serializeUrl(S.extractedUrl),S.source,S.restoredState)),b!==this.transitions.getValue()?as:Promise.resolve(S)}),function jU(r,e,t,n){return ko(i=>function YU(r,e,t,n,i){return new UU(r,e,t,n,i).apply()}(r,e,t,i.extractedUrl,n).pipe(pe(s=>Object.assign(Object.assign({},i),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),kn(S=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:S.urlAfterRedirects})}),function hW(r,e,t,n,i){return hn(s=>function oW(r,e,t,n,i="emptyOnly",s="legacy"){try{const o=new aW(r,e,t,n,i,s).recognize();return null===o?Wb(new sW):ke(o)}catch(o){return Wb(o)}}(r,e,s.urlAfterRedirects,t(s.urlAfterRedirects),n,i).pipe(pe(o=>Object.assign(Object.assign({},s),{targetSnapshot:o}))))}(this.rootComponentType,this.config,S=>this.serializeUrl(S),this.paramsInheritanceStrategy,this.relativeLinkResolution),kn(S=>{if("eager"===this.urlUpdateStrategy){if(!S.extras.skipLocationChange){const L=this.urlHandlingStrategy.merge(S.urlAfterRedirects,S.rawUrl);this.setBrowserUrl(L,S)}this.browserUrlTree=S.urlAfterRedirects}const b=new B3(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);n.next(b)}));if(c&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:b,extractedUrl:L,source:F,restoredState:G,extras:J}=a,te=new dE(b,this.serializeUrl(L),F,G);n.next(te);const ie=Ob(L,this.rootComponentType).snapshot;return ke(Object.assign(Object.assign({},a),{targetSnapshot:ie,urlAfterRedirects:L,extras:Object.assign(Object.assign({},J),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=a.rawUrl,a.resolve(null),as}),bE(a=>{const{targetSnapshot:l,id:c,extractedUrl:u,rawUrl:S,extras:{skipLocationChange:b,replaceUrl:L}}=a;return this.hooks.beforePreactivation(l,{navigationId:c,appliedUrlTree:u,rawUrlTree:S,skipLocationChange:!!b,replaceUrl:!!L})}),kn(a=>{const l=new k3(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot);this.triggerEvent(l)}),pe(a=>Object.assign(Object.assign({},a),{guards:zU(a.targetSnapshot,a.currentSnapshot,this.rootContexts)})),function QU(r,e){return hn(t=>{const{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?ke(Object.assign(Object.assign({},t),{guardsResult:!0})):function XU(r,e,t,n){return Pn(r).pipe(hn(i=>function iW(r,e,t,n,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?ke(s.map(a=>{const l=Ld(a,e,i);let c;if(function DU(r){return r&&Zs(r.canDeactivate)}(l))c=Ji(l.canDeactivate(r,e,t,n));else{if(!Zs(l))throw new Error("Invalid CanDeactivate guard");c=Ji(l(r,e,t,n))}return c.pipe(Fo())})).pipe($c()):ke(!0)}(i.component,i.route,t,e,n)),Fo(i=>!0!==i,!0))}(o,n,i,r).pipe(hn(a=>a&&function bU(r){return"boolean"==typeof r}(a)?function ZU(r,e,t,n){return Pn(e).pipe(Ka(i=>uE(function tW(r,e){return null!==r&&e&&e(new Y3(r)),ke(!0)}(i.route.parent,n),function eW(r,e){return null!==r&&e&&e(new W3(r)),ke(!0)}(i.route,n),function rW(r,e,t){const n=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function KU(r){const e=r.routeConfig?r.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:r,guards:e}:null}(o)).filter(o=>null!==o).map(o=>rb(()=>ke(o.guards.map(l=>{const c=Ld(l,o.node,t);let u;if(function NU(r){return r&&Zs(r.canActivateChild)}(c))u=Ji(c.canActivateChild(n,r));else{if(!Zs(c))throw new Error("Invalid CanActivateChild guard");u=Ji(c(n,r))}return u.pipe(Fo())})).pipe($c())));return ke(s).pipe($c())}(r,i.path,t),function nW(r,e,t){const n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||0===n.length)return ke(!0);const i=n.map(s=>rb(()=>{const o=Ld(s,e,t);let a;if(function PU(r){return r&&Zs(r.canActivate)}(o))a=Ji(o.canActivate(e,r));else{if(!Zs(o))throw new Error("Invalid CanActivate guard");a=Ji(o(e,r))}return a.pipe(Fo())}));return ke(i).pipe($c())}(r,i.route,t))),Fo(i=>!0!==i,!0))}(n,s,r,e):ke(a)),pe(a=>Object.assign(Object.assign({},t),{guardsResult:a})))})}(this.ngModule.injector,a=>this.triggerEvent(a)),kn(a=>{if(Ho(a.guardsResult)){const c=fE(`Redirecting to "${this.serializeUrl(a.guardsResult)}"`);throw c.url=a.guardsResult,c}const l=new G3(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.triggerEvent(l)}),Do(a=>!!a.guardsResult||(this.restoreHistory(a),this.cancelNavigationTransition(a,""),!1)),bE(a=>{if(a.guards.canActivateChecks.length)return ke(a).pipe(kn(l=>{const c=new V3(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(c)}),ko(l=>{let c=!1;return ke(l).pipe(function dW(r,e){return hn(t=>{const{targetSnapshot:n,guards:{canActivateChecks:i}}=t;if(!i.length)return ke(t);let s=0;return Pn(i).pipe(Ka(o=>function fW(r,e,t,n){return function gW(r,e,t,n){const i=qb(r);if(0===i.length)return ke({});const s={};return Pn(i).pipe(hn(o=>function pW(r,e,t,n){const i=Ld(r,e,n);return Ji(i.resolve?i.resolve(e,t):i(e,t))}(r[o],e,t,n).pipe(kn(a=>{s[o]=a}))),hE(1),hn(()=>qb(s).length===i.length?ke(s):as))}(r._resolve,r,e,n).pipe(pe(s=>(r._resolvedData=s,r.data=Object.assign(Object.assign({},r.data),bb(r,t).resolve),null)))}(o.route,n,r,e)),kn(()=>s++),hE(1),hn(o=>s===i.length?ke(t):as))})}(this.paramsInheritanceStrategy,this.ngModule.injector),kn({next:()=>c=!0,complete:()=>{c||(this.restoreHistory(l),this.cancelNavigationTransition(l,"At least one route resolver didn't emit any value."))}}))}),kn(l=>{const c=new H3(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(c)}))}),bE(a=>{const{targetSnapshot:l,id:c,extractedUrl:u,rawUrl:S,extras:{skipLocationChange:b,replaceUrl:L}}=a;return this.hooks.afterPreactivation(l,{navigationId:c,appliedUrlTree:u,rawUrlTree:S,skipLocationChange:!!b,replaceUrl:!!L})}),pe(a=>{const l=function gU(r,e,t){const n=zc(r,e._root,t?t._root:void 0);return new Ib(n,e)}(this.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return Object.assign(Object.assign({},a),{targetRouterState:l})}),kn(a=>{this.currentUrlTree=a.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),this.routerState=a.targetRouterState,"deferred"===this.urlUpdateStrategy&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a),this.browserUrlTree=a.urlAfterRedirects)}),((r,e,t)=>pe(n=>(new IU(e,n.targetRouterState,n.currentRouterState,t).activate(r),n)))(this.rootContexts,this.routeReuseStrategy,a=>this.triggerEvent(a)),kn({next(){s=!0},complete(){s=!0}}),function dI(r){return ae((e,t)=>{try{e.subscribe(t)}finally{t.add(r)}})}(()=>{var a;s||o||this.cancelNavigationTransition(i,`Navigation ID ${i.id} is not equal to the current navigation id ${this.navigationId}`),(null===(a=this.currentNavigation)||void 0===a?void 0:a.id)===i.id&&(this.currentNavigation=null)}),Ss(a=>{if(o=!0,function K3(r){return r&&r[ub]}(a)){const l=Ho(a.url);l||(this.navigated=!0,this.restoreHistory(i,!0));const c=new ob(i.id,this.serializeUrl(i.extractedUrl),a.message);n.next(c),l?setTimeout(()=>{const u=this.urlHandlingStrategy.merge(a.url,this.rawUrlTree),S={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Zb(i.source)};this.scheduleNavigation(u,"imperative",null,S,{resolve:i.resolve,reject:i.reject,promise:i.promise})},0):i.resolve(!1)}else{this.restoreHistory(i,!0);const l=new F3(i.id,this.serializeUrl(i.extractedUrl),a);n.next(l);try{i.resolve(this.errorHandler(a))}catch(c){i.reject(c)}}return as}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const n="popstate"===t.type?"popstate":"hashchange";"popstate"===n&&setTimeout(()=>{var i;const s={replaceUrl:!0},o=(null===(i=t.state)||void 0===i?void 0:i.navigationId)?t.state:null;if(o){const l=Object.assign({},o);delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(t.url);this.scheduleNavigation(a,n,o,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){Fb(t),this.config=t.map(IE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,n={}){const{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=n,c=i||this.routerState.root,u=l?this.currentUrlTree.fragment:o;let S=null;switch(a){case"merge":S=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":S=this.currentUrlTree.queryParams;break;default:S=s||null}return null!==S&&(S=this.removeEmptyProps(S)),function EU(r,e,t,n,i){if(0===t.length)return vE(e.root,e.root,e.root,n,i);const s=function yU(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new Db(!0,0,r);let e=0,t=!1;const n=r.reduce((i,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Dn(s.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,s]},[]);return new Db(t,e,n)}(t);if(s.toRoot())return vE(e.root,e.root,new st([],{}),n,i);const o=function wU(r,e,t){if(r.isAbsolute)return new SE(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const s=t.snapshot._urlSegment;return new SE(s,s===e.root,0)}const n=Id(r.commands[0])?0:1;return function vU(r,e,t){let n=r,i=e,s=t;for(;s>i;){if(s-=i,n=n.parent,!n)throw new Error("Invalid number of '../'");i=n.segments.length}return new SE(n,!1,i-s)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+n,r.numberOfDoubleDots)}(s,e,r),a=o.processChildren?Od(o.segmentGroup,o.index,s.commands):Lb(o.segmentGroup,o.index,s.commands);return vE(e.root,o.segmentGroup,a,n,i)}(c,this.currentUrlTree,t,S,null!=u?u:null)}navigateByUrl(t,n={skipLocationChange:!1}){const i=Ho(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,n)}navigate(t,n={skipLocationChange:!1}){return function IW(r){for(let e=0;e<r.length;e++){const t=r[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let n;try{n=this.urlSerializer.parse(t)}catch(i){n=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return n}isActive(t,n){let i;if(i=!0===n?Object.assign({},RW):!1===n?Object.assign({},CW):n,Ho(t))return pb(this.currentUrlTree,t,i);const s=this.parseUrl(t);return pb(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.keys(t).reduce((n,i)=>{const s=t[i];return null!=s&&(n[i]=s),n},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new Uc(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,n,i,s,o){var a,l;if(this.disposed)return Promise.resolve(!1);let c,u,S;o?(c=o.resolve,u=o.reject,S=o.promise):S=new Promise((F,G)=>{c=F,u=G});const b=++this.navigationId;let L;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),L=i&&i.\u0275routerPageId?i.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(a=this.browserPageId)&&void 0!==a?a:0:(null!==(l=this.browserPageId)&&void 0!==l?l:0)+1):L=0,this.setTransition({id:b,targetPageId:L,source:n,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:s,resolve:c,reject:u,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(F=>Promise.reject(F))}setBrowserUrl(t,n){const i=this.urlSerializer.serialize(t),s=Object.assign(Object.assign({},n.extras.state),this.generateNgRouterState(n.id,n.targetPageId));this.location.isCurrentPathEqualTo(i)||n.extras.replaceUrl?this.location.replaceState(i,"",s):this.location.go(i,"",s)}restoreHistory(t,n=!1){var i,s;if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)||0===o?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===o&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,n){const i=new ob(t.id,this.serializeUrl(t.extractedUrl),n);this.triggerEvent(i),t.resolve(!1)}generateNgRouterState(t,n){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}}return r.\u0275fac=function(t){lp()},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();function Zb(r){return"imperative"!==r}class eT{}class tT{preload(e,t){return ke(null)}}let nT=(()=>{class r{constructor(t,n,i,s){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=new Qb(i,n,l=>t.triggerEvent(new ab(l)),l=>t.triggerEvent(new lb(l)))}setUpPreloading(){this.subscription=this.router.events.pipe(Do(t=>t instanceof Uc),Ka(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(ps);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,n){const i=[];for(const s of n)if(s.loadChildren&&!s.canLoad&&s._loadedConfig){const o=s._loadedConfig;i.push(this.processRoutes(o.module,o.routes))}else s.loadChildren&&!s.canLoad?i.push(this.preloadConfig(t,s)):s.children&&i.push(this.processRoutes(t,s.children));return Pn(i).pipe(Nl(),pe(s=>{}))}preloadConfig(t,n){return this.preloadingStrategy.preload(n,()=>(n._loadedConfig?ke(n._loadedConfig):this.loader.load(t.injector,n)).pipe(hn(s=>(n._loadedConfig=s,this.processRoutes(s.module,s.routes)))))}}return r.\u0275fac=function(t){return new(t||r)(Le(br),Le(QR),Le(ar),Le(eT))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})(),DE=(()=>{class r{constructor(t,n,i={}){this.router=t,this.viewportScroller=n,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof dE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Uc&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof cb&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,n){this.router.triggerEvent(new cb(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,n))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return r.\u0275fac=function(t){lp()},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();const Yo=new Ge("ROUTER_CONFIGURATION"),rT=new Ge("ROUTER_FORROOT_GUARD"),PW=[sm,{provide:wb,useClass:vb},{provide:br,useFactory:function MW(r,e,t,n,i,s,o={},a,l){const c=new br(null,r,e,t,n,i,db(s));return a&&(c.urlHandlingStrategy=a),l&&(c.routeReuseStrategy=l),function _W(r,e){r.errorHandler&&(e.errorHandler=r.errorHandler),r.malformedUriErrorHandler&&(e.malformedUriErrorHandler=r.malformedUriErrorHandler),r.onSameUrlNavigation&&(e.onSameUrlNavigation=r.onSameUrlNavigation),r.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=r.paramsInheritanceStrategy),r.relativeLinkResolution&&(e.relativeLinkResolution=r.relativeLinkResolution),r.urlUpdateStrategy&&(e.urlUpdateStrategy=r.urlUpdateStrategy),r.canceledNavigationResolution&&(e.canceledNavigationResolution=r.canceledNavigationResolution)}(o,c),o.enableTracing&&c.events.subscribe(u=>{var S,b;null===(S=console.group)||void 0===S||S.call(console,`Router Event: ${u.constructor.name}`),console.log(u.toString()),console.log(u),null===(b=console.groupEnd)||void 0===b||b.call(console)}),c},deps:[wb,qc,sm,ar,QR,TE,Yo,[class wW{},new ui],[class mW{},new ui]]},qc,{provide:al,useFactory:function FW(r){return r.routerState.root},deps:[br]},nT,tT,class TW{preload(e,t){return t().pipe(Ss(()=>ke(null)))}},{provide:Yo,useValue:{enableTracing:!1}}];function NW(){return new tC("Router",br)}let iT=(()=>{class r{constructor(t,n){}static forRoot(t,n){return{ngModule:r,providers:[PW,sT(t),{provide:rT,useFactory:xW,deps:[[br,new ui,new ma]]},{provide:Yo,useValue:n||{}},{provide:ja,useFactory:LW,deps:[Po,[new Zu(im),new ui],Yo]},{provide:DE,useFactory:DW,deps:[br,kB,Yo]},{provide:eT,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:tT},{provide:tC,multi:!0,useFactory:NW},[LE,{provide:Yp,multi:!0,useFactory:BW,deps:[LE]},{provide:oT,useFactory:kW,deps:[LE]},{provide:qR,multi:!0,useExisting:oT}]]}}static forChild(t){return{ngModule:r,providers:[sT(t)]}}}return r.\u0275fac=function(t){return new(t||r)(Le(rT,8),Le(br,8))},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({}),r})();function DW(r,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new DE(r,e,t)}function LW(r,e,t={}){return t.useHash?new wF(r,e):new vC(r,e)}function xW(r){return"guarded"}function sT(r){return[{provide:qN,multi:!0,useValue:r},{provide:TE,multi:!0,useValue:r}]}let LE=(()=>{class r{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new ye}appInitializer(){return this.injector.get(mF,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let n=null;const i=new Promise(a=>n=a),s=this.injector.get(br),o=this.injector.get(Yo);return"disabled"===o.initialNavigation?(s.setUpLocationChangeListener(),n(!0)):"enabled"===o.initialNavigation||"enabledBlocking"===o.initialNavigation?(s.hooks.afterPreactivation=()=>this.initNavigation?ke(null):(this.initNavigation=!0,n(!0),this.resultOfPreactivationDone),s.initialNavigation()):n(!0),i})}bootstrapListener(t){const n=this.injector.get(Yo),i=this.injector.get(nT),s=this.injector.get(DE),o=this.injector.get(br),a=this.injector.get(Qp);t===a.components[0]&&(("enabledNonBlocking"===n.initialNavigation||void 0===n.initialNavigation)&&o.initialNavigation(),i.setUpPreloading(),s.init(),o.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return r.\u0275fac=function(t){return new(t||r)(Le(ar))},r.\u0275prov=Ke({token:r,factory:r.\u0275fac}),r})();function BW(r){return r.appInitializer.bind(r)}function kW(r){return r.bootstrapListener.bind(r)}const oT=new Ge("Router Initializer"),VW=[{path:"",children:[]}];let HW=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r}),r.\u0275inj=ir({imports:[[iT.forRoot(VW)],iT]}),r})();const aT=JSON.parse('{"t":[{"id":"ADDAM_MARBRAND","label":"Addam","weight":8},{"id":"AEGON","label":"Aegon","weight":20},{"id":"AERYS","label":"Aerys","weight":122},{"id":"ALLISER_THORNE","label":"Allister","weight":403},{"id":"ARYA","label":"Arya","weight":2791},{"id":"ASSASSIN","label":"Assassin","weight":7},{"id":"BAELOR","label":"Baelor","weight":39},{"id":"BALON","label":"Balon","weight":181},{"id":"BARRISTAN","label":"Barristan","weight":379},{"id":"BENJEN","label":"Benjen","weight":162},{"id":"BERIC","label":"Beric","weight":574},{"id":"BORCAS","label":"Borcas","weight":4},{"id":"BOWEN_MARSH","label":"Bowen","weight":42},{"id":"BRAN","label":"Bran","weight":1864},{"id":"BRANDON_STARK","label":"Brandon","weight":17},{"id":"BRONN","label":"Bronn","weight":1195},{"id":"CATELYN","label":"Catelyn","weight":1246},{"id":"CERSEI","label":"Cersei","weight":3727},{"id":"COHOLLO","label":"Cohollo","weight":3},{"id":"DAENERYS","label":"Daenerys","weight":3839},{"id":"DAREON","label":"Dareon","weight":34},{"id":"DOREAH","label":"Doreah","weight":129},{"id":"DROGO","label":"Drogo","weight":226},{"id":"GALBART_GLOVER","label":"Galbart","weight":6},{"id":"GARED","label":"Gared","weight":9},{"id":"GENDRY","label":"Gendry","weight":826},{"id":"GREATJON_UMBER","label":"Greatjon","weight":78},{"id":"GRENN","label":"Grenn","weight":419},{"id":"HIGH_SEPTON","label":"High Septon","weight":97},{"id":"HODOR","label":"Hodor","weight":448},{"id":"HOSTER","label":"Hoster","weight":35},{"id":"HOT_PIE","label":"Hot Pie","weight":213},{"id":"HOUND","label":"Sandor","weight":1454},{"id":"HUGH_OF_THE_VALE","label":"Hugh of the Vale","weight":23},{"id":"ILLYRIO","label":"Illyrio","weight":54},{"id":"ILYN_PAYNE","label":"Ilyn","weight":60},{"id":"IROGENIA","label":"Irogenia","weight":2},{"id":"IRRI","label":"Irri","weight":92},{"id":"JAIME","label":"Jaime","weight":3316},{"id":"JANOS","label":"Janos","weight":266},{"id":"JAREMY_RYKKER","label":"Jaremy","weight":6},{"id":"JEOR","label":"Jeor","weight":340},{"id":"JHIQUI","label":"Jhiqui","weight":7},{"id":"JOANNA","label":"Joanna","weight":13},{"id":"JOFFREY","label":"Joffrey","weight":1579},{"id":"JON","label":"Jon","weight":4753},{"id":"JON_ARRYN","label":"Jon Arryn","weight":75},{"id":"JONOS_BRACKEN","label":"Jonos","weight":7},{"id":"JORAH","label":"Jorah","weight":1756},{"id":"JORY_CASSEL","label":"Jory","weight":100},{"id":"JOYEUSE","label":"Joyeuse","weight":26},{"id":"KEVAN","label":"Kevan","weight":154},{"id":"LANCEL","label":"Lancel","weight":221},{"id":"LEO_LEFFORD","label":"Leo","weight":7},{"id":"LITTLE_BIRD","label":"Little Bird","weight":2},{"id":"LITTLEFINGER","label":"Petyr","weight":1661},{"id":"LOMMY_GREENHANDS","label":"Lommy","weight":14},{"id":"LORAS","label":"Loras","weight":611},{"id":"LUKE","label":"Luke","weight":4},{"id":"LYANNA","label":"Lyanna","weight":113},{"id":"LYSA","label":"Lysa","weight":333},{"id":"MACE","label":"Mac","weight":277},{"id":"MAESTER_AEMON","label":"Aemon","weight":200},{"id":"MAESTER_LUWIN","label":"Luwin","weight":263},{"id":"MAGO","label":"Mago","weight":18},{"id":"MARILLION","label":"Marillion","weight":34},{"id":"MASHA_HEDDLE","label":"Masha","weight":8},{"id":"MELESSA","label":"Melessa","weight":70},{"id":"MERYN_TRANT","label":"Meryn","weight":248},{"id":"MHAEGEN","label":"Mhaegen","weight":23},{"id":"MIRRI_MAZ_DUUR","label":"Mirri Maz Dur","weight":81},{"id":"MORD","label":"Mord","weight":52},{"id":"MOUNTAIN","label":"Gregor","weight":369},{"id":"MYCAH","label":"Mycah","weight":24},{"id":"MYRCELLA","label":"Myrcella","weight":224},{"id":"NED","label":"Ned","weight":1755},{"id":"OLD_NAN","label":"Old Nan","weight":26},{"id":"OSHA","label":"Osha","weight":426},{"id":"OTHELL_YARWYCK","label":"Othell","weight":60},{"id":"OTHOR","label":"Othor","weight":15},{"id":"PYCELLE","label":"Pycelle","weight":544},{"id":"PYP","label":"Pyp","weight":268},{"id":"QOTHO","label":"Qotho","weight":57},{"id":"RAKHARO","label":"Rakharo","weight":88},{"id":"RANDYLL","label":"Randyll","weight":168},{"id":"RAST","label":"Rast","weight":145},{"id":"RENLY","label":"Renly","weight":448},{"id":"RHAEGAR","label":"Rhaegar","weight":46},{"id":"RHAEGO","label":"Rhaego","weight":31},{"id":"RICKARD_KARSTARK","label":"Rickard Karstark","weight":145},{"id":"RICKARD_STARK","label":"Rickard Stark","weight":17},{"id":"RICKON","label":"Rickon","weight":258},{"id":"ROBB","label":"Robb","weight":1288},{"id":"ROBERT","label":"Robert","weight":754},{"id":"ROBIN","label":"Robin","weight":232},{"id":"RODRIK","label":"Rodrik","weight":164},{"id":"ROOSE_BOLTON","label":"Roose","weight":442},{"id":"ROS","label":"Ros","weight":207},{"id":"ROYCE","label":"Royce","weight":23},{"id":"RYGER_RIVERS","label":"Ryger","weight":4},{"id":"SAM","label":"Sam","weight":2062},{"id":"SANSA","label":"Sansa","weight":3607},{"id":"SEPTA_MORDANE","label":"Septa Mordane","weight":95},{"id":"SHAE","label":"Shae","weight":624},{"id":"SHAGGA","label":"Shagga","weight":35},{"id":"STABLE_BOY","label":"Stable Boy","weight":7},{"id":"STANNIS","label":"Stannis","weight":1142},{"id":"STEFFON","label":"Steffon","weight":4},{"id":"STEVRON_FREY","label":"Stevron","weight":6},{"id":"SYRIO_FOREL","label":"Syrio","weight":70},{"id":"THEON","label":"Theon","weight":1706},{"id":"TOBHO_MOTT","label":"Tobho Mott","weight":15},{"id":"TOMARD","label":"Tomard","weight":10},{"id":"TOMMEN","label":"Tommen","weight":637},{"id":"TYRION","label":"Tyrion","weight":5875},{"id":"TYSHA","label":"Tysha","weight":4},{"id":"TYWIN","label":"Tywin","weight":1499},{"id":"VARDIS_EGEN","label":"Vardis","weight":39},{"id":"VARLY","label":"Varly","weight":2},{"id":"VARYS","label":"Varys","weight":1756},{"id":"VISERYS","label":"Viserys","weight":215},{"id":"WALDER","label":"Walder","weight":262},{"id":"WAYMAR_ROYCE","label":"Waymar","weight":6},{"id":"WILL","label":"Will","weight":25},{"id":"WINE_MERCHANT","label":"Wine Merchant","weight":35},{"id":"YOREN","label":"Yoren","weight":135},{"id":"ALTON","label":"Alton","weight":93},{"id":"AMORY","label":"Amory","weight":46},{"id":"BARRA","label":"Barra","weight":6},{"id":"BILLY","label":"Billy","weight":2},{"id":"BITER","label":"Biter","weight":27},{"id":"BLACK_LORREN","label":"Black Lorren","weight":35},{"id":"BOROS","label":"Boros","weight":6},{"id":"BRIENNE","label":"Brienne","weight":1627},{"id":"CAPTAINS_DAUGHTER","label":"Captain\'s Daughter","weight":17},{"id":"COLEN","label":"Colen","weight":12},{"id":"CRASTER","label":"Craster","weight":177},{"id":"CRESSEN","label":"Cressen","weight":33},{"id":"DAGMER","label":"Dagmer","weight":82},{"id":"DAISY","label":"Daisy","weight":24},{"id":"DAVOS","label":"Davos","weight":1987},{"id":"DONTOS","label":"Dontos","weight":77},{"id":"DROWNED_PRIEST","label":"Drowned Priest","weight":5},{"id":"EDDISON_TOLLETT","label":"Eddison","weight":546},{"id":"FARLEN","label":"Farlen","weight":13},{"id":"FATHER_SEAWORTH","label":"Father Seaworth","weight":2},{"id":"FREY_DAUGHTER","label":"Frey Daughter","weight":2},{"id":"GERARD","label":"Gerard","weight":5},{"id":"GILLY","label":"Gilly","weight":717},{"id":"HARREN","label":"Harren","weight":2},{"id":"HAYLENE","label":"Haylene","weight":35},{"id":"JACKS","label":"Jacks","weight":17},{"id":"JAQEN","label":"Jaqen","weight":446},{"id":"KOVARRO","label":"Kovarro","weight":71},{"id":"LOMMY","label":"Lommy","weight":30},{"id":"MALAKKO","label":"Malakko","weight":11},{"id":"MANCE","label":"Mance","weight":238},{"id":"MANDON","label":"Mandon","weight":21},{"id":"MARGAERY","label":"Margaery","weight":1019},{"id":"MARYA","label":"Marya","weight":2},{"id":"MATTHOS","label":"Matthos","weight":109},{"id":"MELISANDRE","label":"Melisandre","weight":823},{"id":"PODRICK","label":"Podrick","weight":831},{"id":"POLLIVER","label":"Polliver","weight":83},{"id":"PORTAN","label":"Portan","weight":3},{"id":"PROTESTER","label":"Protester","weight":2},{"id":"PYATT_PREE","label":"Pyatt Pree","weight":43},{"id":"QHORIN","label":"Quorin","weight":141},{"id":"QUAITHE","label":"Quaithe","weight":24},{"id":"QUENT","label":"Quent","weight":3},{"id":"RAMSAY","label":"Ramsay","weight":774},{"id":"LORD_OF_BONES","label":"Lord of Bones","weight":73},{"id":"REGINALD","label":"Reginald","weight":10},{"id":"RENNICK","label":"Rennick","weight":2},{"id":"RHAENYS","label":"Rhaenys","weight":4},{"id":"RORGE","label":"Rorge","weight":51},{"id":"SALLADHOR","label":"Salladhor","weight":92},{"id":"SEPTON","label":"Septon","weight":5},{"id":"SILK_KING","label":"Silk King","weight":6},{"id":"SPICE_KING","label":"Spice King","weight":88},{"id":"TALISA","label":"Talisa","weight":320},{"id":"TICKLER","label":"Tickler","weight":13},{"id":"TIMETT","label":"Timett","weight":12},{"id":"TORRHEN","label":"Torrhen","weight":16},{"id":"TRYSTANE","label":"Trystane","weight":84},{"id":"VISENYA","label":"Visenya","weight":5},{"id":"WINTERFELL_SHEPHERD","label":"Shepherd","weight":13},{"id":"XARO","label":"Xaro","weight":152},{"id":"YARA","label":"Yara","weight":489},{"id":"YGRITTE","label":"Ygritte","weight":518},{"id":"ANGUY","label":"Anguy","weight":93},{"id":"LITTLE_SAM","label":"Little Sam","weight":184},{"id":"BALERION","label":"Balerion","weight":7},{"id":"BERT","label":"Bert","weight":2},{"id":"BLACK_WALDER","label":"Black Walder","weight":89},{"id":"BRYNDEN","label":"Brynden","weight":213},{"id":"DAARIO","label":"Daario","weight":518},{"id":"DESMOND","label":"Desmond","weight":6},{"id":"EDMURE","label":"Edmure","weight":262},{"id":"ELDRICK","label":"Eldrick","weight":2},{"id":"FARMER","label":"Farmer","weight":38},{"id":"FREY_SEPTON","label":"Frey Septon","weight":8},{"id":"GREIZHEN","label":"Greizhen","weight":11},{"id":"GREY_WORM","label":"Grey Worm","weight":968},{"id":"HOBB","label":"Hobb","weight":2},{"id":"JOJEN","label":"Jojen","weight":324},{"id":"KARL_TANNER","label":"Karl","weight":110},{"id":"KRAZNYS_MO_NAKLOZ","label":"Kraznys","weight":86},{"id":"LOCKE","label":"Locke","weight":183},{"id":"LOTHAR","label":"Lothar","weight":79},{"id":"MAREI","label":"Marei","weight":43},{"id":"MARTYN","label":"Martyn","weight":19},{"id":"MEERA","label":"Meera","weight":458},{"id":"MERO","label":"Mero","weight":60},{"id":"MERRY","label":"Merry","weight":3},{"id":"MISSANDEI","label":"Missandei","weight":999},{"id":"MYRANDA","label":"Myranda","weight":190},{"id":"OLENNA","label":"Olenna","weight":650},{"id":"OLYVAR","label":"Olyvar","weight":119},{"id":"ORELL","label":"Orell","weight":132},{"id":"PRENDAHL","label":"Prendahl","weight":33},{"id":"QHORIN_HALFHAND","label":"Qhorin","weight":4},{"id":"QYBURN","label":"Qyburn","weight":488},{"id":"RADZAI_MO_ERAZ","label":"Radzai","weight":24},{"id":"ROSLIN","label":"Roslin","weight":44},{"id":"RYLENE","label":"Rylene","weight":4},{"id":"SELWYN","label":"Selwyn","weight":13},{"id":"SELYSE","label":"Selyse","weight":184},{"id":"SHIREEN","label":"Shireen","weight":273},{"id":"SORCERER","label":"Sorcerer","weight":7},{"id":"STEELSHANKS_WALTON","label":"Steelshanks Walton","weight":21},{"id":"TARYN_MANT","label":"Taryn","weight":18},{"id":"THOROS","label":"Thoros","weight":356},{"id":"TORMUND","label":"Tormund","weight":1241},{"id":"TORTURER","label":"Torturer","weight":19},{"id":"VIOLET","label":"Violet","weight":36},{"id":"WILLEM_LANNISTER","label":"Willem","weight":8},{"id":"ADRACK_HUMBLE","label":"Adrack Humble","weight":6},{"id":"ANYA_WAYNWOOD","label":"Anya Waynwood","weight":49},{"id":"AXELL_FLORENT","label":"Axell Florent","weight":12},{"id":"BALON_DWARF","label":"Balon Dwarf","weight":21},{"id":"BLACK_JACK","label":"Black Jack","weight":8},{"id":"BOLTON_GUARD","label":"Bolton Guard","weight":10},{"id":"COOPER","label":"Cooper","weight":7},{"id":"CRASTERS_BABY","label":"Baby","weight":26},{"id":"DONGO_THE_GIANT","label":"Dongo the Giant","weight":9},{"id":"DONNEL_HILL","label":"Donnel Hill","weight":13},{"id":"DONNEL_WAYNWOOD","label":"Donnel Waynwood","weight":5},{"id":"DORAN","label":"Doran","weight":148},{"id":"DORNISH_LORD","label":"Dornish Lord","weight":9},{"id":"DYING_MAN","label":"Dying Man","weight":22},{"id":"ELDER_MEEREEN_SLAVE","label":"Meereen Statesman","weight":14},{"id":"ELIA","label":"Elia","weight":24},{"id":"ELLARIA","label":"Ellaria","weight":412},{"id":"ENDREW","label":"Endrew","weight":12},{"id":"FALYSE","label":"Falyse","weight":4},{"id":"FARMER_HAMLET","label":"Hamlet Farmer","weight":44},{"id":"FENNESZ","label":"Fennesz","weight":22},{"id":"FIRST_MATE","label":"First Mate","weight":14},{"id":"FOOL","label":"Fool","weight":6},{"id":"GOATHERD","label":"Goatherd","weight":19},{"id":"GOATHERDS_SON","label":"Goatherd\'s Son","weight":2},{"id":"GUYMON","label":"Guymon","weight":14},{"id":"HIZDAHR","label":"Hizdahr","weight":171},{"id":"HIZDAHRS_FATHER","label":"Hizdahr\'s Father","weight":11},{"id":"INNKEEPER","label":"Innkeeper","weight":10},{"id":"INNKEEPERS_DAUGHTER","label":"Innkeeper\'s Daughter","weight":4},{"id":"JOFFREY_DWARF","label":"Joffrey Dwarf","weight":28},{"id":"KEGS","label":"Kegs","weight":8},{"id":"LEAF","label":"Leaf","weight":74},{"id":"LHARA","label":"Lhara","weight":5},{"id":"LOLLYS","label":"Lollys","weight":24},{"id":"LUTHOR","label":"Luthor","weight":7},{"id":"MAG_THE_MIGHTY","label":"Mag the Mighty","weight":26},{"id":"MANSERVANT","label":"Manservant","weight":8},{"id":"MASTER_MIGHDAL","label":"Master Mighdal","weight":7},{"id":"MEEREEN_CHAMPION","label":"Meereen Champion","weight":13},{"id":"MEEREEN_SLAVE","label":"Meereen Slave","weight":7},{"id":"MOLES_TOWN_MADAM","label":"Mole\'s Town Madam","weight":14},{"id":"MOLES_TOWN_WHORE","label":"Mole\'s Town Whore","weight":33},{"id":"MORAG","label":"Morag","weight":28},{"id":"MORGAN","label":"Morgan","weight":58},{"id":"MORGANS_FRIEND","label":"Morgan\'s Friend","weight":24},{"id":"MOSSADOR","label":"Mossador","weight":63},{"id":"MULLY","label":"Mully","weight":8},{"id":"MUSICIAN","label":"Musician","weight":2},{"id":"NIGHT_KING","label":"Night King","weight":160},{"id":"OBERYN","label":"Oberyn","weight":501},{"id":"OLLY","label":"Olly","weight":228},{"id":"OLLYS_MOTHER","label":"Olly\'s Mother","weight":13},{"id":"ORSON","label":"Orson","weight":6},{"id":"ORYS","label":"Orys","weight":4},{"id":"ORYS_BROTHER","label":"Orys\'s Brother","weight":4},{"id":"RALF","label":"Ralf","weight":22},{"id":"RENLY_DWARF","label":"Renly Dwarf","weight":18},{"id":"ROBB_DWARF","label":"Robb Dwarf","weight":27},{"id":"SALLY","label":"Sally","weight":23},{"id":"SISSY","label":"Sissy","weight":39},{"id":"STANNIS_DWARF","label":"Stannis Dwarf","weight":18},{"id":"STYR","label":"Styr","weight":84},{"id":"TANSY","label":"Tansy","weight":27},{"id":"TERNESIO_TERYS","label":"Ternesio Terys","weight":17},{"id":"THENN_WARG","label":"Thenn Warg","weight":10},{"id":"THREE_EYED_RAVEN","label":"Three Eyed Raven","weight":166},{"id":"TOMMY","label":"Tommy","weight":8},{"id":"TYCHO","label":"Tycho","weight":107},{"id":"VANCE_CORBRAY","label":"Vance Corbray","weight":9},{"id":"VIOLA","label":"Viola","weight":4},{"id":"WALDA","label":"Walda","weight":78},{"id":"WHITE_WALKER","label":"White Walker","weight":12},{"id":"YOHN_ROYCE","label":"Yohn Royce","weight":293},{"id":"ZALA","label":"Zala","weight":2},{"id":"AREO","label":"Areo","weight":128},{"id":"BLACK_HAIRED_PROSTITUTE","label":"Strumpet","weight":17},{"id":"BRAND","label":"Brand","weight":17},{"id":"BRIAN","label":"Brian","weight":2},{"id":"CERWYN","label":"Cerwyn","weight":2},{"id":"DENYS","label":"Denys","weight":2},{"id":"DERRYK","label":"Derryk","weight":23},{"id":"DORNISH_RIDER","label":"Dornish Rider","weight":16},{"id":"HIGH_SPARROW","label":"High Sparrow","weight":423},{"id":"KARSI","label":"Karsi","weight":57},{"id":"LOBODA","label":"Loboda","weight":28},{"id":"LORD_WEEBLY","label":"Lord Weebly","weight":5},{"id":"LYANNA_MORMONT","label":"Lyanna Mormont","weight":264},{"id":"MADAME","label":"Madame","weight":8},{"id":"MAGGY","label":"Maggy","weight":24},{"id":"MAGNAR","label":"Magnar","weight":2},{"id":"MALKO","label":"Malko","weight":29},{"id":"MELARA","label":"Melara","weight":14},{"id":"NYMERIA","label":"Nymeria","weight":85},{"id":"OBARA","label":"Obara","weight":107},{"id":"OWNER","label":"Owner","weight":18},{"id":"QUICK","label":"Quick","weight":12},{"id":"RHAENYRA","label":"Rhaenyra","weight":2},{"id":"SEPTA_UNELLA","label":"Septa Unella","weight":68},{"id":"STRONG","label":"Strong","weight":12},{"id":"TANDA","label":"Tanda","weight":2},{"id":"THIN_MAN","label":"Thin Man","weight":32},{"id":"TYENE","label":"Tyene","weight":169},{"id":"WAIF","label":"Waif","weight":152},{"id":"WOLKAN","label":"Wolkan","weight":0},{"id":"AERON","label":"Aeron","weight":25},{"id":"ARTHUR","label":"Arthur","weight":22},{"id":"ARTHUR_CHILD","label":"Arthur (child)","weight":6},{"id":"BELICHO","label":"Belicho","weight":32},{"id":"BIANCA","label":"Bianca","weight":80},{"id":"BOBONO","label":"Bobono","weight":82},{"id":"CAMELLO","label":"Camello","weight":55},{"id":"CLARENZO","label":"Clarenzo","weight":73},{"id":"DICKON","label":"Dickon","weight":106},{"id":"DIM_DALBA","label":"Dim Dalba","weight":16},{"id":"DOM","label":"Dom","weight":8},{"id":"DOSH_KHALEEN_LEADER","label":"Dosh Khaleen Leader","weight":20},{"id":"EURON","label":"Euron","weight":323},{"id":"FLYNN","label":"Flynn","weight":6},{"id":"GATINS","label":"Gatins","weight":9},{"id":"GLOVER","label":"Glover","weight":21},{"id":"GUARD_CAPTAIN","label":"Guard Captain","weight":13},{"id":"HARALD","label":"Harald","weight":21},{"id":"HOWLAND","label":"Howland","weight":15},{"id":"IZEMBARO","label":"Izembaro","weight":80},{"id":"KHAL_MORO","label":"Khal Moro","weight":43},{"id":"KINVARA","label":"Kinvara","weight":28},{"id":"LADY_CRANE","label":"Lady Crane","weight":180},{"id":"LEM","label":"Lem","weight":27},{"id":"LHAZAREEN_WOMAN","label":"Lhazareen Woman","weight":30},{"id":"MAESTER_CITADEL","label":"Citadel Maester","weight":17},{"id":"MAESTER_DORNE","label":"Dorne Maester","weight":11},{"id":"MAESTER_MORMONT","label":"Mormont Maester","weight":21},{"id":"MAESTER_WOLKAN","label":"Wolkan","weight":180},{"id":"MANDERLY","label":"Manderly","weight":13},{"id":"MINISA","label":"Minisa","weight":2},{"id":"RAY","label":"Ray","weight":56},{"id":"RAZDAL","label":"Razdal","weight":46},{"id":"RED_PRIEST","label":"Red Priest","weight":10},{"id":"ROBETT","label":"Robett","weight":89},{"id":"SMALLJON","label":"Smalljon","weight":84},{"id":"SON_OF_EDMURE","label":"Edmure\'s Son","weight":8},{"id":"SON_OFWALDA","label":"Roose\'s Son","weight":21},{"id":"TALLA","label":"Talla","weight":38},{"id":"VALA","label":"Vala","weight":19},{"id":"WUN_WUN","label":"Wun Wun","weight":60},{"id":"YEZZAN","label":"Yezzan","weight":51},{"id":"ALYS","label":"Alys","weight":100},{"id":"HARRAG","label":"Harrag","weight":27},{"id":"MARWYN","label":"Marwin","weight":100},{"id":"NED_UMBER","label":"Ned Umber","weight":21},{"id":"QHONO","label":"Qhono","weight":88},{"id":"ALANNA","label":"Alanna","weight":2},{"id":"CERSEIS_BABY","label":"Cersei\'s Baby","weight":6},{"id":"CRAYAH","label":"Crayah","weight":27},{"id":"DIRAH","label":"Dirah","weight":20},{"id":"DORNISH_PRINCE","label":"Dornish Prince","weight":37},{"id":"HARRY","label":"Harry","weight":21},{"id":"IRONBORN_LORD","label":"Ironborn Lord","weight":36},{"id":"MARTHA","label":"Martha","weight":11},{"id":"NORA","label":"Nora","weight":48},{"id":"OWEN","label":"Owen","weight":6},{"id":"RIVERLANDS_LORD","label":"Riverlands Lord","weight":36},{"id":"SARRA","label":"Sarra","weight":9},{"id":"TEELA","label":"Teela","weight":16},{"id":"UNSULLIED_CAPTAIN","label":"Unsullied Captain","weight":5},{"id":"VALE_LORD","label":"Vale Lord","weight":36},{"id":"VICKY","label":"Vicky","weight":39},{"id":"WILLA","label":"Willa","weight":11},{"id":"WILLIAM","label":"William","weight":2}],"$":[{"directed":false,"source":"NED","target":"ROBERT","weight":211},{"directed":false,"source":"DAENERYS","target":"JORAH","weight":594},{"directed":false,"source":"JON","target":"SAM","weight":415},{"directed":false,"source":"LITTLEFINGER","target":"NED","weight":118},{"directed":false,"source":"NED","target":"VARYS","weight":104},{"directed":false,"source":"DAENERYS","target":"DROGO","weight":113},{"directed":false,"source":"ARYA","target":"NED","weight":110},{"directed":false,"source":"CATELYN","target":"ROBB","weight":232},{"directed":false,"source":"BRONN","target":"TYRION","weight":389},{"directed":false,"source":"CERSEI","target":"NED","weight":100},{"directed":false,"source":"CERSEI","target":"ROBERT","weight":98},{"directed":false,"source":"LITTLEFINGER","target":"VARYS","weight":98},{"directed":false,"source":"SHAE","target":"TYRION","weight":324},{"directed":false,"source":"CATELYN","target":"NED","weight":86},{"directed":false,"source":"JOFFREY","target":"SANSA","weight":187},{"directed":false,"source":"NED","target":"PYCELLE","weight":68},{"directed":false,"source":"DAENERYS","target":"VISERYS","weight":75},{"directed":false,"source":"SANSA","target":"SEPTA_MORDANE","weight":64},{"directed":false,"source":"TYRION","target":"TYWIN","weight":306},{"directed":false,"source":"JEOR","target":"JON","weight":111},{"directed":false,"source":"ROBB","target":"THEON","weight":89},{"directed":false,"source":"CERSEI","target":"JOFFREY","weight":217},{"directed":false,"source":"ARYA","target":"SANSA","weight":280},{"directed":false,"source":"BRAN","target":"MAESTER_LUWIN","weight":84},{"directed":false,"source":"JAIME","target":"NED","weight":62},{"directed":false,"source":"NED","target":"SANSA","weight":96},{"directed":false,"source":"BRAN","target":"ROBB","weight":59},{"directed":false,"source":"LORAS","target":"RENLY","weight":73},{"directed":false,"source":"CERSEI","target":"JAIME","weight":509},{"directed":false,"source":"DAENERYS","target":"MIRRI_MAZ_DUUR","weight":45},{"directed":false,"source":"JON","target":"TYRION","weight":268},{"directed":false,"source":"ARYA","target":"SYRIO_FOREL","weight":48},{"directed":false,"source":"JORY_CASSEL","target":"NED","weight":44},{"directed":false,"source":"JORAH","target":"VISERYS","weight":43},{"directed":false,"source":"JON","target":"PYP","weight":54},{"directed":false,"source":"CATELYN","target":"TYRION","weight":54},{"directed":false,"source":"ROS","target":"THEON","weight":40},{"directed":false,"source":"JOFFREY","target":"NED","weight":56},{"directed":false,"source":"CERSEI","target":"SANSA","weight":144},{"directed":false,"source":"GRENN","target":"PYP","weight":44},{"directed":false,"source":"CATELYN","target":"WALDER","weight":53},{"directed":false,"source":"DAENERYS","target":"DOREAH","weight":54},{"directed":false,"source":"JAIME","target":"TYRION","weight":358},{"directed":false,"source":"JAIME","target":"TYWIN","weight":148},{"directed":false,"source":"BENJEN","target":"JON","weight":40},{"directed":false,"source":"DAENERYS","target":"IRRI","weight":47},{"directed":false,"source":"GREATJON_UMBER","target":"ROBB","weight":31},{"directed":false,"source":"MORD","target":"TYRION","weight":31},{"directed":false,"source":"CATELYN","target":"LYSA","weight":41},{"directed":false,"source":"DOREAH","target":"VISERYS","weight":30},{"directed":false,"source":"JORAH","target":"RAKHARO","weight":30},{"directed":false,"source":"LYSA","target":"ROBIN","weight":47},{"directed":false,"source":"LYSA","target":"TYRION","weight":37},{"directed":false,"source":"NED","target":"RENLY","weight":30},{"directed":false,"source":"PYP","target":"SAM","weight":69},{"directed":false,"source":"RENLY","target":"ROBERT","weight":35},{"directed":false,"source":"BRAN","target":"NED","weight":61},{"directed":false,"source":"BRAN","target":"OSHA","weight":153},{"directed":false,"source":"JON","target":"NED","weight":79},{"directed":false,"source":"BRAN","target":"CATELYN","weight":44},{"directed":false,"source":"CATELYN","target":"JAIME","weight":70},{"directed":false,"source":"CATELYN","target":"RODRIK","weight":28},{"directed":false,"source":"DAENERYS","target":"QOTHO","weight":28},{"directed":false,"source":"JOFFREY","target":"ROBERT","weight":37},{"directed":false,"source":"JON","target":"MAESTER_AEMON","weight":55},{"directed":false,"source":"DROGO","target":"VISERYS","weight":27},{"directed":false,"source":"JAIME","target":"JORY_CASSEL","weight":27},{"directed":false,"source":"BRAN","target":"THEON","weight":107},{"directed":false,"source":"CATELYN","target":"LITTLEFINGER","weight":64},{"directed":false,"source":"CATELYN","target":"MAESTER_LUWIN","weight":26},{"directed":false,"source":"BARRISTAN","target":"NED","weight":25},{"directed":false,"source":"ILLYRIO","target":"VISERYS","weight":25},{"directed":false,"source":"JON","target":"ROBB","weight":35},{"directed":false,"source":"OSHA","target":"THEON","weight":61},{"directed":false,"source":"ARYA","target":"JOFFREY","weight":47},{"directed":false,"source":"GRENN","target":"JON","weight":82},{"directed":false,"source":"NED","target":"ROBB","weight":45},{"directed":false,"source":"BARRISTAN","target":"ROBERT","weight":27},{"directed":false,"source":"CATELYN","target":"CERSEI","weight":26},{"directed":false,"source":"LITTLEFINGER","target":"SANSA","weight":416},{"directed":false,"source":"SHAGGA","target":"TYRION","weight":22},{"directed":false,"source":"TYRION","target":"YOREN","weight":22},{"directed":false,"source":"ALLISER_THORNE","target":"JON","weight":133},{"directed":false,"source":"ARYA","target":"JON","weight":99},{"directed":false,"source":"DROGO","target":"JORAH","weight":22},{"directed":false,"source":"JAIME","target":"ROBERT","weight":23},{"directed":false,"source":"BRAN","target":"JON","weight":82},{"directed":false,"source":"DAENERYS","target":"WINE_MERCHANT","weight":19},{"directed":false,"source":"HOUND","target":"SANSA","weight":73},{"directed":false,"source":"LITTLEFINGER","target":"PYCELLE","weight":27},{"directed":false,"source":"LITTLEFINGER","target":"ROS","weight":35},{"directed":false,"source":"THEON","target":"TYRION","weight":49},{"directed":false,"source":"ALLISER_THORNE","target":"SAM","weight":41},{"directed":false,"source":"ARYA","target":"YOREN","weight":38},{"directed":false,"source":"CERSEI","target":"TYRION","weight":442},{"directed":false,"source":"BENJEN","target":"TYRION","weight":17},{"directed":false,"source":"DAENERYS","target":"RAKHARO","weight":29},{"directed":false,"source":"JEOR","target":"SAM","weight":43},{"directed":false,"source":"LITTLEFINGER","target":"RENLY","weight":39},{"directed":false,"source":"MAESTER_LUWIN","target":"ROBB","weight":17},{"directed":false,"source":"ROBERT","target":"SANSA","weight":19},{"directed":false,"source":"ROS","target":"TYRION","weight":20},{"directed":false,"source":"CATELYN","target":"THEON","weight":16},{"directed":false,"source":"GRENN","target":"SAM","weight":75},{"directed":false,"source":"HOUND","target":"JOFFREY","weight":73},{"directed":false,"source":"ROBB","target":"TYRION","weight":21},{"directed":false,"source":"BRAN","target":"TYRION","weight":72},{"directed":false,"source":"CATELYN","target":"ROBERT","weight":15},{"directed":false,"source":"JEOR","target":"TYRION","weight":19},{"directed":false,"source":"JOFFREY","target":"TYRION","weight":200},{"directed":false,"source":"JOFFREY","target":"VARYS","weight":28},{"directed":false,"source":"LANCEL","target":"ROBERT","weight":15},{"directed":false,"source":"MIRRI_MAZ_DUUR","target":"QOTHO","weight":15},{"directed":false,"source":"NED","target":"YOREN","weight":15},{"directed":false,"source":"PYCELLE","target":"VARYS","weight":37},{"directed":false,"source":"BENJEN","target":"NED","weight":24},{"directed":false,"source":"BRAN","target":"RICKON","weight":82},{"directed":false,"source":"CATELYN","target":"JON","weight":16},{"directed":false,"source":"CATELYN","target":"SANSA","weight":39},{"directed":false,"source":"JOFFREY","target":"MARILLION","weight":14},{"directed":false,"source":"KEVAN","target":"TYRION","weight":14},{"directed":false,"source":"LITTLEFINGER","target":"ROBERT","weight":14},{"directed":false,"source":"BARRISTAN","target":"CERSEI","weight":15},{"directed":false,"source":"CATELYN","target":"VARDIS_EGEN","weight":13},{"directed":false,"source":"CERSEI","target":"VARYS","weight":56},{"directed":false,"source":"DAENERYS","target":"RHAEGO","weight":17},{"directed":false,"source":"JANOS","target":"NED","weight":13},{"directed":false,"source":"JOFFREY","target":"PYCELLE","weight":26},{"directed":false,"source":"MAESTER_LUWIN","target":"THEON","weight":61},{"directed":false,"source":"NED","target":"THEON","weight":20},{"directed":false,"source":"PYCELLE","target":"SANSA","weight":18},{"directed":false,"source":"GENDRY","target":"NED","weight":14},{"directed":false,"source":"HOT_PIE","target":"LOMMY_GREENHANDS","weight":12},{"directed":false,"source":"JOFFREY","target":"LITTLEFINGER","weight":26},{"directed":false,"source":"JOFFREY","target":"MERYN_TRANT","weight":31},{"directed":false,"source":"JOFFREY","target":"ROBB","weight":31},{"directed":false,"source":"JON_ARRYN","target":"NED","weight":15},{"directed":false,"source":"KEVAN","target":"TYWIN","weight":23},{"directed":false,"source":"MAESTER_LUWIN","target":"OSHA","weight":26},{"directed":false,"source":"ARYA","target":"SEPTA_MORDANE","weight":11},{"directed":false,"source":"BRAN","target":"HODOR","weight":160},{"directed":false,"source":"BRONN","target":"SHAE","weight":18},{"directed":false,"source":"CATELYN","target":"GREATJON_UMBER","weight":11},{"directed":false,"source":"CATELYN","target":"VARYS","weight":11},{"directed":false,"source":"GREATJON_UMBER","target":"THEON","weight":11},{"directed":false,"source":"IRRI","target":"RAKHARO","weight":11},{"directed":false,"source":"MERYN_TRANT","target":"SYRIO_FOREL","weight":13},{"directed":false,"source":"NED","target":"TYRION","weight":30},{"directed":false,"source":"NED","target":"TYWIN","weight":13},{"directed":false,"source":"PYCELLE","target":"ROBERT","weight":14},{"directed":false,"source":"RENLY","target":"STANNIS","weight":54},{"directed":false,"source":"ROBB","target":"RODRIK","weight":16},{"directed":false,"source":"ROBERT","target":"VARYS","weight":16},{"directed":false,"source":"ALLISER_THORNE","target":"PYP","weight":18},{"directed":false,"source":"ARYA","target":"ROBERT","weight":15},{"directed":false,"source":"CATELYN","target":"ROBIN","weight":10},{"directed":false,"source":"DAENERYS","target":"ILLYRIO","weight":10},{"directed":false,"source":"DROGO","target":"MAGO","weight":10},{"directed":false,"source":"HOUND","target":"NED","weight":14},{"directed":false,"source":"HOUND","target":"TYRION","weight":50},{"directed":false,"source":"JAIME","target":"JON","weight":29},{"directed":false,"source":"JAIME","target":"ROBB","weight":46},{"directed":false,"source":"JEOR","target":"PYP","weight":10},{"directed":false,"source":"JOFFREY","target":"MYCAH","weight":10},{"directed":false,"source":"JORAH","target":"WINE_MERCHANT","weight":10},{"directed":false,"source":"MERYN_TRANT","target":"SANSA","weight":20},{"directed":false,"source":"NED","target":"RODRIK","weight":14},{"directed":false,"source":"NED","target":"STANNIS","weight":21},{"directed":false,"source":"NED","target":"TOBHO_MOTT","weight":10},{"directed":false,"source":"PYP","target":"RAST","weight":10},{"directed":false,"source":"ALLISER_THORNE","target":"JEOR","weight":9},{"directed":false,"source":"ARYA","target":"CERSEI","weight":34},{"directed":false,"source":"BRAN","target":"JAIME","weight":33},{"directed":false,"source":"BRAN","target":"OLD_NAN","weight":11},{"directed":false,"source":"CERSEI","target":"PYCELLE","weight":95},{"directed":false,"source":"DROGO","target":"MIRRI_MAZ_DUUR","weight":9},{"directed":false,"source":"ILLYRIO","target":"VARYS","weight":9},{"directed":false,"source":"IRRI","target":"JORAH","weight":11},{"directed":false,"source":"JEOR","target":"MAESTER_AEMON","weight":9},{"directed":false,"source":"MHAEGEN","target":"NED","weight":9},{"directed":false,"source":"NED","target":"SEPTA_MORDANE","weight":9},{"directed":false,"source":"PYCELLE","target":"ROS","weight":9},{"directed":false,"source":"RENLY","target":"VARYS","weight":9},{"directed":false,"source":"ROBB","target":"SANSA","weight":28},{"directed":false,"source":"ROBIN","target":"TYRION","weight":16},{"directed":false,"source":"RODRIK","target":"TYRION","weight":9},{"directed":false,"source":"VARDIS_EGEN","target":"TYRION","weight":9},{"directed":false,"source":"AERYS","target":"NED","weight":12},{"directed":false,"source":"BAELOR","target":"NED","weight":8},{"directed":false,"source":"CERSEI","target":"LITTLEFINGER","weight":103},{"directed":false,"source":"CERSEI","target":"ROBB","weight":14},{"directed":false,"source":"DAENERYS","target":"MAGO","weight":8},{"directed":false,"source":"DAREON","target":"PYP","weight":8},{"directed":false,"source":"HOUND","target":"MERYN_TRANT","weight":17},{"directed":false,"source":"JORAH","target":"MIRRI_MAZ_DUUR","weight":8},{"directed":false,"source":"OSHA","target":"ROBB","weight":10},{"directed":false,"source":"PYCELLE","target":"RENLY","weight":8},{"directed":false,"source":"ROBERT","target":"TYWIN","weight":15},{"directed":false,"source":"RODRIK","target":"THEON","weight":31},{"directed":false,"source":"SANSA","target":"VARYS","weight":39},{"directed":false,"source":"AERYS","target":"ROBERT","weight":16},{"directed":false,"source":"ALLISER_THORNE","target":"GRENN","weight":20},{"directed":false,"source":"ARYA","target":"CATELYN","weight":22},{"directed":false,"source":"ARYA","target":"GENDRY","weight":200},{"directed":false,"source":"ARYA","target":"HOUND","weight":314},{"directed":false,"source":"ARYA","target":"JORY_CASSEL","weight":7},{"directed":false,"source":"ARYA","target":"STABLE_BOY","weight":7},{"directed":false,"source":"ARYA","target":"VARYS","weight":14},{"directed":false,"source":"BRAN","target":"ROBERT","weight":7},{"directed":false,"source":"BRONN","target":"CATELYN","weight":7},{"directed":false,"source":"GREATJON_UMBER","target":"RODRIK","weight":7},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"JORY_CASSEL","weight":7},{"directed":false,"source":"JON","target":"RAST","weight":7},{"directed":false,"source":"JON","target":"THEON","weight":48},{"directed":false,"source":"JON_ARRYN","target":"ROBERT","weight":9},{"directed":false,"source":"JORY_CASSEL","target":"LITTLEFINGER","weight":7},{"directed":false,"source":"LYSA","target":"VARDIS_EGEN","weight":7},{"directed":false,"source":"MAESTER_AEMON","target":"TYRION","weight":7},{"directed":false,"source":"MAESTER_LUWIN","target":"TYRION","weight":7},{"directed":false,"source":"ROBERT","target":"TYRION","weight":10},{"directed":false,"source":"ROBERT","target":"VISERYS","weight":7},{"directed":false,"source":"ARYA","target":"ROBB","weight":18},{"directed":false,"source":"BARRISTAN","target":"VARYS","weight":8},{"directed":false,"source":"BRONN","target":"RODRIK","weight":6},{"directed":false,"source":"DROGO","target":"ILLYRIO","weight":6},{"directed":false,"source":"DROGO","target":"QOTHO","weight":6},{"directed":false,"source":"DROGO","target":"RHAEGO","weight":9},{"directed":false,"source":"GRENN","target":"RAST","weight":23},{"directed":false,"source":"GRENN","target":"TYRION","weight":6},{"directed":false,"source":"HOUND","target":"ROBERT","weight":6},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"NED","weight":6},{"directed":false,"source":"JAIME","target":"JOFFREY","weight":47},{"directed":false,"source":"JEOR","target":"OTHELL_YARWYCK","weight":6},{"directed":false,"source":"JEOR","target":"OTHOR","weight":6},{"directed":false,"source":"LITTLEFINGER","target":"MOUNTAIN","weight":6},{"directed":false,"source":"LITTLEFINGER","target":"TYRION","weight":70},{"directed":false,"source":"MAESTER_AEMON","target":"PYP","weight":8},{"directed":false,"source":"MAESTER_AEMON","target":"SAM","weight":61},{"directed":false,"source":"NED","target":"SYRIO_FOREL","weight":6},{"directed":false,"source":"NED","target":"TOMARD","weight":6},{"directed":false,"source":"OTHELL_YARWYCK","target":"SAM","weight":6},{"directed":false,"source":"PYP","target":"TYRION","weight":6},{"directed":false,"source":"RAST","target":"SAM","weight":19},{"directed":false,"source":"SHAGGA","target":"TYWIN","weight":6},{"directed":false,"source":"ARYA","target":"BAELOR","weight":5},{"directed":false,"source":"ARYA","target":"BRAN","weight":50},{"directed":false,"source":"ARYA","target":"HOT_PIE","weight":99},{"directed":false,"source":"ARYA","target":"LITTLEFINGER","weight":37},{"directed":false,"source":"ARYA","target":"MERYN_TRANT","weight":25},{"directed":false,"source":"ARYA","target":"MYCAH","weight":7},{"directed":false,"source":"BARRISTAN","target":"JOFFREY","weight":7},{"directed":false,"source":"BENJEN","target":"ROBB","weight":5},{"directed":false,"source":"BENJEN","target":"YOREN","weight":5},{"directed":false,"source":"BRAN","target":"RODRIK","weight":25},{"directed":false,"source":"BRONN","target":"LYSA","weight":5},{"directed":false,"source":"BRONN","target":"SHAGGA","weight":5},{"directed":false,"source":"BRONN","target":"TYWIN","weight":12},{"directed":false,"source":"CATELYN","target":"MORD","weight":5},{"directed":false,"source":"DAENERYS","target":"ROBERT","weight":13},{"directed":false,"source":"DOREAH","target":"IRRI","weight":9},{"directed":false,"source":"DROGO","target":"RAKHARO","weight":5},{"directed":false,"source":"GARED","target":"ROYCE","weight":5},{"directed":false,"source":"GENDRY","target":"TOBHO_MOTT","weight":5},{"directed":false,"source":"HOUND","target":"LITTLEFINGER","weight":5},{"directed":false,"source":"HOUND","target":"MOUNTAIN","weight":39},{"directed":false,"source":"JAIME","target":"KEVAN","weight":17},{"directed":false,"source":"JAIME","target":"LITTLEFINGER","weight":9},{"directed":false,"source":"JANOS","target":"VARYS","weight":8},{"directed":false,"source":"JOFFREY","target":"SEPTA_MORDANE","weight":5},{"directed":false,"source":"JON","target":"OTHELL_YARWYCK","weight":14},{"directed":false,"source":"JON","target":"OTHOR","weight":5},{"directed":false,"source":"JON_ARRYN","target":"LITTLEFINGER","weight":9},{"directed":false,"source":"JON_ARRYN","target":"LYSA","weight":13},{"directed":false,"source":"JONOS_BRACKEN","target":"ROBB","weight":5},{"directed":false,"source":"JORAH","target":"QOTHO","weight":5},{"directed":false,"source":"LYSA","target":"MORD","weight":5},{"directed":false,"source":"MAESTER_LUWIN","target":"NED","weight":5},{"directed":false,"source":"MARILLION","target":"RODRIK","weight":5},{"directed":false,"source":"MARILLION","target":"TYRION","weight":5},{"directed":false,"source":"MASHA_HEDDLE","target":"TYRION","weight":5},{"directed":false,"source":"MOUNTAIN","target":"NED","weight":5},{"directed":false,"source":"RENLY","target":"SANSA","weight":7},{"directed":false,"source":"ROBB","target":"ROBERT","weight":7},{"directed":false,"source":"ROBB","target":"TYWIN","weight":22},{"directed":false,"source":"ROBB","target":"WALDER","weight":35},{"directed":false,"source":"ROBERT","target":"STANNIS","weight":18},{"directed":false,"source":"AERYS","target":"RICKARD_STARK","weight":4},{"directed":false,"source":"ALLISER_THORNE","target":"RAST","weight":4},{"directed":false,"source":"ARYA","target":"ILYN_PAYNE","weight":6},{"directed":false,"source":"BAELOR","target":"YOREN","weight":4},{"directed":false,"source":"BARRISTAN","target":"JAIME","weight":4},{"directed":false,"source":"BARRISTAN","target":"LITTLEFINGER","weight":4},{"directed":false,"source":"BARRISTAN","target":"PYCELLE","weight":4},{"directed":false,"source":"BRAN","target":"CERSEI","weight":4},{"directed":false,"source":"BRONN","target":"VARDIS_EGEN","weight":4},{"directed":false,"source":"CATELYN","target":"JON_ARRYN","weight":6},{"directed":false,"source":"CATELYN","target":"MARILLION","weight":4},{"directed":false,"source":"CATELYN","target":"TYWIN","weight":6},{"directed":false,"source":"CERSEI","target":"HOUND","weight":22},{"directed":false,"source":"DAENERYS","target":"VARYS","weight":132},{"directed":false,"source":"DAREON","target":"JON","weight":4},{"directed":false,"source":"DAREON","target":"SAM","weight":6},{"directed":false,"source":"GARED","target":"WILL","weight":4},{"directed":false,"source":"GRENN","target":"JEOR","weight":11},{"directed":false,"source":"HOUND","target":"LORAS","weight":4},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"LITTLEFINGER","weight":4},{"directed":false,"source":"ILYN_PAYNE","target":"JOFFREY","weight":6},{"directed":false,"source":"ILYN_PAYNE","target":"NED","weight":6},{"directed":false,"source":"ILYN_PAYNE","target":"SANSA","weight":8},{"directed":false,"source":"ILYN_PAYNE","target":"YOREN","weight":4},{"directed":false,"source":"JAIME","target":"ROS","weight":4},{"directed":false,"source":"JAIME","target":"THEON","weight":8},{"directed":false,"source":"JORY_CASSEL","target":"ROBERT","weight":4},{"directed":false,"source":"LANCEL","target":"NED","weight":4},{"directed":false,"source":"LITTLEFINGER","target":"SEPTA_MORDANE","weight":4},{"directed":false,"source":"LITTLEFINGER","target":"TYWIN","weight":38},{"directed":false,"source":"LORAS","target":"MOUNTAIN","weight":4},{"directed":false,"source":"LORAS","target":"NED","weight":4},{"directed":false,"source":"LORAS","target":"SANSA","weight":37},{"directed":false,"source":"LYANNA","target":"NED","weight":41},{"directed":false,"source":"MIRRI_MAZ_DUUR","target":"RAKHARO","weight":4},{"directed":false,"source":"MOUNTAIN","target":"ROBERT","weight":4},{"directed":false,"source":"MOUNTAIN","target":"SANSA","weight":4},{"directed":false,"source":"MYCAH","target":"SANSA","weight":4},{"directed":false,"source":"NED","target":"RICKARD_STARK","weight":9},{"directed":false,"source":"OLD_NAN","target":"ROBB","weight":4},{"directed":false,"source":"ROYCE","target":"WILL","weight":4},{"directed":false,"source":"RYGER_RIVERS","target":"WALDER","weight":4},{"directed":false,"source":"SANSA","target":"YOREN","weight":4},{"directed":false,"source":"SHAE","target":"TYWIN","weight":29},{"directed":false,"source":"STEVRON_FREY","target":"WALDER","weight":4},{"directed":false,"source":"WAYMAR_ROYCE","target":"WILL","weight":4},{"directed":false,"source":"ADDAM_MARBRAND","target":"KEVAN","weight":3},{"directed":false,"source":"ADDAM_MARBRAND","target":"LEO_LEFFORD","weight":3},{"directed":false,"source":"AERYS","target":"JAIME","weight":13},{"directed":false,"source":"AERYS","target":"RHAEGAR","weight":3},{"directed":false,"source":"ALLISER_THORNE","target":"OTHELL_YARWYCK","weight":12},{"directed":false,"source":"ARYA","target":"JAIME","weight":8},{"directed":false,"source":"ARYA","target":"PYCELLE","weight":3},{"directed":false,"source":"ASSASSIN","target":"CATELYN","weight":3},{"directed":false,"source":"BAELOR","target":"ILYN_PAYNE","weight":3},{"directed":false,"source":"BALON","target":"THEON","weight":84},{"directed":false,"source":"BARRISTAN","target":"LANCEL","weight":3},{"directed":false,"source":"BARRISTAN","target":"RENLY","weight":3},{"directed":false,"source":"BERIC","target":"NED","weight":8},{"directed":false,"source":"BRAN","target":"WILL","weight":3},{"directed":false,"source":"BRANDON_STARK","target":"NED","weight":3},{"directed":false,"source":"BRONN","target":"MORD","weight":3},{"directed":false,"source":"BRONN","target":"ROBIN","weight":3},{"directed":false,"source":"CATELYN","target":"HOSTER","weight":13},{"directed":false,"source":"CATELYN","target":"JOFFREY","weight":8},{"directed":false,"source":"CATELYN","target":"MASHA_HEDDLE","weight":3},{"directed":false,"source":"CATELYN","target":"YOREN","weight":3},{"directed":false,"source":"CERSEI","target":"ILYN_PAYNE","weight":8},{"directed":false,"source":"CERSEI","target":"JON","weight":30},{"directed":false,"source":"CERSEI","target":"JON_ARRYN","weight":3},{"directed":false,"source":"CERSEI","target":"LANCEL","weight":60},{"directed":false,"source":"CERSEI","target":"RENLY","weight":3},{"directed":false,"source":"CERSEI","target":"TYWIN","weight":214},{"directed":false,"source":"COHOLLO","target":"DROGO","weight":3},{"directed":false,"source":"DAENERYS","target":"NED","weight":6},{"directed":false,"source":"DOREAH","target":"DROGO","weight":3},{"directed":false,"source":"DOREAH","target":"WINE_MERCHANT","weight":3},{"directed":false,"source":"GENDRY","target":"HOT_PIE","weight":40},{"directed":false,"source":"GREATJON_UMBER","target":"JAIME","weight":3},{"directed":false,"source":"GREATJON_UMBER","target":"TYWIN","weight":3},{"directed":false,"source":"HODOR","target":"ROBB","weight":3},{"directed":false,"source":"HODOR","target":"THEON","weight":8},{"directed":false,"source":"HODOR","target":"TYRION","weight":3},{"directed":false,"source":"HOSTER","target":"WALDER","weight":6},{"directed":false,"source":"HOUND","target":"ILYN_PAYNE","weight":5},{"directed":false,"source":"IRRI","target":"JHIQUI","weight":3},{"directed":false,"source":"IRRI","target":"VISERYS","weight":3},{"directed":false,"source":"JANOS","target":"RENLY","weight":3},{"directed":false,"source":"JEOR","target":"NED","weight":3},{"directed":false,"source":"JEOR","target":"ROBERT","weight":3},{"directed":false,"source":"JOFFREY","target":"RENLY","weight":13},{"directed":false,"source":"JOFFREY","target":"TYWIN","weight":98},{"directed":false,"source":"JOFFREY","target":"YOREN","weight":3},{"directed":false,"source":"JON","target":"ROBERT","weight":6},{"directed":false,"source":"JON","target":"WILL","weight":3},{"directed":false,"source":"JON_ARRYN","target":"PYCELLE","weight":5},{"directed":false,"source":"JON_ARRYN","target":"ROBIN","weight":5},{"directed":false,"source":"JORAH","target":"RHAEGO","weight":3},{"directed":false,"source":"LITTLEFINGER","target":"STANNIS","weight":16},{"directed":false,"source":"LORAS","target":"ROBERT","weight":3},{"directed":false,"source":"LYANNA","target":"ROBERT","weight":5},{"directed":false,"source":"MERYN_TRANT","target":"NED","weight":3},{"directed":false,"source":"MORD","target":"ROBIN","weight":3},{"directed":false,"source":"MORD","target":"VARDIS_EGEN","weight":3},{"directed":false,"source":"MYCAH","target":"NED","weight":3},{"directed":false,"source":"MYRCELLA","target":"TYRION","weight":16},{"directed":false,"source":"NED","target":"PYP","weight":3},{"directed":false,"source":"NED","target":"WILL","weight":3},{"directed":false,"source":"OSHA","target":"RICKON","weight":34},{"directed":false,"source":"QOTHO","target":"RAKHARO","weight":3},{"directed":false,"source":"RAKHARO","target":"VISERYS","weight":3},{"directed":false,"source":"RAKHARO","target":"WINE_MERCHANT","weight":3},{"directed":false,"source":"RAST","target":"TYRION","weight":3},{"directed":false,"source":"RENLY","target":"ROBB","weight":11},{"directed":false,"source":"RICKON","target":"ROBB","weight":5},{"directed":false,"source":"ROBIN","target":"VARDIS_EGEN","weight":3},{"directed":false,"source":"THEON","target":"WALDER","weight":3},{"directed":false,"source":"VARYS","target":"YOREN","weight":3},{"directed":false,"source":"ADDAM_MARBRAND","target":"TYWIN","weight":2},{"directed":false,"source":"AEGON","target":"AERYS","weight":2},{"directed":false,"source":"AEGON","target":"MAESTER_AEMON","weight":5},{"directed":false,"source":"AERYS","target":"BARRISTAN","weight":7},{"directed":false,"source":"AERYS","target":"CATELYN","weight":2},{"directed":false,"source":"AERYS","target":"JORAH","weight":2},{"directed":false,"source":"AERYS","target":"MAESTER_AEMON","weight":2},{"directed":false,"source":"AERYS","target":"RENLY","weight":2},{"directed":false,"source":"AERYS","target":"SANSA","weight":4},{"directed":false,"source":"AERYS","target":"SEPTA_MORDANE","weight":2},{"directed":false,"source":"ALLISER_THORNE","target":"MAESTER_AEMON","weight":17},{"directed":false,"source":"ARYA","target":"ILLYRIO","weight":2},{"directed":false,"source":"ARYA","target":"LOMMY_GREENHANDS","weight":2},{"directed":false,"source":"ARYA","target":"TYRION","weight":18},{"directed":false,"source":"ASSASSIN","target":"BRAN","weight":2},{"directed":false,"source":"ASSASSIN","target":"ROBB","weight":2},{"directed":false,"source":"BAELOR","target":"CERSEI","weight":2},{"directed":false,"source":"BAELOR","target":"HOUND","weight":2},{"directed":false,"source":"BAELOR","target":"JOFFREY","weight":4},{"directed":false,"source":"BAELOR","target":"PYCELLE","weight":2},{"directed":false,"source":"BAELOR","target":"SANSA","weight":2},{"directed":false,"source":"BALON","target":"TYRION","weight":2},{"directed":false,"source":"BENJEN","target":"CATELYN","weight":2},{"directed":false,"source":"BENJEN","target":"CERSEI","weight":2},{"directed":false,"source":"BENJEN","target":"JEOR","weight":2},{"directed":false,"source":"BENJEN","target":"ROBERT","weight":2},{"directed":false,"source":"BERIC","target":"ROBERT","weight":2},{"directed":false,"source":"BORCAS","target":"DAREON","weight":2},{"directed":false,"source":"BORCAS","target":"PYP","weight":2},{"directed":false,"source":"BOWEN_MARSH","target":"DAREON","weight":2},{"directed":false,"source":"BOWEN_MARSH","target":"PYP","weight":2},{"directed":false,"source":"BRAN","target":"BRANDON_STARK","weight":2},{"directed":false,"source":"BRAN","target":"HOUND","weight":2},{"directed":false,"source":"BRANDON_STARK","target":"CATELYN","weight":5},{"directed":false,"source":"BRANDON_STARK","target":"JON","weight":2},{"directed":false,"source":"BRANDON_STARK","target":"RICKARD_STARK","weight":2},{"directed":false,"source":"BRONN","target":"KEVAN","weight":2},{"directed":false,"source":"BRONN","target":"MARILLION","weight":2},{"directed":false,"source":"CATELYN","target":"DAENERYS","weight":2},{"directed":false,"source":"CATELYN","target":"HOUND","weight":4},{"directed":false,"source":"CATELYN","target":"STEVRON_FREY","weight":2},{"directed":false,"source":"CERSEI","target":"JEOR","weight":2},{"directed":false,"source":"CERSEI","target":"LYANNA","weight":2},{"directed":false,"source":"CERSEI","target":"MERYN_TRANT","weight":30},{"directed":false,"source":"CERSEI","target":"ROS","weight":2},{"directed":false,"source":"CERSEI","target":"STANNIS","weight":9},{"directed":false,"source":"CERSEI","target":"YOREN","weight":2},{"directed":false,"source":"DAENERYS","target":"JHIQUI","weight":2},{"directed":false,"source":"DAENERYS","target":"SANSA","weight":73},{"directed":false,"source":"DAREON","target":"GRENN","weight":2},{"directed":false,"source":"DAREON","target":"JEOR","weight":2},{"directed":false,"source":"DAREON","target":"LUKE","weight":2},{"directed":false,"source":"DAREON","target":"MAESTER_AEMON","weight":2},{"directed":false,"source":"DAREON","target":"RAST","weight":2},{"directed":false,"source":"DOREAH","target":"IROGENIA","weight":2},{"directed":false,"source":"DOREAH","target":"JHIQUI","weight":2},{"directed":false,"source":"DOREAH","target":"JORAH","weight":9},{"directed":false,"source":"DROGO","target":"IRRI","weight":2},{"directed":false,"source":"DROGO","target":"ROBERT","weight":2},{"directed":false,"source":"GALBART_GLOVER","target":"GREATJON_UMBER","weight":2},{"directed":false,"source":"GALBART_GLOVER","target":"JONOS_BRACKEN","weight":2},{"directed":false,"source":"GALBART_GLOVER","target":"ROBB","weight":2},{"directed":false,"source":"GENDRY","target":"VARYS","weight":2},{"directed":false,"source":"GENDRY","target":"YOREN","weight":9},{"directed":false,"source":"GREATJON_UMBER","target":"NED","weight":2},{"directed":false,"source":"GREATJON_UMBER","target":"RENLY","weight":2},{"directed":false,"source":"GREATJON_UMBER","target":"RICKARD_KARSTARK","weight":2},{"directed":false,"source":"GREATJON_UMBER","target":"STANNIS","weight":2},{"directed":false,"source":"GREATJON_UMBER","target":"WALDER","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"NED","weight":2},{"directed":false,"source":"HODOR","target":"OSHA","weight":38},{"directed":false,"source":"HOUND","target":"JAIME","weight":15},{"directed":false,"source":"HOUND","target":"ROBB","weight":4},{"directed":false,"source":"HOUND","target":"YOREN","weight":2},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"JON_ARRYN","weight":2},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"MOUNTAIN","weight":2},{"directed":false,"source":"HUGH_OF_THE_VALE","target":"SANSA","weight":2},{"directed":false,"source":"ILLYRIO","target":"JORAH","weight":2},{"directed":false,"source":"ILYN_PAYNE","target":"MERYN_TRANT","weight":4},{"directed":false,"source":"ILYN_PAYNE","target":"VARYS","weight":2},{"directed":false,"source":"JAIME","target":"JON_ARRYN","weight":2},{"directed":false,"source":"JAIME","target":"RICKARD_STARK","weight":2},{"directed":false,"source":"JAIME","target":"SANSA","weight":30},{"directed":false,"source":"JAIME","target":"TYSHA","weight":2},{"directed":false,"source":"JANOS","target":"LITTLEFINGER","weight":6},{"directed":false,"source":"JANOS","target":"PYCELLE","weight":4},{"directed":false,"source":"JAREMY_RYKKER","target":"JEOR","weight":2},{"directed":false,"source":"JAREMY_RYKKER","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"JAREMY_RYKKER","target":"PYP","weight":2},{"directed":false,"source":"JEOR","target":"JOFFREY","weight":2},{"directed":false,"source":"JOANNA","target":"TYRION","weight":2},{"directed":false,"source":"JOFFREY","target":"JON","weight":2},{"directed":false,"source":"JOFFREY","target":"TOMMEN","weight":26},{"directed":false,"source":"JOFFREY","target":"WILL","weight":2},{"directed":false,"source":"JON","target":"RODRIK","weight":2},{"directed":false,"source":"JON","target":"ROS","weight":2},{"directed":false,"source":"JON_ARRYN","target":"VARYS","weight":2},{"directed":false,"source":"JORAH","target":"LITTLE_BIRD","weight":2},{"directed":false,"source":"JORAH","target":"NED","weight":2},{"directed":false,"source":"JORAH","target":"VARYS","weight":25},{"directed":false,"source":"JORY_CASSEL","target":"MHAEGEN","weight":2},{"directed":false,"source":"JORY_CASSEL","target":"THEON","weight":2},{"directed":false,"source":"JOYEUSE","target":"WALDER","weight":6},{"directed":false,"source":"KEVAN","target":"LEO_LEFFORD","weight":2},{"directed":false,"source":"KEVAN","target":"SHAGGA","weight":2},{"directed":false,"source":"LANCEL","target":"RENLY","weight":2},{"directed":false,"source":"LEO_LEFFORD","target":"TYRION","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"LORAS","weight":19},{"directed":false,"source":"LITTLEFINGER","target":"MHAEGEN","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"YOREN","weight":2},{"directed":false,"source":"LORAS","target":"MACE","weight":8},{"directed":false,"source":"LUKE","target":"PYP","weight":2},{"directed":false,"source":"MAESTER_LUWIN","target":"ROBERT","weight":2},{"directed":false,"source":"MAESTER_LUWIN","target":"RODRIK","weight":7},{"directed":false,"source":"MAESTER_LUWIN","target":"SANSA","weight":2},{"directed":false,"source":"MARILLION","target":"MERYN_TRANT","weight":2},{"directed":false,"source":"MARILLION","target":"YOREN","weight":2},{"directed":false,"source":"MELESSA","target":"SAM","weight":25},{"directed":false,"source":"MORD","target":"RODRIK","weight":2},{"directed":false,"source":"NED","target":"ROOSE_BOLTON","weight":2},{"directed":false,"source":"NED","target":"ROS","weight":2},{"directed":false,"source":"NED","target":"STEFFON","weight":2},{"directed":false,"source":"NED","target":"VARLY","weight":2},{"directed":false,"source":"OLD_NAN","target":"THEON","weight":2},{"directed":false,"source":"OTHELL_YARWYCK","target":"PYP","weight":2},{"directed":false,"source":"OTHOR","target":"PYP","weight":2},{"directed":false,"source":"OTHOR","target":"SAM","weight":2},{"directed":false,"source":"PYCELLE","target":"TYWIN","weight":28},{"directed":false,"source":"PYCELLE","target":"YOREN","weight":2},{"directed":false,"source":"RANDYLL","target":"SAM","weight":30},{"directed":false,"source":"RENLY","target":"TOMARD","weight":2},{"directed":false,"source":"RHAEGAR","target":"ROBERT","weight":6},{"directed":false,"source":"RHAEGO","target":"VISERYS","weight":2},{"directed":false,"source":"RICKARD_KARSTARK","target":"ROBB","weight":52},{"directed":false,"source":"RICKARD_KARSTARK","target":"THEON","weight":4},{"directed":false,"source":"ROBB","target":"STANNIS","weight":11},{"directed":false,"source":"ROBB","target":"VARYS","weight":4},{"directed":false,"source":"ROBERT","target":"ROS","weight":2},{"directed":false,"source":"ROBERT","target":"TOMMEN","weight":4},{"directed":false,"source":"RODRIK","target":"TYWIN","weight":2},{"directed":false,"source":"SANSA","target":"STANNIS","weight":8},{"directed":false,"source":"STANNIS","target":"TOMARD","weight":2},{"directed":false,"source":"THEON","target":"WILL","weight":2},{"directed":false,"source":"TYRION","target":"TYSHA","weight":2},{"directed":false,"source":"TYRION","target":"VARYS","weight":511},{"directed":false,"source":"ARYA","target":"JAQEN","weight":346},{"directed":false,"source":"DAVOS","target":"STANNIS","weight":316},{"directed":false,"source":"JON","target":"YGRITTE","weight":286},{"directed":false,"source":"ROBB","target":"TALISA","weight":197},{"directed":false,"source":"ARYA","target":"TYWIN","weight":103},{"directed":false,"source":"THEON","target":"YARA","weight":218},{"directed":false,"source":"DAENERYS","target":"XARO","weight":80},{"directed":false,"source":"JON","target":"QHORIN","weight":73},{"directed":false,"source":"SANSA","target":"SHAE","weight":122},{"directed":false,"source":"DAENERYS","target":"SPICE_KING","weight":58},{"directed":false,"source":"DAVOS","target":"MATTHOS","weight":59},{"directed":false,"source":"MELISANDRE","target":"STANNIS","weight":171},{"directed":false,"source":"BRIENNE","target":"CATELYN","weight":73},{"directed":false,"source":"BRIENNE","target":"JAIME","weight":397},{"directed":false,"source":"PYCELLE","target":"TYRION","weight":64},{"directed":false,"source":"DAGMER","target":"THEON","weight":48},{"directed":false,"source":"ALTON","target":"JAIME","weight":48},{"directed":false,"source":"DAVOS","target":"MELISANDRE","weight":183},{"directed":false,"source":"JANOS","target":"TYRION","weight":39},{"directed":false,"source":"LORAS","target":"TYRION","weight":51},{"directed":false,"source":"LANCEL","target":"TYRION","weight":37},{"directed":false,"source":"PODRICK","target":"TYRION","weight":186},{"directed":false,"source":"MARGAERY","target":"RENLY","weight":39},{"directed":false,"source":"EDDISON_TOLLETT","target":"SAM","weight":72},{"directed":false,"source":"ROBB","target":"ROOSE_BOLTON","weight":51},{"directed":false,"source":"BRIENNE","target":"RENLY","weight":39},{"directed":false,"source":"DAENERYS","target":"KOVARRO","weight":31},{"directed":false,"source":"CATELYN","target":"RENLY","weight":30},{"directed":false,"source":"CRASTER","target":"JEOR","weight":46},{"directed":false,"source":"LITTLEFINGER","target":"MARGAERY","weight":28},{"directed":false,"source":"QHORIN","target":"YGRITTE","weight":28},{"directed":false,"source":"DAVOS","target":"SALLADHOR","weight":69},{"directed":false,"source":"EDDISON_TOLLETT","target":"GRENN","weight":70},{"directed":false,"source":"CERSEI","target":"TOMMEN","weight":160},{"directed":false,"source":"SANSA","target":"TYRION","weight":249},{"directed":false,"source":"GILLY","target":"SAM","weight":392},{"directed":false,"source":"DAENERYS","target":"PYATT_PREE","weight":23},{"directed":false,"source":"LORAS","target":"MARGAERY","weight":115},{"directed":false,"source":"ALTON","target":"ROBB","weight":22},{"directed":false,"source":"ROS","target":"VARYS","weight":47},{"directed":false,"source":"BLACK_LORREN","target":"THEON","weight":21},{"directed":false,"source":"CERSEI","target":"SHAE","weight":28},{"directed":false,"source":"MATTHOS","target":"STANNIS","weight":21},{"directed":false,"source":"SPICE_KING","target":"XARO","weight":20},{"directed":false,"source":"STANNIS","target":"TYRION","weight":20},{"directed":false,"source":"JORAH","target":"QUAITHE","weight":18},{"directed":false,"source":"CAPTAINS_DAUGHTER","target":"THEON","weight":17},{"directed":false,"source":"CATELYN","target":"RICKARD_KARSTARK","weight":22},{"directed":false,"source":"CRASTER","target":"JON","weight":28},{"directed":false,"source":"DAISY","target":"ROS","weight":17},{"directed":false,"source":"AMORY","target":"ARYA","weight":16},{"directed":false,"source":"ARYA","target":"RORGE","weight":20},{"directed":false,"source":"CRESSEN","target":"DAVOS","weight":16},{"directed":false,"source":"HODOR","target":"RICKON","weight":25},{"directed":false,"source":"LORD_OF_BONES","target":"YGRITTE","weight":20},{"directed":false,"source":"BALON","target":"YARA","weight":49},{"directed":false,"source":"JORAH","target":"KOVARRO","weight":15},{"directed":false,"source":"AMORY","target":"TYWIN","weight":14},{"directed":false,"source":"MATTHOS","target":"SALLADHOR","weight":14},{"directed":false,"source":"BRONN","target":"HOUND","weight":16},{"directed":false,"source":"CATELYN","target":"STANNIS","weight":13},{"directed":false,"source":"DONTOS","target":"JOFFREY","weight":19},{"directed":false,"source":"DOREAH","target":"XARO","weight":13},{"directed":false,"source":"HAYLENE","target":"TYRION","weight":13},{"directed":false,"source":"JEOR","target":"QHORIN","weight":13},{"directed":false,"source":"MERYN_TRANT","target":"TYRION","weight":29},{"directed":false,"source":"CERSEI","target":"MYRCELLA","weight":34},{"directed":false,"source":"DAVOS","target":"RENLY","weight":12},{"directed":false,"source":"JOFFREY","target":"LANCEL","weight":12},{"directed":false,"source":"JON","target":"LORD_OF_BONES","weight":20},{"directed":false,"source":"JORAH","target":"XARO","weight":12},{"directed":false,"source":"MOUNTAIN","target":"TYWIN","weight":20},{"directed":false,"source":"BRONN","target":"VARYS","weight":16},{"directed":false,"source":"CATELYN","target":"TALISA","weight":44},{"directed":false,"source":"CERSEI","target":"JANOS","weight":11},{"directed":false,"source":"SHAE","target":"VARYS","weight":33},{"directed":false,"source":"BRONN","target":"HAYLENE","weight":10},{"directed":false,"source":"CRESSEN","target":"MELISANDRE","weight":10},{"directed":false,"source":"GILLY","target":"JON","weight":25},{"directed":false,"source":"HOT_PIE","target":"LOMMY","weight":10},{"directed":false,"source":"KOVARRO","target":"XARO","weight":10},{"directed":false,"source":"PODRICK","target":"VARYS","weight":17},{"directed":false,"source":"QHORIN","target":"LORD_OF_BONES","weight":10},{"directed":false,"source":"ALTON","target":"CERSEI","weight":9},{"directed":false,"source":"BRONN","target":"JOFFREY","weight":15},{"directed":false,"source":"CATELYN","target":"LORAS","weight":9},{"directed":false,"source":"HODOR","target":"MAESTER_LUWIN","weight":9},{"directed":false,"source":"HOUND","target":"LANCEL","weight":9},{"directed":false,"source":"JAQEN","target":"RORGE","weight":9},{"directed":false,"source":"JOFFREY","target":"ROS","weight":9},{"directed":false,"source":"JOFFREY","target":"STANNIS","weight":14},{"directed":false,"source":"MANCE","target":"QHORIN","weight":9},{"directed":false,"source":"PYATT_PREE","target":"XARO","weight":9},{"directed":false,"source":"SANSA","target":"TOMMEN","weight":13},{"directed":false,"source":"AMORY","target":"YOREN","weight":8},{"directed":false,"source":"ARYA","target":"BITER","weight":8},{"directed":false,"source":"BALON","target":"ROBB","weight":10},{"directed":false,"source":"BITER","target":"RORGE","weight":10},{"directed":false,"source":"CATELYN","target":"JACKS","weight":8},{"directed":false,"source":"EDDISON_TOLLETT","target":"JON","weight":117},{"directed":false,"source":"JOFFREY","target":"LORAS","weight":19},{"directed":false,"source":"JOFFREY","target":"MYRCELLA","weight":8},{"directed":false,"source":"MANDON","target":"TYRION","weight":8},{"directed":false,"source":"MELISANDRE","target":"RENLY","weight":8},{"directed":false,"source":"REGINALD","target":"TYWIN","weight":8},{"directed":false,"source":"ARYA","target":"POLLIVER","weight":26},{"directed":false,"source":"BLACK_LORREN","target":"DAGMER","weight":7},{"directed":false,"source":"BRIENNE","target":"JACKS","weight":7},{"directed":false,"source":"BRIENNE","target":"LORAS","weight":9},{"directed":false,"source":"DAISY","target":"JOFFREY","weight":7},{"directed":false,"source":"THEON","target":"WINTERFELL_SHEPHERD","weight":7},{"directed":false,"source":"ARYA","target":"LOMMY","weight":8},{"directed":false,"source":"ARYA","target":"MOUNTAIN","weight":10},{"directed":false,"source":"BRAN","target":"DAGMER","weight":6},{"directed":false,"source":"BRAN","target":"FARLEN","weight":6},{"directed":false,"source":"BRONN","target":"LANCEL","weight":6},{"directed":false,"source":"BRONN","target":"PYCELLE","weight":8},{"directed":false,"source":"CRASTER","target":"GILLY","weight":6},{"directed":false,"source":"GENDRY","target":"TICKLER","weight":6},{"directed":false,"source":"LOMMY","target":"POLLIVER","weight":6},{"directed":false,"source":"MANCE","target":"YGRITTE","weight":16},{"directed":false,"source":"MANDON","target":"PODRICK","weight":6},{"directed":false,"source":"RICKON","target":"THEON","weight":13},{"directed":false,"source":"ROOSE_BOLTON","target":"TALISA","weight":13},{"directed":false,"source":"ALTON","target":"TORRHEN","weight":5},{"directed":false,"source":"ARYA","target":"TICKLER","weight":5},{"directed":false,"source":"BALON","target":"NED","weight":5},{"directed":false,"source":"BITER","target":"JAQEN","weight":5},{"directed":false,"source":"BRIENNE","target":"MARGAERY","weight":17},{"directed":false,"source":"BRIENNE","target":"ROBB","weight":5},{"directed":false,"source":"BRIENNE","target":"STANNIS","weight":18},{"directed":false,"source":"BRONN","target":"MERYN_TRANT","weight":13},{"directed":false,"source":"CATELYN","target":"MARGAERY","weight":5},{"directed":false,"source":"CERSEI","target":"LORAS","weight":48},{"directed":false,"source":"CRASTER","target":"SAM","weight":13},{"directed":false,"source":"CRESSEN","target":"STANNIS","weight":5},{"directed":false,"source":"DAGMER","target":"MAESTER_LUWIN","weight":5},{"directed":false,"source":"DROWNED_PRIEST","target":"THEON","weight":5},{"directed":false,"source":"GERARD","target":"RENLY","weight":5},{"directed":false,"source":"JOFFREY","target":"PODRICK","weight":10},{"directed":false,"source":"JON","target":"MANCE","weight":124},{"directed":false,"source":"JORAH","target":"PYATT_PREE","weight":5},{"directed":false,"source":"LORAS","target":"STANNIS","weight":5},{"directed":false,"source":"MYRCELLA","target":"SANSA","weight":5},{"directed":false,"source":"MYRCELLA","target":"TOMMEN","weight":9},{"directed":false,"source":"PYCELLE","target":"TIMETT","weight":5},{"directed":false,"source":"QHORIN","target":"SAM","weight":5},{"directed":false,"source":"TYWIN","target":"VARYS","weight":33},{"directed":false,"source":"ALTON","target":"RICKARD_KARSTARK","weight":4},{"directed":false,"source":"BARRA","target":"MHAEGEN","weight":4},{"directed":false,"source":"BRONN","target":"SANSA","weight":7},{"directed":false,"source":"BRONN","target":"TIMETT","weight":4},{"directed":false,"source":"CATELYN","target":"COLEN","weight":4},{"directed":false,"source":"CATELYN","target":"ROOSE_BOLTON","weight":17},{"directed":false,"source":"CERSEI","target":"PODRICK","weight":9},{"directed":false,"source":"DAENERYS","target":"QUAITHE","weight":4},{"directed":false,"source":"DAENERYS","target":"SILK_KING","weight":4},{"directed":false,"source":"DAGMER","target":"RICKON","weight":4},{"directed":false,"source":"DONTOS","target":"MERYN_TRANT","weight":4},{"directed":false,"source":"DOREAH","target":"KOVARRO","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"GILLY","weight":8},{"directed":false,"source":"GENDRY","target":"JAQEN","weight":4},{"directed":false,"source":"GENDRY","target":"LOMMY","weight":4},{"directed":false,"source":"GENDRY","target":"TYWIN","weight":6},{"directed":false,"source":"HAYLENE","target":"HOUND","weight":4},{"directed":false,"source":"HAYLENE","target":"JOFFREY","weight":4},{"directed":false,"source":"HOUND","target":"PODRICK","weight":16},{"directed":false,"source":"ILYN_PAYNE","target":"SHAE","weight":4},{"directed":false,"source":"JAIME","target":"RICKARD_KARSTARK","weight":4},{"directed":false,"source":"JAIME","target":"STANNIS","weight":9},{"directed":false,"source":"JANOS","target":"JOFFREY","weight":4},{"directed":false,"source":"JANOS","target":"MHAEGEN","weight":4},{"directed":false,"source":"JANOS","target":"ROS","weight":4},{"directed":false,"source":"JOFFREY","target":"MANDON","weight":4},{"directed":false,"source":"JOFFREY","target":"MARGAERY","weight":110},{"directed":false,"source":"LANCEL","target":"SANSA","weight":4},{"directed":false,"source":"MAESTER_LUWIN","target":"RICKON","weight":4},{"directed":false,"source":"MATTHOS","target":"MELISANDRE","weight":4},{"directed":false,"source":"RICKARD_KARSTARK","target":"TORRHEN","weight":4},{"directed":false,"source":"ROBB","target":"YARA","weight":4},{"directed":false,"source":"STANNIS","target":"VARYS","weight":6},{"directed":false,"source":"ALTON","target":"TYRION","weight":3},{"directed":false,"source":"AMORY","target":"JAQEN","weight":3},{"directed":false,"source":"AMORY","target":"POLLIVER","weight":3},{"directed":false,"source":"ARYA","target":"VISENYA","weight":3},{"directed":false,"source":"BLACK_LORREN","target":"RODRIK","weight":3},{"directed":false,"source":"BRAN","target":"JOFFREY","weight":3},{"directed":false,"source":"BRAN","target":"WINTERFELL_SHEPHERD","weight":3},{"directed":false,"source":"BRONN","target":"JANOS","weight":3},{"directed":false,"source":"BRONN","target":"PODRICK","weight":61},{"directed":false,"source":"CERSEI","target":"MANDON","weight":3},{"directed":false,"source":"CRASTER","target":"EDDISON_TOLLETT","weight":12},{"directed":false,"source":"DAENERYS","target":"MALAKKO","weight":3},{"directed":false,"source":"DAGMER","target":"OSHA","weight":3},{"directed":false,"source":"DAGMER","target":"RODRIK","weight":3},{"directed":false,"source":"FARLEN","target":"THEON","weight":3},{"directed":false,"source":"GENDRY","target":"MOUNTAIN","weight":3},{"directed":false,"source":"GENDRY","target":"RORGE","weight":3},{"directed":false,"source":"HOT_PIE","target":"JAQEN","weight":3},{"directed":false,"source":"HOT_PIE","target":"MOUNTAIN","weight":3},{"directed":false,"source":"HOUND","target":"SHAE","weight":3},{"directed":false,"source":"IRRI","target":"KOVARRO","weight":3},{"directed":false,"source":"IRRI","target":"XARO","weight":3},{"directed":false,"source":"JAIME","target":"MATTHOS","weight":3},{"directed":false,"source":"JAIME","target":"TORRHEN","weight":3},{"directed":false,"source":"JANOS","target":"PODRICK","weight":3},{"directed":false,"source":"JAQEN","target":"TYWIN","weight":3},{"directed":false,"source":"JOFFREY","target":"TALISA","weight":3},{"directed":false,"source":"JORAH","target":"SPICE_KING","weight":3},{"directed":false,"source":"KOVARRO","target":"MALAKKO","weight":3},{"directed":false,"source":"KOVARRO","target":"PYATT_PREE","weight":3},{"directed":false,"source":"LANCEL","target":"STANNIS","weight":3},{"directed":false,"source":"LITTLEFINGER","target":"ROBB","weight":5},{"directed":false,"source":"LITTLEFINGER","target":"ROBIN","weight":43},{"directed":false,"source":"LORAS","target":"PYCELLE","weight":5},{"directed":false,"source":"LORAS","target":"TYWIN","weight":20},{"directed":false,"source":"MAESTER_LUWIN","target":"PORTAN","weight":3},{"directed":false,"source":"MAESTER_LUWIN","target":"WINTERFELL_SHEPHERD","weight":3},{"directed":false,"source":"MALAKKO","target":"XARO","weight":3},{"directed":false,"source":"MANCE","target":"LORD_OF_BONES","weight":3},{"directed":false,"source":"MOUNTAIN","target":"POLLIVER","weight":5},{"directed":false,"source":"MYRCELLA","target":"ROBIN","weight":3},{"directed":false,"source":"NED","target":"YARA","weight":3},{"directed":false,"source":"PODRICK","target":"PYCELLE","weight":3},{"directed":false,"source":"PODRICK","target":"SHAE","weight":8},{"directed":false,"source":"PYATT_PREE","target":"SPICE_KING","weight":3},{"directed":false,"source":"QUENT","target":"ROBB","weight":3},{"directed":false,"source":"ROBB","target":"SEPTON","weight":3},{"directed":false,"source":"RORGE","target":"YOREN","weight":3},{"directed":false,"source":"SANSA","target":"TYWIN","weight":24},{"directed":false,"source":"SHAE","target":"TOMMEN","weight":3},{"directed":false,"source":"STANNIS","target":"TYWIN","weight":8},{"directed":false,"source":"THEON","target":"VARYS","weight":14},{"directed":false,"source":"TIMETT","target":"TYRION","weight":3},{"directed":false,"source":"TOMMEN","target":"TYRION","weight":15},{"directed":false,"source":"AEGON","target":"ARYA","weight":2},{"directed":false,"source":"AERYS","target":"PYCELLE","weight":2},{"directed":false,"source":"AERYS","target":"TYWIN","weight":2},{"directed":false,"source":"ALTON","target":"TALISA","weight":2},{"directed":false,"source":"AMORY","target":"HOT_PIE","weight":2},{"directed":false,"source":"ARYA","target":"KEVAN","weight":2},{"directed":false,"source":"ARYA","target":"REGINALD","weight":2},{"directed":false,"source":"ARYA","target":"RHAENYS","weight":2},{"directed":false,"source":"BALON","target":"CATELYN","weight":2},{"directed":false,"source":"BARRA","target":"JANOS","weight":2},{"directed":false,"source":"BENJEN","target":"CRASTER","weight":2},{"directed":false,"source":"BILLY","target":"RICKON","weight":2},{"directed":false,"source":"BITER","target":"YOREN","weight":2},{"directed":false,"source":"BLACK_LORREN","target":"MAESTER_LUWIN","weight":2},{"directed":false,"source":"BLACK_LORREN","target":"OSHA","weight":2},{"directed":false,"source":"BOROS","target":"JOFFREY","weight":2},{"directed":false,"source":"BRAN","target":"SANSA","weight":79},{"directed":false,"source":"BRIENNE","target":"COLEN","weight":2},{"directed":false,"source":"BRIENNE","target":"DAVOS","weight":35},{"directed":false,"source":"BRIENNE","target":"LITTLEFINGER","weight":48},{"directed":false,"source":"BRIENNE","target":"MELISANDRE","weight":12},{"directed":false,"source":"BRIENNE","target":"RICKARD_KARSTARK","weight":2},{"directed":false,"source":"BRONN","target":"CERSEI","weight":18},{"directed":false,"source":"CATELYN","target":"DAVOS","weight":2},{"directed":false,"source":"CATELYN","target":"MELISANDRE","weight":2},{"directed":false,"source":"CATELYN","target":"RICKON","weight":4},{"directed":false,"source":"CERSEI","target":"DAVOS","weight":6},{"directed":false,"source":"CERSEI","target":"HAYLENE","weight":2},{"directed":false,"source":"CERSEI","target":"JOANNA","weight":4},{"directed":false,"source":"CERSEI","target":"MATTHOS","weight":2},{"directed":false,"source":"CERSEI","target":"SALLADHOR","weight":2},{"directed":false,"source":"COLEN","target":"LORAS","weight":2},{"directed":false,"source":"COLEN","target":"MARGAERY","weight":2},{"directed":false,"source":"COLEN","target":"RENLY","weight":2},{"directed":false,"source":"CRASTER","target":"MANCE","weight":4},{"directed":false,"source":"CRESSEN","target":"MATTHOS","weight":2},{"directed":false,"source":"DAGMER","target":"FARLEN","weight":2},{"directed":false,"source":"DAGMER","target":"HODOR","weight":2},{"directed":false,"source":"DAGMER","target":"YARA","weight":2},{"directed":false,"source":"DAVOS","target":"FATHER_SEAWORTH","weight":2},{"directed":false,"source":"DAVOS","target":"JOFFREY","weight":2},{"directed":false,"source":"DAVOS","target":"LORAS","weight":2},{"directed":false,"source":"DAVOS","target":"MARYA","weight":2},{"directed":false,"source":"DAVOS","target":"ROBB","weight":4},{"directed":false,"source":"DAVOS","target":"ROBERT","weight":5},{"directed":false,"source":"DONTOS","target":"SANSA","weight":32},{"directed":false,"source":"EDDISON_TOLLETT","target":"JEOR","weight":8},{"directed":false,"source":"FARLEN","target":"RICKON","weight":2},{"directed":false,"source":"FREY_DAUGHTER","target":"ROBB","weight":2},{"directed":false,"source":"GILLY","target":"GRENN","weight":2},{"directed":false,"source":"HARREN","target":"TYWIN","weight":2},{"directed":false,"source":"HAYLENE","target":"PODRICK","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"MYRCELLA","weight":2},{"directed":false,"source":"HOT_PIE","target":"POLLIVER","weight":2},{"directed":false,"source":"HOT_PIE","target":"TICKLER","weight":2},{"directed":false,"source":"HOUND","target":"STANNIS","weight":2},{"directed":false,"source":"HOUND","target":"TOMMEN","weight":2},{"directed":false,"source":"ILYN_PAYNE","target":"LANCEL","weight":2},{"directed":false,"source":"ILYN_PAYNE","target":"TOMMEN","weight":2},{"directed":false,"source":"JACKS","target":"JAIME","weight":2},{"directed":false,"source":"JAQEN","target":"YOREN","weight":2},{"directed":false,"source":"JOFFREY","target":"MATTHOS","weight":2},{"directed":false,"source":"JOFFREY","target":"SHAE","weight":12},{"directed":false,"source":"JORAH","target":"MALAKKO","weight":2},{"directed":false,"source":"KEVAN","target":"STANNIS","weight":2},{"directed":false,"source":"KOVARRO","target":"SPICE_KING","weight":2},{"directed":false,"source":"LANCEL","target":"SHAE","weight":2},{"directed":false,"source":"LANCEL","target":"TOMMEN","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"MYRCELLA","weight":2},{"directed":false,"source":"LORAS","target":"MELISANDRE","weight":2},{"directed":false,"source":"LORAS","target":"ROBB","weight":2},{"directed":false,"source":"LORAS","target":"TOMMEN","weight":25},{"directed":false,"source":"MARGAERY","target":"STANNIS","weight":2},{"directed":false,"source":"MARGAERY","target":"TYWIN","weight":12},{"directed":false,"source":"MATTHOS","target":"ROBERT","weight":2},{"directed":false,"source":"MERYN_TRANT","target":"TOMMEN","weight":2},{"directed":false,"source":"MHAEGEN","target":"ROS","weight":2},{"directed":false,"source":"MYRCELLA","target":"ROBERT","weight":2},{"directed":false,"source":"MYRCELLA","target":"TRYSTANE","weight":26},{"directed":false,"source":"POLLIVER","target":"TYWIN","weight":2},{"directed":false,"source":"PROTESTER","target":"TYRION","weight":2},{"directed":false,"source":"QUAITHE","target":"XARO","weight":2},{"directed":false,"source":"RAMSAY","target":"ROOSE_BOLTON","weight":122},{"directed":false,"source":"RENNICK","target":"ROBB","weight":2},{"directed":false,"source":"RHAENYS","target":"VISENYA","weight":2},{"directed":false,"source":"RICKARD_KARSTARK","target":"ROOSE_BOLTON","weight":11},{"directed":false,"source":"RICKARD_KARSTARK","target":"TALISA","weight":5},{"directed":false,"source":"RICKON","target":"RODRIK","weight":2},{"directed":false,"source":"ROBERT","target":"THEON","weight":2},{"directed":false,"source":"SEPTON","target":"TALISA","weight":2},{"directed":false,"source":"SILK_KING","target":"SPICE_KING","weight":2},{"directed":false,"source":"TALISA","target":"TORRHEN","weight":2},{"directed":false,"source":"THEON","target":"TORRHEN","weight":2},{"directed":false,"source":"TRYSTANE","target":"TYRION","weight":2},{"directed":false,"source":"RAMSAY","target":"THEON","weight":235},{"directed":false,"source":"DAENERYS","target":"MISSANDEI","weight":221},{"directed":false,"source":"BRAN","target":"JOJEN","weight":107},{"directed":false,"source":"ARYA","target":"THOROS","weight":63},{"directed":false,"source":"MARGAERY","target":"SANSA","weight":71},{"directed":false,"source":"JAIME","target":"LOCKE","weight":59},{"directed":false,"source":"BARRISTAN","target":"JORAH","weight":91},{"directed":false,"source":"KRAZNYS_MO_NAKLOZ","target":"MISSANDEI","weight":54},{"directed":false,"source":"JAIME","target":"QYBURN","weight":90},{"directed":false,"source":"DAVOS","target":"GENDRY","weight":111},{"directed":false,"source":"EDMURE","target":"ROBB","weight":46},{"directed":false,"source":"GENDRY","target":"MELISANDRE","weight":48},{"directed":false,"source":"DAVOS","target":"SHIREEN","weight":103},{"directed":false,"source":"OLENNA","target":"VARYS","weight":40},{"directed":false,"source":"BARRISTAN","target":"DAENERYS","weight":107},{"directed":false,"source":"JON","target":"ORELL","weight":37},{"directed":false,"source":"DAARIO","target":"DAENERYS","weight":225},{"directed":false,"source":"OLENNA","target":"TYWIN","weight":49},{"directed":false,"source":"JON","target":"TORMUND","weight":286},{"directed":false,"source":"MEERA","target":"OSHA","weight":34},{"directed":false,"source":"ARYA","target":"BERIC","weight":51},{"directed":false,"source":"CERSEI","target":"MARGAERY","weight":131},{"directed":false,"source":"ORELL","target":"YGRITTE","weight":32},{"directed":false,"source":"OLENNA","target":"TYRION","weight":40},{"directed":false,"source":"OLENNA","target":"SANSA","weight":33},{"directed":false,"source":"ORELL","target":"TORMUND","weight":30},{"directed":false,"source":"BRAN","target":"MEERA","weight":148},{"directed":false,"source":"JAIME","target":"ROOSE_BOLTON","weight":29},{"directed":false,"source":"TORMUND","target":"YGRITTE","weight":58},{"directed":false,"source":"BERIC","target":"THOROS","weight":66},{"directed":false,"source":"JOJEN","target":"OSHA","weight":28},{"directed":false,"source":"BRYNDEN","target":"CATELYN","weight":27},{"directed":false,"source":"ANGUY","target":"ARYA","weight":26},{"directed":false,"source":"BERIC","target":"HOUND","weight":148},{"directed":false,"source":"CERSEI","target":"OLENNA","weight":87},{"directed":false,"source":"JOJEN","target":"MEERA","weight":68},{"directed":false,"source":"DAENERYS","target":"KRAZNYS_MO_NAKLOZ","weight":23},{"directed":false,"source":"HODOR","target":"JOJEN","weight":44},{"directed":false,"source":"ROOSE_BOLTON","target":"WALDER","weight":23},{"directed":false,"source":"MYRANDA","target":"VIOLET","weight":22},{"directed":false,"source":"MARGAERY","target":"OLENNA","weight":123},{"directed":false,"source":"SELYSE","target":"STANNIS","weight":60},{"directed":false,"source":"ANGUY","target":"HOUND","weight":20},{"directed":false,"source":"ANGUY","target":"THOROS","weight":20},{"directed":false,"source":"GENDRY","target":"THOROS","weight":34},{"directed":false,"source":"DAENERYS","target":"RADZAI_MO_ERAZ","weight":19},{"directed":false,"source":"JEOR","target":"RAST","weight":19},{"directed":false,"source":"THEON","target":"TORTURER","weight":19},{"directed":false,"source":"BRYNDEN","target":"EDMURE","weight":29},{"directed":false,"source":"BRAN","target":"SAM","weight":63},{"directed":false,"source":"BRYNDEN","target":"ROBB","weight":17},{"directed":false,"source":"DAARIO","target":"JORAH","weight":104},{"directed":false,"source":"DAARIO","target":"MERO","weight":17},{"directed":false,"source":"HOUND","target":"THOROS","weight":99},{"directed":false,"source":"DAENERYS","target":"MERO","weight":16},{"directed":false,"source":"SHIREEN","target":"STANNIS","weight":70},{"directed":false,"source":"BRIENNE","target":"LOCKE","weight":15},{"directed":false,"source":"CATELYN","target":"EDMURE","weight":17},{"directed":false,"source":"HODOR","target":"MEERA","weight":73},{"directed":false,"source":"JAIME","target":"STEELSHANKS_WALTON","weight":14},{"directed":false,"source":"MANCE","target":"TORMUND","weight":26},{"directed":false,"source":"MELISANDRE","target":"THOROS","weight":16},{"directed":false,"source":"CRASTER","target":"KARL_TANNER","weight":18},{"directed":false,"source":"JORAH","target":"MISSANDEI","weight":44},{"directed":false,"source":"MEERA","target":"RICKON","weight":13},{"directed":false,"source":"MERO","target":"PRENDAHL","weight":13},{"directed":false,"source":"DAENERYS","target":"GREY_WORM","weight":110},{"directed":false,"source":"EDMURE","target":"ROSLIN","weight":12},{"directed":false,"source":"GREY_WORM","target":"JORAH","weight":41},{"directed":false,"source":"JOJEN","target":"SAM","weight":12},{"directed":false,"source":"MARTYN","target":"TALISA","weight":12},{"directed":false,"source":"MYRANDA","target":"THEON","weight":29},{"directed":false,"source":"ROS","target":"SHAE","weight":12},{"directed":false,"source":"THEON","target":"VIOLET","weight":12},{"directed":false,"source":"ANGUY","target":"BERIC","weight":11},{"directed":false,"source":"ANGUY","target":"GENDRY","weight":11},{"directed":false,"source":"EDDISON_TOLLETT","target":"RAST","weight":11},{"directed":false,"source":"LORAS","target":"OLYVAR","weight":26},{"directed":false,"source":"EDMURE","target":"WALDER","weight":15},{"directed":false,"source":"GILLY","target":"MAESTER_AEMON","weight":14},{"directed":false,"source":"LOCKE","target":"ROOSE_BOLTON","weight":12},{"directed":false,"source":"LORAS","target":"OLENNA","weight":25},{"directed":false,"source":"MANCE","target":"ORELL","weight":10},{"directed":false,"source":"TALISA","target":"WALDER","weight":10},{"directed":false,"source":"BRIENNE","target":"ROOSE_BOLTON","weight":9},{"directed":false,"source":"GENDRY","target":"STANNIS","weight":9},{"directed":false,"source":"JOJEN","target":"RICKON","weight":9},{"directed":false,"source":"LITTLE_SAM","target":"GILLY","weight":9},{"directed":false,"source":"LITTLE_SAM","target":"SAM","weight":61},{"directed":false,"source":"ROOSE_BOLTON","target":"TYWIN","weight":13},{"directed":false,"source":"BLACK_WALDER","target":"ROBB","weight":8},{"directed":false,"source":"BRYNDEN","target":"ROOSE_BOLTON","weight":8},{"directed":false,"source":"BRYNDEN","target":"TALISA","weight":8},{"directed":false,"source":"CRASTER","target":"RAST","weight":13},{"directed":false,"source":"DAENERYS","target":"PRENDAHL","weight":8},{"directed":false,"source":"EDMURE","target":"TALISA","weight":8},{"directed":false,"source":"FARMER","target":"JON","weight":8},{"directed":false,"source":"GILLY","target":"MEERA","weight":8},{"directed":false,"source":"HODOR","target":"SAM","weight":8},{"directed":false,"source":"JEOR","target":"KARL_TANNER","weight":10},{"directed":false,"source":"JOFFREY","target":"OLENNA","weight":20},{"directed":false,"source":"MEERA","target":"SAM","weight":8},{"directed":false,"source":"MERYN_TRANT","target":"TARYN_MANT","weight":8},{"directed":false,"source":"ROSLIN","target":"WALDER","weight":8},{"directed":false,"source":"BARRISTAN","target":"MISSANDEI","weight":20},{"directed":false,"source":"BERIC","target":"GENDRY","weight":24},{"directed":false,"source":"DAARIO","target":"MISSANDEI","weight":32},{"directed":false,"source":"DAARIO","target":"PRENDAHL","weight":7},{"directed":false,"source":"EDMURE","target":"LOTHAR","weight":13},{"directed":false,"source":"FARMER","target":"TORMUND","weight":7},{"directed":false,"source":"BARRISTAN","target":"DAARIO","weight":20},{"directed":false,"source":"BERIC","target":"MELISANDRE","weight":12},{"directed":false,"source":"BRYNDEN","target":"WALDER","weight":11},{"directed":false,"source":"CATELYN","target":"JOYEUSE","weight":6},{"directed":false,"source":"DAARIO","target":"GREY_WORM","weight":40},{"directed":false,"source":"FARMER","target":"YGRITTE","weight":6},{"directed":false,"source":"HOT_PIE","target":"THOROS","weight":6},{"directed":false,"source":"JAIME","target":"RENLY","weight":6},{"directed":false,"source":"JORAH","target":"MERO","weight":6},{"directed":false,"source":"MACE","target":"OLENNA","weight":20},{"directed":false,"source":"MERO","target":"MISSANDEI","weight":6},{"directed":false,"source":"ROBB","target":"ROSLIN","weight":6},{"directed":false,"source":"ARYA","target":"MELISANDRE","weight":18},{"directed":false,"source":"BARRISTAN","target":"GREY_WORM","weight":19},{"directed":false,"source":"BLACK_WALDER","target":"EDMURE","weight":14},{"directed":false,"source":"BLACK_WALDER","target":"LOTHAR","weight":20},{"directed":false,"source":"BRYNDEN","target":"RICKARD_KARSTARK","weight":5},{"directed":false,"source":"GENDRY","target":"HOUND","weight":49},{"directed":false,"source":"HOSTER","target":"ROBB","weight":5},{"directed":false,"source":"JOJEN","target":"JON","weight":7},{"directed":false,"source":"JORAH","target":"KRAZNYS_MO_NAKLOZ","weight":5},{"directed":false,"source":"JORAH","target":"ROBERT","weight":5},{"directed":false,"source":"MARGAERY","target":"TYRION","weight":16},{"directed":false,"source":"MARTYN","target":"WILLEM_LANNISTER","weight":5},{"directed":false,"source":"BALON","target":"RAMSAY","weight":4},{"directed":false,"source":"BRAN","target":"ORELL","weight":4},{"directed":false,"source":"CATELYN","target":"ROSLIN","weight":4},{"directed":false,"source":"CERSEI","target":"TARYN_MANT","weight":4},{"directed":false,"source":"EDMURE","target":"FREY_SEPTON","weight":4},{"directed":false,"source":"EDMURE","target":"RICKARD_KARSTARK","weight":4},{"directed":false,"source":"FARMER","target":"ORELL","weight":4},{"directed":false,"source":"GILLY","target":"JOJEN","weight":4},{"directed":false,"source":"GREIZHEN","target":"MISSANDEI","weight":4},{"directed":false,"source":"JOYEUSE","target":"ROBB","weight":4},{"directed":false,"source":"JOYEUSE","target":"TALISA","weight":4},{"directed":false,"source":"LOCKE","target":"TYWIN","weight":4},{"directed":false,"source":"LORD_OF_BONES","target":"MANCE","weight":4},{"directed":false,"source":"LORD_OF_BONES","target":"TORMUND","weight":16},{"directed":false,"source":"LOTHAR","target":"WALDER","weight":13},{"directed":false,"source":"MAREI","target":"TYRION","weight":6},{"directed":false,"source":"MELISANDRE","target":"ROBERT","weight":4},{"directed":false,"source":"QYBURN","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"QYBURN","target":"TALISA","weight":4},{"directed":false,"source":"RAMSAY","target":"YARA","weight":11},{"directed":false,"source":"ROSLIN","target":"TALISA","weight":4},{"directed":false,"source":"SORCERER","target":"VARYS","weight":4},{"directed":false,"source":"TARYN_MANT","target":"TYRION","weight":4},{"directed":false,"source":"ANGUY","target":"MELISANDRE","weight":3},{"directed":false,"source":"BERIC","target":"MOUNTAIN","weight":3},{"directed":false,"source":"BLACK_WALDER","target":"BRYNDEN","weight":8},{"directed":false,"source":"BLACK_WALDER","target":"CATELYN","weight":3},{"directed":false,"source":"BRAN","target":"GILLY","weight":3},{"directed":false,"source":"BRANDON_STARK","target":"JOJEN","weight":3},{"directed":false,"source":"BRIENNE","target":"SELWYN","weight":8},{"directed":false,"source":"BRYNDEN","target":"LOTHAR","weight":7},{"directed":false,"source":"CRASTER","target":"GRENN","weight":7},{"directed":false,"source":"DAENERYS","target":"GREIZHEN","weight":3},{"directed":false,"source":"EDMURE","target":"ROOSE_BOLTON","weight":3},{"directed":false,"source":"FARMER","target":"JOJEN","weight":3},{"directed":false,"source":"GENDRY","target":"ROBERT","weight":14},{"directed":false,"source":"GILLY","target":"HODOR","weight":3},{"directed":false,"source":"GILLY","target":"RANDYLL","weight":11},{"directed":false,"source":"HIGH_SEPTON","target":"JOFFREY","weight":8},{"directed":false,"source":"HIGH_SEPTON","target":"MARGAERY","weight":7},{"directed":false,"source":"HODOR","target":"ORELL","weight":3},{"directed":false,"source":"JAIME","target":"SELWYN","weight":3},{"directed":false,"source":"JOANNA","target":"TYWIN","weight":5},{"directed":false,"source":"JOJEN","target":"NED","weight":3},{"directed":false,"source":"JOJEN","target":"ORELL","weight":3},{"directed":false,"source":"JON","target":"OSHA","weight":3},{"directed":false,"source":"LITTLEFINGER","target":"OLYVAR","weight":5},{"directed":false,"source":"LITTLEFINGER","target":"SHAE","weight":3},{"directed":false,"source":"LOTHAR","target":"ROBB","weight":3},{"directed":false,"source":"MACE","target":"MARGAERY","weight":19},{"directed":false,"source":"MEERA","target":"ORELL","weight":3},{"directed":false,"source":"MERRY","target":"WALDER","weight":3},{"directed":false,"source":"MERYN_TRANT","target":"PODRICK","weight":3},{"directed":false,"source":"MISSANDEI","target":"PRENDAHL","weight":3},{"directed":false,"source":"MISSANDEI","target":"RADZAI_MO_ERAZ","weight":3},{"directed":false,"source":"MOUNTAIN","target":"ROBB","weight":3},{"directed":false,"source":"OLENNA","target":"PODRICK","weight":3},{"directed":false,"source":"OLENNA","target":"ROBERT","weight":3},{"directed":false,"source":"ORELL","target":"OSHA","weight":3},{"directed":false,"source":"ORELL","target":"RICKON","weight":3},{"directed":false,"source":"QYBURN","target":"ROBB","weight":3},{"directed":false,"source":"RAMSAY","target":"ROBB","weight":5},{"directed":false,"source":"RICKARD_KARSTARK","target":"WILLEM_LANNISTER","weight":3},{"directed":false,"source":"ROBERT","target":"THOROS","weight":3},{"directed":false,"source":"ROOSE_BOLTON","target":"STEELSHANKS_WALTON","weight":3},{"directed":false,"source":"ROOSE_BOLTON","target":"THEON","weight":25},{"directed":false,"source":"SORCERER","target":"TYRION","weight":3},{"directed":false,"source":"AEGON","target":"DAVOS","weight":2},{"directed":false,"source":"AEGON","target":"SHIREEN","weight":2},{"directed":false,"source":"AERYS","target":"JOFFREY","weight":2},{"directed":false,"source":"ANGUY","target":"HOT_PIE","weight":2},{"directed":false,"source":"ARYA","target":"ROOSE_BOLTON","weight":2},{"directed":false,"source":"BALERION","target":"DAVOS","weight":2},{"directed":false,"source":"BALON","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"BARRISTAN","target":"KRAZNYS_MO_NAKLOZ","weight":2},{"directed":false,"source":"BARRISTAN","target":"RADZAI_MO_ERAZ","weight":2},{"directed":false,"source":"BERT","target":"SHIREEN","weight":2},{"directed":false,"source":"BLACK_WALDER","target":"JOYEUSE","weight":2},{"directed":false,"source":"BOROS","target":"MERYN_TRANT","weight":2},{"directed":false,"source":"BRAN","target":"FARMER","weight":2},{"directed":false,"source":"BRAN","target":"TORMUND","weight":6},{"directed":false,"source":"BRAN","target":"YGRITTE","weight":2},{"directed":false,"source":"BRONN","target":"HIGH_SEPTON","weight":2},{"directed":false,"source":"BRONN","target":"LORAS","weight":2},{"directed":false,"source":"BRONN","target":"MARGAERY","weight":2},{"directed":false,"source":"BRONN","target":"OLENNA","weight":4},{"directed":false,"source":"BRONN","target":"TARYN_MANT","weight":2},{"directed":false,"source":"BRYNDEN","target":"HOSTER","weight":2},{"directed":false,"source":"BRYNDEN","target":"ROSLIN","weight":2},{"directed":false,"source":"CATELYN","target":"LOTHAR","weight":2},{"directed":false,"source":"CERSEI","target":"HIGH_SEPTON","weight":15},{"directed":false,"source":"DAREON","target":"HOBB","weight":2},{"directed":false,"source":"DAVOS","target":"RYLENE","weight":2},{"directed":false,"source":"DESMOND","target":"ELDRICK","weight":2},{"directed":false,"source":"DESMOND","target":"SANSA","weight":2},{"directed":false,"source":"DESMOND","target":"TYRION","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"KARL_TANNER","weight":2},{"directed":false,"source":"EDMURE","target":"HOUND","weight":2},{"directed":false,"source":"EDMURE","target":"JOYEUSE","weight":2},{"directed":false,"source":"EDMURE","target":"MOUNTAIN","weight":2},{"directed":false,"source":"EDMURE","target":"TYWIN","weight":2},{"directed":false,"source":"FARMER","target":"HODOR","weight":2},{"directed":false,"source":"FARMER","target":"MEERA","weight":2},{"directed":false,"source":"FARMER","target":"OSHA","weight":2},{"directed":false,"source":"FARMER","target":"RICKON","weight":2},{"directed":false,"source":"FREY_SEPTON","target":"ROSLIN","weight":2},{"directed":false,"source":"FREY_SEPTON","target":"WALDER","weight":2},{"directed":false,"source":"GILLY","target":"RAST","weight":2},{"directed":false,"source":"GREIZHEN","target":"JORAH","weight":2},{"directed":false,"source":"GREIZHEN","target":"KRAZNYS_MO_NAKLOZ","weight":2},{"directed":false,"source":"GRENN","target":"KARL_TANNER","weight":2},{"directed":false,"source":"GREY_WORM","target":"MERO","weight":2},{"directed":false,"source":"GREY_WORM","target":"MISSANDEI","weight":183},{"directed":false,"source":"HIGH_SEPTON","target":"LORAS","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"OLENNA","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"PYCELLE","weight":4},{"directed":false,"source":"HIGH_SEPTON","target":"SANSA","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"TYRION","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"TYWIN","weight":2},{"directed":false,"source":"HODOR","target":"JON","weight":2},{"directed":false,"source":"HODOR","target":"TORMUND","weight":2},{"directed":false,"source":"HODOR","target":"YGRITTE","weight":2},{"directed":false,"source":"HOUND","target":"ROOSE_BOLTON","weight":2},{"directed":false,"source":"JAIME","target":"LORAS","weight":18},{"directed":false,"source":"JAIME","target":"PYCELLE","weight":7},{"directed":false,"source":"JOJEN","target":"TORMUND","weight":2},{"directed":false,"source":"JOJEN","target":"YGRITTE","weight":2},{"directed":false,"source":"JON","target":"MEERA","weight":2},{"directed":false,"source":"JON","target":"QHORIN_HALFHAND","weight":2},{"directed":false,"source":"JON","target":"RICKON","weight":11},{"directed":false,"source":"JORAH","target":"PRENDAHL","weight":2},{"directed":false,"source":"JOYEUSE","target":"ROSLIN","weight":2},{"directed":false,"source":"KARL_TANNER","target":"RAST","weight":15},{"directed":false,"source":"KARL_TANNER","target":"SAM","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"PODRICK","weight":10},{"directed":false,"source":"LOCKE","target":"QYBURN","weight":2},{"directed":false,"source":"LOCKE","target":"STEELSHANKS_WALTON","weight":2},{"directed":false,"source":"LORAS","target":"SHAE","weight":2},{"directed":false,"source":"LOTHAR","target":"ROSLIN","weight":2},{"directed":false,"source":"LOTHAR","target":"TALISA","weight":2},{"directed":false,"source":"LYSA","target":"TYWIN","weight":2},{"directed":false,"source":"LYSA","target":"VARYS","weight":2},{"directed":false,"source":"MARGAERY","target":"PYCELLE","weight":4},{"directed":false,"source":"MARTYN","target":"ROBB","weight":2},{"directed":false,"source":"MEERA","target":"TORMUND","weight":2},{"directed":false,"source":"MEERA","target":"YGRITTE","weight":2},{"directed":false,"source":"MELISANDRE","target":"SELYSE","weight":51},{"directed":false,"source":"MOUNTAIN","target":"THOROS","weight":2},{"directed":false,"source":"MYRANDA","target":"RAMSAY","weight":55},{"directed":false,"source":"NED","target":"RICKARD_KARSTARK","weight":2},{"directed":false,"source":"NED","target":"THOROS","weight":2},{"directed":false,"source":"OLENNA","target":"PYCELLE","weight":5},{"directed":false,"source":"OLENNA","target":"RENLY","weight":2},{"directed":false,"source":"OSHA","target":"TORMUND","weight":2},{"directed":false,"source":"OSHA","target":"YGRITTE","weight":2},{"directed":false,"source":"PODRICK","target":"SANSA","weight":35},{"directed":false,"source":"QHORIN_HALFHAND","target":"YGRITTE","weight":2},{"directed":false,"source":"QYBURN","target":"SELWYN","weight":2},{"directed":false,"source":"QYBURN","target":"TYWIN","weight":2},{"directed":false,"source":"RAMSAY","target":"VIOLET","weight":2},{"directed":false,"source":"RENLY","target":"TYWIN","weight":2},{"directed":false,"source":"RICKARD_KARSTARK","target":"ROSLIN","weight":2},{"directed":false,"source":"RICKARD_KARSTARK","target":"WALDER","weight":2},{"directed":false,"source":"RICKON","target":"TORMUND","weight":4},{"directed":false,"source":"RICKON","target":"YGRITTE","weight":2},{"directed":false,"source":"RYLENE","target":"STANNIS","weight":2},{"directed":false,"source":"SALLADHOR","target":"STANNIS","weight":2},{"directed":false,"source":"SELYSE","target":"SHIREEN","weight":27},{"directed":false,"source":"STEELSHANKS_WALTON","target":"TYWIN","weight":2},{"directed":false,"source":"TYRION","target":"WALDER","weight":2},{"directed":false,"source":"TYWIN","target":"WALDER","weight":2},{"directed":false,"source":"LYSA","target":"SANSA","weight":92},{"directed":false,"source":"OBERYN","target":"TYWIN","weight":79},{"directed":false,"source":"BRIENNE","target":"PODRICK","weight":251},{"directed":false,"source":"OBERYN","target":"TYRION","weight":78},{"directed":false,"source":"CERSEI","target":"OBERYN","weight":63},{"directed":false,"source":"LITTLEFINGER","target":"LYSA","weight":58},{"directed":false,"source":"ELLARIA","target":"OBERYN","weight":58},{"directed":false,"source":"ROBIN","target":"SANSA","weight":52},{"directed":false,"source":"TOMMEN","target":"TYWIN","weight":45},{"directed":false,"source":"JANOS","target":"JON","weight":59},{"directed":false,"source":"ARYA","target":"BRIENNE","weight":61},{"directed":false,"source":"OBERYN","target":"VARYS","weight":34},{"directed":false,"source":"STYR","target":"YGRITTE","weight":32},{"directed":false,"source":"LITTLEFINGER","target":"YOHN_ROYCE","weight":60},{"directed":false,"source":"BRONN","target":"JAIME","weight":284},{"directed":false,"source":"HOUND","target":"POLLIVER","weight":29},{"directed":false,"source":"MARGAERY","target":"TOMMEN","weight":144},{"directed":false,"source":"ALLISER_THORNE","target":"JANOS","weight":32},{"directed":false,"source":"DAENERYS","target":"HIZDAHR","weight":93},{"directed":false,"source":"GILLY","target":"MOLES_TOWN_WHORE","weight":24},{"directed":false,"source":"MELISANDRE","target":"SHIREEN","weight":33},{"directed":false,"source":"BRIENNE","target":"HOT_PIE","weight":25},{"directed":false,"source":"BRIENNE","target":"HOUND","weight":47},{"directed":false,"source":"ANYA_WAYNWOOD","target":"LITTLEFINGER","weight":21},{"directed":false,"source":"JON","target":"LOCKE","weight":21},{"directed":false,"source":"MACE","target":"TYWIN","weight":21},{"directed":false,"source":"OBERYN","target":"OLYVAR","weight":21},{"directed":false,"source":"FARMER_HAMLET","target":"HOUND","weight":20},{"directed":false,"source":"GILLY","target":"LITTLE_SAM","weight":61},{"directed":false,"source":"STYR","target":"TORMUND","weight":20},{"directed":false,"source":"CERSEI","target":"QYBURN","weight":173},{"directed":false,"source":"DAVOS","target":"TYCHO","weight":18},{"directed":false,"source":"ELLARIA","target":"OLYVAR","weight":18},{"directed":false,"source":"MORGAN","target":"OBERYN","weight":18},{"directed":false,"source":"MOUNTAIN","target":"OBERYN","weight":22},{"directed":false,"source":"RALF","target":"THEON","weight":18},{"directed":false,"source":"ARYA","target":"TERNESIO_TERYS","weight":17},{"directed":false,"source":"KARL_TANNER","target":"MEERA","weight":17},{"directed":false,"source":"STANNIS","target":"TYCHO","weight":17},{"directed":false,"source":"DAENERYS","target":"FENNESZ","weight":15},{"directed":false,"source":"RAMSAY","target":"TANSY","weight":15},{"directed":false,"source":"SANSA","target":"YOHN_ROYCE","weight":58},{"directed":false,"source":"BRIENNE","target":"CERSEI","weight":18},{"directed":false,"source":"ELIA","target":"OBERYN","weight":14},{"directed":false,"source":"GRENN","target":"LOCKE","weight":14},{"directed":false,"source":"JOJEN","target":"KARL_TANNER","weight":14},{"directed":false,"source":"JON","target":"OLLY","weight":61},{"directed":false,"source":"MACE","target":"OBERYN","weight":14},{"directed":false,"source":"MACE","target":"TYRION","weight":14},{"directed":false,"source":"ARYA","target":"FARMER_HAMLET","weight":13},{"directed":false,"source":"BRAN","target":"LOCKE","weight":13},{"directed":false,"source":"CERSEI","target":"MACE","weight":45},{"directed":false,"source":"CERSEI","target":"MOUNTAIN","weight":75},{"directed":false,"source":"GRENN","target":"JANOS","weight":13},{"directed":false,"source":"JAIME","target":"PODRICK","weight":44},{"directed":false,"source":"JAIME","target":"TOMMEN","weight":54},{"directed":false,"source":"DYING_MAN","target":"HOUND","weight":12},{"directed":false,"source":"JAIME","target":"OBERYN","weight":12},{"directed":false,"source":"JON","target":"STANNIS","weight":106},{"directed":false,"source":"MANCE","target":"STANNIS","weight":26},{"directed":false,"source":"PYCELLE","target":"QYBURN","weight":35},{"directed":false,"source":"ANYA_WAYNWOOD","target":"SANSA","weight":11},{"directed":false,"source":"DONTOS","target":"LITTLEFINGER","weight":11},{"directed":false,"source":"ELLARIA","target":"TYRION","weight":18},{"directed":false,"source":"FARMER_HAMLET","target":"SALLY","weight":11},{"directed":false,"source":"JAIME","target":"MARGAERY","weight":19},{"directed":false,"source":"JON","target":"KARL_TANNER","weight":11},{"directed":false,"source":"ANYA_WAYNWOOD","target":"YOHN_ROYCE","weight":10},{"directed":false,"source":"ARYA","target":"DYING_MAN","weight":10},{"directed":false,"source":"KARL_TANNER","target":"SISSY","weight":10},{"directed":false,"source":"MORGAN","target":"MORGANS_FRIEND","weight":10},{"directed":false,"source":"OLLY","target":"STYR","weight":10},{"directed":false,"source":"BRAN","target":"THREE_EYED_RAVEN","weight":85},{"directed":false,"source":"ELLARIA","target":"MAREI","weight":9},{"directed":false,"source":"ELLARIA","target":"TYWIN","weight":9},{"directed":false,"source":"JANOS","target":"SAM","weight":17},{"directed":false,"source":"JOFFREY","target":"MACE","weight":9},{"directed":false,"source":"BALON_DWARF","target":"ROBB_DWARF","weight":8},{"directed":false,"source":"BRONN","target":"OBERYN","weight":8},{"directed":false,"source":"DONNEL_HILL","target":"GRENN","weight":8},{"directed":false,"source":"EDDISON_TOLLETT","target":"JANOS","weight":11},{"directed":false,"source":"ELLARIA","target":"MORGAN","weight":8},{"directed":false,"source":"JAIME","target":"MACE","weight":16},{"directed":false,"source":"JOFFREY","target":"OBERYN","weight":8},{"directed":false,"source":"JON","target":"MORAG","weight":8},{"directed":false,"source":"MACE","target":"VARYS","weight":8},{"directed":false,"source":"MORGANS_FRIEND","target":"OBERYN","weight":8},{"directed":false,"source":"ALLISER_THORNE","target":"LOCKE","weight":7},{"directed":false,"source":"BOLTON_GUARD","target":"YARA","weight":7},{"directed":false,"source":"BRAN","target":"KARL_TANNER","weight":7},{"directed":false,"source":"BRAN","target":"LEAF","weight":26},{"directed":false,"source":"CERSEI","target":"ELLARIA","weight":30},{"directed":false,"source":"DAENERYS","target":"MEEREEN_CHAMPION","weight":7},{"directed":false,"source":"DAVOS","target":"JON","weight":261},{"directed":false,"source":"DONGO_THE_GIANT","target":"MAG_THE_MIGHTY","weight":7},{"directed":false,"source":"DORNISH_LORD","target":"TYRION","weight":7},{"directed":false,"source":"EDDISON_TOLLETT","target":"PYP","weight":9},{"directed":false,"source":"ENDREW","target":"JAIME","weight":7},{"directed":false,"source":"GILLY","target":"PYP","weight":7},{"directed":false,"source":"GRENN","target":"MAG_THE_MIGHTY","weight":7},{"directed":false,"source":"GUYMON","target":"OLLY","weight":7},{"directed":false,"source":"HIZDAHR","target":"HIZDAHRS_FATHER","weight":7},{"directed":false,"source":"HODOR","target":"LOCKE","weight":7},{"directed":false,"source":"JON","target":"SISSY","weight":7},{"directed":false,"source":"MACE","target":"TOMMEN","weight":9},{"directed":false,"source":"MAREI","target":"OBERYN","weight":7},{"directed":false,"source":"MOLES_TOWN_MADAM","target":"SAM","weight":7},{"directed":false,"source":"OBERYN","target":"PYCELLE","weight":7},{"directed":false,"source":"OBERYN","target":"SHAE","weight":7},{"directed":false,"source":"OLLY","target":"SAM","weight":37},{"directed":false,"source":"OLLY","target":"YGRITTE","weight":7},{"directed":false,"source":"RENLY_DWARF","target":"STANNIS_DWARF","weight":7},{"directed":false,"source":"ARYA","target":"SALLY","weight":6},{"directed":false,"source":"BRIENNE","target":"JOFFREY","weight":6},{"directed":false,"source":"BRIENNE","target":"SANSA","weight":120},{"directed":false,"source":"CERSEI","target":"DONTOS","weight":6},{"directed":false,"source":"DAVOS","target":"MANCE","weight":6},{"directed":false,"source":"DAVOS","target":"SELYSE","weight":15},{"directed":false,"source":"ELDER_MEEREEN_SLAVE","target":"MOSSADOR","weight":6},{"directed":false,"source":"FIRST_MATE","target":"YARA","weight":6},{"directed":false,"source":"GOATHERD","target":"MISSANDEI","weight":6},{"directed":false,"source":"GRENN","target":"OLLY","weight":6},{"directed":false,"source":"HOUND","target":"LYSA","weight":6},{"directed":false,"source":"HOUND","target":"RORGE","weight":6},{"directed":false,"source":"HOUND","target":"SALLY","weight":6},{"directed":false,"source":"JAIME","target":"VARYS","weight":16},{"directed":false,"source":"JOFFREY_DWARF","target":"ROBB_DWARF","weight":6},{"directed":false,"source":"JON","target":"STYR","weight":6},{"directed":false,"source":"MAREI","target":"OLYVAR","weight":6},{"directed":false,"source":"MEERA","target":"THREE_EYED_RAVEN","weight":17},{"directed":false,"source":"MORGAN","target":"OLYVAR","weight":6},{"directed":false,"source":"MOUNTAIN","target":"PYCELLE","weight":6},{"directed":false,"source":"MOUNTAIN","target":"QYBURN","weight":32},{"directed":false,"source":"MYRANDA","target":"TANSY","weight":6},{"directed":false,"source":"OBERYN","target":"TOMMEN","weight":6},{"directed":false,"source":"ORSON","target":"TYRION","weight":6},{"directed":false,"source":"SAM","target":"TORMUND","weight":36},{"directed":false,"source":"TANSY","target":"THEON","weight":6},{"directed":false,"source":"ALLISER_THORNE","target":"EDDISON_TOLLETT","weight":20},{"directed":false,"source":"ALLISER_THORNE","target":"TORMUND","weight":18},{"directed":false,"source":"BRIENNE","target":"OLENNA","weight":5},{"directed":false,"source":"BRIENNE","target":"TYRION","weight":55},{"directed":false,"source":"DAENERYS","target":"GOATHERD","weight":5},{"directed":false,"source":"DONTOS","target":"TYRION","weight":5},{"directed":false,"source":"EDDISON_TOLLETT","target":"LOCKE","weight":5},{"directed":false,"source":"EDDISON_TOLLETT","target":"MORAG","weight":5},{"directed":false,"source":"ENDREW","target":"JOFFREY","weight":5},{"directed":false,"source":"FENNESZ","target":"MASTER_MIGHDAL","weight":5},{"directed":false,"source":"FIRST_MATE","target":"THEON","weight":5},{"directed":false,"source":"GRENN","target":"MORAG","weight":5},{"directed":false,"source":"HIGH_SEPTON","target":"TOMMEN","weight":5},{"directed":false,"source":"HIZDAHR","target":"MANSERVANT","weight":5},{"directed":false,"source":"HOT_PIE","target":"PODRICK","weight":5},{"directed":false,"source":"JAIME","target":"SHAE","weight":5},{"directed":false,"source":"JANOS","target":"OLLY","weight":8},{"directed":false,"source":"JOFFREY","target":"POLLIVER","weight":5},{"directed":false,"source":"LHARA","target":"SALLADHOR","weight":5},{"directed":false,"source":"LUTHOR","target":"OLENNA","weight":5},{"directed":false,"source":"MACE","target":"PYCELLE","weight":15},{"directed":false,"source":"MACE","target":"SANSA","weight":5},{"directed":false,"source":"MACE","target":"SHAE","weight":5},{"directed":false,"source":"MARGAERY","target":"OBERYN","weight":5},{"directed":false,"source":"MOUNTAIN","target":"TYRION","weight":18},{"directed":false,"source":"OBERYN","target":"PODRICK","weight":5},{"directed":false,"source":"RAMSAY","target":"WALDA","weight":34},{"directed":false,"source":"ROOSE_BOLTON","target":"WALDA","weight":14},{"directed":false,"source":"ADRACK_HUMBLE","target":"THEON","weight":4},{"directed":false,"source":"AXELL_FLORENT","target":"MELISANDRE","weight":4},{"directed":false,"source":"AXELL_FLORENT","target":"SELYSE","weight":4},{"directed":false,"source":"BALON_DWARF","target":"JOFFREY_DWARF","weight":4},{"directed":false,"source":"BALON_DWARF","target":"STANNIS_DWARF","weight":4},{"directed":false,"source":"BLACK_JACK","target":"KEGS","weight":4},{"directed":false,"source":"BLACK_JACK","target":"MULLY","weight":4},{"directed":false,"source":"BRAN","target":"CRASTER","weight":4},{"directed":false,"source":"BRAN","target":"RAST","weight":4},{"directed":false,"source":"BRONN","target":"MORGAN","weight":4},{"directed":false,"source":"COOPER","target":"GRENN","weight":4},{"directed":false,"source":"CRASTER","target":"LOCKE","weight":4},{"directed":false,"source":"CRASTER","target":"MORAG","weight":4},{"directed":false,"source":"CRASTER","target":"SISSY","weight":4},{"directed":false,"source":"CRASTERS_BABY","target":"RAST","weight":4},{"directed":false,"source":"CRASTERS_BABY","target":"SISSY","weight":4},{"directed":false,"source":"DAARIO","target":"MEEREEN_CHAMPION","weight":4},{"directed":false,"source":"DAENERYS","target":"HIZDAHRS_FATHER","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"SISSY","weight":4},{"directed":false,"source":"ELDER_MEEREEN_SLAVE","target":"GREY_WORM","weight":4},{"directed":false,"source":"ELDER_MEEREEN_SLAVE","target":"MEEREEN_SLAVE","weight":4},{"directed":false,"source":"ELIA","target":"MOUNTAIN","weight":4},{"directed":false,"source":"ELIA","target":"TYWIN","weight":4},{"directed":false,"source":"ELLARIA","target":"JAIME","weight":25},{"directed":false,"source":"ELLARIA","target":"MOUNTAIN","weight":10},{"directed":false,"source":"ELLARIA","target":"PODRICK","weight":4},{"directed":false,"source":"GILLY","target":"JANOS","weight":7},{"directed":false,"source":"GILLY","target":"STYR","weight":4},{"directed":false,"source":"GILLY","target":"YGRITTE","weight":4},{"directed":false,"source":"GRENN","target":"SISSY","weight":4},{"directed":false,"source":"HIGH_SEPTON","target":"JAIME","weight":4},{"directed":false,"source":"JANOS","target":"MAESTER_AEMON","weight":4},{"directed":false,"source":"JOFFREY","target":"JOFFREY_DWARF","weight":4},{"directed":false,"source":"JON","target":"MAG_THE_MIGHTY","weight":4},{"directed":false,"source":"KEGS","target":"MULLY","weight":4},{"directed":false,"source":"LEAF","target":"MEERA","weight":17},{"directed":false,"source":"LITTLE_SAM","target":"MOLES_TOWN_WHORE","weight":4},{"directed":false,"source":"LOCKE","target":"RAMSAY","weight":4},{"directed":false,"source":"LORAS","target":"OBERYN","weight":4},{"directed":false,"source":"LYSA","target":"NED","weight":4},{"directed":false,"source":"LYSA","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"MERYN_TRANT","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"MERYN_TRANT","target":"TYWIN","weight":4},{"directed":false,"source":"MORAG","target":"SISSY","weight":4},{"directed":false,"source":"MORGAN","target":"TYRION","weight":4},{"directed":false,"source":"MYRANDA","target":"YARA","weight":4},{"directed":false,"source":"OBERYN","target":"SANSA","weight":4},{"directed":false,"source":"OLLY","target":"OLLYS_MOTHER","weight":4},{"directed":false,"source":"PYCELLE","target":"TOMMEN","weight":14},{"directed":false,"source":"SAM","target":"STYR","weight":4},{"directed":false,"source":"SAM","target":"YGRITTE","weight":4},{"directed":false,"source":"STYR","target":"THENN_WARG","weight":4},{"directed":false,"source":"AERYS","target":"TYRION","weight":10},{"directed":false,"source":"ALLISER_THORNE","target":"OLLY","weight":18},{"directed":false,"source":"ALLISER_THORNE","target":"QHORIN","weight":3},{"directed":false,"source":"ANYA_WAYNWOOD","target":"LYSA","weight":3},{"directed":false,"source":"ARYA","target":"PODRICK","weight":10},{"directed":false,"source":"BAELOR","target":"TYWIN","weight":3},{"directed":false,"source":"BALON_DWARF","target":"RENLY_DWARF","weight":3},{"directed":false,"source":"BOLTON_GUARD","target":"FIRST_MATE","weight":3},{"directed":false,"source":"BRAN","target":"CRASTERS_BABY","weight":3},{"directed":false,"source":"BRAN","target":"RAMSAY","weight":3},{"directed":false,"source":"BRONN","target":"ELLARIA","weight":3},{"directed":false,"source":"BRONN","target":"LOLLYS","weight":17},{"directed":false,"source":"BRONN","target":"MOUNTAIN","weight":3},{"directed":false,"source":"COOPER","target":"DONNEL_HILL","weight":3},{"directed":false,"source":"CRASTER","target":"JOJEN","weight":3},{"directed":false,"source":"CRASTER","target":"MEERA","weight":3},{"directed":false,"source":"CRASTERS_BABY","target":"MEERA","weight":3},{"directed":false,"source":"DAENERYS","target":"MANSERVANT","weight":3},{"directed":false,"source":"DONNEL_WAYNWOOD","target":"HOUND","weight":3},{"directed":false,"source":"DORAN","target":"TYRION","weight":3},{"directed":false,"source":"EDDISON_TOLLETT","target":"OLLY","weight":13},{"directed":false,"source":"ELLARIA","target":"JOFFREY","weight":3},{"directed":false,"source":"ELLARIA","target":"LORAS","weight":3},{"directed":false,"source":"GILLY","target":"TORMUND","weight":8},{"directed":false,"source":"GUYMON","target":"OLLYS_MOTHER","weight":3},{"directed":false,"source":"HODOR","target":"LEAF","weight":12},{"directed":false,"source":"HODOR","target":"RAST","weight":3},{"directed":false,"source":"HOSTER","target":"LYSA","weight":3},{"directed":false,"source":"HOUND","target":"INNKEEPER","weight":3},{"directed":false,"source":"HOUND","target":"SYRIO_FOREL","weight":3},{"directed":false,"source":"INNKEEPER","target":"POLLIVER","weight":3},{"directed":false,"source":"JAIME","target":"MERYN_TRANT","weight":3},{"directed":false,"source":"JAIME","target":"OLENNA","weight":50},{"directed":false,"source":"JOFFREY","target":"MOUNTAIN","weight":3},{"directed":false,"source":"JOFFREY","target":"ROBB_DWARF","weight":3},{"directed":false,"source":"JOFFREY_DWARF","target":"SANSA","weight":3},{"directed":false,"source":"JOFFREY_DWARF","target":"STANNIS_DWARF","weight":3},{"directed":false,"source":"JOJEN","target":"LEAF","weight":3},{"directed":false,"source":"JOJEN","target":"THREE_EYED_RAVEN","weight":3},{"directed":false,"source":"MAG_THE_MIGHTY","target":"MANCE","weight":3},{"directed":false,"source":"MAG_THE_MIGHTY","target":"SAM","weight":3},{"directed":false,"source":"MEEREEN_SLAVE","target":"MOSSADOR","weight":3},{"directed":false,"source":"MOLES_TOWN_MADAM","target":"MOLES_TOWN_WHORE","weight":3},{"directed":false,"source":"OLENNA","target":"TOMMEN","weight":6},{"directed":false,"source":"OLLY","target":"PYP","weight":3},{"directed":false,"source":"OLLY","target":"TORMUND","weight":8},{"directed":false,"source":"PODRICK","target":"TYWIN","weight":3},{"directed":false,"source":"PYP","target":"TORMUND","weight":3},{"directed":false,"source":"STANNIS","target":"TOMMEN","weight":3},{"directed":false,"source":"THENN_WARG","target":"TORMUND","weight":3},{"directed":false,"source":"THENN_WARG","target":"YGRITTE","weight":3},{"directed":false,"source":"VANCE_CORBRAY","target":"YOHN_ROYCE","weight":3},{"directed":false,"source":"ADRACK_HUMBLE","target":"RALF","weight":2},{"directed":false,"source":"AERYS","target":"CERSEI","weight":7},{"directed":false,"source":"ALLISER_THORNE","target":"CRASTER","weight":2},{"directed":false,"source":"ALLISER_THORNE","target":"YGRITTE","weight":2},{"directed":false,"source":"ANYA_WAYNWOOD","target":"ROBIN","weight":2},{"directed":false,"source":"ANYA_WAYNWOOD","target":"VANCE_CORBRAY","weight":2},{"directed":false,"source":"ARYA","target":"DONNEL_WAYNWOOD","weight":2},{"directed":false,"source":"ARYA","target":"INNKEEPER","weight":2},{"directed":false,"source":"ARYA","target":"INNKEEPERS_DAUGHTER","weight":2},{"directed":false,"source":"ARYA","target":"LYSA","weight":2},{"directed":false,"source":"ARYA","target":"TOMMY","weight":2},{"directed":false,"source":"AXELL_FLORENT","target":"DAVOS","weight":2},{"directed":false,"source":"AXELL_FLORENT","target":"STANNIS","weight":2},{"directed":false,"source":"BAELOR","target":"HIGH_SEPTON","weight":2},{"directed":false,"source":"BAELOR","target":"TYRION","weight":2},{"directed":false,"source":"BALON_DWARF","target":"JOFFREY","weight":2},{"directed":false,"source":"BARRISTAN","target":"GOATHERD","weight":2},{"directed":false,"source":"BITER","target":"HOUND","weight":2},{"directed":false,"source":"BOROS","target":"JAIME","weight":2},{"directed":false,"source":"BRIENNE","target":"BRONN","weight":12},{"directed":false,"source":"BRIENNE","target":"NED","weight":2},{"directed":false,"source":"BRONN","target":"FALYSE","weight":4},{"directed":false,"source":"BRONN","target":"MORGANS_FRIEND","weight":2},{"directed":false,"source":"CERSEI","target":"ELIA","weight":2},{"directed":false,"source":"CERSEI","target":"FOOL","weight":2},{"directed":false,"source":"CERSEI","target":"JOFFREY_DWARF","weight":2},{"directed":false,"source":"CERSEI","target":"ROBB_DWARF","weight":2},{"directed":false,"source":"CRASTER","target":"CRASTERS_BABY","weight":2},{"directed":false,"source":"CRASTER","target":"HODOR","weight":2},{"directed":false,"source":"CRASTERS_BABY","target":"HODOR","weight":2},{"directed":false,"source":"CRASTERS_BABY","target":"JOJEN","weight":2},{"directed":false,"source":"CRASTERS_BABY","target":"KARL_TANNER","weight":2},{"directed":false,"source":"CRASTERS_BABY","target":"NIGHT_KING","weight":2},{"directed":false,"source":"CRASTERS_BABY","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"DAENERYS","target":"MASTER_MIGHDAL","weight":2},{"directed":false,"source":"DAENERYS","target":"RHAEGAR","weight":2},{"directed":false,"source":"DAVOS","target":"EDDISON_TOLLETT","weight":34},{"directed":false,"source":"DAVOS","target":"GRENN","weight":2},{"directed":false,"source":"DAVOS","target":"MAESTER_AEMON","weight":2},{"directed":false,"source":"DAVOS","target":"SAM","weight":18},{"directed":false,"source":"DONGO_THE_GIANT","target":"JON","weight":2},{"directed":false,"source":"DONNEL_HILL","target":"MAG_THE_MIGHTY","weight":2},{"directed":false,"source":"DORAN","target":"OBERYN","weight":10},{"directed":false,"source":"DORNISH_LORD","target":"OBERYN","weight":2},{"directed":false,"source":"DROGO","target":"RHAEGAR","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"MAESTER_AEMON","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"MELISANDRE","weight":13},{"directed":false,"source":"EDDISON_TOLLETT","target":"SELYSE","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"SHIREEN","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"STANNIS","weight":6},{"directed":false,"source":"ELLARIA","target":"MACE","weight":2},{"directed":false,"source":"ELLARIA","target":"MARGAERY","weight":2},{"directed":false,"source":"ELLARIA","target":"MORGANS_FRIEND","weight":2},{"directed":false,"source":"ELLARIA","target":"SANSA","weight":2},{"directed":false,"source":"ELLARIA","target":"VARYS","weight":5},{"directed":false,"source":"FENNESZ","target":"MISSANDEI","weight":2},{"directed":false,"source":"FOOL","target":"JOFFREY","weight":2},{"directed":false,"source":"FOOL","target":"TYWIN","weight":2},{"directed":false,"source":"GILLY","target":"MOLES_TOWN_MADAM","weight":2},{"directed":false,"source":"GOATHERD","target":"GOATHERDS_SON","weight":2},{"directed":false,"source":"GOATHERD","target":"GREY_WORM","weight":2},{"directed":false,"source":"GOATHERD","target":"JORAH","weight":2},{"directed":false,"source":"GRENN","target":"MAESTER_AEMON","weight":2},{"directed":false,"source":"GRENN","target":"MELISANDRE","weight":2},{"directed":false,"source":"GRENN","target":"SELYSE","weight":2},{"directed":false,"source":"GRENN","target":"SHIREEN","weight":2},{"directed":false,"source":"GRENN","target":"STANNIS","weight":2},{"directed":false,"source":"GRENN","target":"YGRITTE","weight":2},{"directed":false,"source":"GREY_WORM","target":"MOSSADOR","weight":5},{"directed":false,"source":"GUYMON","target":"STYR","weight":2},{"directed":false,"source":"GUYMON","target":"YGRITTE","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"MACE","weight":7},{"directed":false,"source":"HIZDAHR","target":"JORAH","weight":6},{"directed":false,"source":"HODOR","target":"NED","weight":5},{"directed":false,"source":"HODOR","target":"THREE_EYED_RAVEN","weight":17},{"directed":false,"source":"HOSTER","target":"JON_ARRYN","weight":2},{"directed":false,"source":"HOSTER","target":"LITTLEFINGER","weight":2},{"directed":false,"source":"HOUND","target":"INNKEEPERS_DAUGHTER","weight":2},{"directed":false,"source":"HOUND","target":"LOMMY","weight":2},{"directed":false,"source":"HOUND","target":"TOMMY","weight":2},{"directed":false,"source":"HOUND","target":"VARYS","weight":5},{"directed":false,"source":"INNKEEPER","target":"TOMMY","weight":2},{"directed":false,"source":"JAIME","target":"JOANNA","weight":2},{"directed":false,"source":"JANOS","target":"LITTLE_SAM","weight":2},{"directed":false,"source":"JANOS","target":"LOCKE","weight":2},{"directed":false,"source":"JANOS","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"JANOS","target":"PYP","weight":2},{"directed":false,"source":"JOFFREY","target":"LYSA","weight":2},{"directed":false,"source":"JOFFREY","target":"RENLY_DWARF","weight":2},{"directed":false,"source":"JOFFREY","target":"STANNIS_DWARF","weight":2},{"directed":false,"source":"JOFFREY_DWARF","target":"MARGAERY","weight":2},{"directed":false,"source":"JOFFREY_DWARF","target":"RENLY_DWARF","weight":2},{"directed":false,"source":"JOFFREY_DWARF","target":"TYRION","weight":2},{"directed":false,"source":"JOJEN","target":"LOCKE","weight":2},{"directed":false,"source":"JOJEN","target":"RAST","weight":2},{"directed":false,"source":"JON","target":"MELISANDRE","weight":99},{"directed":false,"source":"JON","target":"SELYSE","weight":8},{"directed":false,"source":"JON","target":"SHIREEN","weight":4},{"directed":false,"source":"JORAH","target":"MEEREEN_CHAMPION","weight":2},{"directed":false,"source":"LEAF","target":"THREE_EYED_RAVEN","weight":10},{"directed":false,"source":"LITTLE_SAM","target":"MOLES_TOWN_MADAM","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"PYP","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"VANCE_CORBRAY","weight":2},{"directed":false,"source":"LOCKE","target":"MEERA","weight":2},{"directed":false,"source":"LOCKE","target":"MORAG","weight":2},{"directed":false,"source":"LOCKE","target":"RAST","weight":2},{"directed":false,"source":"LOCKE","target":"SAM","weight":2},{"directed":false,"source":"LOCKE","target":"SISSY","weight":2},{"directed":false,"source":"LOLLYS","target":"TYRION","weight":2},{"directed":false,"source":"LORAS","target":"RENLY_DWARF","weight":2},{"directed":false,"source":"LORAS","target":"STANNIS_DWARF","weight":2},{"directed":false,"source":"LUTHOR","target":"VIOLA","weight":2},{"directed":false,"source":"MACE","target":"MOUNTAIN","weight":2},{"directed":false,"source":"MACE","target":"PODRICK","weight":2},{"directed":false,"source":"MAESTER_AEMON","target":"MELISANDRE","weight":2},{"directed":false,"source":"MAESTER_AEMON","target":"OLLY","weight":2},{"directed":false,"source":"MAESTER_AEMON","target":"SELYSE","weight":2},{"directed":false,"source":"MAESTER_AEMON","target":"SHIREEN","weight":2},{"directed":false,"source":"MAESTER_AEMON","target":"STANNIS","weight":2},{"directed":false,"source":"MAREI","target":"MORGAN","weight":2},{"directed":false,"source":"MAREI","target":"SHAE","weight":2},{"directed":false,"source":"MARGAERY","target":"ROBB_DWARF","weight":2},{"directed":false,"source":"MEERA","target":"NED","weight":4},{"directed":false,"source":"MEERA","target":"RAST","weight":2},{"directed":false,"source":"MELISANDRE","target":"SAM","weight":7},{"directed":false,"source":"MERYN_TRANT","target":"THEON","weight":2},{"directed":false,"source":"MISSANDEI","target":"ZALA","weight":2},{"directed":false,"source":"MOLES_TOWN_WHORE","target":"SAM","weight":2},{"directed":false,"source":"MORGANS_FRIEND","target":"TYRION","weight":2},{"directed":false,"source":"MOUNTAIN","target":"SHAE","weight":2},{"directed":false,"source":"MUSICIAN","target":"OLENNA","weight":2},{"directed":false,"source":"MYRCELLA","target":"OBERYN","weight":4},{"directed":false,"source":"NED","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"NIGHT_KING","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"OLENNA","target":"VIOLA","weight":2},{"directed":false,"source":"OLLYS_MOTHER","target":"STYR","weight":2},{"directed":false,"source":"OLLYS_MOTHER","target":"TORMUND","weight":2},{"directed":false,"source":"OLLYS_MOTHER","target":"YGRITTE","weight":2},{"directed":false,"source":"ORYS","target":"ORYS_BROTHER","weight":2},{"directed":false,"source":"ORYS","target":"TYWIN","weight":2},{"directed":false,"source":"ORYS_BROTHER","target":"TYWIN","weight":2},{"directed":false,"source":"POLLIVER","target":"TOMMY","weight":2},{"directed":false,"source":"RALF","target":"ROOSE_BOLTON","weight":2},{"directed":false,"source":"RAMSAY","target":"RICKON","weight":15},{"directed":false,"source":"RENLY_DWARF","target":"ROBB_DWARF","weight":2},{"directed":false,"source":"ROBB_DWARF","target":"SANSA","weight":2},{"directed":false,"source":"ROBB_DWARF","target":"TYRION","weight":2},{"directed":false,"source":"SAM","target":"SELYSE","weight":7},{"directed":false,"source":"SAM","target":"SHIREEN","weight":6},{"directed":false,"source":"SAM","target":"STANNIS","weight":28},{"directed":false,"source":"SANSA","target":"VANCE_CORBRAY","weight":2},{"directed":false,"source":"SANSA","target":"WAYMAR_ROYCE","weight":2},{"directed":false,"source":"TOMMEN","target":"TYCHO","weight":2},{"directed":false,"source":"TOMMEN","target":"VARYS","weight":2},{"directed":false,"source":"TYCHO","target":"TYWIN","weight":5},{"directed":false,"source":"JORAH","target":"TYRION","weight":168},{"directed":false,"source":"DAENERYS","target":"TYRION","weight":468},{"directed":false,"source":"CERSEI","target":"HIGH_SPARROW","weight":111},{"directed":false,"source":"SANSA","target":"THEON","weight":117},{"directed":false,"source":"JAIME","target":"MYRCELLA","weight":62},{"directed":false,"source":"MYRANDA","target":"SANSA","weight":58},{"directed":false,"source":"RAMSAY","target":"SANSA","weight":91},{"directed":false,"source":"ARYA","target":"WAIF","weight":96},{"directed":false,"source":"BRONN","target":"TYENE","weight":34},{"directed":false,"source":"DORAN","target":"ELLARIA","weight":41},{"directed":false,"source":"JAQEN","target":"WAIF","weight":52},{"directed":false,"source":"HIGH_SPARROW","target":"OLENNA","weight":34},{"directed":false,"source":"DAENERYS","target":"MOSSADOR","weight":28},{"directed":false,"source":"JON","target":"KARSI","weight":28},{"directed":false,"source":"AREO","target":"DORAN","weight":30},{"directed":false,"source":"DAARIO","target":"TYRION","weight":27},{"directed":false,"source":"DAARIO","target":"HIZDAHR","weight":24},{"directed":false,"source":"DORAN","target":"JAIME","weight":24},{"directed":false,"source":"LITTLEFINGER","target":"ROOSE_BOLTON","weight":22},{"directed":false,"source":"CERSEI","target":"KEVAN","weight":39},{"directed":false,"source":"HIGH_SPARROW","target":"LORAS","weight":43},{"directed":false,"source":"CERSEI","target":"MAGGY","weight":20},{"directed":false,"source":"AREO","target":"BRONN","weight":19},{"directed":false,"source":"KARSI","target":"TORMUND","weight":19},{"directed":false,"source":"TYCHO","target":"MACE","weight":19},{"directed":false,"source":"AREO","target":"JAIME","weight":18},{"directed":false,"source":"GILLY","target":"SHIREEN","weight":18},{"directed":false,"source":"BLACK_HAIRED_PROSTITUTE","target":"TYRION","weight":17},{"directed":false,"source":"HIGH_SPARROW","target":"MARGAERY","weight":93},{"directed":false,"source":"MALKO","target":"TYRION","weight":17},{"directed":false,"source":"JAIME","target":"TRYSTANE","weight":16},{"directed":false,"source":"JON","target":"LOBODA","weight":16},{"directed":false,"source":"LITTLEFINGER","target":"OLENNA","weight":16},{"directed":false,"source":"MISSANDEI","target":"TYRION","weight":156},{"directed":false,"source":"ROOSE_BOLTON","target":"SANSA","weight":23},{"directed":false,"source":"AREO","target":"ELLARIA","weight":18},{"directed":false,"source":"AREO","target":"MYRCELLA","weight":15},{"directed":false,"source":"CERSEI","target":"SEPTA_UNELLA","weight":26},{"directed":false,"source":"LANCEL","target":"LITTLEFINGER","weight":14},{"directed":false,"source":"LITTLEFINGER","target":"RAMSAY","weight":18},{"directed":false,"source":"NYMERIA","target":"TYENE","weight":20},{"directed":false,"source":"ARYA","target":"THIN_MAN","weight":13},{"directed":false,"source":"HIZDAHR","target":"TYRION","weight":13},{"directed":false,"source":"BRONN","target":"DORNISH_RIDER","weight":12},{"directed":false,"source":"CERSEI","target":"MELARA","weight":12},{"directed":false,"source":"JORAH","target":"MALKO","weight":12},{"directed":false,"source":"BRAND","target":"DERRYK","weight":11},{"directed":false,"source":"ELLARIA","target":"OBARA","weight":17},{"directed":false,"source":"ELLARIA","target":"TYENE","weight":37},{"directed":false,"source":"HIGH_SEPTON","target":"OLYVAR","weight":11},{"directed":false,"source":"JAQEN","target":"THIN_MAN","weight":11},{"directed":false,"source":"DAVOS","target":"OLLY","weight":14},{"directed":false,"source":"ELLARIA","target":"MYRCELLA","weight":10},{"directed":false,"source":"OLLY","target":"STANNIS","weight":10},{"directed":false,"source":"BRONN","target":"MYRCELLA","weight":9},{"directed":false,"source":"DORAN","target":"MYRCELLA","weight":9},{"directed":false,"source":"DORAN","target":"TRYSTANE","weight":9},{"directed":false,"source":"HIGH_SPARROW","target":"OLYVAR","weight":9},{"directed":false,"source":"LITTLEFINGER","target":"ROYCE","weight":9},{"directed":false,"source":"MACE","target":"QYBURN","weight":9},{"directed":false,"source":"AREO","target":"TRYSTANE","weight":8},{"directed":false,"source":"HIGH_SPARROW","target":"TOMMEN","weight":57},{"directed":false,"source":"HIZDAHR","target":"MISSANDEI","weight":8},{"directed":false,"source":"KARSI","target":"LOBODA","weight":8},{"directed":false,"source":"LANCEL","target":"LORAS","weight":13},{"directed":false,"source":"SANSA","target":"WALDA","weight":8},{"directed":false,"source":"AREO","target":"OBARA","weight":7},{"directed":false,"source":"BRONN","target":"OBARA","weight":7},{"directed":false,"source":"DERRYK","target":"SAM","weight":7},{"directed":false,"source":"GILLY","target":"OLLY","weight":7},{"directed":false,"source":"HIZDAHR","target":"MOSSADOR","weight":7},{"directed":false,"source":"MACE","target":"MERYN_TRANT","weight":9},{"directed":false,"source":"MARGAERY","target":"OLYVAR","weight":7},{"directed":false,"source":"OWNER","target":"TYRION","weight":7},{"directed":false,"source":"RAMSAY","target":"STANNIS","weight":7},{"directed":false,"source":"BRAND","target":"SAM","weight":6},{"directed":false,"source":"BRONN","target":"DORAN","weight":6},{"directed":false,"source":"BRONN","target":"TRYSTANE","weight":6},{"directed":false,"source":"DAARIO","target":"MOSSADOR","weight":6},{"directed":false,"source":"GILLY","target":"SELYSE","weight":6},{"directed":false,"source":"HIGH_SEPTON","target":"LANCEL","weight":6},{"directed":false,"source":"HIGH_SEPTON","target":"QYBURN","weight":6},{"directed":false,"source":"MADAME","target":"MERYN_TRANT","weight":6},{"directed":false,"source":"MYRANDA","target":"WALDA","weight":6},{"directed":false,"source":"MYRCELLA","target":"OBARA","weight":6},{"directed":false,"source":"NYMERIA","target":"OBARA","weight":24},{"directed":false,"source":"OBARA","target":"TYENE","weight":15},{"directed":false,"source":"ALLISER_THORNE","target":"STANNIS","weight":5},{"directed":false,"source":"BRONN","target":"NYMERIA","weight":5},{"directed":false,"source":"DAENERYS","target":"OWNER","weight":5},{"directed":false,"source":"DERRYK","target":"GILLY","weight":5},{"directed":false,"source":"ELLARIA","target":"NYMERIA","weight":9},{"directed":false,"source":"KEVAN","target":"TOMMEN","weight":12},{"directed":false,"source":"PODRICK","target":"STANNIS","weight":5},{"directed":false,"source":"ALLISER_THORNE","target":"DAVOS","weight":26},{"directed":false,"source":"AREO","target":"NYMERIA","weight":4},{"directed":false,"source":"AREO","target":"TYENE","weight":7},{"directed":false,"source":"ARYA","target":"MACE","weight":4},{"directed":false,"source":"BARRISTAN","target":"MOSSADOR","weight":4},{"directed":false,"source":"CERSEI","target":"OLYVAR","weight":4},{"directed":false,"source":"CERSEI","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"DORNISH_RIDER","target":"JAIME","weight":4},{"directed":false,"source":"ELLARIA","target":"TRYSTANE","weight":4},{"directed":false,"source":"GILLY","target":"STANNIS","weight":4},{"directed":false,"source":"HIGH_SEPTON","target":"HIGH_SPARROW","weight":4},{"directed":false,"source":"HIGH_SPARROW","target":"RENLY","weight":4},{"directed":false,"source":"HIGH_SPARROW","target":"ROBERT","weight":4},{"directed":false,"source":"JAIME","target":"TYENE","weight":6},{"directed":false,"source":"JON","target":"NIGHT_KING","weight":40},{"directed":false,"source":"JORAH","target":"OWNER","weight":4},{"directed":false,"source":"LITTLEFINGER","target":"THEON","weight":4},{"directed":false,"source":"LOBODA","target":"TORMUND","weight":4},{"directed":false,"source":"MERYN_TRANT","target":"QYBURN","weight":4},{"directed":false,"source":"MYRANDA","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"QUICK","target":"STRONG","weight":4},{"directed":false,"source":"ROOSE_BOLTON","target":"STANNIS","weight":4},{"directed":false,"source":"THEON","target":"WALDA","weight":4},{"directed":false,"source":"AERYS","target":"DAENERYS","weight":16},{"directed":false,"source":"ARYA","target":"TYCHO","weight":3},{"directed":false,"source":"BARRISTAN","target":"RHAEGAR","weight":3},{"directed":false,"source":"DORAN","target":"TOMMEN","weight":3},{"directed":false,"source":"GREY_WORM","target":"TYRION","weight":142},{"directed":false,"source":"JAIME","target":"LOLLYS","weight":3},{"directed":false,"source":"JAIME","target":"OBARA","weight":3},{"directed":false,"source":"JANOS","target":"STANNIS","weight":3},{"directed":false,"source":"KEVAN","target":"LANCEL","weight":3},{"directed":false,"source":"KEVAN","target":"PYCELLE","weight":8},{"directed":false,"source":"KEVAN","target":"QYBURN","weight":5},{"directed":false,"source":"LITTLE_SAM","target":"OLLY","weight":3},{"directed":false,"source":"LITTLEFINGER","target":"LYANNA","weight":3},{"directed":false,"source":"LORD_WEEBLY","target":"SAM","weight":3},{"directed":false,"source":"LYANNA","target":"SANSA","weight":3},{"directed":false,"source":"MANCE","target":"MELISANDRE","weight":3},{"directed":false,"source":"OBARA","target":"OBERYN","weight":3},{"directed":false,"source":"PODRICK","target":"RENLY","weight":3},{"directed":false,"source":"RICKON","target":"SANSA","weight":10},{"directed":false,"source":"ROYCE","target":"SANSA","weight":3},{"directed":false,"source":"STANNIS","target":"TORMUND","weight":7},{"directed":false,"source":"AEGON","target":"RHAENYRA","weight":2},{"directed":false,"source":"ALLISER_THORNE","target":"DENYS","weight":2},{"directed":false,"source":"ALLISER_THORNE","target":"MANCE","weight":2},{"directed":false,"source":"ARYA","target":"MADAME","weight":2},{"directed":false,"source":"ARYA","target":"WALDER","weight":22},{"directed":false,"source":"BARRISTAN","target":"HIZDAHR","weight":2},{"directed":false,"source":"BRIAN","target":"JON","weight":2},{"directed":false,"source":"BRIENNE","target":"ROBERT","weight":2},{"directed":false,"source":"CERSEI","target":"JORAH","weight":2},{"directed":false,"source":"CERWYN","target":"RAMSAY","weight":2},{"directed":false,"source":"DAARIO","target":"QUICK","weight":2},{"directed":false,"source":"DAARIO","target":"STRONG","weight":2},{"directed":false,"source":"DAENERYS","target":"QUICK","weight":2},{"directed":false,"source":"DAENERYS","target":"STRONG","weight":2},{"directed":false,"source":"DORAN","target":"OBARA","weight":2},{"directed":false,"source":"DORAN","target":"TYENE","weight":6},{"directed":false,"source":"EDDISON_TOLLETT","target":"LITTLE_SAM","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"TORMUND","weight":36},{"directed":false,"source":"GILLY","target":"MELISANDRE","weight":2},{"directed":false,"source":"HIGH_SPARROW","target":"MERYN_TRANT","weight":2},{"directed":false,"source":"HIGH_SPARROW","target":"SEPTA_UNELLA","weight":12},{"directed":false,"source":"HIZDAHR","target":"OWNER","weight":2},{"directed":false,"source":"HIZDAHR","target":"QUICK","weight":2},{"directed":false,"source":"HIZDAHR","target":"STRONG","weight":2},{"directed":false,"source":"JAIME","target":"NYMERIA","weight":2},{"directed":false,"source":"JAQEN","target":"MACE","weight":2},{"directed":false,"source":"JAQEN","target":"MERYN_TRANT","weight":2},{"directed":false,"source":"JON","target":"LITTLE_SAM","weight":2},{"directed":false,"source":"JON","target":"LORD_WEEBLY","weight":2},{"directed":false,"source":"JON","target":"ROOSE_BOLTON","weight":5},{"directed":false,"source":"JORAH","target":"MOSSADOR","weight":2},{"directed":false,"source":"KARSI","target":"NIGHT_KING","weight":2},{"directed":false,"source":"LANCEL","target":"OLYVAR","weight":2},{"directed":false,"source":"LANCEL","target":"PYCELLE","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"MELISANDRE","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"STANNIS","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"MYRANDA","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"TOMMEN","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"WALDA","weight":2},{"directed":false,"source":"LOLLYS","target":"TANDA","weight":2},{"directed":false,"source":"LYANNA_MORMONT","target":"STANNIS","weight":2},{"directed":false,"source":"MACE","target":"THIN_MAN","weight":2},{"directed":false,"source":"MAESTER_WOLKAN","target":"ROOSE_BOLTON","weight":4},{"directed":false,"source":"MAGGY","target":"MELARA","weight":2},{"directed":false,"source":"MAGGY","target":"ROBERT","weight":2},{"directed":false,"source":"MAGNAR","target":"SAM","weight":2},{"directed":false,"source":"MANCE","target":"SAM","weight":2},{"directed":false,"source":"MARGAERY","target":"ROBERT","weight":2},{"directed":false,"source":"MELISANDRE","target":"OLLY","weight":4},{"directed":false,"source":"MERYN_TRANT","target":"MOUNTAIN","weight":2},{"directed":false,"source":"MERYN_TRANT","target":"THIN_MAN","weight":2},{"directed":false,"source":"MOSSADOR","target":"TYRION","weight":2},{"directed":false,"source":"OLENNA","target":"OLYVAR","weight":2},{"directed":false,"source":"OLYVAR","target":"TOMMEN","weight":2},{"directed":false,"source":"QUICK","target":"TYRION","weight":2},{"directed":false,"source":"ROBIN","target":"ROYCE","weight":2},{"directed":false,"source":"STANNIS","target":"STEFFON","weight":2},{"directed":false,"source":"STRONG","target":"TYRION","weight":2},{"directed":false,"source":"THIN_MAN","target":"WAIF","weight":2},{"directed":false,"source":"TYCHO","target":"JAQEN","weight":2},{"directed":false,"source":"TYCHO","target":"MERYN_TRANT","weight":2},{"directed":false,"source":"TYCHO","target":"THIN_MAN","weight":2},{"directed":false,"source":"JON","target":"SANSA","weight":300},{"directed":false,"source":"ARYA","target":"LADY_CRANE","weight":64},{"directed":false,"source":"DAVOS","target":"TORMUND","weight":76},{"directed":false,"source":"HOUND","target":"RAY","weight":41},{"directed":false,"source":"DAVOS","target":"SANSA","weight":64},{"directed":false,"source":"BRYNDEN","target":"JAIME","weight":35},{"directed":false,"source":"DAENERYS","target":"KHAL_MORO","weight":34},{"directed":false,"source":"RAMSAY","target":"SMALLJON","weight":34},{"directed":false,"source":"HIGH_SPARROW","target":"JAIME","weight":33},{"directed":false,"source":"BRIENNE","target":"BRYNDEN","weight":32},{"directed":false,"source":"EDMURE","target":"JAIME","weight":31},{"directed":false,"source":"JON","target":"RAMSAY","weight":30},{"directed":false,"source":"BENJEN","target":"BRAN","weight":29},{"directed":false,"source":"JON","target":"LYANNA_MORMONT","weight":41},{"directed":false,"source":"SANSA","target":"TORMUND","weight":37},{"directed":false,"source":"OSHA","target":"RAMSAY","weight":23},{"directed":false,"source":"CAMELLO","target":"LADY_CRANE","weight":21},{"directed":false,"source":"GREY_WORM","target":"VARYS","weight":53},{"directed":false,"source":"MARGAERY","target":"SEPTA_UNELLA","weight":21},{"directed":false,"source":"JAIME","target":"WALDER","weight":19},{"directed":false,"source":"JON","target":"ROBETT","weight":27},{"directed":false,"source":"DAENERYS","target":"YARA","weight":24},{"directed":false,"source":"BALON","target":"EURON","weight":17},{"directed":false,"source":"DAVOS","target":"LYANNA_MORMONT","weight":24},{"directed":false,"source":"EURON","target":"YARA","weight":44},{"directed":false,"source":"BIANCA","target":"LADY_CRANE","weight":16},{"directed":false,"source":"BOBONO","target":"LADY_CRANE","weight":16},{"directed":false,"source":"EURON","target":"THEON","weight":36},{"directed":false,"source":"IZEMBARO","target":"LADY_CRANE","weight":16},{"directed":false,"source":"MISSANDEI","target":"VARYS","weight":52},{"directed":false,"source":"TYRION","target":"YEZZAN","weight":16},{"directed":false,"source":"BLACK_WALDER","target":"WALDER","weight":15},{"directed":false,"source":"DAENERYS","target":"LHAZAREEN_WOMAN","weight":15},{"directed":false,"source":"DAENERYS","target":"THEON","weight":33},{"directed":false,"source":"GILLY","target":"MELESSA","weight":15},{"directed":false,"source":"KINVARA","target":"TYRION","weight":15},{"directed":false,"source":"BLACK_WALDER","target":"JAIME","weight":14},{"directed":false,"source":"VALA","target":"VARYS","weight":14},{"directed":false,"source":"BIANCA","target":"IZEMBARO","weight":13},{"directed":false,"source":"JAIME","target":"LOTHAR","weight":13},{"directed":false,"source":"JON","target":"WUN_WUN","weight":13},{"directed":false,"source":"MAESTER_CITADEL","target":"SAM","weight":13},{"directed":false,"source":"ARTHUR","target":"NED","weight":12},{"directed":false,"source":"BENJEN","target":"MEERA","weight":12},{"directed":false,"source":"BRAN","target":"NIGHT_KING","weight":29},{"directed":false,"source":"LYANNA_MORMONT","target":"SANSA","weight":26},{"directed":false,"source":"MAESTER_WOLKAN","target":"RAMSAY","weight":12},{"directed":false,"source":"MELESSA","target":"TALLA","weight":12},{"directed":false,"source":"MELISANDRE","target":"TORMUND","weight":17},{"directed":false,"source":"TORMUND","target":"WUN_WUN","weight":12},{"directed":false,"source":"CLARENZO","target":"LADY_CRANE","weight":11},{"directed":false,"source":"DICKON","target":"SAM","weight":15},{"directed":false,"source":"EDDISON_TOLLETT","target":"SANSA","weight":13},{"directed":false,"source":"JOFFREY","target":"LADY_CRANE","weight":11},{"directed":false,"source":"LEM","target":"RAY","weight":11},{"directed":false,"source":"MELESSA","target":"RANDYLL","weight":11},{"directed":false,"source":"NED","target":"THREE_EYED_RAVEN","weight":11},{"directed":false,"source":"RAMSAY","target":"SON_OFWALDA","weight":11},{"directed":false,"source":"ARYA","target":"BIANCA","weight":10},{"directed":false,"source":"BIANCA","target":"BOBONO","weight":10},{"directed":false,"source":"BOBONO","target":"CLARENZO","weight":10},{"directed":false,"source":"BRIENNE","target":"JON","weight":30},{"directed":false,"source":"GREY_WORM","target":"YEZZAN","weight":10},{"directed":false,"source":"MELISANDRE","target":"SANSA","weight":10},{"directed":false,"source":"RAZDAL","target":"TYRION","weight":10},{"directed":false,"source":"SON_OFWALDA","target":"WALDA","weight":10},{"directed":false,"source":"AERON","target":"YARA","weight":9},{"directed":false,"source":"ARYA","target":"IZEMBARO","weight":9},{"directed":false,"source":"BOBONO","target":"IZEMBARO","weight":9},{"directed":false,"source":"BRIENNE","target":"EDDISON_TOLLETT","weight":12},{"directed":false,"source":"BRIENNE","target":"TORMUND","weight":55},{"directed":false,"source":"CLARENZO","target":"IZEMBARO","weight":9},{"directed":false,"source":"DAVOS","target":"WUN_WUN","weight":9},{"directed":false,"source":"ELLARIA","target":"OLENNA","weight":12},{"directed":false,"source":"GATINS","target":"HOUND","weight":9},{"directed":false,"source":"AERON","target":"EURON","weight":8},{"directed":false,"source":"BENJEN","target":"LYANNA","weight":8},{"directed":false,"source":"BIANCA","target":"CLARENZO","weight":8},{"directed":false,"source":"DAENERYS","target":"DOSH_KHALEEN_LEADER","weight":8},{"directed":false,"source":"DAVOS","target":"RAMSAY","weight":8},{"directed":false,"source":"DOSH_KHALEEN_LEADER","target":"LHAZAREEN_WOMAN","weight":8},{"directed":false,"source":"GILLY","target":"TALLA","weight":8},{"directed":false,"source":"HIGH_SPARROW","target":"LANCEL","weight":8},{"directed":false,"source":"JON","target":"LITTLEFINGER","weight":28},{"directed":false,"source":"JON","target":"SMALLJON","weight":8},{"directed":false,"source":"KINVARA","target":"VARYS","weight":8},{"directed":false,"source":"QYBURN","target":"TOMMEN","weight":8},{"directed":false,"source":"RAMSAY","target":"RICKARD_KARSTARK","weight":8},{"directed":false,"source":"RAMSAY","target":"TORMUND","weight":8},{"directed":false,"source":"SAM","target":"TALLA","weight":8},{"directed":false,"source":"BELICHO","target":"TYRION","weight":7},{"directed":false,"source":"BENJEN","target":"THREE_EYED_RAVEN","weight":7},{"directed":false,"source":"BOBONO","target":"CAMELLO","weight":7},{"directed":false,"source":"EDMURE","target":"GUARD_CAPTAIN","weight":7},{"directed":false,"source":"GLOVER","target":"JON","weight":7},{"directed":false,"source":"GREY_WORM","target":"RAZDAL","weight":7},{"directed":false,"source":"KEVAN","target":"OLENNA","weight":7},{"directed":false,"source":"LYANNA_MORMONT","target":"MAESTER_MORMONT","weight":7},{"directed":false,"source":"MEERA","target":"NIGHT_KING","weight":7},{"directed":false,"source":"MISSANDEI","target":"RAZDAL","weight":7},{"directed":false,"source":"MISSANDEI","target":"YEZZAN","weight":7},{"directed":false,"source":"NYMERIA","target":"TRYSTANE","weight":7},{"directed":false,"source":"OBARA","target":"OLENNA","weight":7},{"directed":false,"source":"OLENNA","target":"SEPTA_UNELLA","weight":7},{"directed":false,"source":"RAZDAL","target":"YEZZAN","weight":7},{"directed":false,"source":"ROBETT","target":"SANSA","weight":14},{"directed":false,"source":"ROBIN","target":"YOHN_ROYCE","weight":10},{"directed":false,"source":"ALLISER_THORNE","target":"BOWEN_MARSH","weight":6},{"directed":false,"source":"ARTHUR_CHILD","target":"QYBURN","weight":6},{"directed":false,"source":"ARYA","target":"CLARENZO","weight":6},{"directed":false,"source":"BELICHO","target":"RAZDAL","weight":6},{"directed":false,"source":"BOWEN_MARSH","target":"JON","weight":6},{"directed":false,"source":"BRAN","target":"LYANNA","weight":13},{"directed":false,"source":"BRYNDEN","target":"GUARD_CAPTAIN","weight":6},{"directed":false,"source":"BRYNDEN","target":"PODRICK","weight":6},{"directed":false,"source":"BRYNDEN","target":"SANSA","weight":6},{"directed":false,"source":"CAMELLO","target":"CLARENZO","weight":6},{"directed":false,"source":"CAMELLO","target":"IZEMBARO","weight":6},{"directed":false,"source":"CERSEI","target":"LADY_CRANE","weight":6},{"directed":false,"source":"DAENERYS","target":"RAZDAL","weight":6},{"directed":false,"source":"DAVOS","target":"SMALLJON","weight":6},{"directed":false,"source":"HIGH_SPARROW","target":"MACE","weight":6},{"directed":false,"source":"HOUND","target":"LEM","weight":6},{"directed":false,"source":"LADY_CRANE","target":"SANSA","weight":6},{"directed":false,"source":"LANCEL","target":"MARGAERY","weight":6},{"directed":false,"source":"LEAF","target":"NIGHT_KING","weight":6},{"directed":false,"source":"OBARA","target":"TRYSTANE","weight":6},{"directed":false,"source":"RICKON","target":"SMALLJON","weight":6},{"directed":false,"source":"SMALLJON","target":"TORMUND","weight":6},{"directed":false,"source":"TYRION","target":"YARA","weight":11},{"directed":false,"source":"ARYA","target":"BOBONO","weight":5},{"directed":false,"source":"ARYA","target":"CAMELLO","weight":5},{"directed":false,"source":"BELICHO","target":"GREY_WORM","weight":5},{"directed":false,"source":"BELICHO","target":"MISSANDEI","weight":5},{"directed":false,"source":"BELICHO","target":"YEZZAN","weight":5},{"directed":false,"source":"BLACK_WALDER","target":"BRONN","weight":5},{"directed":false,"source":"BOBONO","target":"JOFFREY","weight":5},{"directed":false,"source":"BRIENNE","target":"THEON","weight":10},{"directed":false,"source":"CLARENZO","target":"JOFFREY","weight":5},{"directed":false,"source":"CLARENZO","target":"TYRION","weight":5},{"directed":false,"source":"DAENERYS","target":"KINVARA","weight":5},{"directed":false,"source":"DAVOS","target":"LITTLEFINGER","weight":9},{"directed":false,"source":"DIM_DALBA","target":"JON","weight":5},{"directed":false,"source":"DOM","target":"VARYS","weight":5},{"directed":false,"source":"DORAN","target":"MAESTER_DORNE","weight":5},{"directed":false,"source":"DROGO","target":"KHAL_MORO","weight":5},{"directed":false,"source":"JON","target":"MAESTER_MORMONT","weight":5},{"directed":false,"source":"LADY_CRANE","target":"TYRION","weight":5},{"directed":false,"source":"LITTLE_SAM","target":"MELESSA","weight":5},{"directed":false,"source":"MAESTER_MORMONT","target":"SANSA","weight":5},{"directed":false,"source":"NIGHT_KING","target":"THREE_EYED_RAVEN","weight":5},{"directed":false,"source":"PODRICK","target":"THEON","weight":9},{"directed":false,"source":"RAMSAY","target":"WUN_WUN","weight":5},{"directed":false,"source":"RANDYLL","target":"TALLA","weight":5},{"directed":false,"source":"RICKARD_KARSTARK","target":"SMALLJON","weight":5},{"directed":false,"source":"SANSA","target":"WUN_WUN","weight":5},{"directed":false,"source":"AERON","target":"BALON","weight":4},{"directed":false,"source":"AERON","target":"THEON","weight":4},{"directed":false,"source":"ARTHUR","target":"HOWLAND","weight":4},{"directed":false,"source":"BIANCA","target":"CAMELLO","weight":4},{"directed":false,"source":"BIANCA","target":"JOFFREY","weight":4},{"directed":false,"source":"BIANCA","target":"SANSA","weight":4},{"directed":false,"source":"BOBONO","target":"SANSA","weight":4},{"directed":false,"source":"BOBONO","target":"TYRION","weight":4},{"directed":false,"source":"BOBONO","target":"TYWIN","weight":4},{"directed":false,"source":"BOWEN_MARSH","target":"DAVOS","weight":4},{"directed":false,"source":"BOWEN_MARSH","target":"EDDISON_TOLLETT","weight":4},{"directed":false,"source":"BOWEN_MARSH","target":"MELISANDRE","weight":4},{"directed":false,"source":"BOWEN_MARSH","target":"OLLY","weight":4},{"directed":false,"source":"BOWEN_MARSH","target":"OTHELL_YARWYCK","weight":6},{"directed":false,"source":"BOWEN_MARSH","target":"TORMUND","weight":4},{"directed":false,"source":"BRONN","target":"LOTHAR","weight":4},{"directed":false,"source":"CERSEI","target":"CLARENZO","weight":4},{"directed":false,"source":"CLARENZO","target":"SANSA","weight":4},{"directed":false,"source":"DAARIO","target":"LHAZAREEN_WOMAN","weight":4},{"directed":false,"source":"DAENERYS","target":"YEZZAN","weight":4},{"directed":false,"source":"DAVOS","target":"MAESTER_MORMONT","weight":4},{"directed":false,"source":"DICKON","target":"GILLY","weight":4},{"directed":false,"source":"DIM_DALBA","target":"TORMUND","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"PODRICK","weight":4},{"directed":false,"source":"GILLY","target":"MAESTER_CITADEL","weight":4},{"directed":false,"source":"GLOVER","target":"MANDERLY","weight":4},{"directed":false,"source":"HARALD","target":"RAMSAY","weight":4},{"directed":false,"source":"HODOR","target":"LYANNA","weight":4},{"directed":false,"source":"HODOR","target":"NIGHT_KING","weight":4},{"directed":false,"source":"HOWLAND","target":"NED","weight":4},{"directed":false,"source":"JAIME","target":"SON_OF_EDMURE","weight":4},{"directed":false,"source":"JON","target":"MANDERLY","weight":4},{"directed":false,"source":"JON","target":"PODRICK","weight":11},{"directed":false,"source":"KEVAN","target":"MARGAERY","weight":4},{"directed":false,"source":"LITTLEFINGER","target":"TORMUND","weight":7},{"directed":false,"source":"LYANNA_MORMONT","target":"ROBB","weight":4},{"directed":false,"source":"MAESTER_WOLKAN","target":"MYRANDA","weight":4},{"directed":false,"source":"MAESTER_WOLKAN","target":"RICKARD_KARSTARK","weight":4},{"directed":false,"source":"NYMERIA","target":"OLENNA","weight":4},{"directed":false,"source":"PODRICK","target":"TORMUND","weight":28},{"directed":false,"source":"RED_PRIEST","target":"TYRION","weight":4},{"directed":false,"source":"SANSA","target":"SMALLJON","weight":4},{"directed":false,"source":"ALLISER_THORNE","target":"MELISANDRE","weight":3},{"directed":false,"source":"ALLISER_THORNE","target":"WUN_WUN","weight":3},{"directed":false,"source":"ARTHUR","target":"BRAN","weight":3},{"directed":false,"source":"ARTHUR","target":"THREE_EYED_RAVEN","weight":3},{"directed":false,"source":"BENJEN","target":"HODOR","weight":3},{"directed":false,"source":"BERIC","target":"LEM","weight":3},{"directed":false,"source":"BIANCA","target":"CERSEI","weight":3},{"directed":false,"source":"BIANCA","target":"NED","weight":3},{"directed":false,"source":"BIANCA","target":"TYRION","weight":3},{"directed":false,"source":"BOBONO","target":"CERSEI","weight":3},{"directed":false,"source":"BOBONO","target":"NED","weight":3},{"directed":false,"source":"BRONN","target":"EDMURE","weight":3},{"directed":false,"source":"CERSEI","target":"IZEMBARO","weight":3},{"directed":false,"source":"CLARENZO","target":"MARGAERY","weight":3},{"directed":false,"source":"DAENERYS","target":"RED_PRIEST","weight":3},{"directed":false,"source":"DAVOS","target":"GLOVER","weight":3},{"directed":false,"source":"DAVOS","target":"HARALD","weight":3},{"directed":false,"source":"DICKON","target":"RANDYLL","weight":30},{"directed":false,"source":"DIM_DALBA","target":"WUN_WUN","weight":3},{"directed":false,"source":"DOM","target":"VALA","weight":3},{"directed":false,"source":"EDDISON_TOLLETT","target":"WUN_WUN","weight":3},{"directed":false,"source":"GLOVER","target":"SANSA","weight":3},{"directed":false,"source":"HARALD","target":"JON","weight":3},{"directed":false,"source":"HARALD","target":"SANSA","weight":3},{"directed":false,"source":"HARALD","target":"SMALLJON","weight":3},{"directed":false,"source":"HARALD","target":"TORMUND","weight":3},{"directed":false,"source":"HIGH_SPARROW","target":"KEVAN","weight":3},{"directed":false,"source":"HOWLAND","target":"THREE_EYED_RAVEN","weight":3},{"directed":false,"source":"IZEMBARO","target":"JOFFREY","weight":3},{"directed":false,"source":"IZEMBARO","target":"NED","weight":3},{"directed":false,"source":"IZEMBARO","target":"TYWIN","weight":3},{"directed":false,"source":"JORAH","target":"LHAZAREEN_WOMAN","weight":3},{"directed":false,"source":"KEVAN","target":"LORAS","weight":3},{"directed":false,"source":"KEVAN","target":"MACE","weight":3},{"directed":false,"source":"LEM","target":"THOROS","weight":3},{"directed":false,"source":"LITTLE_SAM","target":"TALLA","weight":3},{"directed":false,"source":"LYANNA","target":"THREE_EYED_RAVEN","weight":3},{"directed":false,"source":"LYANNA_MORMONT","target":"RAMSAY","weight":3},{"directed":false,"source":"LYANNA_MORMONT","target":"TORMUND","weight":11},{"directed":false,"source":"MANDERLY","target":"ROBB","weight":3},{"directed":false,"source":"NED","target":"OLD_NAN","weight":3},{"directed":false,"source":"NED","target":"RAMSAY","weight":3},{"directed":false,"source":"OLENNA","target":"TYENE","weight":3},{"directed":false,"source":"RAZDAL","target":"VARYS","weight":3},{"directed":false,"source":"RED_PRIEST","target":"VARYS","weight":3},{"directed":false,"source":"ROBB","target":"ROBETT","weight":3},{"directed":false,"source":"ROOSE_BOLTON","target":"SMALLJON","weight":3},{"directed":false,"source":"SMALLJON","target":"WUN_WUN","weight":3},{"directed":false,"source":"AREO","target":"MAESTER_DORNE","weight":2},{"directed":false,"source":"ARYA","target":"RICKON","weight":2},{"directed":false,"source":"BELICHO","target":"DAENERYS","weight":2},{"directed":false,"source":"BELICHO","target":"VARYS","weight":2},{"directed":false,"source":"BENJEN","target":"RODRIK","weight":2},{"directed":false,"source":"BIANCA","target":"MARGAERY","weight":2},{"directed":false,"source":"BOBONO","target":"MARGAERY","weight":2},{"directed":false,"source":"BRAN","target":"HOWLAND","weight":2},{"directed":false,"source":"BRAN","target":"JAQEN","weight":2},{"directed":false,"source":"BRONN","target":"BRYNDEN","weight":2},{"directed":false,"source":"BRONN","target":"WALDER","weight":2},{"directed":false,"source":"BRYNDEN","target":"MINISA","weight":2},{"directed":false,"source":"CAMELLO","target":"NED","weight":2},{"directed":false,"source":"CAMELLO","target":"SANSA","weight":2},{"directed":false,"source":"CAMELLO","target":"TYRION","weight":2},{"directed":false,"source":"CERSEI","target":"SON_OF_EDMURE","weight":2},{"directed":false,"source":"CLARENZO","target":"ROBERT","weight":2},{"directed":false,"source":"DAARIO","target":"DOSH_KHALEEN_LEADER","weight":2},{"directed":false,"source":"DAARIO","target":"KHAL_MORO","weight":2},{"directed":false,"source":"DAENERYS","target":"VALA","weight":2},{"directed":false,"source":"DAVOS","target":"DIM_DALBA","weight":2},{"directed":false,"source":"DAVOS","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"DAVOS","target":"RICKON","weight":2},{"directed":false,"source":"DAVOS","target":"ROBETT","weight":4},{"directed":false,"source":"DICKON","target":"MELESSA","weight":2},{"directed":false,"source":"DICKON","target":"TALLA","weight":2},{"directed":false,"source":"DIM_DALBA","target":"SANSA","weight":2},{"directed":false,"source":"DOSH_KHALEEN_LEADER","target":"JORAH","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"EDMURE","target":"HOSTER","weight":2},{"directed":false,"source":"EDMURE","target":"SON_OF_EDMURE","weight":2},{"directed":false,"source":"ELLARIA","target":"MAESTER_DORNE","weight":2},{"directed":false,"source":"FLYNN","target":"LEM","weight":2},{"directed":false,"source":"FLYNN","target":"MORGAN","weight":2},{"directed":false,"source":"FLYNN","target":"RAY","weight":2},{"directed":false,"source":"GLOVER","target":"ROBB","weight":2},{"directed":false,"source":"GLOVER","target":"ROBETT","weight":2},{"directed":false,"source":"GREY_WORM","target":"THEON","weight":9},{"directed":false,"source":"GREY_WORM","target":"YARA","weight":7},{"directed":false,"source":"HARALD","target":"LYANNA_MORMONT","weight":2},{"directed":false,"source":"HODOR","target":"OLD_NAN","weight":2},{"directed":false,"source":"IZEMBARO","target":"ROBERT","weight":2},{"directed":false,"source":"IZEMBARO","target":"SANSA","weight":2},{"directed":false,"source":"IZEMBARO","target":"TYRION","weight":2},{"directed":false,"source":"JORAH","target":"KHAL_MORO","weight":2},{"directed":false,"source":"LADY_CRANE","target":"MARGAERY","weight":2},{"directed":false,"source":"LADY_CRANE","target":"ROBERT","weight":2},{"directed":false,"source":"LADY_CRANE","target":"TYWIN","weight":2},{"directed":false,"source":"LADY_CRANE","target":"WAIF","weight":2},{"directed":false,"source":"LANCEL","target":"MACE","weight":2},{"directed":false,"source":"LANCEL","target":"QYBURN","weight":2},{"directed":false,"source":"LANCEL","target":"SEPTA_UNELLA","weight":2},{"directed":false,"source":"LEM","target":"MORGAN","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"RANDYLL","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"SMALLJON","weight":2},{"directed":false,"source":"LITTLEFINGER","target":"WUN_WUN","weight":2},{"directed":false,"source":"LYANNA_MORMONT","target":"MANDERLY","weight":2},{"directed":false,"source":"LYANNA_MORMONT","target":"SMALLJON","weight":2},{"directed":false,"source":"MAESTER_DORNE","target":"TYENE","weight":2},{"directed":false,"source":"MEERA","target":"OLD_NAN","weight":2},{"directed":false,"source":"MELISANDRE","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"MELISANDRE","target":"PODRICK","weight":2},{"directed":false,"source":"MELISANDRE","target":"RAMSAY","weight":2},{"directed":false,"source":"MISSANDEI","target":"THEON","weight":12},{"directed":false,"source":"MISSANDEI","target":"YARA","weight":4},{"directed":false,"source":"MORGAN","target":"RAY","weight":2},{"directed":false,"source":"NED","target":"ROBETT","weight":2},{"directed":false,"source":"OLD_NAN","target":"THREE_EYED_RAVEN","weight":2},{"directed":false,"source":"OLLY","target":"OTHELL_YARWYCK","weight":2},{"directed":false,"source":"OSHA","target":"SMALLJON","weight":2},{"directed":false,"source":"OTHELL_YARWYCK","target":"TORMUND","weight":2},{"directed":false,"source":"QYBURN","target":"VARYS","weight":2},{"directed":false,"source":"RICKON","target":"WUN_WUN","weight":2},{"directed":false,"source":"VARYS","target":"YARA","weight":4},{"directed":false,"source":"VARYS","target":"YEZZAN","weight":2},{"directed":false,"source":"DAENERYS","target":"JON","weight":372},{"directed":false,"source":"MARWYN","target":"SAM","weight":78},{"directed":false,"source":"JON","target":"JORAH","weight":70},{"directed":false,"source":"HOUND","target":"TORMUND","weight":79},{"directed":false,"source":"DAVOS","target":"TYRION","weight":118},{"directed":false,"source":"BERIC","target":"JON","weight":49},{"directed":false,"source":"CERSEI","target":"EURON","weight":78},{"directed":false,"source":"CERSEI","target":"TYCHO","weight":37},{"directed":false,"source":"JON","target":"MISSANDEI","weight":47},{"directed":false,"source":"CERSEI","target":"DAENERYS","weight":69},{"directed":false,"source":"DAENERYS","target":"DAVOS","weight":50},{"directed":false,"source":"JAIME","target":"RANDYLL","weight":33},{"directed":false,"source":"DAVOS","target":"MISSANDEI","weight":35},{"directed":false,"source":"GENDRY","target":"JON","weight":37},{"directed":false,"source":"BERIC","target":"TORMUND","weight":51},{"directed":false,"source":"HOUND","target":"JON","weight":31},{"directed":false,"source":"JORAH","target":"SAM","weight":53},{"directed":false,"source":"EURON","target":"JAIME","weight":43},{"directed":false,"source":"HOUND","target":"JORAH","weight":35},{"directed":false,"source":"ELLARIA","target":"YARA","weight":25},{"directed":false,"source":"DICKON","target":"JAIME","weight":24},{"directed":false,"source":"HARRAG","target":"THEON","weight":24},{"directed":false,"source":"JORAH","target":"TORMUND","weight":42},{"directed":false,"source":"JAIME","target":"MOUNTAIN","weight":23},{"directed":false,"source":"MELISANDRE","target":"VARYS","weight":21},{"directed":false,"source":"DAENERYS","target":"JAIME","weight":43},{"directed":false,"source":"BRAN","target":"LITTLEFINGER","weight":19},{"directed":false,"source":"JORAH","target":"THOROS","weight":19},{"directed":false,"source":"BERIC","target":"JORAH","weight":31},{"directed":false,"source":"JON","target":"VARYS","weight":67},{"directed":false,"source":"SANSA","target":"MAESTER_WOLKAN","weight":29},{"directed":false,"source":"DAENERYS","target":"OLENNA","weight":16},{"directed":false,"source":"JORAH","target":"MARWYN","weight":16},{"directed":false,"source":"CERSEI","target":"TYENE","weight":15},{"directed":false,"source":"GENDRY","target":"TORMUND","weight":34},{"directed":false,"source":"DAENERYS","target":"RANDYLL","weight":17},{"directed":false,"source":"DAVOS","target":"JORAH","weight":18},{"directed":false,"source":"DAENERYS","target":"MELISANDRE","weight":13},{"directed":false,"source":"GENDRY","target":"JORAH","weight":21},{"directed":false,"source":"DAVOS","target":"THEON","weight":15},{"directed":false,"source":"JON","target":"THOROS","weight":12},{"directed":false,"source":"BRONN","target":"DICKON","weight":11},{"directed":false,"source":"LITTLEFINGER","target":"MAESTER_WOLKAN","weight":11},{"directed":false,"source":"LYANNA_MORMONT","target":"ROBETT","weight":11},{"directed":false,"source":"THOROS","target":"TORMUND","weight":11},{"directed":false,"source":"DAENERYS","target":"DICKON","weight":12},{"directed":false,"source":"DAENERYS","target":"NIGHT_KING","weight":20},{"directed":false,"source":"DAVOS","target":"VARYS","weight":24},{"directed":false,"source":"EURON","target":"MOUNTAIN","weight":15},{"directed":false,"source":"BERIC","target":"NIGHT_KING","weight":10},{"directed":false,"source":"BRONN","target":"DAENERYS","weight":10},{"directed":false,"source":"BRONN","target":"RANDYLL","weight":8},{"directed":false,"source":"ELLARIA","target":"THEON","weight":8},{"directed":false,"source":"EURON","target":"TYRION","weight":12},{"directed":false,"source":"ROBETT","target":"YOHN_ROYCE","weight":8},{"directed":false,"source":"BRAN","target":"MAESTER_WOLKAN","weight":11},{"directed":false,"source":"DAENERYS","target":"EURON","weight":17},{"directed":false,"source":"JORAH","target":"THEON","weight":10},{"directed":false,"source":"LYANNA","target":"RHAEGAR","weight":11},{"directed":false,"source":"RANDYLL","target":"TYRION","weight":7},{"directed":false,"source":"ARYA","target":"YOHN_ROYCE","weight":10},{"directed":false,"source":"CERSEI","target":"RANDYLL","weight":6},{"directed":false,"source":"DAENERYS","target":"HOUND","weight":13},{"directed":false,"source":"ELLARIA","target":"QYBURN","weight":6},{"directed":false,"source":"EURON","target":"TYENE","weight":6},{"directed":false,"source":"LITTLEFINGER","target":"ROBETT","weight":6},{"directed":false,"source":"LYANNA_MORMONT","target":"YOHN_ROYCE","weight":10},{"directed":false,"source":"NIGHT_KING","target":"TORMUND","weight":6},{"directed":false,"source":"TYENE","target":"YARA","weight":6},{"directed":false,"source":"AERYS","target":"JON","weight":7},{"directed":false,"source":"ALYS","target":"NED_UMBER","weight":5},{"directed":false,"source":"ARYA","target":"MAESTER_WOLKAN","weight":9},{"directed":false,"source":"DAENERYS","target":"TORMUND","weight":21},{"directed":false,"source":"DAVOS","target":"HOUND","weight":8},{"directed":false,"source":"ELLARIA","target":"EURON","weight":5},{"directed":false,"source":"EURON","target":"JON","weight":5},{"directed":false,"source":"HOUND","target":"NIGHT_KING","weight":5},{"directed":false,"source":"JON","target":"MAESTER_WOLKAN","weight":11},{"directed":false,"source":"JON","target":"MOUNTAIN","weight":5},{"directed":false,"source":"JON","target":"YOHN_ROYCE","weight":9},{"directed":false,"source":"QYBURN","target":"TYENE","weight":5},{"directed":false,"source":"ARYA","target":"ROBETT","weight":4},{"directed":false,"source":"BERIC","target":"DAENERYS","weight":8},{"directed":false,"source":"BRAN","target":"EDDISON_TOLLETT","weight":4},{"directed":false,"source":"BRAN","target":"RHAEGAR","weight":4},{"directed":false,"source":"BRIENNE","target":"LYANNA_MORMONT","weight":11},{"directed":false,"source":"BRIENNE","target":"ROBETT","weight":4},{"directed":false,"source":"BRIENNE","target":"YOHN_ROYCE","weight":10},{"directed":false,"source":"CERSEI","target":"THEON","weight":4},{"directed":false,"source":"DAVOS","target":"PODRICK","weight":13},{"directed":false,"source":"DICKON","target":"TYRION","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"MEERA","weight":4},{"directed":false,"source":"EURON","target":"NYMERIA","weight":4},{"directed":false,"source":"EURON","target":"OBARA","weight":4},{"directed":false,"source":"EURON","target":"QYBURN","weight":10},{"directed":false,"source":"GENDRY","target":"TYRION","weight":10},{"directed":false,"source":"HOUND","target":"THEON","weight":4},{"directed":false,"source":"JEOR","target":"JORAH","weight":4},{"directed":false,"source":"JON","target":"LYANNA","weight":13},{"directed":false,"source":"JON","target":"NED_UMBER","weight":4},{"directed":false,"source":"JON","target":"QYBURN","weight":4},{"directed":false,"source":"JORAH","target":"NIGHT_KING","weight":4},{"directed":false,"source":"LITTLEFINGER","target":"LYANNA_MORMONT","weight":4},{"directed":false,"source":"MAESTER_WOLKAN","target":"YOHN_ROYCE","weight":8},{"directed":false,"source":"MELISANDRE","target":"TYRION","weight":4},{"directed":false,"source":"MOUNTAIN","target":"TYENE","weight":4},{"directed":false,"source":"NYMERIA","target":"YARA","weight":4},{"directed":false,"source":"OBARA","target":"YARA","weight":4},{"directed":false,"source":"OLENNA","target":"RANDYLL","weight":4},{"directed":false,"source":"QYBURN","target":"TYRION","weight":23},{"directed":false,"source":"AEGON","target":"DAENERYS","weight":5},{"directed":false,"source":"AERYS","target":"VARYS","weight":3},{"directed":false,"source":"ALYS","target":"JON","weight":8},{"directed":false,"source":"ARYA","target":"LYANNA_MORMONT","weight":7},{"directed":false,"source":"BALERION","target":"QYBURN","weight":3},{"directed":false,"source":"BERIC","target":"DAVOS","weight":7},{"directed":false,"source":"BRAN","target":"DAENERYS","weight":19},{"directed":false,"source":"BRAN","target":"YOHN_ROYCE","weight":9},{"directed":false,"source":"BRIENNE","target":"MOUNTAIN","weight":3},{"directed":false,"source":"BRIENNE","target":"QYBURN","weight":3},{"directed":false,"source":"BRONN","target":"DAVOS","weight":13},{"directed":false,"source":"BRONN","target":"JON","weight":3},{"directed":false,"source":"DAENERYS","target":"ELLARIA","weight":3},{"directed":false,"source":"DAVOS","target":"EURON","weight":3},{"directed":false,"source":"DAVOS","target":"JAIME","weight":13},{"directed":false,"source":"DAVOS","target":"NIGHT_KING","weight":3},{"directed":false,"source":"HARRAG","target":"YARA","weight":3},{"directed":false,"source":"HOUND","target":"QYBURN","weight":7},{"directed":false,"source":"LITTLEFINGER","target":"MEERA","weight":3},{"directed":false,"source":"MOUNTAIN","target":"THEON","weight":3},{"directed":false,"source":"THEON","target":"TYENE","weight":3},{"directed":false,"source":"AERYS","target":"OLENNA","weight":2},{"directed":false,"source":"BALERION","target":"CERSEI","weight":2},{"directed":false,"source":"BRAN","target":"BRIENNE","weight":13},{"directed":false,"source":"BRAN","target":"PODRICK","weight":5},{"directed":false,"source":"BRIENNE","target":"EURON","weight":2},{"directed":false,"source":"BRIENNE","target":"JORAH","weight":15},{"directed":false,"source":"BRIENNE","target":"QHONO","weight":6},{"directed":false,"source":"BRIENNE","target":"VARYS","weight":11},{"directed":false,"source":"BRONN","target":"GREY_WORM","weight":2},{"directed":false,"source":"BRONN","target":"JORAH","weight":2},{"directed":false,"source":"BRONN","target":"THEON","weight":2},{"directed":false,"source":"CERSEI","target":"NIGHT_KING","weight":2},{"directed":false,"source":"CERSEI","target":"YARA","weight":2},{"directed":false,"source":"DAENERYS","target":"GENDRY","weight":23},{"directed":false,"source":"DAENERYS","target":"LITTLEFINGER","weight":2},{"directed":false,"source":"DAENERYS","target":"MOUNTAIN","weight":6},{"directed":false,"source":"DAENERYS","target":"QYBURN","weight":6},{"directed":false,"source":"DAENERYS","target":"TYWIN","weight":4},{"directed":false,"source":"DAVOS","target":"GREY_WORM","weight":29},{"directed":false,"source":"DAVOS","target":"MOUNTAIN","weight":2},{"directed":false,"source":"DAVOS","target":"QYBURN","weight":2},{"directed":false,"source":"DAVOS","target":"YOHN_ROYCE","weight":8},{"directed":false,"source":"DICKON","target":"OLENNA","weight":2},{"directed":false,"source":"DROGO","target":"JON","weight":2},{"directed":false,"source":"ELLARIA","target":"GREY_WORM","weight":2},{"directed":false,"source":"ELLARIA","target":"MISSANDEI","weight":2},{"directed":false,"source":"EURON","target":"HOUND","weight":2},{"directed":false,"source":"GREY_WORM","target":"JAIME","weight":21},{"directed":false,"source":"GREY_WORM","target":"JON","weight":52},{"directed":false,"source":"GREY_WORM","target":"MELISANDRE","weight":7},{"directed":false,"source":"GREY_WORM","target":"OLENNA","weight":2},{"directed":false,"source":"HIGH_SEPTON","target":"SAM","weight":2},{"directed":false,"source":"HOT_PIE","target":"JON","weight":2},{"directed":false,"source":"HOUND","target":"MISSANDEI","weight":2},{"directed":false,"source":"HOUND","target":"QHONO","weight":2},{"directed":false,"source":"HOUND","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"HOWLAND","target":"MEERA","weight":2},{"directed":false,"source":"JON","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"JON_ARRYN","target":"SANSA","weight":2},{"directed":false,"source":"JORAH","target":"PODRICK","weight":6},{"directed":false,"source":"JORAH","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"LYANNA_MORMONT","target":"PODRICK","weight":2},{"directed":false,"source":"MARWYN","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"MARWYN","target":"ROBERT","weight":2},{"directed":false,"source":"MARWYN","target":"SHIREEN","weight":2},{"directed":false,"source":"MELISANDRE","target":"MISSANDEI","weight":2},{"directed":false,"source":"MISSANDEI","target":"OLENNA","weight":2},{"directed":false,"source":"MOUNTAIN","target":"MYRCELLA","weight":2},{"directed":false,"source":"MOUNTAIN","target":"RANDYLL","weight":2},{"directed":false,"source":"NIGHT_KING","target":"TYRION","weight":2},{"directed":false,"source":"NYMERIA","target":"THEON","weight":2},{"directed":false,"source":"OBARA","target":"THEON","weight":2},{"directed":false,"source":"OLENNA","target":"THEON","weight":2},{"directed":false,"source":"OLENNA","target":"YARA","weight":2},{"directed":false,"source":"PODRICK","target":"QHONO","weight":2},{"directed":false,"source":"PODRICK","target":"ROBETT","weight":2},{"directed":false,"source":"PODRICK","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"QHONO","target":"TYRION","weight":6},{"directed":false,"source":"QYBURN","target":"RANDYLL","weight":2},{"directed":false,"source":"QYBURN","target":"THEON","weight":2},{"directed":false,"source":"ROBERT","target":"SAM","weight":4},{"directed":false,"source":"ROBETT","target":"TORMUND","weight":2},{"directed":false,"source":"TORMUND","target":"WHITE_WALKER","weight":2},{"directed":false,"source":"TORMUND","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"JAIME","target":"TORMUND","weight":38},{"directed":false,"source":"DAENERYS","target":"SAM","weight":26},{"directed":false,"source":"SAM","target":"TYRION","weight":24},{"directed":false,"source":"BRIENNE","target":"GREY_WORM","weight":23},{"directed":false,"source":"BRIENNE","target":"SAM","weight":23},{"directed":false,"source":"GREY_WORM","target":"SAM","weight":23},{"directed":false,"source":"GREY_WORM","target":"TORMUND","weight":23},{"directed":false,"source":"ARYA","target":"DAVOS","weight":22},{"directed":false,"source":"ARYA","target":"NORA","weight":22},{"directed":false,"source":"NORA","target":"VICKY","weight":22},{"directed":false,"source":"ARYA","target":"DAENERYS","weight":21},{"directed":false,"source":"BRONN","target":"QYBURN","weight":20},{"directed":false,"source":"JAIME","target":"SAM","weight":19},{"directed":false,"source":"TORMUND","target":"TYRION","weight":19},{"directed":false,"source":"GREY_WORM","target":"SANSA","weight":18},{"directed":false,"source":"GENDRY","target":"SAM","weight":17},{"directed":false,"source":"JORAH","target":"LYANNA_MORMONT","weight":17},{"directed":false,"source":"GENDRY","target":"GREY_WORM","weight":16},{"directed":false,"source":"BERIC","target":"SAM","weight":15},{"directed":false,"source":"BRAN","target":"GREY_WORM","weight":15},{"directed":false,"source":"ARYA","target":"VICKY","weight":14},{"directed":false,"source":"JAIME","target":"JORAH","weight":14},{"directed":false,"source":"MISSANDEI","target":"SANSA","weight":14},{"directed":false,"source":"ARYA","target":"GREY_WORM","weight":13},{"directed":false,"source":"BRIENNE","target":"GENDRY","weight":13},{"directed":false,"source":"GENDRY","target":"JAIME","weight":13},{"directed":false,"source":"LYANNA_MORMONT","target":"SAM","weight":13},{"directed":false,"source":"BERIC","target":"GREY_WORM","weight":12},{"directed":false,"source":"CRAYAH","target":"DIRAH","weight":12},{"directed":false,"source":"SAM","target":"SANSA","weight":12},{"directed":false,"source":"BRIENNE","target":"DAENERYS","weight":11},{"directed":false,"source":"CERSEI","target":"HARRY","weight":11},{"directed":false,"source":"JORAH","target":"MELISANDRE","weight":11},{"directed":false,"source":"MARTHA","target":"VARYS","weight":11},{"directed":false,"source":"ARYA","target":"SAM","weight":10},{"directed":false,"source":"BERIC","target":"BRIENNE","weight":10},{"directed":false,"source":"DAENERYS","target":"MAESTER_WOLKAN","weight":10},{"directed":false,"source":"JAIME","target":"LYANNA_MORMONT","weight":10},{"directed":false,"source":"JORAH","target":"SANSA","weight":10},{"directed":false,"source":"BERIC","target":"EDDISON_TOLLETT","weight":9},{"directed":false,"source":"BERIC","target":"JAIME","weight":9},{"directed":false,"source":"BRAN","target":"DAVOS","weight":9},{"directed":false,"source":"CERSEI","target":"MISSANDEI","weight":9},{"directed":false,"source":"TYRION","target":"MAESTER_WOLKAN","weight":9},{"directed":false,"source":"TYRION","target":"YOHN_ROYCE","weight":9},{"directed":false,"source":"ALYS","target":"TYRION","weight":8},{"directed":false,"source":"BRAN","target":"VARYS","weight":8},{"directed":false,"source":"BRONN","target":"SAM","weight":8},{"directed":false,"source":"GENDRY","target":"PODRICK","weight":8},{"directed":false,"source":"GILLY","target":"SANSA","weight":8},{"directed":false,"source":"GILLY","target":"TYRION","weight":8},{"directed":false,"source":"GILLY","target":"VARYS","weight":8},{"directed":false,"source":"HOUND","target":"MELISANDRE","weight":8},{"directed":false,"source":"HOUND","target":"SAM","weight":8},{"directed":false,"source":"NIGHT_KING","target":"THEON","weight":8},{"directed":false,"source":"PODRICK","target":"SAM","weight":8},{"directed":false,"source":"ARYA","target":"TORMUND","weight":7},{"directed":false,"source":"BRONN","target":"CRAYAH","weight":7},{"directed":false,"source":"DAENERYS","target":"LYANNA_MORMONT","weight":7},{"directed":false,"source":"GREY_WORM","target":"LYANNA_MORMONT","weight":7},{"directed":false,"source":"GREY_WORM","target":"PODRICK","weight":7},{"directed":false,"source":"JON","target":"RHAEGAR","weight":7},{"directed":false,"source":"LYANNA_MORMONT","target":"TYRION","weight":7},{"directed":false,"source":"ALYS","target":"DAVOS","weight":6},{"directed":false,"source":"ALYS","target":"VARYS","weight":6},{"directed":false,"source":"BRAN","target":"JORAH","weight":6},{"directed":false,"source":"BRAN","target":"MISSANDEI","weight":6},{"directed":false,"source":"BRIENNE","target":"MAESTER_WOLKAN","weight":6},{"directed":false,"source":"BRIENNE","target":"MISSANDEI","weight":6},{"directed":false,"source":"DAENERYS","target":"YOHN_ROYCE","weight":6},{"directed":false,"source":"DAVOS","target":"GILLY","weight":6},{"directed":false,"source":"DAVOS","target":"MAESTER_WOLKAN","weight":6},{"directed":false,"source":"GREY_WORM","target":"HOUND","weight":6},{"directed":false,"source":"GREY_WORM","target":"QHONO","weight":6},{"directed":false,"source":"LITTLE_SAM","target":"SANSA","weight":6},{"directed":false,"source":"LITTLE_SAM","target":"TYRION","weight":6},{"directed":false,"source":"LITTLE_SAM","target":"VARYS","weight":6},{"directed":false,"source":"QHONO","target":"SAM","weight":6},{"directed":false,"source":"SAM","target":"VARYS","weight":6},{"directed":false,"source":"SAM","target":"YOHN_ROYCE","weight":6},{"directed":false,"source":"TORMUND","target":"VARYS","weight":6},{"directed":false,"source":"ALYS","target":"BRAN","weight":5},{"directed":false,"source":"ALYS","target":"DAENERYS","weight":5},{"directed":false,"source":"ALYS","target":"GREY_WORM","weight":5},{"directed":false,"source":"ALYS","target":"JORAH","weight":5},{"directed":false,"source":"ALYS","target":"LYANNA_MORMONT","weight":5},{"directed":false,"source":"ALYS","target":"SANSA","weight":5},{"directed":false,"source":"ARYA","target":"JORAH","weight":5},{"directed":false,"source":"ARYA","target":"MISSANDEI","weight":5},{"directed":false,"source":"BRAN","target":"LYANNA_MORMONT","weight":5},{"directed":false,"source":"BRONN","target":"DIRAH","weight":5},{"directed":false,"source":"BRONN","target":"MAREI","weight":5},{"directed":false,"source":"CERSEI","target":"GREY_WORM","weight":5},{"directed":false,"source":"EDMURE","target":"SANSA","weight":5},{"directed":false,"source":"GENDRY","target":"SANSA","weight":5},{"directed":false,"source":"GREY_WORM","target":"YOHN_ROYCE","weight":5},{"directed":false,"source":"LYANNA_MORMONT","target":"VARYS","weight":5},{"directed":false,"source":"MISSANDEI","target":"MOUNTAIN","weight":5},{"directed":false,"source":"SAM","target":"MAESTER_WOLKAN","weight":5},{"directed":false,"source":"TORMUND","target":"WILLA","weight":5},{"directed":false,"source":"VARYS","target":"MAESTER_WOLKAN","weight":5},{"directed":false,"source":"ALYS","target":"BRIENNE","weight":4},{"directed":false,"source":"ALYS","target":"JAIME","weight":4},{"directed":false,"source":"ALYS","target":"SAM","weight":4},{"directed":false,"source":"ALYS","target":"THEON","weight":4},{"directed":false,"source":"ALYS","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"ARYA","target":"OWEN","weight":4},{"directed":false,"source":"ARYA","target":"QHONO","weight":4},{"directed":false,"source":"ARYA","target":"THEON","weight":4},{"directed":false,"source":"BERIC","target":"LYANNA_MORMONT","weight":4},{"directed":false,"source":"BERIC","target":"SANSA","weight":4},{"directed":false,"source":"BRAN","target":"GENDRY","weight":4},{"directed":false,"source":"BRAN","target":"QHONO","weight":4},{"directed":false,"source":"DAENERYS","target":"PODRICK","weight":4},{"directed":false,"source":"DAENERYS","target":"QHONO","weight":4},{"directed":false,"source":"DAVOS","target":"QHONO","weight":4},{"directed":false,"source":"DAVOS","target":"TEELA","weight":4},{"directed":false,"source":"DORNISH_PRINCE","target":"YARA","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"GREY_WORM","weight":4},{"directed":false,"source":"EDDISON_TOLLETT","target":"JORAH","weight":4},{"directed":false,"source":"EDMURE","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"EURON","target":"HARRY","weight":4},{"directed":false,"source":"EURON","target":"MISSANDEI","weight":4},{"directed":false,"source":"GILLY","target":"MISSANDEI","weight":4},{"directed":false,"source":"GREY_WORM","target":"MAESTER_WOLKAN","weight":4},{"directed":false,"source":"HOUND","target":"NORA","weight":4},{"directed":false,"source":"JAIME","target":"QHONO","weight":4},{"directed":false,"source":"JAIME","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"JON","target":"QHONO","weight":4},{"directed":false,"source":"JORAH","target":"QHONO","weight":4},{"directed":false,"source":"JORAH","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"LYANNA_MORMONT","target":"QHONO","weight":4},{"directed":false,"source":"LYANNA_MORMONT","target":"THEON","weight":4},{"directed":false,"source":"MISSANDEI","target":"SAM","weight":4},{"directed":false,"source":"QHONO","target":"SANSA","weight":4},{"directed":false,"source":"QHONO","target":"TORMUND","weight":4},{"directed":false,"source":"QHONO","target":"VARYS","weight":4},{"directed":false,"source":"ROBIN","target":"MAESTER_WOLKAN","weight":4},{"directed":false,"source":"SAM","target":"THEON","weight":4},{"directed":false,"source":"SANSA","target":"YARA","weight":4},{"directed":false,"source":"VARYS","target":"YOHN_ROYCE","weight":4},{"directed":false,"source":"ALYS","target":"ARYA","weight":3},{"directed":false,"source":"ALYS","target":"MAESTER_WOLKAN","weight":3},{"directed":false,"source":"ALYS","target":"TORMUND","weight":3},{"directed":false,"source":"ARYA","target":"NIGHT_KING","weight":3},{"directed":false,"source":"ARYA","target":"YARA","weight":3},{"directed":false,"source":"BERIC","target":"BRAN","weight":3},{"directed":false,"source":"BERIC","target":"NED_UMBER","weight":3},{"directed":false,"source":"BERIC","target":"THEON","weight":3},{"directed":false,"source":"BERIC","target":"TYRION","weight":3},{"directed":false,"source":"BERIC","target":"VARYS","weight":3},{"directed":false,"source":"BRAN","target":"BRONN","weight":3},{"directed":false,"source":"CRAYAH","target":"MAREI","weight":3},{"directed":false,"source":"CRAYAH","target":"QYBURN","weight":3},{"directed":false,"source":"DIRAH","target":"MAREI","weight":3},{"directed":false,"source":"DORNISH_PRINCE","target":"ROBIN","weight":3},{"directed":false,"source":"EDDISON_TOLLETT","target":"GENDRY","weight":3},{"directed":false,"source":"EDDISON_TOLLETT","target":"HOUND","weight":3},{"directed":false,"source":"EDDISON_TOLLETT","target":"JAIME","weight":3},{"directed":false,"source":"EDMURE","target":"MAESTER_WOLKAN","weight":3},{"directed":false,"source":"EDMURE","target":"RIVERLANDS_LORD","weight":3},{"directed":false,"source":"EDMURE","target":"ROBIN","weight":3},{"directed":false,"source":"EDMURE","target":"SAM","weight":3},{"directed":false,"source":"EDMURE","target":"TYRION","weight":3},{"directed":false,"source":"GENDRY","target":"VALE_LORD","weight":3},{"directed":false,"source":"GENDRY","target":"YOHN_ROYCE","weight":3},{"directed":false,"source":"GREY_WORM","target":"MOUNTAIN","weight":3},{"directed":false,"source":"GREY_WORM","target":"UNSULLIED_CAPTAIN","weight":3},{"directed":false,"source":"HOUND","target":"SARRA","weight":3},{"directed":false,"source":"HOUND","target":"VICKY","weight":3},{"directed":false,"source":"IRONBORN_LORD","target":"VALE_LORD","weight":3},{"directed":false,"source":"IRONBORN_LORD","target":"YARA","weight":3},{"directed":false,"source":"JAIME","target":"MISSANDEI","weight":3},{"directed":false,"source":"LYANNA","target":"VARYS","weight":3},{"directed":false,"source":"LYANNA_MORMONT","target":"MISSANDEI","weight":3},{"directed":false,"source":"MISSANDEI","target":"QYBURN","weight":3},{"directed":false,"source":"NED","target":"RHAEGAR","weight":3},{"directed":false,"source":"NED_UMBER","target":"SANSA","weight":3},{"directed":false,"source":"RHAEGAR","target":"VARYS","weight":3},{"directed":false,"source":"RIVERLANDS_LORD","target":"YOHN_ROYCE","weight":3},{"directed":false,"source":"ROBIN","target":"SAM","weight":3},{"directed":false,"source":"THEON","target":"TORMUND","weight":3},{"directed":false,"source":"ALANNA","target":"OWEN","weight":2},{"directed":false,"source":"ALYS","target":"BERIC","weight":2},{"directed":false,"source":"ALYS","target":"GENDRY","weight":2},{"directed":false,"source":"ALYS","target":"MISSANDEI","weight":2},{"directed":false,"source":"ALYS","target":"QHONO","weight":2},{"directed":false,"source":"ARYA","target":"DORNISH_PRINCE","weight":2},{"directed":false,"source":"ARYA","target":"EDDISON_TOLLETT","weight":2},{"directed":false,"source":"ARYA","target":"EDMURE","weight":2},{"directed":false,"source":"ARYA","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"ARYA","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"ARYA","target":"ROBIN","weight":2},{"directed":false,"source":"ARYA","target":"VALE_LORD","weight":2},{"directed":false,"source":"BERIC","target":"GILLY","weight":2},{"directed":false,"source":"BERIC","target":"PODRICK","weight":2},{"directed":false,"source":"BERIC","target":"QHONO","weight":2},{"directed":false,"source":"BERIC","target":"TEELA","weight":2},{"directed":false,"source":"BERIC","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"BRAN","target":"DORNISH_PRINCE","weight":2},{"directed":false,"source":"BRAN","target":"EDMURE","weight":2},{"directed":false,"source":"BRAN","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"BRAN","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"BRAN","target":"ROBIN","weight":2},{"directed":false,"source":"BRAN","target":"VALE_LORD","weight":2},{"directed":false,"source":"BRAN","target":"YARA","weight":2},{"directed":false,"source":"BRIENNE","target":"DORNISH_PRINCE","weight":2},{"directed":false,"source":"BRIENNE","target":"EDMURE","weight":2},{"directed":false,"source":"BRIENNE","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"BRIENNE","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"BRIENNE","target":"ROBIN","weight":2},{"directed":false,"source":"BRIENNE","target":"VALE_LORD","weight":2},{"directed":false,"source":"BRIENNE","target":"YARA","weight":2},{"directed":false,"source":"CERSEI","target":"CERSEIS_BABY","weight":2},{"directed":false,"source":"CERSEIS_BABY","target":"JAIME","weight":2},{"directed":false,"source":"CERSEIS_BABY","target":"TYRION","weight":2},{"directed":false,"source":"CRAYAH","target":"WILLIAM","weight":2},{"directed":false,"source":"DAENERYS","target":"EDDISON_TOLLETT","weight":2},{"directed":false,"source":"DAENERYS","target":"LYANNA","weight":2},{"directed":false,"source":"DAENERYS","target":"NED_UMBER","weight":2},{"directed":false,"source":"DAVOS","target":"DORNISH_PRINCE","weight":2},{"directed":false,"source":"DAVOS","target":"EDMURE","weight":2},{"directed":false,"source":"DAVOS","target":"HARRY","weight":2},{"directed":false,"source":"DAVOS","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"DAVOS","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"DAVOS","target":"ROBIN","weight":2},{"directed":false,"source":"DAVOS","target":"VALE_LORD","weight":2},{"directed":false,"source":"DAVOS","target":"YARA","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"EDMURE","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"GENDRY","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"GREY_WORM","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"SAM","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"SANSA","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"TYRION","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"VALE_LORD","weight":2},{"directed":false,"source":"DORNISH_PRINCE","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"LYANNA_MORMONT","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"NED_UMBER","weight":2},{"directed":false,"source":"EDDISON_TOLLETT","target":"TEELA","weight":2},{"directed":false,"source":"EDMURE","target":"GENDRY","weight":2},{"directed":false,"source":"EDMURE","target":"GREY_WORM","weight":2},{"directed":false,"source":"EDMURE","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"EDMURE","target":"VALE_LORD","weight":2},{"directed":false,"source":"EDMURE","target":"YARA","weight":2},{"directed":false,"source":"EURON","target":"GREY_WORM","weight":2},{"directed":false,"source":"EURON","target":"VARYS","weight":2},{"directed":false,"source":"GENDRY","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"GENDRY","target":"LYANNA_MORMONT","weight":2},{"directed":false,"source":"GENDRY","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"GENDRY","target":"QHONO","weight":2},{"directed":false,"source":"GENDRY","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"GENDRY","target":"ROBIN","weight":2},{"directed":false,"source":"GENDRY","target":"YARA","weight":2},{"directed":false,"source":"GILLY","target":"PODRICK","weight":2},{"directed":false,"source":"GILLY","target":"TEELA","weight":2},{"directed":false,"source":"GREY_WORM","target":"HARRY","weight":2},{"directed":false,"source":"GREY_WORM","target":"IRONBORN_LORD","weight":2},{"directed":false,"source":"GREY_WORM","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"GREY_WORM","target":"ROBIN","weight":2},{"directed":false,"source":"GREY_WORM","target":"VALE_LORD","weight":2},{"directed":false,"source":"HARRY","target":"JON","weight":2},{"directed":false,"source":"HOUND","target":"WILLA","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"RIVERLANDS_LORD","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"ROBIN","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"SAM","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"SANSA","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"TYRION","weight":2},{"directed":false,"source":"IRONBORN_LORD","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"JAIME","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"JON","target":"TEELA","weight":2},{"directed":false,"source":"JON","target":"UNSULLIED_CAPTAIN","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"MISSANDEI","weight":2},{"directed":false,"source":"LITTLE_SAM","target":"PODRICK","weight":2},{"directed":false,"source":"LYANNA","target":"SAM","weight":2},{"directed":false,"source":"MAESTER_WOLKAN","target":"YARA","weight":2},{"directed":false,"source":"MELISANDRE","target":"QHONO","weight":2},{"directed":false,"source":"MISSANDEI","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"MISSANDEI","target":"PODRICK","weight":2},{"directed":false,"source":"MISSANDEI","target":"QHONO","weight":2},{"directed":false,"source":"MISSANDEI","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"MOUNTAIN","target":"VARYS","weight":2},{"directed":false,"source":"NED_UMBER","target":"TORMUND","weight":2},{"directed":false,"source":"QHONO","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"QHONO","target":"THEON","weight":2},{"directed":false,"source":"QHONO","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"RHAEGAR","target":"SAM","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"ROBIN","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"SAM","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"SANSA","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"TYRION","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"VALE_LORD","weight":2},{"directed":false,"source":"RIVERLANDS_LORD","target":"YARA","weight":2},{"directed":false,"source":"ROBIN","target":"VALE_LORD","weight":2},{"directed":false,"source":"ROBIN","target":"YARA","weight":2},{"directed":false,"source":"SAM","target":"TEELA","weight":2},{"directed":false,"source":"SAM","target":"VALE_LORD","weight":2},{"directed":false,"source":"SAM","target":"YARA","weight":2},{"directed":false,"source":"SANSA","target":"SARRA","weight":2},{"directed":false,"source":"SANSA","target":"VALE_LORD","weight":2},{"directed":false,"source":"SANSA","target":"WILLA","weight":2},{"directed":false,"source":"SARRA","target":"TORMUND","weight":2},{"directed":false,"source":"SARRA","target":"WILLA","weight":2},{"directed":false,"source":"TEELA","target":"TORMUND","weight":2},{"directed":false,"source":"THEON","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"THEON","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"TYRION","target":"VALE_LORD","weight":2},{"directed":false,"source":"VALE_LORD","target":"MAESTER_WOLKAN","weight":2},{"directed":false,"source":"VALE_LORD","target":"YARA","weight":2},{"directed":false,"source":"VALE_LORD","target":"YOHN_ROYCE","weight":2},{"directed":false,"source":"YARA","target":"YOHN_ROYCE","weight":2}]}'),YW=JSON.parse('{"NGX-MSAGL":"Ngx-MSAGL"}');let UW=(()=>{class r{get(t){return YW[t]}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),WW=(()=>{class r{constructor(t){this.localizationService=t,this.title=this.localizationService.get("NGX-MSAGL")}}return r.\u0275fac=function(t){return new(t||r)(De(UW))},r.\u0275cmp=ks({type:r,selectors:[["app-bar"]],decls:3,vars:1,consts:[[1,"title"]],template:function(t,n){1&t&&(Ot(0,"mat-toolbar")(1,"span",0),mp(2),Mt()()),2&t&&(pt(2),Ep(n.title))},directives:[Z2],styles:["[_nghost-%COMP%]   mat-toolbar[_ngcontent-%COMP%]{background-color:#1f233e}[_nghost-%COMP%]   mat-toolbar[_ngcontent-%COMP%]   .menu-icon[_ngcontent-%COMP%]{background-color:#1f233e;color:#fff;margin-top:4px;font-size:24px}[_nghost-%COMP%]   mat-toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#fff;margin-left:8px;font-size:24px}"]}),r})();var eo=h(5114);class lT{constructor(){this.attrs=[],this._parent=null}clearAttr(){this.attrs=[]}setAttr(e,t){this.attrs[e]=t}getAttr(e){return this.attrs[e]}get parent(){return this._parent}set parent(e){this._parent=e}*getAncestors(){let e=this.parent;for(;null!=e;)yield e,e=e.parent}isDescendantOf(e){for(const t of this.getAncestors())if(t==e)return!0;return!1}}var to=(()=>{return(r=to||(to={}))[r.None=0]="None",r[r.FromAncestor=1]="FromAncestor",r[r.ToAncestor=2]="ToAncestor",to;var r})();class cT extends lT{constructor(e,t){super(),this.source=e,this.target=t,e!=t?(e.outEdges.add(this),t.inEdges.add(this)):e.selfEdges.add(this)}add(){this.source!=this.target?(this.source.outEdges.add(this),this.target.inEdges.add(this)):this.source.selfEdges.add(this)}remove(){this.source!=this.target?(this.source.outEdges.delete(this),this.target.inEdges.delete(this)):this.source.selfEdges.delete(this)}toString(){return"("+this.source.toString()+"->"+this.target.toString()+")"}isInterGraphEdge(){return this.source.parent!=this.target.parent}EdgeToAncestor(){return this.source instanceof Tr&&this.target.isDescendantOf(this.source)?to.FromAncestor:this.target instanceof Tr&&this.source.isDescendantOf(this.target)?to.ToAncestor:to.None}}class xd{static assert(e,t=null){if(!e)throw null!=t?(console.log(t),new Error(t)):new Error("condition does not hold")}}class uT extends lT{constructor(e){super(),this.inEdges=new Set,this.outEdges=new Set,this.selfEdges=new Set,this.id=e}get id(){return this._id}set id(e){this._id=e}toString(){return this.id}*_edges(){for(const e of this.inEdges)yield e;for(const e of this.outEdges)yield e;for(const e of this.selfEdges)yield e}addInEdge(e){xd.assert(null!=e),xd.assert(e.target==this),this.inEdges.add(e)}addOutEdge(e){this.outEdges.add(e)}addSelfEdge(e){this.selfEdges.add(e)}addEdde(e){if(this==e.source)e.target==this?this.addSelfEdge(e):this.addOutEdge(e);else{if(this!=e.target)throw new Error("attaching an edge to non adjacent node");this.addInEdge(e)}return e}get edges(){return this._edges()}get outDegree(){return this.outEdges.size}get inDegree(){return this.inEdges.size}get selfDegree(){return this.selfEdges.size}get degree(){return this.outDegree+this.inDegree+this.selfDegree}*getAncestors(){let e=this.parent;for(;null!=e;)yield e,e=e.parent}isUnderCollapsedGraph(){return null!=this.parent&&this.parent.isCollapsed}}class jW{constructor(){this.nodeMap=new Map}*nodes_(){for(const e of this.nodeMap.values())yield e}*graphs_(){for(const e of this.nodes_())e instanceof Tr&&(yield e)}find(e){return this.nodeMap.get(e)}get nodesShallow(){return this.nodes_()}*nodesDeep(){for(const e of this.nodes_())if(yield e,e instanceof Tr)for(const t of e.nodeCollection.nodesDeep())yield t}get graphs(){return this.graphs_()}*_edges(){for(const e of this.nodeMap.values()){for(const t of e.outEdges)yield t;for(const t of e.selfEdges)yield t}}interGraphEdges(){throw new Error("not implemented")}hasNode(e){if(this.nodeMap.has(e))return!0;for(const t of this.nodeMap)if(t[1]instanceof Tr&&t[1].nodeCollection.hasNode(e))return!0;return!1}getNode(e){let t=this.nodeMap.get(e);if(null!=t)return t;for(const n of this.nodeMap)if(n[1]instanceof Tr&&(t=n[1].nodeCollection.getNode(e),null!=t))return t}get nodeShallowCount(){return this.nodeMap.size}get nodeDeepCount(){let e=this.nodeMap.size;for(const t of this.nodeMap.values())t instanceof Tr&&(e+=t.nodeCollection.nodeDeepCount);return e}get edgeCount(){let e=0;for(const t of this.nodeMap.values())e+=t.outDegree+t.selfDegree;return e}get edges(){return this._edges()}addNode(e){null==this.getNode(e.id)&&this.nodeMap.set(e.id,e)}addEdge(e){this.addNode(e.source),this.addNode(e.target),e.source!=e.target?(e.source.outEdges.add(e),e.target.inEdges.add(e)):e.source.selfEdges.add(e)}removeNode(e){for(const t of e.outEdges)t.target.inEdges.delete(t);for(const t of e.inEdges)t.source.outEdges.delete(t);this.nodeMap.delete(e.id);for(const t of this.nodeMap.values())t instanceof Tr&&t.nodeCollection.nodeMap.delete(e.id)}nodeIsConsistent(e){for(const t of e.outEdges)if(t.source!=e||t.source==t.target||!this.nodeMap.has(t.target.id))return!1;for(const t of e.inEdges)return!(t.target!=e||t.source==t.target||!this.nodeMap.has(t.source.id));for(const t of e.selfEdges)if(t.target!=t.source||t.source==e)return!1;return!0}isConsistent(){for(const e of this.nodeMap)if(!this.nodeIsConsistent(e[1]))return!1;return!0}}class Tr extends uT{constructor(e="__graph__"){super(e),this.isCollapsed=!1,this.nodeCollection=new jW}*graphs(){for(const e of this.nodeCollection.graphs)yield e}noEmptySubgraphs(){for(const e of this.subgraphs())if(0==e.shallowNodeCount)return!1;return!0}hasSubgraphs(){for(const e of this.shallowNodes)if(e instanceof Tr)return!0;return!1}*subgraphs(){for(const e of this.deepNodes)e instanceof Tr&&(yield e)}isEmpty(){return 0==this.shallowNodeCount}setEdge(e,t){const n=this.nodeCollection.find(e);if(null==n)return;const i=this.nodeCollection.find(t);if(null==i)return;const s=new cT(n,i);return this.addEdge(s),s}get shallowNodes(){return this.nodeCollection.nodesShallow}get deepNodes(){return this.nodeCollection.nodesDeep()}findNode(e){return this.nodeCollection.find(e)}get edges(){return this.nodeCollection.edges}*deepEdges(){for(const e of this.deepNodes){for(const t of e.outEdges)yield t;for(const t of e.selfEdges)yield t}}isConsistent(){return this.nodeCollection.isConsistent()}nodeIsConsistent(e){return this.nodeCollection.nodeIsConsistent(e)}removeNode(e){this.nodeCollection.removeNode(e)}addNode(e){return e.parent=this,this.nodeCollection.addNode(e),e}addEdge(e){this.nodeCollection.addEdge(e)}get shallowNodeCount(){return this.nodeCollection.nodeShallowCount}get nodeCountDeep(){return this.nodeCollection.nodeDeepCount}get edgeCount(){return this.nodeCollection.edgeCount}liftNode(e){for(;null!=e&&e.parent!=this;)e=e.parent;return e}}let eu=(()=>{class r{static solve(t,n,i,s,o,a){const l=t*o-s*n;if(!(Math.abs(l)<r.eps))return{x:(i*o-a*n)/l,y:(t*a-s*i)/l}}}return r.eps=1e-8,r})();class q{static RoundPoint(e){return new x(q.RoundDouble(e.x),q.RoundDouble(e.y))}static RoundDouble(e){return Math.round(e*q.mult)/q.mult}}function Tt(r,e){const t=r-e;return t<0?-1:0==t?0:1}function Md(r,e){return Tt(r.y,e.y)||Tt(r.x,e.x)}function nt(r,e){const t=r-e;return-q.distanceEpsilon<=t&&t<=q.distanceEpsilon}function xE(r,e){return cl(r,e)>0}function cl(r,e){const t=r-e;return t<=-q.distanceEpsilon?-1:t>=q.distanceEpsilon?1:0}q.distanceEpsilonPrecision=6,q.mult=Math.pow(10,6),q.defaultLeafBoxesOffset=.5,q.lineSegmentThreshold=.05,q.intersectionEpsilon=1e-4,q.distanceEpsilon=Math.pow(10,-q.distanceEpsilonPrecision),q.squareOfDistanceEpsilon=Math.pow(10,2*-q.distanceEpsilonPrecision),q.tolerance=1e-8;var Ie=(()=>{return(r=Ie||(Ie={}))[r.Clockwise=0]="Clockwise",r[r.Counterclockwise=1]="Counterclockwise",r[r.Collinear=2]="Collinear",Ie;var r})();function wt(r,e){return r.sub(e).length}class x{constructor(e,t){this.x_=e,this.y_=t}static ProjectionToLine(e,t,n){let i=t.sub(e);const s=i.length;if(s<q.distanceEpsilon)return e;i=i.div(s);const o=n.sub(e).dot(i);return e.add(i.mul(o))}static RayIntersectsRayInteriors(e,t,n,i){const s=x.lineLineIntersection(e,e.add(t),n,n.add(i));if(s&&s.sub(e).dot(t.div(t.l1))>q.distanceEpsilon&&s.sub(n).dot(i.div(i.l1))>q.distanceEpsilon)return s}static IntervalIntersectsRay(e,t,n,i){const s=x.lineLineIntersection(e,t,n,n.add(i));if(!s)return;const o=e.sub(s),a=s.sub(t);return!(o.dot(a)<=0)&&!(s.sub(n).dot(i)<0)&&o.dot(o)>q.squareOfDistanceEpsilon&&a.dot(a)>=q.squareOfDistanceEpsilon?s:void 0}static PointToTheLeftOfLineOrOnLine(e,t,n){return x.signedDoubledTriangleArea(e,t,n)>=0}static PointToTheLeftOfLine(e,t,n){return x.signedDoubledTriangleArea(e,t,n)>0}static PointIsInsideCone(e,t,n,i){return x.PointToTheRightOfLineOrOnLine(e,t,n)&&x.PointToTheLeftOfLineOrOnLine(e,t,i)}static PointToTheRightOfLineOrOnLine(e,t,n){return x.signedDoubledTriangleArea(t,n,e)<=0}static PointToTheRightOfLine(e,t,n){return x.signedDoubledTriangleArea(t,n,e)<0}static closeIntersections(e,t){return x.close(e,t,q.intersectionEpsilon)}get l1(){return Math.abs(this.x_)+Math.abs(this.y_)}dot(e){return this.x*e.x+this.y*e.y}get x(){return this.x_}get y(){return this.y_}compareTo(e){const t=Tt(this.x,e.x);return 0!=t?t:Tt(this.y,e.y)}toString(){return"("+this.x+","+this.y+")"}static close(e,t,n){return e.sub(t).length<=n}static closeSquare(e,t,n){const i=t.sub(e);return i.dot(i)<=n}static closeDistEps(e,t,n=q.distanceEpsilon){return e.sub(t).length<=n}normalize(){const e=this.length;return new x(this.x/e,this.y/e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get lengthSquared(){return this.x*this.x+this.y*this.y}static middle(e,t){return e.add(t).div(2)}scale(e,t){return new x(this.x*e,this.y*t)}add(e){return new x(this.x+e.x,this.y+e.y)}sub(e){return new x(this.x-e.x,this.y-e.y)}mul(e){return new x(this.x*e,this.y*e)}div(e){return new x(this.x/e,this.y/e)}equal(e){return e.x==this.x&&e.y==this.y}neg(){return new x(-this.x,-this.y)}static lineLineIntersection(e,t,n,i){const s=t.sub(e),o=n.sub(i),a=n.sub(e),l=eu.solve(s.x,o.x,a.x,s.y,o.y,a.y);if(null!=l)return e.add(s.mul(l.x))}static segSegIntersection(e,t,n,i){const s=t.sub(e),o=n.sub(i),a=n.sub(e),l=q.tolerance,c=eu.solve(s.x,o.x,a.x,s.y,o.y,a.y);if(null!=c&&c.x>-l&&c.x<1+l&&c.y>-l&&c.y<1+l)return e.add(s.mul(c.x))}static parallelWithinEpsilon(e,t,n){const i=e.length,s=t.length;return i<n||s<n||(e=e.div(i),t=t.div(s),Math.abs(-e.x*t.y+e.y*t.x)<n)}static crossProduct(e,t){return e.x*t.y-e.y*t.x}static dot(e,t){return e.x*t.x+e.y*t.y}static add(e,t){return e.add(t)}rotate90Ccw(){return new x(-this.y,this.x)}rotate90Cw(){return new x(this.y,-this.x)}clone(){return new x(this.x,this.y)}rotate(e){const t=Math.cos(e),n=Math.sin(e);return new x(t*this.x-n*this.y,n*this.x+t*this.y)}static mkPoint(e,t,n,i){return t.mul(e).add(i.mul(n))}static convSum(e,t,n){return t.add(n.sub(t).mul(e))}static anglePCP(e,t,n){return x.angle(e.sub(t),n.sub(t))}static angle(e,t){const n=e.x,i=e.y,s=t.x,o=t.y,a=n*o-i*s,l=n*s+i*o;if(Math.abs(l)<q.tolerance)return Math.abs(a)<q.tolerance?0:a<-q.tolerance?3*Math.PI/2:Math.PI/2;if(Math.abs(a)<q.tolerance)return l<-q.tolerance?Math.PI:0;const c=Math.atan2(a,l);return a>=-q.tolerance?c:2*Math.PI+c}static signedDoubledTriangleArea(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}static getTriangleOrientation(e,t,n){const i=x.signedDoubledTriangleArea(e,t,n);return i>q.distanceEpsilon?Ie.Counterclockwise:i<-q.distanceEpsilon?Ie.Clockwise:Ie.Collinear}static getTriangleOrientationWithIntersectionEpsilon(e,t,n){const i=x.signedDoubledTriangleArea(e,t,n);return i>q.intersectionEpsilon?Ie.Counterclockwise:i<-q.intersectionEpsilon?Ie.Clockwise:Ie.Collinear}static ClosestPointAtLineSegment(e,t,n){const i=n.sub(t),s=e.sub(t),o=i.dot(s),a=i.dot(i);return o<=0+q.tolerance?t:a<=o+q.tolerance?n:t.add(i.mul(o/a))}static pointToTheLeftOfLineOrOnLine(e,t,n){return x.signedDoubledTriangleArea(e,t,n)>=0}static pointToTheLeftOfLine(e,t,n){return x.signedDoubledTriangleArea(e,t,n)>0}static pointToTheRightOfLineOrOnLine(e,t,n){return x.signedDoubledTriangleArea(t,n,e)<=0}static pointToTheRightOfLine(e,t,n){return x.signedDoubledTriangleArea(t,n,e)<0}static canProject(e,t,n){const i=n.sub(t);return!(e.sub(t).dot(i)<0||e.sub(n).dot(i)>0)}static distToLineSegment(e,t,n){const i=n.sub(t),s=e.sub(t);let o,a;if((o=i.dot(s))<=q.tolerance)return{par:0,dist:s.length};if((a=i.dot(i))<=o+q.tolerance)return{par:1,dist:e.sub(n).length};const l=o/a;return{par:l,dist:t.add(i.mul(l)).length}}}class Pr{constructor(){this._next=null,this.prev=null}get point(){return this._point}set point(e){this._point=e}get next(){return this._next}set next(e){this._next=e}get nextOnPolyline(){return this.polyline.next(this)}get prevOnPolyline(){return this.polyline.prev(this)}getNext(){return this.next}setNext(e){this.next=e,null!=this.polyline&&this.polyline.setInitIsRequired()}getPrev(){return this.prev}setPrev(e){this.prev=e,null!=this.polyline&&this.polyline.setInitIsRequired()}static mkFromPoint(e){const t=new Pr;return t.point=e,t}}var $i=(()=>{return(r=$i||($i={}))[r.Corner=0]="Corner",r[r.VertexA=1]="VertexA",r[r.otherCorner=2]="otherCorner",r[r.VertexB=3]="VertexB",$i;var r})();class lt{contains(e){const t=e.sub(this.corner),n=q.distanceEpsilon,i=t.dot(this.bRot);if(i>this.abRot+n||i<-n)return!1;const s=t.dot(this.aRot);return s<=this.baRot+n&&s>=-n}get area(){return Math.abs(this.a.x*this.b.y-this.a.y*this.b.x)}vertex(e){switch(e){case $i.Corner:return this.corner;case $i.VertexA:return this.aPlusCorner;case $i.otherCorner:return this.otherCorner;case $i.VertexB:return this.bPlusCorner;default:return}}static parallelogramOfTwo(e,t){const n=new lt,i=e.corner,s={minx:i.x,maxx:i.x,miny:i.y,maxy:i.y};return lt.pumpMinMax(s,e.aPlusCorner),lt.pumpMinMax(s,e.otherCorner),lt.pumpMinMax(s,e.bPlusCorner),lt.pumpMinMax(s,t.corner),lt.pumpMinMax(s,t.aPlusCorner),lt.pumpMinMax(s,t.otherCorner),lt.pumpMinMax(s,t.bPlusCorner),n.corner=new x(s.minx,s.miny),n.a=new x(0,s.maxy-s.miny),n.b=new x(s.maxx-s.minx,0),n.aPlusCorner=n.a.add(n.corner),n.otherCorner=n.b.add(n.aPlusCorner),n.bPlusCorner=n.b.add(n.corner),n.aRot=new x(-n.a.y,n.a.x),n.aRot.length>.5&&(n.aRot=n.aRot.normalize()),n.bRot=new x(-n.b.y,n.b.x),n.bRot.length>.5&&(n.bRot=n.bRot.normalize()),n.abRot=n.a.dot(n.bRot),n.baRot=n.b.dot(n.aRot),n.abRot<0&&(n.abRot=-n.abRot,n.bRot=n.bRot.neg()),n.baRot<0&&(n.baRot=-n.baRot,n.aRot=n.aRot.neg()),n.isSeg=n.a.sub(n.b).length<q.distanceEpsilon,n}static pumpMinMax(e,t){t.x<e.minx?e.minx=t.x:t.x>e.maxx&&(e.maxx=t.x),t.y<e.miny?e.miny=t.y:t.y>e.maxy&&(e.maxy=t.y)}static intersect(e,t){return 0!=!(lt.separByA(e,t)||lt.separByA(t,e)||lt.separByB(e,t)||lt.separByB(t,e))&&(!(e.isSeg&&t.isSeg&&x.parallelWithinEpsilon(e.otherCorner.sub(e.corner),t.otherCorner.sub(t.corner),1e-5))||lt.ParallelSegsIntersect(t,e))}static ParallelSegsIntersect(e,t){const n=e.corner,s=t.corner,o=t.otherCorner,a=e.otherCorner.sub(n),c=a.dot(a);let u=s.sub(n).dot(a),S=o.sub(n).dot(a);if(u>S){const b=u;u=S,S=b}return!(S<0-q.distanceEpsilon||u>c+q.distanceEpsilon)}static separByB(e,t){const n=q.distanceEpsilon,i=t.vertex(0).sub(e.corner).dot(e.bRot),s=[$i.VertexA,$i.otherCorner,$i.VertexB];if(i>e.abRot+n){for(const o of s)if(t.vertex(o).sub(e.corner).dot(e.bRot)<=e.abRot+n)return!1;return!0}if(i<-n){for(const o of s)if(t.vertex(o).sub(e.corner).dot(e.bRot)>=-n)return!1;return!0}return!1}static separByA(e,t){const n=q.distanceEpsilon;let i=t.corner.sub(e.corner);const s=x.dot(i,e.aRot);return s>e.baRot+n?(i=t.aPlusCorner.sub(e.corner),!(x.dot(i,e.aRot)<=e.baRot+n||(i=t.bPlusCorner.sub(e.corner),x.dot(i,e.aRot)<=e.baRot+n)||(i=t.otherCorner.sub(e.corner),x.dot(i,e.aRot)<=e.baRot+n))):s<-n&&(i=t.aPlusCorner.sub(e.corner),!(x.dot(i,e.aRot)>=-n||(i=t.bPlusCorner.sub(e.corner),x.dot(i,e.aRot)>=-n)||(i=t.otherCorner.sub(e.corner),x.dot(i,e.aRot)>=-n)))}static parallelogramByCornerSideSide(e,t,n){const i=new lt;return i.corner=e,i.a=t,i.b=n,i.aRot=new x(-t.y,t.x),i.aRot.length>.5&&(i.aRot=i.aRot.normalize()),i.bRot=new x(-n.y,n.x),i.bRot.length>.5&&(i.bRot=i.bRot.normalize()),i.abRot=i.bRot.dot(t),i.baRot=n.dot(i.aRot),i.abRot<0&&(i.abRot=-i.abRot,i.bRot=i.bRot.neg()),i.baRot<0&&(i.baRot=-i.baRot,i.aRot=i.aRot.neg()),i.isSeg=t.sub(n).length<q.distanceEpsilon,i.aPlusCorner=t.add(e),i.otherCorner=n.add(i.aPlusCorner),i.bPlusCorner=n.add(e),i}static getParallelogramOfAGroup(e){let t=0,n=0,i=0,s=0,o=!0;for(const a of e){const l=JW(a);for(const c of l){const u=c.x,S=c.y;o?(o=!1,t=n=u,i=s=S):(u<t?t=u:u>n&&(n=u),S<i?i=S:S>s&&(s=S))}}return lt.parallelogramByCornerSideSide(new x(t,i),new x(0,s-i),new x(n-t,0))}}function*JW(r){yield r.corner,yield r.aPlusCorner,yield r.otherCorner,yield r.bPlusCorner}class me{constructor(e,t,n,i){this.parStart=0,this.parEnd=1,this.start=new x(e,t),this.end=new x(n,i)}offsetCurve(e,t){return null}trim(e,t){if((e=Math.max(this.parStart,e))>(t=Math.min(this.parEnd,t)))throw"wrong params in trimming";const n=this.value(e),i=this.value(t);return x.close(n,i,q.distanceEpsilon)?null:me.mkPP(n,i)}value(e){return this.start.add(this.end.sub(this.start).mul(e))}trimWithWrap(e,t){return null}pNodeOverICurve(){const e=this.end.sub(this.start).mul(.5);return{parallelogram:lt.parallelogramByCornerSideSide(this.start,e,e),seg:this,leafBoxesOffset:0,node:{low:0,high:1,chord:this}}}normal(){let e=this.start.sub(this.end);return e=e.div(e.length),new x(-e.y,e.x)}static mkPP(e,t){return new me(e.x,e.y,t.x,t.y)}static mkLinePXY(e,t,n){return new me(e.x,e.y,t,n)}derivative(e){return this.end.sub(this.start)}secondDerivative(e){return new x(0,0)}thirdDerivative(e){return new x(0,0)}reverse(){return me.mkPP(this.end,this.start)}translate(e){this.start=this.start.add(e),this.end=this.end.add(e)}scaleFromOrigin(e,t){return me.mkPP(this.start.scale(e,t),this.end.scale(e,t))}getParameterAtLength(e){const t=this.end.sub(this.start).length;if(t<q.tolerance)return 0;const n=e/t;return n>1?1:n<0?0:n}transform(e){return me.mkPP(e.multiplyPoint(this.start),e.multiplyPoint(this.end))}closestParameterWithinBounds(e,t,n){let i=this.closestParameter(e);return i<t&&(i=t),i>n&&(i=n),i}lengthPartial(e,t){return this.value(t).sub(this.value(e)).length}get length(){return this.start.sub(this.end).length}get boundingBox(){return Ne.mkPP(this.start,this.end)}clone(){return me.mkPP(this.start.clone(),this.end.clone())}static closestParameterOnLineSegment(e,t,n){const i=n.sub(t),s=e.sub(t),o=i.dot(s);if(o<=0+q.tolerance)return 0;const a=i.dot(i);return a<=o+q.tolerance?1:o/a}closestParameter(e){return me.closestParameterOnLineSegment(e,this.start,this.end)}leftDerivative(e){return this.derivative(e)}rightDerivative(e){return this.derivative(e)}static IntersectPPPP(e,t,n,i){const s=x.lineLineIntersection(e,t,n,i);if(null!=s&&me.xIsBetweenPoints(e,t,s)&&me.xIsBetweenPoints(n,i,s))return s}static xIsBetweenPoints(e,t,n){return e.sub(n).dot(t.sub(n))<=q.distanceEpsilon}curvature(e){return 0}curvatureDerivative(e){return 0}curvatureSecondDerivative(e){return 0}static minDistBetweenLineSegments(e,t,n,i){const s=t.sub(e),o=i.sub(n),a=e.sub(n),l=x.crossProduct(s,o),c=s.dot(s),u=s.dot(o),S=o.dot(o),b=s.dot(a),L=o.dot(a);let F,G;const J=Math.abs(l);let te=J,ie=J;J<q.tolerance?(F=0,te=1,G=L,ie=S):(F=x.crossProduct(o,a),G=x.crossProduct(s,a),l<0&&(F=-F,G=-G),F<0?(F=0,G=L,ie=S):F>te&&(F=te=1,G=L+u,ie=S)),G<0?(G=0,-b<0?F=0:-b>c?F=te:(F=-b,te=c)):G>ie&&(G=ie=1,-b+u<0?F=0:-b+u>c?F=te:(F=-b+u,te=c));const he=Math.abs(F)<q.tolerance?0:F/te,Ce=Math.abs(G)<q.tolerance?0:G/ie;return{parab:he,parcd:Ce,dist:a.add(s.mul(he).sub(o.mul(Ce))).length}}}class Xt{static distToSegm(e,t,n){const i=n.sub(t);if(i.length<q.intersectionEpsilon)return e.sub(t.add(n).div(2)).length;let s=new x(-i.y,i.x);return s=s.mul(1/s.length),Math.abs(e.sub(t).dot(s))}static createParallelogramOnSubSeg(e,t,n){let i=n.derivative(e);const s=n.derivative(t),o=new x(-s.y,s.x),a=n.value(e),l=n.value(t),u=l.sub(a).dot(o),S=i.dot(o),b=Math.abs(u)<q.distanceEpsilon;if(b||!(Math.abs(S)<q.distanceEpsilon))return i=i.mul(b?0:u/S),lt.parallelogramByCornerSideSide(a,i,l.sub(a).sub(i))}static createParallelogramNodeForCurveSeg(e,t,n,i){if(e==n.parStart&&t==n.parEnd&&x.close(n.start,n.end,q.distanceEpsilon))return Xt.createNodeWithSegmentSplit(e,t,n,i);const o=n.value(e),a=n.value(t),l=a.sub(o),c=n.value((e+t)/2);if(Xt.distToSegm(c,o,a)<=q.intersectionEpsilon&&l.dot(l)<q.lineSegmentThreshold*q.lineSegmentThreshold&&t-e<q.lineSegmentThreshold){const u=me.mkPP(o,a),S=u.pNodeOverICurve();S.seg=n;const b=S.node;return b.low=e,b.high=t,b.chord=u,S}if(Xt.WithinEpsilon(n,e,t,i)){const u=Xt.createParallelogramOnSubSeg(e,t,n);if(null!=u)return function $W(r,e,t,n,i){return{parallelogram:t,seg:n,leafBoxesOffset:i,node:{low:r,high:e,chord:null}}}(e,t,u,n,i)}return Xt.createNodeWithSegmentSplit(e,t,n,i)}static WithinEpsilon(e,t,n,i){const o=(n-t)/3,a=e.value(t),l=e.value(n);return!(Xt.distToSegm(e.value(t+o),a,l)>i)&&Xt.distToSegm(e.value(t+2*o),a,l)<=i}static createParallelogramNodeForCurveSegDefaultOffset(e){return Xt.createParallelogramNodeForCurveSeg(e.parStart,e.parEnd,e,q.defaultLeafBoxesOffset)}static createNodeWithSegmentSplit(e,t,n,i){const s={parallelogram:null,seg:n,leafBoxesOffset:1,node:{children:[]}},o=s.node;return o.children.push(Xt.createParallelogramNodeForCurveSeg(e,.5*(e+t),n,i)),o.children.push(Xt.createParallelogramNodeForCurveSeg(.5*(e+t),t,n,i)),s.parallelogram=lt.parallelogramOfTwo(o.children[0].parallelogram,o.children[1].parallelogram),s}}class no{constructor(e,t,n,i,s){this.par0=e,this.par1=t,this.x=n,this.seg0=i,this.seg1=s}}class _d{static closestPoint(e,t,n,i,s){let S,l=n,c=0,u=0,b=!1;do{const L=e.value(l),F=e.derivative(l),G=e.secondDerivative(l),J=F.dot(F)+L.sub(t).dot(G);if(Math.abs(J)<q.tolerance)return l;S=L.sub(t).dot(F.div(J)),l-=S,l>s+q.tolerance?(l=s,u++):l<i-q.tolerance&&(l=i,u++),c++}while(Math.abs(S)>q.tolerance&&!(b=c>=5||u>=5));return b&&e.value(n).sub(t).length<q.distanceEpsilon&&(l=n),l}}class mt{constructor(e,t,n,i,s){this.parStart=e,this.parEnd=t,this.aAxis=n,this.bAxis=i,this.center=s,this.pNode=null,this.setBoundingBox()}offsetCurve(e,t){const n=t.sub(this.center),i=x.angle(this.aAxis,n);if(this.aAxis.mul(Math.cos(i)).add(this.bAxis.mul(Math.sin(i))).length<n.length){const o=this.aAxis.length,a=this.bAxis.length;return mt.mkEllipsePPP(this.aAxis.normalize().mul(o+e),this.bAxis.normalize().mul(a+e),this.center)}{const o=this.aAxis.length,a=this.bAxis.length;return mt.mkEllipsePPP(this.aAxis.normalize().mul(o-e),this.bAxis.normalize().mul(a-e),this.center)}}reverse(){return null}static mkEllipsePPP(e,t,n){return new mt(0,2*Math.PI,e,t,n)}get start(){return this.value(this.parStart)}get end(){return this.value(this.parEnd)}trim(e,t){return new mt(Math.max(e,this.parStart),Math.min(t,this.parEnd),this.aAxis,this.bAxis,this.center)}trimWithWrap(e,t){return null}get boundingBox(){return this.box}value(e){return this.center.add(x.mkPoint(Math.cos(e),this.aAxis,Math.sin(e),this.bAxis))}derivative(e){return x.mkPoint(-Math.sin(e),this.aAxis,Math.cos(e),this.bAxis)}secondDerivative(e){return x.mkPoint(-Math.cos(e),this.aAxis,-Math.sin(e),this.bAxis)}thirdDerivative(e){return x.mkPoint(Math.sin(e),this.aAxis,-Math.cos(e),this.bAxis)}pNodeOverICurve(){return null!=this.pNode?this.pNode:this.pNode=Xt.createParallelogramNodeForCurveSegDefaultOffset(this)}setBoundingBox(){if(nt(this.parStart,0)&&nt(this.parEnd,2*Math.PI))this.box=this.fullBox();else{let e;this.box=Ne.mkPP(this.start,this.end);for(let t=Math.ceil(this.parStart/(Math.PI/2));(e=t*Math.PI/2)<this.parEnd;t++)e>this.parStart&&this.box.add(this.value(e))}}static mkEllipse(e,t,n,i,s,o){return new mt(e,t,n,i,new x(s,o))}static mkFullEllipsePPP(e,t,n){return new mt(0,2*Math.PI,e,t,n)}static mkFullEllipseNNP(e,t,n){return new mt(0,2*Math.PI,new x(e,0),new x(0,t),n)}static mkCircle(e,t){return mt.mkFullEllipseNNP(e,e,t)}translate(e){this.center=this.center.add(e),this.box.center=this.box.center.add(e),this.pNode=null}scaleFromOrigin(e,t){return new mt(this.parStart,this.parEnd,this.aAxis.mul(e),this.bAxis.mul(t),this.center.scale(e,t))}getParameterAtLength(e){let n=this.parStart,i=this.parEnd;const s=e+.001,o=e-.001;for(;i-n>q.distanceEpsilon;){const a=.5*(i+n),l=this.lengthPartial(this.parStart,a);if(l>s)i=a;else{if(!(l<o))return a;n=a}}return(i+n)/2}transform(e){if(null!=e){const t=e.multiplyPoint(this.aAxis).sub(e.offset()),n=e.multiplyPoint(this.bAxis).sub(e.offset());return new mt(this.parStart,this.parEnd,t,n,e.multiplyPoint(this.center))}return this}closestParameterWithinBounds(e,t,n){const s=(n-t)/9;let o=t,a=Number.MAX_VALUE;for(let c=0;c<=8;c++){const u=t+c*s,S=e.sub(this.value(u)),b=S.dot(S);b<a&&(a=b,o=u)}0==o&&n==2*Math.PI&&(t=-Math.PI);let l=_d.closestPoint(this,e,o,t,n);return l<0&&(l+=2*Math.PI),l}lengthPartial(e,t){return ee.lengthWithInterpolationAndThreshold(this.trim(e,t),q.lineSegmentThreshold/100)}get length(){return ee.lengthWithInterpolation(this)}clone(){return new mt(this.parStart,this.parEnd,this.aAxis.clone(),this.bAxis.clone(),this.center.clone())}closestParameter(e){let t=0;const i=(this.parEnd-this.parStart)/9;let s=this.parStart,o=Number.MAX_VALUE;for(let c=0;c<=8;c++){const u=this.parStart+c*i,S=e.sub(this.value(u)),b=S.dot(S);b<o&&(o=b,s=u)}let a=!1;0==s&&this.parEnd==2*Math.PI&&(a=!0,t=this.parStart,this.parStart=-Math.PI);let l=_d.closestPoint(this,e,s,this.parStart,this.parEnd);return l<0&&(l+=2*Math.PI),a&&(this.parStart=t),l}leftDerivative(e){return this.derivative(e)}rightDerivative(e){return this.derivative(e)}curvature(e){throw"NotImplementedException()"}curvatureDerivative(e){throw"NotImplementedException();"}curvatureSecondDerivative(e){throw"NotImplementedException()"}orientedCounterclockwise(){return x.crossProduct(this.aAxis,this.bAxis)>0}fullBox(){const e=this.aAxis.add(this.bAxis);return Ne.mkPP(this.center.add(e),this.center.sub(e))}isArc(){return Math.abs(this.aAxis.dot(this.bAxis))<q.tolerance&&Math.abs(this.aAxis.length-this.bAxis.length)<q.tolerance&&x.closeDistEps(this.aAxis.rotate90Ccw(),this.bAxis)}}class qW{constructor(e,t,n,i,s,o,a,l){this.curveA=e,this.curveB=t,this.aMin=n,this.bMin=s,this.aMax=i,this.bMax=o,this.aGuess=a,this.bGuess=l,this.si=a,this.ti=l}initValues(){this.a=this.curveA.value(this.si),this.b=this.curveB.value(this.ti),this.a_b=this.a.sub(this.b),this.ad=this.curveA.derivative(this.si),this.add=this.curveA.secondDerivative(this.si),this.bd=this.curveB.derivative(this.ti),this.bdd=this.curveB.secondDerivative(this.ti)}Fs(){return this.a_b.dot(this.ad)}Fss(){return this.a_b.dot(this.add)+this.ad.dot(this.ad)}Fst(){return-this.bd.dot(this.ad)}Ftt(){return-this.a_b.dot(this.bdd)+this.bd.dot(this.bd)}Ft(){return-this.a_b.dot(this.bd)}delta(e,t,n,i){return e*i-n*t}solve(){let o,e=0,n=0,s=!1;if(this.initValues(),this.curveA instanceof me&&this.curveB instanceof me){let a=this.curveB.derivative(0);a=a.div(a.length);const l=this.curveA.normal(),c=Math.abs(l.dot(a));if(Math.abs(c)<q.distanceEpsilon||this.delta(this.Fss(),this.Fst(),this.Fst(),this.Ftt())<q.tolerance)return this.success=!0,void this.parallelLineSegLineSegMinDist()}do{const a=this.delta(this.Fss(),this.Fst(),this.Fst(),this.Ftt());if(Math.abs(a)<q.tolerance){this.success=!1,s=!0;break}o={s:this.delta(-this.Fs(),this.Fst(),-this.Ft(),this.Ftt())/a,t:this.delta(this.Fss(),-this.Fs(),this.Fst(),-this.Ft())/a};const l=this.si+o.s,c=this.ti+o.t;let u;l>this.aMax+q.distanceEpsilon||l<this.aMin-q.distanceEpsilon||c>this.bMax+q.distanceEpsilon||c<this.bMin-q.distanceEpsilon?(e++,this.chopDsDt(o),this.si+=o.s,this.ti+=o.t,u=!0):(u=!1,this.si=l,this.ti=c,this.si>this.aMax?this.si=this.aMax:this.si<this.aMin&&(this.si=this.aMin),this.ti>this.bMax?this.ti=this.bMax:this.ti<this.bMin&&(this.ti=this.bMin)),this.initValues(),n++,s=e>=10||n>=100||0==o.s&&0==o.t&&u}while((Math.abs(o.s)>=q.tolerance||Math.abs(o.t)>=q.tolerance)&&!s);if(s){const a=this.curveA.value(this.aGuess).sub(this.curveB.value(this.bGuess));if(a.dot(a)<q.distanceEpsilon*q.distanceEpsilon)return this.aSolution=this.aGuess,this.bSolution=this.bGuess,this.aPoint=this.curveA.value(this.aGuess),this.bPoint=this.curveB.value(this.bGuess),void(this.success=!0)}this.aSolution=this.si,this.bSolution=this.ti,this.aPoint=this.a,this.bPoint=this.b,this.success=!s}chopDsDt(e){if(0!=e.s&&0!=e.t){let t=1;this.si+e.s>this.aMax?t=(this.aMax-this.si)/e.s:this.si+e.s<this.aMin&&(t=(this.aMin-this.si)/e.s);let n=1;this.ti+e.t>this.bMax?n=(this.bMax-this.ti)/e.t:this.ti+e.t<this.bMin&&(n=(this.bMin-this.ti)/e.t);const i=Math.min(t,n);e.s*=i,e.t*=i}else 0==e.s?this.ti+e.t>this.bMax?e.t=this.bMax-this.ti:this.ti+e.t<this.bMin&&(e.t=this.bMin-this.ti):this.si+e.s>this.aMax?e.s=this.aMax-this.si:this.si+e.s<this.aMin&&(e.s=this.aMin-this.si)}parallelLineSegLineSegMinDist(){const e=this.curveA,t=this.curveB,n=e.start,i=e.end,s=t.start,o=t.end;let a=i.sub(n);const l=a.length;let u,S,b,c=0;if(l>q.distanceEpsilon){a=a.div(l),u=a.dot(i.sub(n)),S=a.dot(s.sub(n)),b=a.dot(o.sub(n));let L=!1;if(S>b){L=!0;const F=S;S=b,b=F}if(b<c)this.aSolution=0,this.bSolution=L?0:1;else if(S>u)this.aSolution=1,this.bSolution=L?1:0;else{const F=Math.min(u,b);this.aSolution=F/(u-c),this.bSolution=(F-S)/(b-S),L&&(this.bSolution=1-this.bSolution)}}else{let L=o.sub(s);const F=L.length;if(F>q.distanceEpsilon)if(L=L.div(F),c=0,u=L.dot(o.sub(s)),S=L.dot(n.sub(s)),S<c)this.bSolution=0,this.aSolution=1;else if(S>u)this.bSolution=1,this.aSolution=0;else{const G=Math.min(u,S);this.bSolution=G/(u-c),this.aSolution=0}else this.aSolution=0,this.bSolution=0}this.aPoint=this.curveA.value(this.aSolution),this.bPoint=this.curveB.value(this.bSolution)}}class jt{constructor(e,t,n,i){this.b=new Array(4),this.parStart=0,this.parEnd=1,this.b[0]=e,this.b[1]=t,this.b[2]=n,this.b[3]=i,this.c=this.b[1].sub(this.b[0]).mul(3),this.e=this.b[2].sub(this.b[1]).mul(3).sub(this.c),this.l=this.b[3].sub(this.b[0]).sub(this.c).sub(this.e)}leftDerivative(e){return this.derivative(e)}rightDerivative(e){return this.derivative(e)}B(e){return this.b[e]}pNodeOverICurve(){return null!=this.pBoxNode?this.pBoxNode:this.pBoxNode=Xt.createParallelogramNodeForCurveSegDefaultOffset(this)}value(e){const t=e*e;return this.l.mul(t*e).add(this.e.mul(t).add(this.c.mul(e)).add(this.b[0]))}static adjustParamTo01(e){return e>1?1:e<0?0:e}trim(e,t){if((e=jt.adjustParamTo01(e))>(t=jt.adjustParamTo01(t)))return this.trim(t,e);if(e>1-q.tolerance)return new jt(this.b[3],this.b[3],this.b[3],this.b[3]);const n=new Array(3),i=new Array(2),s=this.casteljau(e,n,i),o=new jt(s,i[1],n[2],this.b[3]),a=o.casteljau((t-e)/(1-e),n,i);return new jt(o.b[0],n[0],i[0],a)}trimWithWrap(e,t){throw"NotImplementedException()"}casteljau(e,t,n){const i=1-e;for(let s=0;s<3;s++)t[s]=x.mkPoint(i,this.b[s],e,this.b[s+1]);for(let s=0;s<2;s++)n[s]=x.mkPoint(i,t[s],e,t[s+1]);return x.mkPoint(i,n[0],e,n[1])}derivative(e){return this.l.mul(3*e*e).add(this.e.mul(2*e)).add(this.c)}secondDerivative(e){return x.mkPoint(6*e,this.l,2,this.e)}thirdDerivative(e){return this.l.mul(6)}get start(){return this.b[0]}get end(){return this.b[3]}reverse(){return new jt(this.b[3],this.b[2],this.b[1],this.b[0])}translate(e){this.b[0]=this.b[0].add(e),this.b[1]=this.b[1].add(e),this.b[2]=this.b[2].add(e),this.b[3]=this.b[3].add(e),this.c=this.b[1].sub(this.b[0]).mul(3),this.e=this.b[2].sub(this.b[1]).mul(3).sub(this.c),this.l=this.b[3].sub(this.b[0]).sub(this.c).sub(this.e),this.pBoxNode=null}scaleFromOrigin(e,t){return new jt(this.b[0].scale(e,t),this.b[1].scale(e,t),this.b[2].scale(e,t),this.b[3].scale(e,t))}offsetCurve(e,t){return null}lengthPartial(e,t){return this.trim(e,t).length}get length(){return jt.lengthOnControlPolygon(this.b[0],this.b[1],this.b[2],this.b[3])}static lengthOnControlPolygon(e,t,n,i){const s=i.sub(e).length,o=t.sub(e).length+n.sub(t).length+i.sub(n).length;if(o-s>q.lineSegmentThreshold){const a=x.middle(e,t),l=x.middle(t,n),c=x.middle(n,i),u=x.middle(a,l),S=x.middle(c,l),b=x.middle(u,S);return jt.lengthOnControlPolygon(e,a,u,b)+jt.lengthOnControlPolygon(b,S,c,i)}return(o+s)/2}get boundingBox(){const e=Ne.mkPP(this.b[0],this.b[1]);return e.add(this.b[2]),e.add(this.b[3]),e}transform(e){return new jt(e.multiplyPoint(this.b[0]),e.multiplyPoint(this.b[1]),e.multiplyPoint(this.b[2]),e.multiplyPoint(this.b[3]))}closestParameterWithinBounds(e,t,n){const i=(n-t)/8;let s=0,o=Number.MAX_VALUE;for(let a=0;a<9;a++){const l=e.sub(this.value(a*i+t)),c=l.dot(l);c<o&&(o=c,s=a*i+t)}return _d.closestPoint(this,e,s,t,n)}clone(){return new jt(this.b[0],this.b[1],this.b[2],this.b[3])}static mkBezier(e){return new jt(e[0],e[1],e[2],e[3])}curvature(e){const t=this.G(e);return this.F(e)/t}F(e){return this.Xp(e)*this.Ypp(e)-this.Yp(e)*this.Xpp(e)}G(e){const t=this.Xp(e),n=this.Yp(e),i=t*t+n*n;return Math.sqrt(i*i*i)}Xp(e){return 3*this.l.x*e*e+2*this.e.x*e+this.c.x}Ypp(e){return 6*this.l.y*e+2*this.e.y}Yp(e){return 3*this.l.y*e*e+2*this.e.y*e+this.c.y}Xpp(e){return 6*this.l.x*e+2*this.e.x}Xppp(e){return 6*this.l.x}Yppp(e){return 6*this.l.y}curvatureDerivative(e){const t=this.G(e);return(this.Fp(e)*t-this.Gp(e)*this.F(e))/(t*t)}Fp(e){return this.Xp(e)*this.Yppp(e)-this.Yp(e)*this.Xppp(e)}Fpp(e){return this.Xpp(e)*this.Yppp(e)-this.Ypp(e)*this.Xppp(e)}closestParameter(e){let n=0,i=Number.MAX_VALUE;for(let s=0;s<9;s++){const o=e.sub(this.value(.125*s)),a=o.dot(o);a<i&&(i=a,n=.125*s)}return _d.closestPoint(this,e,n,0,1)}curvatureSecondDerivative(e){const t=this.G(e);return(this.Qp(e)*t-2*this.Q(e)*this.Gp(e))/(t*t*t)}Q(e){return this.Fp(e)*this.G(e)-this.Gp(e)*this.F(e)}Qp(e){return this.Fpp(e)*this.G(e)-this.Gpp(e)*this.F(e)}Gpp(e){const t=this.Xp(e),n=this.Yp(e),i=this.Xpp(e),s=this.Ypp(e),o=this.Xppp(e),a=this.Yppp(e),l=Math.sqrt(t*t+n*n),c=t*i+n*s;return 3*(c*c/l+l*(i*i+t*o+s*s+n*a))}Gp(e){const t=this.Xp(e),n=this.Yp(e),i=this.Xpp(e),s=this.Ypp(e);return 3*Math.sqrt(t*t+n*n)*(t*i+n*s)}getParameterAtLength(e){let t=0,n=1;for(;n-t>q.tolerance;){const i=(n+t)/2,s=this.evaluateError(e,i);if(s>0)n=i;else{if(!(s<0))return i;t=i}}return(t+n)/2}evaluateError(e,t){const n=1-t,i=x.mkPoint(n,this.b[0],t,this.b[1]),s=x.mkPoint(n,this.b[1],t,this.b[2]),o=x.mkPoint(n,this.b[2],t,this.b[3]),a=x.mkPoint(n,i,t,s),l=x.mkPoint(n,s,t,o),c=x.mkPoint(n,a,t,l),u=jt.lengthOnControlPolygon(this.b[0],i,a,c);return u>e+q.distanceEpsilon?1:u<e-q.distanceEpsilon?-1:0}}var Fe=(()=>{return(r=Fe||(Fe={}))[r.Outside=0]="Outside",r[r.Boundary=1]="Boundary",r[r.Inside=2]="Inside",Fe;var r})();class ee{constructor(){this.segs=[],this.parEnd_=0}static CurvesIntersect(e,t){return e==t||null!=ee.intersectionOne(e,t,!1)}static lengthWithInterpolationAndThreshold(e,t){throw new Error("not implemented")}static lengthWithInterpolation(e){throw"not implemented"}get parStart(){return 0}get parEnd(){return this.parEnd_}lengthPartial(e,t){this.adjustStartEndEndParametersToDomain({start:e,end:t});const i=this.getSegIndexParam(e),s=this.getSegIndexParam(t);if(i.segIndex<s.segIndex){let o=this.segs[i.segIndex],a=o.lengthPartial(i.par,o.parEnd);for(let l=i.segIndex+1;l<s.segIndex;l++)a+=this.segs[l].length;return o=this.segs[s.segIndex],a+o.lengthPartial(o.parStart,s.par)}throw new Error("not implemented.")}reverse(){const e=new ee;for(let t=this.segs.length-1;t>=0;t--)e.addSegment(this.segs[t].reverse());return e}mkCurveWithSegs(e){this.segs=e;for(const t of e)this.parEnd_+=ee.paramSpan(t)}get start(){return this.segs[0].start}get end(){return this.segs[this.segs.length-1].end}scaleFromOrigin(e,t){const n=new ee;for(const i of this.segs)n.addSegment(i.scaleFromOrigin(e,t));return n}trim(e,t){const n={start:e,end:t};this.adjustStartEndEndParametersToDomain(n);const i=this.getSegIndexParam(n.start),s=this.getSegIndexParam(n.end);if(i.segIndex==s.segIndex)return this.segs[i.segIndex].trim(i.par,s.par);let o=new ee;i.par<this.segs[i.segIndex].parEnd&&(o=o.addSegment(this.segs[i.segIndex].trim(i.par,this.segs[i.segIndex].parEnd)));for(let a=i.segIndex+1;a<s.segIndex;a++)o=o.addSegment(this.segs[a]);return this.segs[s.segIndex].parStart<s.par&&(o=o.addSegment(this.segs[s.segIndex].trim(this.segs[s.segIndex].parStart,s.par))),o}translate(e){for(const t of this.segs)t.translate(e);this.pBNode=null}adjustStartEndEndParametersToDomain(e){if(e.start>e.end){const t=e.start;e.start=e.end,e.end=t}e.start<this.parStart&&(e.start=this.parStart),e.end>this.parEnd&&(e.end=this.parEnd)}trimWithWrap(e,t){if(e<t)return this.trim(e,t);const n=new ee;return n.addSegment(this.trim(e,this.parEnd)),n.addSegment(this.trim(this.parStart,t)),n}addSegs(e){for(const t of e)this.addSegment(t);return this}addSegment(e){if(null==e)return this;if(e instanceof ee)for(const t of e.segs)this.segs.push(t),this.parEnd_+=ee.paramSpan(t);else this.segs.push(e),this.parEnd_+=ee.paramSpan(e);return this}pNodeOverICurve(){if(null!=this.pBNode)return this.pBNode;const e=[],t=[];for(const n of this.segs){const i=n.pNodeOverICurve();e.push(i.parallelogram),t.push(i)}return this.pBNode={parallelogram:lt.getParallelogramOfAGroup(e),seg:this,leafBoxesOffset:q.defaultLeafBoxesOffset,node:{children:t}},this.pBNode}static intersectionOne(e,t,n){let i=ee.curveCurveXWithParallelogramNodesOne(e.pNodeOverICurve(),t.pNodeOverICurve());return n&&null!=i&&(i=ee.liftIntersectionToCurves(e,t,i)),i}static getAllIntersections(e,t,n){return e instanceof me?ee.getAllIntersectionsOfLineAndICurve(e,t,n):ee.getAllIntersectionsInternal(e,t,n)}static getAllIntersectionsInternal(e,t,n){const i=[];if(ee.curveCurveXWithParallelogramNodes(e.pNodeOverICurve(),t.pNodeOverICurve(),i),n)for(let s=0;s<i.length;s++)i[s]=ee.liftIntersectionToCurves(e,t,i[s]);return i}static getAllIntersectionsOfLineAndICurve(e,t,n){return t instanceof Me?ee.getAllIntersectionsOfLineAndPolyline(e,t):t instanceof ee?ee.getAllIntersectionsOfLineAndCurve(e,t,n):t instanceof mt&&t.isArc()?ee.getAllIntersectionsOfLineAndArc(e,t):ee.getAllIntersectionsInternal(e,t,n)}static getAllIntersectionsOfLineAndCurve(e,t,n){const i=[],s=e.pNodeOverICurve(),o=t.pNodeOverICurve();if(0==lt.intersect(s.parallelogram,o.parallelogram))return i;let a=0;for(const l of t.segs){const c=ee.getAllIntersections(e,l,!1);if(n){for(const u of c)u.par1+=a-l.parStart,u.seg1=t;a+=l.parEnd-l.parStart}for(const u of c)ee.alreadyInside(i,u)||i.push(u)}return i}static closeIntersections(e,t){return x.close(e.x,t.x,q.intersectionEpsilon)}static closeIntersectionPoints(e,t){return x.close(e,t,q.intersectionEpsilon)}static alreadyInside(e,t){for(let n=0;n<e.length;n++)if(ee.closeIntersections(e[n],t))return!0;return!1}static getAllIntersectionsOfLineAndArc(e,t){let n=e.end.sub(e.start);const i=[],s=n.length;if(s<q.distanceEpsilon){const S=e.start.sub(t.center);if(nt(S.length,t.aAxis.length)){let b=x.angle(t.aAxis,S);t.parStart-q.tolerance<=b&&(b=Math.max(b,t.parStart),b<=t.parEnd+q.tolerance&&(b=Math.min(t.parEnd,b),i.push(new no(0,b,e.start,e,t))))}return i}const o=n.rotate90Ccw().div(s),a=e.start.sub(t.center).dot(o),l=t.center.add(o.mul(a)),c=t.aAxis.length,u=Math.abs(a);if(c<u-q.distanceEpsilon)return i;if(n=o.rotate90Cw(),nt(c,u))ee.tryToAddPointToLineCircleCrossing(e,t,i,l,s,n);else{const S=Math.sqrt(c*c-a*a),b=n.mul(S);ee.tryToAddPointToLineCircleCrossing(e,t,i,l.add(b),s,n),ee.tryToAddPointToLineCircleCrossing(e,t,i,l.sub(b),s,n)}return i}static tryToAddPointToLineCircleCrossing(e,t,n,i,s,o){let l=i.sub(e.start).dot(o);if(l<-q.distanceEpsilon||(l=Math.max(l,0),l>s+q.distanceEpsilon))return;l=Math.min(l,s),l/=s;let c=x.angle(t.aAxis,i.sub(t.center));t.parStart-q.tolerance<=c&&(c=Math.max(c,t.parStart),c<=t.parEnd+q.tolerance&&(c=Math.min(t.parEnd,c),n.push(new no(l,c,i,e,t))))}static getAllIntersectionsOfLineAndPolyline(e,t){const n=[];let i=0,s=t.startPoint;for(;null!=s&&null!=s.getNext();s=s.getNext()){const o=ee.crossTwoLineSegs(e.start,e.end,s.point,s.getNext().point,0,1,0,1);null!=o&&(ee.adjustSolution(e.start,e.end,s.point,s.getNext().point,o),ee.oldIntersection(n,o.x)||n.push(new no(o.aSol,i+o.bSol,o.x,e,t))),i++}if(t.closed){const o=ee.crossTwoLineSegs(e.start,e.end,s.point,t.start,0,1,0,1);null!=o&&(ee.adjustSolution(e.start,e.end,s.point,t.start,o),ee.oldIntersection(n,o.x)||n.push(new no(o.aSol,i+o.bSol,o.x,e,t)))}return n}static adjustSolution(e,t,n,i,s){ee.closeIntersectionPoints(s.x,e)?(s.x=e,s.aSol=0):ee.closeIntersectionPoints(s.x,t)&&(s.x=t,s.aSol=1),ee.closeIntersectionPoints(s.x,n)?(s.x=n,s.bSol=Math.floor(s.bSol)):ee.closeIntersectionPoints(s.x,i)&&(s.x=i,s.bSol=Math.ceil(s.bSol))}static curveCurveXWithParallelogramNodesOne(e,t){if(!lt.intersect(e.parallelogram,t.parallelogram))return null;const n=e.node,i=t.node,s=n.hasOwnProperty("children"),o=i.hasOwnProperty("children");if(s&&o)for(const a of n.children)for(const l of i.children){const c=ee.curveCurveXWithParallelogramNodesOne(a,l);if(null!=c)return c}else if(o)for(const a of i.children){const l=ee.curveCurveXWithParallelogramNodesOne(e,a);if(null!=l)return l}else{if(!s)return ee.crossOverIntervalsOne(e,t);for(const a of n.children){const l=ee.curveCurveXWithParallelogramNodesOne(a,t);if(null!=l)return l}}return null}static curveCurveXWithParallelogramNodes(e,t,n){if(!lt.intersect(e.parallelogram,t.parallelogram))return;const i=e.node.hasOwnProperty("children"),s=t.node.hasOwnProperty("children");if(i&&s)for(const o of e.node.children)for(const a of t.node.children)ee.curveCurveXWithParallelogramNodes(o,a,n);else if(s)for(const o of t.node.children)ee.curveCurveXWithParallelogramNodes(e,o,n);else if(i)for(const o of e.node.children)ee.curveCurveXWithParallelogramNodes(o,t,n);else n=ee.crossOverLeaves(e,t,n)}static crossOverIntervalsOne(e,t){const n=e.node,i=t.node,s=(n.high-n.low)/2,o=(i.high-i.low)/2;for(let a=1;a<2;a++){const l=a*s+n.low;for(let c=1;c<2;c++){const u=c*o+i.low;let S;if(null==n.chord&&null==i.chord?S=ee.crossWithinIntervalsWithGuess(e.seg,t.seg,n.low,n.high,i.low,i.high,l,u):null!=n.chord&&null==i.chord?S=ee.crossWithinIntervalsWithGuess(n.chord,t.seg,0,1,i.low,i.high,.5*a,u):null==n.chord?(S=ee.crossWithinIntervalsWithGuess(e.seg,i.chord,n.low,n.high,0,1,l,.5*c),null!=S&&(S.bSol=i.low+S.bSol*(i.high-i.low))):(S=ee.crossWithinIntervalsWithGuess(n.chord,i.chord,0,1,0,1,.5*a,.5*c),null!=S&&(S.aSol=n.low+S.aSol*(n.high-n.low),S.bSol=i.low+S.bSol*(i.high-i.low))),null!=S)return ee.createIntersectionOne(e,t,S.aSol,S.bSol,S.x)}}return ee.goDeeperOne(e,t)}static crossOverLeaves(e,t,n){const i=e.node,s=t.node;let o=!1;const a=(i.high-i.low)/2+i.low,l=(s.high-s.low)/2+s.low;let c;return null==i.chord&&null==s.chord?c=ee.crossWithinIntervalsWithGuess(e.seg,t.seg,i.low,i.high,s.low,s.high,a,l):null!=i.chord&&null==s.chord?(c=ee.crossWithinIntervalsWithGuess(i.chord,t.seg,0,1,s.low,s.high,.5,l),null!=c&&(c.aSol=i.low+c.aSol*(i.high-i.low))):null==i.chord?(c=ee.crossWithinIntervalsWithGuess(e.seg,s.chord,i.low,i.high,0,1,a,.5),null!=c&&(c.bSol=s.low+c.bSol*(s.high-s.low))):(c=ee.crossWithinIntervalsWithGuess(i.chord,s.chord,0,1,0,1,.5,.5),null!=c&&(c.bSol=s.low+c.bSol*(s.high-s.low),c.aSol=i.low+c.aSol*(i.high-i.low))),null!=c&&(ee.addIntersection(e,t,n,c),o=!0),o||ee.goDeeper(n,e,t),n}static addIntersection(e,t,n,i){const s=e.node;ee.closeIntersectionPoints(i.x,e.seg.value(s.low))?(i.x=e.seg.value(s.low),i.aSol=s.low):ee.closeIntersectionPoints(i.x,e.seg.value(s.high))&&(i.x=e.seg.value(s.high),i.aSol=s.high);const o=t.node;if(ee.closeIntersectionPoints(i.x,t.seg.value(o.low))?(i.x=t.seg.value(o.low),i.bSol=o.low):ee.closeIntersectionPoints(i.x,t.seg.value(o.high))&&(i.x=t.seg.value(o.high),i.bSol=o.high),!ee.oldIntersection(n,i.x)){const l=new no(i.aSol,i.bSol,i.x,e.seg,t.seg);n.push(l)}}static oldIntersection(e,t){for(const n of e)if(t.sub(n.x).length<100*q.distanceEpsilon)return!0;return!1}static createIntersectionOne(e,t,n,i,s){const o=e.node,a=t.node;return ee.closeIntersectionPoints(s,e.seg.value(o.low))?(s=e.seg.value(o.low),n=o.low):ee.closeIntersectionPoints(s,e.seg.value(o.high))&&(s=e.seg.value(o.high),n=o.high),ee.closeIntersectionPoints(s,t.seg.value(a.low))?(s=t.seg.value(a.low),i=a.low):ee.closeIntersectionPoints(s,t.seg.value(a.high))&&(s=t.seg.value(a.high),i=a.high),new no(n,i,s,e.seg,t.seg)}static liftIntersectionToCurves_(e,t,n,i,s,o,a){const l=this.liftParameterToCurve(e,n-o.parStart,o),c=this.liftParameterToCurve(t,i-a.parStart,a);return new no(l,c,s,e,t)}static DropIntersectionToSegs(e){let t,n,i,s;if(e.seg0 instanceof ee){const o=e.seg0.getSegParam(e.par0);t=o.seg,n=o.par}else n=e.par0,t=e.seg0;if(e.seg1 instanceof ee){const o=e.seg1.getSegParam(e.par1);s=o.par,i=o.seg}else s=e.par1,i=e.seg1;return new no(n,s,e.x,t,i)}static liftIntersectionToCurves(e,t,n){return ee.liftIntersectionToCurves_(e,t,n.par0,n.par1,n.x,n.seg0,n.seg1)}static liftParameterToCurve(e,t,n){if(e==n)return t;if(!e.hasOwnProperty("segs"))return;const i=e;let s=0;for(const o of i.segs){if(o==n)return t+s;s+=ee.paramSpan(o)}throw"bug in liftParameterToCurve"}static paramSpan(e){return e.parEnd-e.parStart}static goDeeperOne(e,t){const n=e.node,i=t.node;if(e.leafBoxesOffset>q.distanceEpsilon&&t.leafBoxesOffset>q.distanceEpsilon){const a=Xt.createParallelogramNodeForCurveSeg(n.low,n.high,e.seg,e.leafBoxesOffset/2),l=Xt.createParallelogramNodeForCurveSeg(i.low,i.high,t.seg,t.leafBoxesOffset/2);return ee.curveCurveXWithParallelogramNodesOne(a,l)}if(e.leafBoxesOffset>q.distanceEpsilon){const a=Xt.createParallelogramNodeForCurveSeg(n.low,n.high,e.seg,e.leafBoxesOffset/2);return ee.curveCurveXWithParallelogramNodesOne(a,t)}if(t.leafBoxesOffset>q.distanceEpsilon){const a=Xt.createParallelogramNodeForCurveSeg(i.low,i.high,t.seg,t.leafBoxesOffset/2);return ee.curveCurveXWithParallelogramNodesOne(e,a)}const s=e.seg.value(n.low),o=e.seg.value(n.high);if(!x.closeDistEps(s,o)){const a=t.seg.value(i.low),l=t.seg.value(i.high);if(!x.closeDistEps(a,l)){const c=e.seg instanceof me?e.seg:me.mkPP(s,o),u=t.seg instanceof me?t.seg:me.mkPP(a,l),S=ee.crossWithinIntervalsWithGuess(c,u,0,1,0,1,.5,.5);if(null!=S)return ee.adjustParameters(e,c,t,u,S),ee.createIntersectionOne(e,t,S.aSol,S.bSol,S.x)}}return null}static goDeeper(e,t,n){const i=t.node,s=n.node;if(t.leafBoxesOffset>q.distanceEpsilon&&n.leafBoxesOffset>q.distanceEpsilon){const o=Xt.createParallelogramNodeForCurveSeg(i.low,i.high,t.seg,t.leafBoxesOffset/2),a=Xt.createParallelogramNodeForCurveSeg(s.low,s.high,n.seg,n.leafBoxesOffset/2);ee.curveCurveXWithParallelogramNodes(o,a,e)}else if(t.leafBoxesOffset>q.distanceEpsilon){const o=Xt.createParallelogramNodeForCurveSeg(i.low,i.high,t.seg,t.leafBoxesOffset/2);ee.curveCurveXWithParallelogramNodes(o,n,e)}else if(n.leafBoxesOffset>q.distanceEpsilon){const o=Xt.createParallelogramNodeForCurveSeg(s.low,s.high,n.seg,n.leafBoxesOffset/2);ee.curveCurveXWithParallelogramNodes(t,o,e)}else{const o=t.seg.value(i.low),a=t.seg.value(i.high);if(!x.closeDistEps(o,a)){const l=n.seg.value(s.low),c=n.seg.value(s.high);if(!x.closeDistEps(l,c)){const u=t.seg instanceof me?t.seg:me.mkPP(o,a),S=n.seg instanceof me?n.seg:me.mkPP(l,c),b=ee.crossWithinIntervalsWithGuess(u,S,0,1,0,1,.5,.5);null!=b&&(ee.adjustParameters(t,u,n,S,b),ee.addIntersection(t,n,e,b))}}}}static adjustParameters(e,t,n,i,s){if(t==e.seg||e.seg instanceof Me){const o=e.node;s.aSol=o.low+s.aSol*(o.high-o.low)}else s.aSol=e.seg.closestParameter(s.x);if(i==n.seg||n.seg instanceof Me){const o=n.node;s.bSol=o.low+s.bSol*(o.high-o.low)}else s.bSol=n.seg.closestParameter(s.x)}getSegParam(e){let t=this.parStart;for(const i of this.segs){const s=t+i.parEnd-i.parStart;if(e>=t&&e<=s)return{par:e-t+i.parStart,seg:i};t=s}const n=this.segs[this.segs.length-1];return{seg:n,par:n.parEnd}}getSegIndexParam(e){let t=0;const n=this.segs.length;for(let s=0;s<n;s++){const o=this.segs[s],a=t+o.parEnd-o.parStart;if(e>=t&&e<=a)return{segIndex:s,par:e-t+o.parStart};t=a}return{segIndex:n-1,par:this.segs[n-1].parEnd}}value(e){return function QW(r){return r.seg.value(r.par)}(this.getSegParam(e))}derivative(e){return function XW(r){return r.seg.derivative(r.par)}(this.getSegParam(e))}secondDerivative(e){return function ZW(r){return r.seg.secondDerivative(r.par)}(this.getSegParam(e))}thirdDerivative(e){return function e4(r){return r.seg.thirdDerivative(r.par)}(this.getSegParam(e))}static crossWithinIntervalsWithGuess(e,t,n,i,s,o,a,l){if(e instanceof me&&t instanceof me){const S=ee.crossTwoLineSegs(e.start,e.end,t.start,t.end,n,i,s,o);if(null!=S)return S}const c=ee.minDistWithinIntervals(e,t,n,i,s,o,a,l);if(null==c)return;const u=c.aX.sub(c.bX);return u.dot(u)>=q.distanceEpsilon?void 0:{aSol:c.aSol,bSol:c.bSol,x:x.middle(c.aX,c.bX)}}static crossTwoLineSegs(e,t,n,i,s,o,a,l){const c=t.sub(e),u=n.sub(i),S=n.sub(e),b=eu.solve(c.x,u.x,S.x,c.y,u.y,S.y);if(null==b)return;let L=b.x,F=b.y;const G=e.add(c.mul(L));return L<s-q.tolerance||(L=Math.max(L,s),L>o+q.tolerance||(L=Math.min(L,o),F<a-q.tolerance||(F=Math.max(F,a),F>l+q.tolerance)))?void 0:(F=Math.min(F,l),{aSol:L,bSol:F,x:G})}static PointRelativeToCurveLocation(e,t){if(!t.boundingBox.contains(e))return Fe.Outside;const n=2*t.boundingBox.diagonal,i=Math.PI/180;let s=0;for(let o=13;o<360;o+=13){const a=new x(Math.cos(o*i),Math.sin(o*i)),l=me.mkPP(e,e.add(a.mul(n))),c=this.getAllIntersectionsOfLineAndICurve(l,t,!0);if(ee.AllIntersectionsAreGood(c,t)){for(const S of c)if(x.closeDistEps(S.x,e))return Fe.Boundary;if(c.length%2==1?s++:s--,s>=2)return Fe.Inside;if(s<=-2)return Fe.Outside}}return Fe.Boundary}static AllIntersectionsAreGood(e,t){let i=null;if(t.hasOwnProperty("segs")||t instanceof Me&&(i=t.toCurve()),i)for(const s of e)if(!ee.RealCut(ee.DropIntersectionToSegs(s),i,!1))return!1;return!0}static RealCut(e,t,n){const s=e.seg1,a=e.par1,l=e.x,c=e.seg0.derivative(e.par0).normalize(),u=s.derivative(a).normalize().rotate(Math.PI/2);if(x.closeDistEps(l,s.end)){let b=null;for(let G=0;G<t.segs.length-1;G++)if(t.segs[G]==s){b=t.segs[G+1];break}if(null==b)return!1;const L=c.rotate(Math.PI/2);return!(L.dot(s.derivative(s.parEnd))*L.dot(b.derivative(b.parStart))<q.tolerance)}if(x.closeDistEps(l,s.start)){let b=null;for(let G=t.segs.length-1;G>0;G--)if(t.segs[G]==s){b=t.segs[G-1];break}if(null==b)return!1;const L=c.rotate(Math.PI/2);return!(L.dot(s.derivative(s.parStart))*L.dot(b.derivative(b.parEnd))<q.tolerance)}const S=c.dot(u);return n?S>q.distanceEpsilon:Math.abs(S)>q.distanceEpsilon}static realCutWithClosedCurve(e,t,n){const s=e.seg1,a=e.par1,l=e.x,c=e.seg0.derivative(e.par0).normalize(),u=s.derivative(a).normalize().rotate(Math.PI/2);if(x.closeDistEps(l,s.end)){let b=null;for(let G=0;G<t.segs.length;G++)if(t.segs[G]==s){b=t.segs[(G+1)%t.segs.length];break}if(null==b)throw new Error;const L=c.rotate(Math.PI/2);return!(L.dot(s.derivative(s.parEnd))*L.dot(b.derivative(b.parStart))<q.tolerance)}if(x.closeDistEps(l,s.start)){let b=null;for(let G=0;G<t.segs.length;G++)if(t.segs[G]==s){b=t.segs[G>0?G-1:t.segs.length-1];break}const L=c.rotate(Math.PI/2);return!(L.dot(s.derivative(s.parStart))*L.dot(b.derivative(b.parEnd))<q.tolerance)}const S=c.dot(u);return n?S>q.distanceEpsilon:Math.abs(S)>q.distanceEpsilon}static minDistWithinIntervals(e,t,n,i,s,o,a,l){const c=new qW(e,t,n,i,s,o,a,l);return c.solve(),c.success?{aSol:c.aSolution,bSol:c.bSolution,aX:c.aPoint,bX:c.bPoint}:void 0}offsetCurve(e,t){throw new Error("Method not implemented.")}get boundingBox(){if(0==this.segs.length)return Ne.mkEmpty();const e=this.segs[0].boundingBox.clone();for(let t=1;t<this.segs.length;t++)e.addRecSelf(this.segs[t].boundingBox);return e}clone(){const e=new ee;for(const t of this.segs)e.addSegment(t.clone());return e}getParameterAtLength(e){let t=0;for(const n of this.segs){const i=n.length;if(i>=e)return t+n.getParameterAtLength(e);e-=i,t+=n.parEnd-n.parStart}return this.parEnd}get length(){let e=0;for(const t of this.segs)e+=t.length;return e}transform(e){const t=new ee;for(const n of this.segs)t.addSegment(n.transform(e));return t}closestParameterWithinBounds(e,t,n){let i=0,s=Number.MAX_VALUE,o=0;for(const a of this.segs){if(o>n)break;const l=ee.paramSpan(a);if(o+l>=t){const u=Math.max(a.parStart,a.parStart+(t-o)),S=Math.min(a.parEnd,a.parStart+(n-o)),b=a.closestParameterWithinBounds(e,u,S),L=e.sub(a.value(b)),F=L.dot(L);F<s&&(i=o+b-a.parStart,s=F)}o+=l}return i}closestParameter(e){let t=0,n=Number.MAX_VALUE,i=0;for(const s of this.segs){const o=s.closestParameter(e),a=e.sub(s.value(o)),l=a.dot(a);l<n&&(t=i+o-s.parStart,n=l),i+=ee.paramSpan(s)}return t}static addLineSegment(e,t,n){return e.addSegment(me.mkPP(t,n))}static addLineSegmentCNNP(e,t,n,i){return ee.addLineSegment(e,new x(t,n),i)}static addLineSegmentCNNNN(e,t,n,i,s){ee.addLineSegment(e,new x(t,n),new x(i,s))}static continueWithLineSegmentNN(e,t,n){ee.addLineSegment(e,e.end,new x(t,n))}static continueWithLineSegmentP(e,t){ee.addLineSegment(e,e.end,t)}static closeCurve(e){return ee.continueWithLineSegmentP(e,e.start),e}leftDerivative(e){const t=this.tryToGetLeftSegment(e);return null!=t?t.derivative(t.parEnd):this.derivative(e)}rightDerivative(e){const t=this.tryToGetRightSegment(e);return null!=t?t.derivative(t.parStart):this.derivative(e)}tryToGetLeftSegment(e){if(Math.abs(e-this.parStart)<q.tolerance)return this.start.equal(this.end)?this.segs[this.segs.length-1]:null;for(const t of this.segs)if(e-=ee.paramSpan(t),Math.abs(e)<q.tolerance)return t;return null}tryToGetRightSegment(e){if(Math.abs(e-this.parEnd)<q.tolerance)return this.start==this.end?this.segs[0]:null;for(const t of this.segs){if(Math.abs(e)<q.tolerance)return t;e-=ee.paramSpan(t)}return null}static ClosestPoint(e,t){return e.value(e.closestParameter(t))}static CurveIsInsideOther(e,t){if(!t.boundingBox.containsRect(e.boundingBox))return!1;const n=ee.getAllIntersections(e,t,!0);if(0==n.length)return ee.NonIntersectingCurveIsInsideOther(e,t);if(1==n.length)return e.start.equal(n[0].x)?ee.PointRelativeToCurveLocation(e.value((e.parStart+e.parEnd)/2),t)==Fe.Inside:ee.PointRelativeToCurveLocation(e.start,t)==Fe.Inside;for(const i of ee.PointsBetweenIntersections(e,n))if(ee.PointRelativeToCurveLocation(i,t)==Fe.Outside)return!1;return!0}static*PointsBetweenIntersections(e,t){t.sort((a,l)=>a.par0<l.par0?-1:a.par0>l.par0?1:0);for(let a=0;a<t.length-1;a++)yield e.value((t[a].par0+t[a+1].par0)/2);const n=t[t.length-1].par0;let o=n+(e.parEnd-n+(t[0].par0-e.parStart))/2;o>e.parEnd&&(o=e.parStart+(o-e.parEnd)),yield e.value(o)}static NonIntersectingCurveIsInsideOther(e,t){for(let n=e.parStart;n<e.parEnd;n+=.5){const i=ee.PointRelativeToCurveLocation(e.value(n),t);if(Fe.Boundary!=i)return Fe.Inside==i}return Fe.Outside!=ee.PointRelativeToCurveLocation(e.end,t)}static ClosedCurveInteriorsIntersect(e,t){if(!t.boundingBox.intersects(e.boundingBox))return!1;const n=ee.getAllIntersections(e,t,!0);if(0==n.length)return ee.NonIntersectingCurveIsInsideOther(e,t)||ee.NonIntersectingCurveIsInsideOther(t,e);if(1==n.length)return e.start.equal(n[0].x)?ee.PointRelativeToCurveLocation(e.value((e.parStart+e.parEnd)/2),t)!=Fe.Inside&&t.start.equal(n[0].x)?ee.PointRelativeToCurveLocation(t.value((t.parStart+t.parEnd)/2),e)==Fe.Inside:ee.PointRelativeToCurveLocation(t.start,e)==Fe.Inside:ee.PointRelativeToCurveLocation(e.start,t)==Fe.Inside;for(const i of ee.PointsBetweenIntersections(e,n))if(ee.PointRelativeToCurveLocation(i,t)==Fe.Inside)return!0;return!0}curvature(e){const t=this.getSegParam(e);return t.seg.curvature(t.par)}curvatureDerivative(e){throw new Error("Not implemente")}curvatureSecondDerivative(e){throw new Error("Not implemented")}static createBezierSeg(e,t,n,i,s){const o=x.mkPoint(e,n.point,1-e,i.point),a=x.mkPoint(t,s.point,1-t,i.point),l=i.point.mul(2/3);return new jt(o,o.div(3).add(l),l.add(a.div(3)),a)}static createBezierSegN(e,t,n,i){const s=n.mul(i);return new jt(e,e.add(s),t.add(s),t)}static findCorner(e){const t=e.next;if(null==t.next)return;const n=t.next;return null!=n?{b:t,c:n}:void 0}static trimEdgeSplineWithNodeBoundaries(e,t,n,i){let s=n.parStart,o=n.parEnd;null!=e&&(s=ee.findNewStart(n,s,e,i)),null!=t&&(o=ee.findNewEnd(n,t,i,o));const a=Math.min(s,o),l=Math.max(s,o);return a<l?n.trim(a,l):n}static findNewEnd(e,t,n,i){const s=ee.getAllIntersections(e,t,!0);if(0==s.length)return e.parEnd;if(n){i=e.parEnd;for(const o of s)o.par0<i&&(i=o.par0)}else{i=e.parStart;for(const o of s)o.par0>i&&(i=o.par0)}return i}static findNewStart(e,t,n,i){const s=ee.getAllIntersections(e,n,!0);if(0!=s.length){if(i){t=e.parStart;for(const o of s)o.par0>t&&(t=o.par0)}else{t=e.parEnd;for(const o of s)o.par0<t&&(t=o.par0)}return t}t=e.parStart}static polylineAroundClosedCurve(e){if(e instanceof mt)return ee.refineEllipse(e);if(e instanceof Me)return e;if(e instanceof ee&&ee.allSegsAreLines(e)){const t=new Me;for(const n of e.segs)t.addPoint(n.start);if(t.closed=!0,!t.isClockwise())return t.reverse()}return e.boundingBox.perimeter()}static allSegsAreLines(e){for(const t of e.segs)if(!(t instanceof me))return!1;return!0}static refineEllipse(e){const t=e.boundingBox.perimeter(),n=Math.PI/4,i=e.boundingBox.width,s=e.boundingBox.height,o=Math.sqrt(i*i+s*s),a=[];for(let c=0;c<4;c++){const u=n+c*Math.PI/2,S=e.value(u),b=e.derivative(u).normalize().mul(o),L=me.mkPP(S.sub(b),S.add(b));for(const F of ee.getAllIntersections(t,L,!0))a.push(F)}a.sort((c,u)=>c.par0<u.par0?-1:c.par0>u.par0?1:0);const l=new Me;return a.forEach(c=>l.addPoint(c.x)),l.closed=!0,l}static polyFromBox(e){const t=new Me;return t.addPoint(e.leftTop),t.addPoint(e.rightTop),t.addPoint(e.rightBottom),t.addPoint(e.leftBottom),t.closed=!0,t}}function ME(r,e,t,n,i,s){let o=[];if(function t4(r,e,t,n,i,s){if(i instanceof me)return!0;for(const o of[1/3,.5,2/3])if(0==x.closeSquare(i.value(r*o+t*(1-o)),x.mkPoint(o,e,1-o,n),s))return!1;return!0}(r,e,t,n,i,s))o.push(e),o.push(n);else{const a=.5*(r+t),l=i.value(a);o=ME(r,e,a,l,i,s);const c=ME(a,l,t,n,i,s).slice(1);o=o.concat(c)}return o}class Me{constructor(){this.initIsRequired=!0,this.isClosed_=!1}RemoveStartPoint(){const e=this.startPoint.next;e.prev=null,this.startPoint=e,this.setInitIsRequired()}RemoveEndPoint(){const e=this.endPoint.prev;e.next=null,this.endPoint=e,this.setInitIsRequired()}setInitIsRequired(){this.initIsRequired=!0}addPointXY(e,t){this.addPoint(new x(e,t))}isClockwise(){return x.getTriangleOrientation(this.startPoint.point,this.startPoint.next.point,this.startPoint.next.next.point)==Ie.Clockwise}addPoint(e){const t=new Pr;t.polyline=this,t.point=e.clone(),null!=this.endPoint?(this.endPoint.next=t,t.prev=this.endPoint,this.endPoint=t):this.startPoint=this.endPoint=t,this.setInitIsRequired()}PrependPoint(e){const t=Pr.mkFromPoint(e);t.polyline=this,null!=this.startPoint?x.closeDistEps(e,this.startPoint.point)||(this.startPoint.prev=t,t.next=this.startPoint,this.startPoint=t):(this.endPoint=t,this.startPoint=t),this.setInitIsRequired()}*[Symbol.iterator](){for(let e=this.startPoint;null!=e;e=e.next)yield e.point}*polylinePoints(){for(let e=this.startPoint;null!=e;e=e.next)yield e}*skip(e){for(let t=this.startPoint;null!=t;t=t.next)e>0?e--:yield t}static parallelogramOfLineSeg(e,t){const n=t.sub(e).div(2);return lt.parallelogramByCornerSideSide(e,n,n)}static mkFromPoints(e){const t=new Me;for(const n of e)t.addPoint(n);return t}static mkClosedFromPoints(e){const t=Me.mkFromPoints(e);return t.closed=!0,t}calculatePbNode(){const e=[],t=[];let n=this.startPoint,i=0;for(;null!=n.next;){const s=Me.parallelogramOfLineSeg(n.point,n.next.point);e.push(s),t.push({parallelogram:s,seg:this,leafBoxesOffset:0,node:{low:i,high:i+1,chord:me.mkPP(n.point,n.next.point)}}),n=n.next,i++}if(this.isClosed_){const s=Me.parallelogramOfLineSeg(this.endPoint.point,this.startPoint.point);e.push(s),t.push({parallelogram:s,seg:this,leafBoxesOffset:0,node:{low:i,high:i+1,chord:me.mkPP(this.endPoint.point,this.startPoint.point)}})}this.pBNode={parallelogram:lt.getParallelogramOfAGroup(e),seg:this,leafBoxesOffset:0,node:{children:t}}}init(){this.bBox=Ne.rectangleOnPoint(this.startPoint.point);for(const e of this.skip(1))this.bBox.add(e.point);this.updateCount(),this.calculatePbNode(),this.initIsRequired=!1}updateCount(){this.count_=0;for(let e=this.startPoint;null!=e;e=e.next)this.count_++}get count(){return this.initIsRequired&&this.init(),this.count_}get closed(){return this.isClosed_}set closed(e){this.isClosed_=e}value(e){this.initIsRequired&&this.init();const t=this.getAdjustedParamAndStartEndPoints(e);return x.convSum(t.t,t.a,t.b)}getAdjustedParamAndStartEndPoints(e){let t=this.startPoint;for(;null!=t.next;){if(e<=1)return{a:t.point,b:t.next.point,t:e};t=t.next,e-=1}if(this.closed&&e<=1)return{a:this.endPoint.point,b:this.startPoint.point,t:e};throw new Error("out of the parameter domain")}derivative(e){const t=this.getAdjustedParamAndStartEndPoints(e);return t.b.sub(t.a)}secondDerivative(e){return new x(0,0)}thirdDerivative(e){return new x(0,0)}pNodeOverICurve(){return this.initIsRequired&&this.init(),this.pBNode}get boundingBox(){return this.initIsRequired&&this.init(),this.bBox}get parStart(){return 0}get parEnd(){return this.initIsRequired&&this.init(),this.closed?this.count_:this.count_-1}static polylineFromCurve(e){const t=new Me;t.addPoint(e.start);for(const n of e.segs)t.addPoint(n.end);return t.closed=e.start==e.end,t}trim(e,t){let n=this.toCurve();return n=n.trim(e,t),Me.polylineFromCurve(n)}trimWithWrap(e,t){throw new Error("Method not implemented.")}translate(e){let t=this.startPoint;for(;t.point=t.point.add(e),t!=this.endPoint;)t=t.getNext();this.setInitIsRequired()}scaleFromOrigin(e,t){throw new Error("Method not implemented.")}get start(){return this.startPoint.point}get end(){return this.endPoint.point}reverse(){const e=new Me;e.closed=this.closed;let t=this.endPoint;for(;e.addPoint(t.point),t!=this.startPoint;)t=t.getPrev();return e}offsetCurve(e,t){throw new Error("Method not implemented.")}lengthPartial(e,t){throw new Error("Method not implemented.")}get length(){throw new Error("Method not implemented.")}getParameterAtLength(e){throw new Error("Method not implemented.")}transform(e){const t=new Me;for(const n of this.polylinePoints())t.addPoint(e.multiplyPoint(n.point));return t.closed=this.closed,t}closestParameterWithinBounds(e,t,n){throw new Error("Method not implemented.")}closestParameter(e){let t=0,n=Number.MAX_VALUE,i=0,s=this.startPoint;for(;null!=s.next;){const o=me.mkPP(s.point,s.next.point),a=o.closestParameter(e),l=o.value(a).sub(e),c=l.dot(l);c<n&&(n=c,t=a+i),s=s.next,i++}if(this.closed){const o=me.mkPP(this.endPoint.point,this.startPoint.point),a=o.closestParameter(e),l=o.value(a).sub(e);l.dot(l)<n&&(t=a+i)}return t}clone(){const e=new Me;e.closed=this.closed;let t=this.startPoint;for(;e.addPoint(t.point),t!=this.endPoint;)t=t.getNext();return e}leftDerivative(e){throw new Error("Method not implemented.")}rightDerivative(e){throw new Error("Method not implemented.")}curvature(e){throw new Error("Method not implemented.")}curvatureDerivative(e){throw new Error("Method not implemented.")}curvatureSecondDerivative(e){throw new Error("Method not implemented.")}next(e){var t;return null!==(t=e.next)&&void 0!==t?t:this.closed?this.startPoint:null}prev(e){var t;return null!==(t=e.prev)&&void 0!==t?t:this.closed?this.endPoint:null}toCurve(){const e=new ee;ee.addLineSegment(e,this.startPoint.point,this.startPoint.next.point);let t=this.startPoint.next;for(;null!=(t=t.next);)ee.continueWithLineSegmentP(e,t.point);return this.closed&&ee.continueWithLineSegmentP(e,this.startPoint.point),e}}class tu{constructor(e,t){this.width=e,this.height=t}pad(e){this.width+=2*e}}class Ne{constructor(e){this.left_=e.left,this.right_=e.right,this.top_=e.top,this.bottom=e.bottom}static mkSizeCenter(e,t){const n=e.width/2,i=e.height/2;return new Ne({left:t.x-n,right:t.x+n,bottom:t.y-i,top:t.y+i})}add_rect(e){return this.addRec(e)}contains_point(e){return this.contains(e)}contains_rect(e){return this.containsRect(e)}intersection_rect(e){return this.intersection(e)}intersects_rect(e){return this.intersects(e)}unite(e){return Ne.rectangleOfTwo(this,e)}contains_point_radius(e,t){return this.containsWithPadding(e,t)}intersects(e){return this.intersectsOnX(e)&&this.intersectsOnY(e)}intersection(e){if(!this.intersects(e)){const o=Ne.mkEmpty();return o.setToEmpty(),o}const t=Math.max(this.left,e.left),n=Math.min(this.right,e.right),i=Math.max(this.bottom,e.bottom),s=Math.min(this.top,e.top);return new Ne({left:t,bottom:i,right:n,top:s})}get center(){return this.leftTop.add(this.rightBottom).mul(.5)}set center(e){const t=e.sub(this.center);this.leftTop=this.leftTop.add(t),this.rightBottom=this.rightBottom.add(t)}intersectsOnY(e){return!(e.bottom_>this.top_+q.distanceEpsilon||e.top_<this.bottom_-q.distanceEpsilon)}intersectsOnX(e){return!(e.left>this.right_+q.distanceEpsilon||e.right<this.left_-q.distanceEpsilon)}static mkEmpty(){return new Ne({left:0,right:-1,bottom:0,top:-1})}get left(){return this.left_}set left(e){this.left_=e}get right(){return this.right_}set right(e){this.right_=e}get top(){return this.top_}set top(e){this.top_=e}get bottom(){return this.bottom_}set bottom(e){this.bottom_=e}get leftBottom(){return new x(this.left_,this.bottom_)}set leftBottom(e){this.left_=e.x,this.bottom=e.y}get rightTop(){return new x(this.right_,this.top_)}set rightTop(e){this.right_=e.x,this.top_=e.y}get leftTop(){return new x(this.left_,this.top_)}set leftTop(e){this.left_=e.x,this.top_=e.y}get rightBottom(){return new x(this.right_,this.bottom_)}set rightBottom(e){this.right_=e.x,this.bottom=e.y}static mkPP(e,t){const n=new Ne({left:e.x,right:e.x,top:e.y,bottom:e.y});return n.add(t),n}static rectangleOnPoint(e){return new Ne({left:e.x,right:e.x,top:e.y,bottom:e.y})}static rectangleFromLeftBottomAndSize(e,t,n){return new Ne({left:e,right:e+n.x,top:t+n.y,bottom:t})}static getRectangleOnCoords(e,t,n,i){const s=new Ne({left:e,bottom:t,right:e,top:t});return s.add(new x(n,i)),s}static mkOnPoints(e){const t=Ne.mkEmpty();for(const n of e)t.add(n);return t}static rectangleOnRectangles(e){const t=Ne.mkEmpty();for(const n of e)t.addRecSelf(n);return t}get width(){return this.right_-this.left_}set width(e){const t=e/2,n=(this.left_+this.right_)/2;this.left_=n-t,this.right_=n+t}isEmpty(){return this.width<0}setToEmpty(){this.left=0,this.right=-1}get height(){return this.top_-this.bottom_}set height(e){const t=e/2,n=(this.top_+this.bottom_)/2;this.top_=n+t,this.bottom=n-t}static rectangleOfTwo(e,t){const n=new Ne({left:e.left_,right:e.right_,top:e.top_,bottom:e.bottom_});return n.addRecSelf(t),n}containsWithPadding(e,t){return this.left_-t-q.distanceEpsilon<=e.x&&e.x<=this.right_+t+q.distanceEpsilon&&this.bottom_-t-q.distanceEpsilon<=e.y&&e.y<=this.top_+t+q.distanceEpsilon}get area(){return(this.right_-this.left_)*(this.top_-this.bottom_)}add(e){this.isEmpty()?(this.left_=this.right_=e.x,this.top_=this.bottom=e.y):(this.left_>e.x&&(this.left_=e.x),this.top_<e.y&&(this.top_=e.y),this.right_<e.x&&(this.right_=e.x),this.bottom_>e.y&&(this.bottom=e.y))}addWithCheck(e){let t,n;return(t=e.x<this.left_)?this.left_=e.x:(t=this.right_<e.x)&&(this.right_=e.x),(n=e.y>this.top_)?this.top_=e.y:(n=this.bottom_>e.y)&&(this.bottom=e.y),t||n}addRecSelf(e){this.add(e.leftTop),this.add(e.rightBottom)}addRec(e){const t=this.clone();return t.add(e.leftTop),t.add(e.rightBottom),t}static translate(e,t){const n=e.clone();return n.center=e.center.add(t),n}contains(e){return this.containsWithPadding(e,0)}containsRect(e){return this.contains(e.leftTop)&&this.contains(e.rightBottom)}get diagonal(){return Math.sqrt(this.width*this.width+this.height*this.height)}padWidth(e){this.left-=e,this.right+=e}padHeight(e){this.top+=e,this.bottom-=e}pad(e){return e<-this.width/2&&(e=-this.width/2),e<-this.height/2&&(e=-this.height/2),this.padWidth(e),this.padHeight(e),this}padEverywhere(e){this.left-=e.left,this.right+=e.right,this.bottom-=e.bottom,this.top+=e.top}static intersect(e,t){return e.intersects(t)?Ne.mkPP(new x(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom)),new x(Math.min(e.right,t.right),Math.min(e.top,t.top))):Ne.mkEmpty()}perimeter(){const e=new Me;return e.addPoint(this.leftTop),e.addPoint(this.rightTop),e.addPoint(this.rightBottom),e.addPoint(this.leftBottom),e.closed=!0,e}scaleAroundCenter(e){this.width=this.width*e,this.height=this.height*e}clone(){return Ne.mkPP(this.leftTop,this.rightBottom)}get size(){return new tu(this.width,this.height)}set size(e){this.width=e.width,this.height=e.height}static creatRectangleWithSize(e,t){const n=e.width/2,o=e.height/2;return new Ne({left:t.x-n,right:t.x+n,top:t.y+o,bottom:t.y-o})}addPointWithSize(e,t){const n=e.width/2,i=e.height/2;this.add(new x(t.x-n,t.y-i)),this.add(new x(t.x+n,t.y-i)),this.add(new x(t.x-n,t.y+i)),this.add(new x(t.x+n,t.y+i))}}class An{constructor(e){this.entity=e,this.bind()}bind(){this.entity&&this.entity.setAttr(0,this)}static getGeom(e){return e.getAttr(0)}}class Rn{constructor(e,t,n,i,s,o){this.elements=[[e,t,n],[i,s,o]]}get Elements(){return this.elements}getElem(e,t){return this.elements[e][t]}setElem(e,t,n){this.elements[e][t]=n}static Divide(e,t){return e.multiply(t.inverse())}isIdentity(){return nt(this.elements[0][0],1)&&nt(this.elements[0][1],0)&&nt(this.elements[0][2],0)&&nt(this.elements[1][0],0)&&nt(this.elements[1][1],1)&&nt(this.elements[1][2],0)}offset(){return new x(this.getElem(0,2),this.getElem(1,2))}static getIdentity(){return new Rn(1,0,0,0,1,0)}static rotation(e){const t=Math.cos(e),n=Math.sin(e);return new Rn(t,-n,0,n,t,0)}static scaleAroundCenterTransformation(e,t,n){return new Rn(e,0,(1-e)*n.x,0,t,(1-t)*n.y)}multiplyPoint(e){return new x(this.getElem(0,0)*e.x+this.getElem(0,1)*e.y+this.getElem(0,2),this.getElem(1,0)*e.x+this.getElem(1,1)*e.y+this.getElem(1,2))}multiply(e){return null!=e?new Rn(this.getElem(0,0)*e.getElem(0,0)+this.getElem(0,1)*e.getElem(1,0),this.getElem(0,0)*e.getElem(0,1)+this.getElem(0,1)*e.getElem(1,1),this.getElem(0,0)*e.getElem(0,2)+this.getElem(0,1)*e.getElem(1,2)+this.getElem(0,2),this.getElem(1,0)*e.getElem(0,0)+this.getElem(1,1)*e.getElem(1,0),this.getElem(1,0)*e.getElem(0,1)+this.getElem(1,1)*e.getElem(1,1),this.getElem(1,0)*e.getElem(0,2)+this.getElem(1,1)*e.getElem(1,2)+this.getElem(1,2)):null}inverse(){const e=this.getElem(0,0)*this.getElem(1,1)-this.getElem(1,0)*this.getElem(0,1),t=this.getElem(1,1)/e,n=-this.getElem(0,1)/e,i=-this.getElem(1,0)/e,s=this.getElem(0,0)/e,o=-t*this.getElem(0,2)-n*this.getElem(1,2),a=-i*this.getElem(0,2)-s*this.getElem(1,2);return new Rn(t,n,o,i,s,a)}}var oe=(()=>{return(r=oe||(oe={}))[r.None=0]="None",r[r.North=1]="North",r[r.East=2]="East",r[r.South=4]="South",r[r.West=8]="West",oe;var r})();class de{static get DifferenceEpsilon(){return de.differenceEpsilon}static EqualPP(e,t){return de.Equal(e.x,t.x)&&de.Equal(e.y,t.y)}static Equal(e,t){return 0==de.Compare(e,t)}static Compare(e,t){let n=0;return e+de.DifferenceEpsilon<t?n=-1:t+de.DifferenceEpsilon<e&&(n=1),n}static ComparePP(e,t){let n=de.Compare(e.x,t.x);return 0==n&&(n=de.Compare(e.y,t.y)),n}static LessOrEqual(e,t){const n=de.Compare(e,t);return n<0||0==n}static Less(e,t){return de.Compare(e,t)<0}static GetDirections(e,t){return Ae.DirectionFromPointToPoint(e,t)}static IsPureDirection(e,t){return Ae.IsPureDirection(de.GetDirections(e,t))}static IsPureDirectionD(e){return Ae.IsPureDirection(e)}static IsPureLower(e,t){const n=de.GetDirections(e,t);return oe.East==n||oe.North==n}static GetPureDirectionVV(e,t){return de.GetDirections(e.point,t.point)}}de.differenceEpsilon=q.distanceEpsilon/2;class Ae{constructor(e){this.Dir=e}get Right(){return new Ae(Ae.RotateRight(this.Dir))}static RotateRight(e){switch(e){case oe.North:return oe.East;case oe.East:return oe.South;case oe.South:return oe.West;case oe.West:return oe.North;default:throw new Error}}static RotateLeft(e){switch(e){case oe.North:return oe.West;case oe.West:return oe.South;case oe.South:return oe.East;case oe.East:return oe.North;default:throw new Error}}static ToIndex(e){switch(e){case oe.North:return 0;case oe.East:return 1;case oe.South:return 2;case oe.West:return 3;default:throw new Error}}static VectorDirection(e){let t=oe.None;return e.x>de.DifferenceEpsilon?t=oe.East:e.x<-de.DifferenceEpsilon&&(t=oe.West),e.y>de.DifferenceEpsilon?t|=oe.North:e.y<-de.DifferenceEpsilon&&(t|=oe.South),t}static VectorDirectionPP(e,t){let n=oe.None;const i=t.x-e.x,s=t.y-e.y;return i>de.DifferenceEpsilon?n=oe.East:-i>de.DifferenceEpsilon&&(n=oe.West),s>de.DifferenceEpsilon?n|=oe.North:-s>de.DifferenceEpsilon&&(n|=oe.South),n}static DirectionFromPointToPoint(e,t){return Ae.VectorDirectionPP(e,t)}static OppositeDir(e){switch(e){case oe.North:return oe.South;case oe.West:return oe.East;case oe.South:return oe.North;case oe.East:return oe.West;default:return oe.None}}static IsPureDirection(e){switch(e){case oe.North:case oe.East:case oe.South:case oe.West:return!0;default:return!1}}static IsPureDirectionPP(e,t){return Ae.IsPureDirection(Ae.DirectionFromPointToPoint(e,t))}static DirectionsAreParallel(e,t){return e==t||e==Ae.OppositeDir(t)}ToPoint(){let e=0,t=0;return(this.Dir&oe.East)==oe.East&&e++,(this.Dir&oe.North)==oe.North&&t++,(this.Dir&oe.West)==oe.West&&e--,(this.Dir&oe.South)==oe.South&&t--,new x(e,t)}static toPoint(e){return new Ae(e).ToPoint()}static negate(e){return new Ae(Ae.OppositeDir(e.Dir))}}let tr=(()=>{class r{static createHexagon(t,n,i){const s=n/2,o=t/2,a=i.x,l=i.y;return Me.mkClosedFromPoints([new x(-1*o+a,-1*s+l),new x(o+a,-1*s+l),new x(o+(s+a),0+l),new x(o+a,s+l),new x(-1*o+a,s+l),new x(-1*(o-s)+a,0+l)])}static createOctagon(t,n,i){const s=t/2,o=n/2,a=new Array(8);a[0]=new x(s+r.octagonPad*s,o-o*r.octagonPad),a[3]=new x(-1*a[0].x,a[0].y),a[4]=new x(a[3].x,-1*a[3].y),a[7]=new x(a[0].x,-1*a[0].y),a[1]=new x(s-s*r.octagonPad,o+o*r.octagonPad),a[2]=new x(-1*a[1].x,a[1].y),a[6]=new x(a[1].x,-1*a[1].y),a[5]=new x(a[2].x,-1*a[2].y);for(let l=0;l<8;l++)a[l]=a[l].add(i);return Me.mkClosedFromPoints(a)}static createInvertedHouse(t,n,i){const s=r.createHouse(t,n,i);return r.rotateCurveAroundCenterByDegree(s,i,180)}static createHouse(t,n,i){const s=t/2,o=n/2,a=i.x,l=i.y,c=new ee;return ee.addLineSegmentCNNNN(c,a-s,l-o,a+s,l-o),ee.continueWithLineSegmentNN(c,a+s,l+o),ee.continueWithLineSegmentNN(c,a,l+2*o),ee.continueWithLineSegmentNN(c,a-s,l+o),ee.closeCurve(c)}static CreateDiamond(t,n,i){const s=t,o=n,a=i.x,l=i.y,c=new ee,u=[new x(a,l-o),new x(a+s,l),new x(a,l+o),new x(a-s,l)];return c.addSegs([me.mkPP(u[0],u[1]),me.mkPP(u[1],u[2]),me.mkPP(u[2],u[3]),me.mkPP(u[3],u[0])]),c}static rotateCurveAroundCenterByDegree(t,n,i){return r.rotateCurveAroundCenterByRadian(t,n,i*Math.PI/180)}static rotateCurveAroundCenterByRadian(t,n,i){const s=Math.cos(i),o=Math.sin(i),a=new Rn(1,0,n.x,0,1,n.y).multiply(new Rn(s,-o,0,o,s,0)).multiply(new Rn(1,0,-n.x,0,1,-n.y));return t.transform(a)}static mkCircle(t,n){return mt.mkCircle(t,n)}static createRectangle(t,n,i){const s=t/2,o=n/2,a=i.x,l=i.y,c=new ee,u=[new x(a-s,l-o),new x(a+s,l-o),new x(a+s,l+o),new x(a-s,l+o)];return c.addSegs([me.mkPP(u[0],u[1]),me.mkPP(u[1],u[2]),me.mkPP(u[2],u[3]),me.mkPP(u[3],u[0])]),c}static isRoundedRect(t){if(!(t instanceof ee))return;const n=t.segs;if(8!=n.length&&4!=n.length)return;const i=8==n.length;let s,o;for(let a=0;a<4;a++){const l=i?2*a+1:a;if(0==a){if(!(n[l]instanceof mt))return;const c=n[l];s=c.aAxis.length,o=c.bAxis.length}else{if(!(n[l]instanceof mt))return;const c=n[l];if(s!=c.aAxis.length||o!=c.bAxis.length)return}}return{radX:s,radY:o}}static mkRectangleWithRoundedCorners(t,n,i,s,o=new x(0,0)){if(0==i||0==s)return r.createRectangle(t,n,o);const a=new ee,l=t/2;i>l/2&&(i=l/2);const c=n/2;s>c/2&&(s=c/2);const u=o.x,S=o.y,b=l-i,L=c-s,F=S+c,G=S-c,J=u-l,te=u+l,ie=new x(i,0),he=new x(0,s);return b>0&&a.addSegment(me.mkPP(new x(u-b,G),new x(u+b,G))),a.addSegment(mt.mkEllipse(1.5*Math.PI,2*Math.PI,ie,he,u+b,S-L)),L>0&&a.addSegment(me.mkPP(new x(te,S-L),new x(te,S+L))),a.addSegment(mt.mkEllipse(0,.5*Math.PI,ie,he,u+b,S+L)),b>0&&a.addSegment(me.mkPP(new x(u+b,F),new x(u-b,F))),a.addSegment(mt.mkEllipse(.5*Math.PI,Math.PI,ie,he,u-b,S+L)),L>0&&a.addSegment(me.mkPP(new x(J,S+L),new x(J,S-L))),a.addSegment(mt.mkEllipse(Math.PI,1.5*Math.PI,ie,he,u-b,S-L)),a}}return r.octagonPad=1/4,r})(),_E=(()=>{class r extends An{constructor(){super(...arguments),this.padding=1}get node(){return this.entity}get boundaryCurve(){return this._boundaryCurve}set boundaryCurve(t){(null!=t&&t.boundingBox.height<r.minHeight||t.boundingBox.width<r.minWidth)&&(t=tr.mkCircle(r.minWidth,t.boundingBox.center)),this._boundaryCurve=t}get id(){return this.node.id}toString(){return this.id}static mkNode(t,n){const i=new r(n);return i.boundaryCurve=t,i}get center(){return this.boundaryCurve.boundingBox.center}set center(t){const n=t.sub(this.center);this.boundaryCurve.translate(n)}fitBoundaryCurveToTarget(t){if(null!=this.boundaryCurve){const n=tr.isRoundedRect(this.boundaryCurve);null==n?(this.boundaryCurve=this.boundaryCurve.scaleFromOrigin(t.width/this.boundaryCurve.boundingBox.width,t.height/this.boundaryCurve.boundingBox.height),this.boundaryCurve.translate(t.center.sub(this.boundaryCurve.boundingBox.center))):this.boundaryCurve=tr.mkRectangleWithRoundedCorners(t.width,t.height,n.radX,n.radY,t.center)}}*inEdges(){for(const t of this.node.inEdges)yield An.getGeom(t)}*outEdges(){for(const t of this.node.outEdges)yield An.getGeom(t)}*selfEdges(){for(const t of this.node.selfEdges)yield An.getGeom(t)}get boundingBox(){return this.boundaryCurve?this.boundaryCurve.boundingBox:null}set boundingBox(t){!this.boundaryCurve||(Math.abs(t.width-this.width)<1e-4&&Math.abs(t.height-this.height)<1e-4?this.center=t.center:this.fitBoundaryCurveToTarget(t))}get width(){return this.boundaryCurve.boundingBox.width}get height(){return this.boundaryCurve.boundingBox.height}transform(t,n=!0){null!=this.boundaryCurve&&(this.boundaryCurve=this.boundaryCurve.transform(t))}underCollapsedCluster(){return null!=this.node&&this.node.isUnderCollapsedGraph()}}return r.minHeight=2,r.minWidth=3,r})();class Bt{constructor(){this.previouisBezierCoefficient=.5,this.nextBezierCoefficient=.5,this.previousTangentCoefficient=1/3,this.nextTangentCoefficient=1/3}static mkSiteP(e){const t=new Bt;return t.point=e,t}static mkSiteSP(e,t){const n=new Bt;return n.point=t,n.prev=e,e.next=n,n}static mkSiteSPS(e,t,n){const i=new Bt;return i.prev=e,i.point=t,i.next=n,e.next=i,n.prev=i,i}get turn(){return null==this.next||null==this.prev?0:x.getTriangleOrientation(this.prev.point,this.point,this.next.point)}clone(){const e=new Bt;return e.previouisBezierCoefficient=this.previouisBezierCoefficient,e.point=this.point,e}}class wn{constructor(e){this.headSite=e}static mkFromPoints(e){let t=null,n=null;for(const i of e)if(null==n)n=Bt.mkSiteP(i),t=new wn(n);else{const s=Bt.mkSiteP(i);s.prev=n,n.next=s,n=s}return t}clone(){let n,e=this.headSite,t=null,i=null;for(;null!=e;)n=e.clone(),n.prev=t,null!=t?t.next=n:i=n,e=e.next,t=n;return new wn(i)}get lastSite(){let e=this.headSite;for(;null!=e.next;)e=e.next;return e}*getSegments(){let e=this.headSite,t=e.next;for(;null!=t;)yield me.mkPP(e.point,t.point),e=t,t=t.next}*[Symbol.iterator](){let e=this.headSite;for(;null!=e;)yield e.point,e=e.next}createCurve(){const e=new ee;let t=this.headSite;for(;;){const i=ee.findCorner(t);if(null==i)break;const s=wn.createBezierSegOnSite(i.b);0==e.segs.length?x.closeDistEps(t.point,s.start)||ee.addLineSegment(e,t.point,s.start):x.closeDistEps(e.end,s.start)||ee.continueWithLineSegmentP(e,s.start),e.addSegment(s),t=i.b}return 0==e.segs.length?x.closeDistEps(t.point,t.next.point)?e.segs.push(new jt(t.point,t.point.add(new x(5,5)),t.point.add(new x(-5,5)),(void 0).point)):ee.addLineSegment(e,t.point,t.next.point):x.closeDistEps(e.end,t.next.point)||ee.continueWithLineSegmentP(e,t.next.point),e}static createBezierSegOnSite(e){const t=e.previouisBezierCoefficient,n=e.nextBezierCoefficient,s=e.next,o=e.prev.point.mul(t).add(e.point.mul(1-t)),a=s.point.mul(n).add(e.point.mul(1-n)),l=o.mul(e.previousTangentCoefficient).add(e.point.mul(1-e.previousTangentCoefficient)),c=a.mul(e.nextTangentCoefficient).add(e.point.mul(1-e.nextTangentCoefficient));return jt.mkBezier([o,l,c,a])}}let ro=(()=>{class r{constructor(){this.length=r.defaultArrowheadLength,this.width=0}clone(){const t=new r;return t.length=this.length,t.width=this.width,t.tipPosition=this.tipPosition,t}static calculateArrowheads(t){if(null==t.sourceArrowhead&&null==t.targetArrowhead)return!0;const n=r.findTrimStartForArrowheadAtSource(t);if(null==n)return!1;const i=r.findTrimEndForArrowheadAtTarget(t);if(null==i||n>i-q.intersectionEpsilon||ee.closeIntersectionPoints(t.curve.value(n),t.curve.value(i)))return!1;const s=t.curve.trim(n,i);return null!=s&&(null!=t.sourceArrowhead&&(t.sourceArrowhead.tipPosition=t.curve.start),null!=t.targetArrowhead&&(t.targetArrowhead.tipPosition=t.curve.end),t.curve=s,!0)}static getIntersectionsWithArrowheadCircle(t,n,i){const s=mt.mkFullEllipseNNP(n,n,i);return ee.getAllIntersections(s,t,!0)}static findTrimEndForArrowheadAtTarget(t){const n=q.distanceEpsilon*q.distanceEpsilon;let i=t.curve.parEnd;if(null==t.targetArrowhead||t.targetArrowhead.length<=q.distanceEpsilon)return i;const s=t.curve;let a,l,o=t.targetArrowhead.length,c=10;do{if(c--,0==c)return;l=r.getIntersectionsWithArrowheadCircle(s,o,s.end),i=0!=l.length?Math.max(...l.map(u=>u.par1)):s.parEnd,a=t.curve.value(i),o/=2}while(a.sub(s.start).lengthSquared<n||0==l.length);return i}static findTrimStartForArrowheadAtSource(t){if(null==t.sourceArrowhead||t.sourceArrowhead.length<=q.distanceEpsilon)return t.curve.parStart;const n=q.distanceEpsilon*q.distanceEpsilon;let s,i=t.sourceArrowhead.length;const o=t.curve;let a,c,l=10;for(;--l>0;){if(a=r.getIntersectionsWithArrowheadCircle(o,i,o.start),0==a.length)return o.parStart;if(c=Math.min(...a.map(u=>u.par1)),s=a.filter(u=>u.par1==c)[0].x,s.sub(o.end).lengthSquared>=n)return c;i/=2}}static trimSplineAndCalculateArrowheads(t,n,i){return r.trimSplineAndCalculateArrowheadsII(t,t.source.boundaryCurve,t.target.boundaryCurve,n,i)}static trimSplineAndCalculateArrowheadsII(t,n,i,s,o){if(t.curve=ee.trimEdgeSplineWithNodeBoundaries(n,i,s,o),null==t.curve)return!1;if((null==t.sourceArrowhead||t.sourceArrowhead.length<q.distanceEpsilon)&&(null==t.targetArrowhead||t.targetArrowhead.length<q.distanceEpsilon))return!0;let a=!1;const l=null!=t.sourceArrowhead?t.sourceArrowhead.length:0,c=null!=t.targetArrowhead?t.targetArrowhead.length:0,u=t.curve.end.sub(t.curve.start).length;null!=t.sourceArrowhead&&(t.sourceArrowhead.length=Math.min(u,l)),null!=t.targetArrowhead&&(t.targetArrowhead.length=Math.min(u,c));let S=10;for(;(null!=t.sourceArrowhead&&t.sourceArrowhead.length>q.intersectionEpsilon||null!=t.targetArrowhead&&t.targetArrowhead.length>q.intersectionEpsilon)&&!a&&(a=r.calculateArrowheads(t),a||(null!=t.sourceArrowhead&&(t.sourceArrowhead.length*=.5),null!=t.targetArrowhead&&(t.targetArrowhead.length*=.5)),S--,0!=S););return a||(null!=t.sourceArrowhead&&(t.sourceArrowhead.tipPosition=s.start),null!=t.targetArrowhead&&(t.targetArrowhead.tipPosition=s.end)),null!=t.sourceArrowhead&&(t.sourceArrowhead.length=l),null!=t.targetArrowhead&&(t.targetArrowhead.length=c),a}static createBigEnoughSpline(t){const n=t.source.center;let i=t.target.center;const s=i.sub(n);let a;s.length<.001?(a=new x(1,0),i=n.add(a.rotate(Math.PI/2))):a=s.rotate(Math.PI/2);let l=1;null!=t.sourceArrowhead&&(l+=t.sourceArrowhead.length),null!=t.targetArrowhead&&(l+=t.targetArrowhead.length),a=a.normalize().mul(1.5*l);for(let c=1;c<1e4;c*=2){const u=ee.createBezierSegN(n,i,a,c);if(r.trimSplineAndCalculateArrowheadsII(t,t.source.boundaryCurve,t.target.boundaryCurve,u,!1))return}r.createEdgeCurveWithNoTrimming(t,n,i)}static createEdgeCurveWithNoTrimming(t,n,i){const s=i.sub(n).normalize();let o=n,a=i;const l=t.targetArrowhead;null!=l&&(l.tipPosition=i,a=i.sub(s.mul(l.length)));const c=t.sourceArrowhead;null!=c&&(c.tipPosition=n,o=n.add(s.mul(c.length))),t.curve=me.mkPP(o,a)}}return r.defaultArrowheadLength=5,r})();class io extends An{constructor(e){super(e),this.targetArrowhead=new ro,this.lineWidth=1}get sourcePort(){return this._sourcePort}set sourcePort(e){this._sourcePort=e}get targetPort(){return this._targetPort}set targetPort(e){this._targetPort=e}Translate(e){if(0!=e.x||0!=e.y){if(null!=this.curve&&this.curve.translate(e),null!=this.smoothedPolyline)for(let t=this.smoothedPolyline.headSite,n=this.smoothedPolyline.headSite;null!=t;t=t.next,n=n.next)t.point=n.point.add(e);null!=this.sourceArrowhead&&(this.sourceArrowhead.tipPosition=this.sourceArrowhead.tipPosition.add(e)),null!=this.targetArrowhead&&(this.targetArrowhead.tipPosition=this.targetArrowhead.tipPosition.add(e))}}GetMaxArrowheadLength(){let e=0;return null!=this.sourceArrowhead&&(e=this.sourceArrowhead.length),null!=this.targetArrowhead&&this.targetArrowhead.length>e?this.targetArrowhead.length:e}transform(e){if(null!=this.curve){if(this.curve=this.curve.transform(e),null!=this.underlyingPolyline)for(let t=this.underlyingPolyline.headSite,n=this.underlyingPolyline.headSite;null!=t;t=t.next,n=n.next)t.point=e.multiplyPoint(t.point);null!=this.sourceArrowhead&&(this.sourceArrowhead.tipPosition=e.multiplyPoint(this.sourceArrowhead.tipPosition)),null!=this.targetArrowhead&&(this.targetArrowhead.tipPosition=e.multiplyPoint(this.targetArrowhead.tipPosition)),null!=this.label&&(this.label.center=e.multiplyPoint(this.label.center))}}get labelBBox(){return this.label.boundingBox}get edge(){return this.entity}get source(){return An.getGeom(this.edge.source)}get boundingBox(){const e=Ne.mkEmpty();if(null!=this.underlyingPolyline)for(const n of this.underlyingPolyline)e.add(n);null!=this.curve&&e.addRecSelf(this.curve.boundingBox),null!=this.sourceArrowhead&&e.add(this.sourceArrowhead.tipPosition),null!=this.targetArrowhead&&e.add(this.targetArrowhead.tipPosition),this.edge.label&&e.addRecSelf(this.label.boundingBox);const t=this.lineWidth;return e.left-=t,e.top+=t,e.right+=t,e.bottom-=t,e}isInterGraphEdge(){return this.edge.isInterGraphEdge()}get target(){return An.getGeom(this.edge.target)}toString(){return this.source.toString()+"->"+this.target}static RouteSelfEdge(e,t,n){const i=e.boundingBox.width,s=e.boundingBox.height,o=e.boundingBox.center,a=new x(o.x-i/4,o.y),l=new x(o.x-i/4,o.y-s/2-t),c=new x(o.x+i/4,o.y-s/2-t),u=new x(o.x+i/4,o.y);return n.smoothedPolyline=wn.mkFromPoints([a,l,c,u]),n.smoothedPolyline.createCurve()}underCollapsedCluster(){return this.source.underCollapsedCluster()||this.target.underCollapsedCluster()}EdgeToAncestor(){return this.edge.EdgeToAncestor()}}class Zt{constructor(e){this.cancelToken=e}ProgressStep(){}}class nu{}nu.GoldenRatio=(1+Math.sqrt(5))/2,nu.GoldenRatioRemainder=2-nu.GoldenRatio;let r4=(()=>{class r extends Zt{constructor(t,n){super(null),this.desiredAspectRatio=1.2,this.bestPacking=null,this.cachedCosts=new Map,this.rectangles=t,this.desiredAspectRatio=n}get PackedWidth(){return null!=this.bestPacking?this.bestPacking.PackedWidth:0}get PackedHeight(){return null!=this.bestPacking?this.bestPacking.PackedHeight:0}Pack(t,n,i){const s=r.GetGoldenSectionStep(t,n),o=Math.max(i/10,(n-t)/r.MaxSteps);n+=o,this.bestPackingCost=Number.MAX_VALUE,1==this.rectangles.length?this.PackLimit(t):2==this.rectangles.length?(this.PackLimit(t),this.PackLimit(n)):this.rectangles.length>2&&r.GoldenSectionSearch(l=>this.PackLimit(l),t,s,n,o);const a=this.bestPacking.getRects();for(let l=0;l<this.rectangles.length;l++)this.rectangles[l]=a[l]}PackLimit(t){let n=this.cachedCosts.get(t);if(null==n){const i=this.createPacking(this.rectangles,t);i.run(),this.cachedCosts.set(t,n=Math.abs(i.PackedAspectRatio-this.desiredAspectRatio)),n<this.bestPackingCost&&(this.bestPackingCost=n,this.bestPacking=i)}return n}static GoldenSectionSearch(t,n,i,s,o){if(Math.abs(n-s)<o)return t(n)<t(s)?n:s;const a=r.GetGoldenSectionStep(i,s),l=t(i),c=t(a),u=()=>r.GoldenSectionSearch(t,a,i,n,o),S=()=>r.GoldenSectionSearch(t,i,a,s,o);if(c<l)return S();if(c>l)return u();const b=S(),L=u();return t(L)<t(b)?L:b}static GetGoldenSectionStep(t,n){return t<n?t+nu.GoldenRatioRemainder*(n-t):t-nu.GoldenRatioRemainder*(t-n)}}return r.MaxSteps=1e3,r})();var kt=h(5341);class i4 extends Zt{get PackedWidth(){return this.packedWidth}set PackedWidth(e){this.packedWidth=e}get PackedHeight(){return this.packedHeight}set PackedHeight(e){this.packedHeight=e}get PackedAspectRatio(){return this.PackedWidth/this.PackedHeight}getRects(){const e=[];for(const[t,n]of this.rectsToCenters)t.center=n,e.push(t);return e}}class Fd extends i4{constructor(e,t,n=!1){super(null),this.rectsToCenters=new Map,this.rectanglesByDescendingHeight=n?e:Fd.SortRectangles(e),this.wrapWidth=t}static SortRectangles(e){return e.sort((t,n)=>n.height-t.height),e}run(){this.Pack()}Pack(){this.PackedWidth=0,this.PackedHeight=0;const e=new kt.K;let t=!1,n=0,i=0,s=0;const o=this.rectanglesByDescendingHeight;for(let a=0;t||a<o.length;){const l=o[a],c=e.length>0?e.top:null;if(null==c||c.right+l.width<=this.wrapWidth&&n+l.height<=c.top){const S=new x(c?c.right:0,n).add(new x(l.width/2,l.height/2));l.center=S,this.rectsToCenters.set(l,S),i=Math.max(i,l.right),s=Math.max(s,l.top),e.push(l),t=!1}else n=c.top,e.pop(),t=!0;t||a++}this.PackedWidth=i,this.PackedHeight=s}}class hT extends r4{constructor(e,t){super(Fd.SortRectangles(e),t),this.createPacking=(n,i)=>new Fd(n,i,!0)}run(){let e=Number.MAX_VALUE,t=0,n=0;for(const i of this.rectangles){const s=i.width;n+=s,e=Math.min(e,s),t=Math.max(t,s)}this.Pack(t,n,e)}}var Pt=(()=>{return(r=Pt||(Pt={}))[r.Continue=0]="Continue",r[r.Stop=1]="Stop",Pt;var r})();function en(r){if(0==r.length)return null;if(1==r.length)return r[0];const e={b0:r[0].irect,seed0:1},t=function o4(r,e){let n,t=dT(e.b0,r[e.seed0].irect);for(let i=2;i<r.length;i++){const s=dT(e.b0,r[i].irect);s>t&&(e.seed0=i,t=s)}for(let i=0;i<r.length;i++)if(i!=e.seed0){n=i;break}t=r[e.seed0].irect.add_rect(r[n].irect).area;for(let i=0;i<r.length;i++){if(i==e.seed0)continue;const s=r[e.seed0].irect.add_rect(r[i].irect).area;s>t&&(n=i,t=s)}return n}(r,e),n=[],i=[];n.push(r[e.seed0]),i.push(r[t]);const s={box0:r[e.seed0].irect,box1:r[t].irect};!function s4(r,e,t,n,i,s){for(let a=0;a<r.length;a++){if(a==e||a==t)continue;const l=s.box0.add_rect(r[a].irect),c=l.area-s.box0.area,u=s.box1.add_rect(r[a].irect),S=u.area-s.box1.area;2*n.length<i.length?(n.push(r[a]),s.box0=l):2*i.length<n.length?(i.push(r[a]),s.box1=u):c<S?(n.push(r[a]),s.box0=l):S<c?(i.push(r[a]),s.box1=u):s.box0.area<s.box1.area?(n.push(r[a]),s.box0=l):(i.push(r[a]),s.box1=u)}}(r,e.seed0,t,n,i,s);const o=fT(r.length);return o.irect=s.box0.add_rect(s.box1),o.Left=en(n),o.Right=en(i),o}function dT(r,e){return r.add_rect(e).area}function FE(r,e){return null==r||null==e?null:en(Array.from(r).map(n=>Cn(n,e(n))))}function fT(r){const e=new kE;return e.Count=r,e}function Cn(r,e){const t=new kE;return t.UserData=r,t.irect=e,t.Count=1,t}function BE(r,e,t){return r.irect.intersects_rect(t)?e(r.UserData)==Pt.Continue?null!=r.Left?BE(r.Left,e,t)==Pt.Continue&&BE(r.Right,e,t)==Pt.Continue?Pt.Continue:Pt.Stop:Pt.Continue:Pt.Stop:Pt.Continue}class kE{toString(){return this.IsLeaf?this.Count.toString()+" "+this.UserData:this.Count.toString()}get IsLeaf(){return null==this.left}get Left(){return this.left}set Left(e){null!=this.left&&this.left.Parent==this&&(this.left.Parent=null),this.left=e,null!=this.left&&(this.left.Parent=this)}get Right(){return this.right}set Right(e){null!=this.right&&this.right.Parent==this&&(this.right.Parent=null),this.right=e,null!=this.right&&(this.right.Parent=this)}get IsLeftChild(){return this==this.Parent.Left}FirstHitNodePF(e,t){var n;return this.irect.contains_point(e)?this.IsLeaf?null!=t?t(e,this.UserData)==Pt.Stop?this:null:this:null!==(n=this.Left.FirstHitNodePF(e,t))&&void 0!==n?n:this.Right.FirstHitNodePF(e,t):null}FirstIntersectedNode(e){var t;return e.intersects_rect(this.irect)?this.IsLeaf?this:null!==(t=this.Left.FirstIntersectedNode(e))&&void 0!==t?t:this.Right.FirstIntersectedNode(e):null}FirstHitNodeWithPredicate(e,t){var n;return this.irect.contains_point(e)?this.IsLeaf?t(e,this.UserData)==Pt.Stop?this:null:null!==(n=this.Left.FirstHitNodeWithPredicate(e,t))&&void 0!==n?n:this.Right.FirstHitNodeWithPredicate(e,t):null}FirstHitNode(e){var t;return this.irect.contains_point(e)?this.IsLeaf?this:null!==(t=this.Left.FirstHitNode(e))&&void 0!==t?t:this.Right.FirstHitNode(e):null}*AllHitItems(e,t){const n=new kt.K;for(n.push(this);n.size>0;){const i=n.pop();i.irect.intersects_rect(e)&&(i.IsLeaf?(null==t||t(i.UserData))&&(yield i.UserData):(n.push(i.left),n.push(i.right)))}}*AllHitItems_(e){const t=new kt.K;for(t.push(this);t.size>0;){const n=t.pop();n.irect.contains_point(e)&&(n.IsLeaf?yield n.UserData:(t.push(n.left),t.push(n.right)))}}VisitTree(e,t){BE(this,e,t)}Clone(){const e=fT(this.Count);return e.UserData=this.UserData,e.irect=this.irect,null!=this.Left&&(e.Left=this.Left.Clone()),null!=this.Right&&(e.Right=this.Right.Clone()),e}*GetNodeItemsIntersectingRectangle(e){for(const t of this.GetLeafRectangleNodesIntersectingRectangle(e))yield t.UserData}*GetLeafRectangleNodesIntersectingRectangle(e){const t=new kt.K;for(t.push(this);t.size>0;){const n=t.pop();n.irect.intersects_rect(e)&&(n.IsLeaf?yield n:(t.push(n.left),t.push(n.right)))}}*GetAllLeaves(){for(const e of this.GetAllLeafNodes())yield e.UserData}*GetAllLeafNodes(){for(const e of this.EnumRectangleNodes(!0))yield e}*EnumRectangleNodes(e){const t=new kt.K;for(t.push(this);t.size>0;){const n=t.pop();(n.IsLeaf||!e)&&(yield n),n.IsLeaf||(t.push(n.left),t.push(n.right))}}TraverseHierarchy(e,t){t(e),null!=e.Left&&this.TraverseHierarchy(e.Left,t),null!=e.Right&&this.TraverseHierarchy(e.Right,t)}}function GE(r){return new Bd(en(r.map(([e,t])=>Cn(t,e))))}function gT(r){for(let e=r.Parent;null!=e;e=e.Parent)e.Count--,e.irect=e.Left.irect.add_rect(e.Right.irect)}function pT(r){return 2*r.Left.Count>=r.Right.Count&&2*r.Right.Count>=r.Left.Count}function VE(r,e,t,n){return!r.irect.intersects_rect(e)||(r.IsLeaf?!n(r.UserData)||0!=--t.bound:VE(r.Left,e,t,n)&&VE(r.Right,e,t,n))}class Bd{constructor(e){this._rootNode=e}Clear(){this.RootNode=null}NumberOfIntersectedIsLessThanBound(e,t,n){return VE(this._rootNode,e,{bound:t},n)}get RootNode(){return this._rootNode}set RootNode(e){this._rootNode=e}*GetAllLeaves(){if(null!=this._rootNode&&this.Count>0)for(const e of this._rootNode.GetAllLeaves())yield e}get Count(){return null==this._rootNode?0:this._rootNode.Count}Add(e,t){this.AddNode(Cn(t,e))}AddNode(e){null==this._rootNode?this._rootNode=e:this.Count<=2?this._rootNode=en(Array.from(this._rootNode.GetAllLeafNodes()).concat([e])):this.AddNodeToTreeRecursive(e,this._rootNode)}Rebuild(){this._rootNode=en(Array.from(this._rootNode.GetAllLeafNodes()))}AddNodeToTreeRecursive(e,t){if(t.IsLeaf)t.Left=Cn(t.UserData,t.irect),t.Right=e,t.Count=2;else{let n,i;if(t.Count++,2*t.Left.Count<t.Right.Count)this.AddNodeToTreeRecursive(e,t.Left),t.Left.irect=t.Left.irect.add_rect(e.irect);else if(2*t.Right.Count<t.Left.Count)this.AddNodeToTreeRecursive(e,t.Right),t.Right.irect=t.Right.irect.add_rect(e.irect);else{n=t.Left.irect.add_rect(e.irect);const s=n.area-t.Left.irect.area;i=t.Right.irect.add_rect(e.irect);const o=i.area-t.Right.irect.area;s<o?(this.AddNodeToTreeRecursive(e,t.Left),t.Left.irect=n):s>o?(this.AddNodeToTreeRecursive(e,t.Right),t.Right.irect=i):n.area<i.area?(this.AddNodeToTreeRecursive(e,t.Left),t.Left.irect=n):(this.AddNodeToTreeRecursive(e,t.Right),t.Right.irect=i)}}t.irect=t.Left.irect.add_rect(t.Right.irect)}GetAllIntersecting(e){return null==this._rootNode||0==this.Count?[]:Array.from(this._rootNode.GetNodeItemsIntersectingRectangle(e))}OneIntersecting(e){if(null==this._rootNode||0==this.Count)return;const t=this._rootNode.FirstIntersectedNode(e);return null!=t?{intersectedLeaf:t.UserData}:void 0}GetAllLeavesIntersectingRectangle(e){return null==this._rootNode||0==this.Count?[]:this._rootNode.GetLeafRectangleNodesIntersectingRectangle(e)}IsIntersecting(e){if(null==this._rootNode||0==this.Count)return!1;for(const t of this._rootNode.GetNodeItemsIntersectingRectangle(e))return!0;return!1}Contains(e,t){if(null==this._rootNode)return!1;for(const n of this._rootNode.GetLeafRectangleNodesIntersectingRectangle(e))if(n.UserData==t)return!0;return!1}Remove(e,t){if(null==this._rootNode)return;let n;for(const i of this._rootNode.GetLeafRectangleNodesIntersectingRectangle(e))i.UserData==t&&(n=i);return null!=n?(1==this.RootNode.Count?this.RootNode=null:this.RemoveLeaf(n),n.UserData):void 0}RemoveLeaf(e){const t=function c4(r){for(let e=r.Parent;null!=e;e=e.Parent)if(!pT(e))return e;return null}(e);if(null!=t)(function l4(r,e){const t=new Array;for(const i of r.GetAllLeafNodes())i!=e&&t.push(i);const n=en(t);r.Count=n.Count,r.Left=n.Left,r.Right=n.Right,r.irect=n.Left.irect.add_rect(n.Right.irect)})(t,e),gT(t);else{const n=e.Parent;null==n?this._rootNode=new kE:(function a4(r,e){r.UserData=e.UserData,r.Left=e.Left,r.Right=e.Right,r.Count--,r.irect=e.irect}(n,e.IsLeftChild?n.Right:n.Left),gT(n))}}UnbalancedNode(e){for(let t=e.Parent;null!=t;t=t.Parent)if(!pT(t))return t;return null}}function mT(r,e){const t=new Array;for(const s of e)t.push({g:s,lb:s.boundingBox.leftBottom.clone()});const n=e.map(s=>s.boundingBox),i=new hT(n,1.5);i.run();for(const{g:s,lb:o}of t){const a=s.boundingBox.leftBottom.sub(o);s.translate(a)}r.boundingBox=new Ne({left:0,bottom:0,right:i.PackedWidth,top:i.PackedHeight}),r.addLabelToGraphBB(r.boundingBox)}class Ii extends _E{constructor(e){super(e),this.MinimalWidth=0,this.MinimalHeight=0,this.Margins=10}static getGeom(e){return e.getAttr(0)}*intersectedObjects(e,t=!0){null==this._rtree&&(this._rtree=this.buildRTree());const n=this._rtree.GetAllIntersecting(e),i=e.perimeter();for(const s of n)if(s instanceof _E&&(yield s),!t&&s instanceof io){const o=s.curve;(null!=ee.intersectionOne(o,i,!1)||ee.PointRelativeToCurveLocation(o.start,i)==Fe.Inside)&&(yield s)}}buildRTree(){return GE(Array.from(this.deepNodes()).concat(Array.from(this.deepEdges())).map(t=>[t.boundingBox,t]))}isEmpty(){return this.graph.isEmpty()}setSettingsRecursively(e){this.layoutSettings=e;for(const t of this.deepNodes())t.layoutSettings=e}get layoutSettings(){return this._layoutSettings}set layoutSettings(e){this._layoutSettings=e}translate(e){if(0==e.x&&0==e.y)return;const t=new Rn(1,0,e.x,0,1,e.y);this.transform(t)}get labelSize(){return this._labelSize}set labelSize(e){this._labelSize=e}get boundingBox(){return this._boundingBox}set boundingBox(e){this._boundingBox=e}transform(e,t=!0){if(!e.isIdentity()){null!=this.boundaryCurve&&(this.boundaryCurve=this.boundaryCurve.transform(e));for(const n of this.shallowNodes())n.transform(e,t);for(const n of this.edges())n.transform(e);t&&this.updateBoundingBox()}}*deepNodes(){for(const e of this.graph.deepNodes)yield An.getGeom(e)}setEdge(e,t){const n=this.graph.setEdge(e,t);return new io(n)}pumpTheBoxToTheGraphWithMargins(e){const t={b:Ne.mkEmpty()};return this.pumpTheBoxToTheGraph(t),t.b.pad(Math.max(this.Margins,e)),this.MinimalWidth>0&&(t.b.width=Math.max(t.b.width,this.MinimalWidth)),this.MinimalHeight>0&&(t.b.height=Math.max(t.b.height,this.MinimalHeight)),this._boundingBox=t.b,t.b}get center(){return this.boundingBox?this.boundingBox.center:new x(0,0)}set center(e){const t=e.sub(this.center),n=new Rn(1,0,t.x,0,1,t.y);this.transform(n)}pumpTheBoxToTheGraph(e){for(const t of this.edges())if(!t.underCollapsedCluster()){if(null!=t.curve){const n=t.curve.boundingBox;n.pad(t.lineWidth),e.b.addRecSelf(n)}null!=t.label&&e.b.addRecSelf(t.label.boundingBox)}for(const t of this.shallowNodes())t.underCollapsedCluster()||!t.boundingBox||e.b.addRecSelf(t.boundingBox)}get left(){return this.boundingBox.left}get right(){return this.boundingBox.right}get top(){return this.boundingBox.top}get bottom(){return this.boundingBox.bottom}CheckClusterConsistency(){throw new Error("Method not implemented.")}get edgeCount(){return this.graph.edgeCount}*shallowNodes(){for(const e of this.graph.shallowNodes)yield An.getGeom(e)}*edges(){for(const e of this.graph.edges)yield An.getGeom(e)}*deepEdges(){for(const e of this.graph.deepEdges())yield An.getGeom(e)}static mk(e,t=new tu(0,0)){const n=new Ii(new Tr(e));return n.labelSize=t,n}*subgraphs(){for(const e of this.graph.subgraphs())yield An.getGeom(e)}static mkWithGraphAndLabel(e,t){const n=new Ii(e);return n.labelSize=t,n}get height(){return this.boundingBox.height}get width(){return this.boundingBox.width}get shallowNodeCount(){return this.graph.shallowNodeCount}get graph(){return this.entity}liftNode(e){const t=this.graph.liftNode(e.node);return t?An.getGeom(t):null}findNode(e){const t=this.graph.findNode(e);return t?An.getGeom(t):null}addNode(e){return this.graph.addNode(e.node),e}updateBoundingBox(){if(this.graph.isEmpty())return;const e=Ne.mkEmpty();let t=0;for(const n of this.graph.edges){const i=An.getGeom(n);null!=i.curve&&(e.addRecSelf(i.boundingBox),t=Math.max(t,i.lineWidth))}for(const n of this.shallowNodes())n.boundingBox&&(e.addRecSelf(n.boundingBox),t=Math.max(t,n.padding));this.addLabelToGraphBB(e),e.pad(Math.max(t,this.Margins)),this.boundingBox=e}addLabelToGraphBB(e){this.labelSize&&(e.top+=this.labelSize.height+2,e.width<this.labelSize.width&&(e.width=this.labelSize.width))}FlipYAndMoveLeftTopToOrigin(){const e=new Rn(1,0,-this.left,0,-1,this.top);this.transform(e,!1);for(const n of this.deepNodes())if(n instanceof Ii&&!n.graph.isEmpty()){const s=n.boundingBox;n.boundingBox=Ne.mkSizeCenter(new tu(s.width,s.height),e.multiplyPoint(s.center))}const t=this.boundingBox;this.boundingBox=Ne.mkSizeCenter(new tu(t.width,t.height),e.multiplyPoint(t.center))}}function kd(r){const e=new nr;return e.SetEdges(r,nr.vertexCount(r)),e}function ET(r){const e=new nr;return e.SetEdges(r,nr.vertexCount(r)),e}function bs(r,e){const t=new nr;return t.SetEdges(r,e),t}class nr{constructor(){this.nodeCount=0}*incidentEdges(e){for(const t of this.outEdges[e])yield t;for(const t of this.inEdges[e])yield t}static deleteFromArray(e,t){const n=e.indexOf(t,0);n>-1&&e.splice(n,1)}removeEdge(e){nr.deleteFromArray(this.edges,e),e.source!=e.target?(nr.deleteFromArray(this.outEdges[e.source],e),nr.deleteFromArray(this.inEdges[e.target],e)):nr.deleteFromArray(this.selfEdges[e.source],e)}static vertexCount(e){let t=0;for(const n of e)n.source>=t&&(t=n.source),n.target>=t&&(t=n.target);return++t}SetEdges(e,t){this.edges=e,this.nodeCount=t;const n=new Array(this.nodeCount).fill(0),i=new Array(this.nodeCount).fill(0),s=new Array(this.nodeCount).fill(0);this.outEdges=new Array(this.nodeCount),this.inEdges=new Array(this.nodeCount),this.selfEdges=new Array(this.nodeCount);for(const o of this.edges)o.source!=o.target?(n[o.source]++,i[o.target]++):s[o.source]++;for(let o=0;o<this.nodeCount;o++)this.outEdges[o]=new Array(n[o]),n[o]=0,this.inEdges[o]=new Array(i[o]),i[o]=0,this.selfEdges[o]=new Array(s[o]),s[o]=0;for(const o of this.edges){const a=o.source,l=o.target;a!=l?(this.outEdges[a][n[a]++]=o,this.inEdges[l][i[l]++]=o):this.selfEdges[a][s[a]++]=o}}inEdgesCount(e){return this.inEdges[e].length}outEdgesCount(e){return this.outEdges[e].length}selfEdgesCount(e){return this.selfEdges[e].length}addEdge(e){this.edges.push(e),e.source!=e.target?(this.outEdges[e.source].push(e),this.inEdges[e.target].push(e)):this.selfEdges[e.source].push(e)}*nodesOfConnectedGraph(){if(0==this.edges.length)return;const e=new Set,t=new eo.c;let n=this.edges[0].source;for(nr.enqueue(e,t,n),yield n;t.length>0;){n=t.dequeue();for(const i of this.outEdges[n]){const s=i.target;e.has(s)||(nr.enqueue(e,t,s),yield s)}for(const i of this.inEdges[n]){const s=i.source;e.has(s)||(nr.enqueue(e,t,s),yield s)}}}*pred(e){for(const t of this.inEdges[e])yield t.source}*succ(e){for(const t of this.outEdges[e])yield t.target}static enqueue(e,t,n){t.enqueue(n),e.add(n)}}class ot{constructor(e,t){this.x=e,this.y=t}get source(){return this.x}get target(){return this.y}isDiagonal(){return this.x==this.y}}class ul{constructor(e){this.arrayOfMaps=new Array(e);for(let t=0;t<e;t++)this.arrayOfMaps[t]=new Map}set(e,t,n){this.arrayOfMaps[e].set(t,n)}setPair(e,t){this.set(e.x,e.y,t)}delete(e,t){e<0||e>=this.arrayOfMaps.length||this.arrayOfMaps[e].delete(t)}has(e,t){return!(e<0||e>=this.arrayOfMaps.length)&&this.arrayOfMaps[e].has(t)}get(e,t){return e<0||e>=this.arrayOfMaps.length?null:this.arrayOfMaps[e].get(t)}getI(e){return this.get(e.x,e.y)}*keys(){for(let e=0;e<this.arrayOfMaps.length;e++){const t=this.arrayOfMaps[e];for(const n of t)yield new ot(e,n[0])}}*keyValues(){for(let e=0;e<this.arrayOfMaps.length;e++){const t=this.arrayOfMaps[e];for(const n of t)yield[new ot(e,n[0]),n[1]]}}*values(){for(let e=0;e<this.arrayOfMaps.length;e++){const t=this.arrayOfMaps[e];for(const n of t)yield n[1]}}}var qi=(()=>{return(r=qi||(qi={}))[r.NotVisited=0]="NotVisited",r[r.InStack=1]="InStack",r[r.Visited=2]="Visited",qi;var r})();class u4{constructor(e,t){this.v=e,this.i=t}}class so{static getFeedbackSetWithConstraints(e,t){throw new Error("Method not implemented.")}static push(e,t,n,i){t[n]=qi.InStack,e.push(new u4(n,i))}static getFeedbackSet(e){const t=new ul(e.nodeCount);if(null==e||0==e.nodeCount)return[];const n=new Array(e.nodeCount).fill(qi.NotVisited);for(let i=0;i<e.nodeCount;i++){if(n[i]==qi.Visited)continue;const s=new kt.K;let o=0;for(so.push(s,n,i,o);s.size>0;){const a=s.pop();i=a.v,n[i]=qi.Visited,o=a.i;let l=e.outEdges[i];for(;o<l.length;o++){const c=l[o];if(c.source==c.target)continue;const u=n[c.target];u==qi.InStack?t.set(c.source,c.target,c):u==qi.NotVisited&&(so.push(s,n,i,o+1),i=c.target,n[c.target]=qi.Visited,l=e.outEdges[i],o=-1)}}}return Array.from(t.values())}}var In=h(9737);class oo{constructor(e,t,n,i=1){this.Source=e,this.Target=t,this.CrossingWeight=n,this.Weight=i}toString(){return In.String.Format("{0}->{1}",this.Source,this.Target)}}class hl{static FindClosestPoints(e,t){const n=ee.minDistWithinIntervals(e,t,e.parStart,e.parEnd,t.parStart,t.parEnd,(e.parStart+e.parEnd)/2,(t.parStart+t.parEnd)/2);if(n)return{curveClosestPoint:n.aX,labelSideClosest:n.bX}}static GetSegmentInFrontOfLabel(e,t){if(e instanceof ee)for(const n of e.segs)if((n.start.y-t)*(n.end.y-t)<=0)return n;return null}static ShiftLabel(e,t,n){const i=e.lineWidth/2,s=t.sub(n),o=s.length;o>i&&(e.label.center=e.label.center.add(s.div(o*(o-i))))}static updateLabel(e,t){let n=null;t.labelIsToTheRightOfTheSpline?(e.label.center=new x(t.x+t.rightAnchor/2,t.y),n=me.mkPP(e.labelBBox.leftTop,e.labelBBox.leftBottom)):t.labelIsToTheLeftOfTheSpline&&(e.label.center=new x(t.x-t.leftAnchor/2,t.y),n=me.mkPP(e.labelBBox.rightTop,e.labelBBox.rightBottom));const i=hl.GetSegmentInFrontOfLabel(e.curve,e.label.center.y);if(null!=i&&0==ee.getAllIntersections(e.curve,ee.polyFromBox(e.labelBBox),!1).length){const s=hl.FindClosestPoints(i,n);if(s)hl.ShiftLabel(e,s.curveClosestPoint,s.labelSideClosest);else{let o,a;const l=i.closestParameter(n.start),c=i.closestParameter(n.end);i.value(l).sub(n.start).length<i.value(c).sub(n.end).length?(o=i.value(l),a=n.start):(o=i.value(c),a=n.end),hl.ShiftLabel(e,o,a)}}}}class Oi{constructor(e,t,n,i=1,s=1){this.reversed=!1,this.source=e,this.target=t,this.edge=n,this.weight=i,this.separation=s}get CrossingWeight(){return 1}get hasLabel(){return null!=this.edge.label}get labelWidth(){return this.edge.label.width}get labelHeight(){return this.edge.label.height}reverse(){const e=this.source;this.source=this.target,this.target=e,this.reversed=!this.reversed}toString(){return"edge("+this.source+"->"+this.target+")"}get curve(){return this.edge.curve}set curve(e){this.edge.curve=e}get underlyingPolyline(){return this.edge.underlyingPolyline}set underlyingPolyline(e){this.edge.underlyingPolyline=e}get LayerSpan(){return null!=this.LayerEdges?this.LayerEdges.length:0}isSelfEdge(){return this.source==this.target}reversedClone(){const e=new Oi(this.target,this.source,this.edge);if(null!=this.LayerEdges){const t=this.LayerEdges.length;e.LayerEdges=new Array(t);for(let n=0;n<t;n++){const i=this.LayerEdges[t-1-n];e.LayerEdges[n]=new oo(i.Target,i.Source,i.CrossingWeight)}e.LayerEdges[0].Source=this.target,e.LayerEdges[this.LayerEdges.length-1].Target=this.source}return e}get count(){return this.LayerEdges.length}getNode(e){if(e>=0){if(e<this.LayerEdges.length)return this.LayerEdges[e].Source;if(e==this.LayerEdges.length)return this.LayerEdges[e-1].Target}throw new Error("wrong index "+e)}updateEdgeLabelPosition(e){null!=this.edge.label&&hl.updateLabel(this.edge,e[this.LayerEdges[this.LayerEdges.length/2].Source])}[Symbol.iterator](){return this.nodes()}*nodes(){yield this.LayerEdges[0].Source;for(const e of this.LayerEdges)yield e.Target}}class bi{constructor(){this.arrayOfSets=new Array}has(e){return this.hasxy(e.x,e.y)}remove(e){if(!(e.x<0||e.x>=this.arrayOfSets.length))return this.arrayOfSets[e.x].delete(e.y)}hasxy(e,t){if(e<0||e>=this.arrayOfSets.length)return!1;const n=this.arrayOfSets[e];return null!=n&&n.has(t)}static mk(e){const t=new bi;for(const n of e)t.add(n);return t}*values(){for(let e=0;e<this.arrayOfSets.length;e++){const t=this.arrayOfSets[e];if(t)for(const n of t.values())yield new ot(e,n)}}add(e){let t=this.arrayOfSets[e.x];null==t&&(this.arrayOfSets[e.x]=t=new Set),t.add(e.y)}addNN(e,t){let n=this.arrayOfSets[e];null==n&&(this.arrayOfSets[e]=n=new Set),n.add(t)}clear(){for(const e of this.arrayOfSets)e&&e.clear()}}function*ru(r){const e=new Array(r.nodeCount).fill(!1),t=new eo.c;for(let n=0;n<r.nodeCount;n++)if(!e[n]){const i=new Array;for(yT(n,t,e);t.length>0;){const s=t.dequeue();i.push(s);for(const o of h4(r,s))yT(o,t,e)}yield i}}function*h4(r,e){for(const t of r.outEdges[e])yield t.target;for(const t of r.inEdges[e])yield t.source}function yT(r,e,t){0==t[r]&&(e.enqueue(r),t[r]=!0)}class d4{constructor(){this.maxLayerOfGeomGraph=new Set,this.minLayerOfGeomGraph=new Set,this.sameLayerConstraints=new Array,this.upDownConstraints=new Array,this.gluedUpDownIntConstraints=new bi,this.sameLayerDictionaryOfRepresentatives=new Map,this.representativeToItsLayer=new Map,this.maxLayerInt=new Array,this.minLayerInt=new Array,this.sameLayerInts=new Array,this.upDownInts=new Array}getFeedbackSetExternal(e,t){throw new Error("Method not implemented.")}pinNodeToMaxLayer(e){this.maxLayerOfGeomGraph.add(e)}pinNodeToMinLayer(e){this.minLayerOfGeomGraph.add(e)}get isEmpty(){return 0==this.maxLayerOfGeomGraph.size&&0==this.minLayerOfGeomGraph.size&&0==this.sameLayerConstraints.length&&0==this.upDownConstraints.length}clear(){this.maxLayerOfGeomGraph.clear(),this.minLayerOfGeomGraph.clear(),this.sameLayerConstraints=[],this.upDownConstraints=[]}getFeedbackSetImp(e,t){return this.nodeIdToIndex=t,this.intGraph=e,this.maxRepresentative=-1,this.minRepresentative=-1,this.createIntegerConstraints(),this.glueTogetherSameConstraintsMaxAndMin(),this.addMaxMinConstraintsToGluedConstraints(),this.removeCyclesFromGluedConstraints(),this.getFeedbackSet()}removeCyclesFromGluedConstraints(){const e=bs(Array.from(this.gluedUpDownIntConstraints.values()),this.intGraph.nodeCount),t=so.getFeedbackSetWithConstraints(e,null);for(const n of t)this.gluedUpDownIntConstraints.remove(n)}addMaxMinConstraintsToGluedConstraints(){if(-1!=this.maxRepresentative)for(let e=0;e<this.intGraph.nodeCount;e++){const t=this.nodeToRepr(e);t!=this.maxRepresentative&&this.gluedUpDownIntConstraints.add(new ot(this.maxRepresentative,t))}if(-1!=this.minRepresentative)for(let e=0;e<this.intGraph.nodeCount;e++){const t=this.nodeToRepr(e);t!=this.minRepresentative&&this.gluedUpDownIntConstraints.add(new ot(t,this.minRepresentative))}}glueTogetherSameConstraintsMaxAndMin(){this.createDictionaryOfSameLayerRepresentatives(),this.upDownInts.map(this.gluedIntPairNN),this.gluedUpDownIntConstraints=new bi}gluedIntPairNN(e){return new ot(this.nodeToRepr(e[0]),this.nodeToRepr(e[1]))}gluedIntPairI(e){return new ot(this.nodeToRepr(e.source),this.nodeToRepr(e.target))}gluedIntPair(e){return new ot(this.nodeToRepr(e.source),this.nodeToRepr(e.target))}gluedIntEdge(e){const t=this.nodeToRepr(e.source),n=this.nodeToRepr(e.target),i=new Oi(t,n,e.edge);return i.separation=e.separation,i.weight=0,i}nodeToRepr(e){return this.sameLayerDictionaryOfRepresentatives.get(e)||e}createDictionaryOfSameLayerRepresentatives(){const e=this.createGraphOfSameLayers();for(const t of ru(e))this.glueSameLayerNodesOfALayer(t)}createGraphOfSameLayers(){return bs(this.createEdgesOfSameLayers(),this.intGraph.nodeCount)}createEdgesOfSameLayers(){const e=new Array;return-1!=this.maxRepresentative&&this.maxLayerInt.filter(t=>t!=this.maxRepresentative).map(t=>new ot(this.maxRepresentative,t)).forEach(t=>e.push(t)),-1!=this.minRepresentative&&this.minLayerInt.filter(t=>t!=this.minRepresentative).map(t=>new ot(this.minRepresentative,t)).forEach(t=>e.push(t)),this.sameLayerInts.forEach(t=>e.push(new ot(t[0],t[1]))),e}glueSameLayerNodesOfALayer(e){if(e.length>1){let t=-1;if(this.componentsIsMaxLayer(e))for(const n of e)this.sameLayerDictionaryOfRepresentatives.set(n,t=this.maxRepresentative);else if(this.componentIsMinLayer(e))for(const n of e)this.sameLayerDictionaryOfRepresentatives.set(n,t=this.minRepresentative);else for(const n of e)-1==t&&(t=n),this.sameLayerDictionaryOfRepresentatives.set(n,t);this.representativeToItsLayer.set(t,e)}}componentIsMinLayer(e){return e.findIndex(t=>this.minRepresentative==t)>=0}componentsIsMaxLayer(e){return e.findIndex(t=>this.maxRepresentative==t)>=0}createIntegerConstraints(){this.createMaxIntConstraints(),this.createMinIntConstraints(),this.createUpDownConstraints(),this.createSameLayerConstraints()}createSameLayerConstraints(){this.sameLayerInts=this.createIntConstraintsFromStringCouples(this.sameLayerConstraints)}createUpDownConstraints(){this.upDownInts=this.createIntConstraintsFromStringCouples(this.upDownConstraints)}createIntConstraintsFromStringCouples(e){return e.map(t=>[this.nodeIndex(t[0]),this.nodeIndex(t[1])]).filter(t=>-1!=t[0]&&-1!=t[1])}createMinIntConstraints(){this.minLayerInt=this.createIntConstraintsFromExtremeLayer(this.minLayerOfGeomGraph),this.minLayerInt.length>0&&(this.minRepresentative=this.minLayerInt[0])}createMaxIntConstraints(){this.maxLayerInt=this.createIntConstraintsFromExtremeLayer(this.maxLayerOfGeomGraph),this.maxLayerInt.length>0&&(this.maxRepresentative=this.maxLayerInt[0])}createIntConstraintsFromExtremeLayer(e){return Array.from(e).map(t=>this.nodeIndex(t)).filter(t=>-1!=t)}nodeIndex(e){return this.nodeIdToIndex.get(e.node.id)||-1}getFeedbackSet(){return this.gluedIntGraph=this.createGluedGraph(),Array.from(this.unglueIntPairs(so.getFeedbackSetWithConstraints(this.gluedIntGraph,this.gluedUpDownIntConstraints)))}*unglueIntPairs(e){for(const t of e)for(const n of this.unglueEdge(t))yield n}*unglueEdge(e){for(const t of this.unglueNode(e.source))for(const n of this.intGraph.outEdges[t])this.nodeToRepr(n.target)==e.target&&(yield n)}createGluedGraph(){const e=new bi;return this.intGraph.edges.forEach(t=>e.add(this.gluedIntPairI(t))),bs(Array.from(e.values()),this.intGraph.nodeCount)}unglueNode(e){return this.representativeToItsLayer.get(e)||[e]}getGluedNodeCounts(){const e=new Array(this.nodeIdToIndex.size).fill(0);for(let t=0;t<e.length;t++)e[this.nodeToRepr(t)]++;return e}}class g4{constructor(){this.leftRightConstraints=new Array,this.leftRightNeighbors=new Array,this.nodeToBlockRoot=new Map,this.upDownVerticalConstraints=new Array,this.BlockRootToBlock=new Map}get IsEmpty(){return 0==this.leftRightNeighbors.length&&0==this.upDownVerticalConstraints.length&&0==this.leftRightConstraints.length}AddSameLayerNeighbors(e){for(let t=0;t<e.length-1;t++)this.AddSameLayerNeighborsPair(e[t],e[t+1])}AddSameLayerNeighborsPair(e,t){this.leftRightNeighbors.push([e,t])}NodeToBlockRootSoft(e){return this.nodeToBlockRoot.get(e)||e}CreateMappingOfNeibBlocks(){const e=this.BasicGraphFromLeftRightIntNeibs();for(let t=0;t<e.nodeCount;t++)if(0==e.inEdges[t].length&&!this.nodeToBlockRoot.has(t)){const n=new Array;let i=t;for(let s=e.outEdges[i];s.length>0;s=e.outEdges[i])i=s[0].y,n.push(i),this.nodeToBlockRoot.set(i,t);n.length>0&&this.BlockRootToBlock.set(t,n)}}BasicGraphFromLeftRightIntNeibs(){return kd(Array.from(this.LeftRightIntNeibs.values()).map(e=>new ot(e.x,e.y)))}NodeIndex(e){return this.nodeIdToIndex.get(e.id)||-1}PrepareForOrdering(e,t){this.nodeIdToIndex=e,this.MapNodesToToIntegers(t),this.CreateMappingOfNeibBlocks(),this.LiftLeftRightRelationsToNeibBlocks()}LiftLeftRightRelationsToNeibBlocks(){this.LeftRighInts=bi.mk(this.leftRightConstraints.map(t=>function f4(r,e){return[r,e]}(this.NodeIndex(t[0]),this.NodeIndex(t[1]))).filter(t=>-1!=t[0]&&-1!=t[1]).map(t=>new ot(this.NodeToBlockRootSoft(t[0]),this.NodeToBlockRootSoft(t[1]))).filter(t=>t.x!=t.x));const e=so.getFeedbackSet(kd(Array.from(this.LeftRighInts.values())));for(const t of e)this.LeftRighInts.remove(new ot(t.source,t.target))}MapNodesToToIntegers(e){this.LeftRightIntNeibs=bi.mk(Array.from(this.leftRightNeighbors.values()).map(t=>[this.NodeIndex(t[0]),this.NodeIndex(t[1])]).filter(t=>-1!=t[0]&&-1!=t[1]).map(t=>new ot(t[0],t[1]))),this.VerticalInts=bi.mk(this.upDownVerticalConstraints.map(t=>[this.NodeIndex(t[0]),this.NodeIndex(t[1])]).filter(t=>-1!=t[0]&&-1!=t[1]&&e[t[0]]>e[t[1]]).map(t=>new ot(t[0],t[1])))}}var Nr=(()=>{return(r=Nr||(Nr={}))[r.TB=0]="TB",r[r.LR=1]="LR",r[r.BT=2]="BT",r[r.RL=3]="RL",r[r.None=4]="None",Nr;var r})();let wT=(()=>{class r{constructor(){this.capacityOverflowCoefficient=r.DefaultCapacityOverflowCoefficientMultiplier,this.RotateBundles=!1,this.MaxHubRadius=50,this.MinHubRadius=.1,this.CreateUnderlyingPolyline=!1,this.pathLengthImportance=r.DefaultPathLengthImportance,this.inkImportance=r.DefaultInkImportance,this.edgeSeparation=r.DefaultEdgeSeparation,this.angleThreshold=Math.PI/180*45,this.hubRepulsionImportance=100,this.bundleRepulsionImportance=100,this.minimalRatioOfGoodCdtEdges=.9,this.highestQuality=!0,this.KeepOriginalSpline=!1,this.KeepOverlaps=!1,this.StopAfterShortestPaths=!1}get CapacityOverflowCoefficient(){return this.capacityOverflowCoefficient}set CapacityOverflowCoefficient(t){this.capacityOverflowCoefficient=t}get PathLengthImportance(){return this.pathLengthImportance}set PathLengthImportance(t){this.pathLengthImportance=t}get InkImportance(){return this.inkImportance}set InkImportance(t){this.inkImportance=t}get EdgeSeparation(){return this.edgeSeparation}set EdgeSeparation(t){this.edgeSeparation=t}get UseCubicBezierSegmentsInsideOfHubs(){return this.useCubicBezierSegmentsInsideOfHubs}set UseCubicBezierSegmentsInsideOfHubs(t){this.useCubicBezierSegmentsInsideOfHubs=t}get AngleThreshold(){return this.angleThreshold}set AngleThreshold(t){this.angleThreshold=t}get HubRepulsionImportance(){return this.hubRepulsionImportance}set HubRepulsionImportance(t){this.hubRepulsionImportance=t}get BundleRepulsionImportance(){return this.bundleRepulsionImportance}set BundleRepulsionImportance(t){this.bundleRepulsionImportance=t}get MinimalRatioOfGoodCdtEdges(){return this.minimalRatioOfGoodCdtEdges}set MinimalRatioOfGoodCdtEdges(t){this.minimalRatioOfGoodCdtEdges=t}get HighestQuality(){return this.highestQuality}set HighestQuality(t){this.highestQuality=t}}return r.DefaultCapacityOverflowCoefficientMultiplier=1e3,r.DefaultPathLengthImportance=500,r.DefaultInkImportance=.01,r.DefaultEdgeSeparation=.5,r})();var cn=(()=>{return(r=cn||(cn={}))[r.Spline=0]="Spline",r[r.SplineBundling=1]="SplineBundling",r[r.StraightLine=2]="StraightLine",r[r.SugiyamaSplines=3]="SugiyamaSplines",r[r.Rectilinear=4]="Rectilinear",r[r.RectilinearToCenter=5]="RectilinearToCenter",r[r.None=6]="None",cn;var r})();class vT{constructor(){this.coneAngle=Math.PI/180*30,this.padding=3,this.polylinePadding=1.5,this.routingToParentConeAngle=Math.PI/6,this.simpleSelfLoopsForParentEdgesThreshold=200,this.incrementalRoutingThreshold=5e6,this.routeMultiEdgesAsBundles=!0,this.KeepOriginalSpline=!1,this.EdgeRoutingMode=cn.Spline}get EdgeRoutingMode(){return this.edgeRoutingMode}set EdgeRoutingMode(e){e==cn.SplineBundling&&null==this.BundlingSettings&&null==this.BundlingSettings&&(this.BundlingSettings=new wT),this.edgeRoutingMode=e}get ConeAngle(){return this.coneAngle}set ConeAngle(e){this.coneAngle=e}get Padding(){return this.padding}set Padding(e){this.padding=e}get PolylinePadding(){return this.polylinePadding}set PolylinePadding(e){this.polylinePadding=e}get RoutingToParentConeAngle(){return this.routingToParentConeAngle}set RoutingToParentConeAngle(e){this.routingToParentConeAngle=e}get SimpleSelfLoopsForParentEdgesThreshold(){return this.simpleSelfLoopsForParentEdgesThreshold}set SimpleSelfLoopsForParentEdgesThreshold(e){this.simpleSelfLoopsForParentEdgesThreshold=e}get IncrementalRoutingThreshold(){return this.incrementalRoutingThreshold}set IncrementalRoutingThreshold(e){this.incrementalRoutingThreshold=e}get RouteMultiEdgesAsBundles(){return this.routeMultiEdgesAsBundles}set RouteMultiEdgesAsBundles(e){this.routeMultiEdgesAsBundles=e}}var dl=(()=>{return(r=dl||(dl={}))[r.None=0]="None",r[r.Top=1]="Top",r[r.Bottom=2]="Bottom",dl;var r})();class ST{constructor(){this.edgeRoutingSettings=new vT,this.minimalWidth=0,this.minimalHeight=0,this.nodeSeparation=10,this.packingAspectRatio=1.5}get MinimalWidth(){return this.minimalWidth}set MinimalWidth(e){this.minimalWidth=Math.max(e,0)}get MinimalHeight(){return this.minimalHeight}set MinimalHeight(e){this.minimalHeight=Math.max(e,0)}get NodeSeparation(){return this.nodeSeparation}set NodeSeparation(e){this.nodeSeparation=e}get PackingAspectRatio(){return this.packingAspectRatio}set PackingAspectRatio(e){this.packingAspectRatio=e}}class Gd extends ST{constructor(){super(),this.margins={left:0,top:0,bottom:0,right:0},this.sameRanks=new Array,this.verticalConstraints=new d4,this.horizontalConstraints=new g4,this.NoGainAdjacentSwapStepsBound=5,this.RepetitionCoefficientForOrdering=1,this.AspectRatio=0,this.MaxNumberOfPassesInOrdering=24,this.BrandesThreshold=600,this.LabelCornersPreserveCoefficient=.1,this.MinNodeHeight=9,this.MinNodeWidth=13.5,this.SnapToGridByY=dl.None,this.yLayerSep=30,this.transform=Rn.getIdentity(),this.GridSizeByY=0,this.GridSizeByX=0,this.edgeRoutingSettings.EdgeRoutingMode=cn.SugiyamaSplines}get LayerSeparation(){return this.yLayerSep}set LayerSeparation(e){this.yLayerSep=Math.max(30,e)}ActualLayerSeparation(e){return e?this.LayerSeparation/2:this.LayerSeparation}transformIsRotation(e){const t=Rn.rotation(e);for(let n=0;n<2;n++)for(let i=0;i<3;i++)if(!nt(t.elements[n][i],this.transform.elements[n][i]))return!1;return!0}get layerDirection(){return this.transformIsRotation(0)?Nr.TB:this.transformIsRotation(Math.PI/2)?Nr.LR:this.transformIsRotation(-Math.PI/2)?Nr.RL:this.transformIsRotation(Math.PI)?Nr.BT:Nr.None}set layerDirection(e){switch(e){case Nr.TB:this.transform=Rn.getIdentity();break;case Nr.LR:this.transform=Rn.rotation(Math.PI/2);break;case Nr.RL:this.transform=Rn.rotation(-Math.PI/2);break;case Nr.BT:this.transform=Rn.rotation(Math.PI);break;default:throw new Error("unexpected layout direction")}}}class Xr{constructor(){this.isEmpty=!0}AddValue(e){this.isEmpty?(this.max=e,this.min=e,this.isEmpty=!1):e<this.min?this.min=e:e>this.max&&(this.max=e)}get length(){return this.max-this.min}static sign(e){return e>q.distanceEpsilon?1:e<-q.distanceEpsilon?-1:0}}class iu extends nr{constructor(e,t){super(),this.SetEdges(e,t)}}class p4{constructor(e){this.MultipleMiddles=new Set,this.Multiedges=new ul(e)}*RegularMultiedges(){for(const[e,t]of this.Multiedges.keyValues())e.x!=e.y&&(yield t)}*AllIntEdges(){for(const e of this.Multiedges.values())for(const t of e)yield t}addFeedbackSet(e){for(const t of e){const n=new ot(t.source,t.target),i=new ot(t.target,t.source),s=this.Multiedges.get(n.x,n.y);for(const o of s)o.reverse();if(this.Multiedges.has(i.x,i.y)){const o=this.Multiedges.get(i.x,i.y);for(const a of s)o.push(a)}else this.Multiedges.set(i.x,i.y,s);this.Multiedges.delete(n.x,n.y)}}registerOriginalEdgeInMultiedges(e){let t=this.Multiedges.get(e.source,e.target);null==t&&this.Multiedges.set(e.source,e.target,t=[]),t.push(e)}*SkeletonEdges(){for(const[e,t]of this.Multiedges.keyValues())e.x!=e.y&&(yield t[0])}GetMultiedge(e,t){return this.GetMultiedgeI(new ot(e,t))}GetMultiedgeI(e){return this.Multiedges.has(e.x,e.y)?this.Multiedges.get(e.x,e.y):new Array}}function HE(r,e){for(let t=0;t<r.length;t++)e[t]=r[t]}class Ts{constructor(e){this.initialize(e)}initialize(e){this.y=e,this.verticesToX=null,this.layers=null}DropEmptyLayers(){const e=new Array(this.Layers.length);let t=0;for(let o=0;o<this.Layers.length;o++)e[o]=t,0==this.Layers[o].length&&t++;if(0==t)return this;const n=new Array(this.y.length);for(let o=0;o<n.length;o++)n[o]=this.y[o]-e[this.y[o]];const i=new Array(this.layers.length-t);for(let o=0;o<this.layers.length;o++)this.layers[o].length>0&&(i[o-e[o]]=Array.from(this.layers[o]));const s=new Ts(n);return s.layers=i,s}updateLayers(e){null==this.layers&&this.InitLayers();for(let t=0;t<this.layers.length;t++)HE(e[t],this.layers[t]);this.UpdateXFromLayers()}UpdateXFromLayers(){null==this.layers&&this.InitLayers(),null==this.verticesToX&&(this.verticesToX=new Array(this.y.length));for(const e of this.layers){let t=0;for(const n of e)this.verticesToX[n]=t++}}get x(){return null!=this.verticesToX||(this.verticesToX=new Array(this.y.length),this.UpdateXFromLayers()),this.verticesToX}ReversedClone(){const e=new Array(this.y.length),t=this.Layers.length-1;for(let n=0;n<this.y.length;n++)e[n]=t-this.y[n];return new Ts(e)}get Layers(){return null!=this.layers||this.InitLayers(),this.layers}set Layers(e){this.layers=e}InitLayers(){let e=0;for(const n of this.y)n+1>e&&(e=n+1);const t=new Array(e).fill(0);for(const n of this.y)t[n]++;this.layers=new Array(e);for(let n=0;n<e;n++)this.layers[n]=new Array(t[n]),t[n]=0;for(let n=0;n<this.y.length;n++){const i=this.y[n];this.layers[i][t[i]++]=n}}}class YE extends Zt{constructor(e,t,n,i){super(i),this.jumpers=new Set,this.possibleJumperFeasibleIntervals=new Map,this.nodeCount=n,this.dag=e,this.layering=t,this.Init()}static Balance(e,t,n,i){new YE(e,t,n,i).run()}run(){for(;this.jumpers.size>0;)this.Jump(this.ChooseJumper())}Init(){this.CalculateLayerCounts(),this.InitJumpers()}Jump(e){this.jumpers.delete(e);const t=this.possibleJumperFeasibleIntervals.get(e),n=this.CalcJumpInfo(t.x,t.y,e);if(null==n)return;this.layering[e]=n.layerToJumpTo;const i=this.nodeCount[e];this.vertsCounts[n.jumperLayer]-=i,this.vertsCounts[n.layerToJumpTo]+=i,this.UpdateRegionsForPossibleJumpersAndInsertJumpers(n.jumperLayer,e)}IsJumper(e){return this.possibleJumperFeasibleIntervals.has(e)}UpdateRegionsForPossibleJumpersAndInsertJumpers(e,t){const n=new Set;for(const s of this.dag.pred(t))this.IsJumper(s)&&(this.CalculateRegionAndInsertJumper(s),n.add(s));for(const s of this.dag.succ(t))this.IsJumper(s)&&(this.CalculateRegionAndInsertJumper(s),n.add(s));const i=new Array;for(const s of this.possibleJumperFeasibleIntervals)n.has(s[0])||s[1].x>e&&s[1].y<e&&i.push(s[0]);for(const s of i)this.CalculateRegionAndInsertJumper(s)}InitJumpers(){const e=new Array(this.dag.nodeCount).fill(0);for(const t of this.dag.edges)e[t.source]-=t.weight,e[t.target]+=t.weight;this.possibleJumperFeasibleIntervals=new Map;for(let t=0;t<this.dag.nodeCount;t++)0==e[t]&&this.CalculateRegionAndInsertJumper(t)}CalculateRegionAndInsertJumper(e){const t=new ot(this.Up(e),this.Down(e));this.possibleJumperFeasibleIntervals.set(e,t),this.InsertJumper(t.x,t.y,e)}InsertJumper(e,t,n){null!=this.CalcJumpInfo(e,t,n)&&this.jumpers.add(n)}CalcJumpInfo(e,t,n){const i=this.layering[n];let s=-1,o=this.vertsCounts[i]-2*this.nodeCount[n];for(let a=e-1;a>i;a--)this.vertsCounts[a]<o&&(o=this.vertsCounts[a],s=a);for(let a=i-1;a>t;a--)this.vertsCounts[a]<o&&(o=this.vertsCounts[a],s=a);if(-1!=s)return{jumperLayer:i,layerToJumpTo:s}}Up(e){let t=Number.MAX_SAFE_INTEGER;for(const n of this.dag.inEdges[e]){const i=this.layering[n.source]-n.separation+1;i<t&&(t=i)}return t==Number.MAX_SAFE_INTEGER&&(t=this.layering[e]+1),t}Down(e){let t=Number.NEGATIVE_INFINITY;for(const n of this.dag.outEdges[e]){const i=this.layering[n.target]+n.separation-1;i>t&&(t=i)}return t==Number.NEGATIVE_INFINITY&&(t=this.layering[e]-1),t}CalculateLayerCounts(){this.vertsCounts=new Array(Math.max(...this.layering)+1).fill(0);for(const e of this.layering)this.vertsCounts[e]+=this.nodeCount[e]}ChooseJumper(){for(const e of this.jumpers)return e;throw new Error("there are no jumpers to choose")}}class Uo{constructor(e){this.Initialize(e)}Initialize(e){this.BaseGraph=e,this.totalNumberOfNodes=e.nodeCount;for(const t of this.BaseGraph.edges)if(null!=t.LayerEdges)for(const n of t.LayerEdges){const i=Math.max(n.Source,n.Target)+1;i>this.totalNumberOfNodes&&(this.totalNumberOfNodes=i)}this.firstVirtualNode=Number.POSITIVE_INFINITY;for(const t of this.BaseGraph.edges)if(null!=t.LayerEdges)for(let n=1;n<t.LayerEdges.length;n++)this.firstVirtualNode=Math.min(this.firstVirtualNode,t.LayerEdges[n].Source);this.firstVirtualNode==Number.POSITIVE_INFINITY&&(this.firstVirtualNode=this.BaseGraph.nodeCount,this.totalNumberOfNodes=this.BaseGraph.nodeCount),this.virtualNodesToInEdges=new Array(this.totalNumberOfNodes-this.firstVirtualNode),this.virtualNodesToOutEdges=new Array(this.totalNumberOfNodes-this.firstVirtualNode);for(const t of this.BaseGraph.edges)if(t.LayerSpan>0)for(const n of t.LayerEdges)n.Target!=t.target&&(this.virtualNodesToInEdges[n.Target-this.firstVirtualNode]=n),n.Source!=t.source&&(this.virtualNodesToOutEdges[n.Source-this.firstVirtualNode]=n)}*edges_(){for(const e of this.BaseGraph.edges)if(e.LayerSpan>0)for(const t of e.LayerEdges)yield t}get Edges(){return this.edges_()}*InEdges(e){if(e<this.BaseGraph.nodeCount)for(const t of this.BaseGraph.inEdges[e])t.source!=t.target&&null!=t.LayerEdges&&(yield Uo.LastEdge(t));else e>=this.firstVirtualNode&&(yield this.InEdgeOfVirtualNode(e))}static LastEdge(e){return e.LayerEdges[e.LayerEdges.length-1]}InEdgeOfVirtualNode(e){return this.virtualNodesToInEdges[e-this.firstVirtualNode]}*OutEdges(e){if(e<this.BaseGraph.nodeCount)for(const t of this.BaseGraph.outEdges[e])t.source!=t.target&&null!=t.LayerEdges&&(yield Uo.FirstEdge(t));else e>=this.firstVirtualNode&&(yield this.OutEdgeOfVirtualNode(e))}OutDegreeIsMoreThanOne(e){return e<this.BaseGraph.nodeCount&&this.BaseGraph.outEdges[e].length>1}InDegreeIsMoreThanOne(e){return e<this.BaseGraph.nodeCount&&this.BaseGraph.inEdges[e].length>1}OutEdgeOfVirtualNode(e){return this.virtualNodesToOutEdges[e-this.firstVirtualNode]}static FirstEdge(e){return e.LayerEdges[0]}InEdgesCount(e){return this.RealInEdgesCount(e)}RealInEdgesCount(e){return e<this.BaseGraph.nodeCount?this.BaseGraph.inEdges[e].filter(t=>null!=t.LayerEdges).length:1}OutEdgesCount(e){return this.RealOutEdgesCount(e)}RealOutEdgesCount(e){return e<this.BaseGraph.nodeCount?this.BaseGraph.outEdges[e].filter(t=>null!=t.LayerEdges).length:1}get NodeCount(){return this.totalNumberOfNodes}IsRealNode(e){return e<this.BaseGraph.nodeCount}IsVirtualNode(e){return!this.IsRealNode(e)}ReversedClone(){const e=this.CreateReversedEdges();return new Uo(new iu(e,this.BaseGraph.nodeCount))}CreateReversedEdges(){const e=new Array;for(const t of this.BaseGraph.edges)t.isSelfEdge()||e.push(t.reversedClone());return e}*Succ(e){for(const t of this.OutEdges(e))yield t.Target}*Pred(e){for(const t of this.InEdges(e))yield t.Source}}var UE=h(5027);class su{constructor(e,t,n,i){this.la=t,this.database=n,this.layeredGraph=e,this.intGraph=i}static InsertLayers(e,t,n,i){const s=new su(e,t,n,i);return s.InsertLayers(),{layeredGraph:s.nLayeredGraph,la:s.Nla.DropEmptyLayers()}}get NLayering(){return this.Nla.y}InsertLayers(){this.EditOldLayering(),this.CreateFullLayeredGraph(),this.InitNewLayering(),this.MapVirtualNodesToEdges(),this.FillUnsortedNewOddLayers(),this.WidenOriginalLayers(),this.SortNewOddLayers()}EditOldLayering(){let e=this.intGraph.nodeCount;for(const t of this.database.RegularMultiedges()){let n=0;const i=t[0];if(n=2*i.LayerSpan,n>0){for(const s of i.LayerEdges)s.Target!=i.target&&(e++,this.UpdateOldLayer(e++,s.Target));e+=(n-1)*(t.length-1)+1}}}UpdateOldLayer(e,t){this.la.Layers[this.la.y[t]][this.la.x[t]]=e}WidenOriginalLayers(){for(let e=0;e<this.la.Layers.length;e++){const t=this.Nla.Layers[2*e];let n=0;for(const i of this.la.Layers[e]){const s=this.virtNodesToIntEdges[i];if(null!=s){const o=this.NLayering[s.source]-this.NLayering[i],a=this.database.Multiedges.get(s.source,s.target);for(const l of a)if(l!=s){const c=l.LayerEdges[o].Source;t[n]=c,this.Nla.x[c]=n++}else t[n]=i,this.Nla.x[i]=n++}else t[n]=i,this.Nla.x[i]=n++}}}FillUnsortedNewOddLayers(){const e=new Array(this.Nla.Layers.length).fill(0);for(let t=this.intGraph.nodeCount;t<this.nLayeredGraph.NodeCount;t++){const n=this.NLayering[t];n%2==1&&(this.Nla.Layers[n][e[n]++]=t)}}MapVirtualNodesToEdges(){this.virtNodesToIntEdges=new Array(this.NLayering.length);for(const e of this.database.AllIntEdges())if(e.source!=e.target&&null!=e.LayerEdges)for(const t of e.LayerEdges)t.Target!=e.target&&(this.virtNodesToIntEdges[t.Target]=e)}CreateFullLayeredGraph(){this.totalNodes=this.intGraph.nodeCount;for(const e of this.database.RegularMultiedges()){let t=0,n=!0;for(const i of e)if(n&&(n=!1,t=2*i.LayerSpan),t>0){i.LayerEdges=new Array(t);for(let s=0;s<t;s++){const o={currentVV:this.totalNodes},a=Wo.GetSource(o,i,s);this.totalNodes=o.currentVV;const l=Wo.GetTarget(this.totalNodes,i,s,t);i.LayerEdges[s]=new oo(a,l,i.CrossingWeight)}su.RegisterDontStepOnVertex(this.database,i)}}this.nLayeredGraph=new Uo(this.intGraph)}SortNewOddLayers(){for(let e=1;e<this.Nla.Layers.length;e+=2){const t=new UE.SortedMap,n=this.Nla.Layers[e];for(const s of n){let o=-1;for(const c of this.nLayeredGraph.InEdges(s))o=c.Source;let a=-1;for(const c of this.nLayeredGraph.OutEdges(s))a=c.Target;const l=this.Nla.x[o]+this.Nla.x[a];if(t.has(l)){const c=t.get(l);if("number"==typeof c){const u=new Array;u.push(c),u.push(s),t.set(l,u)}else c.push(s)}else t.set(l,s)}let i=0;for(const s of t.values())if("number"==typeof s)n[i++]=s;else for(const o of s)n[i++]=o;for(let s=0;s<n.length;s++)this.Nla.x[n[s]]=s}}InitNewLayering(){this.Nla=new Ts(new Array(this.totalNodes));for(let n=0;n<this.layeredGraph.NodeCount;n++)this.NLayering[n]=2*this.la.y[n];for(const[n,i]of this.database.Multiedges.keyValues())if(n.x!=n.y&&this.la.y[n.x]!=this.la.y[n.y]){const s=2*this.la.y[n.x];for(const o of i){let a=s-1;for(const l of o.LayerEdges)l.Target!=o.target&&(this.NLayering[l.Target]=a--)}}const e=new Array(2*this.la.Layers.length-1),t=new Array(e.length).fill(0);for(const n of this.NLayering)t[n]++;for(let n=0;n<t.length;n++)e[n]=new Array(t[n]);this.Nla=new Ts(this.NLayering),this.Nla.Layers=e}static RegisterDontStepOnVertex(e,t){e.Multiedges.get(t.source,t.target).length>1&&e.MultipleMiddles.add(t.LayerEdges[t.LayerEdges.length/2].Source)}}class Wo{constructor(e,t,n,i){this.virtNodesToIntEdges=new Map,this.la=t,this.database=n,this.layeredGraph=e,this.intGraph=i}get NLayering(){return this.Nla.y}static InsertPaths(e,t,n,i){const s=new Wo(e,t,n,i);return s.InsertPaths(),{layeredGraph:s.NLayeredGraph,la:s.Nla}}InsertPaths(){this.CreateFullLayeredGraph(),this.InitNewLayering(),this.MapVirtualNodesToEdges(),this.WidenOriginalLayers()}WidenOriginalLayers(){for(let e=0;e<this.la.Layers.length;e++){const t=this.Nla.Layers[e];let n=0;for(const i of this.la.Layers[e]){const s=this.virtNodesToIntEdges.get(i);if(null!=s){const o=this.NLayering[s.source]-this.NLayering[i],a=this.database.Multiedges.get(s.source,s.target);for(const l of a)if(!this.EdgeIsFlat(l))if(l!=s){const c=l.LayerEdges[o].Source;t[n]=c,this.Nla.x[c]=n++}else t[n]=i,this.Nla.x[i]=n++}else t[n]=i,this.Nla.x[i]=n++}}}EdgeIsFlat(e){return this.la.y[e.source]==this.la.y[e.target]}MapVirtualNodesToEdges(){for(const e of this.database.RegularMultiedges())for(const t of e)if(!this.EdgeIsFlat(t))for(const n of t.LayerEdges)n.Target!=t.target&&this.virtNodesToIntEdges.set(n.Target,t)}CreateFullLayeredGraph(){let e=this.layeredGraph.NodeCount;for(const[t,n]of this.database.Multiedges.keyValues())if(t.x!=t.y){let i=!0,s=0;for(const o of n){if(i)i=!1,s=o.LayerSpan;else if(o.LayerEdges=new Array(s),1==s)o.LayerEdges[0]=new oo(o.source,o.target,o.CrossingWeight);else for(let a=0;a<s;a++){const l={currentVV:e},c=Wo.GetSource(l,o,a);e=l.currentVV;const u=Wo.GetTarget(e,o,a,s);o.LayerEdges[a]=new oo(c,u,o.CrossingWeight)}su.RegisterDontStepOnVertex(this.database,o)}}this.NLayeredGraph=new Uo(this.intGraph)}static GetTarget(e,t,n,i){return n<i-1?e:t.target}static GetSource(e,t,n){return 0==n?t.source:e.currentVV++}InitNewLayering(){this.Nla=new Ts(new Array(this.NLayeredGraph.NodeCount));for(let n=0;n<this.layeredGraph.NodeCount;n++)this.NLayering[n]=this.la.y[n];for(const[n,i]of this.database.Multiedges.keyValues())if(n.x!=n.y&&this.la.y[n.x]!=this.la.y[n.y]){let s=0,o=!0;for(const a of i){o&&(o=!1,s=this.la.y[a.source]);let l=s-1;for(const c of a.LayerEdges)this.NLayering[c.Target]=l--}}const e=new Array(this.la.Layers.length),t=new Array(e.length).fill(0);for(const n of this.NLayering)t[n]++;for(let n=0;n<t.length;n++)e[n]=new Array(t[n]);this.Nla=new Ts(this.NLayering),this.Nla.Layers=e}}const AT=BigInt("6364136223846793005"),WE=(BigInt(1)<<BigInt(32))-BigInt(1),Ps=(BigInt(1)<<BigInt(64))-BigInt(1);class RT{constructor(e,t){this._state=BigInt(0),this._inc=(BigInt(t)<<BigInt(1)|BigInt(1))&Ps,this._random_b(),this._state=this._state+BigInt(e)&Ps,this._random_b()}_random_b(){const e=this._state;this._state=e*AT+this._inc&Ps;const t=(e>>BigInt(18)^e)>>BigInt(27),n=e>>BigInt(59);return(t>>n|t<<(n^BigInt(31)))&WE}_advance(e){e&=Ps;let t=BigInt(1),n=AT,i=BigInt(0),s=this._inc;for(;e>0;)e&BigInt(1)&&(t=t*n&Ps,i=i*n+s&Ps),s=(n+BigInt(1))*s&Ps,n=n*n&Ps,e>>=BigInt(1);this._state=t*this._state+i&Ps}randint(e){if(e>WE)throw new TypeError(`Bound too large: ${e}`);if(e<=0)throw new TypeError(`Empty sample space for r: 0 \u2264 r < ${e}`);const t=BigInt(e),n=(WE^t)%t;for(;;){const i=this._random_b();if(i>=n)return Number(i%t)}}random(){return Number(this._random_b())/Math.pow(2,32)}}let jo;function ou(r){return null==jo&&(jo=new RT(0,0)),jo.randint(r)}function jE(){return null==jo&&(jo=new RT(0,0)),jo.random()}class CT{constructor(e,t,n){this.numberOfCrossings=t,this.la=e,this.virtVertexStart=n}LayerGroupDisbalance(e,t,n){return 1==t?this.LayerGroupDisbalanceWithOrigSeparators(e,n):this.LayerGroupDisbalanceWithVirtSeparators(e,t)}LayerGroupDisbalanceWithVirtSeparators(e,t){let n=0;for(let i=0;i<e.length;){const s=this.CurrentOrigGroupDelta(i,e,t);i=s.i,n+=s.ret}return n}CurrentOrigGroupDelta(e,t,n){let i=0,s=e;for(;s<t.length&&t[s]<this.virtVertexStart;s++)i++;return e=s+1,{ret:Math.abs(n-i),i:e}}LayerGroupDisbalanceWithOrigSeparators(e,t){let n=0;for(let i=0;i<e.length;){const s=this.CurrentVirtGroupDelta(i,e,t);n+=s.ret,i=s.i}return n}CurrentVirtGroupDelta(e,t,n){let i=0,s=e;for(;s<t.length&&t[s]>=this.virtVertexStart;s++)i++;return e=s+1,{ret:Math.abs(n-i),i:e}}static less(e,t){return e.numberOfCrossings<t.numberOfCrossings}static greater(e,t){return e.numberOfCrossings>t.numberOfCrossings}IsPerfect(){return 0==this.numberOfCrossings}}class E4{constructor(e){this.x=e}Compare(e,t){const n=this.x[e.Source]-this.x[t.Source];return 0!=n?n:this.x[e.Target]-this.x[t.Target]}}class y4{constructor(e){this.x=e}Compare(e,t){const n=this.x[e.Target]-this.x[t.Target];return 0!=n?n:this.x[e.Source]-this.x[t.Source]}}class Gn{constructor(e,t){Md(e,t)<0?(this.first=e,this.second=t):(this.first=t,this.second=e)}get First(){return this.first}get Second(){return this.second}get Length(){return wt(this.first,this.second)}CompareTo(e){const t=Md(this.first,e.first);return 0!=t?t:Md(this.second,e.second)}static equal(e,t){return e.first.equal(t.first)&&e.second.equal(t.second)}toString(){return this.first+" "+this.second}}class un{constructor(){this.size_=0,this.mapOfSets=new Map}delete(e){return this.deletexy(e.x,e.y)}clear(){this.mapOfSets.clear(),this.size_=0}get size(){return this.size_}static mk(e){const t=new un;for(const n of e)t.add(n);return t}addxy(e,t){let n=this.mapOfSets.get(e);null==n&&this.mapOfSets.set(e,n=new Set),n.has(t)||this.size_++,n.add(t)}add(e){return this.addxy(e.x,e.y),this}deletexy(e,t){const n=this.mapOfSets.get(e);return!(null==n||!n.delete(t)||(this.size_--,0))}hasxy(e,t){return this.mapOfSets.has(e)&&this.mapOfSets.get(e).has(t)}has(e){return this.hasxy(e.x,e.y)}forEach(e,t){for(const n of this)e(n,n,t)}*entries(){for(const e of this)yield[e,e]}keys(){return this.values()}*values(){for(const e of this.mapOfSets)for(const t of e[1])yield new x(e[0],t)}[(Symbol,Symbol.iterator)](){return this.values()}}function fl(r,e){const t=new Set;for(const n of r)e.has(n)||t.add(n);return t}function gl(r,e){const t=new Set(r);for(const n of e)t.add(n);return t}function zo(r,e){for(const t of e)r.push(t)}function ao(r,e){const t=new Set;if(r.size<e.size)for(const n of r)e.has(n)&&t.add(n);else for(const n of e)r.has(n)&&t.add(n);return t}function au(r,e){for(const t of e)r.add(t)}function Vd(r,e){if(r.size!=e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0}function lu(r,e){const t=[];for(const n of r)for(const i of e(n))t.push(i);return t}function Hd(r,e,t){let n=r.get(e);n||(n=new Set,r.set(e,n)),n.add(t)}function pl(r,e,t){let n=r.get(e);n||(n=new Array,r.set(e,n)),n.push(t)}function IT(r,e,t){let n=r.get(e);n||(n=new Set,r.set(e,n)),n.add(t)}function S4(r,e,t){IT(r,new Gn(e[0],e[1]),t)}function OT(r,e,t){!function A4(r,e,t){const n=r.get(e);n&&n.delete(t)}(r,new Gn(e[0],e[1]),t)}function Yd(){return 0==ou(2)}function R4(r,e,t){const n=t.Layers[r+1],i=t.Layers[r];return i.length<=n.length?function I4(r,e,t){const n=bT(r,e),i=new E4(t.x);n.sort((l,c)=>i.Compare(l,c));let s=1;for(;s<r.length;)s*=2;const o=new Array(2*s-1).fill(0);s--;let a=0;for(const l of n){let c=s+t.x[l.Target];const u=l.CrossingWeight;for(o[c]+=u;c>0;)c%2!=0&&(a+=u*o[c+1]),c=Math.floor((c-1)/2),o[c]+=u}return a}(i,e,t):function C4(r,e,t,n){const i=bT(e,t),s=new y4(n.x);i.sort((c,u)=>s.Compare(c,u));let o=1;for(;o<r.length;)o*=2;const a=new Array(2*o-1).fill(0);o--;let l=0;for(const c of i){let u=o+n.x[c.Source];const S=c.CrossingWeight;for(a[u]+=S;u>0;)u%2!=0&&(l+=S*a[u+1]),u=Math.floor((u-1)/2),a[u]+=S}return l}(n,i,e,t)}function bT(r,e){return lu(r,t=>Array.from(e.InEdges(t)))}function TT(r,e){let t=0;for(let n=0;n<e.Layers.length-1;n++)t+=R4(n,r,e);return t}class ml extends Zt{constructor(e,t,n,i,s,o,a){super(a),this.tryReverse=!0,this.MaxNumberOfAdjacentExchanges=50,this.cancelToken=a,this.tryReverse=t,this.startOfVirtNodes=i,this.layerArrays=n,this.layering=n.y,this.nOfLayers=n.Layers.length,this.layers=n.Layers,this.properLayeredGraph=e,this.hasCrossWeights=s,this.SugSettings=o}get NoGainStepsBound(){return this.SugSettings.NoGainAdjacentSwapStepsBound*this.SugSettings.RepetitionCoefficientForOrdering}get SeedOfRandom(){return ou(100)}get MaxOfIterations(){return this.SugSettings.MaxNumberOfPassesInOrdering*this.SugSettings.RepetitionCoefficientForOrdering}static OrderLayers(e,t,n,i,s){let o=!1;for(const l of e.Edges)if(1!=l.CrossingWeight){o=!0;break}new ml(e,!0,t,n,o,i,s).run()}run(){if(this.Calculate(),this.tryReverse){const e=this.layerArrays.ReversedClone(),t=new ml(this.properLayeredGraph.ReversedClone(),!1,e,this.startOfVirtNodes,this.hasCrossWeights,this.SugSettings,this.cancelToken);if(t.run(),t.measure<this.measure){for(let n=0;n<this.nOfLayers;n++)HE(e.Layers[n],this.layerArrays.Layers[this.nOfLayers-1-n]);this.layerArrays.UpdateXFromLayers()}}}Calculate(){this.Init(),this.layerArraysCopy=ml.CloneLayers(this.layers,this.layerArraysCopy);let e=0;this.measure=new CT(this.layerArraysCopy,TT(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes);for(let t=0;t<this.MaxOfIterations&&e<this.NoGainStepsBound&&!this.measure.IsPerfect();t++){this.LayerByLayerSweep(t%2==0),this.AdjacentExchange();const i=new CT(this.layerArrays.Layers,TT(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes);this.measure<i?(this.Restore(),e++):(i<this.measure||Yd())&&(e=0,this.layerArraysCopy=ml.CloneLayers(this.layers,this.layerArraysCopy),this.measure=i)}}static CloneLayers(e,t){if(null==t){t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n].map(i=>i)}else for(let n=0;n<e.length;n++)HE(e[n],t[n]);return t}Restore(){this.layerArrays.updateLayers(this.layerArraysCopy)}LayerByLayerSweep(e){if(e)for(let t=1;t<this.nOfLayers;t++)this.SweepLayer(t,!0);else for(let t=this.nOfLayers-2;t>=0;t--)this.SweepLayer(t,!1)}SweepLayer(e,t){const n=this.layers[e],i=new Array(n.length);for(let o=0;o<i.length;o++)i[o]=this.WMedian(n[o],t);this.Sort(e,i);const s=this.layerArrays.Layers[e];for(let o=0;o<s.length;o++)this.layerArrays.x[s[o]]=o}Sort(e,t){const n=new UE.SortedMap,i=this.layers[e];let s=0;for(const a of t){const l=i[s++];if(-1!=a)if(n.has(a)){const c=n.get(a);if("number"!=typeof c){const u=c;if(Yd())u.push(l);else{const S=ou(u.length),b=u[S];u[S]=l,u.push(b)}}else{const u=c,S=new Array;n.set(a,S),Yd()?(S.push(u),S.push(l)):(S.push(l),S.push(u))}}else n.set(a,l)}const o=n.values();for(s=0;s<i.length;)if(-1!=t[s]){const a=o.next().value;if("number"==typeof a)i[s++]=a;else{const l=a;for(const c of l){for(;-1==t[s];)s++;i[s++]=c}}}else s++}WMedian(e,t){let n,i;if(t?(n=this.properLayeredGraph.OutEdges(e),i=this.properLayeredGraph.OutEdgesCount(e)):(n=this.properLayeredGraph.InEdges(e),i=this.properLayeredGraph.InEdgesCount(e)),0==i)return-1;const s=new Array(i);let o=0;if(t)for(const u of n)s[o++]=this.X[u.Target];else for(const u of n)s[o++]=this.X[u.Source];s.sort((u,S)=>u-S);const a=Math.floor(i/2);if(i%2==1)return s[a];if(2==i)return.5*(s[0]+s[1]);const l=s[a-1]-s[0],c=s[i-1]-s[a];return Math.floor((s[a-1]*l+s[a]*c)/(l+c))}Init(){const e=new Array(this.nOfLayers).fill(0),t=new kt.K;for(let i=0;i<this.properLayeredGraph.NodeCount;i++)0==this.properLayeredGraph.InEdgesCount(i)&&t.push(i);const n=new Array(this.properLayeredGraph.NodeCount).fill(!1);for(;t.size>0;){const i=t.pop(),s=this.layerArrays.y[i];this.layerArrays.Layers[s][e[s]]=i,this.layerArrays.x[i]=e[s],e[s]++;for(const o of this.properLayeredGraph.Succ(i))n[o]||(n[o]=!0,t.push(o))}this.X=this.layerArrays.x}AdjacentExchange(){this.InitArrays();let e=0,t=!0;for(;t&&e++<this.MaxNumberOfAdjacentExchanges;){t=!1;for(let n=0;n<this.layers.length;n++)t=this.AdjExchangeLayer(n)||t;for(let n=this.layers.length-2;n>=0;n--)t=this.AdjExchangeLayer(n)||t}}AllocArrays(){const e=this.properLayeredGraph.NodeCount;this.predecessors=new Array(e),this.successors=new Array(e),this.pOrder=new Array(e),this.sOrder=new Array(e),this.hasCrossWeights&&(this.outCrossingCount=new Array(e),this.inCrossingCount=new Array(e));for(let t=0;t<e;t++){let n=this.properLayeredGraph.InEdgesCount(t);if(this.predecessors[t]=new Array(n),this.hasCrossWeights){const i=this.inCrossingCount[t]=new Map;for(const s of this.properLayeredGraph.InEdges(t))i.set(s.Source,s.CrossingWeight)}if(this.pOrder[t]=new Map,n=this.properLayeredGraph.OutEdgesCount(t),this.successors[t]=new Array(n),this.sOrder[t]=new Map,this.hasCrossWeights){const i=this.outCrossingCount[t]=new Map;for(const s of this.properLayeredGraph.OutEdges(t))i.set(s.Target,s.CrossingWeight)}}}InitArrays(){null==this.successors&&this.AllocArrays();for(let e=0;e<this.properLayeredGraph.NodeCount;e++)this.pOrder[e]=new Map,this.sOrder[e]=new Map;for(const e of this.layers)this.InitPsArraysForLayer(e)}CalcPair(e,t){const n=this.successors[e],i=this.successors[t],s=this.predecessors[e],o=this.predecessors[t];if(this.hasCrossWeights){const a=this.outCrossingCount[e],l=this.outCrossingCount[t],c=this.inCrossingCount[e],u=this.inCrossingCount[t];return{cuv:this.CountOnArraysUV(n,i,a,l)+this.CountOnArraysUV(s,o,c,u),cvu:this.CountOnArraysUV(i,n,l,a)+this.CountOnArraysUV(o,s,u,c)}}return{cuv:this.CountOnArrays(n,i)+this.CountOnArrays(s,o),cvu:this.CountOnArrays(i,n)+this.CountOnArrays(o,s)}}InitPsArraysForLayer(e){for(const t of e){for(const n of this.properLayeredGraph.Pred(t)){const i=this.sOrder[n],s=i.size;this.successors[n][s]=t,i.set(t,s)}for(const n of this.properLayeredGraph.Succ(t)){const i=this.pOrder[n],s=i.size;this.predecessors[n][s]=t,i.set(t,s)}}}CountOnArrays(e,t){let n=0;const i=t.length-1;let s=-1,o=0;for(const a of e){const l=this.X[a];for(;s<i&&this.X[t[s+1]]<l;s++)o++;n+=o}return n}CountOnArraysUV(e,t,n,i){let s=0;const o=t.length-1;let a=-1,l=0;for(const c of e){const u=this.X[c];let S;for(;a<o&&this.X[S=t[a+1]]<u;a++)l+=i.get(S);s+=l*n.get(c)}return s}AdjExchangeLayer(e){const t=this.layers[e];return!!this.ExchangeWithGainWithNoDisturbance(t)||(this.DisturbLayer(t),this.ExchangeWithGainWithNoDisturbance(t))}Swap(e,t){const n=this.X[e],i=this.X[t],o=this.layers[this.layering[e]];o[n]=t,o[i]=e,this.X[e]=i,this.X[t]=n,this.UpdateSsContainingUv(e,t),this.UpdatePsContainingUv(e,t)}UpdatePsContainingUv(e,t){if(this.successors[e].length<=this.successors[t].length)for(const n of this.successors[e]){const i=this.pOrder[n];if(i.has(t)){const s=i.get(t),o=this.predecessors[n];o[s-1]=t,o[s]=e,i.set(t,s-1),i.set(e,s)}}else for(const n of this.successors[t]){const i=this.pOrder[n];if(i.has(e)){const s=i.get(t),o=this.predecessors[n];o[s-1]=t,o[s]=e,i.set(t,s-1),i.set(e,s)}}}UpdateSsContainingUv(e,t){if(this.predecessors[e].length<=this.predecessors[t].length)for(const n of this.predecessors[e]){const i=this.sOrder[n];if(i.has(t)){const s=i.get(t),o=this.successors[n];o[s-1]=t,o[s]=e,i.set(t,s-1),i.set(e,s)}}else for(const n of this.predecessors[t]){const i=this.sOrder[n];if(i.has(e)){const s=i.get(t),o=this.successors[n];o[s-1]=t,o[s]=e,i.set(t,s-1),i.set(e,s)}}}DisturbLayer(e){for(let t=0;t<e.length-1;t++)this.AdjacentSwapToTheRight(e,t)}ExchangeWithGainWithNoDisturbance(e){let n,t=!1;do{n=this.ExchangeWithGain(e),t=t||n}while(n);return t}ExchangeWithGain(e){for(let t=0;t<e.length-1;t++)if(this.SwapWithGain(e[t],e[t+1]))return this.SwapToTheLeft(e,t),this.SwapToTheRight(e,t+1),!0;return!1}SwapToTheLeft(e,t){for(let n=t-1;n>=0;n--)this.AdjacentSwapToTheRight(e,n)}SwapToTheRight(e,t){for(let n=t;n<e.length-1;n++)this.AdjacentSwapToTheRight(e,n)}AdjacentSwapToTheRight(e,t){const n=e[t],i=e[t+1],s=this.SwapGain(n,i);(s>0||0==s&&Yd())&&this.Swap(n,i)}SwapGain(e,t){const n=this.CalcPair(e,t);return n.cuv-n.cvu}UvAreOfSameKind(e,t){return e<this.startOfVirtNodes&&t<this.startOfVirtNodes||e>=this.startOfVirtNodes&&t>=this.startOfVirtNodes}NeighborsForbidTheSwap(e,t){return this.UpperNeighborsForbidTheSwap(e,t)||this.LowerNeighborsForbidTheSwap(e,t)}LowerNeighborsForbidTheSwap(e,t){let n,i;return 0!=(n=this.properLayeredGraph.OutEdgesCount(e))&&0!=(i=this.properLayeredGraph.OutEdgesCount(t))&&this.X[this.successors[e][n>>1]]<this.X[this.successors[t][i>>1]]}UpperNeighborsForbidTheSwap(e,t){const n=this.properLayeredGraph.InEdgesCount(e),i=this.properLayeredGraph.InEdgesCount(t);return 0!=n&&0!=i&&this.X[this.predecessors[e][n>>1]]<this.X[this.predecessors[t][i>>1]]}CalcDeltaBetweenGroupsToTheLeftAndToTheRightOfTheSeparator(e,t,n){const i=this.GetKindDelegate(n);let s=0;for(let a=t-1;a>=0&&!i(e[a]);a--)s++;let o=0;for(let a=t+1;a<e.length&&!i(e[a]);a++)o++;return s-o}IsOriginal(e){return e<this.startOfVirtNodes}IsVirtual(e){return e>=this.startOfVirtNodes}GetKindDelegate(e){return this.IsVirtual(e)?this.IsVirtual:this.IsOriginal}SwapWithGain(e,t){return this.SwapGain(e,t)>0&&(this.Swap(e,t),!0)}}class cr{constructor(){this.size_=0,this.mapOfMaps=new Map}deleteP(e){return this.delete(e.x,e.y)}clear(){this.mapOfMaps.clear(),this.size_=0}get size(){return this.size_}setxy(e,t,n){let i=this.mapOfMaps.get(e);null==i&&this.mapOfMaps.set(e,i=new Map),i.has(t)||this.size_++,i.set(t,n)}set(e,t){this.setxy(e.x,e.y,t)}delete(e,t){const n=this.mapOfMaps.get(e);return null!=n&&(n.delete(t)&&this.size_--,!0)}hasxy(e,t){const n=this.mapOfMaps.get(e);return null!=n&&n.has(t)}has(e){return this.hasxy(e.x,e.y)}getxy(e,t){const n=this.mapOfMaps.get(e);if(null!=n)return n.get(t)}get(e){return this.getxy(e.x,e.y)}*keys(){for(const e of this.mapOfMaps)for(const t of e[1])yield new x(e[0],t[0])}*[Symbol.iterator](){for(const e of this.mapOfMaps)for(const t of e[1])yield[new x(e[0],t[0]),t[1]]}*values(){for(const e of this.mapOfMaps)for(const t of e[1])yield t[1]}}class Ud{constructor(e,t,n){this.properLayeredGraph=e,this.layerArrays=t,this.nodePositions=n}static UpdateLayerArrays0(e,t,n){new Ud(e,t,n).UpdateLayerArrays()}static UpdateLayerArrays1(e,t){const n=Ud.BuildInitialNodePositions(e,t);this.UpdateLayerArrays0(e,t,n)}static BuildInitialNodePositions(e,t){const n=new Map;for(let i=0;i<t.Layers.length;i++){let s=0,o=0;for(;s<t.Layers[i].length;){for(;s<t.Layers[i].length&&e.IsVirtualNode(t.Layers[i][s]);)s++;for(let a=o;a<s;a++)n.set(t.Layers[i][a],new x(i,o));s<t.Layers[i].length&&n.set(t.Layers[i][s],new x(i,s)),s++,o=s}}return n}UpdateLayerArrays(){let e=this.CreateInitialOrdering();e=this.BuildOrdering(e),this.RestoreLayerArrays(e)}CreateInitialOrdering(){const e=new cr;for(const t of this.layerArrays.Layers)for(const n of t){const i=this.nodePositions.get(n);e.hasxy(i.x,i.y)||e.setxy(i.x,i.y,[]),e.getxy(i.x,i.y).push(n)}return e}BuildOrdering(e){const t=new cr,n=new Map;for(const i of this.layerArrays.Layers)for(const s of i){const o=this.nodePositions.get(s);t.hasxy(o.x,o.y)||(this.BuildNodeOrdering(e.get(o),n),t.set(o,e.get(o)))}return t}BuildNodeOrdering(e,t){e.sort(this.Comparison(t));for(let n=0;n<e.length;n++)t.set(e[n],n)}firstSucc(e){for(const t of this.properLayeredGraph.Succ(e))return t}firstPred(e){for(const t of this.properLayeredGraph.Pred(e))return t}Comparison(e){return(t,n)=>{const i=this.firstSucc(t),s=this.firstSucc(n);let o=this.firstPred(t),a=this.firstPred(n);const l=this.nodePositions.get(i),c=this.nodePositions.get(s),u=this.nodePositions.get(o),S=this.nodePositions.get(a);if(!l.equal(c))return u.equal(S)?l.compareTo(c):u.compareTo(S);if(this.properLayeredGraph.IsVirtualNode(i))return u.equal(S)?Tt(e.get(i),e.get(s)):u.compareTo(S);for(;this.nodePositions.get(o).equal(this.nodePositions.get(a))&&this.properLayeredGraph.IsVirtualNode(o);)o=this.firstPred(o),a=this.firstPred(a);return this.nodePositions.get(o).equal(this.nodePositions.get(a))?Tt(t,n):this.nodePositions.get(o).compareTo(this.nodePositions.get(a))}}RestoreLayerArrays(e){for(const t of this.layerArrays.Layers){let n=0,i=0;for(;n<t.length;){for(;n<t.length&&this.nodePositions.get(t[i]).equal(this.nodePositions.get(t[n]));)n++;const s=e.get(this.nodePositions.get(t[i]));for(let o=i;o<n;o++)t[o]=s[o-i];i=n}}this.layerArrays.UpdateXFromLayers()}}class Wd{static getOrder(e,t){const n=bs(t.map(([i,s])=>new ot(i,s)),e);return Wd.getOrderOnGraph(n)}static getOrderOnGraph(e){const t=new Array(e.nodeCount).fill(!1),n=new kt.K,i=[];let s;for(let o=0;o<e.nodeCount;o++){if(t[o])continue;let a=o;t[a]=!0;let l=0;for(s=e.outEdges[o];;){for(;l<s.length;l++){const c=s[l].target;t[c]||(t[c]=!0,n.push({edges:s,index:l+1,current_u:a}),a=c,s=e.outEdges[a],l=-1)}if(i.push(a),!(n.length>0))break;{const c=n.pop();s=c.edges,l=c.index,a=c.current_u}}}return i.reverse()}}class O4{constructor(e){this.graph=e}GetLayers(){const e=Wd.getOrderOnGraph(this.graph),t=new Array(this.graph.nodeCount).fill(0);let n=this.graph.nodeCount;for(;n-- >0;){const i=e[n];for(const s of this.graph.inEdges[i]){const o=s.source,a=t[i]+s.separation;t[o]<a&&(t[o]=a)}}return t}checkTopoOrder(e){for(const t of this.graph.edges)if(b4(t,e))return!1;return!0}}function b4(r,e){const t=e.findIndex(i=>i==r.source),n=e.findIndex(i=>i==r.target);return-1==t||-1==n||t>=n}class ur{constructor(e){this.inTree=!1,this.cut=ur.infinity,this.iedge=e}get source(){return this.iedge.source}get target(){return this.iedge.target}get separation(){return this.iedge.separation}get crossingWeight(){return this.iedge.CrossingWeight}get weight(){return this.iedge.weight}}ur.infinity=Number.MAX_SAFE_INTEGER;class zE{constructor(e,t,n,i,s){this.v=e,this.outEnum=t,this.i=n,this.inEnum=i,this.j=s}}class NT{constructor(e,t){this.layers=null,this.treeVertices=[],this.vertices=[],this.leaves=[],this.graph=function T4(r){const e=new Array;for(const t of r.edges)e.push(new ur(t));return bs(e,r.nodeCount)}(e),this.networkCancelToken=t;for(let n=0;n<this.graph.nodeCount;n++)this.vertices.push({inTree:!1,lim:-1,low:-1,parent:null})}get weight(){return this.graph.edges.map(e=>e.weight*(this.layers[e.source]-this.layers[e.target])).reduce((e,t)=>e+t,0)}get nodeCount(){return this.vertices.length}setLow(e,t){this.vertices[e].low=t}setLim(e,t){this.vertices[e].lim=t}setParent(e,t){this.vertices[e].parent=t}GetLayers(){return null==this.layers&&this.run(),this.layers}shiftLayerToZero(){const e=Math.min(...this.layers);for(let t=0;t<this.layers.length;t++)this.layers[t]-=e}addVertexToTree(e){this.vertices[e].inTree=!0}vertexInTree(e){return this.vertices[e].inTree}lim(e){return this.vertices[e].lim}low(e){return this.vertices[e].low}parent(e){return this.vertices[e].parent}feasibleTree(){for(this.initLayers();this.tightTree()<this.nodeCount;){const e=this.getNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack();if(null==e)break;let t=this.slack(e);this.vertexInTree(e.source)&&(t=-t);for(const n of this.treeVertices)this.layers[n]+=t}this.initCutValues()}vertexSourceTargetVal(e,t){const n=t.source,i=t.target;return this.lim(n)>this.lim(i)?this.lim(e)<=this.lim(i)&&this.low(i)<=this.lim(e)?0:1:this.lim(e)<=this.lim(n)&&this.low(n)<=this.lim(e)?1:0}incidentEdges(e){return this.graph.incidentEdges(e)}allLowCutsHaveBeenDone(e){for(const t of this.incidentEdges(e))if(t.inTree&&t.cut==ur.infinity&&t!=this.parent(e))return!1;return!0}edgeSourceTargetVal(e,t){return this.vertexSourceTargetVal(e.source,t)-this.vertexSourceTargetVal(e.target,t)}initCutValues(){this.initLimLowAndParent();let e=new kt.K;for(const n of this.leaves)e.push(n);let t=new kt.K;for(;e.length>0;){for(;e.length>0;){const i=e.pop(),s=this.parent(i);if(null==s)continue;let o=0;for(const l of this.incidentEdges(i))if(0==l.inTree){const c=this.edgeSourceTargetVal(l,s);0!=c&&(o+=c*l.weight)}else if(l==s)o+=l.weight;else{const c=s.source==l.target||s.target==l.source?1:-1;o+=this.edgeContribution(l,i)*c}s.cut=o;const a=s.source==i?s.target:s.source;this.allLowCutsHaveBeenDone(a)&&t.push(a)}const n=e;e=t,t=n}}edgeContribution(e,t){let n=e.cut-e.weight;for(const i of this.incidentEdges(t))if(0==i.inTree){const s=this.edgeSourceTargetVal(i,e);-1==s?n+=i.weight:1==s&&(n-=i.weight)}return n}initLimLowAndParent(){this.initLowLimParentAndLeavesOnSubtree(1,0)}initLowLimParentAndLeavesOnSubtree(e,t){const n=new kt.K;let i=this.graph.outEdges[t],s=-1,o=this.graph.inEdges[t],a=-1;for(n.push(new zE(t,i,s,o,a)),this.vertices[t].low=e;n.length>0;){const l=n.pop();let c;t=l.v,i=l.outEnum,s=l.i,o=l.inEnum,a=l.j;do{for(c=!0;++s<i.length;){const u=i[s];!u.inTree||this.vertices[u.target].low>0||(n.push(new zE(t,i,s,o,a)),this.setParent(t=u.target,u),this.setLow(t,e),i=this.graph.outEdges[t],s=-1,o=this.graph.inEdges[t],a=-1)}for(;++a<o.length;){const u=o[a];if(u.inTree&&!(this.vertices[u.source].low>0)){n.push(new zE(t,i,s,o,a)),this.setLow(t=u.source,e),this.setParent(t,u),i=this.graph.outEdges[t],s=-1,o=this.graph.inEdges[t],a=-1,c=!1;break}}}while(!c);this.setLim(t,e++),this.lim(t)==this.low(t)&&this.leaves.push(t)}}updateLimLowLeavesAndParentsUnderNode(e){const t=this.vertices[e].low,n=this.vertices[e].lim;this.leaves=[];for(let i=0;i<this.nodeCount;i++)t<=this.vertices[i].lim&&this.vertices[i].lim<=n?this.setLow(i,0):this.low(i)==this.lim(i)&&this.leaves.push(i);this.initLowLimParentAndLeavesOnSubtree(t,e)}slack(e){return this.layers[e.source]-this.layers[e.target]-e.separation}getNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack(){let e=null,t=ur.infinity;for(const n of this.treeVertices){for(const i of this.graph.outEdges[n]){if(this.vertexInTree(i.source)&&this.vertexInTree(i.target))continue;const s=this.slack(i);if(s<t&&(e=i,t=s,1==s))return i}for(const i of this.graph.inEdges[n]){if(this.vertexInTree(i.source)&&this.vertexInTree(i.target))continue;const s=this.slack(i);if(s<t&&(e=i,t=s,1==s))return i}}return e}tightTree(){this.treeVertices=[];for(const t of this.graph.edges)t.inTree=!1;for(let t=1;t<this.nodeCount;t++)this.vertices[t].inTree=!1;this.vertices[0].inTree=!0,this.treeVertices.push(0);const e=new kt.K;for(e.push(0);e.length>0;){const t=e.pop();for(const n of this.graph.outEdges[t])this.vertexInTree(n.target)||this.layers[n.source]-this.layers[n.target]==n.separation&&(e.push(n.target),this.addVertexToTree(n.target),this.treeVertices.push(n.target),n.inTree=!0);for(const n of this.graph.inEdges[t])this.vertexInTree(n.source)||this.layers[n.source]-this.layers[n.target]==n.separation&&(e.push(n.source),this.addVertexToTree(n.source),this.treeVertices.push(n.source),n.inTree=!0)}return this.treeVertices.length}leaveEnterEdge(){let e,t,n=0;for(const o of this.graph.edges)o.inTree&&o.cut<n&&(n=o.cut,e=o);if(null==e)return null;let i=!1,s=ur.infinity;for(const o of this.graph.edges){const a=this.slack(o);if(0==o.inTree&&-1==this.edgeSourceTargetVal(o,e)&&(a<s||a==s&&(i=1==ou(2)))){if(s=a,t=o,0==s&&!i)break;i=!1}}if(null==t)throw new Error;return{leaving:e,entering:t}}exchange(e,t){const n=this.commonPredecessorOfSourceAndTargetOfF(t);this.createPathForCutUpdates(e,t,n),this.updateLimLowLeavesAndParentsUnderNode(n),this.updateCuts(e),this.updateLayersUnderNode(n)}updateLayersUnderNode(e){const t=new kt.K;t.push(e);for(let n=0;n<this.nodeCount;n++)this.low(e)<=this.lim(n)&&this.lim(n)<=this.lim(e)&&n!=e&&(this.layers[n]=ur.infinity);for(;t.length>0;){const n=t.pop();for(const i of this.graph.outEdges[n])i.inTree&&this.layers[i.target]==ur.infinity&&(this.layers[i.target]=this.layers[n]-i.separation,t.push(i.target));for(const i of this.graph.inEdges[n])i.inTree&&this.layers[i.source]==ur.infinity&&(this.layers[i.source]=this.layers[n]+i.separation,t.push(i.source))}}updateCuts(e){let t=new kt.K,n=new kt.K;for(t.push(e.source),t.push(e.target);t.length>0;){for(;t.length>0;){const s=t.pop(),o=this.parent(s);if(null==o||o.cut!=ur.infinity)continue;let a=0;for(const c of this.incidentEdges(s))if(0==c.inTree)a+=this.edgeSourceTargetVal(c,o)*c.weight;else if(c==o)a+=c.weight;else{const u=o.source==c.target||o.target==c.source?1:-1;a+=this.edgeContribution(c,s)*u}o.cut=a;const l=o.source==s?o.target:o.source;this.allLowCutsHaveBeenDone(l)&&n.push(l)}const i=t;t=n,n=i}}createPathForCutUpdates(e,t,n){let i=t.target;for(;i!=n;){const s=this.parent(i);s.cut=ur.infinity,i=s.source==i?s.target:s.source}t.cut=ur.infinity,e.inTree=!1,t.inTree=!0}commonPredecessorOfSourceAndTargetOfF(e){let t,n;this.lim(e.source)<this.lim(e.target)?(t=this.lim(e.source),n=this.lim(e.target)):(t=this.lim(e.target),n=this.lim(e.source));let i=e.source;for(;!(this.low(i)<=t&&n<=this.lim(i));){const s=this.parent(i);s.cut=ur.infinity,i=s.source==i?s.target:s.source}return i}checkCutValues(){for(const e of this.graph.edges)if(e.inTree){let t=0;for(const n of this.graph.edges)t+=this.edgeSourceTargetVal(n,e)*n.weight;e.cut!=t&&console.log(In.String.Format("cuts are wrong for {0}; should be {1} but is {2}",e,t,e.cut))}}initLayers(){const e=new O4(this.graph);return this.layers=e.GetLayers()}run(){if(0==this.graph.edges.length&&0==this.graph.nodeCount)this.layers=[];else{let e;for(this.feasibleTree();null!=(e=this.leaveEnterEdge());)this.exchange(e.leaving,e.entering);this.shiftLayerToZero()}}}class P4{constructor(e,t){this.graph=e,this.Cancel=t}GetLayers(){return new NT(this.graph,this.Cancel).GetLayers()}ShrunkComponent(e){const t=[];for(const n of e){const i=n[0],s=n[1];for(const o of this.graph.outEdges[i]){const a=new Oi(s,e.get(o.target),o.edge);a.separation=o.separation,a.weight=o.weight,t.push(a)}}return new iu(t,e.size)}}class Dr{constructor(e){this.padding=0,this.alreadySitsOnASpline=!1,this.labelIsToTheLeftOfTheSpline=!1,this.labelIsToTheRightOfTheSpline=!1,this.labelCornersPreserveCoefficient=e}toString(){return"la:ra "+this.la+" "+this.ra+" ta:ba "+this.ta+" "+this.ba+" x:y "+this.x_+" "+this.y_}get leftAnchor(){return this.la}set leftAnchor(e){this.la=Math.max(e,0)}get rightAnchor(){return this.ra}set rightAnchor(e){this.ra=Math.max(e,0)}get topAnchor(){return this.ta}set topAnchor(e){this.ta=Math.max(e,0)}get bottomAnchor(){return this.ba}set bottomAnchor(e){this.ba=Math.max(e,0)}get left(){return this.x_-this.la}get right(){return this.x_+this.ra}get top(){return this.y_+this.ta}set top(e){this.y_+=e-this.ta}get bottom(){return this.y_-this.ba}set bottom(e){this.y_+=e-this.ba}get leftTop(){return new x(this.left,this.top)}get leftBottom(){return new x(this.left,this.bottom)}get rightBottom(){return new x(this.right,this.bottom)}get node(){return this.node_}set node(e){this.node_=e,this.polygonalBoundary_=null}get rightTop(){return new x(this.right,this.top)}static mkAnchor(e,t,n,i,s,o){const a=new Dr(o);return a.la=e,a.ra=t,a.ta=n,a.ba=i,a.node=s,a}get x(){return this.x_}set x(e){this.polygonalBoundary_=null,this.x_=e}get y(){return this.y_}set y(e){this.polygonalBoundary_=null,this.y_=e}get origin(){return new x(this.x,this.y)}get width(){return this.la+this.ra}get height(){return this.ta+this.ba}get hasLabel(){return this.labelIsToTheLeftOfTheSpline||this.labelIsToTheLeftOfTheSpline}get LabelWidth(){if(this.labelIsToTheLeftOfTheSpline)return this.leftAnchor;if(this.labelIsToTheRightOfTheSpline)return this.rightAnchor;throw new Error}get polygonalBoundary(){return null!=this.polygonalBoundary_?this.polygonalBoundary_:this.polygonalBoundary_=Dr.pad(this.creatPolygonalBoundaryWithoutPadding(),this.padding)}static pad(e,t){return 0==t?e:Dr.curveIsConvex(e)?Dr.padConvexCurve(e,t):Dr.padConvexCurve(e.boundingBox.perimeter(),t)}static padCorner(e,t,n,i,s){const o=Dr.getPaddedCorner(t,n,i,s);e.addPoint(o.a),2==o.numberOfPoints&&e.addPoint(o.b)}static padConvexCurve(e,t){const n=new Me;Dr.padCorner(n,e.endPoint.prev,e.endPoint,e.startPoint,t),Dr.padCorner(n,e.endPoint,e.startPoint,e.startPoint.next,t);for(let i=e.startPoint;null!=i.next.next;i=i.next)Dr.padCorner(n,i,i.next,i.next.next,t);return n.closed=!0,n}static getPaddedCorner(e,t,n,i){const s=e.point,o=t.point,a=n.point,l=x.getTriangleOrientation(s,o,a)==Ie.Counterclockwise,c=o.sub(s),u=c.rotate((l?-Math.PI:Math.PI)/2).normalize(),S=c.normalize().add(o.sub(a).normalize());if(S.length<q.intersectionEpsilon)return{a:o.add(u.mul(i)),b:null,numberOfPoints:1};const b=S.normalize().mul(i),L=b.rotate(Math.PI/2),F=(i-b.dot(u))/L.dot(u);return{a:b.add(L.mul(F)).add(o),b:b.sub(L.mul(F)).add(o),numberOfPoints:2}}static*orientations(e){yield x.getTriangleOrientation(e.endPoint.point,e.startPoint.point,e.startPoint.next.point),yield x.getTriangleOrientation(e.endPoint.prev.point,e.endPoint.point,e.startPoint.point);let t=e.startPoint;for(;null!=t.next.next;)yield x.getTriangleOrientation(t.point,t.next.point,t.next.next.point),t=t.next}static curveIsConvex(e){let t=Ie.Collinear;for(const n of Dr.orientations(e))if(n!=Ie.Collinear)if(t==Ie.Collinear)t=n;else if(n!=t)return!1;return!0}creatPolygonalBoundaryWithoutPadding(){return this.hasLabel?this.labelIsToTheLeftOfTheSpline?this.polygonOnLeftLabel():this.polygonOnRightLabel():null==this.nodeBoundary?this.standardRectBoundary():ee.polylineAroundClosedCurve(this.nodeBoundary)}get nodeBoundary(){return null==this.node?null:this.node.boundaryCurve}standardRectBoundary(){const e=new Me;return e.addPoint(this.leftTop),e.addPoint(this.rightTop),e.addPoint(this.rightBottom),e.addPoint(this.leftBottom),e.closed=!0,e}polygonOnLeftLabel(){const e=this.left+(1-this.labelCornersPreserveCoefficient)*this.LabelWidth;return Me.mkClosedFromPoints([new x(e,this.top),this.rightTop,this.rightBottom,new x(e,this.bottom),new x(this.left,this.y)])}polygonOnRightLabel(){const e=this.right-(1-this.labelCornersPreserveCoefficient)*this.LabelWidth;return Me.mkClosedFromPoints([new x(e,this.top),new x(this.right,this.y),new x(e,this.bottom),this.leftBottom,this.leftTop])}move(e){this.x+=e.x,this.y+=e.y}}let N4=(()=>{class r{constructor(t,n,i,s,o){this.xCoords=new Array(4),this.la=t,this.graph=n,this.nOfOriginalVertices=i,this.nOfVertices=this.graph.NodeCount,this.markedEdges=new bi,this.h=this.la.Layers.length,this.root=new Array(this.nOfVertices),this.align=new Array(this.nOfVertices),this.anchors=s,this.nodeSep=o}get CurrentEnumRightUp(){return(this.LR?0:1)+2*(this.BT?0:1)}IsVirtual(t){return t>=this.nOfOriginalVertices}Source(t){return this.BT?t.Source:t.Target}Target(t){return this.BT?t.Target:t.Source}static CalculateXCoordinates(t,n,i,s,o){new r(t,n,i,s,o).Calculate()}Calculate(){this.SortInAndOutEdges(),this.RightUpSetup(),this.CalcBiasedAlignment(),this.LeftUpSetup(),this.CalcBiasedAlignment(),this.RightDownSetup(),this.CalcBiasedAlignment(),this.LeftDownSetup(),this.CalcBiasedAlignment(),this.HorizontalBalancing()}SortInAndOutEdges(){this.FillLowMedians(),this.FillUpperMedins()}FillUpperMedins(){this.upperMedians=new Array(this.graph.NodeCount);for(let t=0;t<this.graph.NodeCount;t++)this.FillUpperMediansForNode(t)}CompareByX(t,n){return this.la.x[t]-this.la.x[n]}FillUpperMediansForNode(t){let n=this.graph.InEdgesCount(t);if(n>0){const i=new Array(n);n=0;for(const o of this.graph.InEdges(t))i[n++]=o.Source;i.sort((o,a)=>this.CompareByX(o,a));const s=Math.floor(n/2);this.upperMedians[t]=2*s==n?new ot(i[s-1],i[s]):i[s]}else this.upperMedians[t]=-1}FillLowMedians(){this.lowMedians=new Array(this.graph.NodeCount);for(let t=0;t<this.graph.NodeCount;t++)this.FillLowMediansForNode(t)}FillLowMediansForNode(t){let n=this.graph.OutEdgesCount(t);if(n>0){const i=new Array(n);n=0;for(const o of this.graph.OutEdges(t))i[n++]=o.Target;i.sort((o,a)=>this.CompareByX(o,a));const s=Math.floor(n/2);this.lowMedians[t]=2*s==n?new ot(i[s-1],i[s]):i[s]}else this.lowMedians[t]=-1}HorizontalBalancing(){let t=-1;const n=new Array(4),i=new Array(4);let s=Number.MAX_VALUE;for(let a=0;a<4;a++){const l={a:0,b:0};this.AssignmentBounds(a,l),n[a]=l.a,i[a]=l.b;const c=i[a]-n[a];c<s&&(t=a,s=c)}for(let a=0;a<4;a++){let l;if(l=r.IsLeftMostAssignment(a)?n[t]-n[a]:i[t]-i[a],this.x=this.xCoords[a],0!=l)for(let c=0;c<this.nOfVertices;c++)this.x[c]=this.x[c]+l}const o=new Array(4);for(let a=0;a<this.nOfVertices;a++)o[0]=this.xCoords[0][a],o[1]=this.xCoords[1][a],o[2]=this.xCoords[2][a],o[3]=this.xCoords[3][a],o.sort((l,c)=>l-c),this.anchors[a].x=(o[1]+o[2])/2}static IsLeftMostAssignment(t){return 0==t||2==t}AssignmentBounds(t,n){if(0==this.nOfVertices)n.a=0,n.b=0;else{this.x=this.xCoords[t],n.a=n.b=this.x[0];for(let i=1;i<this.nOfVertices;i++){const s=this.x[i];s<n.a?n.a=s:s>n.b&&(n.b=s)}}}CalcBiasedAlignment(){this.ConflictElimination(),this.Align()}LeftUpSetup(){this.LR=!1,this.BT=!0}LeftDownSetup(){this.LR=!1,this.BT=!1}RightDownSetup(){this.LR=!0,this.BT=!1}RightUpSetup(){this.LR=!0,this.BT=!0}ConflictElimination(){this.RemoveMarksFromEdges(),this.MarkConflictingEdges()}*UpperEdgeMedians(t){const n=this.BT?this.upperMedians[t]:this.lowMedians[t];if("number"!=typeof n){const s=n;this.LR?(yield s.x,yield s.y):(yield s.y,yield s.x)}else{const s=n;s>=0&&(yield s)}}MarkConflictingEdges(){let t=this.LowerOf(0,this.h-1);const n=t,i=this.UpperOf(0,this.h-1),s=this.NextLower(i);for(;this.IsBelow(t,i);t=this.NextUpper(t))this.IsBelow(n,t)&&this.IsBelow(t,s)&&this.ConflictsWithAtLeastOneInnerEdgeForALayer(t)}NextUpper(t){return this.BT?t+1:t-1}NextLower(t){return this.BT?t-1:t+1}UpperOf(t,n){return this.BT?Math.max(t,n):Math.min(t,n)}LowerOf(t,n){return this.BT?Math.min(t,n):Math.max(t,n)}IsBelow(t,n){return this.BT?t<n:n<t}LeftMost(t,n){return this.LR?Math.min(t,n):Math.max(t,n)}RightMost(t,n){return this.LR?Math.max(t,n):Math.min(t,n)}IsNotRightFrom(t,n){return this.LR?t<=n:n<=t}IsLeftFrom(t,n){return this.LR?t<n:n<t}NextRight(t){return this.LR?t+1:t-1}NextLeft(t){return this.LR?t-1:t+1}ConflictsWithAtLeastOneInnerEdgeForALayer(t){if(t>=0&&t<this.la.Layers.length){const n=this.la.Layers[t];let i=null,s=this.LeftMost(0,n.length-1);const o=this.RightMost(0,n.length-1);for(;this.IsNotRightFrom(s,o)&&null==i;s=this.NextRight(s))i=this.InnerEdgeByTarget(n[s]);if(null!=i){const a=this.Pos(this.Source(i));for(let c=this.LeftMost(0,n.length-1);this.IsLeftFrom(c,s);c=this.NextRight(c))for(const u of this.InEdges(n[c]))this.IsLeftFrom(a,this.Pos(this.Source(u)))&&this.MarkEdge(u);let l=this.Pos(this.Source(i));for(;this.IsNotRightFrom(s,o);){const c=this.AlignmentToTheRightOfInner(n,s,a);if(s=this.NextRight(s),null!=c){const u=this.Pos(this.Source(c));this.MarkEdgesBetweenInnerAndNewInnerEdges(n,i,c,l,u),i=c,l=u}}for(let c=this.NextRight(this.Pos(this.Target(i)));this.IsNotRightFrom(c,o);c=this.NextRight(c))for(const u of this.InEdges(n[c]))this.IsLeftFrom(this.Pos(this.Source(u)),this.Pos(this.Source(i)))&&this.MarkEdge(u)}}}InEdgeOfVirtualNode(t){return this.BT?this.graph.InEdgeOfVirtualNode(t):this.graph.OutEdgeOfVirtualNode(t)}InEdges(t){return this.BT?this.graph.InEdges(t):this.graph.OutEdges(t)}MarkEdgesBetweenInnerAndNewInnerEdges(t,n,i,s,o){let a=this.NextRight(this.Pos(this.Target(n)));for(;this.IsLeftFrom(a,this.Pos(this.Target(i)));a=this.NextRight(a))for(const l of this.InEdges(t[a])){const c=this.Pos(this.Source(l));(this.IsLeftFrom(c,s)||this.IsLeftFrom(o,c))&&this.MarkEdge(l)}}AlignmentToTheRightOfInner(t,n,i){if(1==this.NumberOfInEdges(t[n])){let o=null;for(const a of this.InEdges(t[n]))o=a;return this.IsInnerEdge(o)&&this.IsLeftFrom(i,this.Pos(o.Source))?o:null}return null}NumberOfInEdges(t){return this.BT?this.graph.InEdgesCount(t):this.graph.OutEdgesCount(t)}Pos(t){return this.la.x[t]}InnerEdgeByTarget(t){if(this.IsVirtual(t)){const n=this.InEdgeOfVirtualNode(t);if(this.IsVirtual(this.Source(n)))return n}return null}IsInnerEdge(t){return this.IsVirtual(t.Source)&&this.IsVirtual(t.Target)}RemoveMarksFromEdges(){this.markedEdges.clear()}Align(){this.CreateBlocks(),this.AssignCoordinatesByLongestPath()}AssignCoordinatesByLongestPath(){this.x=this.xCoords[this.CurrentEnumRightUp]=new Array(this.nOfVertices);const t=new Array;for(let s=0;s<this.nOfVertices;s++)if(s==this.root[s]){let o=s;do{const a={neighbor:0};this.TryToGetRightNeighbor(o,a)&&t.push(new Oi(s,this.root[a.neighbor],null)),o=this.align[o]}while(o!=s)}const n=bs(t,this.nOfVertices),i=Wd.getOrderOnGraph(n);for(const s of i)if(s==this.root[s]){let o=0,a=!0,l=s;do{const c={neighbor:0};this.TryToGetLeftNeighbor(l,c)&&(a?(o=this.x[this.root[c.neighbor]]+this.DeltaBetweenVertices(c.neighbor,l),a=!1):o=this.RightMost(o,this.x[this.root[c.neighbor]]+this.DeltaBetweenVertices(c.neighbor,l))),l=this.align[l]}while(l!=s);this.x[s]=o}for(const s of i)if(s==this.root[s]&&0==n.inEdges[s].length){let o=s,a=this.RightMost(-r.infinity,r.infinity);const l=a;do{const c={neighbor:0};this.TryToGetRightNeighbor(o,c)&&(a=this.LeftMost(a,this.x[this.root[c.neighbor]]-this.DeltaBetweenVertices(o,c.neighbor))),o=this.align[o]}while(o!=s);l!=a&&(this.x[s]=a)}for(let s=0;s<this.nOfVertices;s++)s!=this.root[s]&&(this.x[s]=this.x[this.root[s]])}TryToGetRightNeighbor(t,n){const i=this.NextRight(this.Pos(t)),s=this.la.Layers[this.la.y[t]];return i>=0&&i<s.length&&(n.neighbor=s[i],!0)}TryToGetLeftNeighbor(t,n){const i=this.NextLeft(this.Pos(t)),s=this.la.Layers[this.la.y[t]];return i>=0&&i<s.length&&(n.neighbor=s[i],!0)}CreateBlocks(){for(let n=0;n<this.nOfVertices;n++)this.root[n]=this.align[n]=n;const t=this.LowerOf(0,this.h-1);for(let n=this.NextLower(this.UpperOf(0,this.h-1));!this.IsBelow(n,t);n=this.NextLower(n)){const i=this.la.Layers[n];let s=this.LeftMost(-1,this.la.Layers[this.NextUpper(n)].length);const o=this.RightMost(0,i.length-1);for(let a=this.LeftMost(0,i.length-1);this.IsNotRightFrom(a,o);a=this.NextRight(a)){const l=i[a];for(const c of this.UpperEdgeMedians(l))if(!this.IsMarked(l,c)&&this.IsLeftFrom(s,this.Pos(c))){this.align[c]=l,this.root[l]=this.root[c],this.align[l]=this.root[c],s=this.Pos(c);break}}}}IsMarked(t,n){return this.BT?this.markedEdges.hasxy(n,t):this.markedEdges.hasxy(t,n)}MarkEdge(t){this.markedEdges.addNN(t.Source,t.Target)}DeltaBetweenVertices(t,n){let i;if(this.Pos(t)>this.Pos(n)){const s=t;t=n,n=s,i=-1}else i=1;return(this.anchors[t].rightAnchor+this.anchors[n].leftAnchor+this.nodeSep)*i}}return r.infinity=1e7,r})();class D4 extends nr{constructor(e,t,n,i,s){super(),this.weightMultiplierOfOriginalOriginal=1,this.weightMultOfOneVirtual=3,this.weightMultiplierOfTwoVirtual=8,this.SetEdges(i,s),this.virtualVerticesStart=e.nodeCount,this.virtualVerticesEnd=t.NodeCount-1,this.layeredGraph=t,this.layerArrays=n}EdgeWeightMultiplier(e){const t=e.source,n=e.target;if(t<this.layeredGraph.NodeCount&&this.layerArrays.y[t]==this.layerArrays.y[n]&&this.layerArrays.x[t]==this.layerArrays.x[n]+1)return 0;let i=0,s=-1,o=-1;for(const l of this.outEdges[t])-1==o?o=l.target:s=l.target;return o>=this.virtualVerticesStart&&o<=this.virtualVerticesEnd&&i++,s>=this.virtualVerticesStart&&s<=this.virtualVerticesEnd&&i++,0==i?this.weightMultiplierOfOriginalOriginal:1==i?this.weightMultOfOneVirtual:this.weightMultiplierOfTwoVirtual}SetEdgeWeights(){for(const e of this.edges)e.weight=e.weight*this.EdgeWeightMultiplier(e)}}var On=(()=>{return(r=On||(On={}))[r.Top=0]="Top",r[r.Internal=1]="Internal",r[r.Bottom=2]="Bottom",On;var r})();class El{constructor(e,t){this.groupSplitThreshold=2,this.initialNodes=e,this.groupSplitThreshold=t}static Calculate(e,t=0){return new El(e,t).Calculate()}Calculate(){return this.Calc(this.initialNodes)}Calc(e){if(0==e.length)return null;if(1==e.length)return e[0];const t=e[0].parallelogram;let s,n=1,i=lt.parallelogramOfTwo(t,e[n].parallelogram).area;for(let u=2;u<e.length;u++){const S=lt.parallelogramOfTwo(t,e[u].parallelogram).area;S>i&&(n=u,i=S)}for(let u=0;u<e.length;u++)if(u!=n){s=u;break}i=lt.parallelogramOfTwo(e[n].parallelogram,e[s].parallelogram).area;for(let u=0;u<e.length;u++){if(u==n)continue;const S=lt.parallelogramOfTwo(e[n].parallelogram,e[u].parallelogram).area;S>i&&(s=u,i=S)}const o=new Array,a=new Array;o.push(e[n]),a.push(e[s]);let l=e[n].parallelogram,c=e[s].parallelogram;for(let u=0;u<e.length;u++){if(u==n||u==s)continue;const S=lt.parallelogramOfTwo(l,e[u].parallelogram),b=S.area-l.area,L=lt.parallelogramOfTwo(c,e[u].parallelogram),F=L.area-c.area;o.length*this.groupSplitThreshold<a.length?(o.push(e[u]),l=S):a.length*this.groupSplitThreshold<o.length?(a.push(e[u]),c=L):b<F?(o.push(e[u]),l=S):(a.push(e[u]),c=L)}return{parallelogram:lt.parallelogramOfTwo(l,c),node:{children:[this.Calc(o),this.Calc(a)]},seg:void 0,leafBoxesOffset:void 0}}}class Lr{constructor(e,t,n,i,s,o,a,l){this.topNode=e,this.bottomNode=t,this.topSite=n,this.bottomSite=n.next,this.currentTopSite=n,this.currentBottomSite=n.next,this.layerArrays=i,this.layeredGraph=s,this.originalGraph=o,this.anchors=a,this.layerSeparation=l}static Refine(e,t,n,i,s,o,a,l){new Lr(e,t,n,s,o,a,i,l).Refine()}Refine(){for(this.Init();this.InsertSites(););}FixCorner(e,t,n){if(e.equal(t))return t;const i=x.ClosestPointAtLineSegment(t,e,n);let s=t.sub(i);const o=Math.abs(s.y),a=this.layerSeparation/2;return o>a&&(s=s.mul(a/(2*o))),s.add(t)}InsertSites(){return 0==ou(2)?this.CalculateNewTopSite()||this.CalculateNewBottomSite():this.CalculateNewBottomSite()||this.CalculateNewTopSite()}CalculateNewBottomSite(){const e=this.currentBottomSite.point.sub(this.currentTopSite.point);let n,t=Lr.absCotan(e),i=!1;for(const s of this.bottomCorners()){const o=Lr.absCotan(s.sub(this.currentBottomSite.point));o<t&&(t=o,n=s,i=!0)}return!!i&&!nt(t,Lr.absCotan(e))&&(this.currentBottomSite=Bt.mkSiteSPS(this.currentTopSite,this.FixCorner(this.currentTopSite.point,n,this.currentBottomSite.point),this.currentBottomSite),!0)}static absCotan(e){return Math.abs(e.x/e.y)}CalculateNewTopSite(){const e=this.currentBottomSite.point.sub(this.currentTopSite.point);let n,t=Lr.absCotan(e),i=!1;for(const s of this.topCorners()){const o=Lr.absCotan(s.sub(this.currentTopSite.point));o<t&&(t=o,n=s,i=!0)}return!!i&&!nt(t,Lr.absCotan(e))&&(this.currentTopSite=Bt.mkSiteSPS(this.currentTopSite,this.FixCorner(this.currentTopSite.point,n,this.currentBottomSite.point),this.currentBottomSite),!0)}Init(){this.IsTopToTheLeftOfBottom()?(this.topCorners=()=>this.CornersToTheRightOfTop(),this.bottomCorners=()=>this.CornersToTheLeftOfBottom()):(this.topCorners=()=>this.CornersToTheLeftOfTop(),this.bottomCorners=()=>this.CornersToTheRightOfBottom())}IsTopToTheLeftOfBottom(){return this.topSite.point.x<this.topSite.next.point.x}*NodeCorners(e){for(const t of this.anchors[e].polygonalBoundary.polylinePoints())yield t.point}*CornersToTheLeftOfBottom(){const e=this.layerArrays.x[this.bottomNode],t=this.currentTopSite.point.x,n=this.currentBottomSite.point.x;for(const i of this.LeftFromTheNode(this.NodeLayer(this.bottomNode),e,On.Bottom,t,n))for(const s of this.NodeCorners(i))s.y>this.currentBottomSite.point.y&&Lr.PossibleCorner(t,n,s)&&(yield s)}*CornersToTheLeftOfTop(){const e=this.layerArrays.x[this.topNode],t=this.currentBottomSite.point.x,n=this.currentTopSite.point.x;for(const i of this.LeftFromTheNode(this.NodeLayer(this.topNode),e,On.Top,t,n))for(const s of this.NodeCorners(i))s.y<this.currentTopSite.point.y&&Lr.PossibleCorner(t,n,s)&&(yield s)}*CornersToTheRightOfBottom(){const e=this.layerArrays.x[this.bottomNode],t=this.currentBottomSite.point.x,n=this.currentTopSite.point.x;for(const i of this.RightFromTheNode(this.NodeLayer(this.bottomNode),e,On.Bottom,t,n))for(const s of this.NodeCorners(i))s.y>this.currentBottomSite.point.y&&Lr.PossibleCorner(t,n,s)&&(yield s)}*CornersToTheRightOfTop(){const e=this.layerArrays.x[this.topNode],t=this.currentTopSite.point.x,n=this.currentBottomSite.point.x;for(const i of this.RightFromTheNode(this.NodeLayer(this.topNode),e,On.Top,t,n))for(const s of this.NodeCorners(i))s.y<this.currentTopSite.point.y&&Lr.PossibleCorner(t,n,s)&&(yield s)}static PossibleCorner(e,t,n){return n.x>e&&n.x<t}NodeLayer(e){return this.layerArrays.Layers[this.layerArrays.y[e]]}IsLabel(e){return this.anchors[e].hasLabel}NodeUCanBeCrossedByNodeV(e,t){return!this.IsLabel(e)&&!this.IsLabel(t)&&!!(this.IsVirtualVertex(e)&&this.IsVirtualVertex(t)&&this.AdjacentEdgesIntersect(e,t))}AdjacentEdgesIntersect(e,t){return this.Intersect(this.IncomingEdge(e),this.IncomingEdge(t))||this.Intersect(this.OutcomingEdge(e),this.OutcomingEdge(t))}Intersect(e,t){return(this.layerArrays.x[e.Source]-this.layerArrays.x[t.Source])*(this.layerArrays.x[e.Target]-this.layerArrays.x[t.Target])<0}IncomingEdge(e){for(const t of this.layeredGraph.InEdges(e))return t;throw new Error}OutcomingEdge(e){for(const t of this.layeredGraph.OutEdges(e))return t;throw new Error}IsVirtualVertex(e){return e>=this.originalGraph.shallowNodeCount}*RightFromTheNode(e,t,n,i,s){let o=0,a=0;n==On.Bottom&&(o=Number.MAX_VALUE),n==On.Top&&(a=Number.MAX_VALUE);const l=e[t];for(let c=t+1;c<e.length;c++){const u=e[c];if(this.NodeUCanBeCrossedByNodeV(u,l))continue;const S=this.anchors[u];if(S.left>=s)break;S.right>i&&(S.topAnchor>a+q.distanceEpsilon?(a=S.topAnchor,yield u):S.bottomAnchor>o+q.distanceEpsilon&&(o=S.bottomAnchor,yield u))}}*LeftFromTheNode(e,t,n,i,s){let o=0,a=0;n==On.Bottom&&(o=Number.MAX_VALUE),n==On.Top&&(a=Number.MAX_VALUE);const l=e[t];for(let c=t-1;c>-1;c--){const u=e[c];if(this.NodeUCanBeCrossedByNodeV(u,l))continue;const S=this.anchors[u];if(S.right<=i)break;S.left<s&&(S.topAnchor>a+q.distanceEpsilon?(a=S.topAnchor,yield u):S.bottomAnchor>o+q.distanceEpsilon&&(o=S.bottomAnchor,yield u))}}}class Vn{constructor(e,t,n,i,s,o,a){this.thinRightNodes=new Array,this.thinWestNodes=new Array,this.database=a,this.edgePath=e,this.anchors=t,this.layerArrays=s,this.originalGraph=n,this.settings=i,this.layeredGraph=o,this.eastHierarchy=this.BuildEastHierarchy(),this.westHierarchy=this.BuildWestHierarchy()}BuildEastHierarchy(){const e=this.FindEastBoundaryAnchorCurves(),t=new Array;for(const n of e)t.push(n.pNodeOverICurve());return this.thinEastHierarchy=El.Calculate(this.thinRightNodes),El.Calculate(t)}BuildWestHierarchy(){const e=this.FindWestBoundaryAnchorCurves(),t=new Array;for(const n of e)t.push(n.pNodeOverICurve());return this.thinWestHierarchy=El.Calculate(this.thinWestNodes),El.Calculate(t)}FindEastBoundaryAnchorCurves(){const e=new Array;let t=0;for(const n of this.edgePath){let i=null;for(const s of this.EastBoundaryNodesOfANode(n,po.GetNodeKind(t,this.edgePath))){const o=this.anchors[s];(null==i||i.origin.x>o.origin.x)&&(i=o),e.push(o.polygonalBoundary)}null!=i&&this.thinRightNodes.push(me.mkLinePXY(i.origin,this.originalGraph.right,i.y).pNodeOverICurve()),t++}return e}FindWestBoundaryAnchorCurves(){const e=[];let t=0;for(const n of this.edgePath.nodes()){let i=-1;for(const s of this.LeftBoundaryNodesOfANode(n,po.GetNodeKind(t,this.edgePath)))(-1==i||this.layerArrays.x[s]>this.layerArrays.x[i])&&(i=s),e.push(this.anchors[s].polygonalBoundary);if(-1!=i){const s=this.anchors[i];this.thinWestNodes.push(me.mkLinePXY(s.origin,this.originalGraph.left,s.origin.y).pNodeOverICurve())}t++}return e}*FillRightTopAndBottomVerts(e,t,n){let i=0,s=0;n==On.Bottom?i=Number.MAX_VALUE:n==On.Top&&(s=Number.MAX_VALUE);const o=e[t];for(let a=t+1;a<e.length;a++){const l=e[a],c=this.anchors[l];c.topAnchor>s?this.NodeUCanBeCrossedByNodeV(l,o)||(s=c.topAnchor,c.bottomAnchor>i&&(i=c.bottomAnchor),yield l):c.bottomAnchor>i&&(this.NodeUCanBeCrossedByNodeV(l,o)||(i=c.bottomAnchor,c.topAnchor>s&&(s=c.topAnchor),yield l))}}*FillLeftTopAndBottomVerts(e,t,n){let i=0,s=0;n==On.Top?s=Number.MAX_VALUE:n==On.Bottom&&(i=Number.MAX_VALUE);const o=e[t];for(let a=t-1;a>=0;a--){const l=e[a],c=this.anchors[l];c.topAnchor>s+q.distanceEpsilon?this.NodeUCanBeCrossedByNodeV(l,o)||(s=c.topAnchor,i=Math.max(i,c.bottomAnchor),yield l):c.bottomAnchor>i+q.distanceEpsilon&&(this.NodeUCanBeCrossedByNodeV(l,o)||(s=Math.max(s,c.topAnchor),i=c.bottomAnchor,yield l))}}IsVirtualVertex(e){return e>=this.originalGraph.shallowNodeCount}IsLabel(e){return this.anchors[e].hasLabel}NodeUCanBeCrossedByNodeV(e,t){return!this.IsLabel(e)&&!this.IsLabel(t)&&!!(this.IsVirtualVertex(e)&&this.IsVirtualVertex(t)&&this.EdgesIntersectSomewhere(e,t))}EdgesIntersectSomewhere(e,t){return!this.UVAreMiddlesOfTheSameMultiEdge(e,t)&&(this.IntersectAbove(e,t)||this.IntersectBelow(e,t))}UVAreMiddlesOfTheSameMultiEdge(e,t){return!(!this.database.MultipleMiddles.has(e)||!this.database.MultipleMiddles.has(t)||this.SourceOfTheOriginalEdgeContainingAVirtualNode(e)!=this.SourceOfTheOriginalEdgeContainingAVirtualNode(t))}SourceOfTheOriginalEdgeContainingAVirtualNode(e){for(;this.IsVirtualVertex(e);)e=this.IncomingEdge(e).Source;return e}IntersectBelow(e,t){do{const n=this.OutcomingEdge(e),i=this.OutcomingEdge(t);if(this.Intersect(n,i))return!0;e=n.Target,t=i.Target}while(this.IsVirtualVertex(e)&&this.IsVirtualVertex(t));return e==t}IntersectAbove(e,t){do{const n=this.IncomingEdge(e),i=this.IncomingEdge(t);if(this.Intersect(n,i))return!0;e=n.Source,t=i.Source}while(this.IsVirtualVertex(e)&&this.IsVirtualVertex(t));return e==t}Intersect(e,t){const n=this.layerArrays.x[e.Source]-this.layerArrays.x[t.Source],i=this.layerArrays.x[e.Target]-this.layerArrays.x[t.Target];return n>0&&i<0||n<0&&i>0}IncomingEdge(e){return this.layeredGraph.InEdgeOfVirtualNode(e)}OutcomingEdge(e){return this.layeredGraph.OutEdgeOfVirtualNode(e)}EastBoundaryNodesOfANode(e,t){return this.FillRightTopAndBottomVerts(this.NodeLayer(e),this.layerArrays.x[e],t)}NodeLayer(e){return this.layerArrays.Layers[this.layerArrays.y[e]]}LeftBoundaryNodesOfANode(e,t){return this.FillLeftTopAndBottomVerts(this.NodeLayer(e),this.layerArrays.x[e],t)}getSpline(e){return this.createRefinedPolyline(e),this.createSmoothedPolyline()}get GetPolyline(){return new wn(this.headSite)}LineSegIntersectBound(e,t){const n=me.mkPP(e,t);return Vn.CurveIntersectsHierarchy(n,this.westHierarchy)||Vn.CurveIntersectsHierarchy(n,this.thinWestHierarchy)||Vn.CurveIntersectsHierarchy(n,this.eastHierarchy)||Vn.CurveIntersectsHierarchy(n,this.thinEastHierarchy)}SegIntersectWestBound(e,t){return Vn.SegIntersectsBound(e,t,this.westHierarchy)||Vn.SegIntersectsBound(e,t,this.thinWestHierarchy)}SegIntersectEastBound(e,t){return Vn.SegIntersectsBound(e,t,this.eastHierarchy)||Vn.SegIntersectsBound(e,t,this.thinEastHierarchy)}TryToRemoveInflectionCorner(e){if(!e.s.next||!e.s.prev||e.s.turn==Ie.Counterclockwise&&this.SegIntersectEastBound(e.s.prev,e.s.next)||e.s.turn==Ie.Clockwise&&this.SegIntersectWestBound(e.s.prev,e.s.next))return e.cut=!1,void(e.s=e.s.next);const t=e.s.next;e.s.prev.next=t,t.prev=e.s.prev,e.s=t,e.cut=!0}static SegIntersectsBound(e,t,n){return Vn.CurveIntersectsHierarchy(me.mkPP(e.point,t.point),n)}static CurveIntersectsHierarchy(e,t){if(null==t||!lt.intersect(e.pNodeOverICurve().parallelogram,t.parallelogram))return!1;if(t.node.hasOwnProperty("children")){const n=t.node;return Vn.CurveIntersectsHierarchy(e,n.children[0])||Vn.CurveIntersectsHierarchy(e,n.children[1])}return null!=ee.intersectionOne(e,t.seg,!1)}static Flat(e){return x.getTriangleOrientation(e.prev.point,e.point,e.next.point)==Ie.Collinear}Reverse(){const e=new Vn(this.edgePath,this.anchors,this.originalGraph,this.settings,this.layerArrays,this.layeredGraph,this.database);let t=this.headSite,n=null;for(;null!=t;)e.headSite=t.clone(),e.headSite.next=n,null!=n&&(n.prev=e.headSite),n=e.headSite,t=t.next;return e}createRefinedPolyline(e){this.CreateInitialListOfSites();let n,t=this.headSite;for(let i=0;i<this.edgePath.count;i++)n=t.next,this.RefineBeetweenNeighborLayers(t,this.EdgePathNode(i),this.EdgePathNode(i+1)),t=n;this.TryToRemoveInflections(),e&&this.OptimizeShortPath()}RefineBeetweenNeighborLayers(e,t,n){Lr.Refine(t,n,e,this.anchors,this.layerArrays,this.layeredGraph,this.originalGraph,this.settings.LayerSeparation)}CreateInitialListOfSites(){let e=this.headSite=Bt.mkSiteP(this.EdgePathPoint(0));for(let t=1;t<=this.edgePath.count;t++)e=Bt.mkSiteSP(e,this.EdgePathPoint(t))}get TailSite(){let e=this.headSite;for(;null!=e.next;)e=e.next;return e}OptimizeForThreeSites(){const e=this.EdgePathNode(0),t=this.EdgePathNode(2),n=this.anchors[e],i=this.anchors[t];if(nt(n.x,i.x))return;const s={ax:n.x,bx:i.x,sign:0};if(!this.FindLegalPositions(n,i,s))return;const o=(n.y-i.y)/(n.bottom-i.top),a=.5*(s.ax+s.bx),l=s.sign*(.5*(s.ax-s.bx));s.ax=a+o*(l*s.sign),s.bx=a-o*(l*s.sign),this.headSite.point=new x(s.ax,n.y);const c=this.headSite.next,u=c.point.y;c.point=new x(this.MiddlePos(s.ax,s.bx,n,i,u),u),c.next.point=new x(s.bx,i.y),this.anchors[this.EdgePathNode(1)].x=c.point.x}OptimizeForTwoSites(){const e=this.EdgePathNode(0),t=this.EdgePathNode(1),n=this.anchors[e],i=this.anchors[t];if(nt(n.x,i.x))return;const s={ax:n.x,bx:i.x,sign:0};if(!this.FindPositions(n,i,s))return;const o=(n.y-i.y)/(n.bottom-i.top),a=.5*(s.ax+s.bx),l=s.sign*(.5*(s.ax-s.bx));s.ax=a+o*(l*s.sign),s.bx=a-o*(l*s.sign),this.headSite.point=new x(s.ax,n.y),this.headSite.next.point=new x(s.bx,i.y)}FindLegalPositions(e,t,n){return!!this.FindPositions(e,t,n)&&this.PositionsAreLegal(n.ax,n.bx,n.sign,e,t,this.EdgePathNode(1))}FindPositions(e,t,n){let i,s;if(n.ax<n.bx?(n.sign=1,s=Math.max(n.ax,t.left),i=Math.min(e.right,n.bx)):(n.sign=-1,s=Math.max(e.left,n.bx),i=Math.min(t.right,n.ax)),s<=i)n.bx=.5*(s+i),n.ax=.5*(s+i);else{if(this.OriginToOriginSegCrossesAnchorSide(e,t))return!1;1==n.sign?(n.ax=e.right-.1*e.rightAnchor,n.bx=t.left):(n.ax=e.left+.1*e.leftAnchor,n.bx=t.right)}return!0}OriginToOriginSegCrossesAnchorSide(e,t){const n=me.mkPP(e.origin,t.origin);return e.x<t.x&&ee.CurvesIntersect(n,me.mkPP(e.rightBottom,e.rightTop))||ee.CurvesIntersect(n,me.mkPP(t.leftBottom,e.leftTop))||e.x>t.x&&ee.CurvesIntersect(n,me.mkPP(e.leftBottom,e.leftTop))||ee.CurvesIntersect(n,me.mkPP(t.rightBottom,e.rightTop))}OptimizeShortPath(){this.edgePath.count>2||(2==this.edgePath.count&&null!=this.headSite.next.next&&null==this.headSite.next.next.next&&null==this.anchors[this.EdgePathNode(1)].node?this.OptimizeForThreeSites():1==this.edgePath.count&&this.OptimizeForTwoSites())}PositionsAreLegal(e,t,n,i,s,o){if(!nt(e,t)&&(e-t)*n>0)return!1;const a=this.anchors[o],l=this.MiddlePos(e,t,i,s,a.y);return!!this.MiddleAnchorLegal(l,o,a)&&!this.LineSegIntersectBound(new x(e,i.bottom),new x(t,s.top))}MiddleAnchorLegal(e,t,n){const i=this.NodeLayer(t),s=this.layerArrays.x[t],o=e-n.x;return!(s>0&&this.anchors[i[s-1]].right>o+n.left||s<i.length-1&&this.anchors[i[s+1]].left<o+n.right)}MiddlePos(e,t,n,i,s){const o=n.y-s,a=s-i.y;return(e*o+t*a)/(o+a)}TryToRemoveInflections(){if(this.TurningAlwaySameDirection())return;let e=!0;for(;e;){e=!1;for(const t={s:this.headSite,cut:!1};t.s;)this.TryToRemoveInflectionCorner(t),e=t.cut||e}}TurningAlwaySameDirection(){let e=0;for(let t=this.headSite.next;null!=t&&null!=t.next;t=t.next){const n=t.turn;if(0==e)n>0?e=1:n<0&&(e=-1);else if(e*n<0)return!1}return!0}EdgePathPoint(e){return this.anchors[this.EdgePathNode(e)].origin}EdgePathNode(e){return e==this.edgePath.count?this.edgePath.LayerEdges[this.edgePath.count-1].Target:this.edgePath.LayerEdges[e].Source}createSmoothedPolyline(){this.RemoveVerticesWithNoTurns();let e=new ee;const t=this.headSite,n=ee.findCorner(t);return null!=n?(this.createFilletCurve(e,{a:t,b:n.b,c:n.c}),e=this.ExtendCurveToEndpoints(e)):e.addSegment(me.mkPP(this.headSite.point,this.TailSite.point)),e}curveIsLegal(e){return!0}RemoveVerticesWithNoTurns(){for(;this.RemoveVerticesWithNoTurnsOnePass(););}RemoveVerticesWithNoTurnsOnePass(){let e=!1;for(let t=this.headSite;null!=t.next&&null!=t.next.next;t=t.next)Vn.Flat(t.next)&&(e=!0,t.next=t.next.next,t.next.prev=t);return e}ExtendCurveToEndpoints(e){let t=this.headSite.point;if(!x.closeDistEps(t,e.start)){const n=new ee;n.addSegs([me.mkPP(t,e.start),e]),e=n}return t=this.TailSite.point,x.closeDistEps(t,e.end)||e.addSegment(me.mkPP(e.end,t)),e}createFilletCurve(e,t){for(;this.AddSmoothedCorner(t.a,t.b,t.c,e),t.a=t.b,t.b=t.c,null!=t.b.next;)t.c=t.b.next}AddSmoothedCorner(e,t,n,i){let o,s=.5;do{o=ee.createBezierSeg(s,s,e,t,n),t.previouisBezierCoefficient=s,s/=2}while(this.BezierSegIntersectsBoundary(o));if(s*=2,s<.5){s=.5*(s+2*s);const a=ee.createBezierSeg(s,s,e,t,n);this.BezierSegIntersectsBoundary(a)||(t.nextBezierCoefficient=s,t.previouisBezierCoefficient=s,o=a)}i.segs.length>0&&!x.closeDistEps(i.end,o.start)&&i.addSegment(me.mkPP(i.end,o.start)),i.addSegment(o)}BezierSegIntersectsBoundary(e){return x.signedDoubledTriangleArea(e.B(0),e.B(1),e.B(2))<0?this.BezierSegIntersectsTree(e,this.thinWestHierarchy)||this.BezierSegIntersectsTree(e,this.westHierarchy):this.BezierSegIntersectsTree(e,this.thinEastHierarchy)||this.BezierSegIntersectsTree(e,this.eastHierarchy)}BezierSegIntersectsTree(e,t){if(null==t)return!1;if(lt.intersect(e.pNodeOverICurve().parallelogram,t.parallelogram)){if(t.node.hasOwnProperty("children")){const n=t.node;return this.BezierSegIntersectsTree(e,n.children[0])||this.BezierSegIntersectsTree(e,n.children[1])}return Vn.BezierSegIntersectsBoundary(e,t.seg)}return!1}static BezierSegIntersectsBoundary(e,t){for(const n of ee.getAllIntersections(e,t,!1)){if(!(t instanceof ee))return!0;if(ee.realCutWithClosedCurve(n,t,!1))return!0}return!1}}class yl{constructor(e=null){this.parents=new Set,this.children=new Set,this.ports=new Set,this.BoundaryCurve=e}get Parents(){return Array.from(this.parents.values())}get Children(){return Array.from(this.children.values())}get BoundaryCurve(){return this.boundaryCurve}set BoundaryCurve(e){this.boundaryCurve=e}get BoundingBox(){return this.BoundaryCurve.boundingBox}get Ports(){return this.ports}static mkShape(){return new yl(null)}get IsGroup(){return this.children.size>0}*Descendants(){const e=new eo.c;for(const t of this.Children)e.enqueue(t);for(;e.length>0;){const t=e.dequeue();yield t;for(const n of t.Children)e.enqueue(n)}}*Ancestors(){const e=new eo.c;for(const t of this.Parents)e.enqueue(t);for(;e.length>0;){const t=e.dequeue();yield t;for(const n of t.Parents)e.enqueue(n)}}AddParent(e){this.parents.add(e),e.children.add(this)}AddChild(e){e.parents.add(this),this.children.add(e)}RemoveChild(e){this.children.delete(e),e.parents.delete(this)}RemoveParent(e){this.parents.delete(e),e.children.delete(this)}ToString(){return this.UserData?this.UserData.toString():"null"}}class KE{}class Qi extends KE{constructor(e,t){super(),this.curve=this.curve,this.location=t.clone()}get Location(){return this.location}set Location(e){this.location=e}Translate(e){this.location=this.location.add(e)}get Curve(){return this.curve}set Curve(e){this.curve=e}}class lo extends Qi{constructor(e,t,n){super(null,t().add(n)),this.LocationOffset=n,this.CurveDelegate=e,this.CenterDelegate=t}static mk(e,t){return new lo(e,t,new x(0,0))}get CenterDelegate(){return this.centerDelegate}set CenterDelegate(e){this.centerDelegate=e}get CurveDelegate(){return this.curveDelegate}set CurveDelegate(e){this.curveDelegate=e}get LocationOffset(){return this.locationOffset}set LocationOffset(e){this.locationOffset=e}get Location(){return this.CenterDelegate().add(this.LocationOffset)}get Curve(){return this.CurveDelegate()}}let Xe=(()=>{class r{static mkDebugCurveTWCILD(t,n,i,s,o,a,l=!1){const c=new r;return c.transparency=t,c.width=n,c.color=i,c.icurve=s,c.label=o,c.dashArray=a,c.drawPN=l,c}static mkDebugCurveTWCI(t,n,i,s){return r.mkDebugCurveTWCILD(t,n,i,s,null,null)}static mkDebugCurveWCI(t,n,i){return r.mkDebugCurveTWCI(255,t,n,i)}static mkDebugCurveCI(t,n){return r.mkDebugCurveWCI(1,t,n)}static mkDebugCurveI(t){return r.mkDebugCurveCI("Black",t)}}return r.colors=["DeepSkyBlue","IndianRed","Orange","Gold","DarkRed","Plum","Red","Violet","Indigo","Yellow","OrangeRed","Tomato","Purple","SaddleBrown","Green","Navy","Aqua","Pink","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","Lime","BurlyWood","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","CadetBlue","Chartreuse","DarkBlue","DarkCyan","DarkGoldenrod","DarkGray","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkTurquoise","DarkViolet","DeepPink","DimGray","DodgerBlue","Firebrick","FloralWhite","ForestGreen","Fuchsia","CodeAnalysis","Gainsboro","GhostWhite","Goldenrod","Gray","GreenYellow","Honeydew","HotPink","Ivory","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSteelBlue","LightYellow","LimeGreen","Linen","Magenta","Maroon","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Olive","OliveDrab","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","PowderBlue","RosyBrown","RoyalBlue","Salmon","SandyBrown","SeaGreen","CodeAnalysis","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Transparent","Turquoise","Aquamarine","Azure","Beige","Wheat","White","WhiteSmoke","YellowGreen","Khaki","AntiqueWhite"],r})();class JE{constructor(e,t,n,i,s){this.color=e,void 0!==t&&(this.item=t),void 0!==n&&(this.parent=n),void 0!==i&&(this.left=i),void 0!==s&&(this.right=s)}toString(){return this.item.toString()}}var He=(()=>{return(r=He||(He={}))[r.Red=0]="Red",r[r.Black=1]="Black",He;var r})();class xr{constructor(e){this.comparer=e,this.count=0,this.root=this.nil=new JE(He.Black)}[Symbol.iterator](){return this.allNodes()}clear(){this.root=this.nil=new JE(He.Black)}toNull(e){return e!=this.nil?e:null}isEmpty(){return this.root==this.nil}getComparer(){return this.comparer}getRoot(){return this.root}find(e,t=this.root){let n;for(;t!=this.nil&&0!=(n=this.comparer(e,t.item));)t=n<0?t.left:t.right;return this.toNull(t)}findFirst(e,t=this.root){if(t==this.nil)return null;let n=null;for(;t!=this.nil;)t=e(t.item)?(n=t).left:t.right;return n}findLast(e,t=this.root){if(t==this.nil)return null;let n=null;for(;t!=this.nil;)t=e(t.item)?(n=t).right:t.left;return n}treeMinimum(e=this.root){for(;e.left!=this.nil;)e=e.left;return this.toNull(e)}treeMaximum(e=this.root){for(;e.right!=this.nil;)e=e.right;return this.toNull(e)}next(e){if(e.right!=this.nil)return this.treeMinimum(e.right);let t=e.parent;for(;t!=this.nil&&e==t.right;)e=t,t=t.parent;return this.toNull(t)}previous(e){if(e.left!=this.nil)return this.treeMaximum(e.left);let t=e.parent;for(;t!=this.nil&&e==t.left;)e=t,t=t.parent;return this.toNull(t)}leftRotate(e){const t=e.right;e.right=t.left,t.left!=this.nil&&(t.left.parent=e),t.parent=e.parent,e.parent==this.nil?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}rightRotate(e){const t=e.left;e.left=t.right,t.right!=this.nil&&(t.right.parent=e),t.parent=e.parent,e.parent==this.nil?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}deleteFixup(e){for(;e!=this.root&&e.color==He.Black;)if(e==e.parent.left){let t=e.parent.right;t.color==He.Red&&(t.color=He.Black,e.parent.color=He.Red,this.leftRotate(e.parent),t=e.parent.right),t.left.color==He.Black&&t.right.color==He.Black?(t.color=He.Red,e=e.parent):(t.right.color==He.Black&&(t.left.color=He.Black,t.color=He.Red,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=He.Black,t.right.color=He.Black,this.leftRotate(e.parent),e=this.root)}else{let t=e.parent.left;t.color==He.Red&&(t.color=He.Black,e.parent.color=He.Red,this.rightRotate(e.parent),t=e.parent.left),t.right.color==He.Black&&t.left.color==He.Black?(t.color=He.Red,e=e.parent):(t.left.color==He.Black&&(t.right.color=He.Black,t.color=He.Red,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=He.Black,t.left.color=He.Black,this.rightRotate(e.parent),e=this.root)}e.color=He.Black}deleteSubTree(e){let t;if(e.left==this.nil||e.right==this.nil)t=e;else for(t=e.right;t.left!=this.nil;)t=t.left;const n=t.left!=this.nil?t.left:t.right;return n.parent=t.parent,t.parent==this.nil?this.root=n:t==t.parent.left?t.parent.left=n:t.parent.right=n,t!=e&&(e.item=t.item),t.color==He.Black&&this.deleteFixup(n),this.toNull(e)}deleteNodeInternal(e){this.count--,this.deleteSubTree(e)}remove(e){const t=this.find(e);return null!=t?(this.count--,this.deleteSubTree(t)):null}insert(e){const t=this.treeInsert(e);return this.insertPrivate(t),this.toNull(t)}treeInsert(e){let t=this.nil,n=this.root,i=0;for(;n!=this.nil;)t=n,i=this.comparer(e,n.item),n=i<0?n.left:n.right;const s=new JE(He.Black,e,t,this.nil,this.nil);return t==this.nil?this.root=s:i<0?t.left=s:t.right=s,this.toNull(s)}insertPrivate(e){for(this.count++,e.color=He.Red;e!=this.root&&e.parent.color==He.Red;)if(e.parent==e.parent.parent.left){const t=e.parent.parent.right;t.color==He.Red?(e.parent.color=He.Black,t.color=He.Black,e.parent.parent.color=He.Red,e=e.parent.parent):(e==e.parent.right&&this.leftRotate(e=e.parent),e.parent.color=He.Black,e.parent.parent.color=He.Red,this.rightRotate(e.parent.parent))}else{const t=e.parent.parent.left;t.color==He.Red?(e.parent.color=He.Black,t.color=He.Black,e.parent.parent.color=He.Red,e=e.parent.parent):(e==e.parent.left&&this.rightRotate(e=e.parent),e.parent.color=He.Black,e.parent.parent.color=He.Red,this.leftRotate(e.parent.parent))}this.root.color=He.Black}*allNodes(){if(this.isEmpty())return;let e=this.treeMinimum();for(;null!=e;)yield e.item,e=this.next(e)}toString(){let e="{",t=0;for(const n of this.allNodes())e+=n.toString(),t!=this.count-1&&(e+="\n"),t++;return e+"}"}}class $E{constructor(e){this.heapSize=0,this.A=[],this.compare=e}Enqueue(e){let t=this.heapSize+1;this.A[t]=e,this.heapSize++;let i,s,n=t>>1;for(;t>1&&this.Less(i=this.A[t],s=this.A[n]);)this.A[n]=i,this.A[t]=s,t=n,n=t>>1}Dequeue(){if(this.heapSize<1)throw new Error;const e=this.A[1],t=this.A[this.heapSize];return this.heapSize--,this.ChangeMinimum(t),e}ChangeMinimum(e){this.A[1]=e;let t=1,n=2,i=!1;for(;n<this.heapSize&&!i;){i=!0;const s=this.A[n],o=this.A[n+1];this.compare(s,o)<0?this.compare(s,e)<0&&(this.A[t]=s,this.A[n]=e,i=!1,t=n,n=t<<1):this.compare(o,e)<0&&(this.A[t]=o,this.A[n+1]=e,i=!1,t=n+1,n=t<<1)}if(n==this.heapSize){const s=this.A[n];this.compare(s,e)<0&&(this.A[t]=s,this.A[n]=e)}}get Count(){return this.heapSize}Less(e,t){return this.compare(e,t)<0}GetMinimum(){return this.A[1]}}class Ns{}class wl extends Ns{constructor(e){super(),this.Vertex=e}get Site(){return this.Vertex.point}get Polyline(){return this.Vertex.polyline}}class L4 extends wl{constructor(e){super(e)}}class x4{constructor(e){this.lineSweeper=e}Compare(e,t){switch(x.getTriangleOrientation(t.Start,t.End,this.x)){case Ie.Collinear:return 0;case Ie.Clockwise:return 1;default:return-1}}SetOperand(e){this.x=this.IntersectionOfSideAndSweepLine(e)}IntersectionOfSideAndSweepLine(e){const t=e.Direction.dot(this.lineSweeper.SweepDirection),n=(this.lineSweeper.Z-e.Start.dot(this.lineSweeper.SweepDirection))/t;return e.Start.add(e.Direction.mul(n))}}class M4 extends Ns{constructor(e){super(),this.site=e}get Site(){return this.site}}class DT{constructor(e,t){this.PreviousZ=Number.NEGATIVE_INFINITY,this.z=Number.NEGATIVE_INFINITY,this.Obstacles=null!=e?e:[],this.SweepDirection=t,this.DirectionPerp=t.rotate(-Math.PI/2),this.EventQueue=new $E((n,i)=>this.Compare(n,i)),this.ObstacleSideComparer=new x4(this),this.LeftObstacleSideTree=new xr((n,i)=>this.ObstacleSideComparer.Compare(n,i)),this.RightObstacleSideTree=new xr((n,i)=>this.ObstacleSideComparer.Compare(n,i))}get EventQueue(){return this.eventQueue}set EventQueue(e){this.eventQueue=e}get DirectionPerp(){return this.directionPerp}set DirectionPerp(e){this.directionPerp=e}get Z(){return this.z}set Z(e){e>this.z+q.tolerance&&(this.PreviousZ=this.z),this.z=e}GetZS(e){return this.SweepDirection.dot(e.Site)}GetZP(e){return this.SweepDirection.dot(e)}SegmentIsNotHorizontal(e,t){return Math.abs(e.sub(t).dot(this.SweepDirection))>q.distanceEpsilon}RemoveLeftSide(e){this.ObstacleSideComparer.SetOperand(e),this.LeftObstacleSideTree.remove(e)}RemoveRightSide(e){this.ObstacleSideComparer.SetOperand(e),this.RightObstacleSideTree.remove(e)}InsertLeftSide(e){this.ObstacleSideComparer.SetOperand(e),this.LeftObstacleSideTree.insert(e)}InsertRightSide(e){this.ObstacleSideComparer.SetOperand(e),this.RightObstacleSideTree.insert(e)}FindFirstObstacleSideToTheLeftOfPoint(e){const t=this.RightObstacleSideTree.findLast(n=>x.pointToTheRightOfLineOrOnLine(e,n.Start,n.End));return null==t?null:t.item}FindFirstObstacleSideToToTheRightOfPoint(e){const t=this.LeftObstacleSideTree.findFirst(n=>!x.pointToTheRightOfLineOrOnLine(e,n.Start,n.End));return null==t?null:t.item}EnqueueEvent(e){this.eventQueue.Enqueue(e)}InitQueueOfEvents(){for(const e of this.Obstacles)this.EnqueueLowestPointsOnObstacles(e);if(null!=this.Ports)for(const e of this.Ports.values())this.EnqueueEvent(new M4(e))}EnqueueLowestPointsOnObstacles(e){const t=this.GetLowestPoint(e);this.EnqueueEvent(new L4(t))}GetLowestPoint(e){let t=e.startPoint,n=e.startPoint.next;for(;null!=n;n=n.next)this.Less(n.point,t.point)&&(t=n);return t}Compare(e,t){return this.ComparePoints(e.Site,t.Site)}Less(e,t){return this.ComparePoints(e,t)<0}ComparePoints(e,t){let n=this.SweepDirection.dot(e),i=this.SweepDirection.dot(t);return n<i?-1:n>i?1:(n=this.directionPerp.dot(e),i=this.directionPerp.dot(t),n<i?-1:n>i?1:0)}}class Hn{constructor(e,t,n=1){this.LengthMultiplier=1,(Hn.closeuv(e,t)||Hn.closeuv(t,e))&&console.log(e),this.Source=e,this.Target=t,this.Weight=n}static closeuv(e,t){return x.closeDistEps(e.point,Hn.u,.1)&&x.closeDistEps(t.point,Hn.v,.1)}get SourcePoint(){return this.Source.point}get TargetPoint(){return this.Target.point}get Length(){return this.SourcePoint.sub(this.TargetPoint).length*this.LengthMultiplier}toString(){return In.String.Format("{0}->{1} ({2})",this.Source,this.Target,this.Weight)}ReversedClone(){return new Hn(this.Target,this.Source)}Clone(){return new Hn(this.Source,this.Target)}}Hn.u=new x(545.833,840.458),Hn.v=new x(606.1667261889578,786.2917261889578),Hn.DefaultWeight=1;class Xi extends Hn{static constructorVV(e,t){return new Xi(e,t,0)}constructor(e,t,n=0){super(e,t,n)}}class vl{constructor(e){this._inEdges=new Array,this._outEdges=new xr((t,n)=>this.Compare(t,n)),this.point=e}get InEdges(){return this._inEdges}get OutEdges(){return this._outEdges}get Degree(){return this._inEdges.length+this.OutEdges.count}InEdgesLength(){return this._inEdges.length}addInEdge(e){this._inEdges.push(e)}get IsTerminal(){return this._isTerminal}set IsTerminal(e){this._isTerminal=e}get IsShortestPathTerminal(){return this._isShortestPathTerminal}set IsShortestPathTerminal(e){this._isShortestPathTerminal=e}toString(){return this.point.toString()}RemoveOutEdge(e){this.OutEdges.remove(e)}RemoveInEdge(e){const t=this._inEdges.indexOf(e);if(-1==t)return;const n=this._inEdges.length-1;t!=n&&(this._inEdges[t]=this._inEdges[n]),this._inEdges.pop()}static FindFirst(e,t){return vl.FindFirst_t(e.root,e,t)}static FindFirst_t(e,t,n){if(e==t.nil)return null;let i=null;for(;e!=t.nil;)e=e.item.TargetPoint.compareTo(n)>=0?(i=e).left:e.right;return i}get(e){let t=vl.FindFirst(this.OutEdges,e.point);return null!=t&&t.item.Target==e||(t=vl.FindFirst(e.OutEdges,this.point),null!=t&&t.item.Target==this)?t.item:null}Compare(e,t){return e.TargetPoint.compareTo(t.TargetPoint)}ClearEdges(){this._outEdges.clear(),this._inEdges=[]}}class tn{constructor(){this._prevEdgesMap=new Map,this.visVertexToId=new Map,this.VertexFactory=e=>new vl(e),this.pointToVertexMap=new cr}*edges_(){for(const e of this.pointToVertexMap.values())for(const t of e.OutEdges)yield t}get Edges(){return this.edges_()}ClearPrevEdgesTable(){this._prevEdgesMap.clear()}ShrinkLengthOfPrevEdge(e,t){this._prevEdgesMap.get(e).LengthMultiplier=t}PreviosVertex(e){const t=this._prevEdgesMap.get(e);return t?t.Source==e?t.Target:t.Source:null}SetPreviousEdge(e,t){this._prevEdgesMap.set(e,t)}AddHole(e){let t=e.startPoint;for(;t!=e.endPoint;)this.AddEdgePlPl(t,t.next),t=t.next;this.AddEdgePlPl(e.endPoint,e.startPoint)}static*OrientHolesClockwise(e){for(const t of e)for(let n=t.startPoint;;n=n.next){const i=x.getTriangleOrientation(n.point,n.next.point,n.next.next.point);if(i!=Ie.Collinear){yield i==Ie.Clockwise?t:t.reverse();break}}}AddVertexP(e){const t=this.pointToVertexMap.get(e);if(t)return t;const n=this.VertexFactory(e);return this.pointToVertexMap.set(e,n),n}AddVertexV(e){this.pointToVertexMap.set(e.point,e)}ContainsVertex(e){return this.pointToVertexMap.has(e)}static AddEdgeVV(e,t){let n;if(n=e.get(t))return n;if(e==t)throw new Error("Self-edges are not allowed");const i=new Hn(e,t);return e.OutEdges.insert(i),t.InEdges.push(i),i}AddEdgePlPl(e,t){this.AddEdgePP(e.point,t.point)}static AddEdge(e){e.Source.OutEdges.insert(e),e.Target.addInEdge(e)}AddEdgeF(e,t,n){let i=this.FindVertex(e),s=null;if(null!=i&&(s=this.FindVertex(t),null!=s)){const a=i.get(s);if(a)return a}null==i?(i=this.AddVertexP(e),s=this.AddVertexP(t)):null==s&&(s=this.AddVertexP(t));const o=n(i,s);return i.OutEdges.insert(o),s.addInEdge(o),o}AddEdgePP(e,t){return this.AddEdgeF(e,t,(n,i)=>new Hn(n,i))}FindVertex(e){return this.pointToVertexMap.get(e)}Vertices(){return this.pointToVertexMap.values()}RemoveVertex(e){for(const t of e.OutEdges)t.Target.RemoveInEdge(t);for(const t of e.InEdges)t.Source.RemoveOutEdge(t);this.pointToVertexMap.deleteP(e.point)}FindEdgePP(e,t){const n=this.FindVertex(e);if(null==n)return null;const i=this.FindVertex(t);return null==i?null:n.get(i)}static RemoveEdge(e){e.Source.RemoveOutEdge(e),e.Target.RemoveInEdge(e)}ClearEdges(){for(const e of this.Vertices())e.ClearEdges()}}class qE{constructor(){this.Removed=!1}}class co extends qE{constructor(e,t,n){super(),this.start=e,this.EndVertex=t,this.ConeSide=n}get Start(){return this.start}get End(){return this.EndVertex.point}get Direction(){return this.End.sub(this.Start)}toString(){return"BrokenConeSide: "+this.Start+","+this.End}}class QE{constructor(e,t){this.apex=e,this.coneSweeper=t}get Removed(){return this.removed}set Removed(e){this.removed=e}get Apex(){return this.apex}set Apex(e){this.apex=e}get RightSideDirection(){return this.coneSweeper.ConeRightSideDirection}get LeftSideDirection(){return this.coneSweeper.ConeLeftSideDirection}get RightSide(){return this.rightSide}set RightSide(e){this.rightSide=e,this.rightSide.Cone=this}get LeftSide(){return this.leftSide}set LeftSide(e){this.leftSide=e,this.leftSide.Cone=this}}class LT extends Ns{constructor(e,t){super(),this.site=e,this.coneToClose=t}get ConeToClose(){return this.coneToClose}get Site(){return this.site}toString(){return"ConeClosureEvent "+this.site}}class Zi extends qE{constructor(e){super(),this.Cone=e}get Start(){return this.Cone.Apex}get Direction(){return this.Cone.LeftSideDirection}toString(){return"ConeLeftSide "+this.Start+" "+this.Direction}}class uo extends qE{constructor(e){super(),this.Cone=e}get Start(){return this.Cone.Apex}get Direction(){return this.Cone.RightSideDirection}toString(){return"ConeRightSide "+this.Start+" "+this.Direction}}class jd{constructor(e){this.coneSweeper=e}SetOperand(e){this.x=this.IntersectionOfSegmentAndSweepLine(e)}Compare(e,t){const i=t instanceof co;return e instanceof co?i?this.CompareBrokenSides(e,t):this.CompareObstacleSideAndConeSide(t):i?this.CompareConeSideAndObstacleSide(e,t):jd.CompareNotIntersectingSegs(e,t)}static CompareNotIntersectingSegs(e,t){switch(x.getTriangleOrientation(e.Start,t.Start,t.Start.add(t.Direction))){case Ie.Counterclockwise:return-1;case Ie.Clockwise:return 1;default:return 0}}CompareObstacleSideAndConeSide(e){const t=x.getTriangleOrientation(this.x,e.Start,e.Start.add(e.Direction));return t==Ie.Counterclockwise?-1:t==Ie.Clockwise?1:e instanceof Zi?-1:1}CompareConeSideAndObstacleSide(e,t){const n=x.getTriangleOrientation(this.x,t.start,t.End);return n==Ie.Counterclockwise?-1:n==Ie.Clockwise||e instanceof Zi?1:-1}IntersectionOfSegmentAndSweepLine(e){const t=e.Direction.dot(this.coneSweeper.SweepDirection),n=(this.coneSweeper.Z-e.Start.dot(this.coneSweeper.SweepDirection))/t;return e.Start.add(e.Direction.mul(n))}CompareBrokenSides(e,t){return e.EndVertex==t.EndVertex?jd.CompareNotIntersectingSegs(e.ConeSide,t.ConeSide):x.getTriangleOrientation(this.x,t.start,t.EndVertex.point)==Ie.Counterclockwise?-1:1}}class cu extends Ns{constructor(e,t,n){super(),this.coneLeftSide=e,this.intersectionPoint=t,this.endVertex=n}get EndVertex(){return this.endVertex}get Site(){return this.intersectionPoint}toString(){return"LeftIntersectionEvent "+this.intersectionPoint}}class XE{get Direction(){return this.End.sub(this.Start)}toString(){return this.Start+" "+this.End}}class ZE extends XE{constructor(e){super(),this.Init(e)}Init(e){this.StartVertex=e}get Polyline(){return this.StartVertex.polyline}get Start(){return this.StartVertex.point}get End(){return this.EndVertex.point}}class Sl extends ZE{constructor(e){super(e),this.end=e.nextOnPolyline.point}get End(){return this.end}get EndVertex(){return this.StartVertex.nextOnPolyline}}class Ko extends wl{constructor(e){super(e)}}class xT extends Ns{constructor(e,t,n){super(),this.coneRightSide=e,this.intersectionPoint=t,this.endVertex=n}get EndVertex(){return this.endVertex}set EndVertex(e){this.endVertex=e}get Site(){return this.intersectionPoint}toString(){return"RightIntersectionEvent "+this.intersectionPoint}}class Al extends ZE{constructor(e){super(e),this.end=e.prevOnPolyline.point}get End(){return this.end}get EndVertex(){return this.StartVertex.prevOnPolyline}}class Jo extends wl{constructor(e){super(e)}}class bn extends DT{constructor(e,t,n,i,s,o,a){super(e,t),this.visibilityGraph=s,this.ConeRightSideDirection=n,this.ConeLeftSideDirection=i,this.coneSideComparer=new jd(this),this.leftConeSides=new xr((l,c)=>this.coneSideComparer.Compare(l,c)),this.rightConeSides=new xr((l,c)=>this.coneSideComparer.Compare(l,c)),this.Ports=o,this.BorderPolyline=a,this.PortEdgesCreator=(l,c)=>new Xi(l,c,0)}static Sweep(e,t,n,i,s,o){new bn(e,t,t.rotate(-n/2),t.rotate(n/2),i,s,o).Calculate()}Calculate(){for(this.InitQueueOfEvents();this.EventQueue.Count>0;)this.ProcessEvent(this.EventQueue.Dequeue());null!=this.BorderPolyline&&this.CloseRemainingCones(),this.CreatePortEdges()}CreatePortEdges(){if(null!=this.portEdgesGraph)for(const e of this.portEdgesGraph.Edges)this.visibilityGraph.AddEdgeF(e.SourcePoint,e.TargetPoint,this.PortEdgesCreator)}CloseRemainingCones(){if(0==this.leftConeSides.count)return;let e=this.BorderPolyline.startPoint,t=this.leftConeSides.count;do{const n=this.leftConeSides.treeMinimum().item.Cone;e=this.FindPolylineSideIntersectingConeRightSide(e,n),e=this.GetPolylinePointInsideOfConeAndRemoveCones(e,n),t--}while(this.leftConeSides.count>0&&t>0)}GetPolylinePointInsideOfConeAndRemoveCones(e,t){const n=e.nextOnPolyline,i=bn.FindInsidePoint(e.point,n.point,t);return x.closeDistEps(i,e.point)?(this.AddEdgeAndRemoveCone(t,e.point),this.AddEdgesAndRemoveRemainingConesByPoint(e.point)):x.closeDistEps(i,n.point)?(this.AddEdgeAndRemoveCone(t,n.point),this.AddEdgesAndRemoveRemainingConesByPoint(n.point),e=n):(e=bn.InsertPointIntoPolylineAfter(this.BorderPolyline,e,i),this.AddEdgeAndRemoveCone(t,e.point),this.AddEdgesAndRemoveRemainingConesByPoint(e.point)),e}static FindInsidePoint(e,t,n){return bn.FindInsidePointBool(e,t,n.Apex,n.Apex.add(n.LeftSideDirection),n.Apex.add(n.RightSideDirection))}static FindInsidePointBool(e,t,n,i,s){if(x.closeDistEps(e,t)||x.PointIsInsideCone(e,n,i,s))return e;if(x.PointIsInsideCone(t,n,i,s))return t;const o=x.middle(e,t);return x.pointToTheLeftOfLine(o,n,i)?bn.FindInsidePointBool(o,t,n,i,s):bn.FindInsidePointBool(e,o,n,i,s)}AddEdgesAndRemoveRemainingConesByPoint(e){const t=new Array;for(const n of this.leftConeSides){if(!x.PointToTheRightOfLineOrOnLine(e,n.Start,n.Start.add(n.Direction)))break;t.push(n.Cone)}for(const n of t)this.AddEdgeAndRemoveCone(n,e)}FindPolylineSideIntersectingConeRightSide(e,t){const n=e,i=t.Apex,s=t.Apex.add(this.ConeRightSideDirection);let o=bn.GetSign(e,i,s);for(;;){const a=e.nextOnPolyline,l=bn.GetSign(a,i,s);if(l-o>0)return e;if(o=l,(e=a)==n)throw new Error("cannod decide if the polyline intersects the cone!")}}static GetSign(e,t,n){const i=x.signedDoubledTriangleArea(t,n,e.point);return i<0?1:i>0?-1:0}AddEdgeAndRemoveCone(e,t){null!=this.Ports&&this.Ports.has(e.Apex)?this.CreatePortEdge(e,t):this.visibilityGraph.AddEdgePP(e.Apex,t),this.RemoveCone(e)}CreatePortEdge(e,t){null==this.portEdgesGraph&&(this.portEdgesGraph=new tn);const n=this.portEdgesGraph.FindVertex(e.Apex),i=null!=n?Array.from(n.InEdges).concat(Array.from(n.OutEdges.allNodes())):null;if(i)for(const s of i){const o=(s.Target==n?s.Source:s.Target).point;tn.RemoveEdge(s),this.portEdgesGraph.AddEdgePP(o,t)}this.portEdgesGraph.AddEdgePP(e.Apex,t)}static InsertPointIntoPolylineAfter(e,t,n){let i;return null!=t.next?(i=Pr.mkFromPoint(n),i.prev=t,i.next=t.next,t.next.prev=i,t.next=i):(i=Pr.mkFromPoint(n),i.prev=t,t.next=i,e.endPoint=i),i.polyline=e,e.setInitIsRequired(),i}ProcessEvent(e){e instanceof wl?this.ProcessVertexEvent(e):e instanceof xT?this.ProcessRightIntersectionEvent(e):e instanceof cu?this.ProcessLeftIntersectionEvent(e):(e instanceof LT?e.ConeToClose.Removed||this.RemoveCone(e.ConeToClose):this.ProcessPortObstacleEvent(e),this.Z=this.GetZS(e))}ProcessPortObstacleEvent(e){this.Z=this.GetZS(e),this.GoOverConesSeeingVertexEvent(e),this.CreateConeOnVertex(e)}ProcessLeftIntersectionEvent(e){if(0==e.coneLeftSide.Removed)if(Math.abs(e.EndVertex.point.sub(e.Site).dot(this.SweepDirection))<q.distanceEpsilon)this.RemoveCone(e.coneLeftSide.Cone);else{this.RemoveSegFromLeftTree(e.coneLeftSide),this.Z=this.GetZP(e.Site);const t=new co(e.Site,e.EndVertex,e.coneLeftSide);this.InsertToTree(this.leftConeSides,t),e.coneLeftSide.Cone.LeftSide=t,this.LookForIntersectionOfObstacleSideAndLeftConeSide(e.Site,e.EndVertex),this.TryCreateConeClosureForLeftSide(t)}else this.Z=this.GetZP(e.Site)}TryCreateConeClosureForLeftSide(e){if(e.Cone.RightSide instanceof uo){const t=e.Cone.RightSide;x.getTriangleOrientation(t.Start,t.Start.add(t.Direction),e.EndVertex.point)==Ie.Clockwise&&this.CreateConeClosureEvent(e,t)}}CreateConeClosureEvent(e,t){const n=x.RayIntersectsRayInteriors(e.start,e.Direction,t.Start,t.Direction),i=new LT(n,e.Cone);this.EnqueueEvent(i)}ProcessRightIntersectionEvent(e){if(0==e.coneRightSide.Removed){this.RemoveSegFromRightTree(e.coneRightSide),this.Z=this.GetZP(e.Site);const t=new co(e.Site,e.EndVertex,e.coneRightSide);this.InsertToTree(this.rightConeSides,t),e.coneRightSide.Cone.RightSide=t,this.LookForIntersectionOfObstacleSideAndRightConeSide(e.Site,e.EndVertex),this.TryCreateConeClosureForRightSide(t)}else this.Z=this.GetZP(e.Site)}TryCreateConeClosureForRightSide(e){if(e.Cone.LeftSide instanceof Zi){const n=e.Cone.LeftSide;x.getTriangleOrientation(n.Start,n.Start.add(n.Direction),e.EndVertex.point)==Ie.Counterclockwise&&this.CreateConeClosureEvent(e,n)}}RemoveConesClosedBySegment(e,t){this.CloseConesCoveredBySegment(e,t,this.GetZP(e)>this.GetZP(t)?this.leftConeSides:this.rightConeSides)}CloseConesCoveredBySegment(e,t,n){let i=n.findFirst(a=>x.getTriangleOrientation(a.Start,a.Start.add(a.Direction),e)==Ie.Counterclockwise);if(null==i||!x.IntervalIntersectsRay(e,t,i.item.Start,i.item.Direction))return;const o=new Array;do{o.push(i.item.Cone),i=n.next(i)}while(null!=i&&null!=x.IntervalIntersectsRay(e,t,i.item.Start,i.item.Direction));for(const a of o)this.RemoveCone(a)}ProcessVertexEvent(e){this.Z=this.GetZS(e),this.GoOverConesSeeingVertexEvent(e),this.AddConeAndEnqueueEvents(e)}static Diamond(e){return tr.CreateDiamond(2,2,e)}AddConeAndEnqueueEvents(e){e instanceof Ko?this.CloseConesAddConeAtLeftVertex(e,e.Vertex.nextOnPolyline):(e instanceof Jo||this.CloseConesAddConeAtLeftVertex(e,e.Vertex.nextOnPolyline),this.CloseConesAddConeAtRightVertex(e,e.Vertex.prevOnPolyline))}CloseConesAddConeAtRightVertex(e,t){const n=e.Vertex.nextOnPolyline.point;this.directionPerp.dot(e.Site.sub(n))>q.distanceEpsilon&&this.RemoveConesClosedBySegment(n,e.Vertex.point),this.directionPerp.dot(t.point.sub(e.Site))>q.distanceEpsilon&&this.RemoveConesClosedBySegment(e.Site,t.point);const i=e.Site,s=i.add(this.ConeLeftSideDirection),o=i.add(this.ConeRightSideDirection),a=t.point;this.GetZP(i.sub(n))>q.distanceEpsilon&&this.RemoveRightSide(new Al(e.Vertex.nextOnPolyline)),this.GetZP(i.sub(t.point))>q.distanceEpsilon&&this.RemoveLeftSide(new Sl(t)),this.GetZP(a)+q.distanceEpsilon<this.GetZS(e)&&this.CreateConeOnVertex(e),x.PointToTheRightOfLineOrOnLine(a,i,s)?x.PointToTheLeftOfLineOrOnLine(a,i,o)?this.CaseToTheLeftOfLineOrOnLineConeRp(e,t):(this.GetZP(a.sub(i))>q.distanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndLeftConeSide(e.Site,t),this.InsertRightSide(new Al(e.Vertex))),this.EnqueueRightVertexEvent(new Jo(t))):(this.CreateConeOnVertex(e),x.PointToTheLeftOfLineOrOnLine(a.add(this.DirectionPerp),a,i)&&this.EnqueueRightVertexEvent(new Jo(t)))}CaseToTheLeftOfLineOrOnLineConeRp(e,t){this.EnqueueRightVertexEvent(new Jo(t));const n=new QE(e.Vertex.point,this),i=new co(n.Apex,t,new Zi(n));n.LeftSide=i,n.RightSide=new uo(n);const s=this.InsertToTree(this.rightConeSides,n.RightSide);this.LookForIntersectionWithConeRightSide(s);const o=this.InsertToTree(this.leftConeSides,n.LeftSide);this.FixConeLeftSideIntersections(i,o),this.GetZP(t.point.sub(e.Site))>q.distanceEpsilon&&this.InsertRightSide(new Al(e.Vertex))}LookForIntersectionOfObstacleSideAndRightConeSide(e,t){const n=this.GetLastNodeToTheLeftOfPointInRightSegmentTree(e);if(null!=n&&n.item instanceof uo!=null){const s=x.IntervalIntersectsRay(e,t.point,n.item.Start,this.ConeRightSideDirection);s&&this.SegmentIsNotHorizontal(s,t.point)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(n.item,s,t))}}CreateRightIntersectionEvent(e,t,n){return new xT(e,t,n)}GetLastNodeToTheLeftOfPointInRightSegmentTree(e){return this.rightConeSides.findLast(t=>bn.PointIsToTheRightOfSegment(e,t))}LookForIntersectionOfObstacleSideAndLeftConeSide(e,t){const n=this.GetFirstNodeToTheRightOfPoint(e);if(null==n||!(n.item instanceof Zi))return;const i=n.item,s=x.IntervalIntersectsRay(e,t.point,i.Start,this.ConeLeftSideDirection);s&&this.EnqueueEvent(new cu(i,s,t))}GetFirstNodeToTheRightOfPoint(e){return this.leftConeSides.findFirst(t=>bn.PointIsToTheLeftOfSegment(e,t))}static PointIsToTheLeftOfSegment(e,t){return x.getTriangleOrientation(t.Start,t.Start.add(t.Direction),e)==Ie.Counterclockwise}static PointIsToTheRightOfSegment(e,t){return x.getTriangleOrientation(t.Start,t.Start.add(t.Direction),e)==Ie.Clockwise}FixConeLeftSideIntersections(e,t){do{t=this.leftConeSides.next(t)}while(null!=t&&x.PointToTheRightOfLineOrOnLine(e.Start,t.item.Start,t.item.Start.add(t.item.Direction)));if(null!=t&&t.item instanceof Zi){const n=t.item,i=x.IntervalIntersectsRay(e.start,e.End,n.Start,n.Direction);i&&this.EnqueueEvent(new cu(n,i,e.EndVertex))}}InsertToTree(e,t){return this.coneSideComparer.SetOperand(t),e.insert(t)}CloseConesAddConeAtLeftVertex(e,t){const n=e.Vertex.prevOnPolyline.point;e.Site.sub(n).dot(this.directionPerp)<-q.distanceEpsilon&&this.RemoveConesClosedBySegment(e.Site,n),t.point.sub(e.Site).dot(this.directionPerp)<-q.distanceEpsilon&&this.RemoveConesClosedBySegment(t.point,e.Site);const i=e.Site,s=i.add(this.ConeLeftSideDirection),o=i.add(this.ConeRightSideDirection),a=t.point;this.GetZP(i.sub(n))>q.distanceEpsilon&&this.RemoveLeftSide(new Sl(e.Vertex.prevOnPolyline));const l=this.GetZP(a)-this.Z;l<-q.distanceEpsilon&&this.RemoveRightSide(new Al(t));const c=a.sub(e.Site);if(l<-q.distanceEpsilon||nt(l,0)&&this.GetZP(c)>0&&c.dot(this.directionPerp)>-q.distanceEpsilon)this.CreateConeOnVertex(e);else if(x.PointToTheLeftOfLineOrOnLine(a,i,o))if(x.PointToTheLeftOfLineOrOnLine(a,i,s))this.EnqueueEvent(new Ko(t)),this.GetZP(c)>q.distanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndRightConeSide(e.Site,t),this.InsertLeftSide(new Sl(e.Vertex)));else{this.EnqueueEvent(new Ko(t));const u=new QE(e.Vertex.point,this),S=new co(e.Vertex.point,t,new uo(u));u.RightSide=S,u.LeftSide=new Zi(u),this.LookForIntersectionWithConeLeftSide(this.InsertToTree(this.leftConeSides,u.LeftSide));const b=this.InsertToTree(this.rightConeSides,S);this.FixConeRightSideIntersections(S,b),this.GetZP(c)>q.distanceEpsilon&&this.InsertLeftSide(new Sl(e.Vertex))}else this.CreateConeOnVertex(e),this.EnqueueEvent(new Ko(t))}RemoveCone(e){e.Removed=!0,this.RemoveSegFromLeftTree(e.LeftSide),this.RemoveSegFromRightTree(e.RightSide)}RemoveSegFromRightTree(e){this.coneSideComparer.SetOperand(e);let t=this.rightConeSides.remove(e);if(e.Removed=!0,null==t){const n=this.Z;this.Z=Math.max(this.GetZP(e.Start),this.Z-.01),this.coneSideComparer.SetOperand(e),t=this.rightConeSides.remove(e),this.Z=n}}RemoveSegFromLeftTree(e){if(e.Removed=!0,this.coneSideComparer.SetOperand(e),null==this.leftConeSides.remove(e)){const n=this.Z;this.Z=Math.max(this.GetZP(e.Start),this.Z-.01),this.coneSideComparer.SetOperand(e),this.leftConeSides.remove(e),this.Z=n}}FixConeRightSideIntersections(e,t){do{t=this.rightConeSides.previous(t)}while(null!=t&&x.PointToTheLeftOfLineOrOnLine(e.start,t.item.Start,t.item.Start.add(t.item.Direction)));if(null!=t){let n;if(t.item instanceof uo){const i=t.item;(n=x.IntervalIntersectsRay(e.start,e.End,i.Start,i.Direction))&&this.EnqueueEvent(this.CreateRightIntersectionEvent(i,n,e.EndVertex))}}}CreateConeOnVertex(e){const t=new QE(e.Site,this);t.LeftSide=new Zi(t),t.RightSide=new uo(t);const n=this.InsertToTree(this.leftConeSides,t.LeftSide),i=this.InsertToTree(this.rightConeSides,t.RightSide);this.LookForIntersectionWithConeRightSide(i),this.LookForIntersectionWithConeLeftSide(n)}LookForIntersectionWithConeLeftSide(e){if(e.item instanceof Zi){const n=e.item,i=this.FindFirstObstacleSideToTheLeftOfPoint(n.Start);null!=i&&this.TryIntersectionOfConeLeftSideAndObstacleSide(n,i)}else{const n=e.item;null!=(e=this.leftConeSides.next(e))&&e.item instanceof Zi&&this.TryIntersectionOfConeLeftSideAndObstacleConeSide(e.item,n)}}LookForIntersectionWithConeRightSide(e){if(e.item instanceof uo){const n=e.item,i=this.FindFirstObstacleSideToToTheRightOfPoint(n.Start);null!=i&&this.TryIntersectionOfConeRightSideAndObstacleSide(n,i)}else{const n=e.item;null!=(e=this.rightConeSides.previous(e))&&e.item instanceof uo&&this.TryIntersectionOfConeRightSideAndObstacleConeSide(e.item,n)}}TryIntersectionOfConeRightSideAndObstacleConeSide(e,t){const n=x.IntervalIntersectsRay(t.start,t.End,e.Start,e.Direction);n&&this.EnqueueEvent(this.CreateRightIntersectionEvent(e,n,t.EndVertex))}TryIntersectionOfConeRightSideAndObstacleSide(e,t){const n=x.IntervalIntersectsRay(t.Start,t.End,e.Start,e.Direction);n&&this.EnqueueEvent(this.CreateRightIntersectionEvent(e,n,t.EndVertex))}TryIntersectionOfConeLeftSideAndObstacleConeSide(e,t){const n=x.IntervalIntersectsRay(t.start,t.End,e.Start,e.Direction);n&&this.EnqueueEvent(new cu(e,n,t.EndVertex))}TryIntersectionOfConeLeftSideAndObstacleSide(e,t){const n=x.IntervalIntersectsRay(t.Start,t.End,e.Start,e.Direction);n&&this.EnqueueEvent(new cu(e,n,t.EndVertex))}Show(e,t){let n=Array.from(this.Obstacles).map(i=>Xe.mkDebugCurveTWCI(200,.5,"Blue",i));for(const i of this.rightConeSides)n.push(Xe.mkDebugCurveWCI(.5,"Brown",this.ExtendSegmentToZ(i))),i instanceof co&&n.push(Xe.mkDebugCurveCI("brown",bn.Diamond(i.start))),n.push(Xe.mkDebugCurveWCI(.5,"Green",this.ExtendSegmentToZ(i.Cone.LeftSide))),i.Cone.LeftSide instanceof co&&n.push(Xe.mkDebugCurveCI("green",bn.Diamond(i.Cone.LeftSide.start)));n=n.concat(Array.from(this.visibilityGraph.Edges).map(i=>Xe.mkDebugCurveWCI(2,"Black",me.mkPP(i.SourcePoint,i.TargetPoint)))),n=n.concat(e.map(i=>Xe.mkDebugCurveCI("Red",i)))}ExtendSegmentToZ(e){const t=e.Direction.dot(this.SweepDirection),n=(this.Z+40-e.Start.dot(this.SweepDirection))/t;return me.mkPP(e.Start,e.Start.add(e.Direction.mul(n)))}GoOverConesSeeingVertexEvent(e){let t=this.FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex(e);if(null==t)return;const i=t.item.Cone,s=i.LeftSide;if(bn.VertexIsToTheLeftOfSegment(e,s))return;const o=[i];if(this.coneSideComparer.SetOperand(s),t=this.leftConeSides.find(s),null==t){const a=this.Z;this.Z=Math.max(this.GetZP(s.Start),this.PreviousZ),this.coneSideComparer.SetOperand(s),t=this.leftConeSides.find(s),this.Z=a}if(null!=t||(t=this.GetRbNodeEmergency(t,s),null!=t)){for(t=this.leftConeSides.next(t);null!=t&&!bn.VertexIsToTheLeftOfSegment(e,t.item);)o.push(t.item.Cone),t=this.leftConeSides.next(t);for(const a of o)this.AddEdgeAndRemoveCone(a,e.Site)}}GetRbNodeEmergency(e,t){for(let n=this.leftConeSides.treeMinimum();null!=n;n=this.leftConeSides.next(n))if(n.item==t){e=n;break}return e}static VertexIsToTheLeftOfSegment(e,t){return x.getTriangleOrientation(t.Start,t.Start.add(t.Direction),e.Site)==Ie.Counterclockwise}static VertexIsToTheRightOfSegment(e,t){return x.getTriangleOrientation(t.Start,t.Start.add(t.Direction),e.Site)==Ie.Clockwise}FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex(e){return this.rightConeSides.findFirst(t=>!bn.VertexIsToTheRightOfSegment(e,t))}EnqueueRightVertexEvent(e){this.GetZP(e.Site.sub(e.Vertex.prevOnPolyline.point))>q.tolerance||this.EnqueueEvent(e)}invariant(){for(const e of this.leftConeSides)if(e.Removed)return!1;for(const e of this.rightConeSides)if(e.Removed)return!1;return!0}}class uu extends Zt{constructor(e,t){super(null),this.coneAngle=Math.PI/6,this.ports=new un,this._obstacles=Array.from(tn.OrientHolesClockwise(e)),this._visibilityGraph=t}static mk(e,t,n,i,s){const o=new uu(e,t);return o.Ports=i,o.BorderPolyline=s,o.ConeAngle=n,o}get ConeAngle(){return this.coneAngle}set ConeAngle(e){this.coneAngle=e}get Ports(){return this.ports}set Ports(e){this.ports=e}get BorderPolyline(){return this.borderPolyline}set BorderPolyline(e){this.borderPolyline=e}get Bidirectional(){return this._bidirectional}set Bidirectional(e){this._bidirectional=e}static GetTotalSteps(e){return Math.floor((2*Math.PI-e/2)/e)+1}run(){const e=2*Math.PI-this.coneAngle/2;if(this.Bidirectional)this.HandleBideractionalCase();else{let t;for(let n=0;(t=this.coneAngle*n)<=e;n++)super.ProgressStep(),this.AddDirection(new x(Math.cos(t),Math.sin(t)),this.BorderPolyline,this._visibilityGraph)}}HandleBideractionalCase(){const e=Math.PI/this.coneAngle;for(let t=0;t<e;t++){const n=t*this.coneAngle,i=new tn;this.AddDirection(new x(Math.cos(n),Math.sin(n)),this.BorderPolyline,i);const s=new tn;this.AddDirection(new x(-1*Math.cos(n),-1*Math.sin(n)),this.BorderPolyline,s),this.AddIntersectionOfBothDirectionSweepsToTheResult(i,s)}}AddIntersectionOfBothDirectionSweepsToTheResult(e,t){for(const n of e.Edges)null!=t.FindEdgePP(n.SourcePoint,n.TargetPoint)&&this._visibilityGraph.AddEdgePP(n.SourcePoint,n.TargetPoint)}AddDirection(e,t,n){bn.Sweep(this._obstacles,e,this.coneAngle,n,this.Ports,t)}}class Yn extends KE{constructor(e){super(),this.adjustmentAngle=Math.PI/10,this.hookSize=9,this.curve=e,this.location=this.curve().start}mk(e,t){const n=new Yn(e);return n.HookSize=t,n}get Location(){return this.location}get Curve(){return this.curve()}SetLocation(e){this.location=e}get AdjustmentAngle(){return this.adjustmentAngle}set AdjustmentAngle(e){this.adjustmentAngle=e}get HookSize(){return this.hookSize}set HookSize(e){this.hookSize=e}}class Zr extends lo{constructor(e,t,n=new x(0,0)){super(e,t,n)}get LoosePolyline(){return this.loosePolyline}set LoosePolyline(e){this.loosePolyline=e}static mk(e,t){return new Zr(e,t)}}class hr extends KE{get Location(){return this.curve.value(this.parameter)}set Location(e){throw new Error("Method should not be called.")}static mk(e,t){const n=new hr;return n.curve=e,n.parameter=t,n}get Parameter(){return this.parameter}set Parameter(e){this.parameter=e}get Curve(){return this.curve}set Curve(e){this.curve=e}}class ey extends yl{constructor(e){super(null),this.curveDelegate=e}get BoundaryCurve(){return this.curveDelegate()}set BoundaryCurve(e){if(e)throw new Error("Cannot set BoundaryCurve directly for RelativeShape")}}class Ti{static GetShapes(e,t){const n=new Map;for(const i of e)Ti.ProcessAncestorDescendantCouple(i.target,i.source,n),Ti.InsertEdgePortsToShapes(n,i);for(const i of t)Ti.ProcessAncestorDescendantCouple(i.source,i.target,n),Ti.InsertEdgePortsToShapes(n,i);return Ti.BindShapes(n),Array.from(n.values())}static InsertEdgePortsToShapes(e,t){e.get(t.target).Ports.add(t.targetPort),e.get(t.source).Ports.add(t.sourcePort)}static BindShapes(e){for(const[t,n]of e){if(!(t instanceof Ii))continue;const i=t;for(const s of ty(i)){const o=e.get(s);o&&n.AddChild(o)}}}static ProcessAncestorDescendantCouple(e,t,n){let i=zd(t);for(;;){for(const s of ty(i))Ti.CreateShapeIfNeeeded(s,n);if(i==e)break;i=zd(i)}Ti.CreateShapeIfNeeeded(i,n)}static CreateShapeIfNeeeded(e,t){t.has(e)||t.set(e,new ey(()=>e.boundaryCurve))}static NumberOfActiveNodesIsUnderThreshold(e,t,n){const i=new Set;for(const s of e)if(Ti.SetOfActiveNodesIsLargerThanThreshold(s.target,s.source,i,n))return!1;for(const s of t)if(Ti.SetOfActiveNodesIsLargerThanThreshold(s.source,s.target,i,n))return!1;return!0}static SetOfActiveNodesIsLargerThanThreshold(e,t,n,i){let s=zd(t);for(;;){for(const o of ty(s))if(n.add(o),n.size>i)return!0;if(s==e)break;s=zd(s)}return n.add(s),n.size>i}}function zd(r){return An.getGeom(r.node.parent)}function*ty(r){for(const e of r.graph.shallowNodes)yield An.getGeom(e)}class Pi{constructor(e){this.stamp=0,this.SetPivotAndAllocateHullPointsArray(e)}SetPivotAndAllocateHullPointsArray(e){this.pivot=new x(0,Number.MAX_SAFE_INTEGER);let t=-1,n=0;for(const i of e)(i.y<this.pivot.y||i.y==this.pivot.y&&i.x>this.pivot.x)&&(this.pivot=i,t=n),n++;if(n>=1){this.hullPoints=new Array(n-1),n=0;for(const i of e)n!=t?this.hullPoints[n++]={point:i,deleted:!1,stamp:this.stamp++}:t=-1}}get StackTopPoint(){return this.stack.point}get StackSecondPoint(){return this.stack.next.point}static*CalculateConvexHull(e){const t=new Pi(e);for(const n of t.Calculate())yield n}*Calculate(){if(this.pivot.y!=Number.MAX_SAFE_INTEGER){if(0==this.hullPoints.length)return void(yield this.pivot);this.SortAllPointsWithoutPivot(),this.Scan();for(const e of this.EnumerateStack())yield e}}*EnumerateStack(){let e=this.stack;for(;null!=e;)yield e.point,e=e.next}Scan(){let e=0;for(;this.hullPoints[e].deleted;)e++;for(this.stack={point:this.pivot,next:null},this.Push(e++),e<this.hullPoints.length&&(this.hullPoints[e].deleted?e++:this.Push(e++));e<this.hullPoints.length;)this.hullPoints[e].deleted?e++:this.LeftTurn(e)?this.Push(e++):this.Pop();for(;this.StackHasMoreThanTwoPoints()&&!this.LeftTurnToPivot();)this.Pop()}LeftTurnToPivot(){return x.getTriangleOrientation(this.StackSecondPoint,this.StackTopPoint,this.pivot)==Ie.Counterclockwise}StackHasMoreThanTwoPoints(){return null!=this.stack.next&&null!=this.stack.next.next}Pop(){this.stack=this.stack.next}LeftTurn(e){if(null==this.stack.next)return!0;const t=x.getTriangleOrientationWithIntersectionEpsilon(this.StackSecondPoint,this.StackTopPoint,this.hullPoints[e].point);return t==Ie.Counterclockwise||t!=Ie.Clockwise&&this.BackSwitchOverPivot(this.hullPoints[e].point)}BackSwitchOverPivot(e){return null==this.stack.next.next&&this.StackTopPoint.x>this.pivot.x+q.distanceEpsilon&&e.x<this.pivot.x-q.distanceEpsilon}Push(e){this.stack={point:this.hullPoints[e].point,next:this.stack}}SortAllPointsWithoutPivot(){this.hullPoints.sort(function _4(r){return(e,t)=>{if(e==t)return 0;if(null==e)return-1;if(null==t)return 1;switch(x.getTriangleOrientationWithIntersectionEpsilon(r,e.point,t.point)){case Ie.Counterclockwise:return-1;case Ie.Clockwise:return 1;case Ie.Collinear:const n=e.point.x-r.x,i=t.point.x-r.x;if(n>q.distanceEpsilon&&i<-1*q.distanceEpsilon)return-1;if(n<-1*q.distanceEpsilon&&i>q.distanceEpsilon)return 1;const s=e.point.sub(r),o=t.point.sub(r),a=s.l1-o.l1;return a<0?(e.deleted=!0,-1):a>0?(t.deleted=!0,1):(e.stamp>t.stamp?e.deleted=!0:t.deleted=!0,0)}throw new Error}}(this.pivot))}static createConvexHullAsClosedPolyline(e){return Me.mkClosedFromPoints(Array.from(Pi.CalculateConvexHull(e)))}}function Mr(r,e,t){!r.irect.intersects_rect(e.irect)||(null==r.Left?null==e.Left?t(r.UserData,e.UserData):(Mr(r,e.Left,t),Mr(r,e.Right,t)):null!=e.Left?(Mr(r.Left,e.Left,t),Mr(r.Left,e.Right,t),Mr(r.Right,e.Left,t),Mr(r.Right,e.Right,t)):(Mr(r.Left,e,t),Mr(r.Right,e,t)))}function Un(r,e,t){!r.irect.intersects_rect(e.irect)||(r==e?function B4(r,e){null!=r.Left&&(Un(r.Left,r.Left,e),Un(r.Left,r.Right,e),Un(r.Right,r.Right,e))}(r,t):null==r.Left?null==e.Left?t(r.UserData,e.UserData):(Un(r,e.Left,t),Un(r,e.Right,t)):null!=e.Left?(Un(r.Left,e.Left,t),Un(r.Left,e.Right,t),Un(r.Right,e.Left,t),Un(r.Right,e.Right,t)):(Un(r.Left,e,t),Un(r.Right,e,t)))}function ei(r,e,t){if(!r.irect.intersects_rect(e.irect))return!1;if(r==e)return function F4(r,e){return null!=r.Left&&(ei(r.Left,r.Left,e)||ei(r.Left,r.Right,e)||ei(r.Right,r.Right,e))}(r,t);if(null==r.Left){if(null==e.Left)return t(r.UserData,e.UserData);if(ei(r,e.Left,t)||ei(r,e.Right,t))return!0}else if(null!=e.Left){if(ei(r.Left,e.Left,t)||ei(r.Left,e.Right,t)||ei(r.Right,e.Left,t)||ei(r.Right,e.Right,t))return!0}else if(ei(r.Left,e,t)||ei(r.Right,e,t))return!0;return!1}var Tn=(()=>{return(r=Tn||(Tn={}))[r.Increasing=0]="Increasing",r[r.Decreasing=1]="Decreasing",r[r.Extremum=2]="Extremum",Tn;var r})();class Kd{constructor(e,t){this.f=e,this.length=t}get Sequence(){return this.f}set Sequence(e){this.f=e}get Length(){return this.length}set Length(e){this.length=e}FindMinimum(){let e=0,t=this.length-1,n=e+Math.floor((t-e)/2);const i=this.f(n);if(i>=this.f(0)&&i>=this.f(this.length-1))return this.f(0)<this.f(this.length-1)?0:this.length-1;for(;t-e>1;)switch(n=e+Math.floor((t-e)/2),this.BehaviourAtIndex(n)){case Tn.Decreasing:e=n;break;case Tn.Increasing:t=n;break;case Tn.Extremum:return n}return e==t||this.f(e)<=this.f(t)?e:t}BehaviourAtIndex(e){const t=this.f(e);if(0==e){const s=this.f(1);return s==t?Tn.Extremum:s>t?Tn.Increasing:Tn.Decreasing}if(e==this.length-1){const s=this.f(this.length-2);return s==t?Tn.Extremum:s>t?Tn.Decreasing:Tn.Increasing}const n=t-this.f(e-1);return n*(this.f(e+1)-t)<=0?Tn.Extremum:n>0?Tn.Increasing:Tn.Decreasing}FindMaximum(){let e=0,t=this.length-1,n=e+Math.floor((t-e)/2);const i=this.f(n);if(i<=this.f(0)&&i<=this.f(this.length-1))return this.f(0)>this.f(this.length-1)?0:this.length-1;for(;t-e>1;)switch(n=e+Math.floor((t-e)/2),this.BehaviourAtIndex(n)){case Tn.Decreasing:t=n;break;case Tn.Increasing:e=n;break;case Tn.Extremum:return n}return e==t||this.f(e)>this.f(t)?e:t}}class k4{constructor(e,t){this.f=e,this.length=t}toArray(){const e=[];for(let t=0;t<this.length;t++)e.push(this.f(t));return e}GetAdjustedSequenceForMinimum(){const e=this.f(0),n=(this.f(this.length-1)-e)/(this.length-1);return i=>Math.min(this.f(i),e+n*i)}GetAdjustedSequenceForMaximum(){const e=this.f(0),n=(this.f(this.length-1)-e)/(this.length-1);return i=>Math.max(this.f(i),e+n*i)}FindMinimum(){return this.f(0)==this.f(this.length-1)?new Kd(this.f,this.length).FindMinimum():new Kd(this.GetAdjustedSequenceForMinimum(),this.length).FindMinimum()}FindMaximum(){return this.f(0)==this.f(this.length-1)?new Kd(this.f,this.length).FindMaximum():new Kd(this.GetAdjustedSequenceForMaximum(),this.length).FindMaximum()}}class Jd{constructor(e,t){this.P=e,this.Q=t}LeftFromLineOnP(e,t,n){const i=this.P.pnt(e);return this.upperBranchOnP?x.pointToTheLeftOfLineOrOnLine(n,i,t):x.pointToTheRightOfLineOrOnLine(n,i,t)}LeftFromLineOnQ(e,t,n){const i=this.Q.pnt(e);return this.lowerBranchOnQ?x.pointToTheLeftOfLineOrOnLine(n,i,t):x.pointToTheRightOfLineOrOnLine(n,i,t)}PrevOnP(e){return this.upperBranchOnP?this.P.Prev(e):this.P.Next(e)}PrevOnQ(e){return this.lowerBranchOnQ?this.Q.Prev(e):this.Q.Next(e)}NextOnP(e){return this.upperBranchOnP?this.P.Next(e):this.P.Prev(e)}NextOnQ(e){return this.lowerBranchOnQ?this.Q.Next(e):this.Q.Prev(e)}MedianOnP(e,t){return this.upperBranchOnP?this.P.Median(e,t):this.P.Median(t,e)}MedianOnQ(e,t){return this.lowerBranchOnQ?this.Q.Median(e,t):this.Q.Median(t,e)}ModuleP(e,t){return this.P.Module(this.upperBranchOnP?t-e:e-t)}ModuleQ(e,t){return this.Q.Module(this.lowerBranchOnQ?t-e:e-t)}TangentBetweenBranches(e,t,n,i){for(;t!=e||i!=n;){const s=t!=e?this.MedianOnP(e,t):e,o=i!=n?this.MedianOnQ(n,i):n,a=this.P.pnt(s),l=this.Q.pnt(o);let c=!0;this.ModuleP(e,t)>1?this.LeftFromLineOnP(this.NextOnP(s),a,l)?e=s:this.LeftFromLineOnP(this.PrevOnP(s),a,l)?t=s:c=!1:t!=e?this.LeftFromLineOnP(t,this.P.pnt(e),l)?e=t:this.LeftFromLineOnP(e,this.P.pnt(t),l)?t=e:c=!1:c=!1;let u=!0;this.ModuleQ(n,i)>1?this.LeftFromLineOnQ(this.NextOnQ(o),l,a)?n=o:this.LeftFromLineOnQ(this.PrevOnQ(o),l,a)?i=o:u=!1:i!=n?this.LeftFromLineOnQ(i,this.Q.pnt(n),a)?n=i:this.LeftFromLineOnQ(n,this.Q.pnt(i),a)?i=n:u=!1:u=!1,!c&&!u&&(e=s,t=s,n=o,i=o)}return[e,i]}FindDividingBisector(e){const t={pClosest:void 0,qClosest:void 0,p1:void 0,p2:void 0,q1:void 0,q2:void 0};this.FindClosestFeatures(t),e.bisectorPivot=x.middle(t.pClosest,t.qClosest),e.bisectorRay=t.pClosest.add(t.qClosest).rotate(Math.PI/2)}FindClosestPoints(){const e={q2:void 0,p1:void 0,p2:void 0,q1:void 0,pClosest:void 0,qClosest:void 0};return this.FindClosestFeatures(e),{pClosest:e.pClosest,qClosest:e.qClosest}}FindClosestFeatures(e){const t={leftTangentPoint:void 0,rightTangentPoint:void 0};this.P.GetTangentPoints(t,this.Q.pp(0).point),e.p2=t.leftTangentPoint,e.p1=t.rightTangentPoint,e.p2==e.p1&&(e.p2+=this.P.count),this.Q.GetTangentPoints(t,this.P.pp(0).point),e.q1=t.leftTangentPoint,e.q2=t.rightTangentPoint,e.q2==e.q1&&(e.q2+=this.Q.count),this.FindClosestPoints_(e)}FindClosestPoints_(e){for(;this.ChunksAreLong(e.p2,e.p1,e.q2,e.q1);)this.ShrinkChunks(e);e.p1==e.p2?(e.pClosest=this.P.pp(e.p2).point,e.q1==e.q2?e.qClosest=this.Q.pp(e.q1).point:(e.qClosest=x.ClosestPointAtLineSegment(e.pClosest,this.Q.pp(e.q1).point,this.Q.pp(e.q2).point),x.closeDistEps(e.qClosest,this.Q.pnt(e.q1))?e.q2=e.q1:x.closeDistEps(e.qClosest,this.Q.pnt(e.q2))&&(e.q1=e.q2))):(e.qClosest=this.Q.pp(e.q1).point,e.pClosest=x.ClosestPointAtLineSegment(e.qClosest,this.P.pp(e.p1).point,this.P.pp(e.p2).point),x.closeDistEps(e.pClosest,this.P.pnt(e.p1))?e.p2=e.p1:x.closeDistEps(e.qClosest,this.P.pnt(e.p2))&&(e.p1=e.p2))}ChunksAreLong(e,t,n,i){const s=this.P.Module(e-t)+1;if(s>2)return!0;const o=this.Q.Module(i-n)+1;return o>2||2==s&&2==o}ShrinkChunks(e){const t=e.p1==e.p2?e.p1:this.P.Median(e.p1,e.p2),n=e.q1==e.q2?e.q1:this.Q.Median(e.q2,e.q1),i=this.P.pp(t).point,s=this.Q.pp(n).point,o={a1:void 0,a2:void 0,b1:void 0,b2:void 0};if(this.GetAnglesAtTheMedian(t,n,i,s,o),!this.InternalCut(e,t,n,o.a1,o.a2,o.b1,o.b2)&&!Jd.OneOfChunksContainsOnlyOneVertex(e,t,n,o.a1,o.b1)&&!this.OnlyOneChunkContainsExactlyTwoVertices(e,{mp:t,mq:n},o)){if(e.p2==this.P.Next(e.p1)&&e.q1==this.Q.Next(e.q2)){const a=me.minDistBetweenLineSegments(this.P.pnt(e.p1),this.P.pnt(e.p2),this.Q.pnt(e.q1),this.Q.pnt(e.q2));return void(0==a.parab?e.p2=e.p1:1==a.parab?e.p1=e.p2:0==a.parcd?e.q2=e.q1:1==a.parcd&&(e.q1=e.q2))}o.a1<=Math.PI&&o.a2<=Math.PI&&o.b1<=Math.PI&&o.b2<=Math.PI?o.a1+o.b1>Math.PI?o.a1>=Math.PI/2?e.p1=t:e.q1=n:o.a2>=Math.PI/2?e.p2=t:e.q2=n:o.a1>Math.PI?e.p1=t:o.a2>Math.PI?e.p2=t:o.b1>Math.PI?e.q1=n:e.q2=n}}InternalCut(e,t,n,i,s,o,a){let l=!1;if(i>=Math.PI&&s>=Math.PI){const c=this.P.pp(t).point,u=this.Q.pp(n).point,S=this.P.pp(this.P.Next(t)).point;x.getTriangleOrientation(c,u,this.Q.pp(0).point)==x.getTriangleOrientation(c,u,S)?e.p1=this.P.Next(t):e.p2=this.P.Prev(t),l=!0}if(o>=Math.PI&&a>=Math.PI){const c=this.P.pp(t).point,u=this.Q.pp(n).point,S=this.Q.pp(this.Q.Next(n)).point;x.getTriangleOrientation(c,u,this.P.pp(0).point)==x.getTriangleOrientation(c,u,S)?e.q2=this.Q.Next(n):e.q1=this.Q.Prev(n),l=!0}return l}GetAnglesAtTheMedian(e,t,n,i,s){s.a1=x.anglePCP(i,n,this.P.pnt(this.P.Prev(e))),s.a2=x.anglePCP(this.P.pnt(this.P.Next(e)),n,i),s.b1=x.anglePCP(this.Q.pnt(this.Q.Next(t)),i,n),s.b2=x.anglePCP(n,i,this.Q.pnt(this.Q.Prev(t)))}OnlyOneChunkContainsExactlyTwoVertices(e,t,n){const i=e.p2==this.P.Next(e.p1),s=e.q1==this.Q.Next(e.q2);return i&&!s?(this.ProcessShortSide(e,t.mp,t.mq,n.a1,n.b1,n.a2,n.b2),!0):!(!s||i||(this.SwapEverything(e,t,n),this.ProcessShortSide(e,t.mp,t.mq,n.a1,n.b1,n.a2,n.b2),this.SwapEverything(e,t,n),0))}SwapEverything(e,t,n){this.SwapPq();let i=e.p2;e.p2=e.q1,e.q1=i,i=e.q2,e.q2=e.p1,e.p1=i,i=t.mq,t.mq=t.mp,t.mp=i,i=n.a2,n.a2=n.b1,n.b1=i,i=n.b2,n.b2=n.a1,n.a1=i}ProcessShortSide(e,t,n,i,s,o,a){t==e.p2?this.ProcessSide(e,n,i,s,a):o<=Math.PI?o+a>=Math.PI?o>=Math.PI/2?e.p2=e.p1:e.q2=n:s>=Math.PI/2?e.q1=n:o<a&&(x.canProject(this.Q.pnt(n),this.P.pp(e.p1).point,this.P.pp(e.p2).point)?e.q1=n:e.p1=e.p2):i+s<=Math.PI?e.p1=e.p2:e.p2=e.p1}SwapPq(){const e=this.P;this.P=this.Q,this.Q=e}ProcessSide(e,t,n,i,s){const o=this.Q.pnt(t);n<=Math.PI?n+i>=Math.PI?n>=Math.PI/2?e.p1=e.p2:e.q1=t:s>=Math.PI/2?e.q2=t:n<s&&(x.canProject(o,this.P.pp(e.p1).point,this.P.pp(e.p2).point)?e.q2=t:e.p2=e.p1):(e.p2=e.p1,i>=Math.PI?e.q1=t:s>=Math.PI&&(e.q2=t))}static OneOfChunksContainsOnlyOneVertex(e,t,n,i,s){return e.p1==e.p2?(s>=Math.PI/2?e.q1=n:e.q2=n,!0):e.q1==e.q2&&(i>=Math.PI/2?e.p1=t:e.p2=t,!0)}CalculateLeftTangents(){let e;this.FindDividingBisector(e);const t=this.P.FindTheFurthestVertexFromBisector(e.p1,e.p2,e.bisectorPivot,e.bisectorRay),n=this.Q.FindTheFurthestVertexFromBisector(e.q2,e.q1,e.bisectorPivot,e.bisectorRay);this.upperBranchOnP=!1,this.lowerBranchOnQ=!0,this.leftPLeftQ=this.TangentBetweenBranches(t,e.p1,n,e.q1),this.lowerBranchOnQ=!1,this.leftPRightQ=this.TangentBetweenBranches(t,e.p1,n,e.q2)}CalculateRightTangents(){let e;this.FindDividingBisector(e);const t=this.P.FindTheFurthestVertexFromBisector(e.p1,e.p2,e.bisectorPivot,e.bisectorRay),n=this.Q.FindTheFurthestVertexFromBisector(e.q2,e.q1,e.bisectorPivot,e.bisectorRay);this.upperBranchOnP=!0,this.lowerBranchOnQ=!0,this.rightPLeftQ=this.TangentBetweenBranches(t,e.p2,n,e.q1),this.lowerBranchOnQ=!1,this.rightPRightQ=this.TangentBetweenBranches(t,e.p2,n,e.q2)}}class dr{constructor(e){this.polyline=e,this.points=new Array;for(let t=this.polyline.startPoint;t;t=t.next)this.points.push(t)}static mkFromPoints(e){return new dr(Me.mkClosedFromPoints(e))}get Polyline(){return this.polyline}Next(e){return this.Module(e+1)}Prev(e){return this.Module(e-1)}get count(){return this.Polyline.count}Module(e){return e<0?e+this.count:e<this.count?e:e-this.count}pp(e){return this.points[this.Module(e)]}pnt(e){return this.pp(e).point}toString(){return this.polyline.toString()}Median(e,t){return t>e?Math.floor((t+e)/2):this.Module(t+Math.floor((this.count+e)/2))}FindTheFurthestVertexFromBisector(e,t,n,i){let s=i.rotate(Math.PI/2);this.polyline.startPoint.point.sub(n).dot(s)<0&&(s=s.mul(-1)),e==t&&(t=this.Next(e));do{const o=this.Median(t,e),a=this.pnt(o);this.pnt(this.Next(o)).sub(a).dot(s)>=0?t=this.Next(o):this.pnt(this.Prev(o)).sub(a).dot(s)>=0?e=this.Prev(o):t=o,e=o}while(e!=t);return e}static TestPolygonDist(e,t){let n=Number.MAX_SAFE_INTEGER;for(let i=0;i<e.count;i++)for(let s=0;s<t.count;s++){const o=me.minDistBetweenLineSegments(e.pnt(i),e.pnt(i+1),t.pnt(s),t.pnt(s+1));n=Math.min(n,o.dist)}return n}static Distance(e,t){const i=new Jd(e,t).FindClosestPoints();return{p:i.pClosest,q:i.qClosest,dist:i.pClosest.sub(i.qClosest).length}}static DistanceOnly(e,t){return dr.Distance(e,t).dist}static PolygonIsLegalDebug(e){for(let n=e.Polyline.startPoint;null!=n.next&&null!=n.next.next;n=n.next)if(x.getTriangleOrientation(n.point,n.next.point,n.next.next.point)==Ie.Collinear)return!1;return!0}static DistancePoint(e,t){let n=Number.MAX_VALUE;for(let i=0;i<e.count;i++){const s=x.distToLineSegment(t,e.points[i].point,e.points[(i+1)%e.count].point).dist;n=Math.min(n,s)}return n}GetTangentPoints(e,t){const n=new k4(this.GetSequenceDelegate(t),this.count);e.leftTangentPoint=n.FindMaximum(),e.rightTangentPoint=n.FindMinimum()}GetSequenceDelegate(e){const t=this.pnt(0);return n=>{const i=x.anglePCP(t,e,this.pnt(n));return i<Math.PI?i:i-2*Math.PI}}}let ti=(()=>{class r{constructor(t,n,i,s){this.Obstacles=t,this.TightPadding=n,this.LoosePadding=i,this.IgnoreTightPadding=s}ObstaclesIntersectLine(t,n){return this.ObstaclesIntersectICurve(me.mkPP(t,n))}static PadCorner(t,n,i,s,o){const a=r.GetPaddedCorner(n,i,s,o);return-1!=a.numberOfPoints&&(t.addPoint(a.a),2==a.numberOfPoints&&t.addPoint(a.b),!0)}static CurveIsClockwise(t,n){return x.getTriangleOrientation(n,t.start,t.start.add(t.derivative(t.parStart)))==Ie.Clockwise}static PaddedPolylineBoundaryOfNode(t,n){return r.CreatePaddedPolyline(ee.polylineAroundClosedCurve(t),n)}static LoosePolylineWithFewCorners(t,n){return n<q.distanceEpsilon?t:r.CreateLoosePolylineOnBisectors(t,n)}static CreateLoosePolylineOnBisectors(t,n){return Me.mkClosedFromPoints(Pi.CalculateConvexHull(r.BisectorPoints(t,n)))}static CreateRectNodeOfPolyline(t){return Cn(t,t.boundingBox)}CreateLooseObstacles(){this.tightPolylinesToLooseDistances=new Map,this.LooseObstacles=new Array;for(const t of this.TightObstacles){const n=r.FindMaxPaddingForTightPolyline(this.RootOfTightHierarchy,t,this.LoosePadding);this.tightPolylinesToLooseDistances.set(t,n),this.LooseObstacles.push(r.LoosePolylineWithFewCorners(t,n))}this.RootOfLooseHierarchy=r.CalculateHierarchy(this.LooseObstacles)}CreateTightObstacles(){this.RootOfTightHierarchy=r.CreateTightObstacles_(this.Obstacles,this.TightPadding,this.TightObstacles),this.OverlapsDetected=this.TightObstacles.size<this.Obstacles.length}Calculate(){this.IgnoreTightPadding?this.CreateTightObstaclesIgnoringTightPadding():this.CreateTightObstacles(),this.IsEmpty()||this.CreateLooseObstacles()}IsEmpty(){return null==this.TightObstacles||0==this.TightObstacles.size}ObstaclesIntersectICurve(t){return r.CurveIntersectsRectangleNode(t,t.boundingBox,this.RootOfTightHierarchy)}static CurveIntersectsRectangleNode(t,n,i){if(!i.irect.intersects(n))return!1;if(null!=i.UserData){const s=i.UserData;return null!=ee.intersectionOne(s,t,!1)||r.PointIsInside(s.start,t)}return r.CurveIntersectsRectangleNode(t,n,i.Left)||r.CurveIntersectsRectangleNode(t,n,i.Right)}static PointIsInside(t,n){return ee.PointRelativeToCurveLocation(t,n)==Fe.Inside}CreateTightObstaclesIgnoringTightPadding(){const t=this.Obstacles.map(s=>ee.polylineAroundClosedCurve(s)),n=r.CalculateHierarchy(t),i=r.GetOverlappedPairSet(n);if(this.TightObstacles=new Set,0==i.size){for(const s of t){const o=r.FindMaxPaddingForTightPolyline(n,s,this.TightPadding);this.TightObstacles.add(r.LoosePolylineWithFewCorners(s,o))}this.RootOfTightHierarchy=r.CalculateHierarchy(Array.from(this.TightObstacles))}else{for(const s of t)this.TightObstacles.add(r.CreatePaddedPolyline(s,this.TightPadding));if(!this.IsEmpty())for(this.RootOfTightHierarchy=r.CalculateHierarchy(Array.from(this.TightObstacles)),this.OverlapsDetected=!1;r.GetOverlappedPairSet(this.RootOfTightHierarchy).size>0;)this.RootOfTightHierarchy=r.ReplaceTightObstaclesWithConvexHulls(this.TightObstacles,Array.from(i)),this.OverlapsDetected=!0}}static CreateTightObstacles_(t,n,i){if(0==t.length)return null;for(const s of t)r.CalculateTightPolyline(i,n,s);return r.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(i)}static CalculateTightPolyline(t,n,i){const s=r.PaddedPolylineBoundaryOfNode(i,n);t.add(s)}static CalculateHierarchy(t){return en(t.map(i=>r.CreateRectNodeOfPolyline(i)))}static RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(t){let i,n=r.CalculateHierarchy(Array.from(t));for(;(i=r.GetOverlappedPairSet(n)).size>0;)n=r.ReplaceTightObstaclesWithConvexHulls(t,Array.from(i));return n}static MapToInt(t){const n=new Map;for(let i=0;i<t.length;i++)n.set(t[i],i);return n}static ReplaceTightObstaclesWithConvexHulls(t,n){const i=new Set;for(const c of n)i.add(c[0]),i.add(c[1]);const s=Array.from(i),o=r.MapToInt(s),l=ru(ET(Array.from(n).map(c=>new ot(o.get(c[0]),o.get(c[1])))));for(const c of l){const u=c.map(L=>s[L]),S=lu(u,L=>Array.from(L)),b=Pi.createConvexHullAsClosedPolyline(S);for(const L of u)t.delete(L);t.add(b)}return r.CalculateHierarchy(Array.from(t))}static OneCurveLiesInsideOfOther(t,n){return ee.PointRelativeToCurveLocation(t.start,n)!=Fe.Outside||ee.PointRelativeToCurveLocation(n.start,t)!=Fe.Outside}static PolylinesIntersect(t,n){return ee.CurvesIntersect(t,n)||r.OneCurveLiesInsideOfOther(t,n)}static GetOverlappedPairSet(t){const n=new Set;return Un(t,t,(i,s)=>{r.PolylinesIntersect(i,s)&&n.add([i,s])}),n}static BisectorPoints(t,n){const i=new Array;for(let s=t.startPoint;null!=s;s=s.next){const o={skip:!1},a=r.GetStickingVertexOnBisector(s,n,o);o.skip||i.push(a)}return i}static GetStickingVertexOnBisector(t,n,i){const s=t.polyline.prev(t).point,o=t.point,a=t.polyline.next(t).point;let l=o.sub(s).normalize().add(o.sub(a).normalize());const c=l.length;return c<q.tolerance?i.skip=!0:(i.skip=!1,l=l.div(c)),l.mul(n).add(o)}static FindMaxPaddingForTightPolyline(t,n,i){let s=i;const o=new dr(n),a=n.boundingBox.clone();a.pad(2*i);for(const l of Array.from(t.GetNodeItemsIntersectingRectangle(a)).filter(c=>c!=n)){const c=dr.Distance(o,new dr(l)).dist;s=Math.min(s,c/r.LooseDistCoefficient)}return s}static GetPaddedCorner(t,n,i,s){const o=t.point,a=n.point,l=i.point;if(x.getTriangleOrientation(o,a,l)==Ie.Counterclockwise)return{a:void 0,b:void 0,numberOfPoints:-1};let c=a.sub(o).rotate(Math.PI/2).normalize();if(r.CornerIsNotTooSharp(o,a,l)){c=c.mul(s);const G=l.sub(a).normalize().mul(s).rotate(Math.PI/2),J=x.lineLineIntersection(o.add(c),a.add(c),a.add(G),l.add(G));return{a:J,b:J,numberOfPoints:1}}const u=a.sub(o).normalize().add(a.sub(l).normalize());if(u.length<q.intersectionEpsilon){const G=a.add(c.mul(s));return{a:G,b:G,numberOfPoints:1}}const S=u.normalize().mul(s),b=S.rotate(Math.PI/2),L=(s-S.dot(c))/b.dot(c),F=b.mul(L);return{a:S.add(F).add(a),b:S.sub(F).add(a),numberOfPoints:2}}static CornerIsNotTooSharp(t,n,i){const s=t.sub(n).rotate(Math.PI/4).add(n);return x.getTriangleOrientation(n,s,i)==Ie.Counterclockwise}static CreatePaddedPolyline(t,n){const i=new Me;if(!r.PadCorner(i,t.endPoint.prev,t.endPoint,t.startPoint,n)||!r.PadCorner(i,t.endPoint,t.startPoint,t.startPoint.next,n))return r.CreatePaddedPolyline(Me.mkClosedFromPoints(Array.from(Pi.CalculateConvexHull(t))),n);for(let s=t.startPoint;null!=s.next.next;s=s.next)if(!r.PadCorner(i,s,s.next,s.next.next,n))return r.CreatePaddedPolyline(Me.mkClosedFromPoints(Array.from(Pi.CalculateConvexHull(t))),n);return i.closed=!0,i}}return r.LooseDistCoefficient=2.1,r})();class ny{get TightPolyline(){return this.tightPoly}set TightPolyline(e){this.tightPoly=e}static mk(e,t,n){const i=new ny;return i.TightPolyline=e,i.LooseShape=t,i.Distance=n,i}toString(){return(null==this.TightPolyline?"null":this.TightPolyline.toString().substring(0,5))+","+(null==this.LooseShape?"null":this.LooseShape.toString().substring(0,5))}}class ry{constructor(e,t,n,i){this.MainShape=e,this.TightPadding=t,this.LoosePadding=n,this.ShapesToTightLooseCouples=i}Calculate(){0!=this.MainShape.Children.length&&(this.CreateTightObstacles(),this.CreateTigthLooseCouples(),this.FillTheMapOfShapeToTightLooseCouples())}FillTheMapOfShapeToTightLooseCouples(){Mr(en(this.MainShape.Children.map(t=>Cn(t,t.BoundingBox))),this.coupleHierarchy,this.TryMapShapeToTightLooseCouple.bind(this))}TryMapShapeToTightLooseCouple(e,t){ry.ShapeIsInsideOfPoly(e,t.TightPolyline)&&this.ShapesToTightLooseCouples.set(e,t)}static ShapeIsInsideOfPoly(e,t){return ee.PointRelativeToCurveLocation(e.BoundaryCurve.start,t)==Fe.Inside}CreateTigthLooseCouples(){const e=new Array;for(const t of this.tightHierarchy.GetAllLeaves()){const n=ti.FindMaxPaddingForTightPolyline(this.tightHierarchy,t,this.LoosePadding),i=ti.LoosePolylineWithFewCorners(t,n);e.push(ny.mk(t,new yl(i),n))}this.coupleHierarchy=en(e.map(t=>Cn(t,t.TightPolyline.boundingBox)))}CreateTightObstacles(){const e=new Set(this.MainShape.Children.map(this.InitialTightPolyline.bind(this))),t=e.size;this.tightHierarchy=ti.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(e),this.OverlapsDetected=t>e.size}InitialTightPolyline(e){const t=ti.PaddedPolylineBoundaryOfNode(e.BoundaryCurve,this.TightPadding),n=lu(this.LoosePolylinesUnderShape(e),s=>Array.from(s)).filter(s=>ee.PointRelativeToCurveLocation(s,t)==Fe.Outside);if(n.length<=0)return t;const i=Array.from(t).concat(n);return Me.mkClosedFromPoints(Pi.CalculateConvexHull(i))}LoosePolylinesUnderShape(e){return e.Children.map(t=>this.ShapesToTightLooseCouples.get(t).LooseShape.BoundaryCurve)}}class G4{constructor(e,t,n){this.indexToA=e,this.priority=t,this.v=n}}class ho{constructor(e=Tt){this.heapSize=0,this.compare=e,this.cache=new Map,this.A=[]}get count(){return this.heapSize}ContainsElement(e){return this.cache.has(e)}SwapWithParent(e){const t=this.A[e>>1];this.PutAtI(e>>1,this.A[e]),this.PutAtI(e,t)}Enqueue(e,t){let n=++this.heapSize;const i=new G4(n,t,e);for(this.cache.set(e,i),this.A[n]=i;n>1&&this.compare(this.A[n>>1].priority,t)>0;)this.SwapWithParent(n),n>>=1}IsEmpty(){return 0==this.heapSize}PutAtI(e,t){this.A[e]=t,t.indexToA=e}Dequeue(){if(0==this.heapSize)throw new Error("dequeue on an empty queue");const e=this.A[1].v;return this.MoveQueueOneStepForward(e),e}DequeueAndGetPriority(e){if(0==this.heapSize)throw new Error("dequeue on an empty queue");const t=this.A[1].v;return e.priority=this.A[1].priority,this.MoveQueueOneStepForward(t),t}MoveQueueOneStepForward(e){this.cache.delete(e),this.PutAtI(1,this.A[this.heapSize]);let t=1;for(;;){let n=t;const i=t<<1;i<=this.heapSize&&this.compare(this.A[i].priority,this.A[t].priority)<0&&(n=i);const s=i+1;if(s<=this.heapSize&&this.compare(this.A[s].priority,this.A[n].priority)<0&&(n=s),n==t)break;this.SwapWithParent(n),t=n}this.heapSize--}DecreasePriority(e,t){const n=this.cache.get(e);if(!n)return;n.priority=t;let i=n.indexToA;for(;i>1&&this.compare(this.A[i].priority,this.A[i>>1].priority)<0;)this.SwapWithParent(i),i>>=1}*GetEnumerator(){for(let e=1;e<=this.heapSize;e++)yield this.A[e].v}Peek(e){if(0!=this.count)return e.priority=this.A[1].priority,this.A[1].v;e.priority=0}toString(){const e=new In.StringBuilder;for(const t of this.A)e.Append(t+",");return e.ToString()}}class hu{constructor(e,t,n){this.upperBound=Number.POSITIVE_INFINITY,this._visGraph=n,this._visGraph.ClearPrevEdgesTable();for(const i of n.Vertices())i.Distance=Number.POSITIVE_INFINITY;this.source=e,this.targets=new Set(t),this.source.Distance=0}GetPath(){const e=new ho(Tt);for(this.source.Distance=0,e.Enqueue(this.source,0);!e.IsEmpty()&&(this.current=e.Dequeue(),!this.targets.has(this.current));){for(const t of this.current.OutEdges)this.PassableOutEdge(t)&&this.ProcessNeighbor(e,t,t.Target);for(const t of this.current.InEdges)this.PassableInEdge(t)&&this.ProcessNeighbor(e,t,t.Source)}return null==this._visGraph.PreviosVertex(this.current)?null:this.CalculatePath()}PassableOutEdge(e){return e.Source==this.source||this.targets.has(e.Target)||!hu.IsForbidden(e)}PassableInEdge(e){return this.targets.has(e.Source)||e.Target==this.source||!hu.IsForbidden(e)}static IsForbidden(e){return null!=e.IsPassable&&!e.IsPassable()||e instanceof Xi}ProcessNeighbor(e,t,n){const s=this.current.Distance+t.Length;s>=this.upperBound||(this.targets.has(n)&&(this.upperBound=s,this.closestTarget=n),n!=this.source&&null==this._visGraph.PreviosVertex(n)?(n.Distance=s,this._visGraph.SetPreviousEdge(n,t),e.Enqueue(n,s)):s<n.Distance&&(n.Distance=s,this._visGraph.SetPreviousEdge(n,t),e.DecreasePriority(n,s)))}CalculatePath(){if(null==this.closestTarget)return null;const e=new Array;let t=this.closestTarget;do{e.push(t),t=this._visGraph.PreviosVertex(t)}while(t!=this.source);return e.push(this.source),e.reverse()}}class $d{constructor(e,t,n){this._lengthMultiplier=1,this._lengthMultiplierForAStar=1,this._visGraph=e,this._source=t,this._target=n,this._source.Distance=0}get LengthMultiplier(){return this._lengthMultiplier}set LengthMultiplier(e){this._lengthMultiplier=e}get LengthMultiplierForAStar(){return this._lengthMultiplierForAStar}set LengthMultiplierForAStar(e){this._lengthMultiplierForAStar=e}GetPath(e){const t=new ho(Tt);for(this._source.Distance=0,this._target.Distance=Number.POSITIVE_INFINITY,t.Enqueue(this._source,this.H(this._source));!t.IsEmpty();){const n={priority:0},i=t.DequeueAndGetPriority(n);if(n.priority>=this._target.Distance)break;for(const s of i.OutEdges)this.PassableOutEdge(s)&&this.ProcessNeighbor(t,i,s,s.Target);for(const s of i.InEdges)this.PassableInEdge(s)&&this.ProcessNeighbor(t,i,s,s.Source)}return null==this._visGraph.PreviosVertex(this._target)?null:this.CalculatePath(e)}PassableOutEdge(e){return e.Source==this._source||e.Target==this._target||!$d.IsForbidden(e)}PassableInEdge(e){return e.Source==this._target||e.Target==this._source||!$d.IsForbidden(e)}static IsForbidden(e){return null!=e.IsPassable&&!e.IsPassable()||e instanceof Xi}ProcessNeighborN(e,t,n,i,s){const a=t.Distance+(n.Length+s);i!=this._source&&null==this._visGraph.PreviosVertex(i)?(i.Distance=a,this._visGraph.SetPreviousEdge(i,n),i!=this._target&&e.Enqueue(i,this.H(i))):i!=this._source&&a<i.Distance&&(i.Distance=a,this._visGraph.SetPreviousEdge(i,n),i!=this._target&&e.DecreasePriority(i,this.H(i)))}ProcessNeighbor(e,t,n,i){const o=t.Distance+n.Length;i!=this._source&&null==this._visGraph.PreviosVertex(i)?(i.Distance=o,this._visGraph.SetPreviousEdge(i,n),i!=this._target&&e.Enqueue(i,this.H(i))):i!=this._source&&o<i.Distance&&(i.Distance=o,this._visGraph.SetPreviousEdge(i,n),i!=this._target&&e.DecreasePriority(i,this.H(i)))}H(e){return e.Distance+e.point.sub(this._target.point).length*this.LengthMultiplierForAStar}CalculatePath(e){const t=new Array;let n=this._target;do{t.push(n),e&&this._visGraph.ShrinkLengthOfPrevEdge(n,this.LengthMultiplier),n=this._visGraph.PreviosVertex(n)}while(n!=this._source);return t.push(this._source),t.reverse()}}var es=(()=>{return(r=es||(es={}))[r.Regular=0]="Regular",r[r.Tangent=1]="Tangent",es;var r})();class MT{constructor(e,t){this.LeftTangent=e,this.RightTangent=t}toString(){return In.String.Format("{0},{1}",this.Start,this.End)}get Start(){return this.leftTangent.End.point}get End(){return this.rightTangent.End.point}get LeftTangent(){return this.leftTangent}set LeftTangent(e){this.leftTangent=e}get RightTangent(){return this.rightTangent}set RightTangent(e){this.rightTangent=e}get RbNode(){return this.rbNode}set RbNode(e){this.rbNode=e}}class _T{constructor(e,t){this.start=e,this.End=t}get Comp(){return this.comp}set Comp(e){this.comp=e}get IsHigh(){return!this.IsLow}get IsLow(){return this.lowTangent}set IsLow(e){this.lowTangent=e}get SeparatingPolygons(){return this.separatingPolygons}set SeparatingPolygons(e){this.separatingPolygons=e}get Diagonal(){return this.diagonal}set Diagonal(e){this.diagonal=e}get Start(){return this.start}set Start(e){this.start=e}get End(){return this.end}set End(e){this.end=e}toString(){return In.String.Format("{0},{1}",this.Start,this.End)}}class FT{get PointOnTangentAndInsertedDiagonal(){return this.pointOnTheRay}set PointOnTangentAndInsertedDiagonal(e){this.pointOnTheRay=e}Compare(e,t){return e.Start.equal(t.Start)?0:x.getTriangleOrientation(this.PointOnTangentAndInsertedDiagonal,t.Start,t.End)===Ie.Counterclockwise?-1:1}static BelongsToTheDiagonal(e,t,n){return x.closeDistEps(e,x.ClosestPointAtLineSegment(e,t,n))}static IntersectDiagonalWithRay(e,t,n){const i=t.sub(e),s=n.Start,o=n.End,a=eu.solve(o.x-s.x,-1*i.x,e.x-s.x,o.y-s.y,-1*i.y,e.y-s.y);return e.add(i.mul(a.y))}}class Rl{constructor(e){this.pivot=e}IComparer(e,t){if(e==t)return 0;if(null==e)return-1;if(null==t)return 1;const n=e.Start.point.sub(this.pivot),i=t.Start.point.sub(this.pivot);return Rl.CompareVectorsByAngleToXAxis(n,i)}static CompareVectorsByAngleToXAxis(e,t){return e.y>=0?t.y<0?-1:Rl.CompareVectorsPointingToTheSameYHalfPlane(e,t):t.y>=0?1:Rl.CompareVectorsPointingToTheSameYHalfPlane(e,t)}static CompareVectorsPointingToTheSameYHalfPlane(e,t){const n=e.x*t.y-e.y*t.x;if(n>q.tolerance)return-1;if(n<-q.tolerance)return 1;if(e.x>=0){if(t.x<0)return-1}else if(t.x>=0)return 1;let i=Math.abs(e.x)-Math.abs(t.x);return i<0?-1:i>0?1:(i=Math.abs(e.y)-Math.abs(t.y),i<0?-1:i>0?1:0)}}class fo extends Zt{constructor(e,t,n){super(null),this.activeDiagonalComparer=new FT,this.polygons=e,this.visibilityGraph=n,this.addedPolygons=t}run(){this.useLeftPTangents=!0,this.CalculateAndAddEdges(),this.useLeftPTangents=!1,this.CalculateAndAddEdges()}CalculateAndAddEdges(){for(const e of this.addedPolygons)this.CalculateVisibleTangentsFromPolygon(e);this.ProgressStep()}CalculateVisibleTangentsFromPolygon(e){this.currentPolygon=e,this.AllocateDataStructures(),this.OrganizeTangents(),this.InitActiveDiagonals(),this.Sweep()}AllocateDataStructures(){this.tangents=new Array,this.diagonals=new Array,this.activeDiagonalTree=new xr(this.activeDiagonalComparer.Compare.bind(this.activeDiagonalComparer))}Sweep(){if(!(this.tangents.length<2))for(let e=1;e<this.tangents.length;e++){const t=this.tangents[e];null!=t.Diagonal?(t.Diagonal.RbNode==this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(t),t.IsHigh&&this.RemoveDiagonalFromActiveNodes(t.Diagonal)):t.IsLow&&(this.activeDiagonalComparer.PointOnTangentAndInsertedDiagonal=t.End.point,this.InsertActiveDiagonal(new MT(t,t.Comp)),t.Diagonal.RbNode==this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(t))}}AddVisibleEdge(e){tn.AddEdgeVV(BT(this.visibilityGraph,e.start),BT(this.visibilityGraph,e.End))}InitActiveDiagonals(){if(0==this.tangents.length)return;const e=this.tangents[0],t=e.start.point,n=e.End.point;for(const i of this.diagonals)fo.RayIntersectDiagonal(t,n,i)&&(this.activeDiagonalComparer.PointOnTangentAndInsertedDiagonal=FT.IntersectDiagonalWithRay(t,n,i),this.InsertActiveDiagonal(i)),e.Diagonal.RbNode==this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(e),0==e.IsLow&&this.RemoveDiagonalFromActiveNodes(e.Diagonal)}RemoveDiagonalFromActiveNodes(e){const t=this.activeDiagonalTree.deleteSubTree(e.RbNode);null!=t&&null!=t.item&&(t.item.RbNode=t),e.LeftTangent.Diagonal=null,e.RightTangent.Diagonal=null}InsertActiveDiagonal(e){e.RbNode=this.activeDiagonalTree.insert(e),fo.MarkDiagonalAsActiveInTangents(e)}static MarkDiagonalAsActiveInTangents(e){e.LeftTangent.Diagonal=e,e.RightTangent.Diagonal=e}static RayIntersectDiagonal(e,t,n){const i=n.Start,s=n.End;return x.getTriangleOrientation(e,i,s)==Ie.Counterclockwise&&x.getTriangleOrientation(e,t,i)!=Ie.Counterclockwise&&x.getTriangleOrientation(e,t,s)!=Ie.Clockwise}static TangentComparison(e,t){return Rl.CompareVectorsByAngleToXAxis(e.End.point.sub(e.start.point),t.End.point.sub(t.start.point))}*AllObstacles(){for(const e of this.addedPolygons)yield e;for(const e of this.polygons)yield e}OrganizeTangents(){for(const e of this.AllObstacles())e!=this.currentPolygon&&this.ProcessPolygonQ(e);this.tangents.sort(fo.TangentComparison)}ProcessPolygonQ(e){const t=new Jd(this.currentPolygon,e);this.useLeftPTangents?t.CalculateLeftTangents():t.CalculateRightTangents();let n=this.useLeftPTangents?t.leftPLeftQ:t.rightPLeftQ;const i=new _T(this.currentPolygon.pp(n[0]),e.pp(n[1]));i.IsLow=!0,i.SeparatingPolygons=!this.useLeftPTangents,n=this.useLeftPTangents?t.leftPRightQ:t.rightPRightQ;const s=new _T(this.currentPolygon.pp(n[0]),e.pp(n[1]));s.IsLow=!1,s.SeparatingPolygons=this.useLeftPTangents,i.Comp=s,s.Comp=i,this.tangents.push(i),this.tangents.push(s),this.diagonals.push(new MT(i,s))}}function BT(r,e){return r.FindVertex(e.point)}class iy{get Pivot(){return this.pivot}set Pivot(e){this.pivot=e}get IntersectionOfTheRayAndInsertedEdge(){return this.pointOnTheRay}set IntersectionOfTheRayAndInsertedEdge(e){this.pointOnTheRay=e}Compare(e,t){return x.getTriangleOrientation(this.IntersectionOfTheRayAndInsertedEdge,t.point,t.nextOnPolyline.point)===Ie.Counterclockwise?-1:1}IntersectionPointBelongsToTheInsertedEdge(e){const t=e.point.sub(this.IntersectionOfTheRayAndInsertedEdge),n=e.nextOnPolyline.point.sub(this.IntersectionOfTheRayAndInsertedEdge);return Math.abs(t.x*n.y-n.x*t.y)<q.distanceEpsilon}IntersectEdgeWithRayPPP(e,t,n){const i=eu.solve(t.x-e.x,-n.x,this.Pivot.x-e.x,t.y-e.y,-n.y,this.Pivot.y-e.y);if(!(-q.tolerance<=i.x&&i.x<=1+q.tolerance))throw new Error;if(!i)throw new Error;return this.Pivot.add(n.mul(i.y))}IntersectEdgeWithRay(e,t){return this.IntersectEdgeWithRayPPP(e.point,e.nextOnPolyline.point,t)}static constructorPP(e,t){const n=new iy;return n.pivot=e,n.pointOnTheRay=t,n}}class du{constructor(e,t){this.start=e,this.end=t}get Start(){return this.start}set Start(e){this.start=e}get End(){return this.end}set End(e){this.end=e}*Sides(){let e=this.start;for(;e!=this.end;){const t=e;yield t,e=t.nextOnPolyline}}MoveStartClockwise(){return this.Start!=this.End&&(this.Start=this.Start.nextOnPolyline,!0)}toString(){return In.String.Format("Stem({0},{1})",this.Start,this.End)}}class Ds{constructor(e,t,n,i){this.sideNodes=new Map,this.visibleBoundaries=new Map,this.sortedListOfPolypoints=new Array,this.holes=Array.from(e),this.visibilityGraph=t,this.q=n,this.qPolylinePoint=Pr.mkFromPoint(this.q),this.QVertex=this.visibilityGraph.AddVertexP(this.qPolylinePoint.point),this.visibilityKind=i;const s=new Rl(this.q);this.heapForSorting=new $E(s.IComparer.bind(s))}get QVertex(){return this.qV}set QVertex(e){this.qV=e}static CalculatePointVisibilityGraph(e,t,n,i){const s=t.FindVertex(n);if(null!=s)return s;const o=new Ds(e,t,n,i);return o.FillGraph(),o.QVertex}FillGraph(){this.ComputeHoleBoundariesPossiblyVisibleFromQ(),this.visibleBoundaries.size>0&&(this.SortSAndInitActiveSides(),this.Sweep())}SortSAndInitActiveSides(){this.InitHeapAndInsertActiveSides();for(let e=this.heapForSorting.GetMinimum();this.sortedListOfPolypoints.push(e.Start),e.MoveStartClockwise()?this.heapForSorting.ChangeMinimum(e):this.heapForSorting.Dequeue(),0!=this.heapForSorting.Count;e=this.heapForSorting.GetMinimum());}InitHeapAndInsertActiveSides(){for(const e of this.GetInitialVisibleBoundaryStemsAndInsertActiveSides())this.heapForSorting.Enqueue(e)}*GetInitialVisibleBoundaryStemsAndInsertActiveSides(){for(const[e,t]of this.visibleBoundaries){let n=!1;for(const i of t.Sides()){const s=i;if(s.point.y<this.q.y){if(i.nextOnPolyline.point.y>=this.q.y){const o=x.getTriangleOrientation(this.q,s.point,i.nextOnPolyline.point);if(o==Ie.Counterclockwise||o==Ie.Collinear){n=!0,yield new du(t.Start,i),yield new du(i.nextOnPolyline,t.End),this.RegisterActiveSide(i);break}}}else{if(s.point.y>this.q.y)break;if(i.point.x>=this.q.x){n=!0,yield new du(i,t.End),i!=t.Start&&(yield new du(t.Start,e.prev(s))),this.RegisterActiveSide(i);break}}}n||(yield t)}}RegisterActiveSide(e){this.activeEdgeComparer.IntersectionOfTheRayAndInsertedEdge=this.activeEdgeComparer.IntersectEdgeWithRay(e,new x(1,0)),this.sideNodes.set(e,this.activeSidesTree.insert(e))}Sweep(){for(const e of this.sortedListOfPolypoints)this.SweepPolylinePoint(e)}SweepPolylinePoint(e){const t=Ds.GetIncomingSide(e),n=this.GetOutgoingSide(e);let i;if(this.activeEdgeComparer.IntersectionOfTheRayAndInsertedEdge=e.point,i=this.sideNodes.get(t)){if(i==this.activeSidesTree.treeMinimum()&&this.AddEdge(e),null!=n)i.item=n,this.sideNodes.set(n,i);else{const s=this.activeSidesTree.deleteSubTree(i);null!=s&&null!=s.item&&this.sideNodes.set(s.item,s)}this.sideNodes.delete(t)}else{if(null==n)throw new Error;{let s;(s=this.sideNodes.get(n))||(s=this.activeSidesTree.insert(n),this.sideNodes.set(n,s),s==this.activeSidesTree.treeMinimum()&&this.AddEdge(e))}}}AddEdge(e){(this.visibilityKind==es.Regular||this.visibilityKind==es.Tangent&&Ds.LineTouchesPolygon(this.QVertex.point,e))&&this.visibilityGraph.AddEdgeF(this.QVertex.point,e.point,(t,n)=>new Xi(t,n))}static LineTouchesPolygon(e,t){const n=t.polyline.prev(t).point,i=t.polyline.next(t).point,s=t.point;return x.signedDoubledTriangleArea(e,s,n)*x.signedDoubledTriangleArea(e,s,i)>=0}GetOutgoingSide(e){return e==this.visibleBoundaries.get(e.polyline).End?null:e}static GetIncomingSide(e){return e.prevOnPolyline}ComputeHoleBoundariesPossiblyVisibleFromQ(){this.InitActiveEdgesAndActiveEdgesComparer();for(const e of this.holes)this.ComputeVisiblePartOfTheHole(e)}InitActiveEdgesAndActiveEdgesComparer(){this.activeEdgeComparer=new iy,this.activeEdgeComparer.pivot=this.q,this.activeSidesTree=new xr(this.activeEdgeComparer.Compare.bind(this.activeEdgeComparer))}ComputeVisiblePartOfTheHole(e){let t,n=!0;for(t=e.startPoint;!this.HoleSideIsVisibleFromQ(e,t);t=e.next(t))n=!1;let i=e.next(t);if(n)for(;this.HoleSideIsVisibleFromQ(e,e.prev(t));)t=e.prev(t);for(;this.HoleSideIsVisibleFromQ(e,i);i=e.next(i));this.visibleBoundaries.set(e,new du(t,i))}HoleSideIsVisibleFromQ(e,t){return x.signedDoubledTriangleArea(this.q,t.point,e.next(t).point)>=-q.squareOfDistanceEpsilon}}class kT{constructor(e,t){this.next=null,this.prev=null,this.PolylinePoint=e,this.OriginalPosition=t}get PolylinePoint(){return this.polylinePoint}set PolylinePoint(e){this.polylinePoint=e}get OriginalPosition(){return this.originalPosition}set OriginalPosition(e){this.originalPosition=e}get Next(){return this.next}set Next(e){this.next=e}get Prev(){return this.prev}set Prev(e){this.prev=e}}class Et extends Zt{constructor(){super(...arguments),this.IgnoreTightPadding=!0,this.activeRectangle=Ne.mkEmpty(),this.activePolygons=new Array,this.alreadyAddedOrExcludedPolylines=new Set,this.UseEdgeLengthMultiplier=!1,this.UseInnerPolylingShortcutting=!0,this.UsePolylineEndShortcutting=!0,this.AllowedShootingStraightLines=!0,this.LookForRoundedVertices=!1}get Obstacles(){return this.obstacles_}set Obstacles(e){this.obstacles_=e}get EnteringAngleBound(){return this.enteringAngleBound_}set EnteringAngleBound(e){this.enteringAngleBound_=e}get SourceTightPolyline(){return this._sourceTightPolyline}set SourceTightPolyline(e){this._sourceTightPolyline=e}get TargetTightPolyline(){return this.targetTightPolyline}set TargetTightPolyline(e){this.targetTightPolyline=e}get TargetLoosePolyline(){return this.targetLoosePolyline}set TargetLoosePolyline(e){this.targetLoosePolyline=e}get VisibilityGraph(){return this.visibilityGraph}set VisibilityGraph(e){this.visibilityGraph=e}get SourcePort(){return this.sourcePort}set SourcePort(e){if(this.sourcePort=e,null!=this.sourcePort)if(this.SourceTightPolyline=Et.GetFirstHitPolyline(this.sourcePort.Location,this.ObstacleCalculator.RootOfTightHierarchy),this.sourcePort instanceof Qi)this.alreadyAddedOrExcludedPolylines.add(this.SourceLoosePolyline),this.StartPointOfEdgeRouting=this.SourcePort.Location;else{const t=this.sourcePort;this.StartPointOfEdgeRouting=this.TakeBoundaryPortOutsideOfItsLoosePolyline(t.Curve,t.Parameter,this.SourceLoosePolyline)}}get TargetPort(){return this.targetPort}set TargetPort(e){this.targetPort=e}get LoosePadding(){return this.loosePadding}set LoosePadding(e){this.loosePadding=e,null!=this.ObstacleCalculator&&(this.ObstacleCalculator.LoosePadding=e)}get StartPointOfEdgeRouting(){return this.startPointOfRouting_}set StartPointOfEdgeRouting(e){this.startPointOfRouting_=e}ExtendVisibilityGraphToLocation(e){null==this.VisibilityGraph&&(this.VisibilityGraph=new tn);let t=null;if(!this.activeRectangle.contains(e)){this.activeRectangle.isEmpty?this.activeRectangle=Ne.mkPP(this.SourcePort.Location,e):this.activeRectangle.add(e),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle();for(const n of t)this.VisibilityGraph.AddHole(n.Polyline)}null==t||0==t.length?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraph(e)):(this.RemovePointVisibilityGraphs(),new fo(t,this.activePolygons,this.VisibilityGraph).run(),zo(this.activePolygons,t),this.CalculateEdgeTargetVisibilityGraph(e),this.CalculateSourcePortVisibilityGraph())}RemovePointVisibilityGraphs(){null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),null!=this.sourceVV&&this.VisibilityGraph.RemoveVertex(this.sourceVV)}CalculateEdgeTargetVisibilityGraph(e){this.targetVV=Ds.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()),this.VisibilityGraph,e,es.Tangent)}CalculateSourcePortVisibilityGraph(){this.sourceVV=Ds.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()),this.VisibilityGraph,this.StartPointOfEdgeRouting,es.Tangent)}TakeBoundaryPortOutsideOfItsLoosePolyline(e,t,n){const i=e.value(t);let s=e.leftDerivative(t).normalize().add(e.rightDerivative(t).normalize()).normalize();x.getTriangleOrientation(Et.PointInsideOfConvexCurve(e),i,i.add(s))==Ie.Counterclockwise&&(s=s.mul(-1)),s=s.rotate(Math.PI/2);let a=me.mkPP(i,i.add(s.mul(n.boundingBox.diagonal)));const l=ee.intersectionOne(a,n,!1).x;let c=s.mul(l.sub(i).length/2);for(;;){a=me.mkPP(i,l.add(c));let u=!1;for(const S of Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(a,this.ObstacleCalculator.RootOfLooseHierarchy))if(S.seg1!=n){c=c.div(1.5),u=!0;break}if(!u)break}return a.end}static PointInsideOfConvexCurve(e){return e.value(0).add(e.value(1.5)).div(2)}*GetActivePolylines(){for(const e of this.activePolygons)yield e.Polyline}GetAddedPolygonesAndMaybeExtendActiveRectangle(){const e=this.activeRectangle,t=new Array;let n;do{n=!1;for(const i of this.ObstacleCalculator.RootOfLooseHierarchy.GetNodeItemsIntersectingRectangle(this.activeRectangle))this.alreadyAddedOrExcludedPolylines.has(i)||(e.addRec(i.boundingBox),t.push(new dr(i)),this.alreadyAddedOrExcludedPolylines.add(i),n=!0);n&&(this.activeRectangle=e)}while(n);return t}RelaxPolyline(){let e=Et.CreateRelaxedPolylinePoints(this._polyline);for(e=e.Next;null!=e.Next;e=e.Next)this.RelaxPolylinePoint(e)}static CreateRelaxedPolylinePoints(e){let t=e.startPoint;const n=new kT(t,t.point);let i=n;for(;null!=t.next;){t=t.next;const s=new kT(t,t.point);s.Prev=i,i.Next=s,i=s}return n}RelaxPolylinePoint(e){if(!(null==e.PolylinePoint.prev.prev&&this.SourcePort instanceof hr&&e.PolylinePoint.polyline!=this.SourceLoosePolyline||null==e.PolylinePoint.next.next&&this.TargetPort instanceof hr&&e.PolylinePoint.polyline!=this.TargetLoosePolyline))for(let t=this.OffsetForPolylineRelaxing;t>q.distanceEpsilon&&!this.RelaxWithGivenOffset(t,e);)t/=2}RelaxWithGivenOffset(e,t){return Et.SetRelaxedPointLocation(e,t),!!this.StickingSegmentDoesNotIntersectTightObstacles(t)||(Et.PullCloserRelaxedPoint(t.Prev),!1)}static PullCloserRelaxedPoint(e){e.PolylinePoint.point=e.OriginalPosition.mul(.2).add(e.PolylinePoint.point.mul(.8))}StickingSegmentDoesNotIntersectTightObstacles(e){return!(this.PolylineSegmentIntersectsTightHierarchy(e.PolylinePoint.point,e.Prev.PolylinePoint.point)||null!=e.Next&&this.PolylineSegmentIntersectsTightHierarchy(e.PolylinePoint.point,e.Next.PolylinePoint.point))}PolylineSegmentIntersectsTightHierarchy(e,t){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchyPPR(e,t,this.ObstacleCalculator.RootOfTightHierarchy)}PolylineIntersectsPolyRectangleNodeOfTightHierarchyPPR(e,t,n){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(me.mkPP(e,t),n)}PolylineIntersectsPolyRectangleNodeOfTightHierarchy(e,t){if(!e.boundingBox.intersects(t.irect))return!1;if(null!=t.UserData){for(const n of ee.getAllIntersections(e,t.UserData,!1))if(n.seg1!=this.SourceTightPolyline&&n.seg1!=this.TargetTightPolyline||(n.seg1==this.SourceTightPolyline&&this.SourcePort)instanceof hr||(n.seg1==this.TargetTightPolyline&&this.TargetPort)instanceof hr)return!0;return!1}return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(e,t.Left)||this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(e,t.Right)}static IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,t){const n=new Array;return Et.IntersectionsOfLineAndRectangleNodeOverPolyline(e,t,n),n}static IntersectionsOfLineAndRectangleNodeOverPolyline(e,t,n){if(null!=t&&e.boundingBox.intersects(t.irect)){if(null!=t.UserData)return void zo(n,ee.getAllIntersections(e,t.UserData,!0));Et.IntersectionsOfLineAndRectangleNodeOverPolyline(e,t.Left,n),Et.IntersectionsOfLineAndRectangleNodeOverPolyline(e,t.Right,n)}}LineCanBeAcceptedForRouting(e){const n=this.TargetPort instanceof Qi;if(!((this.SourcePort instanceof Qi||this.targetIsInsideOfSourceTightPolyline||this.InsideOfTheAllowedConeOfBoundaryPort(e.end,this.SourcePort))&&(n||null==this.TargetPort||this.sourceIsInsideOfTargetTightPolyline||this.InsideOfTheAllowedConeOfBoundaryPort(e.start,this.TargetPort))))return!1;const i=Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy);for(const s of i)if(s.seg1!=this.SourceTightPolyline&&s.seg1!=this.targetTightPolyline)return!1;return!0}InsideOfTheAllowedConeOfBoundaryPort(e,t){const n=t.Curve,i=ti.CurveIsClockwise(n,Et.PointInsideOfConvexCurve(n)),s=t.Location,o=this.GetPointOnTheRightBoundaryPortConeSide(s,n,i,t.Parameter),a=this.GetPointOnTheLeftBoundaryPortConeSide(s,n,i,t.Parameter);return x.getTriangleOrientation(s,o,e)!=Ie.Clockwise&&x.getTriangleOrientation(s,e,a)!=Ie.Clockwise}GetPointOnTheRightBoundaryPortConeSide(e,t,n,i){const s=n?t.rightDerivative(i):t.leftDerivative(i).neg();return e.add(s.rotate(this.EnteringAngleBound))}GetPointOnTheLeftBoundaryPortConeSide(e,t,n,i){const s=n?t.leftDerivative(i).neg():t.rightDerivative(i);return e.add(s.rotate(-this.EnteringAngleBound))}static SetRelaxedPointLocation(e,t){const n=x.getTriangleOrientation(t.Next.OriginalPosition,t.OriginalPosition,t.Prev.OriginalPosition)==Ie.Counterclockwise;let i=t.Next.OriginalPosition.sub(t.Prev.OriginalPosition).normalize().mul(e).rotate(Math.PI/2);n||(i=i.neg()),t.PolylinePoint.point=t.OriginalPosition.add(i)}SmoothCorners(e){let t=e.headSite,n={b:null,c:null};for(;n=ee.findCorner(t);)t=this.SmoothOneCorner(t,n.c,n.b)}SmoothOneCorner(e,t,n){let a,l,c,o=.5;null==e.prev?(c=2,l=1):null==t.next?(c=1,l=2):l=1,c=1;do{a=ee.createBezierSeg(o*c,o*l,e,n,t),n.previouisBezierCoefficient=o*c,n.nextBezierCoefficient=o*l,o/=1.5}while(this.ObstacleCalculator.ObstaclesIntersectICurve(a)&&o>.01);return o*=1.5,o<.5&&o>.01&&(o=.5*(o+1.5*o),a=ee.createBezierSeg(o*c,o*l,e,n,t),this.ObstacleCalculator.ObstaclesIntersectICurve(a)||(n.previouisBezierCoefficient=o*c,n.nextBezierCoefficient=o*l)),n}TryToRemoveInflectionsAndCollinearSegments(e){let t=!0;const n={s:null};for(;t;)for(t=!1,n.s=e.headSite;null!=n.s&&null!=n.s.next;n.s=n.s.next)n.s.turn*n.s.next.turn<0&&(t=this.TryToRemoveInflectionEdge(n)||t)}TryToRemoveInflectionEdge(e){if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.prev.point,e.s.next.point)){const t=e.s.prev,n=e.s.next;return t.next=n,n.prev=t,e.s=t,!0}if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.prev.point,e.s.next.next.point)){const t=e.s.prev,n=e.s.next.next;return t.next=n,n.prev=t,e.s=t,!0}if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.point,e.s.next.next.point)){const t=e.s.next.next;return e.s.next=t,t.prev=e.s,!0}return!1}GetShortestPolyline(e,t){this.CleanTheGraphForShortestPath();const i=new $d(this.visibilityGraph,e,t).GetPath(this.UseEdgeLengthMultiplier);if(null==i)return null;const s=new Me;for(const o of i)s.addPoint(o.point);return Et.RemoveCollinearVertices(s)}CleanTheGraphForShortestPath(){this.visibilityGraph.ClearPrevEdgesTable()}static RemoveCollinearVertices(e){for(let t=e.startPoint.next;null!=t.next;t=t.next)x.getTriangleOrientation(t.prev.point,t.point,t.next.point)==Ie.Collinear&&(t.prev.next=t.next,t.next.prev=t.prev);return e}get OverlapsDetected(){return this.ObstacleCalculator.OverlapsDetected}get TightHierarchy(){return this.ObstacleCalculator.RootOfTightHierarchy}set TightHierarchy(e){this.ObstacleCalculator.RootOfTightHierarchy=e}get LooseHierarchy(){return this.ObstacleCalculator.RootOfLooseHierarchy}set LooseHierarchy(e){this.ObstacleCalculator.RootOfLooseHierarchy=e}CalculateObstacles(){this.ObstacleCalculator=new ti(this.Obstacles,this.TightPadding,this.LoosePadding,this.IgnoreTightPadding),this.ObstacleCalculator.Calculate()}RouteEdgeToLocation(e){this.TargetPort=new Qi(null,e),this.TargetTightPolyline=null,this.TargetLoosePolyline=null;const t=new io(null);let n=me.mkPP(this.SourcePort.Location,e);return this.LineCanBeAcceptedForRouting(n)?(this._polyline=new Me,this._polyline.addPoint(n.start),this._polyline.addPoint(n.end),t.smoothedPolyline=wn.mkFromPoints(this._polyline),t.curve=t.smoothedPolyline.createCurve(),t):this.SourcePort instanceof hr&&(n=me.mkPP(this.StartPointOfEdgeRouting,e),0==Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(n,this.ObstacleCalculator.RootOfTightHierarchy).length)?(this._polyline=new Me,this._polyline.addPoint(this.SourcePort.Location),this._polyline.addPoint(n.start),this._polyline.addPoint(n.end),t.smoothedPolyline=wn.mkFromPoints(this._polyline),t.curve=t.smoothedPolyline.createCurve(),t):(this.ExtendVisibilityGraphToLocation(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),this.RelaxPolyline(),this.SourcePort instanceof hr&&this._polyline.PrependPoint(this.SourcePort.Location),t.smoothedPolyline=wn.mkFromPoints(this._polyline),t.curve=t.smoothedPolyline.createCurve(),t)}RouteEdgeToPort(e,t,n,i){return this.ObstacleCalculator.IsEmpty()?null!=this.sourcePort&&null!=this.targetPort?(i.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(this.sourcePort.Location,this.targetPort.Location),me.mkPP(this.sourcePort.Location,this.targetPort.Location)):null:(this.TargetPort=e,this.TargetTightPolyline=Et.GetFirstHitPolyline(e.Location,this.ObstacleCalculator.RootOfTightHierarchy),e instanceof hr?this.RouteEdgeToBoundaryPort(t,n,i):this.RouteEdgeToFloatingPortOfNode(t,n,i))}SmoothedPolylineFromTwoPoints(e,t){return this._polyline=new Me,this._polyline.addPoint(e),this._polyline.addPoint(t),wn.mkFromPoints(this._polyline)}RouteEdgeToFloatingPortOfNode(e,t,n){return this.sourcePort instanceof Qi?this.RouteFromFloatingPortToFloatingPort(e,t,n):this.RouteFromBoundaryPortToFloatingPort(e,t,n)}RouteFromBoundaryPortToFloatingPort(e,t,n){const i=this.SourcePort.Location,s=this.targetPort.Location;let o=me.mkPP(i,s);if(this.LineCanBeAcceptedForRouting(o))return n.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(o.start,o.end),o;if(!this.targetIsInsideOfSourceTightPolyline){const l=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.SourcePort.Curve,this.SourcePort.Parameter,this.SourceLoosePolyline);if(o=me.mkPP(l,s),this.LineAvoidsTightHierarchyLP(o,e))return n.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(o.start,o.end),o}this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV);const a=this.SourceTightPolyline;return this.targetIsInsideOfSourceTightPolyline||(this.SourceTightPolyline=null),this.TryShortcutPolyline(),this.SourceTightPolyline=a,this.RelaxPolyline(),this._polyline.PrependPoint(i),this.SmoothCornersAndReturnCurve(t,n)}SmoothCornersAndReturnCurve(e,t){return t.smoothedPolyline=wn.mkFromPoints(this._polyline),e&&this.SmoothCorners(t.smoothedPolyline),t.smoothedPolyline.createCurve()}RouteFromFloatingPortToFloatingPort(e,t,n){const s=me.mkPP(this.StartPointOfEdgeRouting,this.TargetPort.Location);return this.AllowedShootingStraightLines&&this.LineAvoidsTightHierarchyLPP(s,this.SourceTightPolyline,this.targetTightPolyline)?(n.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(s.start,s.end),s):(this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),null==this._polyline?null:(this.UseSpanner&&this.TryShortcutPolyline(),this.RelaxPolyline(),n.smoothedPolyline=wn.mkFromPoints(this._polyline),this.SmoothCornersAndReturnCurve(t,n)))}TryShortcutPolyline(){if(this.UseInnerPolylingShortcutting)for(;this.ShortcutPolylineOneTime(););this.UsePolylineEndShortcutting&&this.TryShortCutThePolylineEnds()}TryShortCutThePolylineEnds(){this.TryShortcutPolylineStart(),this.TryShortcutPolylineEnd()}TryShortcutPolylineEnd(){const e=this._polyline.endPoint,t=e.prev;if(null==t)return;const n=t.prev;if(null==n)return;const i=x.middle(t.point,n.point);if(this.LineAvoidsTightHierarchyPPPP(e.point,i,this._sourceTightPolyline,this.targetTightPolyline)){const s=Pr.mkFromPoint(i);s.next=e,s.prev=n,e.prev=s,n.next=s}}TryShortcutPolylineStart(){const e=this._polyline.startPoint,t=e.next;if(null==t)return;const n=t.next;if(null==n)return;const i=x.middle(t.point,n.point);if(this.LineAvoidsTightHierarchyPPPP(e.point,i,this._sourceTightPolyline,this.targetTightPolyline)){const s=Pr.mkFromPoint(i);s.prev=e,s.next=n,e.next=s,n.prev=s}}ShortcutPolylineOneTime(){let e=!1;for(let t=this._polyline.startPoint;null!=t.next&&null!=t.next.next;t=t.next)e=e||this.TryShortcutPolyPoint(t);return e}TryShortcutPolyPoint(e){return!!this.LineAvoidsTightHierarchyLPP(me.mkPP(e.point,e.next.next.point),this.SourceTightPolyline,this.targetTightPolyline)&&(e.next=e.next.next,e.next.prev=e,!0)}ExtendVisibilityGraphToLocationOfTargetFloatingPort(e){null==this.VisibilityGraph&&(this.VisibilityGraph=new tn);let t=null;const n=this.targetPort.Location;if(!this.activeRectangle.contains(n)){this.activeRectangle.isEmpty?this.activeRectangle=Ne.mkPP(this.SourcePort.Location,n):this.activeRectangle.add(n),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle();for(const i of t)this.VisibilityGraph.AddHole(i.Polyline)}null==t?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(n,e),null==this.sourceVV&&this.CalculateSourcePortVisibilityGraph()):(this.RemovePointVisibilityGraphs(),new fo(t,this.activePolygons,this.VisibilityGraph).run(),zo(this.activePolygons,t),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(n,e),this.CalculateSourcePortVisibilityGraph())}CalculateEdgeTargetVisibilityGraphForFloatingPort(e,t){this.targetVV=this.UseSpanner?this.AddTransientVisibilityEdgesForPort(e,t):Ds.CalculatePointVisibilityGraph(this.GetActivePolylinesWithException(t),this.VisibilityGraph,e,es.Tangent)}AddTransientVisibilityEdgesForPort(e,t){let n=this.GetVertex(e);if(null!=n)return n;if(n=this.visibilityGraph.AddVertexP(e),null!=t)for(const i of t)this.visibilityGraph.AddEdgeF(e,i,(s,o)=>new Xi(s,o));else n=Ds.CalculatePointVisibilityGraph(this.GetActivePolylines(),this.VisibilityGraph,e,es.Tangent);return n}GetVertex(e){let t=this.visibilityGraph.FindVertex(e);return null==t&&this.LookForRoundedVertices&&(t=this.visibilityGraph.FindVertex(q.RoundPoint(e))),t}*GetActivePolylinesWithException(e){for(const t of this.activePolygons)t.Polyline!=e&&(yield t.Polyline)}RouteEdgeToBoundaryPort(e,t,n){return this.TargetLoosePolyline=e,this.sourcePort instanceof Qi?this.RouteFromFloatingPortToBoundaryPort(t,n):this.RouteFromBoundaryPortToBoundaryPort(t,n)}RouteFromBoundaryPortToBoundaryPort(e,t){const n=this.SourcePort.Location;let i;const s=this.targetPort.Location;let o=me.mkPP(n,s);if(this.LineCanBeAcceptedForRouting(o))this._polyline=new Me,this._polyline.addPoint(o.start),this._polyline.addPoint(o.end),t.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(o.start,o.end),i=wn.mkFromPoints(this._polyline).createCurve();else{const a=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.targetPort.Curve,this.targetPort.Parameter,this.TargetLoosePolyline);if(o=me.mkPP(n,a),this.InsideOfTheAllowedConeOfBoundaryPort(a,this.SourcePort)&&this.LineAvoidsTightHierarchyLP(o,this._sourceTightPolyline))this._polyline=new Me,this._polyline.addPoint(o.start),this._polyline.addPoint(o.end),this._polyline.addPoint(s),i=this.SmoothCornersAndReturnCurve(e,t);else if(o=me.mkPP(this.StartPointOfEdgeRouting,s),this.InsideOfTheAllowedConeOfBoundaryPort(this.StartPointOfEdgeRouting,this.TargetPort)&&this.LineAvoidsTightHierarchy(o))this._polyline=new Me,this._polyline.addPoint(n),this._polyline.addPoint(o.start),this._polyline.addPoint(o.end),i=this.SmoothCornersAndReturnCurve(e,t);else{let l;if(l=me.IntersectPPPP(n,this.StartPointOfEdgeRouting,s,a))this._polyline=new Me,this._polyline.addPoint(n),this._polyline.addPoint(l),this._polyline.addPoint(s),i=this.SmoothCornersAndReturnCurve(e,t);else if(x.closeDistEps(this.StartPointOfEdgeRouting,a))this._polyline=new Me,this._polyline.addPoint(n),this._polyline.addPoint(a),this._polyline.addPoint(s),i=this.SmoothCornersAndReturnCurve(e,t);else if(this.LineAvoidsTightHierarchy(me.mkPP(this.StartPointOfEdgeRouting,a)))this._polyline=new Me,this._polyline.addPoint(n),this._polyline.addPoint(this.StartPointOfEdgeRouting),this._polyline.addPoint(a),this._polyline.addPoint(s),i=this.SmoothCornersAndReturnCurve(e,t);else{this.ExtendVisibilityGraphToTargetBoundaryPort(a),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV);const c={tmpTargetTight:null},u=this.HideSourceTargetTightsIfNeeded(c);this.TryShortcutPolyline(),this.RecoverSourceTargetTights(u,c.tmpTargetTight),this.RelaxPolyline(),this._polyline.PrependPoint(n),this._polyline.addPoint(s),i=this.SmoothCornersAndReturnCurve(e,t)}}}return i}RecoverSourceTargetTights(e,t){this.SourceTightPolyline=e,this.TargetTightPolyline=t}HideSourceTargetTightsIfNeeded(e){const t=this.SourceTightPolyline;return e.tmpTargetTight=this.TargetTightPolyline,this.TargetTightPolyline=null,this.SourceTightPolyline=null,t}LineAvoidsTightHierarchy(e){return 0==Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy).length}RouteFromFloatingPortToBoundaryPort(e,t){const n=this.targetPort.Location;let i;if(this.InsideOfTheAllowedConeOfBoundaryPort(this.sourcePort.Location,this.targetPort)&&(i=me.mkPP(this.SourcePort.Location,n),this.LineCanBeAcceptedForRouting(i)))return t.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(i.start,i.end),i;const s=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.TargetPort.Curve,this.TargetPort.Parameter,this.TargetLoosePolyline);return i=me.mkPP(this.SourcePort.Location,s),this.LineAvoidsTightHierarchyLP(i,this._sourceTightPolyline)?(this._polyline=Me.mkFromPoints([i.start,i.end,n]),t.smoothedPolyline=wn.mkFromPoints(this._polyline),t.smoothedPolyline.createCurve()):(this.ExtendVisibilityGraphToTargetBoundaryPort(s),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),this.RelaxPolyline(),this._polyline.addPoint(n),this.SmoothCornersAndReturnCurve(e,{smoothedPolyline:null}))}LineAvoidsTightHierarchyLP(e,t){let n=!0;for(const i of Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy))if(i.seg1!=t){n=!1;break}return n}LineAvoidsTightHierarchyLPP(e,t,n){let i=!0;for(const s of Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy))if(s.seg1!=t&&s.seg1!=n){i=!1;break}return i}LineAvoidsTightHierarchyPPPP(e,t,n,i){return this.LineAvoidsTightHierarchyLPP(me.mkPP(e,t),n,i)}ExtendVisibilityGraphToTargetBoundaryPort(e){let t=null;if(null==this.VisibilityGraph&&(this.VisibilityGraph=new tn),!this.activeRectangle.contains(e)||!this.activeRectangle.containsRect(this.TargetLoosePolyline.boundingBox)){this.activeRectangle.isEmpty?(this.activeRectangle=this.TargetLoosePolyline.boundingBox.clone(),this.activeRectangle.add(this.SourcePort.Location),this.activeRectangle.add(this.StartPointOfEdgeRouting),this.activeRectangle.add(e)):(this.activeRectangle.add(e),this.activeRectangle.addRec(this.TargetLoosePolyline.boundingBox)),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle();for(const n of t)this.VisibilityGraph.AddHole(n.Polyline)}null==t?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraph(e)):(this.RemovePointVisibilityGraphs(),new fo(t,this.activePolygons,this.VisibilityGraph).run(),zo(this.activePolygons,t),this.CalculateEdgeTargetVisibilityGraph(e),this.CalculateSourcePortVisibilityGraph())}GetHitLoosePolyline(e){return this.ObstacleCalculator.IsEmpty()||null==this.ObstacleCalculator.RootOfLooseHierarchy?null:Et.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy)}static GetFirstHitPolyline(e,t){const n=Et.GetFirstHitRectangleNode(e,t);return n?n.UserData:null}static GetFirstHitRectangleNode(e,t){return null==t?null:t.FirstHitNodePF(e,(n,i)=>ee.PointRelativeToCurveLocation(n,i)!=Fe.Outside?Pt.Stop:Pt.Continue)}Clean(){this.TargetPort=null,this.SourcePort=null,this.SourceTightPolyline=null,this.SourceLoosePolyline=null,this.TargetLoosePolyline=null,this.targetTightPolyline=null,this.VisibilityGraph=null,this.targetVV=null,this.sourceVV=null,this.activePolygons=[],this.alreadyAddedOrExcludedPolylines.clear(),this.activeRectangle.setToEmpty()}SetSourcePortAndSourceLoosePolyline(e,t){this.SourceLoosePolyline=t,this.sourcePort=e,null!=this.sourcePort&&(this.SourceTightPolyline=Et.GetFirstHitPolyline(this.sourcePort.Location,this.ObstacleCalculator.RootOfTightHierarchy),this.sourcePort instanceof Qi?(this.alreadyAddedOrExcludedPolylines.add(this.SourceLoosePolyline),this.StartPointOfEdgeRouting=this.SourcePort.Location):this.StartPointOfEdgeRouting=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.SourcePort.Curve,this.sourcePort.Parameter,this.SourceLoosePolyline))}run(){this.CalculateWholeTangentVisibilityGraph()}CalculateWholeTangentVisibilityGraph(){this.VisibilityGraph=new tn,this.CalculateWholeVisibilityGraphOnExistingGraph()}CalculateWholeVisibilityGraphOnExistingGraph(){this.activePolygons=Array.from(this.AllPolygons());for(const t of this.ObstacleCalculator.LooseObstacles)this.VisibilityGraph.AddHole(t);let e;e=this.UseSpanner?new uu(this.ObstacleCalculator.LooseObstacles,this.VisibilityGraph):new fo(new Array,this.activePolygons,this.visibilityGraph),e.run()}RouteSplineFromPortToPortWhenTheWholeGraphIsReady(e,t,n,i){const s=e instanceof Qi&&t instanceof hr||e instanceof Yn;if(s){const a=e;e=t,t=a}this.sourcePort=e,this.targetPort=t,this.FigureOutSourceTargetPolylinesAndActiveRectangle();let o=this.GetEdgeGeomByRouting(n,i);return null==o?null:(this.targetVV=null,this.sourceVV=null,s&&(o=o.reverse()),o)}GetEdgeGeomByRouting(e,t){let n;if(this.sourceIsInsideOfTargetTightPolyline=null==this.TargetTightPolyline||ee.PointRelativeToCurveLocation(this.sourcePort.Location,this.TargetTightPolyline)==Fe.Inside,this.sourcePort instanceof hr){const i=this.sourcePort;this.StartPointOfEdgeRouting=this.targetIsInsideOfSourceTightPolyline?i.Location:this.TakeBoundaryPortOutsideOfItsLoosePolyline(i.Curve,i.Parameter,this.SourceLoosePolyline),this.CalculateSourcePortVisibilityGraph();const s={smoothedPolyline:null};n=this.targetPort instanceof hr?this.RouteFromBoundaryPortToBoundaryPort(e,s):this.RouteFromBoundaryPortToFloatingPort(this.targetLoosePolyline,e,s)}else this.targetPort instanceof Qi?(this.ExtendVisibilityGraphFromFloatingSourcePort(),n=this.RouteFromFloatingPortToFloatingPort(this.targetLoosePolyline,e,t)):(xd.assert(this.targetPort instanceof Yn),n=this.RouteFromFloatingPortToAnywherePort(this.targetPort.LoosePolyline,e,t,this.targetPort));return n}RouteFromFloatingPortToAnywherePort(e,t,n,i){return i.Curve.boundingBox.contains(this.sourcePort.Location)?(this.sourceVV=this.GetVertex(this.sourcePort.Location),this._polyline=this.GetShortestPolylineToMulitpleTargets(this.sourceVV,Array.from(this.Targets(e))),null==this._polyline?null:(this.UseSpanner&&this.TryShortcutPolyline(),this.RelaxPolyline(),this.FixLastPolylinePointForAnywherePort(i),i.HookSize>0&&this.BuildHook(i),this.SmoothCornersAndReturnCurve(t,n))):(n.smoothedPolyline=null,null)}BuildHook(e){const t=e.Curve,n=mt.mkFullEllipseNNP(e.HookSize,e.HookSize,this._polyline.end),i=ee.getAllIntersections(t,n,!0);x.getTriangleOrientation(i[0].x,this._polyline.end,this._polyline.endPoint.prev.point)==Ie.Counterclockwise&&i.reverse();const s=this._polyline.end.sub(this._polyline.endPoint.prev.point).normalize(),o=t.derivative(i[0].par0).normalize(),a=o.dot(s);if(Math.abs(a)<.2)this.ExtendPolyline(o,i[0],s,e);else{const l=t.derivative(i[1].par0).normalize();l.dot(s)<a?this.ExtendPolyline(l,i[1],s,e):this.ExtendPolyline(o,i[0],s,e)}}ExtendPolyline(e,t,n,i){let s=e.rotate(Math.PI/2);s.dot(n)<0&&(s=s.neg());const o=t.x.add(s.mul(i.HookSize));let a;!(a=x.lineLineIntersection(o,o.add(e),this._polyline.end,this._polyline.end.add(n)))||(this._polyline.addPoint(a),this._polyline.addPoint(o),this._polyline.addPoint(t.x))}FixLastPolylinePointForAnywherePort(e){for(;;){const t=this.GetLastPointInsideOfCurveOnPolyline(e.Curve);t.next.next=null,this._polyline.endPoint=t.next;let n=t.next.point.sub(t.point);n=n.normalize().mul(e.Curve.boundingBox.diagonal);const i=n.rotate(-1*e.AdjustmentAngle),s=n.rotate(e.AdjustmentAngle),o=ee.intersectionOne(e.Curve,me.mkPP(t.point,t.point.add(i)),!0),a=ee.intersectionOne(e.Curve,me.mkPP(t.point,t.point.add(s)),!0);if(null==o||null==a)return;const l=Et.GetTrimmedCurveForHookingUpAnywhere(e.Curve,t,o,a),c=l.value(l.closestParameter(t.point));if(!this.LineAvoidsTightHierarchyLPP(me.mkPP(t.point,c),this.SourceTightPolyline,null)){const u=ee.intersectionOne(e.Curve,me.mkPP(t.point,t.next.point),!1);if(null==u)return;this._polyline.endPoint.point=u.x;break}if(this._polyline.endPoint.point=c,null==t.prev||!this.TryShortcutPolyPoint(t.prev))break}}static GetTrimmedCurveForHookingUpAnywhere(e,t,n,i){const s=x.getTriangleOrientation(i.x,n.x,t.point)==Ie.Clockwise,o=n.par0,a=i.par0;let l,c,u;return s?o<a?e.trim(o,a):(c=e.trim(o,e.parEnd),l=e.trim(e.parStart,a),u=new ee,u.addSegs([c,l])):a<o?e.trim(a,o):(c=e.trim(a,e.parEnd),l=e.trim(e.parStart,o),u=new ee,u.addSegs([c,l]))}GetLastPointInsideOfCurveOnPolyline(e){for(let t=this._polyline.endPoint.prev;null!=t;t=t.prev)if(null==t.prev||ee.PointRelativeToCurveLocation(t.point,e)==Fe.Inside)return t;throw new Error}GetShortestPolylineToMulitpleTargets(e,t){this.CleanTheGraphForShortestPath();const i=new hu(e,t,this.VisibilityGraph).GetPath();if(null==i)return null;const s=new Me;for(const o of i)s.addPoint(o.point);return Et.RemoveCollinearVertices(s)}Targets(e){return Array.from(e).map(t=>this.visibilityGraph.FindVertex(t))}ExtendVisibilityGraphFromFloatingSourcePort(){this.StartPointOfEdgeRouting=this.sourcePort.Location,this.sourceVV=this.UseSpanner?this.AddTransientVisibilityEdgesForPort(this.sourcePort.Location,this.SourceLoosePolyline):Ds.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()).filter(t=>t!=this.SourceLoosePolyline),this.VisibilityGraph,this.StartPointOfEdgeRouting,es.Tangent)}FigureOutSourceTargetPolylinesAndActiveRectangle(){let e=this.sourcePort.Curve.value(this.sourcePort.Curve.parStart);this._sourceTightPolyline=Et.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfTightHierarchy),this.SourceLoosePolyline=Et.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy),e=this.targetPort.Curve.value(this.targetPort.Curve.parStart),this.targetTightPolyline=Et.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfTightHierarchy),this.targetLoosePolyline=Et.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy),this.activeRectangle=Ne.mkPP(new x(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),new x(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY))}*AllPolygons(){for(const e of this.ObstacleCalculator.LooseObstacles)yield new dr(e)}GetVisibilityGraph(){return this.VisibilityGraph}AddActivePolygons(e){zo(this.activePolygons,e)}ClearActivePolygons(){this.activePolygons=[]}}class fu{constructor(){this.size_=0,this.mapOfMaps=new cr}clear(){this.mapOfMaps.clear(),this.size_=0}get size(){return this.size_}set(e,t){const n=e.first,i=e.second;let s=this.mapOfMaps.get(n);null==s&&this.mapOfMaps.set(n,s=new cr),s.has(i)||this.size_++,s.set(i,t)}delete(e){const n=e.second,i=this.mapOfMaps.get(e.first);null!=i&&i.deleteP(n)&&this.size_--}has(e){const t=this.mapOfMaps.get(e.first);return null!=t&&t.has(e.second)}get_(e,t){return this.get(new Gn(e,t))}get(e){const t=this.mapOfMaps.get(e.first);if(null!=t)return t.get(e.second)}*keys(){for(const e of this.mapOfMaps)for(const t of e[1])yield new Gn(e[0],t[0])}*[Symbol.iterator](){for(const[e,t]of this.mapOfMaps)for(const[n,i]of t)yield[new Gn(e,n),i]}*values(){for(const e of this.mapOfMaps)for(const t of e[1])yield t[1]}}class _r{static GetShapes(e,t=Array.from(e.edges())){const n=new Map;GT(e,n);for(const i of t){let s=n.get(i.source);s&&null!=i.sourcePort&&s.Ports.add(i.sourcePort),s=n.get(i.target),s&&null!=i.targetPort&&s.Ports.add(i.targetPort)}return Array.from(n.values())}static CreateShapeWithCenterPort(e){const t=new ey(()=>e.boundaryCurve),n=lo.mk(()=>e.boundaryCurve,()=>e.center);t.Ports.add(n);for(const i of e.inEdges())_r.FixPortAtTarget(n,i);for(const i of e.outEdges())_r.FixPortAtSource(n,i);for(const i of e.selfEdges())_r.FixPortAtSource(n,i),_r.FixPortAtTarget(n,i);return t}static CreateShapeWithClusterBoundaryPort(e){xd.assert(e instanceof Ii);const t=new ey(()=>e.boundaryCurve),n=Zr.mk(()=>e.boundaryCurve,()=>e.center);let i;t.Ports.add(n);for(const s of e.inEdges())s.EdgeToAncestor()==to.ToAncestor?(null==i&&(i=new Yn(()=>e.boundaryCurve)),s.targetPort=i):_r.FixPortAtTarget(n,s);for(const s of e.outEdges())s.EdgeToAncestor()==to.FromAncestor?(null==i&&(i=new Yn(()=>e.boundaryCurve)),s.sourcePort=i):_r.FixPortAtSource(n,s);for(const s of e.selfEdges())_r.FixPortAtSource(n,s),_r.FixPortAtTarget(n,s);return t}static FixPortAtSource(e,t){null==t.sourcePort&&(t.sourcePort=e)}static FixPortAtTarget(e,t){null==t.targetPort&&(t.targetPort=e)}}function GT(r,e){for(const t of r.shallowNodes())if(t instanceof Ii){const n=_r.CreateShapeWithClusterBoundaryPort(t);e.set(t,n);const i=t;if(!i.graph.isCollapsed){GT(i,e);for(const s of i.shallowNodes())n.AddChild(e.get(s))}}else e.set(t,_r.CreateShapeWithCenterPort(t))}class gu{constructor(e){this.Right=e,this.Left=e}SetActiveState(e,t){this.IsActive=e,this.VectorIndex=t,this.IsActive?(this.Left.ActiveConstraintCount++,this.Right.ActiveConstraintCount++):(this.Left.ActiveConstraintCount--,this.Right.ActiveConstraintCount--)}SetVectorIndex(e){this.VectorIndex=e}Reinitialize(){this.IsActive=!1,this.IsUnsatisfiable=!1,this.ClearDfDv()}UpdateGap(e){this.Gap=e}static constructorVVNB(e,t,n,i){const s=new gu(e);return s.Left=e,s.Right=t,s.Gap=n,s.IsEquality=i,s.Lagrangian=0,s.IsActive=!1,s}ToString(){return In.String.Format("  Cst: [{0}] [{1}] {2} {3:F5} vio {4:F5} Lm {5:F5}/{6:F5} {7}actv",this.Left,this.Right,this.IsEquality?"==":">=",this.Gap,this.Violation,this.Lagrangian,2*this.Lagrangian,this.IsActive?"+":this.IsUnsatisfiable?"!":"-")}get Violation(){return this.Left.ActualPos*this.Left.Scale+(this.Gap-this.Right.ActualPos*this.Right.Scale)}ClearDfDv(){this.Lagrangian=0}CompareTo(e){let t=this.Left.CompareTo(e.Left);return 0==t&&(t=this.Right.CompareTo(e.Right)),0==t&&(t=Tt(this.Gap,e.Gap)),t}}class pu{constructor(e){this.ConstraintToEval=e,this.Depth=-1}static constructorDCVV(e,t,n,i){const s=new pu(t);return s.Set(e,t,n,i),s}Set(e,t,n,i){return this.Parent=e,this.ConstraintToEval=t,this.VariableToEval=n,this.VariableDoneEval=i,this.Depth=0,this.ChildrenHaveBeenPushed=!1,t.Lagrangian=0,this}get IsLeftToRight(){return this.VariableToEval==this.ConstraintToEval.Right}toString(){return In.String.Format("{0} {1}{2} - {3}{4} ({5})","",this.IsLeftToRight?"":"*",this.ConstraintToEval.Left.Name,this.IsLeftToRight?"*":"",this.ConstraintToEval.Right.Name,this.Depth)}}class V4{constructor(e,t){this.Constraint=e,this.IsForward=t}}class qd{constructor(e,t){this.Variables=new Array,null!=e&&this.AddVariable(e),this.allConstraints=t}toString(){return In.String.Format("[Block: nvars = {0} refpos = {1:F5} scale = {2:F5}]",this.Variables.length,this.ReferencePos,this.Scale)}ComputeDfDv(e){this.allConstraints.DfDvStack=new kt.K;const t=new gu(e);this.dfDvDummyParentNode=new pu(t);const n=this.GetDfDvNode(this.dfDvDummyParentNode,t,e,null);for(this.allConstraints.DfDvStack.push(n);;){const i=this.allConstraints.DfDvStack.top,s=this.allConstraints.DfDvStack.length;if(!i.ChildrenHaveBeenPushed){i.ChildrenHaveBeenPushed=!0;for(const o of i.VariableToEval.LeftConstraints)if(o.IsActive&&o.Right!=i.VariableDoneEval){const a=this.GetDfDvNode(i,o,o.Right,i.VariableToEval);1==o.Right.ActiveConstraintCount?this.ProcessDfDvLeafNodeDirectly(a):this.PushDfDvNode(a)}for(const o of i.VariableToEval.RightConstraints)if(o.IsActive&&o.Left!=i.VariableDoneEval){const a=this.GetDfDvNode(i,o,o.Left,i.VariableToEval);1==o.Left.ActiveConstraintCount?this.ProcessDfDvLeafNodeDirectly(a):this.PushDfDvNode(a)}if(this.allConstraints.DfDvStack.length>s)continue}if(this.allConstraints.DfDvStack.pop(),this.ProcessDfDvLeafNode(i),i==n)break}}ProcessDfDvLeafNode(e){const t=e.VariableToEval.DfDv;e.IsLeftToRight?(e.ConstraintToEval.Lagrangian=e.ConstraintToEval.Lagrangian+t,e.Parent.ConstraintToEval.Lagrangian=e.Parent.ConstraintToEval.Lagrangian+e.ConstraintToEval.Lagrangian):(e.ConstraintToEval.Lagrangian=-1*(e.ConstraintToEval.Lagrangian+t),e.Parent.ConstraintToEval.Lagrangian=e.Parent.ConstraintToEval.Lagrangian-e.ConstraintToEval.Lagrangian),this.CheckForConstraintPathTarget(e),this.Debug_CheckForViolatedActiveConstraint(e.ConstraintToEval),this.allConstraints.RecycleDfDvNode(e)}Debug_CheckForViolatedActiveConstraint(e){}ProcessDfDvLeafNodeDirectly(e){this.ProcessDfDvLeafNode(e)}GetDfDvNode(e,t,n,i){const s=this.allConstraints.DfDvRecycleStack.size>0?this.allConstraints.DfDvRecycleStack.pop().Set(e,t,n,i):pu.constructorDCVV(e,t,n,i);return s.Depth=s.Parent.Depth+1,this.allConstraints.MaxConstraintTreeDepth<s.Depth&&(this.allConstraints.MaxConstraintTreeDepth=s.Depth),s}PushDfDvNode(e){this.PushOnDfDvStack(e)}AddVariableAndPushDfDvNode(e,t){e.push(t.VariableToEval),this.PushOnDfDvStack(t)}PushOnDfDvStack(e){this.allConstraints.DfDvStack.push(e)}CheckForConstraintPathTarget(e){if(this.pathTargetVariable==e.VariableToEval){for(;e.Parent!=this.dfDvDummyParentNode;)this.constraintPath.push(new V4(e.ConstraintToEval,e.IsLeftToRight)),e=e.Parent;this.pathTargetVariable=null}}Expand(e){null==this.constraintPath&&(this.constraintPath=new Array),this.constraintPath=[],this.pathTargetVariable=e.Right,this.ComputeDfDv(e.Left);let t=null;if(this.constraintPath.length>0){for(const o of this.constraintPath)o.IsForward&&(null==t||o.Constraint.Lagrangian<t.Lagrangian)&&(o.Constraint.IsEquality||(t=o.Constraint));null!=t&&this.allConstraints.DeactivateConstraint(t)}if(this.constraintPath=[],this.pathTargetVariable=null,null==t)return e.IsUnsatisfiable=!0,void this.allConstraints.NumberOfUnsatisfiableConstraints++;const n=new Array;this.GetConnectedVariables(n,e.Right,e.Left);const i=e.Violation,s=n.length;for(let o=0;o<s;o++)n[o].OffsetInBlock=n[o].OffsetInBlock+i;this.allConstraints.ActivateConstraint(e),e.ClearDfDv(),this.UpdateReferencePos()}Split(e){if(e&&this.UpdateReferencePos(),this.Variables.length<2)return null;let t=null;this.ComputeDfDv(this.Variables[0]);let n=this.allConstraints.SolverParameters.Advanced.MinSplitLagrangianThreshold;const i=this.Variables.length;for(let s=0;s<i;s++)for(const o of this.Variables[s].LeftConstraints)o.IsActive&&!o.IsEquality&&o.Lagrangian<n&&(t=o,n=o.Lagrangian);return null==t?null:this.SplitOnConstraint(t)}SplitOnConstraint(e){this.allConstraints.DeactivateConstraint(e);let t=new qd(null,this.allConstraints);return this.TransferConnectedVariables(t,e.Right,e.Left),t.Variables.length>0?(this.UpdateReferencePos(),t.UpdateReferencePos()):t=null,t}AddVariable(e){this.Variables.push(e),e.Block=this,1==this.Variables.length?(this.Scale=e.Scale,this.ReferencePos=e.ActualPos,this.sumAd=e.ActualPos*e.Weight,this.sumAb=0,this.sumA2=e.Weight,e.OffsetInBlock=0):this.AddVariableToBlockSums(e)}UpdateReferencePos(){this.Scale=this.Variables[0].Scale,this.sumAd=0,this.sumAb=0,this.sumA2=0;const e=this.Variables.length;for(let t=0;t<e;t++)this.AddVariableToBlockSums(this.Variables[t]);this.UpdateReferencePosFromSums()}AddVariableToBlockSums(e){const t=this.Scale/e.Scale,n=e.OffsetInBlock/e.Scale,i=t*e.Weight;this.sumAd=this.sumAd+i*e.DesiredPos,this.sumAb=this.sumAb+i*n,this.sumA2=this.sumA2+i*t}UpdateReferencePosFromSums(){if(!(Number.isFinite(this.sumAd)&&Number.isFinite(this.sumAb)&&Number.isFinite(this.sumA2)))throw new Error("infinite numbers");this.ReferencePos=(this.sumAd-this.sumAb)/this.sumA2,this.UpdateVariablePositions()}UpdateVariablePositions(){const e=this.Scale*this.ReferencePos,t=this.Variables.length;for(let n=0;n<t;n++){const i=this.Variables[n];i.ActualPos=(e+i.OffsetInBlock)/i.Scale}}GetConnectedVariables(e,t,n){this.RecurseGetConnectedVariables(e,t,n)}RecurseGetConnectedVariables(e,t,n){this.allConstraints.DfDvStack=new kt.K;const i=new gu(t);for(this.dfDvDummyParentNode=new pu(i),this.allConstraints.DfDvStack.push(this.GetDfDvNode(this.dfDvDummyParentNode,i,t,n)),e.push(t);this.allConstraints.DfDvStack.length>0;){const s=this.allConstraints.DfDvStack.top,o=this.allConstraints.DfDvStack.length;if(!s.ChildrenHaveBeenPushed){s.ChildrenHaveBeenPushed=!0;for(const a of s.VariableToEval.LeftConstraints)a.IsActive&&a.Right!=s.VariableDoneEval&&(1==a.Right.ActiveConstraintCount?e.push(a.Right):this.AddVariableAndPushDfDvNode(e,this.GetDfDvNode(s,a,a.Right,s.VariableToEval)));for(const a of s.VariableToEval.RightConstraints)a.IsActive&&a.Left!=s.VariableDoneEval&&(1==a.Left.ActiveConstraintCount?e.push(a.Left):this.AddVariableAndPushDfDvNode(e,this.GetDfDvNode(s,a,a.Left,s.VariableToEval)))}this.allConstraints.DfDvStack.length>o||this.allConstraints.RecycleDfDvNode(this.allConstraints.DfDvStack.pop())}}TransferConnectedVariables(e,t,n){this.GetConnectedVariables(e.Variables,t,n);const i=e.Variables.length;for(let o=0;o<i;o++)e.Variables[o].Block=e;let s=this.Variables.length-1;for(let o=this.Variables.length-1;o>=0;o--)this.Variables[o].Block==e&&(o<s&&(this.Variables[o]=this.Variables[s]),s--);if(this.Variables=this.Variables.slice(0,s+1),0==this.Variables.length){for(let o=0;o<i;o++){const a=e.Variables[o];this.Variables.push(a),a.Block=this}e.Variables=[]}}}class H4{constructor(){this.Vector=new Array}get Count(){return this.Vector.length}item(e){return this.Vector[e]}Add(e){e.VectorIndex=this.Vector.length,this.Vector.push(e)}Remove(e){const t=this.Vector[this.Vector.length-1];this.Vector[e.VectorIndex]=t,t.VectorIndex=e.VectorIndex,this.Vector.pop()}toString(){return this.Vector.toString()}}class Y4{constructor(){this.nextConstraintIndex=0,this.DfDvStack=new kt.K,this.DfDvRecycleStack=new kt.K}get IsEmpty(){return null==this.Vector}Create(e){this.Vector=new Array(e),this.firstActiveConstraintIndex=e}Add(e){e.SetVectorIndex(this.nextConstraintIndex),this.Vector[this.nextConstraintIndex++]=e}ActivateConstraint(e){this.firstActiveConstraintIndex--,this.SwapConstraint(e)}DeactivateConstraint(e){this.SwapConstraint(e),this.firstActiveConstraintIndex++}SwapConstraint(e){const t=this.Vector[this.firstActiveConstraintIndex];t.SetVectorIndex(e.VectorIndex),this.Vector[e.VectorIndex]=t,this.Vector[this.firstActiveConstraintIndex]=e,e.SetActiveState(!e.IsActive,this.firstActiveConstraintIndex)}Reinitialize(){if(null!=this.Vector){for(const e of this.Vector)e.Reinitialize();this.firstActiveConstraintIndex=this.Vector.length}}RecycleDfDvNode(e){this.DfDvRecycleStack.length<1024&&this.DfDvRecycleStack.push(e)}toString(){return this.Vector.toString()}}class sy{constructor(){this.GapTolerance=1e-4,this.QpscConvergenceEpsilon=1e-5,this.QpscConvergenceQuotient=1e-6,this.OuterProjectIterationsLimit=-1,this.InnerProjectIterationsLimit=-1,this.TimeLimit=-1,this.Advanced=new oy}Clone(){const e=this.MemberwiseClone();return e.Advanced=this.Advanced.Clone(),e}MemberwiseClone(){const e=new sy;return e.GapTolerance=this.GapTolerance,e.QpscConvergenceEpsilon=this.QpscConvergenceEpsilon,e.QpscConvergenceQuotient=this.QpscConvergenceQuotient,e.OuterProjectIterationsLimit=this.OuterProjectIterationsLimit,e.InnerProjectIterationsLimit=this.InnerProjectIterationsLimit,e.TimeLimit=this.TimeLimit,e}}class oy{constructor(){this.ForceQpsc=!1,this.ScaleInQpsc=!0,this.MinSplitLagrangianThreshold=-1e-7,this.UseViolationCache=!0,this.ViolationCacheMinBlocksDivisor=10,this.ViolationCacheMinBlocksCount=100}Clone(){const e=new oy;return e.ForceQpsc=this.ForceQpsc,e.ScaleInQpsc=this.ScaleInQpsc,e.MinSplitLagrangianThreshold=this.MinSplitLagrangianThreshold,e.UseViolationCache=this.UseViolationCache,e.ViolationCacheMinBlocksDivisor=this.ViolationCacheMinBlocksDivisor,e.ViolationCacheMinBlocksCount=this.ViolationCacheMinBlocksCount,e}}class U4{constructor(e){this.Variable=e,this.OrigWeight=e.Weight,this.OrigScale=e.Scale,this.OrigDesiredPos=this.Variable.DesiredPos}}class W4{constructor(e,t){this.Value=e,this.Column=t}}class Fr{constructor(e,t){this.newMatrixRow=new Array,this.previousFunctionValue=Number.MAX_VALUE,this.solverParameters=this.solverParameters,this.matrixQ=new Array(t),this.vectorWiDi=new Array(t),this.vectorQpscVars=new Array(t),this.gradientVector=new Array(t),this.vectorQg=new Array(t),this.vectorPrevY=new Array(t),this.vectorCurY=new Array(t)}AddVariable(e){if(this.isFirstProjectCall=!0,this.vectorWiDi[e.Ordinal]=e.Weight*e.DesiredPos*2*-1,this.vectorPrevY[e.Ordinal]=e.Weight,null!=e.Neighbors)for(const t of e.Neighbors)this.vectorPrevY[e.Ordinal]=this.vectorPrevY[e.Ordinal]+t.Weight,this.vectorPrevY[t.Neighbor.Ordinal]=this.vectorPrevY[t.Neighbor.Ordinal]-t.Weight;for(let t=0;t<this.vectorPrevY.length;t++)0!=this.vectorPrevY[t]&&(this.newMatrixRow.push(new W4(2*this.vectorPrevY[t],t)),this.vectorPrevY[t]=0);this.matrixQ[e.Ordinal]=Array.from(this.newMatrixRow),this.newMatrixRow=[],this.vectorQpscVars[e.Ordinal]=new U4(e),e.Weight=1}VariablesComplete(){for(const e of this.vectorQpscVars){const t=e.Variable;for(const n of this.matrixQ[t.Ordinal])n.Column==t.Ordinal&&(this.solverParameters.Advanced.ScaleInQpsc&&(t.Scale=1/Math.sqrt(Math.abs(n.Value)),Number.isFinite(t.Scale)||(t.Scale=1),this.vectorWiDi[t.Ordinal]=this.vectorWiDi[t.Ordinal]*t.Scale),this.vectorCurY[t.Ordinal]=t.ActualPos,t.DesiredPos=t.ActualPos)}if(this.solverParameters.Advanced.ScaleInQpsc)for(let e=0;e<this.matrixQ.length;e++){const t=this.matrixQ[e];for(let n=0;n<t.length;n++)t[n].Value=t[n].Column==e?1:t[n].Value*(this.vectorQpscVars[e].Variable.Scale*this.vectorQpscVars[t[n].Column].Variable.Scale)}}PreProject(){if(this.isFirstProjectCall)for(const i of this.vectorQpscVars)this.vectorCurY[i.Variable.Ordinal]=i.Variable.ActualPos;if(this.MatrixVectorMultiply(this.vectorCurY,this.gradientVector),this.HasConverged())return!1;Fr.VectorVectorAdd(this.gradientVector,this.vectorWiDi,this.gradientVector);const e=Fr.VectorVectorMultiply(this.gradientVector,this.gradientVector);let t=0;if(0!=e&&(this.MatrixVectorMultiply(this.gradientVector,this.vectorQg),t=Fr.VectorVectorMultiply(this.vectorQg,this.gradientVector)),0==t)return!1;const n=e/t;Fr.VectorCopy(this.vectorPrevY,this.vectorCurY),Fr.VectorScaledVectorSubtract(this.vectorPrevY,n,this.gradientVector,this.vectorCurY);for(let i=0;i<this.vectorCurY.length;i++)this.vectorQpscVars[i].Variable.DesiredPos=this.vectorCurY[i];return!0}PostProject(){for(const n of this.vectorQpscVars)this.vectorCurY[n.Variable.Ordinal]=n.Variable.ActualPos;Fr.VectorVectorSubtract(this.vectorPrevY,this.vectorCurY,this.vectorCurY);const e=Fr.VectorVectorMultiply(this.gradientVector,this.vectorCurY);let t=0;if(0!=e){this.MatrixVectorMultiply(this.vectorCurY,this.vectorQg);const n=Fr.VectorVectorMultiply(this.vectorQg,this.vectorCurY);t=0==n?1:e/n,t>1?t=1:t<0&&(t=0)}return Fr.VectorScaledVectorSubtract(this.vectorPrevY,t,this.vectorCurY,this.vectorCurY),this.isFirstProjectCall=!1,t>0}QpscComplete(){for(const e of this.vectorQpscVars)e.Variable.Weight=e.OrigWeight,e.Variable.DesiredPos=e.OrigDesiredPos,this.solverParameters.Advanced.ScaleInQpsc&&(e.Variable.ActualPos=e.Variable.ActualPos*e.Variable.Scale,e.Variable.Scale=e.OrigScale);return this.previousFunctionValue}HasConverged(){const e=this.GetFunctionValue(this.vectorCurY);let t=!1;if(!this.isFirstProjectCall){const n=this.previousFunctionValue-e;let i=0;0!=n&&(i=Math.abs(n/(0!=this.previousFunctionValue?this.previousFunctionValue:e))),(Math.abs(n)<this.solverParameters.QpscConvergenceEpsilon||Math.abs(i)<this.solverParameters.QpscConvergenceQuotient)&&(t=!0)}return this.previousFunctionValue=e,t}GetFunctionValue(e){return Fr.VectorVectorMultiply(this.gradientVector,e)/2+Fr.VectorVectorMultiply(this.vectorWiDi,e)}static VectorVectorMultiply(e,t){let n=0;for(let i=0;i<e.length;i++)n+=e[i]*t[i];return n}MatrixVectorMultiply(e,t){let n=0;for(const i of this.matrixQ){let s=0;for(const o of i)s+=o.Value*e[o.Column];t[n++]=s}}static VectorVectorAdd(e,t,n){for(let i=0;i<e.length;i++)n[i]=e[i]+t[i]}static VectorVectorSubtract(e,t,n){for(let i=0;i<e.length;i++)n[i]=e[i]-t[i]}static VectorScaledVectorSubtract(e,t,n,i){for(let s=0;s<e.length;s++)i[s]=e[s]-t*n[s]}static VectorCopy(e,t){for(let n=0;n<t.length;n++)e[n]=t[n]}}class Qd{get ExecutionLimitExceeded(){return this.TimeLimitExceeded||this.OuterProjectIterationsLimitExceeded||this.InnerProjectIterationsLimitExceeded}Clone(){const e=new Qd;return e.GoalFunctionValue=this.GoalFunctionValue,e.InnerProjectIterationsLimitExceeded=this.InnerProjectIterationsLimitExceeded,e.InnerProjectIterationsTotal=this.InnerProjectIterationsTotal,e.MaxConstraintTreeDepth=this.MaxConstraintTreeDepth,e.OuterProjectIterations=this.OuterProjectIterations,e.OuterProjectIterationsLimitExceeded=this.OuterProjectIterationsLimitExceeded,e.AlgorithmUsed=this.AlgorithmUsed,e.NumberOfUnsatisfiableConstraints=this.NumberOfUnsatisfiableConstraints,e.MaxInnerProjectIterations=this.MaxInnerProjectIterations,e}}var mu=(()=>{return(r=mu||(mu={}))[r.ProjectOnly=0]="ProjectOnly",r[r.QpscWithScaling=1]="QpscWithScaling",r[r.QpscWithoutScaling=2]="QpscWithoutScaling",mu;var r})();class j4{constructor(e,t){this.Neighbor=e,this.Weight=t}}class z4{constructor(e,t,n,i,s){if(this.ActiveConstraintCount=0,i<=0)throw new Error("weight");if(s<=0)throw new Error("scale");let o=n*i;if(!Number.isFinite(o)||Number.isNaN(o))throw new Error("desiredPos");if(o=n*s,!Number.isFinite(o)||Number.isNaN(o))throw new Error("desiredPos");this.Ordinal=e,this.UserData=t,this.DesiredPos=n,this.Weight=i,this.Scale=s,this.OffsetInBlock=0,this.ActualPos=this.DesiredPos}get DfDv(){return this.Weight*(this.ActualPos-this.DesiredPos)*2/this.Scale}Reinitialize(){this.ActiveConstraintCount=0,this.OffsetInBlock=0,this.ActualPos=this.DesiredPos}AddNeighbor(e,t){null==this.Neighbors&&(this.Neighbors=new Array),this.Neighbors.push(new j4(e,t))}toString(){return In.String.Format("{0} {1:F5} ({2:F5}) {3:F5} {4:F5}",this.Name,this.ActualPos,this.DesiredPos,this.Weight,this.Scale)}get Name(){return null==this.UserData?"-0-":this.UserData.toString()}SetConstraints(e,t){this.LeftConstraints=e,this.RightConstraints=t}CompareTo(e){return Tt(this.Ordinal,e.Ordinal)}}let K4=(()=>{class r{get IsFull(){return this.numConstraints==r.MaxConstraints}Clear(){this.LowViolation=0,this.numConstraints=0,this.constraints||(this.constraints=new Array(r.MaxConstraints))}FilterBlock(t){this.LowViolation=Number.MAX_VALUE;const n=this.numConstraints>0;for(let i=this.numConstraints-1;i>=0;i--){const s=this.constraints[i];if(s.Left.Block==t||s.Right.Block==t||s.IsActive||s.IsUnsatisfiable)i<this.numConstraints-1&&(this.constraints[i]=this.constraints[this.numConstraints-1]),this.numConstraints--;else{const o=s.Left.ActualPos*s.Left.Scale+(s.Gap-s.Right.ActualPos*s.Right.Scale);o<this.LowViolation&&(this.LowViolation=o)}}return 0==this.numConstraints&&(this.LowViolation=0),n}FindIfGreater(t){let n=null;for(let i=0;i<this.numConstraints;i++){const s=this.constraints[i],o=s.Left.ActualPos*s.Left.Scale+(s.Gap-s.Right.ActualPos*s.Right.Scale);o>t&&(t=o,n=s)}return n}Insert(t,n){let i=0,s=n,o=n;for(let a=0;a<this.numConstraints;a++){const l=this.constraints[a],c=l.Left.ActualPos*l.Left.Scale+(l.Gap-l.Right.ActualPos*l.Right.Scale);c<s?(o=s,i=a,s=c):c<o&&(o=c)}this.IsFull?(this.constraints[i]=t,this.LowViolation=o):(this.constraints[this.numConstraints++]=t,this.IsFull&&(this.LowViolation=s))}}return r.MaxConstraints=20,r})();class VT{constructor(e,t){this.NumberOfLeftConstraints=0,this.Constraints=e,this.NumberOfLeftConstraints=t}}class J4{constructor(){this.allBlocks=new H4,this.allConstraints=new Y4,this.numberOfConstraints=0,this.numberOfVariables=0,this.equalityConstraints=new Array,this.loadedVariablesAndConstraintLists=new Map,this.emptyConstraintList=new Array(0),this.updatedConstraints=new Array,this.violationCache=new K4,this.violationCacheMinBlockCutoff=0,this.nextVariableOrdinal=0,this.solverParams=new sy,this.solverSolution=new Qd}get IsQpsc(){return this.hasNeighbourPairs||this.solverParams.Advanced.ForceQpsc}AddVariableAN(e,t){return this.AddVariableANNN(e,t,1,1)}AddVariableANN(e,t,n){return this.AddVariableANNN(e,t,n,1)}AddVariableANNN(e,t,n,i){if(!this.allConstraints.IsEmpty)throw new Error("Cannot add Variables or Constraints once Solve() has been called");const s=new z4(this.nextVariableOrdinal++,e,t,n,i),o=new qd(s,this.allConstraints);return s.Block=o,this.allBlocks.Add(o),this.numberOfVariables++,this.loadedVariablesAndConstraintLists.set(s,new VT(new Array,0)),s}UpdateVariables(){for(const e of this.allBlocks.Vector)e.UpdateReferencePos()}get Variables(){return lu(this.allBlocks.Vector,e=>e.Variables)}get VariableCount(){return this.numberOfVariables}*Constraints(){if(this.allConstraints.IsEmpty)for(const e of this.loadedVariablesAndConstraintLists.keys()){const t=this.loadedVariablesAndConstraintLists.get(e);if(null!=t.Constraints){const n=t.Constraints.length;for(let i=0;i<n;i++){const s=t.Constraints[i];if(e==s.Left)return yield,s}}}else for(const e of this.allConstraints.Vector)yield e}get ConstraintCount(){return this.numberOfConstraints}AddEqualityConstraint(e,t,n){return this.AddConstraintVVNB(e,t,n,!0)}AddConstraintVVNB(e,t,n,i){if(!this.allConstraints.IsEmpty)throw new Error("Cannot add Variables or Constraints once Solve() has been called");if(e==t)throw new Error("Cannot add a constraint between a variable and itself");const s=this.loadedVariablesAndConstraintLists.get(e),o=this.loadedVariablesAndConstraintLists.get(t),a=gu.constructorVVNB(e,t,n,i);return this.loadedVariablesAndConstraintLists.set(e,new VT(s.Constraints,s.NumberOfLeftConstraints+1)),s.Constraints.push(a),o.Constraints.push(a),this.numberOfConstraints++,i&&this.equalityConstraints.push(a),a}AddConstraint(e,t,n){return this.AddConstraintVVNB(e,t,n,!1)}SetConstraintUpdate(e,t){t!=e.Gap&&this.updatedConstraints.push([e,t])}AddNeighborPair(e,t,n){if(n<=0||Number.isNaN(n)||!Number.isFinite(n))throw new Error("relationshipWeight");if(e==t)throw new Error;e.AddNeighbor(t,n),t.AddNeighbor(e,n),this.hasNeighbourPairs=!0}Solve(){return this.SolvePar(null)}SolvePar(e){e&&(this.solverParams=e.Clone()),this.solverParams.OuterProjectIterationsLimit<0&&(this.solverParams.OuterProjectIterationsLimit=100*(Math.log2(this.numberOfVariables)+1)),this.solverParams.InnerProjectIterationsLimit<0&&(this.solverParams.InnerProjectIterationsLimit=2*this.numberOfConstraints+100*(Math.log2(this.numberOfConstraints)+1));const t=!this.allConstraints.IsEmpty;if(this.CheckForUpdatedConstraints(),this.solverSolution=new Qd,this.solverSolution.MinInnerProjectIterations=Number.MAX_VALUE,this.allConstraints.MaxConstraintTreeDepth=0,this.allConstraints.SolverParameters=this.solverParams,0==this.numberOfConstraints){if(!this.IsQpsc)return this.solverSolution.Clone()}else t||this.SetupConstraints();return this.allConstraints.NumberOfUnsatisfiableConstraints=0,this.MergeEqualityConstraints(),this.IsQpsc?this.SolveQpsc():(this.SolveByStandaloneProject(),this.CalculateStandaloneProjectGoalFunctionValue()),this.solverSolution.MinInnerProjectIterations>this.solverSolution.MaxInnerProjectIterations&&(this.solverSolution.MinInnerProjectIterations=this.solverSolution.MaxInnerProjectIterations),this.solverSolution.NumberOfUnsatisfiableConstraints=this.allConstraints.NumberOfUnsatisfiableConstraints,this.solverSolution.MaxConstraintTreeDepth=this.allConstraints.MaxConstraintTreeDepth,this.solverSolution.Clone()}CheckForUpdatedConstraints(){if(0==this.updatedConstraints.length)return;let e=this.IsQpsc;for(const[t,n]of this.updatedConstraints){const i=t;i.UpdateGap(n),e||i.IsEquality?e=!0:this.SplitOnConstraintIfActive(i)}this.updatedConstraints=[],e&&this.ReinitializeBlocks()}SplitOnConstraintIfActive(e){if(e.IsActive){const t=e.Left.Block.SplitOnConstraint(e);null!=t&&this.allBlocks.Add(t)}}SetupConstraints(){this.allConstraints.Create(this.numberOfConstraints);for(const e of this.loadedVariablesAndConstraintLists.keys()){const t=this.loadedVariablesAndConstraintLists.get(e),n=t.Constraints;let i=0,s=0,o=0;null!=n&&(i=n.length,s=t.NumberOfLeftConstraints,o=i-s);let a=this.emptyConstraintList;0!=s&&(a=new Array(s));let l=this.emptyConstraintList;0!=o&&(l=new Array(o)),e.SetConstraints(a,l);let c=0,u=0;for(let S=0;S<i;S++){const b=n[S];e==b.Left?a[c++]=b:l[u++]=b}for(const S of e.LeftConstraints)this.allConstraints.Add(S)}this.loadedVariablesAndConstraintLists.clear(),this.violationCacheMinBlockCutoff=Number.MAX_VALUE,this.solverParams.Advanced.UseViolationCache&&this.solverParams.Advanced.ViolationCacheMinBlocksDivisor>0&&(this.violationCacheMinBlockCutoff=Math.min(this.allBlocks.Count/this.solverParams.Advanced.ViolationCacheMinBlocksDivisor,this.solverParams.Advanced.ViolationCacheMinBlocksCount))}SolveByStandaloneProject(){for(;;){let e;if(!this.RunProject(e))return;if(!this.SplitBlocks())break}}RunProject(e){return this.solverSolution.OuterProjectIterations++,this.Project(),!this.CheckForLimitsExceeded()}CheckForLimitsExceeded(){return this.solverParams.OuterProjectIterationsLimit>0&&this.solverSolution.OuterProjectIterations>=this.solverParams.OuterProjectIterationsLimit?(this.solverSolution.OuterProjectIterationsLimitExceeded=!0,!0):!!this.solverSolution.InnerProjectIterationsLimitExceeded}CalculateStandaloneProjectGoalFunctionValue(){this.solverSolution.GoalFunctionValue=0;const e=this.allBlocks.Count;for(let t=0;t<e;t++){const n=this.allBlocks.item(t),i=n.Variables.length;for(let s=0;s<i;s++){const o=n.Variables[s];this.solverSolution.GoalFunctionValue=this.solverSolution.GoalFunctionValue+o.Weight*(o.ActualPos*o.ActualPos),this.solverSolution.GoalFunctionValue=this.solverSolution.GoalFunctionValue-o.Weight*(o.DesiredPos*o.ActualPos)*2}}}SolveQpsc(){if(this.solverSolution.AlgorithmUsed=this.solverParams.Advanced.ScaleInQpsc?mu.QpscWithScaling:mu.QpscWithoutScaling,!this.QpscMakeFeasible())return;const e=new Fr(this.solverParams,this.numberOfVariables);for(const i of this.allBlocks.Vector)for(const s of i.Variables)e.AddVariable(s);e.VariablesComplete(),this.ReinitializeBlocks(),this.MergeEqualityConstraints();let t=!1;for(;(e.PreProject()||t)&&(t=this.SplitBlocks(),this.RunProject(false))&&(e.PostProject()||t););this.solverSolution.GoalFunctionValue=e.QpscComplete()}QpscMakeFeasible(){return this.RunProject(void 0)}ReinitializeBlocks(){const e=Array.from(this.allBlocks.Vector);this.allBlocks.Vector=[];for(const t of e)for(const n of t.Variables){n.Reinitialize();const i=new qd(n,this.allConstraints);this.allBlocks.Add(i)}this.allConstraints.Reinitialize(),this.violationCache.Clear()}MergeEqualityConstraints(){for(const e of this.equalityConstraints)e.Left.Block!=e.Right.Block?this.MergeBlocks(e):Math.abs(e.Violation)>this.solverParams.GapTolerance&&(e.IsUnsatisfiable=!0,this.allConstraints.NumberOfUnsatisfiableConstraints++)}Project(){if(0==this.numberOfConstraints)return!1;this.violationCache.Clear(),this.lastModifiedBlock=null;let e=this.allBlocks.Count>this.violationCacheMinBlockCutoff,t=1,i=this.GetMaxViolatedConstraint({maxViolation:0},e);if(!i)return!1;for(;i;){if(i.Left.Block==i.Right.Block?(i.Left.Block.Expand(i),i.IsUnsatisfiable&&this.violationCache.Clear(),this.lastModifiedBlock=i.Left.Block):this.lastModifiedBlock=this.MergeBlocks(i),this.solverParams.InnerProjectIterationsLimit>0&&t>=this.solverParams.InnerProjectIterationsLimit){this.solverSolution.InnerProjectIterationsLimitExceeded=!0;break}e=this.allBlocks.Count>this.violationCacheMinBlockCutoff,e||this.violationCache.Clear(),t++,i=this.GetMaxViolatedConstraint({maxViolation:0},e)}return this.solverSolution.InnerProjectIterationsTotal=this.solverSolution.InnerProjectIterationsTotal+t,this.solverSolution.MaxInnerProjectIterations<t&&(this.solverSolution.MaxInnerProjectIterations=t),this.solverSolution.MinInnerProjectIterations>t&&(this.solverSolution.MinInnerProjectIterations=t),!0}MergeBlocks(e){let t=e.Left.Block,n=e.Right.Block,i=e.Left.OffsetInBlock+(e.Gap-e.Right.OffsetInBlock);n.Variables.length>t.Variables.length&&(t=e.Right.Block,n=e.Left.Block,i*=-1);const s=n.Variables.length;for(let o=0;o<s;o++){const a=n.Variables[o];a.OffsetInBlock=a.OffsetInBlock+i,t.AddVariable(a)}return t.UpdateReferencePosFromSums(),this.allConstraints.ActivateConstraint(e),this.allBlocks.Remove(n),t}SplitBlocks(){const e=new Array,t=this.allBlocks.Count;for(let i=0;i<t;i++){const o=this.allBlocks.item(i).Split(this.IsQpsc);null!=o&&e.push(o)}const n=e.length;for(let i=0;i<n;i++)this.allBlocks.Add(e[i]);return 0!=e.length}GetMaxViolatedConstraint(e,t){e.maxViolation=this.solverParams.GapTolerance;const n=this.SearchViolationCache(e.maxViolation);return null!=n?n:this.SearchAllConstraints(e.maxViolation,t)}SearchViolationCache(e){let t=null;if(null==this.lastModifiedBlock)return;this.lastModifiedBlock.Variables.length<this.numberOfVariables+1&&this.violationCache.FilterBlock(this.lastModifiedBlock);const n=this.lastModifiedBlock.Variables.length;for(let s=0;s<n;s++){const o=this.lastModifiedBlock.Variables[s];for(const a of o.LeftConstraints)a.IsActive||a.IsUnsatisfiable||xE(a.Left.ActualPos*a.Left.Scale+(a.Gap-a.Right.ActualPos*a.Right.Scale),e)&&(null!=t&&e>this.violationCache.LowViolation&&this.violationCache.Insert(t,e),e=a.Violation,t=a);for(const a of o.RightConstraints)if(!a.IsActive&&!a.IsUnsatisfiable&&a.Left.Block!=this.lastModifiedBlock){const l=a.Left.ActualPos*a.Left.Scale+(a.Gap-a.Right.ActualPos*a.Right.Scale);xE(l,e)&&(null!=t&&e>this.violationCache.LowViolation&&this.violationCache.Insert(t,e),e=l,t=a)}}const i=this.violationCache.FindIfGreater(e);return null!=i&&(null!=t&&e>this.violationCache.LowViolation&&this.violationCache.Insert(t,e),t=i),t}SearchAllConstraints(e,t){let n=null;this.violationCache.Clear();for(const i of this.allConstraints.Vector){if(i.IsActive)break;if(i.IsUnsatisfiable)continue;const s=i.Left.ActualPos*i.Left.Scale+(i.Gap-i.Right.ActualPos*i.Right.Scale);let o=null,a=0;xE(s,e)&&(e>this.violationCache.LowViolation&&(o=n,a=e),e=s,n=i),t&&(null==o&&i!=n&&(!this.violationCache.IsFull||s>this.violationCache.LowViolation)&&(o=i,a=s),null!=o&&a>this.violationCache.LowViolation&&this.violationCache.Insert(o,a))}return n}}let $4=(()=>{class r{constructor(){this.variables=new Map,this.fixedVars=new Map,this.FailToAdjustEpsilon=.001,this.InitSolver()}AddVariableWithIdealPositionNNN(t,n,i){this.variables.set(t,this.solver.AddVariableANN(t,n,i))}AddVariableWithIdealPositionNN(t,n){this.AddVariableWithIdealPositionNNN(t,n,1)}AddLeftRightSeparationConstraintNNNB(t,n,i,s){const o=this.GetVariable(t);if(null==o)return;const a=this.GetVariable(n);null!=a&&this.solver.AddConstraintVVNB(o,a,i,s)}AddLeftRightSeparationConstraintNNN(t,n,i){this.AddLeftRightSeparationConstraintNNNB(t,n,i,!1)}AddGoalTwoVariablesAreCloseNNN(t,n,i){const s=this.GetVariable(t);if(null==s)return;const o=this.GetVariable(n);null!=o&&this.solver.AddNeighborPair(s,o,i)}AddGoalTwoVariablesAreClose(t,n){this.AddGoalTwoVariablesAreCloseNNN(t,n,1)}GetVariable(t){return this.variables.get(t)}Solve(){this.SolveP(null)}SolveP(t){this.SolvePNS(t,{executionLimitExceeded:!1})}SolvePNS(t,n){let i;do{this.solution=null;let s=null;if(null!=t&&(s=t,null==s))throw new Error("parameters");this.solution=this.solver.SolvePar(s),n.executionLimitExceeded=this.solution.ExecutionLimitExceeded,i=this.AdjustConstraintsForMovedFixedVars()}while(i&&0==this.solution.ExecutionLimitExceeded);return 0==this.solution.ExecutionLimitExceeded}AdjustConstraintsForMovedFixedVars(){const t=new Set;for(const[n,i]of this.fixedVars.entries())r.Close(i,this.GetVariableResolvedPosition(n))||t.add(n);return 0!=t.size&&this.AdjustConstraintsForMovedFixedVarSet(t)}static Close(t,n){return Math.abs(t-n)<5e-4}AdjustConstraintsForMovedFixedVarSet(t){for(;t.size>0;){let n;for(const i of t){n=i;break}if(!this.AdjustSubtreeOfFixedVar(n,t))return!1}return!0}AdjustSubtreeOfFixedVar(t,n){const i={successInAdjusting:!1},s=this.AdjustConstraintsOfNeighborsOfFixedVariable(t,i);if(!i.successInAdjusting||0==s.length)return!1;for(const o of s)n.delete(o);return!0}AdjustConstraintsOfNeighborsOfFixedVariable(t,n){const i=this.variables.get(t).Block.Variables,s=new Xr,o=new Xr;let a=1;for(const l of i)!this.fixedVars.has(l.UserData)||(s.AddValue(l.ActualPos),o.AddValue(l.DesiredPos),o.length>0&&(a=Math.max(a,s.length/o.length)));return 1==a&&(a=2),n.successInAdjusting=this.FixActiveConstraints(i,a),i.map(l=>l.UserData)}FixActiveConstraints(t,n){let i=!1;for(const s of t)for(const o of s.LeftConstraints)o.IsActive&&(o.Gap>this.FailToAdjustEpsilon&&(i=!0),this.solver.SetConstraintUpdate(o,o.Gap/n));return i}GetVariableResolvedPosition(t){const n=this.GetVariable(t);return null==n?0:n.ActualPos}InitSolver(){this.solver=new J4,this.variables.clear()}AddFixedVariable(t,n){this.AddVariableWithIdealPositionNNN(t,n,r.FixedVarWeight),this.fixedVars.set(t,n)}ContainsVariable(t){return this.variables.has(t)}GetVariableIdealPosition(t){return this.variables.get(t).DesiredPos}get Solution(){return this.solution}}return r.FixedVarWeight=1e9,r})();class q4{constructor(){this.lowBound=Number.NEGATIVE_INFINITY,this.upperBound=Number.POSITIVE_INFINITY}get Position(){return this.position}set Position(e){this.position=e<this.lowBound?this.lowBound:e>this.upperBound?this.upperBound:e}get LowBound(){return this.lowBound}set LowBound(e){this.lowBound=e}get UpperBound(){return this.upperBound}set UpperBound(e){this.upperBound=e}toString(){return this.lowBound+" "+this.Position+" "+this.upperBound}}class Q4{constructor(e){this.idealPositions=new Map,this.varList=new Array,this.constraints=new Set,this.solverShell=new $4,this.boundsToInt=new Map,this.varSepartion=e}SetLowBound(e,t){const n=this.Var(t);n.LowBound=Math.max(e,n.LowBound)}Var(e){return this.varList[e]}SetUpperBound(e,t){const n=this.Var(e);n.UpperBound=Math.min(t,n.UpperBound)}Solve(){this.SolveByRegularSolver()}SolveByRegularSolver(){this.CreateVariablesForBounds();for(let e=0;e<this.varList.length;e++){const t=this.varList[e];t.IsFixed?this.solverShell.AddFixedVariable(e,t.Position):(this.solverShell.AddVariableWithIdealPositionNN(e,this.idealPositions.get(e)),t.LowBound!=Number.NEGATIVE_INFINITY&&this.constraints.add(new ot(this.GetBoundId(t.LowBound),e)),t.UpperBound!=Number.POSITIVE_INFINITY&&this.constraints.add(new ot(e,this.GetBoundId(t.UpperBound))))}this.CreateGraphAndRemoveCycles();for(const e of this.graph.edges){let t=0;e.x<this.varList.length&&(t+=this.varList[e.x].Width),e.y<this.varList.length&&(t+=this.varList[e.y].Width),t/=2,this.solverShell.AddLeftRightSeparationConstraintNNN(e.x,e.y,this.varSepartion+t)}this.solverShell.Solve();for(let e=0;e<this.varList.length;e++)this.varList[e].Position=this.solverShell.GetVariableResolvedPosition(e)}GetBoundId(e){return this.boundsToInt.get(e)}CreateVariablesForBounds(){for(const e of this.varList)e.IsFixed||(e.LowBound!=Number.NEGATIVE_INFINITY&&this.RegisterBoundVar(e.LowBound),e.UpperBound!=Number.POSITIVE_INFINITY&&this.RegisterBoundVar(e.UpperBound))}RegisterBoundVar(e){if(!this.boundsToInt.has(e)){const t=this.varList.length+this.boundsToInt.size;this.boundsToInt.set(e,t),this.solverShell.AddFixedVariable(t,e)}}CreateGraphAndRemoveCycles(){this.graph=bs(Array.from(this.constraints),this.varList.length+this.boundsToInt.size);const e=so.getFeedbackSet(this.graph);if(null!=e)for(const t of e)this.graph.removeEdge(t)}GetVariablePosition(e){return this.varList[e].Position}AddConstraint(e,t){this.constraints.add(new ot(e,t))}AddVariableNNNN(e,t,n,i){this.idealPositions.set(e,n),this.AddVariableNNBN(e,t,!1,i)}AddFixedVariable(e,t){this.AddVariableNNBN(e,t,!0,0)}AddVariableNNBN(e,t,n,i){const s=new q4;s.Position=t,s.IsFixed=n,s.Width=i,this.varList.push(s)}}class X4 extends Hn{constructor(e,t){super(e,t),this.RightNeighbors=new Set,this.setOfLongestSegs=new Set,this.RightBound=Number.POSITIVE_INFINITY,this.LeftBound=Number.NEGATIVE_INFINITY,this.Direction=Ae.DirectionFromPointToPoint(e.point,t.point)}AddRightNeighbor(e){this.RightNeighbors.add(e)}get LongestNudgedSegments(){return this.setOfLongestSegs}AddLongestNudgedSegment(e){this.setOfLongestSegs.add(e)}BoundFromRight(e){e=Math.max(e,this.LeftBound),this.RightBound=Math.min(e,this.RightBound)}BoundFromLeft(e){e=Math.min(e,this.RightBound),this.LeftBound=Math.max(e,this.LeftBound)}}class Ls{constructor(e){this.Point=e}*GetEnumerator(){let e;for(e=this;null!=e;e=e.Next)yield e.Point}get X(){return this.Point.x}get Y(){return this.Point.y}InsertVerts(e,t,n){for(t--;e<t;t--)this.SetNewNext(n[t])}InsertVertsInReverse(e,t,n){for(e++;e<t;e++)this.SetNewNext(n[e])}SetNewNext(e){const t=new Ls(e),n=this.Next;this.Next=t,t.Next=n}}class Xd{constructor(e,t){this.IsFixed=!1,this.Reversed=!1,this.index=-1,this.AxisEdge=e,this.Width=t}toString(){return this.Source+" "+this.Target}get LongestNudgedSegment(){return this.longestNudgedSegment}set LongestNudgedSegment(e){this.longestNudgedSegment=e,null!=this.longestNudgedSegment&&(this.longestNudgedSegment.AddEdge(this),this.AxisEdge.AddLongestNudgedSegment(this.longestNudgedSegment))}get Source(){return this.Reversed?this.AxisEdge.TargetPoint:this.AxisEdge.SourcePoint}get Target(){return this.Reversed?this.AxisEdge.SourcePoint:this.AxisEdge.TargetPoint}static VectorsAreParallel(e,t){return nt(e.x*t.y-e.y*t.x,0)}static EdgesAreParallel(e,t){return Xd.VectorsAreParallel(e.AxisEdge.TargetPoint.sub(e.AxisEdge.SourcePoint),t.AxisEdge.TargetPoint.sub(t.AxisEdge.SourcePoint))}get Direction(){return this.Reversed?Ae.OppositeDir(this.AxisEdge.Direction):this.AxisEdge.Direction}get Index(){return this.index}set Index(e){this.index=e}}class Ln{constructor(e){this.pathVisibilityGraph=new tn,this.axisEdgesToPathOrders=new Map,this.OriginalPaths=e}get PathVisibilityGraph(){return this.pathVisibilityGraph}GetOrder(){return this.FillTheVisibilityGraphByWalkingThePaths(),this.InitPathOrder(),this.OrderPaths(),this.axisEdgesToPathOrders}FillTheVisibilityGraphByWalkingThePaths(){for(const e of this.OriginalPaths)this.FillTheVisibilityGraphByWalkingPath(e)}FillTheVisibilityGraphByWalkingPath(e){const t=this.CreatePathEdgesFromPoints(function*i(){if(e.PathPoints instanceof Ls)for(let s=e.PathPoints;null!=s;s=s.Next)yield s.Point;else for(const s of e.PathPoints)yield s}(),e.Width);let n=t.next();for(n.done||e.SetFirstEdge(n.value);0==(n=t.next()).done;)e.AddEdge(n.value)}*CreatePathEdgesFromPoints(e,t){let n=e.next(),i=n.value;for(;!(n=e.next()).done;)yield this.CreatePathEdge(i,n.value,t),i=n.value}CreatePathEdge(e,t,n){switch(Ae.DirectionFromPointToPoint(e,t)){case oe.East:case oe.North:return new Xd(this.GetAxisEdge(e,t),n);case oe.South:case oe.West:{const s=new Xd(this.GetAxisEdge(t,e),n);return s.Reversed=!0,s}default:throw new Error("Not a rectilinear path")}}GetAxisEdge(e,t){return this.PathVisibilityGraph.AddEdgeF(e,t,(n,i)=>new X4(n,i))}InitPathOrder(){for(const e of this.PathVisibilityGraph.Edges)this.axisEdgesToPathOrders.set(e,new Array);for(const e of this.OriginalPaths)for(const t of e.PathEdges())this.axisEdgesToPathOrders.get(t.AxisEdge).push(t)}OrderPaths(){for(const e of Ln.WalkGraphEdgesInTopologicalOrderIfPossible(this.PathVisibilityGraph))this.OrderPathEdgesSharingEdge(e)}OrderPathEdgesSharingEdge(e){const t=this.PathOrderOfVisEdge(e);t.sort(Ln.CompareTwoPathEdges);let n=0;for(const i of t)i.Index=n++}static CompareTwoPathEdges(e,t){if(e==t)return 0;const n=Ln.CompareInDirectionStartingFromAxisEdge(e,t,e.AxisEdge,e.AxisEdge.Direction);return 0!=n?n:-Ln.CompareInDirectionStartingFromAxisEdge(e,t,e.AxisEdge,Ae.OppositeDir(e.AxisEdge.Direction))}static CompareInDirectionStartingFromAxisEdge(e,t,n,i){for(;;){if(null==(e=Ln.GetNextPathEdgeInDirection(e,n,i))||null==(t=Ln.GetNextPathEdgeInDirection(t,n,i)))return 0;if(e.AxisEdge==t.AxisEdge){i=Ln.FindContinuedDirection(n,i,e.AxisEdge),n=e.AxisEdge;const c=Ln.GetExistingOrder(e,t);if(c==Ln.NotOrdered)continue;return i==n.Direction?c:-c}const s=i==n.Direction?n.Target:n.Source,o=Ln.OtherVertex(e.AxisEdge,s),a=Ln.OtherVertex(t.AxisEdge,s),l=Ln.ProjectionForCompare(n,i!=n.Direction);return Tt(l(o.point),l(a.point))}}static FindContinuedDirection(e,t,n){return e.Direction==t?n.Source==e.Target?n.Direction:Ae.OppositeDir(n.Direction):n.Source==e.Source?n.Direction:Ae.OppositeDir(n.Direction)}static OtherVertex(e,t){return e.Source==t?e.Target:e.Source}static ProjectionForCompare(e,t){return e.Direction==oe.North?t?n=>-n.x:n=>n.x:t?n=>n.y:n=>-n.y}static GetNextPathEdgeInDirection(e,t,n){return t.Direction==n?e.Reversed?e.Prev:e.Next:e.Reversed?e.Next:e.Prev}static GetExistingOrder(e,t){const n=e.Index;return-1==n?Ln.NotOrdered:Tt(n,t.Index)}PathOrderOfVisEdge(e){return this.axisEdgesToPathOrders.get(e)}static InitQueueOfSources(e,t,n){for(const i of n.Vertices()){const s=i.InEdgesLength();t.set(i,s),0==s&&e.enqueue(i)}}static*WalkGraphEdgesInTopologicalOrderIfPossible(e){const t=new eo.c,n=new Map;for(Ln.InitQueueOfSources(t,n,e);t.length>0;){const i=t.dequeue();for(const s of i.OutEdges){const o=n.get(s.Target);n.set(s.Target,o-1),1==o&&t.enqueue(s.Target),yield s}}}}Ln.NotOrdered=Number.MAX_VALUE;class Z4 extends Ns{constructor(e,t){super(),this.site=t,this.AxisEdge=e}get Site(){return this.site}}class HT extends Ns{constructor(e,t){super(),this.site=t,this.AxisEdge=e}get Site(){return this.site}}class e5{constructor(e){this.edges=new Set,this.Source=e}get Edges(){return this.edges}AddEdge(e){this.UpPoint=e.TargetPoint,this.edges.add(e)}RemoveAxis(e){this.edges.delete(e)}IsEmpty(){return 0==this.edges.size}}class xs extends DT{constructor(e,t,n,i,s){super(t,new Ae(e).ToPoint()),this.DirectionPerp=new Ae(e).Right.ToPoint(),this.PathOrders=i,this.xProjection=e==oe.North?o=>o.x:o=>-o.y,this.edgeContainersTree=new xr((o,a)=>this.CompareAA(o,a)),this.SweepPole=Ae.VectorDirection(this.SweepDirection),this.AxisEdges=s,this.AxisEdgesToObstaclesTheyOriginatedFrom=n}FindFreeSpace(){this.InitTheQueueOfEvents(),this.ProcessEvents()}ProcessEvents(){for(;this.EventQueue.Count>0;)this.ProcessEvent(this.EventQueue.Dequeue())}ProcessEvent(e){e instanceof wl?this.ProcessVertexEvent(e):(this.Z=this.GetZP(e.Site),e instanceof HT?this.ProcessLowEdgeEvent(e):this.ProcessHighEdgeEvent(e))}ProcessHighEdgeEvent(e){const t=e.AxisEdge;this.RemoveEdge(t),this.ConstraintEdgeWithObstaclesAtZ(t,t.Target.point)}ProcessLowEdgeEvent(e){const t=e.AxisEdge,n=this.GetOrCreateAxisEdgesContainer(t);n.item.AddEdge(t);const i=this.edgeContainersTree.previous(n);if(null!=i)for(const o of i.item.edges)for(const a of n.item.edges)this.TryToAddRightNeighbor(o,a);const s=this.edgeContainersTree.next(n);if(null!=s)for(const o of n.item.Edges)for(const a of s.item.edges)this.TryToAddRightNeighbor(o,a);this.ConstraintEdgeWithObstaclesAtZ(t,t.Source.point)}TryToAddRightNeighbor(e,t){this.ProjectionsOfEdgesOverlap(e,t)&&e.AddRightNeighbor(t)}ProjectionsOfEdgesOverlap(e,t){return this.SweepPole==oe.North?!(e.TargetPoint.y<t.SourcePoint.y-q.distanceEpsilon||t.TargetPoint.y<e.SourcePoint.y-q.distanceEpsilon):!(e.TargetPoint.x<t.SourcePoint.x-q.distanceEpsilon||t.TargetPoint.x<e.SourcePoint.x-q.distanceEpsilon)}GetObstacleBoundaries(e){return this.Obstacles.map(t=>Xe.mkDebugCurveWCI(1,e,t))}ConstraintEdgeWithObstaclesAtZ(e,t){this.ConstraintEdgeWithObstaclesAtZFromLeft(e,t),this.ConstraintEdgeWithObstaclesAtZFromRight(e,t)}ConstraintEdgeWithObstaclesAtZFromRight(e,t){const n=this.GetActiveSideFromRight(t);if(null==n||this.NotRestricting(e,n.item.Polyline))return;const i=this.ObstacleSideComparer.IntersectionOfSideAndSweepLine(n.item);e.BoundFromRight(i.dot(this.DirectionPerp))}GetActiveSideFromRight(e){return this.LeftObstacleSideTree.findFirst(t=>xs.PointToTheLeftOfLineOrOnLineLocal(e,t.Start,t.End))}ConstraintEdgeWithObstaclesAtZFromLeft(e,t){const n=this.GetActiveSideFromLeft(t);if(null==n||this.NotRestricting(e,n.item.Polyline))return;const i=this.ObstacleSideComparer.IntersectionOfSideAndSweepLine(n.item);e.BoundFromLeft(i.dot(this.DirectionPerp))}static PointToTheLeftOfLineOrOnLineLocal(e,t,n){return x.signedDoubledTriangleArea(e,t,n)>-xs.AreaComparisonEpsilon}static PointToTheRightOfLineOrOnLineLocal(e,t,n){return x.signedDoubledTriangleArea(t,n,e)<xs.AreaComparisonEpsilon}GetActiveSideFromLeft(e){return this.RightObstacleSideTree.findLast(t=>xs.PointToTheRightOfLineOrOnLineLocal(e,t.Start,t.End))}static EdgeMidPoint(e){return x.middle(e.SourcePoint,e.TargetPoint)}GetOrCreateAxisEdgesContainer(e){const t=e.Source.point,n=this.GetAxisEdgesContainerNode(t);return null!=n?n:this.edgeContainersTree.insert(new e5(t))}GetAxisEdgesContainerNode(e){const t=this.xProjection(e),n=this.edgeContainersTree.findFirst(i=>this.xProjection(i.Source)>=t-q.distanceEpsilon/2);return null!=n&&this.xProjection(n.item.Source)<=t+q.distanceEpsilon/2?n:null}ProcessVertexEvent(e){this.Z=this.GetZS(e),e instanceof Ko?this.ProcessLeftVertex(e,e.Vertex.nextOnPolyline):(e instanceof Jo||this.ProcessLeftVertex(e,e.Vertex.nextOnPolyline),this.ProcessRightVertex(e,e.Vertex.prevOnPolyline))}ProcessRightVertex(e,t){this.ProcessPrevSegmentForRightVertex(e,e.Site);const i=t.point.sub(e.Site),s=i.dot(this.DirectionPerp),o=i.dot(this.SweepDirection);o<=q.distanceEpsilon?s>0&&o>=0?this.EnqueueEvent(new Jo(t)):this.RestrictEdgeContainerToTheRightOfEvent(e.Vertex):(this.InsertRightSide(new Al(e.Vertex)),this.EnqueueEvent(new Jo(t)),this.RestrictEdgeContainerToTheRightOfEvent(e.Vertex))}RestrictEdgeContainerToTheRightOfEvent(e){const t=e.point,n=this.xProjection(t),i=this.edgeContainersTree.findFirst(s=>n<=this.xProjection(s.Source));if(null!=i)for(const s of i.item.Edges)this.NotRestricting(s,e.polyline)||s.BoundFromLeft(this.DirectionPerp.dot(t))}NotRestricting(e,t){return this.AxisEdgesToObstaclesTheyOriginatedFrom.get(e)==t}ProcessPrevSegmentForRightVertex(e,t){t.sub(e.Vertex.nextOnPolyline.point).dot(this.SweepDirection)>q.distanceEpsilon&&this.RemoveRightSide(new Al(e.Vertex.nextOnPolyline))}RemoveEdge(e){const t=this.GetAxisEdgesContainerNode(e.Source.point);t.item.RemoveAxis(e),t.item.IsEmpty()&&this.edgeContainersTree.deleteNodeInternal(t)}ProcessLeftVertex(e,t){this.ProcessPrevSegmentForLeftVertex(e,e.Site);const i=t.point.sub(e.Site),s=i.dot(this.DirectionPerp),o=i.dot(this.SweepDirection);o<=q.distanceEpsilon?s<0&&o>=0&&this.EnqueueEvent(new Ko(t)):(this.InsertLeftSide(new Sl(e.Vertex)),this.EnqueueEvent(new Ko(t))),this.RestrictEdgeFromTheLeftOfEvent(e.Vertex)}RestrictEdgeFromTheLeftOfEvent(e){const t=e.point,n=this.GetContainerNodeToTheLeftOfEvent(t);if(null!=n)for(const i of n.item.Edges)this.NotRestricting(i,e.polyline)||i.BoundFromRight(t.dot(this.DirectionPerp))}GetContainerNodeToTheLeftOfEvent(e){const t=this.xProjection(e);return this.edgeContainersTree.findLast(n=>this.xProjection(n.Source)<=t)}ProcessPrevSegmentForLeftVertex(e,t){t.sub(e.Vertex.prevOnPolyline.point).dot(this.SweepDirection)>q.distanceEpsilon&&this.RemoveLeftSide(new Sl(e.Vertex.prevOnPolyline))}InitTheQueueOfEvents(){this.InitQueueOfEvents();for(const e of this.AxisEdges)this.EnqueueEventsForEdge(e)}EnqueueEventsForEdge(e){this.EdgeIsParallelToSweepDir(e)&&(this.EnqueueEvent(xs.EdgeLowPointEvent(e,e.Source.point)),this.EnqueueEvent(xs.EdgeHighPointEvent(e,e.Target.point)))}EdgeIsParallelToSweepDir(e){return e.Direction==this.SweepPole||e.Direction==Ae.OppositeDir(this.SweepPole)}static EdgeHighPointEvent(e,t){return new Z4(e,t)}static EdgeLowPointEvent(e,t){return new HT(e,t)}CompareAA(e,t){return Tt(e.Source.dot(this.DirectionPerp),t.Source.dot(this.DirectionPerp))}}xs.AreaComparisonEpsilon=q.intersectionEpsilon;class t5 extends XE{constructor(e){super(),this.CompassDirection=oe.None,this.edges=new Array,this._isFixed=!1,this.Id=-1,this.IdealPosition=0,this.Id=e}get Start(){return this.start}get End(){return this.end}get Edges(){return this.edges}AddEdge(e){if(0==this.Edges.length){let t=Ae.VectorDirectionPP(e.Source,e.Target);switch(t){case oe.South:t=oe.North;break;case oe.West:t=oe.East}this.CompassDirection=t,this.start=e.Source,this.end=e.Source}switch(this.CompassDirection){case oe.North:this.TryPointForStartAndEndNorth(e.Source),this.TryPointForStartAndEndNorth(e.Target);break;case oe.East:this.TryPointForStartAndEndEast(e.Source),this.TryPointForStartAndEndEast(e.Target)}this.Edges.push(e)}TryPointForStartAndEndNorth(e){e.y<this.start.y?this.start=e:e.y>this.end.y&&(this.end=e)}TryPointForStartAndEndEast(e){e.x<this.start.x?this.start=e:e.x>this.end.x&&(this.end=e)}get IsFixed(){return this._isFixed}set IsFixed(e){this._isFixed=e}get Width(){let e=0;for(const t of this.edges)e=Math.max(e,t.Width);return e}GetLeftBound(){if(!this.IsFixed){let e=Number.NEGATIVE_INFINITY;for(const t of this.edges)e=Math.max(e,t.AxisEdge.LeftBound);return e}return this.CompassDirection==oe.North?this.Edges[0].Source.x:-this.Edges[0].Source.y}GetRightBound(){if(!this.IsFixed){let e=Number.POSITIVE_INFINITY;for(const t of this.edges)e=Math.min(e,t.AxisEdge.RightBound);return e}return this.Position()}Position(){return this.CompassDirection==oe.North?this.Edges[0].Source.x:-this.Edges[0].Source.y}}class ts{constructor(e,t){this.tree=new xr((n,i)=>Tt(n.Point.x,i.Point.x)),this.VerticalPoints=t,this.HorizontalPoints=e}SplitPoints(){0==this.VerticalPoints.length||0==this.HorizontalPoints.length||(this.InitEventQueue(),this.ProcessEvents())}ProcessEvents(){for(;!this.Queue.IsEmpty();){const e={priority:0},t=this.Queue.DequeueAndGetPriority(e);this.ProcessEvent(t,e.priority)}}ProcessEvent(e,t){nt(e.Next.Point.x,e.Point.x)?t==ts.Low(e)?this.ProcessLowLinkedPointEvent(e):this.ProcessHighLinkedPointEvent(e):this.IntersectWithTree(e)}IntersectWithTree(e){let t,n,i;const s=e.Y;if(e.Point.x<e.Next.Point.x?(n=e.Point.x,t=e.Next.Point.x,i=!0):(t=e.Point.x,n=e.Next.Point.x,i=!1),i)for(let o=this.tree.findFirst(a=>n<=a.Point.x);null!=o&&o.item.Point.x<=t;o=this.tree.next(o)){const a=new x(o.item.Point.x,s);e=ts.TrySplitHorizontalPoint(e,a,!0),ts.TrySplitVerticalPoint(o.item,a)}else for(let o=this.tree.findLast(a=>a.Point.x<=t);null!=o&&o.item.Point.x>=n;o=this.tree.previous(o)){const a=new x(o.item.Point.x,s);e=ts.TrySplitHorizontalPoint(e,a,!1),ts.TrySplitVerticalPoint(o.item,a)}}static TrySplitVerticalPoint(e,t){ts.Low(e)+q.distanceEpsilon<t.y&&t.y+q.distanceEpsilon<ts.High(e)&&e.SetNewNext(t)}static TrySplitHorizontalPoint(e,t,n){return n&&e.X+q.distanceEpsilon<t.x&&t.x+q.distanceEpsilon<e.Next.X||!n&&e.Next.X+q.distanceEpsilon<t.x&&t.x+q.distanceEpsilon<e.X?(e.SetNewNext(t),e.Next):e}ProcessHighLinkedPointEvent(e){this.tree.remove(e)}ProcessLowLinkedPointEvent(e){this.tree.insert(e)}InitEventQueue(){this.Queue=new ho(Tt);for(const e of this.VerticalPoints)this.Queue.Enqueue(e,ts.Low(e));for(const e of this.HorizontalPoints)this.Queue.Enqueue(e,e.Point.y)}static Low(e){return Math.min(e.Point.y,e.Next.Point.y)}static High(e){return Math.max(e.Point.y,e.Next.Point.y)}}class Cl{constructor(e){this.verticesToPathOffsets=new cr,this.Paths=e}MergePaths(){this.InitVerticesToPathOffsetsAndRemoveSelfCycles();for(const e of this.Paths)this.ProcessPath(e)}ProcessPath(e){const t=new Map;let n=null;for(let i=e.PathPoints;null!=i;i=i.Next){const s=this.verticesToPathOffsets.get(i.Point);if(null!=n){if(t.size>0)for(const[o,a]of s){const l=t.get(o);l&&(this.CollapseLoopingPath(o,l,a,e,i),t.delete(o))}for(const[o,a]of n)s.has(o)||t.set(o,a)}n=s}}CollapseLoopingPath(e,t,n,i,s){const o=Cl.FindLinkedPointInPath(i,t.Point),a=Array.from(Cl.GetPointsInBetween(o,s));Cl.Before(t,n)?(this.CleanDisappearedPiece(t,n,e),this.ReplacePiece(t,n,a,e)):(this.CleanDisappearedPiece(n,t,e),this.ReplacePiece(n,t,a.reverse(),e))}static*GetPointsInBetween(e,t){for(let n=e.Next;n!=t;n=n.Next)yield n.Point}ReplacePiece(e,t,n,i){let s=e;for(const o of n){const a=new Ls(o);s.Next=a,s=a,this.verticesToPathOffsets.get(o).set(i,s)}s.Next=t}CleanDisappearedPiece(e,t,n){for(const i of Cl.GetPointsInBetween(e,t))this.verticesToPathOffsets.get(i).delete(n)}static Before(e,t){for(e=e.Next;null!=e;e=e.Next)if(e==t)return!0;return!1}static FindLinkedPointInPath(e,t){for(let n=e.PathPoints;;n=n.Next)if(n.Point.equal(t))return n}InitVerticesToPathOffsetsAndRemoveSelfCycles(){for(const e of this.Paths)for(let t=e.PathPoints;null!=t;t=t.Next){let n=this.verticesToPathOffsets.get(t.Point);n||this.verticesToPathOffsets.set(t.Point,n=new Map);const i=n.get(e);i?(this.CleanDisappearedPiece(i,t,e),i.Next=t.Next):n.set(e,t)}}}class n5{constructor(e){this.projection=e}compare(e,t){return Tt(this.projection(e),this.projection(t))}}class Wn{static RefinePaths(e,t){Wn.AdjustPaths(e);const n=Wn.CreatePathsToFirstLinkedVerticesMap(e);Wn.Refine(Array.from(n.values())),Wn.CrossVerticalAndHorizontalSegs(n.values()),Wn.ReconstructPathsFromLinkedVertices(n),t&&new Cl(e).MergePaths()}static AdjustPaths(e){for(const t of e)t.PathPoints=Wn.AdjustPathPoints(t.PathPoints)}static AdjustPathPoints(e){if(!e||0==e.length)return;const t=[];let n=q.RoundPoint(e[0]);t.push(n);for(let i=1;i<e.length;i++){const s=q.RoundPoint(e[i]);n.equal(s)||(n=s,t.push(n))}return t}static CrossVerticalAndHorizontalSegs(e){const t=new Array,n=new Array;for(const i of e)for(let s=i;null!=s.Next;s=s.Next)nt(s.Point.x,s.Next.Point.x)?n.push(s):t.push(s);new ts(t,n).SplitPoints()}static ReconstructPathsFromLinkedVertices(e){for(const[t,n]of e)t.PathPoints=n}static Refine(e){Wn.RefineInDirection(oe.North,e),Wn.RefineInDirection(oe.East,e)}static*groupByProj(e,t){const n=new Map;for(const i of t){const s=e(i.Point);let o=n.get(s);o||(o=new Array,n.set(s,o)),o.push(i)}for(const i of n.values())yield i}static RefineInDirection(e,t){const n={projectionToPerp:void 0,projectionToDirection:void 0};Wn.GetProjectionsDelegates(e,n);const i=Array.from(Wn.GetAllLinkedVertsInDirection(n.projectionToPerp,t)),s=Wn.groupByProj(n.projectionToPerp,i);for(const o of s)Wn.RefineCollinearBucket(o,n.projectionToDirection)}static GetProjectionsDelegates(e,t){e==oe.East?(t.projectionToDirection=n=>n.x,t.projectionToPerp=n=>n.y):(t.projectionToPerp=n=>n.x,t.projectionToDirection=n=>n.y)}static*GetAllLinkedVertsInDirection(e,t){for(const n of t)for(let i=n;null!=i.Next;i=i.Next)nt(e(i.Point),e(i.Next.Point))&&(yield i)}static RefineCollinearBucket(e,t){const n=new UE.SortedMap(new n5(t));for(const o of e)n.has(o.Point)||n.set(o.Point,0),n.has(o.Next.Point)||n.set(o.Next.Point,0);const i=new Array(n.size);let s=0;for(const o of n.keys())i[s++]=o;for(s=0;s<i.length;s++)n.set(i[s],s);for(const o of e){s=n.get(o.Point);const a=n.get(o.Next.Point);Math.abs(a-s)>1&&Wn.InsertPoints(o,i,s,a)}}static InsertPoints(e,t,n,i){n<i?e.InsertVerts(n,i,t):e.InsertVertsInReverse(i,n,t)}static CreatePathsToFirstLinkedVerticesMap(e){const t=new Map;for(const n of e)t.set(n,Wn.CreateLinkedVertexOfEdgePath(n));return t}static CreateLinkedVertexOfEdgePath(e){const t=e.PathPoints;let n=new Ls(t[0]);const i=n;for(let s=1;s<t.length;s++)n.Next=new Ls(t[s]),n=n.Next;return i}}class $o{constructor(e,t){this.Points=e,this.I=t}static equal(e,t){return e.I==t.I&&e.Points==t.Points}get Start(){return this.Points[this.I]}get End(){return this.Points[this.I+1]}}class qo{constructor(e,t){this.segTree=new Bd(null),this.crossedOutPaths=new Set,this.HierarchyOfObstacles=new Bd(t),this.Paths=e}static RemoveStaircases(e,t){new qo(e,t).Calculate()}Calculate(){let e;this.InitHierarchies();do{e=!1;for(const t of this.Paths.filter(n=>!this.crossedOutPaths.has(n)))this.ProcessPath(t)&&(e=!0)}while(e)}ProcessPath(e){const t={pts:e.PathPoints,canHaveStaircase:!1};return this.ProcessPoints(t)?(e.PathPoints=t.pts,!0):(t.canHaveStaircase||this.crossedOutPaths.add(e),!1)}ProcessPoints(e){const t=this.FindStaircaseStart(e);return!(t<0||(e.pts=this.RemoveStaircasePN(e.pts,t),0))}FindStaircaseStart(e){if(e.canHaveStaircase=!1,e.pts.length<5)return-1;const t=[new $o(e.pts,0),new $o(e.pts,1),new $o(e.pts,2),new $o(e.pts,3)];let n=0;for(let i=0;;){const s={canHaveStaircaseAtI:!1};if(this.IsStaircase(e.pts,i,t,s))return e.canHaveStaircase=!0,i;if(e.canHaveStaircase=e.canHaveStaircase||s.canHaveStaircaseAtI,i++,e.pts.length<i+5)return-1;t[n]=new $o(e.pts,i+3),n++,n%=4}}static GetFlippedPoint(e,t){return nt(e[t].y,e[t+1].y)?new x(e[t+4].x,e[t].y):new x(e[t].x,e[t+4].y)}Crossing(e,t,n){return qo.IsCrossing(me.mkPP(e,t),this.segTree,n)}static IsCrossing(e,t,n){for(const i of t.GetAllIntersecting(e.boundingBox))if(-1==n.findIndex(s=>s==i))return!0;return!1}IntersectObstacleHierarchyPPP(e,t,n){return this.IntersectObstacleHierarchyL(me.mkPP(e,t))||this.IntersectObstacleHierarchyL(me.mkPP(t,n))}IntersectObstacleHierarchyL(e){return this.HierarchyOfObstacles.GetAllIntersecting(e.boundingBox).some(t=>null!=ee.intersectionOne(e,t,!1))}IsStaircase(e,t,n,i){const s=e[t],o=e[t+1];let a=e[t+2];const l=e[t+3],c=e[t+4];return i.canHaveStaircaseAtI=!1,Ae.DirectionFromPointToPoint(s,o)==Ae.DirectionFromPointToPoint(a,l)&&Ae.DirectionFromPointToPoint(o,a)==Ae.DirectionFromPointToPoint(l,c)&&(a=qo.GetFlippedPoint(e,t),!this.IntersectObstacleHierarchyPPP(o,a,l))&&(i.canHaveStaircaseAtI=!0,!this.Crossing(o,a,n))}RemoveStaircasePN(e,t){const s=Math.abs(e[t].y-e[t+1].y)<q.distanceEpsilon/2;return this.RemoveStaircasePNB(e,t,s)}RemoveStaircasePNB(e,t,n){this.RemoveSegs(e);const i=new Array(e.length-2);!function i5(r,e,t){let n=0;for(;t-- >0;)e[n++]=r[n++]}(e,i,t+1);const s=e[t+1],o=e[t+3];return i[t+1]=n?new x(o.x,s.y):new x(s.x,o.y),function r5(r,e,t,n,i){for(;i-- >0;)t[n++]=r[e++]}(e,t+4,i,t+2,i.length-t-2),this.InsertNewSegs(i,t),i}RemoveSegs(e){for(let t=0;t<e.length-1;t++)this.RemoveSeg(new $o(e,t))}RemoveSeg(e){this.segTree.Remove(qo.Rect(e),e)}InsertNewSegs(e,t){this.InsSeg(e,t),this.InsSeg(e,t+1)}InitHierarchies(){for(const e of this.Paths)this.InsertPathSegs(e)}InsertPathSegs(e){this.InsertSegs(e.PathPoints)}InsertSegs(e){for(let t=0;t<e.length-1;t++)this.InsSeg(e,t)}InsSeg(e,t){const n=new $o(e,t);this.segTree.Add(qo.Rect(n),n)}static Rect(e){return Ne.mkPP(e.Start,e.End)}}class Nt{constructor(e,t,n,i){this.AncestorsSets=i,this.HierarchyOfGroups=en(Array.from(i.keys()).filter(s=>s.IsGroup).map(s=>Cn(s,s.BoundingBox))),this.Obstacles=n,this.EdgeSeparation=2*t,this.Paths=e,this.HierarchyOfObstacles=en(n.map(s=>Cn(s,s.boundingBox))),this.MapPathsToTheirObstacles()}get HasGroups(){return null!=this.HierarchyOfGroups&&this.HierarchyOfGroups.Count>0}MapPathsToTheirObstacles(){this.PathToObstacles=new Map;for(const e of this.Paths)this.MapPathToItsObstacles(e)}MapPathToItsObstacles(e){if(!e.PathPoints||0==e.PathPoints.length)return;const t=e.PathPoints,n=this.HierarchyOfObstacles.FirstHitNodeWithPredicate(t[0],Nt.ObstacleTest),i=this.HierarchyOfObstacles.FirstHitNodeWithPredicate(t[t.length-1],Nt.ObstacleTest);null!=n&&null!=i&&this.PathToObstacles.set(e,[n.UserData,i.UserData])}static ObstacleTest(e,t){return ee.PointRelativeToCurveLocation(e,t)!=Fe.Outside?Pt.Stop:Pt.Continue}Calculate(e,t){this.NudgingDirection=e,Wn.RefinePaths(this.Paths,t),this.GetPathOrdersAndPathGraph(),this.MapAxisEdgesToTheirObstacles(),this.DrawPaths()}MapAxisEdgesToTheirObstacles(){this.axisEdgesToObstaclesTheyOriginatedFrom=new Map;for(const e of this.Paths)this.MapPathEndAxisEdgesToTheirObstacles(e);for(const e of this.Paths)this.UmmapPathInteriourFromStrangerObstacles(e)}UmmapPathInteriourFromStrangerObstacles(e){const t=this.FindFirstUnmappedEdge(e);if(null==t)return;const n=this.FindLastUnmappedEdge(e);for(let i=t;null!=i&&i!=n;i=i.Next)this.axisEdgesToObstaclesTheyOriginatedFrom.delete(i.AxisEdge)}FindLastUnmappedEdge(e){for(let t=e.LastEdge;null!=t;t=t.Prev)if(t.AxisEdge.Direction!=this.NudgingDirection)return t;return null}FindFirstUnmappedEdge(e){for(let t=e.FirstEdge;null!=t;t=t.Next)if(t.AxisEdge.Direction!=this.NudgingDirection)return t;return null}MapPathEndAxisEdgesToTheirObstacles(e){const t=this.PathToObstacles.get(e);t&&(this.ProcessThePathStartToMapAxisEdgesToTheirObstacles(e,t[0]),this.ProcessThePathEndToMapAxisEdgesToTheirObstacles(e,t[1]))}ProcessThePathEndToMapAxisEdgesToTheirObstacles(e,t){for(let n=e.LastEdge;null!=n&&Ae.DirectionsAreParallel(n.Direction,this.NudgingDirection);n=n.Prev)this.axisEdgesToObstaclesTheyOriginatedFrom.set(n.AxisEdge,t)}ProcessThePathStartToMapAxisEdgesToTheirObstacles(e,t){for(let n=e.FirstEdge;null!=n&&Ae.DirectionsAreParallel(n.Direction,this.NudgingDirection);n=n.Next)this.axisEdgesToObstaclesTheyOriginatedFrom.set(n.AxisEdge,t)}GetPathOrdersAndPathGraph(){const e=new Ln(this.Paths);this.PathOrders=e.GetOrder(),this.PathVisibilityGraph=e.PathVisibilityGraph}static GetCurvesForShow(e,t){const n=new Array;for(const i of e){const s=new Me;for(const o of i.PathPoints)s.addPoint(o);n.push(s)}return n.concat(Array.from(t))}DrawPaths(){this.SetWidthsOfArrowheads(),this.CreateLongestNudgedSegments(),this.FindFreeSpaceInDirection(Array.from(this.PathVisibilityGraph.Edges)),this.MoveLongestSegsIdealPositionsInsideFeasibleIntervals(),this.PositionShiftedEdges()}SetWidthsOfArrowheads(){for(const e of this.Paths)Nt.SetWidthsOfArrowheadsForEdge(e)}static SetWidthsOfArrowheadsForEdge(e){const t=e.GeomEdge;if(null!=t.targetArrowhead){const n=e.LastEdge;n.Width=Math.max(t.targetArrowhead.width,n.Width)}if(null!=t.sourceArrowhead){const n=e.FirstEdge;n.Width=Math.max(t.sourceArrowhead.width,n.Width)}}PositionShiftedEdges(){this.Solver=new Q4(this.EdgeSeparation);for(let e=0;e<this.LongestNudgedSegs.length;e++)this.CreateVariablesOfLongestSegment(this.LongestNudgedSegs[e]);this.CreateConstraintsOfTheOrder(),this.CreateConstraintsBetweenLongestSegments(),this.Solver.SolveByRegularSolver(),this.ShiftPathEdges()}MoveLongestSegsIdealPositionsInsideFeasibleIntervals(){for(let e=0;e<this.LongestNudgedSegs.length;e++)Nt.MoveLongestSegIdealPositionsInsideFeasibleInterval(this.LongestNudgedSegs[e])}static MoveLongestSegIdealPositionsInsideFeasibleInterval(e){if(e.IsFixed)return;const t=e.GetLeftBound(),n=e.GetRightBound();e.IdealPosition<t?e.IdealPosition=t:e.IdealPosition>n&&(e.IdealPosition=n)}ShiftPathEdges(){for(const e of this.Paths)e.PathPoints=this.GetShiftedPoints(e)}GetShiftedPoints(e){return Nt.RemoveSwitchbacksAndMiddlePoints(this.GetShiftedPointsSimple(e))}static Rectilinearise(e,t){return e.x==t.x||e.y==t.y?t:Math.abs(e.x-t.x)<Math.abs(e.y-t.y)?new x(e.x,t.y):new x(t.x,e.y)}GetShiftedPointsSimple(e){const t=[],n=e.FirstEdge;t.push(this.ShiftedPoint(n.Source,n.LongestNudgedSegment));for(const i of e.PathEdges())t.push(this.ShiftedEdgePositionOfTarget(i));return t}ShiftedEdgePositionOfTarget(e){return null!=e.LongestNudgedSegment||null==e.Next?this.ShiftedPoint(e.Target,e.LongestNudgedSegment):this.ShiftedPoint(e.Next.Source,e.Next.LongestNudgedSegment)}ShiftedPoint(e,t){if(null==t)return e;const n=this.Solver.GetVariablePosition(t.Id);return this.NudgingDirection==oe.North?new x(n,e.y):new x(e.x,-n)}static LineSegOfLongestSeg(e,t){const n=t==oe.East?s=>s.x:s=>s.y,i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const s of e.Edges)Nt.UpdateMinMaxWithPoint(i,n,s.Source),Nt.UpdateMinMaxWithPoint(i,n,s.Target);return t==oe.East?new me(i.min,-e.IdealPosition,i.max,-e.IdealPosition):new me(e.IdealPosition,i.min,e.IdealPosition,i.max)}static UpdateMinMaxWithPoint(e,t,n){const i=t(n);e.min>i&&(e.min=i),e.max<i&&(e.max=i)}CreateConstraintsBetweenLongestSegments(){for(const e of this.LongestNudgedSegs)this.CreateConstraintsBetweenLongestSegmentsForSegment(e)}CreateConstraintsBetweenLongestSegmentsForSegment(e){const t=new Set;for(const n of e.Edges){const i=n.AxisEdge;if(null!=i)for(const s of i.RightNeighbors)for(const o of s.LongestNudgedSegments)t.add(o)}for(const n of t)this.ConstraintTwoLongestSegs(e,n)}CreateConstraintsOfTheOrder(){for(const e of this.PathOrders)Nt.ParallelToDirection(e[0],this.NudgingDirection)&&this.CreateConstraintsOfThePathOrder(e[1])}static ParallelToDirection(e,t){switch(t){case oe.North:case oe.South:return nt(e.SourcePoint.x,e.TargetPoint.x);default:return nt(e.SourcePoint.y,e.TargetPoint.y)}}CreateConstraintsOfThePathOrder(e){let t=null;for(const n of e.filter(i=>null!=i.LongestNudgedSegment))null!=t&&this.ConstraintTwoLongestSegs(t.LongestNudgedSegment,n.LongestNudgedSegment),t=n}ConstraintTwoLongestSegs(e,t){(!e.IsFixed||!t.IsFixed)&&this.Solver.AddConstraint(e.Id,t.Id)}CreateVariablesOfLongestSegment(e){if(e.IsFixed)this.Solver.AddFixedVariable(e.Id,Nt.SegmentPosition(e,this.NudgingDirection));else{const t=e.GetLeftBound(),n=e.GetRightBound();t>=n?(this.Solver.AddFixedVariable(e.Id,Nt.SegmentPosition(e,this.NudgingDirection)),e.IsFixed=!0):(this.Solver.AddVariableNNNN(e.Id,Nt.SegmentPosition(e,this.NudgingDirection),e.IdealPosition,e.Width),t!=Number.NEGATIVE_INFINITY&&this.Solver.SetLowBound(t,e.Id),n!=Number.POSITIVE_INFINITY&&this.Solver.SetUpperBound(e.Id,n))}}static SegmentPosition(e,t){return t==oe.North?e.Start.x:-e.Start.y}FindFreeSpaceInDirection(e){this.BoundAxisEdgesByRectsKnownInAdvance(),new xs(this.NudgingDirection,this.Obstacles,this.axisEdgesToObstaclesTheyOriginatedFrom,this.PathOrders,e).FindFreeSpace()}BoundAxisEdgesByRectsKnownInAdvance(){for(const e of this.Paths)this.HasGroups&&this.BoundPathByMinCommonAncestors(e),this.BoundAxisEdgesAdjacentToSourceAndTargetOnEdge(e)}BoundPathByMinCommonAncestors(e){for(const t of this.GetMinCommonAncestors(e.GeomEdge)){const n=t.BoundingBox;for(const i of e.PathEdges()){const s=i.AxisEdge;s.Direction==this.NudgingDirection&&this.BoundAxisEdgeByRect(n,s)}}}GetMinCommonAncestors(e){null==this.PortToShapes&&(this.PortToShapes=Nt.MapPortsToShapes(this.AncestorsSets.keys()));const t=function s5(r,e){const t=new Set;if(r.size<e.size)for(const n of r)e.has(n)&&t.add(n);else for(const n of e)r.has(n)&&t.add(n);return t}(this.AncestorsForPort(e.sourcePort),this.AncestorsForPort(e.targetPort));return Array.from(t).filter(n=>!n.Children.some(i=>t.has(i)))}AncestorsForPort(e){const t=this.PortToShapes.get(e);return t?this.AncestorsSets.get(t):new Set(this.HierarchyOfGroups.AllHitItems(Ne.mkPP(e.Location,e.Location),null))}BoundAxisEdgeAdjacentToObstaclePort(e,t){null==e.Curve?this.BoundAxisByPoint(e.Location,t):e.Curve.boundingBox.contains(e.Location)&&this.BoundAxisEdgeByRect(e.Curve.boundingBox,t)}BoundAxisByPoint(e,t){null!=t&&t.Direction==this.NudgingDirection&&(this.NudgingDirection==oe.North?(t.BoundFromLeft(e.x),t.BoundFromRight(e.x)):(t.BoundFromLeft(-e.y),t.BoundFromRight(-e.y)))}BoundAxisEdgesAdjacentToSourceAndTargetOnEdge(e){this.BoundAxisEdgeAdjacentToObstaclePort(e.GeomEdge.sourcePort,e.FirstEdge.AxisEdge),this.BoundAxisEdgeAdjacentToObstaclePort(e.GeomEdge.targetPort,e.LastEdge.AxisEdge)}BoundAxisEdgeByRect(e,t){null!=t&&t.Direction==this.NudgingDirection&&(this.NudgingDirection==oe.North?(t.BoundFromLeft(e.left),t.BoundFromRight(e.right)):(t.BoundFromLeft(-1*e.top),t.BoundFromRight(-1*e.bottom)))}CreateLongestNudgedSegments(){const e=this.NudgingDirection==oe.East?t=>-t.y:t=>t.x;this.LongestNudgedSegs=new Array;for(let t=0;t<this.Paths.length;t++)this.CreateLongestNudgedSegmentsForPath(this.Paths[t],e)}CreateLongestNudgedSegmentsForPath(e,t){this.GoOverPathAndCreateLongSegs(e),Nt.CalculateIdealPositionsForLongestSegs(e,t)}static CalculateIdealPositionsForLongestSegs(e,t){let n=null,i=null,s=t(e.Start);for(const o of e.PathEdges())if(null!=o.LongestNudgedSegment){if(n=o.LongestNudgedSegment,null!=i){let a;Nt.SetIdealPositionForSeg(i,a=t(i.start),s,t(n.Start)),s=a,i=null}}else null!=n&&(i=n,n=null);null!=i?Nt.SetIdealPositionForSeg(i,t(i.Start),s,t(e.End)):null!=n&&(n.IdealPosition=t(n.Start))}static SetIdealPositionForSeg(e,t,n,i){const s=Math.max(n,i),o=Math.min(n,i);e.IdealPosition=o+q.distanceEpsilon<t?t<s?.5*(s+o):s:o}GoOverPathAndCreateLongSegs(e){let t=null;const n=Ae.OppositeDir(this.NudgingDirection);for(const i of e.PathEdges()){const s=i.Direction;s==this.NudgingDirection||s==n?(null==t?(i.LongestNudgedSegment=t=new t5(this.LongestNudgedSegs.length),this.LongestNudgedSegs.push(t)):i.LongestNudgedSegment=t,i.IsFixed&&(t.IsFixed=!0)):(i.LongestNudgedSegment=null,t=null)}}static BuildPolylineForPath(e){const t={points:e.PathPoints.map(n=>n.clone())};return Nt.ExtendPolylineToPorts(t,e),t.points}static ExtendPolylineToPorts(e,t){Nt.ExtendPolylineToSourcePort(e,t.GeomEdge.sourcePort.Location),Nt.ExtendPolylineToTargetPort(e,t.GeomEdge.targetPort.Location),e.points.length<2&&(e.points=new Array(2),e.points[0]=t.GeomEdge.sourcePort.Location,e.points[1]=t.GeomEdge.targetPort.Location)}static ExtendPolylineToTargetPort(e,t){const n=e.points.length-1,i=Ae.VectorDirectionPP(e.points[n-1],e.points[n]);if(Nt.ProjectionsAreClose(e.points[n-1],i,t))return void(e.points=e.points.slice(0,n));const s=e.points[n];e.points[n]=i==oe.East||i==oe.West?new x(t.x,s.y):new x(s.x,t.y)}static ProjectionsAreClose(e,t,n){return t==oe.East||t==oe.West?nt(e.x,n.x):nt(e.y,n.y)}static ExtendPolylineToSourcePort(e,t){const n=Ae.VectorDirectionPP(e.points[0],e.points[1]);if(Nt.ProjectionsAreClose(e.points[1],n,t))return void(e.points=e.points.slice(1));const i=e.points[0];e.points[0]=n==oe.East||n==oe.West?new x(t.x,i.y):new x(i.x,t.y)}static RemoveSwitchbacksAndMiddlePoints(e){const t=[];let n=e[0];t.push(n);let i=e[1],s=Ae.VectorDirectionPP(n,i),o=1;for(;++o<e.length;){const a=Ae.VectorDirectionPP(i,e[o]);a==s||Ae.OppositeDir(a)==s||a==oe.None||(x.closeDistEps(n,i)||t.push(n=Nt.Rectilinearise(n,i)),s=a),i=e[o]}return x.closeDistEps(n,i)||t.push(Nt.Rectilinearise(n,i)),t}static NudgePaths(e,t,n,i,s){if(0==e.length)return;const o=new Nt(e,t,n,i);o.Calculate(oe.North,!0),o.Calculate(oe.East,!1),o.Calculate(oe.North,!1),s&&o.RemoveStaircases();for(const a of e)a.GeomEdge.curve=Me.mkFromPoints(Nt.BuildPolylineForPath(a))}RemoveStaircases(){qo.RemoveStaircases(this.Paths,this.HierarchyOfObstacles)}static MapPortsToShapes(e){const t=new Map;for(const n of e)for(const i of n.Ports)t.set(i,n);return t}static*GetEdgePathFromPathEdgesAsDebugCurves(e,t,n,i){const s=i.ArrayOfPathPoints(),o=s.length,a=o>1?(t-e)/(o-1):1;for(let l=0;l<s.length-1;l++)yield Xe.mkDebugCurveTWCI(200,e+a*l,n,me.mkPP(s[l],s[l+1]))}}class o5{constructor(e,t){this.Crossings=[],this.Location=e,this.Crossings=t}}class Eu{constructor(){this.ListOfPointsAndCrossings=[],this.index=0,this.ListOfPointsAndCrossings=new Array}Count(){return this.ListOfPointsAndCrossings.length}Add(e,t){this.ListOfPointsAndCrossings.push(new o5(e,t))}Pop(){return this.ListOfPointsAndCrossings[this.index++]}CurrentIsBeforeOrAt(e){return!(this.index>=this.ListOfPointsAndCrossings.length)&&de.ComparePP(this.ListOfPointsAndCrossings[this.index].Location,e)<=0}get First(){return this.ListOfPointsAndCrossings[0]}get Last(){return this.ListOfPointsAndCrossings[this.ListOfPointsAndCrossings.length-1]}Reset(){this.index=0}MergeFrom(e){if(this.Reset(),null==e)return;const t=this.ListOfPointsAndCrossings.length;let n=0;const i=e.ListOfPointsAndCrossings.length;let s=0;const o=new Array(this.ListOfPointsAndCrossings.length);for(;n<t||s<i;){if(n>=t){o.push(e.ListOfPointsAndCrossings[s++]);continue}if(s>=i){o.push(this.ListOfPointsAndCrossings[n++]);continue}const a=this.ListOfPointsAndCrossings[n],l=e.ListOfPointsAndCrossings[s],c=de.ComparePP(a.Location,l.Location);0==c?(o.push(a),++n,++s):-1==c?(o.push(a),++n):(o.push(l),++s)}this.ListOfPointsAndCrossings=o}Trim(e,t){this.Reset(),null!=this.ListOfPointsAndCrossings&&0!=this.ListOfPointsAndCrossings.length&&(this.ListOfPointsAndCrossings=this.ListOfPointsAndCrossings.filter(n=>de.ComparePP(n.Location,e)>=0&&de.ComparePP(n.Location,t)<=0))}static ToCrossingArray(e,t){let n=0;const i=e.length;for(let a=0;a<i;a++)e[a].DirectionToInside==t&&n++;if(0==n)return null;const s=new Array(n);let o=0;for(let a=0;a<i;a++)e[a].DirectionToInside==t&&(s[o++]=e[a]);return s}ToString(){return In.String.Format("{0} [{1}]",this.ListOfPointsAndCrossings.length,this.index)}}class Re{static EdgeDirectionVE(e){return Re.EdgeDirectionVV(e.Source,e.Target)}static EdgeDirectionVV(e,t){return de.GetDirections(e.point,t.point)}static GetEdgeEnd(e,t){return t==Re.EdgeDirectionVE(e)?e.Target:e.Source}static FindAdjacentVertex(e,t){for(const n of e.InEdges)if(de.GetDirections(e.point,n.SourcePoint)==t)return n.Source;for(const n of e.OutEdges)if(de.GetDirections(e.point,n.TargetPoint)==t)return n.Target;return null}static FindAdjacentEdge(e,t){for(const n of e.InEdges)if(de.GetDirections(n.SourcePoint,e.point)==t)return n;for(const n of e.OutEdges)if(de.GetDirections(e.point,n.TargetPoint)==t)return n;return null}static FindBendPointBetween(e,t,n){return Re.IsVerticalD(n)?new x(t.x,e.y):new x(e.x,t.y)}static SegmentIntersectionPPP(e,t,n){const i=de.GetDirections(e,t);return Re.IsVerticalD(i)?new x(e.x,n.y):new x(n.x,e.y)}static SegmentIntersectionSP(e,t){return Re.SegmentIntersectionPPP(e.Start,e.End,t)}static SegmentsIntersection(e,t){return Re.IntervalsIntersect(e.Start,e.End,t.Start,t.End)}static SegmentsIntersectLL(e,t){return Re.IntervalsIntersect(e.start,e.end,t.start,t.end)}static IntervalsOverlapSS(e,t){return Re.IntervalsOverlapPPPP(e.Start,e.End,t.Start,t.End)}static IntervalsOverlapPPPP(e,t,n,i){return Re.IntervalsAreCollinear(e,t,n,i)&&de.ComparePP(e,i)!=de.ComparePP(t,n)}static IntervalsAreCollinear(e,t,n,i){const s=Re.IsVerticalPP(e,t);return Re.IsVerticalPP(n,i)==s&&(s?de.Equal(e.x,n.x):de.Equal(e.y,n.y))}static IntervalsAreSame(e,t,n,i){return de.EqualPP(e,n)&&de.EqualPP(t,i)}static IntervalsIntersect(e,t,n,i){const s=Re.SegmentIntersectionPPP(e,t,n);return Re.PointIsOnSegmentPPP(e,t,s)&&Re.PointIsOnSegmentPPP(n,i,s)?s:void 0}static SegmentIntersectionEP(e,t){return Re.SegmentIntersectionPPP(e.SourcePoint,e.TargetPoint,t)}static PointIsOnSegmentPPP(e,t,n){return de.EqualPP(e,n)||de.EqualPP(t,n)||de.GetDirections(e,n)==de.GetDirections(n,t)}static PointIsOnSegmentSP(e,t){return Re.PointIsOnSegmentPPP(e.Start,e.End,t)}static IsVerticalD(e){return 0!=(e&(oe.North|oe.South))}static IsVerticalE(e){return Re.IsVerticalD(de.GetDirections(e.SourcePoint,e.TargetPoint))}static IsVerticalPP(e,t){return Re.IsVerticalD(de.GetDirections(e,t))}static IsVertical(e){return Re.IsVerticalD(de.GetDirections(e.start,e.end))}static IsAscending(e){return 0!=(e&(oe.North|oe.East))}static Slope(e,t,n){const i=t.sub(e);return i.dot(n.PerpDirectionAsPoint)/i.dot(n.DirectionAsPoint)}static SortAscending(e,t){const n=de.GetDirections(e,t);return oe.None==n||Re.IsAscending(n)?[e,t]:[t,e]}static RectangleBorderIntersect(e,t,n){switch(n){case oe.North:case oe.South:return new x(t.x,Re.GetRectangleBound(e,n));case oe.East:case oe.West:return new x(Re.GetRectangleBound(e,n),t.y);default:throw new Error}}static GetRectangleBound(e,t){switch(t){case oe.North:return e.top;case oe.South:return e.bottom;case oe.East:return e.right;case oe.West:return e.left;default:throw new Error}}static RectangleInteriorsIntersect(e,t){return de.Compare(e.bottom,t.top)<0&&de.Compare(t.bottom,e.top)<0&&de.Compare(e.left,t.right)<0&&de.Compare(t.left,e.right)<0}static PointIsInRectangleInterior(e,t){return de.Compare(e.y,t.top)<0&&de.Compare(t.bottom,e.y)<0&&de.Compare(e.x,t.right)<0&&de.Compare(t.left,e.x)<0}}class Gt{constructor(e){this.Dir=e,this.DirectionAsPoint=Ae.toPoint(this.Dir),this.PerpDirection=oe.North==e?oe.East:oe.North,this.PerpDirectionAsPoint=Ae.toPoint(this.PerpDirection),this.OppositeDirection=Ae.OppositeDir(e)}get Dir(){return this.dir}set Dir(e){this.dir=e}get IsHorizontal(){return oe.East==this.Dir}get IsVertical(){return oe.North==this.Dir}Compare(e,t){const n=this.ComparePerpCoord(e,t);return 0!=n?n:this.CompareScanCoord(e,t)}CompareScanCoord(e,t){return de.Compare(e.sub(t).dot(this.DirectionAsPoint),0)}ComparePerpCoord(e,t){return de.Compare(e.sub(t).dot(this.PerpDirectionAsPoint),0)}IsFlatS(e){return this.IsFlatPP(e.Start,e.End)}IsFlatPP(e,t){return de.Equal(t.sub(e).dot(this.PerpDirectionAsPoint),0)}IsPerpendicularS(e){return this.IsPerpendicularPP(e.Start,e.End)}IsPerpendicularPP(e,t){return de.Equal(t.sub(e).dot(this.DirectionAsPoint),0)}Coord(e){return e.dot(this.DirectionAsPoint)}Min(e,t){return this.Compare(e,t)<=0?e:t}Max(e,t){return this.Compare(e,t)>=0?e:t}get PerpendicularInstance(){return this.IsHorizontal?Gt.VerticalInstance:Gt.HorizontalInstance}static GetInstance(e){return Re.IsVerticalD(e)?Gt.VerticalInstance:Gt.HorizontalInstance}ToString(){return this.Dir.toString()}}Gt.HorizontalInstance=new Gt(oe.East),Gt.VerticalInstance=new Gt(oe.North);class ze extends XE{constructor(e,t,n,i){super(),this.Update(e,t),this.Weight=n,this.GroupBoundaryPointAndCrossingsList=i}static mk(e,t){return new ze(e,t,ze.NormalWeight,null)}get Start(){return this.startPoint}get End(){return this.endPoint}get IsVertical(){return ze.IsVerticalSegment(this.Start,this.End)}get ScanDirection(){return this.IsVertical?Gt.VerticalInstance:Gt.HorizontalInstance}get IsOverlapped(){return ze.OverlappedWeight==this.Weight}get IsReflection(){return ze.ReflectionWeight==this.Weight}static IsVerticalSegment(e,t){return e.x==t.x}MergeGroupBoundaryCrossingList(e){null!=e&&(null==this.GroupBoundaryPointAndCrossingsList&&(this.GroupBoundaryPointAndCrossingsList=new Eu),this.GroupBoundaryPointAndCrossingsList.MergeFrom(e))}TrimGroupBoundaryCrossingList(){null!=this.GroupBoundaryPointAndCrossingsList&&this.GroupBoundaryPointAndCrossingsList.Trim(this.Start,this.End)}Update(e,t){this.startPoint=e,this.endPoint=t}SetInitialVisibilityVertex(e){this.LowestVisibilityVertex=e,this.HighestVisibilityVertex=e}AppendVisibilityVertex(e,t){if(null==this.HighestVisibilityVertex)this.AddGroupCrossingsBeforeHighestVisibilityVertex(e,t)||this.SetInitialVisibilityVertex(t);else{if(de.IsPureLower(t.point,this.HighestVisibilityVertex.point))return;this.AddGroupCrossingsBeforeHighestVisibilityVertex(e,t)||this.AppendHighestVisibilityVertex(t)}}AddVisibilityEdge(e,t){const n=new Hn(e,t,this.Weight);return tn.AddEdge(n),n}AppendHighestVisibilityVertex(e){de.EqualPP(this.HighestVisibilityVertex.point,e.point)||(this.AddVisibilityEdge(this.HighestVisibilityVertex,e),this.HighestVisibilityVertex=e)}LoadStartOverlapVertexIfNeeded(e){if(this.NeedStartOverlapVertex){const t=e.FindVertex(this.Start);this.AppendVisibilityVertex(e,null!=t?t:e.AddVertexP(this.Start))}}LoadEndOverlapVertexIfNeeded(e){if(this.NeedEndOverlapVertex){const t=e.FindVertex(this.End);this.AppendVisibilityVertex(e,null!=t?t:e.AddVertexP(this.End))}}OnSegmentIntersectorBegin(e){this.AppendGroupCrossingsThroughPoint(e,this.Start)||this.LoadStartOverlapVertexIfNeeded(e)}OnSegmentIntersectorEnd(e){this.AppendGroupCrossingsThroughPoint(e,this.End),this.GroupBoundaryPointAndCrossingsList=null,(null==this.HighestVisibilityVertex||de.IsPureLower(this.HighestVisibilityVertex.point,this.End))&&this.LoadEndOverlapVertexIfNeeded(e)}static Subsume(e,t,n,i,s,o,a,l){return l.extendStart=!0,l.extendEnd=!0,!(null==e.seg||!Re.IntervalsOverlapPPPP(e.seg.Start,e.seg.End,t,n)||(e.seg.Weight!=i?e.seg.Start!=t||e.seg.End!=n||(e.seg.Weight=Math.min(e.seg.Weight,i),0):(l.extendStart=-1==o.CompareScanCoord(t,e.seg.Start),l.extendEnd=1==o.CompareScanCoord(n,e.seg.End),(l.extendStart||l.extendEnd)&&(a.Remove(e.seg),e.seg.startPoint=o.Min(e.seg.Start,t),e.seg.endPoint=o.Max(e.seg.End,n),e.seg=a.InsertUnique(e.seg).item,e.seg.MergeGroupBoundaryCrossingList(s)),0)))}IntersectsSegment(e){return null!=Re.SegmentsIntersection(this,e)}toString(){return"["+this.Start+" -> "+this.End+(this.IsOverlapped?" olap":" free")+"]"}ContainsPoint(e){return de.EqualPP(this.Start,e)||de.EqualPP(this.End,e)||de.GetDirections(this.Start,e)==de.GetDirections(e,this.End)}get HasSparsePerpendicularCoords(){return null!=this.sparsePerpendicularCoords&&this.sparsePerpendicularCoords.size>0}CreatePointFromPerpCoord(e){return this.IsVertical?new x(this.Start.x,e):new x(e,this.Start.y)}AddSparseVertexCoord(e){null==this.sparsePerpendicularCoords&&(this.sparsePerpendicularCoords=new Set),this.sparsePerpendicularCoords.add(e)}AddSparseEndpoint(e){return!this.sparsePerpendicularCoords.has(e)&&(this.sparsePerpendicularCoords.add(e),!0)}CreateSparseVerticesAndEdges(e){var t;if(null!=this.sparsePerpendicularCoords){this.AppendGroupCrossingsThroughPoint(e,this.Start);for(const n of Array.from(this.sparsePerpendicularCoords.values()).sort(Tt)){const i=this.CreatePointFromPerpCoord(n);this.AppendVisibilityVertex(e,null!==(t=e.FindVertex(i))&&void 0!==t?t:e.AddVertexP(i))}this.AppendGroupCrossingsThroughPoint(e,this.End),this.GroupBoundaryPointAndCrossingsList=null,this.sparsePerpendicularCoords.clear(),this.sparsePerpendicularCoords=null}}HasVisibility(){return null!=this.LowestVisibilityVertex}AddGroupCrossingsBeforeHighestVisibilityVertex(e,t){return!!this.AppendGroupCrossingsThroughPoint(e,t.point)&&(de.IsPureLower(this.HighestVisibilityVertex.point,t.point)&&(this.AddVisibilityEdge(this.HighestVisibilityVertex,t),this.HighestVisibilityVertex=t),!0)}AppendGroupCrossingsThroughPoint(e,t){var n;if(null==this.GroupBoundaryPointAndCrossingsList)return!1;let i=!1;for(;this.GroupBoundaryPointAndCrossingsList.CurrentIsBeforeOrAt(t);){const s=this.GroupBoundaryPointAndCrossingsList.Pop();let o=null,a=null;de.ComparePP(s.Location,this.Start)>0&&(o=Eu.ToCrossingArray(s.Crossings,this.ScanDirection.OppositeDirection)),de.ComparePP(s.Location,this.End)<0&&(a=Eu.ToCrossingArray(s.Crossings,this.ScanDirection.Dir)),i=!0;const l=null!==(n=e.FindVertex(s.Location))&&void 0!==n?n:e.AddVertexP(s.Location);e.AddVertexP(s.Location),null!=o||null!=a?(this.AddLowCrossings(e,l,o),this.AddHighCrossings(e,l,a)):null==this.LowestVisibilityVertex?this.SetInitialVisibilityVertex(l):this.AppendHighestVisibilityVertex(l)}return i}static GetCrossingInteriorVertex(e,t,n){var i;const s=n.GetInteriorVertexPoint(t.point);return null!==(i=e.FindVertex(s))&&void 0!==i?i:e.AddVertexP(s)}AddCrossingEdge(e,t,n,i){let s=null;null!=this.HighestVisibilityVertex&&(de.EqualPP(this.HighestVisibilityVertex.point,n.point)?s=e.FindEdgePP(t.point,n.point):this.AppendHighestVisibilityVertex(t)),null==s&&(s=this.AddVisibilityEdge(t,n));const o=i.map(l=>l.Group.InputShape),a=s.IsPassable;s.IsPassable=null==a?()=>{for(const l of o)if(l.IsTransparent)return!0;return!1}:()=>{for(const l of o)if(l.IsTransparent||a())return!0;return!1},null==this.LowestVisibilityVertex&&this.SetInitialVisibilityVertex(t),this.HighestVisibilityVertex=n}AddLowCrossings(e,t,n){if(null!=n){const i=ze.GetCrossingInteriorVertex(e,t,n[0]);this.AddCrossingEdge(e,i,t,n)}}AddHighCrossings(e,t,n){if(null!=n){const i=ze.GetCrossingInteriorVertex(e,t,n[0]);this.AddCrossingEdge(e,t,i,n)}}}ze.NormalWeight=Hn.DefaultWeight,ze.ReflectionWeight=5,ze.OverlappedWeight=500;class YT{constructor(e,t,n,i,s){this.IsClosed=!1,this.Vertex=e,this.Direction=null!=t?Ae.DirectionFromPointToPoint(t.Vertex.point,e.point):oe.None,this.ResetEntry(t,n,i,s)}ResetEntry(e,t,n,i){this.PreviousEntry=e,this.Length=t,this.NumberOfBends=n,this.Cost=i}get PreviousVertex(){return null==this.PreviousEntry?null:this.PreviousEntry.Vertex}toString(){return this.Vertex.point+" "+this.Direction+" "+this.IsClosed+" "+this.Cost}}class ay{constructor(){this.Clear()}Set(e,t){this.Vertex=e,this.Weight=t}Clear(){this.Vertex=null,this.Weight=Number.NaN}}class yt{constructor(){this.nextNeighbors=[new ay,new ay,new ay],this.LengthImportance=1,this.BendsImportance=1}CombinedCost(e,t){return this.LengthImportance*e+this.BendsImportance*t}TotalCostFromSourceToVertex(e,t){return this.CombinedCost(e,t)+this.sourceCostAdjustment}InitPath(e,t,n){if(t==n||!this.InitEntryDirectionsAtTarget(n))return!1;this.Target=n,this.Source=t;const i=this.TotalCostFromSourceToVertex(0,0)+this.HeuristicDistanceFromVertexToTarget(t.point,oe.None);return!(i>=this.upperBoundOnCost)&&(this.queue=new ho(Tt),this.visitedVertices=[t],null==e?this.EnqueueInitialVerticesFromSource(i):this.EnqueueInitialVerticesFromSourceEntries(e),this.queue.count>0)}InitEntryDirectionsAtTarget(e){this.EntryDirectionsToTarget=oe.None;for(const t of e.OutEdges)this.EntryDirectionsToTarget=this.EntryDirectionsToTarget|Ae.DirectionFromPointToPoint(t.TargetPoint,e.point);for(const t of e.InEdges)this.EntryDirectionsToTarget=this.EntryDirectionsToTarget|Ae.DirectionFromPointToPoint(t.SourcePoint,e.point);return this.EntryDirectionsToTarget!=oe.None}static IsInDirs(e,t){return e==(e&t)}MultistageAdjustedCostBound(e){return Number.isFinite(e)?e+this.BendsImportance:e}HeuristicDistanceFromVertexToTarget(e,t){const n=this.Target.point.sub(e);if(nt(n.x,0)&&nt(n.y,0))return this.targetCostAdjustment;const i=Ae.VectorDirection(n);let s;return s=this.GetNumberOfBends(t==oe.None?t=oe.East|oe.North|oe.West|oe.South:t,i),this.CombinedCost(yt.ManhattanDistance(e,this.Target.point),s)+this.targetCostAdjustment}GetNumberOfBends(e,t){return Ae.IsPureDirection(t)?this.GetNumberOfBendsForPureDirection(e,t):yt.GetBendsForNotPureDirection(t,e,this.EntryDirectionsToTarget)}GetNumberOfBendsForPureDirection(e,t){return(t&e)==t?yt.IsInDirs(t,this.EntryDirectionsToTarget)?0:yt.IsInDirs(yt.Left(t),this.EntryDirectionsToTarget)||yt.IsInDirs(yt.Right(t),this.EntryDirectionsToTarget)?2:4:this.GetNumberOfBendsForPureDirection(yt.AddOneTurn[e],t)+1}static GetBendsForNotPureDirection(e,t,n){const i=e&t;if(i==oe.None)return yt.GetBendsForNotPureDirection(e,yt.AddOneTurn[t],n)+1;const s=e&n;return s==oe.None?yt.GetBendsForNotPureDirection(e,t,yt.AddOneTurn[n])+1:(i|s)==e?1:2}static Left(e){switch(e){case oe.None:return oe.None;case oe.North:return oe.West;case oe.East:return oe.North;case oe.South:return oe.East;case oe.West:return oe.South;default:throw new Error("direction")}}static Right(e){switch(e){case oe.None:return oe.None;case oe.North:return oe.East;case oe.East:return oe.South;case oe.South:return oe.West;case oe.West:return oe.North;default:throw new Error("direction")}}static RestorePathV(e){return yt.RestorePath(e,null)}static RestorePath(e,t){if(null==e.entry)return[];const n=new Array;let i=!1,s=oe.None;for(;;){s==e.entry.Direction?i=!0:(i=!1,n.push(e.entry.Vertex.point),s=e.entry.Direction);const o=e.entry.PreviousEntry;if(null==o||e.entry.Vertex==t)break;e.entry=o}return i&&n.push(e.entry.Vertex.point),n.reverse(),n}QueueReversedEntryToNeighborVertexIfNeeded(e,t,n){const i={numberOfBends:0,length:0},s=t.PreviousVertex,o=yt.GetLengthAndNumberOfBendsToNeighborVertex(e,s,n,i);if(this.CombinedCost(i.length,i.numberOfBends)<this.CombinedCost(t.Length,t.NumberOfBends)||1==e.Vertex.Degree){const a=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(s.point,o);this.EnqueueEntry(e,s,i.length,i.numberOfBends,a)}}UpdateEntryToNeighborVertexIfNeeded(e,t,n){const i={numberOfBends:0,length:0},s=yt.GetLengthAndNumberOfBendsToNeighborVertex(e,t.Vertex,n,i);if(this.CombinedCost(i.length,i.numberOfBends)<this.CombinedCost(t.Length,t.NumberOfBends)){const o=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(t.Vertex.point,s);t.ResetEntry(e,i.length,i.numberOfBends,o),this.queue.DecreasePriority(t,o)}}CreateAndEnqueueEntryToNeighborVertex(e,t,n){const i={numberOfBends:0,length:0},s=yt.GetLengthAndNumberOfBendsToNeighborVertex(e,t,n,i),o=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(t.point,s);o<this.upperBoundOnCost&&(null==t.VertexEntries&&this.visitedVertices.push(t),this.EnqueueEntry(e,t,i.length,i.numberOfBends,o))}EnqueueEntry(e,t,n,i,s){const o=new YT(t,e,n,i,s);t.SetVertexEntry(o),this.queue.Enqueue(o,o.Cost)}static GetLengthAndNumberOfBendsToNeighborVertex(e,t,n,i){i.length=e.Length+yt.ManhattanDistance(e.Vertex.point,t.point)*n;const s=Ae.DirectionFromPointToPoint(e.Vertex.point,t.point);return i.numberOfBends=e.NumberOfBends,e.Direction!=oe.None&&s!=e.Direction&&i.numberOfBends++,s}static ManhattanDistance(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}GetPathWithCost(e,t,n,i,s,o,a){if(this.upperBoundOnCost=a,this.sourceCostAdjustment=n,this.targetCostAdjustment=o,!this.InitPath(e,t,s))return null;for(;this.queue.count>0;){const l=this.queue.Dequeue(),c=l.Vertex;if(c==this.Target){if(null==i)return this.Cleanup(),l;if(this.EntryDirectionsToTarget==oe.None){let S=0;for(const b of this.Target.VertexEntries)i[S++]=b;return this.Cleanup(),null}this.upperBoundOnCost=Math.min(this.MultistageAdjustedCostBound(l.Cost),this.upperBoundOnCost);continue}l.IsClosed=!0;for(const S of this.nextNeighbors)S.Clear();const u=yt.Right(l.Direction);this.ExtendPathAlongInEdges(l,c.InEdges,u),this.ExtendPathAlongOutEdges(l,c.OutEdges,u);for(const S of this.nextNeighbors)null!=S.Vertex&&this.ExtendPathToNeighborVertex(l,S.Vertex,S.Weight)}if(null!=i&&null!=this.Target.VertexEntries)for(let l=0;l<this.Target.VertexEntries.length;l++)i[l]=this.Target.VertexEntries[l];return this.Cleanup(),null}ExtendPathAlongInEdges(e,t,n){for(const i of t)this.ExtendPathAlongEdge(e,i,!0,n)}ExtendPathAlongOutEdges(e,t,n){let i=t.isEmpty()?null:t.treeMinimum();for(;null!=i;i=t.next(i))this.ExtendPathAlongEdge(e,i.item,!1,n)}ExtendPathAlongEdge(e,t,n,i){if(!yt.IsPassable(t))return;const s=n?t.Source:t.Target;if(s==e.PreviousVertex){if(e.Vertex.Degree>1||e.Vertex!=this.Source)return;return void this.ExtendPathToNeighborVertex(e,s,t.Weight)}const o=Ae.DirectionFromPointToPoint(e.Vertex.point,s.point);let a=this.nextNeighbors[2];o!=e.Direction&&(a=this.nextNeighbors[o==i?1:0]),a.Set(s,t.Weight)}EnqueueInitialVerticesFromSource(e){const t=new YT(this.Source,null,0,0,e);for(const n of this.Source.OutEdges)!yt.IsPassable(n)||this.ExtendPathToNeighborVertex(t,n.Target,n.Weight);for(const n of this.Source.InEdges)!yt.IsPassable(n)||this.ExtendPathToNeighborVertex(t,n.Source,n.Weight)}EnqueueInitialVerticesFromSourceEntries(e){for(const t of e)null!=t&&this.queue.Enqueue(t,t.Cost)}ExtendPathToNeighborVertex(e,t,n){const i=Ae.DirectionFromPointToPoint(e.Vertex.point,t.point),s=null!=t.VertexEntries?t.VertexEntries[Ae.ToIndex(i)]:null;null==s?this.CreateAndEnqueueReversedEntryToNeighborVertex(e,t,n)||this.CreateAndEnqueueEntryToNeighborVertex(e,t,n):s.IsClosed||this.UpdateEntryToNeighborVertexIfNeeded(e,s,n)}CreateAndEnqueueReversedEntryToNeighborVertex(e,t,n){if(null!=e.Vertex.VertexEntries){const i=Ae.DirectionFromPointToPoint(t.point,e.Vertex.point),s=e.Vertex.VertexEntries[Ae.ToIndex(i)];if(null!=s)return this.QueueReversedEntryToNeighborVertexIfNeeded(e,s,n),!0}return!1}static IsPassable(e){return null==e.IsPassable||e.IsPassable()}Cleanup(){for(const e of this.visitedVertices)e.RemoveVertexEntries();this.visitedVertices=[],this.queue=null}}yt.DefaultBendPenaltyAsAPercentageOfDistance=4,yt.AddOneTurn=[oe.None,oe.North|oe.East|oe.West,oe.North|oe.East|oe.South,15,oe.East|oe.South|oe.West,15,15,15,13,15,15,15,15,15,15,15];class yu{constructor(e){this.bendPenaltyAsAPercentageOfDistance=yt.DefaultBendPenaltyAsAPercentageOfDistance,this.currentPassTargetEntries=new Array(4),this.bendPenaltyAsAPercentageOfDistance=e}GetPath(e,t){const n={entry:this.GetPathStage(null,e,null,t)};return yt.RestorePathV(n)}GetPathStage(e,t,n,i){const s=new yt,o={bestEntry:null,bestCost:Number.MAX_VALUE/ze.OverlappedWeight};let a=Number.POSITIVE_INFINITY;const l=yu.Barycenter(t),c=yu.Barycenter(i),u=yt.ManhattanDistance(l,c);s.BendsImportance=Math.max(.001,u*(.01*this.bendPenaltyAsAPercentageOfDistance));const S=s.LengthImportance,b=null!=n?this.currentPassTargetEntries:null,L=[];for(const J of t)for(const te of i)L.push([J,te]);L.sort(([J,te],[ie,he])=>F(J,te)-F(ie,he));for(const[J,te]of L){if(x.closeDistEps(J.point,te.point))continue;const ie=G(J,l)*S,he=G(te,c)*S;let Ce=o.bestCost;if(null!=n){for(let rt=0;rt<b.length;rt++)b[rt]=null;Ce=s.MultistageAdjustedCostBound(o.bestCost)}const be=s.GetPathWithCost(e,J,ie,b,te,he,Ce);if(null!=b){yu.UpdateTargetEntriesForEachDirection(n,b,o);continue}if(null==be)continue;const Je=be.Cost/F(J,te);(be.Cost<o.bestCost||nt(be.Cost,o.bestCost)&&Je<a)&&(o.bestCost=be.Cost,o.bestEntry=be,a=be.Cost/F(J,te))}return o.bestEntry;function F(J,te){return yt.ManhattanDistance(J.point,te.point)}function G(J,te){return yt.ManhattanDistance(J.point,te)}}static UpdateTargetEntriesForEachDirection(e,t,n){for(let i=0;i<t.length;i++){const s=t[i];null!=s&&(null==e[i]||s.Cost<e[i].Cost)&&(e[i]=s,s.Cost<n.bestCost&&(n.bestCost=s.Cost,n.bestEntry=s))}}static Barycenter(e){let t=new x(0,0);for(const n of e)t=t.add(n.point);return t.div(e.length)}}class a5{constructor(e){this.GeomEdge=e}get PathPoints(){return this._pathPoints}set PathPoints(e){this._pathPoints=e}get Width(){return this.GeomEdge.lineWidth}get End(){return this.LastEdge.Target}get Start(){return this.FirstEdge.Source}ArrayOfPathPoints(){return this._pathPoints instanceof Ls?Array.from(UT(this._pathPoints)):this._pathPoints}*PathEdges(){for(let e=this.FirstEdge;null!=e;e=e.Next)yield e}AddEdge(e){e.Path=this,this.LastEdge.Next=e,e.Prev=this.LastEdge,this.LastEdge=e}SetFirstEdge(e){this.FirstEdge=e,this.LastEdge=e,e.Path=this}toString(){const e=new In.StringBuilder;this.PathPoints instanceof Ls&&e.Append("L");for(const t of UT(this.PathPoints))e.Append(t.toString());return e.ToString()}}function*UT(r){if(r instanceof Ls)for(let e=r;null!=e;e=e.Next)yield e.Point;else for(const e of r)yield e}class WT extends ZE{constructor(e,t,n,i){super(t),this.Slope=0,this.SlopeInverse=0,this.Obstacle=e,this.endVertex=i?t.nextOnPolyline:t.prevOnPolyline,n.IsPerpendicularPP(t.point,this.endVertex.point)||(this.Slope=Re.Slope(t.point,this.endVertex.point,n),this.SlopeInverse=1/this.Slope)}get Obstacle(){return this.obstacle}set Obstacle(e){this.obstacle=e}get EndVertex(){return this.endVertex}}class Ni extends WT{constructor(e,t,n){super(e,t,n,n.IsHorizontal)}}class wu extends WT{constructor(e,t,n){super(e,t,n,n.IsVertical)}}let ns=(()=>{class r{constructor(t,n,i){if(null!=t){if(n){const s=t.BoundingBox.clone();s.pad(i),this.PaddedPolyline=ee.polyFromBox(s)}else this.PaddedPolyline=ti.PaddedPolylineBoundaryOfNode(t.BoundaryCurve,i);r.RoundVerticesAndSimplify(this.PaddedPolyline),this.IsRectangle=this.IsPolylineRectangle(),this.InputShape=t,this.Ports=new Set(this.InputShape.Ports)}}get PaddedPolyline(){return this._PaddedPolyline}set PaddedPolyline(t){this._PaddedPolyline=t}GetPortChanges(t){return t.addedPorts=fl(this.InputShape.Ports,this.Ports),t.removedPorts=fl(this.Ports,this.InputShape.Ports),(0!=t.addedPorts.size||0!=t.removedPorts.size)&&(this.Ports=new Set(this.InputShape.Ports),!0)}get IsInConvexHull(){return null!=this.ConvexHull}get IsGroup(){return null!=this.InputShape&&this.InputShape.IsGroup}get VisibilityBoundingBox(){return this.VisibilityPolyline.boundingBox}get VisibilityPolyline(){return null!=this.ConvexHull?this.ConvexHull.Polyline:this.PaddedPolyline}static CreateSentinel(t,n,i,s){const o=r.mk(t,n,s);return o.CreateInitialSides(o.PaddedPolyline.startPoint,i),o}CreateInitialSides(t,n){this.ActiveLowSide=new Ni(this,t,n),this.ActiveHighSide=new wu(this,t,n),n.IsFlatS(this.ActiveHighSide)&&(this.ActiveHighSide=new wu(this,this.ActiveHighSide.EndVertex,n))}static mk(t,n,i){const s=new r(null,!1,0);return s.PaddedPolyline=Me.mkClosedFromPoints([q.RoundPoint(t),q.RoundPoint(n)]),s.Ordinal=i,s}IsPolylineRectangle(){if(4!=this.PaddedPolyline.count)return!1;let t=this.PaddedPolyline.startPoint,n=t.nextOnPolyline,i=Ae.VectorDirectionPP(t.point,n.point);if(!Ae.IsPureDirection(i))return!1;do{t=n,n=t.nextOnPolyline;const s=Ae.DirectionFromPointToPoint(t.point,n.point);if(s!=Ae.RotateRight(i))return!1;i=s}while(t!=this.PaddedPolyline.startPoint);return!0}static RoundVerticesAndSimplify(t){let n=t.startPoint;do{n.point=q.RoundPoint(n.point),n=n.nextOnPolyline}while(n!=t.startPoint);r.RemoveCloseAndCollinearVerticesInPlace(t),t.setInitIsRequired()}get IsPrimaryObstacle(){return null==this.ConvexHull||this==this.ConvexHull.PrimaryObstacle}static RemoveCloseAndCollinearVerticesInPlace(t){const n=10*q.intersectionEpsilon;for(let i=t.startPoint.next;null!=i;i=i.next)x.close(i.prev.point,i.point,n)&&(null==i.next?t.RemoveEndPoint():(i.prev.next=i.next,i.next.prev=i.prev));return x.close(t.start,t.end,n)&&t.RemoveStartPoint(),Et.RemoveCollinearVertices(t),null!=t.endPoint.prev&&t.endPoint.prev!=t.startPoint&&x.getTriangleOrientation(t.endPoint.prev.point,t.end,t.start)==Ie.Collinear&&t.RemoveEndPoint(),null!=t.startPoint.next&&t.endPoint.prev!=t.startPoint&&x.getTriangleOrientation(t.end,t.start,t.startPoint.next.point)==Ie.Collinear&&t.RemoveStartPoint(),t.setInitIsRequired(),t}get isOverlapped(){return null!=this.clump&&this.clump.length>0}get IsSentinel(){return null==this.InputShape}IsInSameClump(t){return this.isOverlapped&&this.clump==t.clump}Close(){this.ActiveLowSide=null,this.ActiveHighSide=null}SetConvexHull(t){this.clump=null,this.IsRectangle=!1,this.ConvexHull=t,this.looseVisibilityPolyline=null}static CreateLoosePolyline(t){const n=ti.CreatePaddedPolyline(t,10*q.intersectionEpsilon);return r.RoundVerticesAndSimplify(n),n}get IsTransparentAncestor(){return null!=this.InputShape&&this.InputShape.IsTransparent}set IsTransparentAncestor(t){this.InputShape.IsTransparent=t}}return r.FirstSentinelOrdinal=1,r.FirstNonSentinelOrdinal=10,r})();class l5{constructor(e,t,n,i){this.IsOverlapped=!1,this.unpaddedToPaddedBorderWeight=ze.NormalWeight,this.ObstaclePort=e,this.UnpaddedBorderIntersect=t,this.OutwardDirection=n;const s=me.mkPP(this.UnpaddedBorderIntersect,Re.RectangleBorderIntersect(e.Obstacle.VisibilityBoundingBox,this.UnpaddedBorderIntersect,n)),o=ee.getAllIntersections(s,e.Obstacle.VisibilityPolyline,!0);this.VisibilityBorderIntersect=q.RoundPoint(o[0].x);const a={pacList:null};this.MaxVisibilitySegment=i.CreateMaxVisibilitySegment(this.VisibilityBorderIntersect,this.OutwardDirection,a),this.pointAndCrossingsList=a.pacList,(this.Obstacle.isOverlapped||this.Obstacle.IsGroup&&!this.Obstacle.IsInConvexHull)&&(this.IsOverlapped=i.IntersectionIsInsideAnotherObstacle(null,this.Obstacle,this.VisibilityBorderIntersect,Gt.GetInstance(this.OutwardDirection)),(!this.Obstacle.IsGroup||this.IsOverlapped||this.InteriorEdgeCrossesObstacle(i))&&(this.unpaddedToPaddedBorderWeight=ze.OverlappedWeight)),this.Obstacle.IsInConvexHull&&this.unpaddedToPaddedBorderWeight==ze.NormalWeight&&this.SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps(i)}get Obstacle(){return this.ObstaclePort.Obstacle}get InitialWeight(){return this.IsOverlapped?ze.OverlappedWeight:ze.NormalWeight}get IsCollinearWithPort(){return Ae.IsPureDirection(de.GetDirections(this.VisibilityBorderIntersect,this.ObstaclePort.Location))}get IsVertical(){return Re.IsVertical(this.MaxVisibilitySegment)}get WantVisibilityIntersection(){return!this.IsOverlapped&&this.CanExtend&&(!this.ObstaclePort.HasCollinearEntrances||this.IsCollinearWithPort)}get CanExtend(){return de.GetDirections(this.MaxVisibilitySegment.start,this.MaxVisibilitySegment.end)!=oe.None}SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps(e){(this.Obstacle.IsGroup?this.InteriorEdgeCrossesObstacle(e):this.InteriorEdgeCrossesConvexHullSiblings())&&(this.unpaddedToPaddedBorderWeight=ze.OverlappedWeight)}InteriorEdgeCrossesObstacle(e){const t=Ne.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect);return this.InteriorEdgeCrossesObstacleRFI(t,n=>n.VisibilityPolyline,Array.from(e.Root.GetLeafRectangleNodesIntersectingRectangle(t)).filter(n=>!n.UserData.IsGroup&&n.UserData!=this.Obstacle).map(n=>n.UserData))}InteriorEdgeCrossesConvexHullSiblings(){const e=Ne.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect);return this.InteriorEdgeCrossesObstacleRFI(e,t=>t.PaddedPolyline,this.Obstacle.ConvexHull.Obstacles.filter(t=>t!=this.Obstacle))}InteriorEdgeCrossesObstacleRFI(e,t,n){let i=null;for(const s of n){const o=t(s);if(Re.RectangleInteriorsIntersect(e,o.boundingBox)&&(i=null!=i?i:me.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect),null!=ee.intersectionOne(i,o,!1)||Fe.Outside!=ee.PointRelativeToCurveLocation(this.UnpaddedBorderIntersect,o)))return!0}return!1}get HasGroupCrossings(){return null!=this.pointAndCrossingsList&&this.pointAndCrossingsList.Count()>0}HasGroupCrossingBeforePoint(e){if(!this.HasGroupCrossings)return!1;const t=Re.IsAscending(this.OutwardDirection)?this.pointAndCrossingsList.First:this.pointAndCrossingsList.Last;return de.GetDirections(this.MaxVisibilitySegment.start,t.Location)==de.GetDirections(t.Location,e)}AddToAdjacentVertex(e,t,n,i){let s=e.VisGraph.FindVertex(this.VisibilityBorderIntersect);null==s?(this.OutwardDirection==de.GetDirections(t.point,this.VisibilityBorderIntersect)?(this.VisibilityBorderIntersect=t.point,s=t):(s=e.FindOrAddVertex(this.VisibilityBorderIntersect),e.FindOrAddEdge(s,t,this.InitialWeight)),this.ExtendEdgeChain(e,s,t,n,i)):this.ExtendEdgeChain(e,s,s,n,i)}ExtendEdgeChain(e,t,n,i,s){e.ExtendEdgeChainVRLPB(n,i,this.MaxVisibilitySegment,this.pointAndCrossingsList,this.IsOverlapped);const o=e.FindOrAddVertex(this.UnpaddedBorderIntersect);e.FindOrAddEdge(o,t,this.unpaddedToPaddedBorderWeight),s&&e.ConnectVertexToTargetVertex(this.ObstaclePort.CenterVertex,o,this.OutwardDirection,this.InitialWeight)}toString(){return In.String.Format("{0} {1}~{2} {3}",this.ObstaclePort.Location,this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect,this.OutwardDirection)}}class c5{constructor(e,t){this.HasCollinearEntrances=!1,this.VisibilityRectangle=Ne.mkEmpty(),this.Port=e,this.Obstacle=t,this.PortEntrances=new Array,this.Location=q.RoundPoint(this.Port.Location)}CreatePortEntrance(e,t,n){const i=new l5(this,e,t,n);this.PortEntrances.push(i),this.VisibilityRectangle.add(i.MaxVisibilitySegment.end),this.HasCollinearEntrances=this.HasCollinearEntrances||i.IsCollinearWithPort}ClearVisibility(){this.PortEntrances=[]}AddToGraph(e,t){t&&(this.CenterVertex=e.FindOrAddVertex(this.Location))}RemoveFromGraph(){this.CenterVertex=null}get LocationHasChanged(){return!x.closeDistEps(this.Location,q.RoundPoint(this.Port.Location))}get PortCurve(){return this.Port.Curve}get PortLocation(){return this.Port.Location}toString(){return this.Port+this.Obstacle.toString()}}class u5{constructor(e,t){this.maxVisibilitySegmentsAndCrossings=new Array(4),this.OutOfBoundsDirectionFromGraph=oe.None,this.GetVertex(e,t)}get Point(){return this.Vertex.point}get InitialWeight(){return this.IsOverlapped?ze.OverlappedWeight:ze.NormalWeight}get IsOutOfBounds(){return oe.None!=this.OutOfBoundsDirectionFromGraph}GetVertex(e,t){this.Vertex=e.FindOrAddVertex(t)}AddEdgeToAdjacentEdge(e,t,n,i){const s=Re.SegmentIntersectionEP(t,this.Point);let o=e.VisGraph.FindVertex(s);return null!=o?this.AddToAdjacentVertex(e,o,n,i):o=e.AddEdgeToTargetEdge(this.Vertex,t,s),this.ExtendEdgeChain(e,o,n,i),o}AddToAdjacentVertex(e,t,n,i){de.EqualPP(this.Point,t.point)||e.FindOrAddEdge(this.Vertex,t,this.InitialWeight),this.ExtendEdgeChain(e,t,n,i)}ExtendEdgeChain(e,t,n,i){let s=this.IsOverlapped;s&&(s=e.ObstacleTree.PointIsInsideAnObstaclePD(t.point,n));const o=this.GetSegmentAndCrossings(this.IsOverlapped?t:this.Vertex,n,e);e.ExtendEdgeChainVRLPB(t,i,o[0],o[1],s)}GetSegmentAndCrossings(e,t,n){const i=Ae.ToIndex(t);let s=this.maxVisibilitySegmentsAndCrossings[i];if(null==s){const o={pacList:null};s=[n.ObstacleTree.CreateMaxVisibilitySegment(e.point,t,o),o.pacList],this.maxVisibilitySegmentsAndCrossings[i]=s}else de.GetDirections(e.point,s[0].start)==t&&(s[0].start=e.point);return s}MaxVisibilityInDirectionForNonOverlappedFreePoint(e,t){return this.GetSegmentAndCrossings(this.Vertex,e,t)[0].end}AddOobEdgesFromGraphCorner(e,t){const n=de.GetDirections(t,this.Vertex.point),i=e.VisGraph.FindVertex(t);e.ConnectVertexToTargetVertex(i,this.Vertex,n&(oe.North|oe.South),ze.NormalWeight),e.ConnectVertexToTargetVertex(i,this.Vertex,n&(oe.East|oe.West),ze.NormalWeight)}RemoveFromGraph(){this.Vertex=null}toString(){return this.Vertex.toString()}}class ly{constructor(e,t){this.BoundaryWidth=q.distanceEpsilon,this.Group=e,this.DirectionToInside=t}GetInteriorVertexPoint(e){return q.RoundPoint(e.add(Ae.toPoint(this.DirectionToInside).mul(this.BoundaryWidth)))}toString(){return In.String.Format("{0} {1}",this.DirectionToInside,this.Group)}}ly.BoundaryWidth=q.distanceEpsilon;class cy extends Ns{constructor(e){super(),this.site=e}get Site(){return this.site}}class Zd extends wl{constructor(e,t){super(t),this.Obstacle=e}}class ef extends Zd{constructor(e,t){super(e,t)}}class h5{constructor(e){this.Coord=e}AddPendingPerpendicularCoord(e){null==this.pendingPerpCoords&&(this.pendingPerpCoords=new Array),this.pendingPerpCoords.push(e)}ResetForIntersections(){this.CurrentSegment=this.FirstSegment}get IsHorizontal(){return!this.FirstSegment.IsVertical}TraverseToSegmentContainingPoint(e){if(this.CurrentSegment.ContainsPoint(e))return!0;if(!de.Equal(this.Coord,this.IsHorizontal?e.y:e.x)){for(;this.MoveNext(););return!1}for(;;){if((null==this.CurrentSegment.NextSegment||de.GetDirections(this.CurrentSegment.End,e)==de.GetDirections(e,this.CurrentSegment.NextSegment.Start))&&x.closeIntersections(this.CurrentSegment.End,e))return this.CurrentSegment.Update(this.CurrentSegment.Start,e),!0;if(!this.MoveNext())return!1;if(this.CurrentSegment.ContainsPoint(e))return!0;if(de.IsPureLower(e,this.CurrentSegment.Start))return this.CurrentSegment.Update(e,this.CurrentSegment.End),!0}}MoveNext(){return this.CurrentSegment=this.CurrentSegment.NextSegment,this.HasCurrent}get HasCurrent(){return null!=this.CurrentSegment}PointIsCurrentEndAndNextStart(e){return e.equal(this.CurrentSegment.End)&&null!=this.CurrentSegment.NextSegment&&e.equal(this.CurrentSegment.NextSegment.Start)}AddPerpendicularCoord(e){const t=this.IsHorizontal?new x(e,this.Coord):new x(this.Coord,e);this.TraverseToSegmentContainingPoint(t),this.CurrentSegment.AddSparseVertexCoord(e)}toString(){return null==this.FirstSegment?"-0- "+this.Coord:this.IsHorizontal?"(H) Y == "+this.Coord:"(V) X == "}AppendScanSegment(e){null==this.FirstSegment?this.FirstSegment=e:this.CurrentSegment.NextSegment=e,this.CurrentSegment=e}AddPendingPerpendicularCoordsToScanSegments(){if(null!=this.pendingPerpCoords){this.ResetForIntersections();for(const e of this.pendingPerpCoords)this.AddPerpendicularCoord(e)}}}class jT{constructor(e,t){this.CurrentSlotIndex=0,this.vector=[],this.IsHorizontal=t;const n=Array.from(e).sort((i,s)=>i>s?1:i<s?-1:0);for(const i of n)this.vector.push(new h5(i))}get Length(){return this.vector.length}get CurrentSlot(){return this.vector[this.CurrentSlotIndex]}Item(e){return this.vector[e]}CreateScanSegment(e,t,n,i){this.CurrentSlot.AppendScanSegment(new ze(e,t,n,i))}ScanSegmentsCompleteForCurrentSlot(){this.CurrentSlotIndex++}ScanSegmentsComplete(){for(const e of this.vector)e.AddPendingPerpendicularCoordsToScanSegments()}Items(){return this.vector}ResetForIntersections(){for(const e of this.vector)e.ResetForIntersections()}FindNearest(e,t){let n=0,i=this.vector.length-1;if(e<=this.vector[n].Coord)return n;if(e>=this.vector[i].Coord)return i;for(;i-n>2;){const s=n+(i-n>>1),o=this.vector[s];if(e<o.Coord)i=s;else{if(!(e>o.Coord))return s;n=s}}for(n++;n<=i;n++){const s=this.vector[n];if(e<s.Coord)return t>0?n:n-1;if(e==s.Coord)break}return n}CreateSparseVerticesAndEdges(e){for(const t of this.vector){t.ResetForIntersections();for(let n=t.FirstSegment;null!=n;n=n.NextSegment)n.CreateSparseVerticesAndEdges(e)}}GetParallelCoord(e){return this.IsHorizontal?e.y:e.x}GetPerpendicularCoord(e){return this.IsHorizontal?e.x:e.y}ConnectAdjoiningSegmentEndpoints(){for(const e of this.vector){e.ResetForIntersections();let t=e.FirstSegment;for(let n=t.NextSegment;null!=n;n=n.NextSegment){if(n.HasSparsePerpendicularCoords&&t.HasSparsePerpendicularCoords&&n.Start==t.End){const i=this.GetPerpendicularCoord(n.Start);t.AddSparseEndpoint(i),n.AddSparseEndpoint(i)}t=n}}}toString(){return(this.IsHorizontal?"(H) count":"(V) count == ")+this.vector.length}}class Qo extends Ns{constructor(e,t,n){super(),this.InitialObstacle=e,this.ReflectingObstacle=t,this.site=n}static mk(e,t,n){const i=new Qo(e.ReflectingObstacle,t,n);return i.PreviousSite=e,i}IsStaircaseStep(e){return this.InitialObstacle==e}get Site(){return this.site}}class zT{constructor(){this.eventTree=new $E((e,t)=>this.Compare(e,t))}Reset(e){this.scanDirection=e}Enqueue(e){this.eventTree.Enqueue(e)}Dequeue(){return this.eventTree.Dequeue()}get Count(){return this.eventTree.Count}Compare(e,t){if(e==t)return 0;if(null==e)return-1;if(null==t)return 1;let n=this.scanDirection.ComparePerpCoord(e.Site,t.Site);return n||(n=(e instanceof Qo?0:1)-(t instanceof Qo?0:1),n||this.scanDirection.CompareScanCoord(e.Site,t.Site))}}class KT{constructor(){this.pointCrossingMap=new cr,this.pointList=new Array}AddIntersection(e,t,n){let i=this.pointCrossingMap.get(e);i||(i=new Array,this.pointCrossingMap.set(e,i));const s=i.length;for(let a=0;a<s;a++){const l=i[a];if(l.Group==t)return l}const o=new ly(t,n);return i.push(o),o}Clear(){this.pointCrossingMap.clear()}GetOrderedListBetween(e,t){if(0==this.pointCrossingMap.size)return null;if(de.ComparePP(e,t)>0){const s=e;e=t,t=s}this.pointList=[];for(const s of this.pointCrossingMap.keys())de.ComparePP(s,e)>=0&&de.ComparePP(s,t)<=0&&this.pointList.push(s);this.pointList.sort((s,o)=>s.compareTo(o));const n=new Eu,i=this.pointList.length;for(let s=0;s<i;s++){const o=this.pointList[s];n.Add(o,this.pointCrossingMap.get(o))}return n}toString(){return In.String.Format("{0}",this.pointCrossingMap.size)}}class JT extends Qo{constructor(e,t,n){super(e.ReflectingObstacle,t.Obstacle,n),this.Side=t}}class d5{constructor(e){this.staleSites=new Array,this.scanDirection=e,this.eventTree=new xr((t,n)=>this.CompareBB(t,n)),this.findFirstPred=t=>this.CompareToFindFirstPoint(t.Site)>=0}Add(e){this.eventTree.insert(e)}MarkStaleSite(e){this.staleSites.push(e)}RemoveStaleSites(){const e=this.staleSites.length;if(e>0){for(let t=0;t<e;t++)this.RemoveExact(this.staleSites[t]);this.staleSites=[]}}RemoveSitesForFlatBottom(e,t){for(let n=this.FindFirstInRange(e,t);null!=n;n=this.FindNextInRange(n,t))this.MarkStaleSite(n.item);this.RemoveStaleSites()}Find(e){return this.FindFirstInRange(e,e)}RemoveExact(e){const t=this.eventTree.find(e);return null!=t&&t.item.Site==e.Site&&(this.eventTree.deleteNodeInternal(t),!0)}FindFirstInRange(e,t){this.findFirstPoint=e;const n=this.eventTree.findFirst(this.findFirstPred);return null!=n&&this.Compare(n.item.Site,t)<=0?n:null}CompareToFindFirstPoint(e){return this.Compare(e,this.findFirstPoint)}FindNextInRange(e,t){const n=this.eventTree.next(e);return null!=n&&this.Compare(n.item.Site,t)<=0?n:null}CompareBB(e,t){return this.scanDirection.CompareScanCoord(e.Site,t.Site)}Compare(e,t){return this.scanDirection.CompareScanCoord(e,t)}}class $T extends Zd{constructor(e,t){super(e,t)}}class qT extends Zd{constructor(e,t){super(e,t)}}class QT extends Zd{constructor(e,t){super(e,t)}}class XT extends Qo{constructor(e,t,n){super(e.ReflectingObstacle,t.obstacle,n),this.Side=t}}class ZT{get LowNeighborSide(){return null==this.LowNeighbor?null:this.LowNeighbor.item}get HighNeighborSide(){return null==this.HighNeighbor?null:this.HighNeighbor.item}Clear(){this.LowNeighbor=null,this.LowOverlapEnd=null,this.GroupSideInterveningBeforeLowNeighbor=null,this.HighNeighbor=null,this.HighOverlapEnd=null,this.GroupSideInterveningBeforeHighNeighbor=null}SetSides(e,t,n,i){if(Re.IsAscending(e))return this.HighNeighbor=t,this.HighOverlapEnd=n,void(this.GroupSideInterveningBeforeHighNeighbor=i);this.LowNeighbor=t,this.LowOverlapEnd=n,this.GroupSideInterveningBeforeLowNeighbor=i}}class eP{constructor(e,t){this.Polyline=e,this.Obstacles=Array.from(t),this.PrimaryObstacle=this.Obstacles[0],ns.RoundVerticesAndSimplify(this.Polyline)}}class Il{static MungeClosestIntersectionInfo(e,t,n){const i=t.seg1.boundingBox,s=q.RoundPoint(t.x).clone();return n?new x(Il.MungeIntersect(e.x,s.x,i.left,i.right),s.y):new x(s.x,Il.MungeIntersect(e.y,s.y,i.bottom,i.top))}static MungeIntersect(e,t,n,i){if(e<t){const s=Math.min(n,i);t<s&&(t=s)}else if(e>t){const s=Math.max(n,i);t>s&&(t=s)}return q.RoundDouble(t)}}class Vt{constructor(){this.CurrentGroupBoundaryCrossingMap=new KT,this.overlapPairs=new bi,this.hasOverlaps=!1,this.lookupIntPair=new ot(-1,-1)}get GraphBox(){return this.Root.irect}Init(e,t,n){this.CreateObstacleListAndOrdinals(e),this.AncestorSets=t,this.CreateRoot(),this.shapeIdToObstacleMap=n}CreateObstacleListAndOrdinals(e){this.allObstacles=Array.from(e);let t=ns.FirstNonSentinelOrdinal;for(const n of this.allObstacles)n.Ordinal=t++}OrdinalToObstacle(e){return this.allObstacles[e-ns.FirstNonSentinelOrdinal]}CreateRoot(){this.Root=Vt.CalculateHierarchy(this.GetAllObstacles()),this.OverlapsExist()&&(this.AccreteClumps(),this.AccreteConvexHulls(),this.GrowGroupsToAccommodateOverlaps(),this.Root=Vt.CalculateHierarchy(this.GetAllObstacles().filter(e=>e.IsPrimaryObstacle)))}OverlapsExist(){return null!=this.Root&&(Un(this.Root,this.Root,(e,t)=>this.CheckForInitialOverlaps(e,t)),this.hasOverlaps)}OverlapPairAlreadyFound(e,t){return this.lookupIntPair.x=t.Ordinal,this.lookupIntPair.y=e.Ordinal,this.overlapPairs.has(this.lookupIntPair)}CheckForInitialOverlaps(e,t){if(this.hasOverlaps)return;const n={bIsInsideA:!1,aIsInsideB:!1};Vt.ObstaclesIntersect(e,t,n)?this.hasOverlaps=!0:!n.aIsInsideB&&!n.bIsInsideA||e.IsGroup&&t.IsGroup||e.IsGroup&&n.bIsInsideA||t.IsGroup&&n.aIsInsideB||(this.hasOverlaps=!0)}AccreteClumps(){this.AccumulateObstaclesForClumps(),this.CreateClumps()}AccreteConvexHulls(){for(;;)if(this.AccumulateObstaclesForConvexHulls(),!this.CreateConvexHulls())return}static CalculateHierarchy(e){return en(Array.from(e).map(n=>Cn(n,n.VisibilityBoundingBox)))}AccumulateObstaclesForClumps(){this.overlapPairs.clear();const e=Vt.CalculateHierarchy(this.GetAllObstacles().filter(t=>!t.IsGroup&&t.IsRectangle));null!=e&&Mr(e,e,(t,n)=>this.EvaluateOverlappedPairForClump(t,n))}EvaluateOverlappedPairForClump(e,t){if(e==t||this.OverlapPairAlreadyFound(e,t))return;const n={bIsInsideA:!1,aIsInsideB:!1};!Vt.ObstaclesIntersect(e,t,n)&&!n.aIsInsideB&&!n.bIsInsideA||this.overlapPairs.add(new ot(e.Ordinal,t.Ordinal))}AccumulateObstaclesForConvexHulls(){this.overlapPairs.clear();const e=Vt.CalculateHierarchy(this.GetAllObstacles().filter(t=>t.IsPrimaryObstacle&&!t.IsGroup));null!=e&&Mr(e,e,(t,n)=>this.EvaluateOverlappedPairForConvexHull(t,n))}EvaluateOverlappedPairForConvexHull(e,t){if(e==t||this.OverlapPairAlreadyFound(e,t))return;const n={bIsInsideA:!1,aIsInsideB:!1};!Vt.ObstaclesIntersect(e,t,n)&&!n.aIsInsideB&&!n.bIsInsideA||!e.IsInConvexHull&&!t.IsInConvexHull&&e.IsRectangle&&t.IsRectangle||(this.overlapPairs.add(new ot(e.Ordinal,t.Ordinal)),this.AddClumpToConvexHull(e),this.AddClumpToConvexHull(t),this.AddConvexHullToConvexHull(e),this.AddConvexHullToConvexHull(t))}GrowGroupsToAccommodateOverlaps(){for(;;)if(this.AccumulateObstaclesForGroupOverlaps(),!this.GrowGroupsToResolveOverlaps())return}AccumulateObstaclesForGroupOverlaps(){const e=Vt.CalculateHierarchy(this.GetAllObstacles().filter(n=>n.IsGroup)),t=Vt.CalculateHierarchy(this.GetAllObstacles().filter(n=>n.IsPrimaryObstacle));null==e||null==t||Mr(e,t,(n,i)=>this.EvaluateOverlappedPairForGroup(n,i))}EvaluateOverlappedPairForGroup(e,t){if(e==t||this.OverlapPairAlreadyFound(e,t))return;const n={bIsInsideA:!1,aIsInsideB:!1},i=Vt.ObstaclesIntersect(e,t,n);if(i||n.aIsInsideB||n.bIsInsideA){if(e.IsRectangle&&t.IsRectangle)return void(t.IsGroup||(n.aIsInsideB||Vt.FirstRectangleContainsACornerOfTheOther(t.VisibilityBoundingBox,e.VisibilityBoundingBox))&&(t.OverlapsGroupCorner=!0));!i&&(t.IsGroup||n.bIsInsideA)||this.overlapPairs.add(new ot(e.Ordinal,t.Ordinal))}}static FirstRectangleContainsACornerOfTheOther(e,t){return e.contains(t.leftBottom)||e.contains(t.leftTop)||e.contains(t.rightTop)||e.contains(t.rightBottom)}static FirstPolylineStartIsInsideSecondPolyline(e,t){return ee.PointRelativeToCurveLocation(e.start,t)!=Fe.Outside}AddClumpToConvexHull(e){if(e.isOverlapped){for(const t of e.clump.filter(n=>n.Ordinal!=e.Ordinal))this.overlapPairs.add(new ot(e.Ordinal,t.Ordinal));e.clump=[]}}AddConvexHullToConvexHull(e){if(e.IsInConvexHull){for(const t of e.ConvexHull.Obstacles.filter(n=>n.Ordinal!=e.Ordinal))this.overlapPairs.add(new ot(e.Ordinal,t.Ordinal));e.ConvexHull.Obstacles=[]}}CreateClumps(){const t=ru(kd(Array.from(this.overlapPairs.values())));for(const n of t){if(1==n.length)continue;const i=n.map(s=>this.OrdinalToObstacle(s));for(const s of i)s.clump=i}}CreateConvexHulls(){let e=!1;const n=ru(kd(Array.from(this.overlapPairs.values())));for(const i of n){if(1==i.length)continue;e=!0;const s=i.map(this.OrdinalToObstacle),o=lu(s,l=>Array.from(l.VisibilityPolyline)),a=new eP(Pi.createConvexHullAsClosedPolyline(o),s);for(const l of s)l.SetConvexHull(a)}return e}GrowGroupsToResolveOverlaps(){let e=!1;for(const t of this.overlapPairs.values()){e=!0;const n=this.OrdinalToObstacle(t.x),i=this.OrdinalToObstacle(t.y);Vt.ResolveGroupAndGroupOverlap(n,i)||Vt.ResolveGroupAndObstacleOverlap(n,i)}return this.overlapPairs.clear(),e}static ResolveGroupAndGroupOverlap(e,t){return!!t.IsGroup&&(e.VisibilityPolyline.boundingBox.area>t.VisibilityPolyline.boundingBox.area?Vt.ResolveGroupAndObstacleOverlap(e,t):Vt.ResolveGroupAndObstacleOverlap(t,e),!0)}static ResolveGroupAndObstacleOverlap(e,t){let n=t.looseVisibilityPolyline;Vt.GrowGroupAroundLoosePolyline(e,n);const i={bIsInsideA:!1,aIsInsideB:!1};for(;Vt.ObstaclesIntersect(t,e,i)||!i.aIsInsideB;)n=ns.CreateLoosePolyline(n),Vt.GrowGroupAroundLoosePolyline(e,n)}static GrowGroupAroundLoosePolyline(e,t){const n=Array.from(e.VisibilityPolyline).concat(Array.from(t));e.SetConvexHull(new eP(Pi.createConvexHullAsClosedPolyline(n),[e]))}static ObstaclesIntersect(e,t,n){return ee.CurvesIntersect(e.VisibilityPolyline,t.VisibilityPolyline)?(n.aIsInsideB=!1,n.bIsInsideA=!1,!0):(n.aIsInsideB=Vt.FirstPolylineStartIsInsideSecondPolyline(e.VisibilityPolyline,t.VisibilityPolyline),n.bIsInsideA=!n.aIsInsideB&&Vt.FirstPolylineStartIsInsideSecondPolyline(t.VisibilityPolyline,e.VisibilityPolyline),!(e.IsRectangle&&t.IsRectangle||!Vt.ObstaclesAreCloseEnoughToBeConsideredTouching(e,t,n.aIsInsideB,n.bIsInsideA)||(n.aIsInsideB=!1,n.bIsInsideA=!1,0)))}static ObstaclesAreCloseEnoughToBeConsideredTouching(e,t,n,i){if(!n&&!i)return ee.CurvesIntersect(e.looseVisibilityPolyline,t.VisibilityPolyline);const s=n?e.looseVisibilityPolyline:t.looseVisibilityPolyline,o=n?t.VisibilityPolyline:e.VisibilityPolyline;for(const a of s)if(ee.PointRelativeToCurveLocation(a,o)==Fe.Outside){const l=ee.ClosestPoint(o,a);if(!x.closeIntersections(a,l))return!0}return!1}AdjustSpatialAncestors(){if(this.SpatialAncestorsAdjusted)return!1;for(const t of this.GetAllGroups()){const n=t.VisibilityBoundingBox;for(const i of this.Root.GetNodeItemsIntersectingRectangle(n))if(i!=t&&ee.ClosedCurveInteriorsIntersect(i.VisibilityPolyline,t.VisibilityPolyline)){if(i.IsInConvexHull)for(const s of i.ConvexHull.Obstacles)this.AncestorSets.get(s.InputShape).add(t.InputShape);this.AncestorSets.get(i.InputShape).add(t.InputShape)}}let e=new Array;for(const t of this.Root.GetAllLeaves()){const n=t.VisibilityBoundingBox;e=e.concat(Array.from(this.AncestorSets.get(t.InputShape)).filter(i=>!n.intersects(this.shapeIdToObstacleMap.get(i).VisibilityBoundingBox)));for(const i of e)this.AncestorSets.get(t.InputShape).delete(i);e=[]}return this.SpatialAncestorsAdjusted=!0,!0}GetAllGroups(){return this.GetAllObstacles().filter(e=>e.IsGroup)}Clear(){this.Root=null,this.AncestorSets=null}CreateMaxVisibilitySegment(e,t,n){const i=Re.RectangleBorderIntersect(this.GraphBox,e,t);if(de.GetDirections(e,i)==oe.None)return n.pacList=null,me.mkPP(e,e);const s=this.RestrictSegmentWithObstacles(e,i);return n.pacList=this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(s.start,s.end),s}GetAllObstacles(){return this.allObstacles}GetAllPrimaryObstacles(){return this.Root.GetAllLeaves()}IntersectionIsInsideAnotherObstacle(e,t,n,i){return this.insideHitTestIgnoreObstacle1=t,this.insideHitTestIgnoreObstacle2=e,this.insideHitTestScanDirection=i,null!=this.Root.FirstHitNodeWithPredicate(n,this.InsideObstacleHitTest.bind(this))}PointIsInsideAnObstaclePD(e,t){return this.PointIsInsideAnObstacle(e,Gt.GetInstance(t))}PointIsInsideAnObstacle(e,t){return this.insideHitTestIgnoreObstacle1=null,this.insideHitTestIgnoreObstacle2=null,this.insideHitTestScanDirection=t,null!=this.Root.FirstHitNodeWithPredicate(e,this.InsideObstacleHitTest.bind(this))}InsideObstacleHitTest(e,t){if(t==this.insideHitTestIgnoreObstacle1||t==this.insideHitTestIgnoreObstacle2||t.IsGroup||!Re.PointIsInRectangleInterior(e,t.VisibilityBoundingBox))return Pt.Continue;const n=Re.RectangleBorderIntersect(t.VisibilityBoundingBox,e,this.insideHitTestScanDirection.dir).add(this.insideHitTestScanDirection.DirectionAsPoint),i=Re.RectangleBorderIntersect(t.VisibilityBoundingBox,e,this.insideHitTestScanDirection.OppositeDirection).sub(this.insideHitTestScanDirection.DirectionAsPoint),s=me.mkPP(i,n),o=ee.getAllIntersections(s,t.VisibilityPolyline,!0);if(2==o.length){const a=q.RoundPoint(o[0].x),l=q.RoundPoint(o[1].x);if(!de.EqualPP(e,a)&&!de.EqualPP(e,l)&&e.compareTo(a)!=e.compareTo(l)&&!nt(Math.floor(o[0].par1),Math.floor(o[1].par1)))return Pt.Stop}return Pt.Continue}SegmentCrossesAnObstacle(e,t){this.stopAtGroups=!0,this.wantGroupCrossings=!1;const n=this.RestrictSegmentPrivate(e,t);return!de.EqualPP(n.end,t)}SegmentCrossesANonGroupObstacle(e,t){this.stopAtGroups=!1,this.wantGroupCrossings=!1;const n=this.RestrictSegmentPrivate(e,t);return!de.EqualPP(n.end,t)}RestrictSegmentWithObstacles(e,t){return this.stopAtGroups=!1,this.wantGroupCrossings=!0,this.RestrictSegmentPrivate(e,t)}RestrictSegmentPrivate(e,t){return this.GetRestrictedIntersectionTestSegment(e,t),this.currentRestrictedRay=me.mkPP(e,t),this.restrictedRayLengthSquared=e.sub(t).lengthSquared,this.CurrentGroupBoundaryCrossingMap.Clear(),this.RecurseRestrictRayWithObstacles(this.Root),this.currentRestrictedRay}GetRestrictedIntersectionTestSegment(e,t){const n=de.GetDirections(e,t),s=oe.West==n?this.GraphBox.left:oe.East==n?this.GraphBox.right:t.x,a=oe.South==n?this.GraphBox.bottom:oe.North==n?this.GraphBox.top:e.y;this.restrictedIntersectionTestSegment=me.mkPP(new x(oe.West==n?this.GraphBox.right:oe.East==n?this.GraphBox.left:e.x,oe.South==n?2*this.GraphBox.top:oe.North==n?this.GraphBox.bottom:e.y),new x(s,a))}RecurseRestrictRayWithObstacles(e){if(!Re.RectangleInteriorsIntersect(this.currentRestrictedRay.boundingBox,e.irect))return;const t=e.UserData;if(null!=t){const n=ee.getAllIntersections(this.restrictedIntersectionTestSegment,t.VisibilityPolyline,!0);return!t.IsGroup||this.stopAtGroups?void this.LookForCloserNonGroupIntersectionToRestrictRay(n):void(this.wantGroupCrossings&&this.AddGroupIntersectionsToRestrictedRay(t,n))}this.RecurseRestrictRayWithObstacles(e.Left),this.RecurseRestrictRayWithObstacles(e.Right)}LookForCloserNonGroupIntersectionToRestrictRay(e){let t=0,n=null,i=this.restrictedRayLengthSquared;const s=de.GetDirections(this.restrictedIntersectionTestSegment.start,this.restrictedIntersectionTestSegment.end);for(const o of e){const a=q.RoundPoint(o.x),l=de.GetDirections(this.currentRestrictedRay.start,a);if(l==Ae.OppositeDir(s))continue;if(t++,oe.None==l){i=0,n=o;continue}const c=a.sub(this.currentRestrictedRay.start).lengthSquared;if(c<i){if(o.x.sub(this.currentRestrictedRay.start).lengthSquared<q.squareOfDistanceEpsilon)continue;i=c,n=o}}if(null!=n){if(1==t){const o=q.RoundPoint(n.x);if(x.closeIntersections(o,this.currentRestrictedRay.start)||x.closeIntersections(o,this.currentRestrictedRay.end))return}this.restrictedRayLengthSquared=i,this.currentRestrictedRay.end=Il.MungeClosestIntersectionInfo(this.currentRestrictedRay.start,n,!Re.IsVerticalPP(this.currentRestrictedRay.start,this.currentRestrictedRay.end))}}AddGroupIntersectionsToRestrictedRay(e,t){for(const n of t){const i=q.RoundPoint(n.x);if(i.sub(this.currentRestrictedRay.start).lengthSquared>this.restrictedRayLengthSquared)continue;const o=de.GetDirections(this.currentRestrictedRay.start,this.currentRestrictedRay.end);let c=o;0!=(Ae.VectorDirection(n.seg1.derivative(n.par1))&Ae.RotateRight(o))&&(c=Ae.OppositeDir(c)),this.CurrentGroupBoundaryCrossingMap.AddIntersection(i,e,c)}}}class f5{constructor(e,t){this.scanDirection=e,this.SideTree=new xr((n,i)=>this.Compare(n,i)),this.linePositionAtLastInsertOrRemove=t}Insert(e,t){return this.linePositionAtLastInsertOrRemove=t,this.SideTree.insert(e)}get Count(){return this.SideTree.count}Remove(e,t){this.linePositionAtLastInsertOrRemove=t,this.SideTree.remove(e)}Find(e){return-1==this.scanDirection.ComparePerpCoord(this.linePositionAtLastInsertOrRemove,e.Start)?null:this.SideTree.find(e)}NextLowB(e){return this.NextLowR(this.Find(e))}NextLowR(e){return this.SideTree.previous(e)}NextHighB(e){return this.NextHighR(this.Find(e))}NextHighR(e){return this.SideTree.next(e)}Next(e,t){return Re.IsAscending(e)?this.SideTree.next(t):this.SideTree.previous(t)}Lowest(){return this.SideTree.treeMinimum()}Compare(e,t){if(e.Obstacle==t.Obstacle)return e==t?0:e instanceof Ni?-1:1;const n=uy.ScanLineIntersectSidePBS(this.linePositionAtLastInsertOrRemove,e,this.scanDirection),i=uy.ScanLineIntersectSidePBS(this.linePositionAtLastInsertOrRemove,t,this.scanDirection);let s=n.compareTo(i);return 0==s&&(s=function KW(r,e){return(r?1:0)-(e?1:0)}(e instanceof Ni,t instanceof Ni),0==s&&(s=Tt(e.Obstacle.Ordinal,t.Obstacle.Ordinal))),s}}class tf{constructor(e){this.lookupSegment=ze.mk(new x(0,0),new x(0,1)),this.ScanDirection=e,this.segmentTree=new xr((t,n)=>this.Compare(t,n)),this.findIntersectorPred=t=>this.CompareIntersector(t),this.findPointPred=t=>this.CompareToPoint(t)}get Segments(){return this.segmentTree.allNodes()}InsertUnique(e){this.AssertValidSegmentForInsertion(e);const t=this.segmentTree.find(e);return null!=t?t:this.segmentTree.insert(e)}AssertValidSegmentForInsertion(e){}Remove(e){this.segmentTree.remove(e)}Find(e,t){this.lookupSegment.Update(e,t);const n=this.segmentTree.find(this.lookupSegment);return null!=n&&de.EqualPP(n.item.End,t)?n.item:null}FindLowestIntersector(e,t){const n=this.FindLowestIntersectorNode(e,t);return null!=n?n.item:null}FindLowestIntersectorNode(e,t){this.lookupSegment.Update(e,e);let n=this.segmentTree.findLast(this.findIntersectorPred);if(de.EqualPP(e,t))null!=n&&this.ScanDirection.Compare(n.item.End,e)<0&&(n=null);else for(this.lookupSegment.Update(e,t);null!=n&&!n.item.IntersectsSegment(this.lookupSegment);){if(this.ScanDirection.Compare(n.item.Start,t)>0)return null;n=this.segmentTree.next(n)}return n}FindHighestIntersector(e,t){this.lookupSegment.Update(t,t);let n=this.segmentTree.findLast(this.findIntersectorPred);if(de.EqualPP(e,t))null!=n&&this.ScanDirection.Compare(n.item.End,e)<0&&(n=null);else for(this.lookupSegment.Update(e,t);null!=n&&!n.item.IntersectsSegment(this.lookupSegment);){if(this.ScanDirection.Compare(n.item.End,e)<0)return null;n=this.segmentTree.previous(n)}return null!=n?n.item:null}CompareIntersector(e){return this.ScanDirection.Compare(e.Start,this.lookupSegment.Start)<=0}FindSegmentContainingPoint(e,t){return this.FindSegmentOverlappingPoints(e,e,t)}FindSegmentOverlappingPoints(e,t,n){this.lookupSegment.Update(e,t);const i=this.segmentTree.findFirst(this.findPointPred);if(null!=i){const s=i.item;if(this.ScanDirection.Compare(s.Start,t)<=0)return s}return null}CompareToPoint(e){return this.ScanDirection.Compare(e.End,this.lookupSegment.Start)>=0}MergeAndRemoveNextNode(e,t){return-1==this.ScanDirection.Compare(e.End,t.item.End)&&e.Update(e.Start,t.item.End),e.MergeGroupBoundaryCrossingList(t.item.GroupBoundaryPointAndCrossingsList),this.segmentTree.deleteNodeInternal(t),this.segmentTree.find(e)}MergeSegments(){if(this.segmentTree.count<2)return;let e=this.segmentTree.treeMinimum(),t=this.segmentTree.next(e);for(;null!=t;t=this.segmentTree.next(e))switch(this.ScanDirection.Compare(t.item.Start,e.item.End)){case 1:e=t;break;case 0:t.item.IsOverlapped==e.item.IsOverlapped?e=this.MergeAndRemoveNextNode(e.item,t):(e.item.NeedEndOverlapVertex=!0,t.item.NeedStartOverlapVertex=!0,e=t);break;default:if(e.item.IsOverlapped!=t.item.IsOverlapped){if(e.item.IsOverlapped)e.item.Start==t.item.Start?e=this.MergeAndRemoveNextNode(t.item,e):(e.item.Update(e.item.Start,t.item.Start),e=t);else if(e.item.End==t.item.End)e=this.MergeAndRemoveNextNode(e.item,t);else{const i=t.item,s=e.item;this.segmentTree.deleteNodeInternal(t),i.Update(s.End,i.End),this.segmentTree.insert(i),i.TrimGroupBoundaryCrossingList(),e=this.segmentTree.find(s)}break}e=this.MergeAndRemoveNextNode(e.item,t)}}Compare(e,t){if(e==t)return 0;if(null==e)return-1;if(null==t)return 1;let n=this.ScanDirection.Compare(e.Start,t.Start);return 0==n&&(n=-1*this.ScanDirection.Compare(e.End,t.End)),n}}class g5 extends vl{constructor(e){super(e)}SetVertexEntry(e){null==this.VertexEntries&&(this.VertexEntries=new Array(4)),this.VertexEntries[Ae.ToIndex(e.Direction)]=e}RemoveVertexEntries(){this.VertexEntries=null}}let uy=(()=>{class r{constructor(t){this.ObstacleTree=new Vt,this.CurrentGroupBoundaryCrossingMap=new KT,this.LowNeighborSides=new ZT,this.HighNeighborSides=new ZT,this.ScanDirection=Gt.HorizontalInstance,this.eventQueue=new zT,this.HorizontalScanSegments=new tf(Gt.HorizontalInstance),this.VerticalScanSegments=new tf(Gt.VerticalInstance),this.wantReflections=t}get ParallelScanSegments(){return this.ScanDirection.IsHorizontal?this.HorizontalScanSegments:this.VerticalScanSegments}get PerpendicularScanSegments(){return this.ScanDirection.IsHorizontal?this.VerticalScanSegments:this.HorizontalScanSegments}static NewVisibilityGraph(){const t=new tn;return t.VertexFactory=n=>new g5(n),t}GenerateVisibilityGraph(){if(null==this.ObstacleTree.Root)return;this.InitializeEventQueue(Gt.HorizontalInstance);let t=ns.FirstSentinelOrdinal,n=new x(this.ObstacleTree.GraphBox.left-r.SentinelOffset,this.ObstacleTree.GraphBox.bottom-r.SentinelOffset),i=new x(this.ObstacleTree.GraphBox.left-r.SentinelOffset,this.ObstacleTree.GraphBox.top+r.SentinelOffset),s=ns.CreateSentinel(n,i,this.ScanDirection,t++);this.scanLine.Insert(s.ActiveHighSide,this.ObstacleTree.GraphBox.leftBottom),n=new x(this.ObstacleTree.GraphBox.right+r.SentinelOffset,this.ObstacleTree.GraphBox.bottom-r.SentinelOffset),i=new x(this.ObstacleTree.GraphBox.right+r.SentinelOffset,this.ObstacleTree.GraphBox.top+r.SentinelOffset),s=ns.CreateSentinel(n,i,this.ScanDirection,t++),this.scanLine.Insert(s.ActiveLowSide,this.ObstacleTree.GraphBox.leftBottom),this.ProcessEvents(),this.InitializeEventQueue(Gt.VerticalInstance),n=new x(this.ObstacleTree.GraphBox.left-r.SentinelOffset,this.ObstacleTree.GraphBox.bottom-r.SentinelOffset),i=new x(this.ObstacleTree.GraphBox.right+r.SentinelOffset,this.ObstacleTree.GraphBox.bottom-r.SentinelOffset),s=ns.CreateSentinel(n,i,this.ScanDirection,t++),this.scanLine.Insert(s.ActiveHighSide,this.ObstacleTree.GraphBox.leftBottom),n=new x(this.ObstacleTree.GraphBox.left-r.SentinelOffset,this.ObstacleTree.GraphBox.top+r.SentinelOffset),i=new x(this.ObstacleTree.GraphBox.right+r.SentinelOffset,this.ObstacleTree.GraphBox.top+r.SentinelOffset),s=ns.CreateSentinel(n,i,this.ScanDirection,t),this.scanLine.Insert(s.ActiveLowSide,this.ObstacleTree.GraphBox.leftBottom),this.ProcessEvents()}static ScanLineIntersectSidePBS(t,n,i){const s=n.Direction;let o=n.Start.x,a=n.Start.y;return i.IsHorizontal?(o+=s.x/s.y*(t.y-n.Start.y),o=Il.MungeIntersect(t.x,o,n.Start.x,n.End.x),a=t.y):(o=t.x,a+=s.y/s.x*(t.x-n.Start.x),a=Il.MungeIntersect(t.y,a,n.Start.y,n.End.y)),new x(o,a)}GetOpenVertex(t){let n=t.startPoint,i=this.TraversePolylineForEvents(n),s=this.PointCompare(i.point,n.point);for(;;i=this.TraversePolylineForEvents(i)){const o=this.PointCompare(i.point,n.point);if(o<=0)n=i;else if(o>0&&s<=0)break;s=o}return n}TraversePolylineForEvents(t){return this.ScanDirection.IsHorizontal?t.nextOnPolyline:t.prevOnPolyline}InitializeEventQueue(t){this.ScanDirection=t,this.eventQueue.Reset(this.ScanDirection),this.EnqueueBottomVertexEvents(),this.scanLine=new f5(this.ScanDirection,this.ObstacleTree.GraphBox.leftBottom),this.lookaheadScan=new d5(this.ScanDirection)}EnqueueBottomVertexEvents(){for(const t of this.ObstacleTree.GetAllPrimaryObstacles()){const n=this.GetOpenVertex(t.VisibilityPolyline);this.eventQueue.Enqueue(new ef(t,n))}}IsFlat(t){return this.ScanDirection.IsFlatS(t)}IsPerpendicular(t){return this.ScanDirection.IsPerpendicularS(t)}ScanLineIntersectSide(t,n){return r.ScanLineIntersectSidePBS(t,n,this.ScanDirection)}SideReflectsUpward(t){return t instanceof Ni?this.ScanDirection.Coord(t.End)>this.ScanDirection.Coord(t.Start):this.ScanDirection.Coord(t.End)<this.ScanDirection.Coord(t.Start)}SideReflectsDownward(t){return t instanceof Ni?this.ScanDirection.Coord(t.End)<this.ScanDirection.Coord(t.Start):this.ScanDirection.Coord(t.End)>this.ScanDirection.Coord(t.Start)}StoreLookaheadSite(t,n,i,s){if(this.wantReflections&&!this.IsPerpendicular(n)){if(!s&&!Re.PointIsInRectangleInterior(i,n.Obstacle.VisibilityBoundingBox))return;this.SideReflectsUpward(n)&&null==this.lookaheadScan.Find(i)&&this.lookaheadScan.Add(new Qo(t,n.Obstacle,i))}}LoadReflectionEvents(t){this.LoadReflectionEventsBB(t,t)}LoadReflectionEventsBB(t,n){if(null==t||this.SideReflectsUpward(t)||this.IsPerpendicular(t))return;const i=Ne.mkPP(t.Start,t.End),s=Ne.mkPP(n.Start,n.End);if(this.ScanDirection.IsHorizontal?!i.intersectsOnX(s):!i.intersectsOnY(s))return;const o=Ne.intersect(i,s),l=o.rightTop;let c=this.lookaheadScan.FindFirstInRange(o.leftBottom,l);for(;null!=c;){const u=r.ScanLineIntersectSidePBS(c.item.Site,t,this.ScanDirection.PerpendicularInstance);this.ScanDirection.ComparePerpCoord(u,c.item.Site)>0?this.AddReflectionEvent(c.item,t,u):c.item.ReflectingObstacle!=t.Obstacle&&this.lookaheadScan.MarkStaleSite(c.item),c=this.lookaheadScan.FindNextInRange(c,l)}this.lookaheadScan.RemoveStaleSites()}AddPerpendicularReflectionSegment(t,n,i){if(this.lookaheadScan.RemoveExact(t.PreviousSite)){if(null==n)return!1;if(t.PreviousSite.IsStaircaseStep(t.ReflectingObstacle)){if(!Re.PointIsInRectangleInterior(t.Site,t.ReflectingObstacle.VisibilityBoundingBox)||!this.InsertPerpendicularReflectionSegment(t.PreviousSite.Site,t.Site))return!1;if(null!=i&&t.IsStaircaseStep(i.Obstacle))return this.ScanLineCrossesObstacle(t.Site,i.Obstacle)}}return!1}AddParallelReflectionSegment(t,n,i,s){{const o=this.ScanLineIntersectSide(s.Site,null!=n?n:i),a=null!=n?o:s.Site,l=null!=n?s.Site:o;return null==n?n=this.scanLine.NextLowB(i).item:i=this.scanLine.NextHighB(n).item,this.InsertParallelReflectionSegment(a,l,t,n,i,s)}}AddReflectionEvent(t,n,i){this.eventQueue.Enqueue(null!=n?new XT(t,n,i):new JT(t,n,i))}AddSideToScanLine(t,n){const i=this.scanLine.Insert(t,n);return this.LoadReflectionEvents(t),i}RemoveSideFromScanLine(t,n){this.scanLine.Remove(t.item,n)}PointCompare(t,n){return this.ScanDirection.Compare(t,n)}Clear(){this.ObstacleTree.Clear(),this.eventQueue=new zT,this.HorizontalScanSegments=new tf(Gt.HorizontalInstance),this.VerticalScanSegments=new tf(Gt.VerticalInstance),this.VisibilityGraph=null}ProcessEvents(){for(;this.eventQueue.Count>0;){const t=this.eventQueue.Dequeue();t instanceof ef?this.ProcessEventO(t):t instanceof $T?this.ProcessEventLB(t):t instanceof qT?this.ProcessEventHB(t):t instanceof QT?this.ProcessEventCV(t):t instanceof XT?this.ProcessEventLR(t):t instanceof JT?this.ProcessEventHR(t):this.ProcessCustomEvent(t),this.LowNeighborSides.Clear(),this.HighNeighborSides.Clear()}}ProcessCustomEvent(t){}ScanLineCrossesObstacle(t,n){return this.ScanDirection.ComparePerpCoord(t,n.VisibilityBoundingBox.leftBottom)>0&&this.ScanDirection.ComparePerpCoord(t,n.VisibilityBoundingBox.rightTop)<0}FindInitialNeighborSides(t,n){n.lowNborSideNode=this.scanLine.NextLowR(t),n.highNborSideNode=this.scanLine.NextHighR(t)}FindNeighborsBRR(t,n,i){this.LowNeighborSides.Clear(),this.HighNeighborSides.Clear(),this.FindNeighbors(t,n,this.LowNeighborSides),this.FindNeighbors(t,i,this.HighNeighborSides)}FindNeighbors(t,n,i){const s=t instanceof ef?n.item.Start:n.item.End,o={lowNborSideNode:null,highNborSideNode:null};this.FindInitialNeighborSides(n,o),this.SkipToNeighbor(this.ScanDirection.OppositeDirection,n.item,s,o.lowNborSideNode,i),this.SkipToNeighbor(this.ScanDirection.Dir,n.item,s,o.highNborSideNode,i)}SkipToNeighbor(t,n,i,s,o){let a=null,l=null;for(;;s=this.scanLine.Next(t,s))if(s.item.Obstacle!=n.Obstacle){if(s.item.Obstacle.IsGroup){this.ProcessGroupSideEncounteredOnTraversalToNeighbor(s,i,t)&&null==l&&(l=s.item);continue}if(s.item instanceof wu==Re.IsAscending(t)){this.ScanLineCrossesObstacle(i,s.item.Obstacle)&&(a=s,l=null);continue}break}o.SetSides(t,s,a,l)}ProcessGroupSideEncounteredOnTraversalToNeighbor(t,n,i){if(!this.ScanLineCrossesObstacle(n,t.item.Obstacle))return!1;const s=t.item instanceof Ni==Re.IsAscending(i)?i:Ae.OppositeDir(i),o=this.ScanLineIntersectSide(n,t.item);return this.CurrentGroupBoundaryCrossingMap.AddIntersection(o,t.item.Obstacle,s),!0}FindNeighborsAndProcessVertexEvent(t,n,i){this.CurrentGroupBoundaryCrossingMap.Clear(),this.FindNeighborsBRR(i,t,n),this.ProcessVertexEvent(t,n,i),this.CurrentGroupBoundaryCrossingMap.Clear()}ProcessEventO(t){var n,i;const s=t.Obstacle;s.CreateInitialSides(t.Vertex,this.ScanDirection),this.AddSideToScanLine(s.ActiveLowSide,t.Site);const o=this.AddSideToScanLine(s.ActiveHighSide,t.Site),a=this.scanLine.Find(s.ActiveLowSide);this.FindNeighborsAndProcessVertexEvent(a,o,t);const l=null!==(n=this.LowNeighborSides.GroupSideInterveningBeforeLowNeighbor)&&void 0!==n?n:this.LowNeighborSides.LowNeighborSide;this.SideReflectsUpward(l)&&this.LoadReflectionEvents(s.ActiveLowSide);const c=null!==(i=this.HighNeighborSides.GroupSideInterveningBeforeHighNeighbor)&&void 0!==i?i:this.HighNeighborSides.HighNeighborSide;if(this.SideReflectsUpward(c)&&this.LoadReflectionEvents(s.ActiveHighSide),s.ActiveHighSide.Start!=s.ActiveLowSide.Start){const u=new wu(s,t.Vertex,this.ScanDirection);this.lookaheadScan.RemoveSitesForFlatBottom(u.Start,u.End)}this.EnqueueLowBendVertexEvent(s.ActiveLowSide),this.EnqueueHighBendOrCloseVertexEvent(s.ActiveHighSide)}ProcessEventLB(t){const n=t.Obstacle,i=new Ni(n,t.Vertex,this.ScanDirection);this.ScanDirection.ComparePerpCoord(i.End,i.Start)>0&&(this.RemoveSideFromScanLine(this.scanLine.Find(n.ActiveLowSide),t.Site),this.AddSideToScanLine(i,t.Site),n.ActiveLowSide=i,this.EnqueueLowBendVertexEvent(i))}EnqueueLowBendVertexEvent(t){this.eventQueue.Enqueue(new $T(t.Obstacle,t.EndVertex))}ProcessEventHB(t){const n=t.Obstacle,i=new wu(n,t.Vertex,this.ScanDirection);this.RemoveSideFromScanLine(this.scanLine.Find(n.ActiveHighSide),t.Site);const s=this.AddSideToScanLine(i,t.Site);if(n.ActiveHighSide=i,this.EnqueueHighBendOrCloseVertexEvent(n.ActiveHighSide),this.wantReflections&&this.ScanDirection.IsHorizontal&&i.Start.x==n.VisibilityBoundingBox.right&&this.SideReflectsUpward(i)){const o=this.scanLine.NextHighR(s);o.item instanceof Ni&&this.SideReflectsDownward(o.item)&&(!n.isOverlapped||!this.ObstacleTree.PointIsInsideAnObstacle(i.Start,this.ScanDirection))&&(this.StoreLookaheadSite(o.item.Obstacle,i,i.Start,!0),this.LoadReflectionEvents(o.item))}}EnqueueHighBendOrCloseVertexEvent(t){const n=t.Obstacle;this.ScanDirection.ComparePerpCoord((this.ScanDirection.IsHorizontal?t.EndVertex.prevOnPolyline:t.EndVertex.nextOnPolyline).point,t.End)>0?this.eventQueue.Enqueue(new qT(n,t.EndVertex)):this.eventQueue.Enqueue(new QT(n,t.EndVertex))}CreateCloseEventSegmentsAndFindNeighbors(t){const n=t.Obstacle;let i=this.scanLine.Find(n.ActiveLowSide),s=this.scanLine.Find(n.ActiveHighSide);if(1==this.scanLine.Compare(n.ActiveLowSide,n.ActiveHighSide)){const o=i;i=s,s=o}if(this.FindNeighborsAndProcessVertexEvent(i,s,t),this.wantReflections&&n.isOverlapped)for(let o=this.scanLine.NextHighR(i);o.item!=s.item;o=this.scanLine.NextHighR(o))this.LoadReflectionEvents(o.item);this.scanLine.Remove(n.ActiveLowSide,t.Site),this.scanLine.Remove(n.ActiveHighSide,t.Site)}ProcessEventCV(t){this.CreateCloseEventSegmentsAndFindNeighbors(t);const i=this.HighNeighborSides.HighNeighbor.item,s=t.Obstacle;this.LoadReflectionEvents(this.LowNeighborSides.LowNeighbor.item),this.LoadReflectionEvents(i),s.Close()}ProcessEventLR(t){const n=t.Side.Obstacle,i=this.scanLine.NextLowB(t.Side).item;this.AddPerpendicularReflectionSegment(t,t.Side,i)&&this.AddParallelReflectionSegment(n,i,null,t)&&this.LoadReflectionEvents(n.ActiveLowSide)}ProcessEventHR(t){const n=t.Side.Obstacle,i=this.scanLine.NextHighB(t.Side).item;this.AddPerpendicularReflectionSegment(t,t.Side,i)&&this.AddParallelReflectionSegment(n,null,i,t)&&this.LoadReflectionEvents(n.ActiveHighSide)}MakeInBoundsLocation(t){const n=Math.max(t.x,this.ObstacleTree.GraphBox.left),i=Math.max(t.y,this.ObstacleTree.GraphBox.bottom);return new x(Math.min(n,this.ObstacleTree.GraphBox.right),Math.min(i,this.ObstacleTree.GraphBox.top))}IsInBoundsV(t){return this.IsInBoundsP(t.point)}IsInBoundsP(t){return de.EqualPP(t,this.MakeInBoundsLocation(t))}}return r.SentinelOffset=1,r})();class Br extends uy{constructor(){super(!1),this.horizontalVertexPoints=new un,this.verticalVertexPoints=new un,this.boundingBoxSteinerPoints=new un,this.xCoordAccumulator=new Set,this.yCoordAccumulator=new Set,this.horizontalCoordMap=new Map,this.verticalCoordMap=new Map}Clear(){super.Clear(),this.Cleanup()}Cleanup(){this.horizontalVertexPoints.clear(),this.verticalVertexPoints.clear(),this.boundingBoxSteinerPoints.clear(),this.xCoordAccumulator.clear(),this.yCoordAccumulator.clear(),this.horizontalCoordMap.clear(),this.verticalCoordMap.clear()}GenerateVisibilityGraph(){this.AccumulateVertexCoords(),this.CreateSegmentVectorsAndPopulateCoordinateMaps(),this.RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints(),this.GenerateSparseIntersectionsFromVertexPoints(),this.CreateScanSegmentTrees(),this.Cleanup()}AccumulateVertexCoords(){for(const e of this.ObstacleTree.GetAllObstacles())this.xCoordAccumulator.add(e.VisibilityBoundingBox.left),this.xCoordAccumulator.add(e.VisibilityBoundingBox.right),this.yCoordAccumulator.add(e.VisibilityBoundingBox.top),this.yCoordAccumulator.add(e.VisibilityBoundingBox.bottom)}CreateSegmentVectorsAndPopulateCoordinateMaps(){this.horizontalScanSegmentVector=new jT(this.yCoordAccumulator,!0),this.verticalScanSegmentVector=new jT(this.xCoordAccumulator,!1);for(let e=0;e<this.horizontalScanSegmentVector.Length;e++)this.horizontalCoordMap.set(this.horizontalScanSegmentVector.Item(e).Coord,e);for(let e=0;e<this.verticalScanSegmentVector.Length;e++)this.verticalCoordMap.set(this.verticalScanSegmentVector.Item(e).Coord,e)}RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints(){super.GenerateVisibilityGraph(),this.horizontalScanSegmentVector.ScanSegmentsComplete(),this.verticalScanSegmentVector.ScanSegmentsComplete(),this.xCoordAccumulator.clear(),this.yCoordAccumulator.clear()}InitializeEventQueue(e){super.InitializeEventQueue(e),this.SetVectorsAndCoordMaps(e),this.AddAxisCoordinateEvents(e)}AddAxisCoordinateEvents(e){if(e.IsHorizontal)for(const t of this.yCoordAccumulator)this.eventQueue.Enqueue(new cy(new x(this.ObstacleTree.GraphBox.left-Br.SentinelOffset,t)));else for(const t of this.xCoordAccumulator)this.eventQueue.Enqueue(new cy(new x(t,this.ObstacleTree.GraphBox.bottom-Br.SentinelOffset)))}ProcessCustomEvent(e){this.ProcessAxisCoordinate(e)||this.ProcessCustomEvent(e)}ProcessAxisCoordinate(e){return e instanceof cy&&(this.CreateScanSegmentsOnAxisCoordinate(e.Site),!0)}InsertPerpendicularReflectionSegment(e,t){return!1}InsertParallelReflectionSegment(e,t,n,i,s,o){return!1}ProcessVertexEvent(e,t,n){const i=this.ScanDirection.IsHorizontal?this.horizontalVertexPoints:this.verticalVertexPoints;i.add(n.Site);const s=this.LowNeighborSides.LowNeighbor.item,o=this.HighNeighborSides.HighNeighbor.item,a=this.ScanDirection.Dir,l=this.ScanDirection.OppositeDirection,c=this.ScanLineIntersectSide(n.Site,s),u=this.ScanLineIntersectSide(n.Site,o);if(this.ObstacleTree.GraphBox.contains(c)){const b=Re.RectangleBorderIntersect(s.Obstacle.VisibilityBoundingBox,c,a);de.IsPureLower(b,n.Site)&&this.boundingBoxSteinerPoints.add(b)}if(this.ObstacleTree.GraphBox.contains(u)){const b=Re.RectangleBorderIntersect(o.Obstacle.VisibilityBoundingBox,u,l);de.IsPureLower(n.Site,b)&&this.boundingBoxSteinerPoints.add(b)}const S={lowCorner:void 0,highCorner:void 0};Br.GetBoundingCorners(e.item.Obstacle.VisibilityBoundingBox,n instanceof ef,this.ScanDirection.IsHorizontal,S),(de.IsPureLower(c,S.lowCorner)||s.Obstacle.IsInSameClump(n.Obstacle))&&i.add(S.lowCorner),(de.IsPureLower(S.highCorner,u)||o.Obstacle.IsInSameClump(n.Obstacle))&&i.add(S.highCorner)}static GetBoundingCorners(e,t,n,i){if(t)return i.lowCorner=e.leftBottom,void(i.highCorner=n?e.rightBottom:e.leftTop);i.lowCorner=n?e.leftTop:e.rightBottom,i.highCorner=e.rightTop}CreateScanSegmentsOnAxisCoordinate(e){this.CurrentGroupBoundaryCrossingMap.Clear();const t=this.scanLine.Lowest();let n=this.scanLine.NextHighR(t),i=0,s=e,o=!1;for(;null!=n;n=this.scanLine.NextHighR(n))if(!this.SkipSide(s,n.item))if(n.item.Obstacle.IsGroup)(0==i||o)&&this.HandleGroupCrossing(e,n.item);else if(n.item instanceof Ni){if(i>0){i++;continue}s=this.CreateScanSegment(s,n.item,ze.NormalWeight),this.CurrentGroupBoundaryCrossingMap.Clear(),i=1,o=n.item.Obstacle.isOverlapped}else i++,!(i>0)&&(s=n.item.Obstacle.isOverlapped||n.item.Obstacle.OverlapsGroupCorner?this.CreateScanSegment(s,n.item,ze.OverlappedWeight):this.ScanLineIntersectSide(s,n.item),this.CurrentGroupBoundaryCrossingMap.Clear(),o=!1);const a=this.ScanDirection.IsHorizontal?new x(this.ObstacleTree.GraphBox.right+Br.SentinelOffset,s.y):new x(s.x,this.ObstacleTree.GraphBox.top+Br.SentinelOffset);this.parallelSegmentVector.CreateScanSegment(s,a,ze.NormalWeight,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(s,a)),this.parallelSegmentVector.ScanSegmentsCompleteForCurrentSlot()}HandleGroupCrossing(e,t){if(!this.ScanLineCrossesObstacle(e,t.Obstacle))return;const n=t instanceof Ni?this.ScanDirection.Dir:this.ScanDirection.OppositeDirection,i=this.ScanLineIntersectSide(e,t),s=this.CurrentGroupBoundaryCrossingMap.AddIntersection(i,t.Obstacle,n);this.AddPerpendicularCoordForGroupCrossing(i);const o=s.GetInteriorVertexPoint(i);this.AddPerpendicularCoordForGroupCrossing(o)}AddPerpendicularCoordForGroupCrossing(e){const t=this.FindPerpendicularSlot(e,0);-1!=t&&this.perpendicularSegmentVector.Item(t).AddPendingPerpendicularCoord(this.parallelSegmentVector.CurrentSlot.Coord)}SkipSide(e,t){if(t.Obstacle.IsSentinel)return!0;const n=t.Obstacle.VisibilityBoundingBox;return this.ScanDirection.IsHorizontal?e.y==n.bottom||e.y==n.top:e.x==n.left||e.x==n.right}CreateScanSegment(e,t,n){const i=this.ScanLineIntersectSide(e,t);return e!=i&&this.parallelSegmentVector.CreateScanSegment(e,i,n,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(e,i)),i}GenerateSparseIntersectionsFromVertexPoints(){this.VisibilityGraph=Br.NewVisibilityGraph(),this.GenerateSparseIntersectionsAlongHorizontalAxis(),this.GenerateSparseIntersectionsAlongVerticalAxis(),this.ConnectAdjoiningScanSegments(),this.horizontalScanSegmentVector.CreateSparseVerticesAndEdges(this.VisibilityGraph),this.verticalScanSegmentVector.CreateSparseVerticesAndEdges(this.VisibilityGraph)}GenerateSparseIntersectionsAlongHorizontalAxis(){this.currentAxisPointComparer=Md;const e=Array.from(this.horizontalVertexPoints.values()).sort(this.currentAxisPointComparer),t=Array.from(this.boundingBoxSteinerPoints.values()).sort(this.currentAxisPointComparer);this.ScanDirection=Gt.HorizontalInstance,this.SetVectorsAndCoordMaps(this.ScanDirection),this.GenerateSparseIntersections(e,t)}GenerateSparseIntersectionsAlongVerticalAxis(){this.currentAxisPointComparer=(n,i)=>n.compareTo(i);const e=Array.from(this.verticalVertexPoints.values()).sort(this.currentAxisPointComparer),t=Array.from(this.boundingBoxSteinerPoints.values()).sort(this.currentAxisPointComparer);this.ScanDirection=Gt.VerticalInstance,this.SetVectorsAndCoordMaps(this.ScanDirection),this.GenerateSparseIntersections(e,t)}SetVectorsAndCoordMaps(e){e.IsHorizontal?(this.parallelSegmentVector=this.horizontalScanSegmentVector,this.perpendicularSegmentVector=this.verticalScanSegmentVector,this.perpendicularCoordMap=this.verticalCoordMap):(this.parallelSegmentVector=this.verticalScanSegmentVector,this.perpendicularSegmentVector=this.horizontalScanSegmentVector,this.perpendicularCoordMap=this.horizontalCoordMap)}ConnectAdjoiningScanSegments(){this.horizontalScanSegmentVector.ConnectAdjoiningSegmentEndpoints(),this.verticalScanSegmentVector.ConnectAdjoiningSegmentEndpoints()}GenerateSparseIntersections(e,t){this.perpendicularSegmentVector.ResetForIntersections(),this.parallelSegmentVector.ResetForIntersections();let n=1;const i={j:0};for(const s of this.parallelSegmentVector.Items())for(;s.CurrentSegment.ContainsPoint(e[n])||this.AddSteinerPointsToInterveningSegments(e[n],t,i,s)&&s.TraverseToSegmentContainingPoint(e[n]);)if(this.AddPointsToCurrentSegmentIntersections(t,i,s),this.GenerateIntersectionsFromVertexPointForCurrentSegment(e[n],s),s.PointIsCurrentEndAndNextStart(e[n]))s.MoveNext();else if(++n>=e.length)return}AddSteinerPointsToInterveningSegments(e,t,n,i){for(;n.j<t.length&&-1==this.currentAxisPointComparer(t[n.j],e);){if(!i.TraverseToSegmentContainingPoint(t[n.j]))return!1;this.AddPointsToCurrentSegmentIntersections(t,n,i)}return!0}AddPointsToCurrentSegmentIntersections(e,t,n){for(;t.j<e.length&&n.CurrentSegment.ContainsPoint(e[t.j]);t.j++){const i=this.FindPerpendicularSlot(e[t.j],0);this.AddSlotToSegmentIntersections(n,i)}}GenerateIntersectionsFromVertexPointForCurrentSegment(e,t){const n=this.FindPerpendicularSlot(t.CurrentSegment.Start,1),i=this.FindPerpendicularSlot(t.CurrentSegment.End,-1),s=this.FindPerpendicularSlot(e,0);n>=i||(this.AddSlotToSegmentIntersections(t,n),this.AddSlotToSegmentIntersections(t,i),s>n&&s<i&&(this.AddSlotToSegmentIntersections(t,s),this.AddBinaryDivisionSlotsToSegmentIntersections(t,n,s,i)))}FindPerpendicularSlot(e,t){return Br.FindIntersectingSlot(this.perpendicularSegmentVector,this.perpendicularCoordMap,e,t)}static FindIntersectingSlot(e,t,n,i){const s=e.GetParallelCoord(n),o=t.get(s);return null!=o?o:0==i?-1:e.FindNearest(s,i)}AddSlotToSegmentIntersections(e,t){const n=this.perpendicularSegmentVector.Item(t);e.CurrentSegment.AddSparseVertexCoord(n.Coord),n.AddPerpendicularCoord(e.Coord)}AddBinaryDivisionSlotsToSegmentIntersections(e,t,n,i){let s=0,o=this.perpendicularSegmentVector.Length-1;for(;o-s>1;){const a=s+Math.floor((o-s)/2);n<=a?(o=a,n<o&&o<=i&&this.AddSlotToSegmentIntersections(e,o)):(s=a,n>s&&s>=t&&this.AddSlotToSegmentIntersections(e,s))}}CreateScanSegmentTrees(){Br.CreateScanSegmentTree(this.horizontalScanSegmentVector,this.HorizontalScanSegments),Br.CreateScanSegmentTree(this.verticalScanSegmentVector,this.VerticalScanSegments)}static CreateScanSegmentTree(e,t){for(const n of e.Items())for(let i=n.FirstSegment;null!=i;i=i.NextSegment)i.HasVisibility()&&t.InsertUnique(i)}}class kr{constructor(e){this.AddedVertices=new Array,this.AddedEdges=new Array,this.edgesToRestore=new Array,this.LimitPortVisibilitySpliceToEndpointBoundingBox=!1,this.GraphGenerator=e}get ObstacleTree(){return this.GraphGenerator.ObstacleTree}get VisGraph(){return this.GraphGenerator.VisibilityGraph}get IsSparseVg(){return this.GraphGenerator instanceof Br}AddVertex(e){const t=this.VisGraph.AddVertexP(e);return this.AddedVertices.push(t),t}FindOrAddVertex(e){const t=this.VisGraph.FindVertex(e);return null!=t?t:this.AddVertex(e)}FindOrAddEdgeVV(e,t){return this.FindOrAddEdge(e,t,ze.NormalWeight)}FindOrAddEdge(e,t,n){const i=de.GetPureDirectionVV(e,t),s={bracketSource:void 0,bracketTarget:void 0,splitVertex:void 0};kr.GetBrackets(e,t,i,s);let o=this.VisGraph.FindEdgePP(s.bracketSource.point,s.bracketTarget.point);return o=null!=o?this.SplitEdge(o,s.splitVertex):this.CreateEdge(s.bracketSource,s.bracketTarget,n),o}static GetBrackets(e,t,n,i){if(i.splitVertex=t,!kr.FindBracketingVertices(e,t.point,n,i)){const s={bracketSource:null,bracketTarget:null};kr.FindBracketingVertices(t,e.point,Ae.OppositeDir(n),s)&&(i.bracketSource=s.bracketTarget,i.splitVertex=e),i.bracketTarget=s.bracketSource}}static FindBracketingVertices(e,t,n,i){for(i.bracketSource=e;i.bracketTarget=Re.FindAdjacentVertex(i.bracketSource,n),null!=i.bracketTarget;){if(x.closeDistEps(i.bracketTarget.point,t))return!0;if(n!=de.GetDirections(i.bracketTarget.point,t))break;i.bracketSource=i.bracketTarget}return null!=i.bracketTarget}CreateEdge(e,t,n){let i=e,s=t;de.IsPureLower(i.point,s.point)||(i=t,s=e);const o=new Xi(i,s,n);return tn.AddEdge(o),this.AddedEdges.push(o),o}RemoveFromGraph(){this.RemoveAddedVertices(),this.RemoveAddedEdges(),this.RestoreRemovedEdges()}RemoveAddedVertices(){for(const e of this.AddedVertices)null!=this.VisGraph.FindVertex(e.point)&&this.VisGraph.RemoveVertex(e);this.AddedVertices=[]}RemoveAddedEdges(){for(const e of this.AddedEdges)null!=this.VisGraph.FindVertex(e.SourcePoint)&&tn.RemoveEdge(e);this.AddedEdges=[]}RestoreRemovedEdges(){for(const e of this.edgesToRestore)tn.AddEdge(e);this.edgesToRestore=[]}FindNextEdge(e,t){return Re.FindAdjacentEdge(e,t)}FindPerpendicularOrContainingEdge(e,t,n){for(;;){const i=Re.FindAdjacentVertex(e,t);if(null==i)break;const s=de.GetDirections(i.point,n);if(0!=(Ae.OppositeDir(t)&s))return this.VisGraph.FindEdgePP(e.point,i.point);e=i}return null}FindNearestPerpendicularOrContainingEdge(e,t,n){let i;de.GetDirections(e.point,n);let a,s=e;for(;null!=oe.None;){const l=Re.FindAdjacentVertex(s,i);if(null==l||0!=(Ae.OppositeDir(i)&de.GetDirections(l.point,n)))break;s=l,de.GetDirections(s.point,n)}for(;a=this.FindPerpendicularOrContainingEdge(s,t,n),null==a&&s!=e;)s=Re.FindAdjacentVertex(s,Ae.OppositeDir(i));return a}ConnectVertexToTargetVertex(e,t,n,i){if(x.closeDistEps(e.point,t.point))return;const s=de.GetDirections(e.point,t.point);if(de.IsPureDirectionD(s))return void this.FindOrAddEdgeVV(e,t);const o=Re.FindBendPointBetween(e.point,t.point,n),a=this.FindOrAddVertex(o);this.FindOrAddEdge(e,a,i),this.FindOrAddEdge(a,t,i)}AddEdgeToTargetEdge(e,t,n){let i=this.VisGraph.FindVertex(n);return null==i&&(i=this.AddVertex(n),this.SplitEdge(t,i)),this.FindOrAddEdgeVV(e,i),i}SplitEdge(e,t){return null==e?null:x.closeDistEps(e.Source.point,t.point)||x.closeDistEps(e.Target.point,t.point)?e:(e instanceof Xi||this.edgesToRestore.push(e),tn.RemoveEdge(e),(this.IsSparseVg||e.Weight==ze.OverlappedWeight)&&t.Degree>0?(this.FindOrAddEdge(t,e.Source,e.Weight),this.FindOrAddEdge(t,e.Target,e.Weight)):(this.CreateEdge(t,e.Target,e.Weight),this.CreateEdge(e.Source,t,e.Weight)))}ExtendEdgeChainVRLPB(e,t,n,i,s){const o=de.GetDirections(n.start,n.end);if(o==oe.None)return;const a=Re.GetRectangleBound(t,o),l=Re.IsVerticalD(o)?q.RoundPoint(new x(e.point.x,a)):q.RoundPoint(new x(a,e.point.y));if(x.closeDistEps(l,e.point)||de.GetDirections(e.point,l)!=o)return;let c=n;de.GetDirections(l,c.end)==o&&(c=me.mkPP(c.start,l)),this.ExtendEdgeChain(e,o,c,n,i,s)}ExtendEdgeChain(e,t,n,i,s,o){if(de.GetDirections(e.point,n.end)!=t)return;let l=Ae.RotateLeft(t),c=Re.FindAdjacentVertex(e,l);if(null==c&&(l=Ae.OppositeDir(l),c=Re.FindAdjacentVertex(e,l),null==c))return;const u=Ae.OppositeDir(l),S={spliceTarget:null};this.ExtendSpliceWorker(c,t,u,n,i,o,S)&&this.ExtendSpliceWorker(S.spliceTarget,t,l,n,i,o,S),this.SpliceGroupBoundaryCrossings(s,e,n)}SpliceGroupBoundaryCrossings(e,t,n){if(null==e||0==e.Count())return;e.Reset();let i=n.start,s=n.end,o=de.GetDirections(i,s);Re.IsAscending(o)||(i=n.end,s=n.start,o=Ae.OppositeDir(o));for(let a=t=kr.TraverseToFirstVertexAtOrAbove(t,i,Ae.OppositeDir(o));null!=a;a=Re.FindAdjacentVertex(a,o)){const l=de.ComparePP(a.point,s)>=0;for(;e.CurrentIsBeforeOrAt(a.point);){const c=e.Pop();de.ComparePP(c.Location,t.point)>0&&de.ComparePP(c.Location,s)<=0&&this.SpliceGroupBoundaryCrossing(a,c,Ae.OppositeDir(o)),de.ComparePP(c.Location,t.point)>=0&&de.ComparePP(c.Location,s)<0&&this.SpliceGroupBoundaryCrossing(a,c,o)}if(l)break}}static TraverseToFirstVertexAtOrAbove(e,t,n){let i=e;const s=Ae.OppositeDir(n);for(;;){const o=Re.FindAdjacentVertex(i,n);if(null==o||de.GetDirections(o.point,t)==s)break;i=o}return i}SpliceGroupBoundaryCrossing(e,t,n){var i,s;const o=Eu.ToCrossingArray(t.Crossings,n);if(null!=o){const a=null!==(i=this.VisGraph.FindVertex(t.Location))&&void 0!==i?i:this.AddVertex(t.Location);this.AddVertex(t.Location),e.point.equal(a.point)||this.FindOrAddEdgeVV(e,a);const l=o[0].GetInteriorVertexPoint(t.Location),c=null!==(s=this.VisGraph.FindVertex(l))&&void 0!==s?s:this.AddVertex(l);this.AddVertex(l),this.FindOrAddEdgeVV(a,c);const u=this.VisGraph.FindEdgePP(a.point,c.point),S=o.map(b=>b.Group.InputShape);u.IsPassable=()=>S.some(b=>b.IsTransparent)}}ExtendSpliceWorker(e,t,n,i,s,o,a){let l=Re.FindAdjacentVertex(e,n);a.spliceTarget=Re.FindAdjacentVertex(l,n);const c={spliceSource:e};for(;kr.GetNextSpliceSource(c,n,t);){const u=Re.FindBendPointBetween(l.point,c.spliceSource.point,Ae.OppositeDir(n));if(kr.IsPointPastSegmentEnd(s,u))break;if(a.spliceTarget=kr.GetSpliceTarget(c,n,u),null==a.spliceTarget){if(this.IsSkippableSpliceSourceWithNullSpliceTarget(c.spliceSource,t))continue;if(this.ObstacleTree.SegmentCrossesAnObstacle(c.spliceSource.point,u))return!1}let S=this.VisGraph.FindVertex(u);if(null!=S){if(null==a.spliceTarget||null!=this.VisGraph.FindEdgePP(l.point,u))return null==a.spliceTarget&&this.FindOrAddEdge(l,S,o?ze.OverlappedWeight:ze.NormalWeight),!1}else S=this.AddVertex(u);if(this.FindOrAddEdge(l,S,o?ze.OverlappedWeight:ze.NormalWeight),this.FindOrAddEdge(c.spliceSource,S,o?ze.OverlappedWeight:ze.NormalWeight),o&&(o=this.SeeIfSpliceIsStillOverlapped(t,S)),l=S,0==(t&de.GetDirections(u,i.end))){a.spliceTarget=null;break}}return null!=a.spliceTarget}static GetNextSpliceSource(e,t,n){let i=Re.FindAdjacentVertex(e.spliceSource,n);if(null==i)for(i=e.spliceSource;;){if(i=Re.FindAdjacentVertex(i,Ae.OppositeDir(t)),null==i)return!1;const s=Re.FindAdjacentVertex(i,n);if(null!=s){i=s;break}}return e.spliceSource=i,!0}static GetSpliceTarget(e,t,n){const i=de.GetDirections(e.spliceSource.point,n);let s=i,o=e.spliceSource;for(;s==i&&(e.spliceSource=o,o=Re.FindAdjacentVertex(e.spliceSource,t),null!=o);){if(x.closeDistEps(o.point,n)){o=Re.FindAdjacentVertex(o,t);break}s=de.GetDirections(o.point,n)}return o}SeeIfSpliceIsStillOverlapped(e,t){let n=this.FindNextEdge(t,Ae.RotateLeft(e)),i=null!=n&&ze.NormalWeight==n.Weight;return i||(n=this.FindNextEdge(t,Ae.RotateRight(e)),i=null!=n&&ze.NormalWeight==n.Weight),!i||this.ObstacleTree.PointIsInsideAnObstaclePD(t.point,e)}IsSkippableSpliceSourceWithNullSpliceTarget(e,t){if(kr.IsSkippableSpliceSourceEdgeWithNullTarget(Re.FindAdjacentEdge(e,t)))return!0;const n=Re.FindAdjacentEdge(e,Ae.OppositeDir(t));return kr.IsSkippableSpliceSourceEdgeWithNullTarget(n)||kr.IsReflectionEdge(n)}static IsSkippableSpliceSourceEdgeWithNullTarget(e){return null!=e&&null!=e.IsPassable&&nt(e.Length,ly.BoundaryWidth)}static IsReflectionEdge(e){return null!=e&&e.Weight==ze.ReflectionWeight}static IsPointPastSegmentEnd(e,t){return de.GetDirections(e.start,e.end)==de.GetDirections(e.end,t)}toString(){return In.String.Format("{0} {1}",this.AddedVertices.length,this.edgesToRestore.length)}}class vu{constructor(e){this.obstaclePortMap=new Map,this.freePointMap=new cr,this.freePointLocationsUsedByRouteEdges=new un,this.RouteToCenterOfObstacles=!1,this.obstaclePortsInGraph=new Array,this.freePointsInGraph=new Set,this.activeAncestors=new Array,this.TransUtil=new kr(e),this.graphGenerator=e}get LimitPortVisibilitySpliceToEndpointBoundingBox(){return this.TransUtil.LimitPortVisibilitySpliceToEndpointBoundingBox}set LimitPortVisibilitySpliceToEndpointBoundingBox(e){this.TransUtil.LimitPortVisibilitySpliceToEndpointBoundingBox=e}get VisGraph(){return this.graphGenerator.VisibilityGraph}get HScanSegments(){return this.graphGenerator.HorizontalScanSegments}get VScanSegments(){return this.graphGenerator.VerticalScanSegments}get ObstacleTree(){return this.graphGenerator.ObstacleTree}get AncestorSets(){return this.ObstacleTree.AncestorSets}Clear(){this.TransUtil.RemoveFromGraph(),this.obstaclePortMap.clear()}CreateObstaclePorts(e){for(const t of e.Ports)this.CreateObstaclePort(e,t)}CreateObstaclePort(e,t){if(null==t.Curve)return null;const n=q.RoundPoint(t.Location);if(Fe.Outside==ee.PointRelativeToCurveLocation(n,e.InputShape.BoundaryCurve)||e.InputShape.BoundaryCurve!=t.Curve&&Fe.Outside==ee.PointRelativeToCurveLocation(n,t.Curve))return null;const i=new c5(t,e);return this.obstaclePortMap.set(t,i),i}FindVertices(e){const t=new Array,n=this.obstaclePortMap.get(e);if(n)if(this.RouteToCenterOfObstacles)t.push(n.CenterVertex);else for(const i of n.PortEntrances){const s=this.VisGraph.FindVertex(i.UnpaddedBorderIntersect);null!=s&&t.push(s)}else t.push(this.VisGraph.FindVertex(q.RoundPoint(e.Location)));return t}RemoveObstaclePorts(e){for(const t of e.Ports)this.RemoveObstaclePort(t)}RemoveObstaclePort(e){this.obstaclePortMap.delete(e)}AddControlPointsToGraph(e,t){this.GetPortSpliceLimitRectangle(e),this.activeAncestors=[];const n={oport:null},i={oport:null},s=this.FindAncestorsAndObstaclePort(e.sourcePort,n),o=this.FindAncestorsAndObstaclePort(e.targetPort,i);if(this.AncestorSets.size>0&&null!=n.oport&&null!=i.oport){const a=fl(o,s),l=fl(s,o);this.ActivateAncestors(l,a,t)}this.AddPortToGraph(e.sourcePort,n.oport),this.AddPortToGraph(e.targetPort,i.oport)}ConnectOobWaypointToEndpointVisibilityAtGraphBoundary(e,t){if(null==e||!e.IsOutOfBounds)return;const n=this.FindVertices(t);let i=e.OutOfBoundsDirectionFromGraph&(oe.North|oe.South);this.ConnectToGraphAtPointsCollinearWithVertices(e,i,n),i=e.OutOfBoundsDirectionFromGraph&(oe.East|oe.West),this.ConnectToGraphAtPointsCollinearWithVertices(e,i,n)}ConnectToGraphAtPointsCollinearWithVertices(e,t,n){if(oe.None==t)return;const i=Ae.OppositeDir(t);for(const s of n){const o=this.InBoundsGraphBoxIntersect(s.point,t),a=this.VisGraph.FindVertex(o);null!=a&&this.TransUtil.ConnectVertexToTargetVertex(e.Vertex,a,i,ze.NormalWeight)}}SetAllAncestorsActive(e,t){if(0==this.AncestorSets.size)return!1;this.ObstacleTree.AdjustSpatialAncestors(),this.ClearActiveAncestors();const s=this.FindAncestorsAndObstaclePort(e.sourcePort,{oport:null}),o=this.FindAncestorsAndObstaclePort(e.targetPort,{oport:null});return this.AncestorSets.size>0&&null!=s&&null!=o&&(this.ActivateAncestors(s,o,t),!0)}SetAllGroupsActive(){this.ClearActiveAncestors();for(const e of this.ObstacleTree.GetAllGroups())e.IsTransparentAncestor=!0,this.activeAncestors.push(e)}FindAncestorsAndObstaclePort(e,t){return t.oport=this.FindObstaclePort(e),0==this.AncestorSets.size?null:null!=t.oport?this.AncestorSets.get(t.oport.Obstacle.InputShape):new Set(Array.from(this.ObstacleTree.Root.AllHitItems(Ne.mkPP(e.Location,e.Location),n=>n.IsGroup)).map(n=>n.InputShape))}ActivateAncestors(e,t,n){for(const i of gl(e,t)){const s=n.get(i);s.IsTransparentAncestor=!0,this.activeAncestors.push(s)}}ClearActiveAncestors(){for(const e of this.activeAncestors)e.IsTransparentAncestor=!1;this.activeAncestors=[]}RemoveControlPointsFromGraph(){this.ClearActiveAncestors(),this.RemoveObstaclePortsFromGraph(),this.RemoveFreePointsFromGraph(),this.TransUtil.RemoveFromGraph(),this.portSpliceLimitRectangle=Ne.mkEmpty()}RemoveObstaclePortsFromGraph(){for(const e of this.obstaclePortsInGraph)e.RemoveFromGraph();this.obstaclePortsInGraph=[]}RemoveFreePointsFromGraph(){for(const e of this.freePointsInGraph)e.RemoveFromGraph();this.freePointsInGraph.clear()}RemoveStaleFreePoints(){if(this.freePointMap.size>this.freePointLocationsUsedByRouteEdges.size){const e=Array.from(this.freePointMap).filter(t=>!this.freePointLocationsUsedByRouteEdges.has(t[0]));for(const t of e)this.freePointMap.deleteP(t[0])}}ClearVisibility(){this.freePointMap.clear();for(const e of this.obstaclePortMap.values())e.ClearVisibility()}BeginRouteEdges(){this.RemoveControlPointsFromGraph(),this.freePointLocationsUsedByRouteEdges.clear()}EndRouteEdges(){this.RemoveStaleFreePoints()}FindObstaclePort(e){let t=this.obstaclePortMap.get(e);if(t){const n={removedPorts:null,addedPorts:null};if(t.Obstacle.GetPortChanges(n)){for(const i of n.addedPorts)this.CreateObstaclePort(t.Obstacle,i);for(const i of n.removedPorts)this.RemoveObstaclePort(i);t=this.obstaclePortMap.get(e)}}return t}AddPortToGraph(e,t){null==t?this.AddFreePointToGraph(e.Location):this.AddObstaclePortToGraph(t)}AddObstaclePortToGraph(e){if(!e.LocationHasChanged||(this.RemoveObstaclePort(e.Port),null!=(e=this.CreateObstaclePort(e.Obstacle,e.Port)))){e.AddToGraph(this.TransUtil,this.RouteToCenterOfObstacles),this.obstaclePortsInGraph.push(e),this.CreateObstaclePortEntrancesIfNeeded(e);for(const t of e.PortEntrances)this.AddObstaclePortEntranceToGraph(t)}}CreateObstaclePortEntrancesIfNeeded(e){e.PortEntrances.length>0||this.CreateObstaclePortEntrancesFromPoints(e)}GetPortVisibilityIntersection(e){const t=this.FindObstaclePort(e.sourcePort),n=this.FindObstaclePort(e.targetPort);if(null==t||null==n||t.Obstacle.IsInConvexHull||n.Obstacle.IsInConvexHull||(this.CreateObstaclePortEntrancesIfNeeded(t),this.CreateObstaclePortEntrancesIfNeeded(n),!t.VisibilityRectangle.intersects(n.VisibilityRectangle)))return null;for(const i of t.PortEntrances)if(i.WantVisibilityIntersection)for(const s of n.PortEntrances){if(!s.WantVisibilityIntersection)continue;const o=i.IsVertical==s.IsVertical?vu.GetPathPointsFromOverlappingCollinearVisibility(i,s):vu.GetPathPointsFromIntersectingVisibility(i,s);if(null!=o)return o}return null}static GetPathPointsFromOverlappingCollinearVisibility(e,t){return!Re.IntervalsAreSame(e.MaxVisibilitySegment.start,e.MaxVisibilitySegment.end,t.MaxVisibilitySegment.end,t.MaxVisibilitySegment.start)||e.HasGroupCrossings||t.HasGroupCrossings||x.closeDistEps(e.UnpaddedBorderIntersect,t.UnpaddedBorderIntersect)?null:[e.UnpaddedBorderIntersect,t.UnpaddedBorderIntersect]}static GetPathPointsFromIntersectingVisibility(e,t){const n=Re.SegmentsIntersectLL(e.MaxVisibilitySegment,t.MaxVisibilitySegment);return!n||e.HasGroupCrossingBeforePoint(n)||t.HasGroupCrossingBeforePoint(n)?null:[e.UnpaddedBorderIntersect,n,t.UnpaddedBorderIntersect]}CreateObstaclePortEntrancesFromPoints(e){const t=this.graphGenerator.ObstacleTree.GraphBox,n=Ne.mkPP(q.RoundPoint(e.PortCurve.boundingBox.leftBottom),q.RoundPoint(e.PortCurve.boundingBox.rightTop)),i=q.RoundPoint(e.PortLocation);let s=!1;const o={xx0:null,xx1:null};if(!de.Equal(i.y,n.top)&&!de.Equal(i.y,n.bottom)){s=!0;const a=new me(t.left,i.y,t.right,i.y);this.GetBorderIntersections(i,a,e.PortCurve,o);let l=new x(Math.min(o.xx0.x,o.xx1.x),i.y);l.x<n.left&&(l=new x(n.left,l.y));let c=new x(Math.max(o.xx0.x,o.xx1.x),i.y);c.x>n.right&&(c=new x(n.right,c.y)),this.CreatePortEntrancesAtBorderIntersections(n,e,i,l,c)}if(!de.Equal(i.x,n.left)&&!de.Equal(i.x,n.right)){s=!0;const a=new me(i.x,t.bottom,i.x,t.top);this.GetBorderIntersections(i,a,e.PortCurve,o);let l=new x(i.x,Math.min(o.xx0.y,o.xx1.y));l.y<t.bottom&&(l=new x(l.x,t.bottom));let c=new x(i.x,Math.max(o.xx0.y,o.xx1.y));c.y>t.top&&(c=new x(c.x,t.top)),this.CreatePortEntrancesAtBorderIntersections(n,e,i,l,c)}s||this.CreateEntrancesForCornerPort(n,e,i)}GetBorderIntersections(e,t,n,i){const s=ee.getAllIntersections(t,n,!0);i.xx0=q.RoundPoint(s[0].x),i.xx1=q.RoundPoint(s[1].x)}CreatePortEntrancesAtBorderIntersections(e,t,n,i,s){const o=de.GetDirections(i,s);de.EqualPP(i,n)||this.CreatePortEntrance(e,t,s,o),de.EqualPP(s,n)||this.CreatePortEntrance(e,t,i,Ae.OppositeDir(o))}static GetDerivative(e,t){const n=e.PortCurve.closestParameter(t);let i=e.PortCurve.derivative(n);return ti.CurveIsClockwise(e.PortCurve,e.PortCurve.value((e.PortCurve.parStart+e.PortCurve.parEnd)/2))||(i=i.mul(-1)),i}CreatePortEntrance(e,t,n,i){t.CreatePortEntrance(n,i,this.ObstacleTree);const s=Gt.GetInstance(i);let o=Re.GetRectangleBound(e,i)-s.Coord(n);if(o<0&&(o=-o),o>q.intersectionEpsilon){const a=Ae.VectorDirection(vu.GetDerivative(t,n));let l;Ae.OppositeDir(i),oe.None!=(i&a)&&(l=Ae.OppositeDir(l)),t.CreatePortEntrance(n,l,this.ObstacleTree)}}CreateEntrancesForCornerPort(e,t,n){let i=oe.North;de.EqualPP(n,e.leftBottom)?i=oe.South:de.EqualPP(n,e.leftTop)?i=oe.West:de.EqualPP(n,e.rightTop)?i=oe.North:de.EqualPP(n,e.rightBottom)&&(i=oe.East),t.CreatePortEntrance(n,i,this.ObstacleTree),t.CreatePortEntrance(n,Ae.RotateRight(i),this.ObstacleTree)}AddObstaclePortEntranceToGraph(e){const t=this.VisGraph.FindVertex(e.VisibilityBorderIntersect);if(t)return void e.ExtendEdgeChain(this.TransUtil,t,t,this.portSpliceLimitRectangle,this.RouteToCenterOfObstacles);const n={targetVertex:null};null!=this.FindorCreateNearestPerpEdgePPDNT(e.MaxVisibilitySegment.end,e.VisibilityBorderIntersect,e.OutwardDirection,e.IsOverlapped?ze.OverlappedWeight:ze.NormalWeight,n)&&e.AddToAdjacentVertex(this.TransUtil,n.targetVertex,this.portSpliceLimitRectangle,this.RouteToCenterOfObstacles)}InBoundsGraphBoxIntersect(e,t){return Re.RectangleBorderIntersect(this.graphGenerator.ObstacleTree.GraphBox,e,t)}FindorCreateNearestPerpEdgePPDN(e,t,n,i){return this.FindorCreateNearestPerpEdgePPDNT(e,t,n,i,{targetVertex:null})}FindorCreateNearestPerpEdgePPDNT(e,t,n,i,s){const o=Re.SortAscending(e,t),a=o[0],l=o[1],c=Re.IsVerticalD(n)?this.HScanSegments:this.VScanSegments,u=Re.IsAscending(n)?c.FindLowestIntersector(a,l):c.FindHighestIntersector(a,l);if(null==u)return s.targetVertex=null,null;const S=Re.SegmentIntersectionSP(u,a);return this.FindOrCreateNearestPerpEdgeFromNearestPerpSegment(Re.IsAscending(n)?a:l,u,S,i,s)}FindOrCreateNearestPerpEdgeFromNearestPerpSegment(e,t,n,i,s){var o;const a={segsegVertex:this.VisGraph.FindVertex(n),targetVertex:null};if(null==a.segsegVertex){const S=this.FindOrCreateSegmentIntersectionVertexAndAssociatedEdge(e,n,t,i,a);if(null!=S)return S}else if(de.EqualPP(e,n))return s.targetVertex=a.segsegVertex,this.TransUtil.FindNextEdge(s.targetVertex,Ae.OppositeDir(t.ScanDirection.Dir));const l=de.GetDirections(n,e);let c=de.GetDirections(a.segsegVertex.point,e);if(l==c){const S={bracketTarget:null,bracketSource:null};return kr.FindBracketingVertices(a.segsegVertex,e,l,S),null!==(o=this.TransUtil.FindNextEdge(S.bracketSource,Ae.RotateLeft(l)))&&void 0!==o?o:this.TransUtil.FindNextEdge(S.bracketSource,Ae.RotateRight(l))}c&=~l;const u=this.TransUtil.FindNearestPerpendicularOrContainingEdge(a.segsegVertex,c,e);return null==u?(s.targetVertex=this.TransUtil.AddVertex(n),this.TransUtil.FindOrAddEdge(s.targetVertex,t.HighestVisibilityVertex,t.Weight)):(a.segsegVertex=Re.GetEdgeEnd(u,Ae.OppositeDir(c)),n=Re.SegmentIntersectionPPP(e,n,a.segsegVertex.point),de.EqualPP(a.segsegVertex.point,n)?(s.targetVertex=a.segsegVertex,this.TransUtil.FindNextEdge(a.segsegVertex,c)):(s.targetVertex=this.TransUtil.FindOrAddVertex(n),this.TransUtil.FindOrAddEdge(a.segsegVertex,s.targetVertex,i)))}FindOrCreateSegmentIntersectionVertexAndAssociatedEdge(e,t,n,i,s){const a=(n.IsVertical?this.HScanSegments:this.VScanSegments).FindHighestIntersector(n.Start,t);if(null==a)return s.segsegVertex=null,s.targetVertex=this.TransUtil.AddVertex(t),this.TransUtil.FindOrAddEdge(s.targetVertex,n.LowestVisibilityVertex,n.Weight);const l=Re.SegmentsIntersection(n,a);if(s.segsegVertex=this.VisGraph.FindVertex(l),!s.segsegVertex){s.segsegVertex=this.TransUtil.AddVertex(l);const c=this.AddEdgeToClosestSegmentEnd(n,s.segsegVertex,n.Weight);if(this.AddEdgeToClosestSegmentEnd(a,s.segsegVertex,a.Weight),de.EqualPP(s.segsegVertex.point,t))return s.targetVertex=s.segsegVertex,c}return de.EqualPP(e,t)?(s.targetVertex=this.TransUtil.FindOrAddVertex(t),this.TransUtil.FindOrAddEdge(s.segsegVertex,s.targetVertex,i)):(s.targetVertex=null,null)}AddEdgeToClosestSegmentEnd(e,t,n){return de.IsPureLower(e.HighestVisibilityVertex.point,t.point)?this.TransUtil.FindOrAddEdge(e.HighestVisibilityVertex,t,n):de.IsPureLower(t.point,e.LowestVisibilityVertex.point)?this.TransUtil.FindOrAddEdge(t,e.LowestVisibilityVertex,n):this.TransUtil.FindOrAddEdgeVV(e.LowestVisibilityVertex,t)}GetPortSpliceLimitRectangle(e){this.LimitPortVisibilitySpliceToEndpointBoundingBox?(this.portSpliceLimitRectangle=this.GetPortRectangle(e.sourcePort),this.portSpliceLimitRectangle.addRecSelf(this.GetPortRectangle(e.targetPort))):this.portSpliceLimitRectangle=this.graphGenerator.ObstacleTree.GraphBox}GetPortRectangle(e){const t=this.obstaclePortMap.get(e);return t?t.Obstacle.VisibilityBoundingBox.clone():Ne.mkOnPoints([q.RoundPoint(e.Location)])}AddToLimitRectangle(e){this.graphGenerator.IsInBoundsP(e)&&this.portSpliceLimitRectangle.add(e)}FindOrCreateFreePoint(e){let t=this.freePointMap.get(e);return t?t.GetVertex(this.TransUtil,e):(t=new u5(this.TransUtil,e),this.freePointMap.set(e,t)),this.freePointsInGraph.add(t),this.freePointLocationsUsedByRouteEdges.add(e),t}AddFreePointToGraph(e){e=q.RoundPoint(e);const t=this.VisGraph.FindVertex(e),n=this.FindOrCreateFreePoint(e);if(null!=t)return n;if(!this.graphGenerator.IsInBoundsP(e))return this.CreateOutOfBoundsFreePoint(n),n;n.IsOverlapped=this.ObstacleTree.PointIsInsideAnObstacle(n.Point,this.HScanSegments.ScanDirection),this.VScanSegments.FindSegmentContainingPoint(e,!0);let o=oe.South;for(let a=0;a<4;a++)this.ConnectFreePointToLateralEdge(n,o),o=Ae.RotateLeft(o);return n}CreateOutOfBoundsFreePoint(e){const t=e.Point,n=this.graphGenerator.MakeInBoundsLocation(t),i=de.GetDirections(n,t);if(e.OutOfBoundsDirectionFromGraph=i,!de.IsPureDirectionD(i))return void e.AddOobEdgesFromGraphCorner(this.TransUtil,n);let s=this.VisGraph.FindVertex(n);const o=Ae.OppositeDir(i);if(null!=s)e.AddToAdjacentVertex(this.TransUtil,s,o,this.portSpliceLimitRectangle);else{const c=this.FindorCreateNearestPerpEdgePPDN(t,n,i,ze.NormalWeight);null!=c&&(s=e.AddEdgeToAdjacentEdge(this.TransUtil,c,o,this.portSpliceLimitRectangle))}const a=Re.FindAdjacentVertex(s,Ae.RotateLeft(o));null!=a&&this.TransUtil.ConnectVertexToTargetVertex(e.Vertex,a,o,ze.NormalWeight);const l=Re.FindAdjacentVertex(s,Ae.RotateRight(o));null!=l&&this.TransUtil.ConnectVertexToTargetVertex(e.Vertex,l,o,ze.NormalWeight)}ConnectFreePointToLateralEdge(e,t){const n=e.IsOverlapped?this.InBoundsGraphBoxIntersect(e.Point,t):e.MaxVisibilityInDirectionForNonOverlappedFreePoint(t,this.TransUtil),i=this.FindorCreateNearestPerpEdgePPDN(n,e.Point,t,e.InitialWeight);null!=i&&e.AddEdgeToAdjacentEdge(this.TransUtil,i,t,this.portSpliceLimitRectangle)}}let p5=(()=>{class r extends Zt{constructor(t,n,i,s,o){super(null),this.Padding=0,this.CornerFitRadius=0,this.BendPenaltyAsAPercentageOfDistance=0,this.UseObstacleRectangles=!1,this.ShapeToObstacleMap=new Map,this.EdgesToRoute=new Array,this.removeStaircases=!0,this.selfEdges=new Array,this.Padding=n,this.CornerFitRadius=i,this.BendPenaltyAsAPercentageOfDistance=yt.DefaultBendPenaltyAsAPercentageOfDistance,this.GraphGenerator=new Br,this.UseObstacleRectangles=o,this.PortManager=new vu(this.GraphGenerator),this.AddShapes(t)}get RouteToCenterOfObstacles(){return this.PortManager.RouteToCenterOfObstacles}set RouteToCenterOfObstacles(t){this.PortManager.RouteToCenterOfObstacles=t}get LimitPortVisibilitySpliceToEndpointBoundingBox(){return this.PortManager.LimitPortVisibilitySpliceToEndpointBoundingBox}set LimitPortVisibilitySpliceToEndpointBoundingBox(t){this.PortManager.LimitPortVisibilitySpliceToEndpointBoundingBox=t}AddEdgeGeometryToRoute(t){x.closeDistEps(q.RoundPoint(t.sourcePort.Location),q.RoundPoint(t.targetPort.Location))?this.selfEdges.push(t):this.EdgesToRoute.push(t)}get EdgeGeometriesToRoute(){return this.EdgesToRoute}RemoveAllEdgeGeometriesToRoute(){this.EdgesToRoute=[]}get UseSparseVisibilityGraph(){return this.GraphGenerator instanceof Br}get Obstacles(){return Array.from(this.ShapeToObstacleMap.values()).map(t=>t.InputShape)}get PaddedObstacles(){return Array.from(this.ShapeToObstacleMap.values()).map(t=>t.PaddedPolyline)}AddObstacles(t){this.AddShapes(t),this.RebuildTreeAndGraph()}AddShapes(t){for(const n of t)this.AddObstacleWithoutRebuild(n)}AddObstacle(t){this.AddObstacleWithoutRebuild(t),this.RebuildTreeAndGraph()}UpdateObstacles(t){for(const n of t)this.UpdateObstacleWithoutRebuild(n);this.RebuildTreeAndGraph()}UpdateObstacle(t){this.UpdateObstacleWithoutRebuild(t),this.RebuildTreeAndGraph()}RemoveObstacles(t){for(const n of t)this.RemoveObstacleWithoutRebuild(n);this.RebuildTreeAndGraph()}RemoveObstacle(t){this.RemoveObstacleWithoutRebuild(t),this.RebuildTreeAndGraph()}AddObstacleWithoutRebuild(t){if(null==t.BoundaryCurve)throw new Error("Shape must have a BoundaryCurve");this.CreatePaddedObstacle(t)}UpdateObstacleWithoutRebuild(t){if(null==t.BoundaryCurve)throw new Error("Shape must have a BoundaryCurve");this.PortManager.RemoveObstaclePorts(this.ShapeToObstacleMap.get(t)),this.CreatePaddedObstacle(t)}CreatePaddedObstacle(t){const n=new ns(t,this.UseObstacleRectangles,this.Padding);this.ShapeToObstacleMap.set(t,n),this.PortManager.CreateObstaclePorts(n)}RemoveObstacleWithoutRebuild(t){const n=this.ShapeToObstacleMap.get(t);this.ShapeToObstacleMap.delete(t),this.PortManager.RemoveObstaclePorts(n)}RemoveAllObstacles(){this.InternalClear(!1)}RebuildTreeAndGraph(){const t=null!=this.ObsTree.Root,n=null!=this.GraphGenerator.VisibilityGraph;this.InternalClear(!0),t&&this.GenerateObstacleTree(),n&&this.GenerateVisibilityGraph()}get VisibilityGraph(){return this.GenerateVisibilityGraph(),this.GraphGenerator.VisibilityGraph}Clear(){this.InternalClear(!1)}static constructorEmpty(){return r.constructorC(null)}static constructorC(t){return new r([],r.DefaultPadding,r.DefaultCornerFitRadius,!1,!1)}static constructorI(t){return new r(t,r.DefaultPadding,r.DefaultCornerFitRadius,!1,!1)}static constructorINNB(t,n,i,s){return new r(t,n,i,s,!1)}static constructorGNANB(t,n,i,s,o){return this.constructorGNANBB(t,n,i,s,o,!1)}static constructorGNANBB(t,n,i,s,o,a){const l=new r(_r.GetShapes(t),i,s,o,a);if(null==n)for(const c of t.edges())l.AddEdgeGeometryToRoute(c);else for(const c of n)l.AddEdgeGeometryToRoute(c);return l}run(){this.GenerateVisibilityGraph(),this.GeneratePaths()}GeneratePaths(){const t=this.EdgesToRoute.map(n=>new a5(n));this.FillEdgePathsWithShortestPaths(t),this.NudgePaths(t),this.RouteSelfEdges(),this.FinaliseEdgeGeometries()}RouteSelfEdges(){for(const t of this.selfEdges){const n={smoothedPolyline:null};t.curve=io.RouteSelfEdge(t.sourcePort.Curve,Math.max(this.Padding,2*t.GetMaxArrowheadLength()),n)}}FillEdgePathsWithShortestPaths(t){this.PortManager.BeginRouteEdges();const n=new yu(this.BendPenaltyAsAPercentageOfDistance);for(const i of t)this.AddControlPointsAndGeneratePath(n,i);this.PortManager.EndRouteEdges()}AddControlPointsAndGeneratePath(t,n){const i=this.PortManager.GetPortVisibilityIntersection(n.GeomEdge);null==i?this.SpliceVisibilityAndGeneratePath(t,n):this.GeneratePathThroughVisibilityIntersection(n,i)}GeneratePathThroughVisibilityIntersection(t,n){t.PathPoints=n}SpliceVisibilityAndGeneratePath(t,n){this.PortManager.AddControlPointsToGraph(n.GeomEdge,this.ShapeToObstacleMap),this.GeneratePath(t,n,!1)||this.RetryPathsWithAdditionalGroupsEnabled(t,n),this.PortManager.RemoveControlPointsFromGraph()}GeneratePath(t,n,i){const s=this.PortManager.FindVertices(n.GeomEdge.sourcePort),o=this.PortManager.FindVertices(n.GeomEdge.targetPort);return r.GetSingleStagePath(n,t,s,o,i)}static GetSingleStagePath(t,n,i,s,o){return t.PathPoints=n.GetPath(i,s),o&&r.EnsureNonNullPath(t),null!=t.PathPoints&&t.PathPoints.length>0}static EnsureNonNullPath(t){null==t.PathPoints&&(t.PathPoints=de.IsPureDirection(t.GeomEdge.sourcePort.Location,t.GeomEdge.targetPort.Location)?[t.GeomEdge.sourcePort.Location,t.GeomEdge.targetPort.Location]:[t.GeomEdge.sourcePort.Location,new x(t.GeomEdge.sourcePort.Location.x,t.GeomEdge.targetPort.Location.y),t.GeomEdge.targetPort.Location])}RetryPathsWithAdditionalGroupsEnabled(t,n){(!this.PortManager.SetAllAncestorsActive(n.GeomEdge,this.ShapeToObstacleMap)||!this.GeneratePath(t,n,!1))&&(this.PortManager.SetAllGroupsActive(),this.GeneratePath(t,n,!0))}NudgePaths(t){const n=this.ObsTree.SpatialAncestorsAdjusted?xt.GetAncestorSetsMap(this.Obstacles):this.AncestorsSets;Nt.NudgePaths(t,this.CornerFitRadius,this.PaddedObstacles,n,this.RemoveStaircases)}get RemoveStaircases(){return this.removeStaircases}set RemoveStaircases(t){this.removeStaircases=t}FinaliseEdgeGeometries(){for(const t of this.EdgesToRoute.concat(this.selfEdges))null!=t.curve&&(t.curve instanceof Me&&(t.curve=r.FitArcsIntoCorners(this.CornerFitRadius,Array.from(t.curve))),r.CalculateArrowheads(t))}CreateVisibilityGraph(){this.GraphGenerator.Clear(),this.InitObstacleTree(),this.GraphGenerator.GenerateVisibilityGraph()}static CalculateArrowheads(t){ro.trimSplineAndCalculateArrowheadsII(t,t.sourcePort.Curve,t.targetPort.Curve,t.curve,!0)}get ObsTree(){return this.GraphGenerator.ObstacleTree}GenerateObstacleTree(){if(null==this.Obstacles||0==this.Obstacles.length)throw new Error("No obstacles have been added");null==this.ObsTree.Root&&this.InitObstacleTree()}InitObstacleTree(){this.AncestorsSets=xt.GetAncestorSetsMap(this.Obstacles),this.ObsTree.Init(this.ShapeToObstacleMap.values(),this.AncestorsSets,this.ShapeToObstacleMap)}InternalClear(t){this.GraphGenerator.Clear(),this.ClearShortestPaths(),t?this.PortManager.ClearVisibility():(this.PortManager.Clear(),this.ShapeToObstacleMap.clear(),this.EdgesToRoute=[])}ClearShortestPaths(){for(const t of this.EdgesToRoute)t.curve=null}GenerateVisibilityGraph(){if(null==this.Obstacles||0==this.Obstacles.length)throw new Error("No obstacles have been set");null==this.GraphGenerator.VisibilityGraph&&this.CreateVisibilityGraph()}static FitArcsIntoCorners(t,n){const i=r.GetFittedArcSegs(t,n),s=new ee;let o=null;for(const a of i){const l=r.EllipseIsAlmostLineSegment(a);null!=o?l?ee.continueWithLineSegmentP(s,r.CornerPoint(a)):(ee.continueWithLineSegmentP(s,a.start),s.addSegment(a)):l?ee.addLineSegment(s,n[0],r.CornerPoint(a)):(ee.addLineSegment(s,n[0],a.start),s.addSegment(a)),o=a}return s.segs.length>0?ee.continueWithLineSegmentP(s,n[n.length-1]):ee.addLineSegment(s,n[0],n[n.length-1]),s}static CornerPoint(t){return t.center.add(t.aAxis.add(t.bAxis))}static EllipseIsAlmostLineSegment(t){return t.aAxis.lengthSquared<1e-4||t.aAxis.lengthSquared<1e-4}static*GetFittedArcSegs(t,n){let i=n[1].sub(n[0]),s=i.normalize(),o=Math.min(t,i.length/2);for(let a=1;a<n.length-1;a++){i=n[a+1].sub(n[a]);const l=i.length;if(l<q.intersectionEpsilon){yield new mt(0,0,new x(0,0),new x(0,0),n[a]);continue}const c=i.div(l);Math.abs(c.dot(s))>.9&&(yield new mt(0,0,new x(0,0),new x(0,0),n[a]));const u=Math.min(t,i.length/2),S=c.mul(-u),b=s.mul(o);yield new mt(0,Math.PI/2,S,b,n[a].sub(b.add(S))),s=c,o=u}}}return r.DefaultPadding=1,r.DefaultCornerFitRadius=3,r})();class tP extends Zt{constructor(e,t,n){super(null),this.graph=e,this.source=t,this.length=n}get Result(){return this.result}run(){const e=new ho((i,s)=>i-s),t=new Map;for(const i of this.graph.shallowNodes()){const s=i==this.source?0:Number.POSITIVE_INFINITY;e.Enqueue(i,s),t.set(i,s)}for(;e.count>0;){const i={priority:0},s=e.DequeueAndGetPriority(i);t.set(s,i.priority);const o=t.get(s);for(const a of s.inEdges()){const l=a.source,c=o+this.length(a);t.get(l)>c&&(t.set(l,c),e.DecreasePriority(l,c))}for(const a of s.outEdges()){const l=a.target,c=o+this.length(a);t.get(l)>c&&(t.set(l,c),e.DecreasePriority(l,c))}}this.result=new Array(this.graph.shallowNodeCount);let n=0;for(const i of this.graph.shallowNodes()){const s=t.get(i);this.result[n++]=null!=s?s:Number.POSITIVE_INFINITY}}}class hy extends Zt{constructor(e,t){super(null),this.graph=e,this.length=t}get Result(){return this.result}set Result(e){this.result=e}run(){this.result=new Array(this.graph.shallowNodeCount);let e=0;for(const t of this.graph.shallowNodes()){const n=new tP(this.graph,t,this.length);n.run(),this.Result[e++]=n.Result}}static Stress(e,t){let n=0;if(0==e.edgeCount)return n;const i=new hy(e,t);i.run();const s=i.Result;let o=0;for(const l of e.edges())o+=t(l);o/=e.edgeCount;let a=0;for(const l of e.shallowNodes()){let c=0;for(const u of e.shallowNodes()){if(a!=c){const S=l.center.sub(u.center).length,b=o*s[a][c],L=b-S;n+=L*L/(b*b)}c++}a++}return n}}class m5 extends Zt{constructor(e,t,n){super(null),this.graph=e,this.pivotArray=t,this.length=n}get Result(){return this.result}run(){this.result=new Array(this.pivotArray.length);const e=Array.from(this.graph.shallowNodes()),t=new Array(this.graph.shallowNodeCount).fill(Number.POSITIVE_INFINITY);let n=e[0];this.pivotArray[0]=0;for(let i=0;;i++){const s=new tP(this.graph,n,this.length);if(s.run(),this.Result[i]=s.Result,!(i+1<this.pivotArray.length))break;{let o=0;for(let a=0;a<this.Result[i].length;a++)t[a]=Math.min(t[a],this.Result[i][a]),t[a]>t[o]&&(o=a);n=e[o],this.pivotArray[i+1]=o}}}}class Ct{static DoubleCenter(e){const t=new Array(e.length).fill(0),n=new Array(e[0].length).fill(0);let i=0;for(let s=0;s<e.length;s++)for(let o=0;o<e[0].length;o++)t[s]+=e[s][o],n[o]+=e[s][o],i+=e[s][o];for(let s=0;s<e.length;s++)t[s]/=e.length;for(let s=0;s<e[0].length;s++)n[s]/=e[0].length;i/=e.length,i/=e[0].length;for(let s=0;s<e.length;s++)for(let o=0;o<e[0].length;o++)e[s][o]-=t[s]+n[o]-i}static SquareEntries(e){for(let t=0;t<e.length;t++)for(let n=0;n<e[0].length;n++)e[t][n]=Math.pow(e[t][n],2)}static Multiply(e,t){for(let n=0;n<e.length;n++)for(let i=0;i<e[0].length;i++)e[n][i]*=t}static MultiplyX(e,t){if(e[0].length!=t.length)return null;const n=new Array(t.length).fill(0);for(let i=0;i<e.length;i++)for(let s=0;s<e[0].length;s++)n[i]+=e[i][s]*t[s];return n}static Norm(e){let t=0;for(let n=0;n<e.length;n++)t+=Math.pow(e[n],2);return Math.sqrt(t)}static Normalize(e){const t=Ct.Norm(e);if(t<=0)return 0;for(let n=0;n<e.length;n++)e[n]/=t;return t}static RandomUnitLengthVector(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=jE();return Ct.Normalize(t),t}static SpectralDecomposition(e,t){Ct.SpectralDecompositionIE(e,t,30,1e-6)}static SpectralDecompositionIE(e,t,n,i){const s=e[0].length;t.u1=Ct.RandomUnitLengthVector(s),t.lambda1=0,t.u2=Ct.RandomUnitLengthVector(s),t.lambda2=0;let o=0;const a=1-i;for(let l=0;l<n&&o<a;l++){const c=Ct.MultiplyX(e,t.u1),u=Ct.MultiplyX(e,t.u2);t.lambda1=Ct.Normalize(c),t.lambda2=Ct.Normalize(u),Ct.MakeOrthogonal(u,c),Ct.Normalize(u),o=Math.min(Ct.DotProduct(t.u1,c),Ct.DotProduct(t.u2,u)),t.u1=c,t.u2=u}}static DotProduct(e,t){if(e.length!=t.length)return 0;let n=0;for(let i=0;i<e.length;i++)n+=e[i]*t[i];return n}static MakeOrthogonal(e,t){if(e.length!=t.length)return;const n=Ct.DotProduct(e,t)/Ct.DotProduct(t,t);for(let i=0;i<e.length;i++)e[i]-=n*t[i]}static ClassicalScaling(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=e[i].slice();Ct.SquareEntries(n),Ct.DoubleCenter(n),Ct.Multiply(n,-.5),Ct.SpectralDecomposition(n,t),t.lambda1=Math.sqrt(Math.abs(t.lambda1)),t.lambda2=Math.sqrt(Math.abs(t.lambda2));for(let i=0;i<t.u1.length;i++)t.u1[i]*=t.lambda1,t.u2[i]*=t.lambda2}static DistanceScalingSubset(e,t,n,i,s){const o=t.length,a=e.length,l=new Array(a);for(let u=0;u<a;u++)for(let S=0;S<o;S++)0==e[u][S]&&(l[u]=S);const c=new Array(a).fill(0);for(let u=0;u<a;u++)for(let S=0;S<o;S++)l[u]!=S&&(c[u]+=i[u][S]);for(let u=0;u<s;u++)for(let S=0;S<a;S++){let b=0,L=0;for(let F=0;F<o;F++)if(S!=F){let G=Math.sqrt(Math.pow(t[l[S]]-t[F],2)+Math.pow(n[l[S]]-n[F],2));G>0&&(G=1/G),b+=i[S][F]*(t[F]+e[S][F]*(t[l[S]]-t[F])*G),L+=i[S][F]*(n[F]+e[S][F]*(n[l[S]]-n[F])*G)}t[l[S]]=b/c[S],n[l[S]]=L/c[S]}}static DistanceScaling(e,t,n,i,s){const o=t.length,a=new Array(o).fill(0);for(let l=0;l<o;l++)for(let c=0;c<o;c++)l!=c&&(a[l]+=i[l][c]);for(let l=0;l<s;l++)for(let c=0;c<o;c++){let u=0,S=0;for(let b=0;b<o;b++)if(c!=b){let L=Math.sqrt(Math.pow(t[c]-t[b],2)+Math.pow(n[c]-n[b],2));L>0&&(L=1/L),u+=i[c][b]*(t[b]+e[c][b]*(t[c]-t[b])*L),S+=i[c][b]*(n[b]+e[c][b]*(n[c]-n[b])*L)}t[c]=u/a[c],n[c]=S/a[c]}}static ExponentialWeightMatrix(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++){n[i]=new Array(e[i].length).fill(0);for(let s=0;s<e[i].length;s++)e[i][s]>0&&(n[i][s]=Math.pow(e[i][s],t))}return n}static EuclideanDistanceMatrix(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++){n[i]=new Array(e.length);for(let s=0;s<e.length;s++)n[i][s]=Math.sqrt(Math.pow(e[i]-e[s],2)+Math.pow(t[i]-t[s],2))}return n}static LandmarkClassicalScaling(e,t,n){const i=new Array(e.length);for(let a=0;a<e.length;a++){i[a]=new Array(e.length);for(let l=0;l<e.length;l++)i[a][l]=e[a][n[l]]}Ct.SquareEntries(i);const s=new Array(e.length).fill(0);for(let a=0;a<e.length;a++){for(let l=0;l<e.length;l++)s[a]+=i[a][l];s[a]/=e.length}Ct.DoubleCenter(i),Ct.Multiply(i,-.5);const o={u1:new Array,u2:new Array,lambda1:0,lambda2:0};Ct.SpectralDecomposition(i,o),o.lambda1=Math.sqrt(Math.abs(o.lambda1)),o.lambda2=Math.sqrt(Math.abs(o.lambda2)),t.x=new Array(e[0].length).fill(0),t.y=new Array(e[0].length).fill(0);for(let a=0;a<t.x.length;a++)for(let l=0;l<i.length;l++){const c=(Math.pow(e[l][a],2)-s[l])/2;t.x[a]-=o.u1[l]*c,t.y[a]-=o.u2[l]*c}}}class y5{constructor(e,t){this.Constrained=!1,this.Capacity=1e6,1==nn.AbovePP(e.point,t.point)?(this.upperSite=e,this.lowerSite=t):(this.lowerSite=e,this.upperSite=t),this.upperSite.AddEdgeToSite(this)}get CcwTriangle(){return this.ccwTriangle}set CcwTriangle(e){this.ccwTriangle=e}get CwTriangle(){return this.cwTriangle}set CwTriangle(e){this.cwTriangle=e}GetOtherTriangle_c(e){return this.cwTriangle.Contains(e)?this.ccwTriangle:this.cwTriangle}IsAdjacent(e){return e==this.upperSite||e==this.lowerSite}GetOtherTriangle_T(e){return this.ccwTriangle==e?this.cwTriangle:this.ccwTriangle}toString(){return In.String.Format("({0},{1})",this.upperSite,this.lowerSite)}OtherSite(e){return this.upperSite==e?this.lowerSite:this.upperSite}}class Su{constructor(e){this.Owner=null,this.InEdges=new Array,this.point=e}static mkSO(e,t){const n=new Su(e);return n.Owner=t,n}AddEdgeToSite(e){null==this.Edges&&(this.Edges=new Array),this.Edges.push(e)}EdgeBetweenUpperSiteAndLowerSite(e){if(null!=this.Edges)for(const t of this.Edges)if(t.lowerSite==e)return t;return null}AddInEdge(e){null==this.InEdges&&(this.InEdges=new Array),this.InEdges.push(e)}*Triangles(){let e;if(null!=this.Edges&&this.Edges.length>0)e=this.Edges[0];else{if(!(null!=this.InEdges&&this.InEdges.length>0))return;e=this.InEdges[0]}let t=e;do{const n=t.upperSite==this?t.CcwTriangle:t.CwTriangle;if(null==n){t=null;break}yield n,t=n.TriEdges.getItem(n.TriEdges.index(t)+2)}while(t!=e);if(t!=e)for(t=e;;){const n=t.upperSite==this?t.CwTriangle:t.CcwTriangle;if(null==n)break;yield n,t=n.TriEdges.getItem(n.TriEdges.index(t)+1)}}toString(){return this.point.toString()}}class Ol{constructor(e,t){this.RightSite=t.upperSite==e?t.lowerSite:t.upperSite,this.LeftSite=e,this.Edge=t}get x(){return this.LeftSite.point.x}toString(){return"("+this.LeftSite.toString()+", "+this.Edge.toString()+","+this.RightSite.toString()+")"}}class dy{has(e){return e==this.item0||e==this.item1||e==this.item2}index(e){return e==this.item0?0:e==this.item1?1:e==this.item2?2:-1}getItem(e){switch(e){case 0:case 3:case-3:return this.item0;case 1:case 4:case-2:return this.item1;case 2:case 5:case-1:return this.item2;default:throw new Error}}setItem(e,t){switch(e){case 0:case 3:case-3:this.item0=t;break;case 1:case 4:case-2:this.item1=t;break;case 2:case 5:case-1:this.item2=t;break;default:throw new Error}}[Symbol.iterator](){return this.GetEnumerator()}*GetEnumerator(){yield this.item0,yield this.item1,yield this.item2}}class ni{constructor(){this.TriEdges=new dy,this.Sites=new dy}static mkSSSD(e,t,n,i){const s=x.getTriangleOrientation(e.point,t.point,n.point),o=new ni;switch(s){case Ie.Counterclockwise:o.FillCcwTriangle(e,t,n,i);break;case Ie.Clockwise:o.FillCcwTriangle(e,n,t,i);break;default:throw new Error}return o}static mkSED(e,t,n){const i=new ni;switch(x.getTriangleOrientation(t.upperSite.point,t.lowerSite.point,e.point)){case Ie.Counterclockwise:t.CcwTriangle=i,i.Sites.setItem(0,t.upperSite),i.Sites.setItem(1,t.lowerSite);break;case Ie.Clockwise:t.CwTriangle=i,i.Sites.setItem(0,t.lowerSite),i.Sites.setItem(1,t.upperSite);break;default:throw new Error}return i.TriEdges.setItem(0,t),i.Sites.setItem(2,e),i.CreateEdge(1,n),i.CreateEdge(2,n),i}static mkSSSEE(e,t,n,i,s,o){const a=ni.mkSSSD(e,t,n,o);return a.TriEdges.setItem(0,i),a.TriEdges.setItem(1,s),a.BindEdgeToTriangle(e,i),a.BindEdgeToTriangle(t,s),a.CreateEdge(2,o),a}BindEdgeToTriangle(e,t){e==t.upperSite?t.CcwTriangle=this:t.CwTriangle=this}FillCcwTriangle(e,t,n,i){this.Sites.setItem(0,e),this.Sites.setItem(1,t),this.Sites.setItem(2,n);for(let s=0;s<3;s++)this.CreateEdge(s,i)}CreateEdge(e,t){const n=this.Sites.getItem(e),s=t(n,this.Sites.getItem(e+1));this.TriEdges.setItem(e,s),this.BindEdgeToTriangle(n,s)}Contains(e){return this.Sites.has(e)}OppositeEdge(e){const t=this.Sites.index(e);return this.TriEdges.getItem(t+1)}OppositeSite(e){const t=this.TriEdges.index(e);return this.Sites.getItem(t+2)}BoundingBox(){const e=Ne.mkPP(this.Sites.getItem(0).point,this.Sites.getItem(1).point);return e.add(this.Sites.getItem(2).point),e}static mkSSSEED(e,t,n,i,s,o){const a=new ni;return a.Sites.setItem(0,e),a.Sites.setItem(1,t),a.Sites.setItem(2,n),a.TriEdges.setItem(0,i),a.TriEdges.setItem(1,s),a.BindEdgeToTriangle(e,i),a.BindEdgeToTriangle(t,s),a.CreateEdge(2,o),a}toString(){return this.Sites.getItem(0).toString()+","+this.Sites.getItem(1).toString()+","+this.Sites.getItem(2).toString()}}class w5{constructor(e,t,n,i,s){this.elementsToBeRemovedFromFront=new Array,this.removedTriangles=new Array,this.edge=e,this.triangles=t,this.front=n,this.leftPolygon=i,this.rightPolygon=s,this.a=e.upperSite,this.b=e.lowerSite}Run(){this.Init(),this.Traverse()}Traverse(){for(;!this.BIsReached();)null!=this.piercedToTheLeftFrontElemNode?this.ProcessLeftFrontPiercedElement():null!=this.piercedToTheRightFrontElemNode?this.ProcessRightFrontPiercedElement():this.ProcessPiercedEdge();null!=this.piercedTriangle&&this.removePiercedTriangle(this.piercedTriangle),this.FindMoreRemovedFromFrontElements();for(const e of this.elementsToBeRemovedFromFront)this.front.remove(e)}ProcessLeftFrontPiercedElement(){let e=this.piercedToTheLeftFrontElemNode;do{this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToLeftPolygon(e.item.LeftSite),e=this.front.previous(e)}while(x.pointToTheLeftOfLine(e.item.LeftSite.point,this.a.point,this.b.point));this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToRightPolygon(e.item.LeftSite),e.item.LeftSite!=this.b?(this.FindPiercedTriangle(e),this.piercedToTheLeftFrontElemNode=null):this.piercedToTheLeftFrontElemNode=e}FindPiercedTriangle(e){var t;const n=e.item.Edge,i=null!==(t=n.CcwTriangle)&&void 0!==t?t:n.CwTriangle,s=i.TriEdges.index(n);for(let o=1;o<=2;o++){const a=i.TriEdges.getItem(o+s),l=Xr.sign(x.signedDoubledTriangleArea(a.lowerSite.point,this.a.point,this.b.point));if(Xr.sign(x.signedDoubledTriangleArea(a.upperSite.point,this.a.point,this.b.point))*l<=0){this.piercedTriangle=i,this.piercedEdge=a;break}}}FindMoreRemovedFromFrontElements(){for(const e of this.removedTriangles)for(const t of e.TriEdges)if(null==t.CcwTriangle&&null==t.CwTriangle){const i=xn.FindNodeInFrontBySite(this.front,t.upperSite.point.x<t.lowerSite.point.x?t.upperSite:t.lowerSite);i.item.Edge==t&&this.elementsToBeRemovedFromFront.push(i.item)}}ProcessPiercedEdge(){this.piercedEdge.CcwTriangle==this.piercedTriangle?(this.AddSiteToLeftPolygon(this.piercedEdge.lowerSite),this.AddSiteToRightPolygon(this.piercedEdge.upperSite)):(this.AddSiteToLeftPolygon(this.piercedEdge.upperSite),this.AddSiteToRightPolygon(this.piercedEdge.lowerSite)),this.removePiercedTriangle(this.piercedTriangle),this.PrepareNextStateAfterPiercedEdge()}PrepareNextStateAfterPiercedEdge(){var e,t;const n=null!==(e=this.piercedEdge.CwTriangle)&&void 0!==e?e:this.piercedEdge.CcwTriangle,i=n.TriEdges.index(this.piercedEdge);for(let s=1;s<=2;s++){const o=n.TriEdges.getItem(s+i),a=Xr.sign(x.signedDoubledTriangleArea(o.lowerSite.point,this.a.point,this.b.point));if(Xr.sign(x.signedDoubledTriangleArea(o.upperSite.point,this.a.point,this.b.point))*a<=0){if(null!=o.CwTriangle&&null!=o.CcwTriangle){this.piercedTriangle=n,this.piercedEdge=o;break}this.piercedTriangle=null,this.piercedEdge=null;const c=o.upperSite.point.x<o.lowerSite.point.x?o.upperSite:o.lowerSite,u=xn.FindNodeInFrontBySite(this.front,c);c.point.x<this.a.point.x?this.piercedToTheLeftFrontElemNode=u:this.piercedToTheRightFrontElemNode=u,this.removePiercedTriangle(null!==(t=o.CwTriangle)&&void 0!==t?t:o.CcwTriangle);break}}}removePiercedTriangle(e){this.triangles.delete(e);for(const t of e.TriEdges)t.CwTriangle==e?t.CwTriangle=null:t.CcwTriangle=null,this.removedTriangles.push(e)}ProcessRightFrontPiercedElement(){let e=this.piercedToTheRightFrontElemNode;do{this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToRightPolygon(e.item.RightSite),e=this.front.next(e)}while(x.pointToTheRightOfLine(e.item.RightSite.point,this.a.point,this.b.point));this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToLeftPolygon(e.item.RightSite),e.item.RightSite!=this.b?(this.FindPiercedTriangle(e),this.piercedToTheRightFrontElemNode=null):this.piercedToTheRightFrontElemNode=e}AddSiteToLeftPolygon(e){this.AddSiteToPolygonWithCheck(e,this.leftPolygon)}AddSiteToPolygonWithCheck(e,t){e!=this.b&&(0==t.length||t[t.length-1]!=e)&&t.push(e)}AddSiteToRightPolygon(e){this.AddSiteToPolygonWithCheck(e,this.rightPolygon)}BIsReached(){var e;const t=null!==(e=this.piercedToTheLeftFrontElemNode)&&void 0!==e?e:this.piercedToTheRightFrontElemNode;return null!=t?t.item.Edge.IsAdjacent(this.b):this.piercedEdge.IsAdjacent(this.b)}Init(){const e=xn.FindNodeInFrontBySite(this.front,this.a),t=this.front.previous(e);if(x.pointToTheLeftOfLine(this.b.point,t.item.LeftSite.point,t.item.RightSite.point))this.piercedToTheLeftFrontElemNode=t;else if(x.pointToTheRightOfLine(this.b.point,e.item.RightSite.point,e.item.LeftSite.point))this.piercedToTheRightFrontElemNode=e;else for(const n of this.a.Edges){const i=n.CcwTriangle;if(null==i||x.pointToTheLeftOfLine(this.b.point,n.lowerSite.point,n.upperSite.point))continue;const s=i.TriEdges.index(n),o=i.Sites.getItem(s+2);if(x.pointToTheLeftOfLineOrOnLine(this.b.point,o.point,n.upperSite.point)){this.piercedEdge=i.TriEdges.getItem(s+1),this.piercedTriangle=i;break}}}}class fy{constructor(e,t,n,i){this.rightPolygon=new Array,this.leftPolygon=new Array,this.addedTriangles=new Array,this.edge=e,this.triangles=t,this.front=n,this.createEdgeDelegate=i}Run(){this.TraceEdgeThroughTriangles(),this.TriangulatePolygon0(this.rightPolygon,this.edge.upperSite,this.edge.lowerSite,!0),this.TriangulatePolygon0(this.leftPolygon,this.edge.upperSite,this.edge.lowerSite,!1),this.UpdateFront()}UpdateFront(){const e=new Set;for(const t of this.addedTriangles)for(const n of t.TriEdges)(null==n.CwTriangle||null==n.CcwTriangle)&&e.add(n);for(const t of e)this.AddEdgeToFront(t)}AddEdgeToFront(e){this.front.insert(new Ol(e.upperSite.point.x<e.lowerSite.point.x?e.upperSite:e.lowerSite,e))}TriangulatePolygon0(e,t,n,i){e.length>0&&this.TriangulatePolygon1(0,e.length-1,e,t,n,i)}TriangulatePolygon1(e,t,n,i,s,o){let a=n[e],l=e;for(let u=e+1;u<=t;u++){const S=n[u];fy.LocalInCircle(S,i,s,a,o)&&(l=u,a=S)}const c=ni.mkSSSD(i,s,a,this.createEdgeDelegate);this.triangles.add(c),this.addedTriangles.push(c),e<l&&this.TriangulatePolygon1(e,l-1,n,i,a,o),l<t&&this.TriangulatePolygon1(l+1,t,n,a,s,o)}static LocalInCircle(e,t,n,i,s){return s?py(e,t,i,n):py(e,t,n,i)}TraceEdgeThroughTriangles(){new w5(this.edge,this.triangles,this.front,this.leftPolygon,this.rightPolygon).Run()}}class nP{constructor(e){this.Edge=e}}class xn extends Zt{constructor(e,t,n,i){if(super(null),this.front=new xr((o,a)=>o.x-a.x),this.triangles=new Set,this.listOfSites=e,0==this.listOfSites.length)return;this.p_1=t,this.p_2=n,this.createEdgeDelegate=i;const s=ni.mkSSSD(t,n,this.listOfSites[0],i);this.triangles.add(s),this.front.insert(new Ol(t,s.TriEdges.getItem(2))),this.front.insert(new Ol(this.listOfSites[0],s.TriEdges.getItem(1)))}run(){if(0!=this.listOfSites.length){for(let e=1;e<this.listOfSites.length;e++)this.ProcessSite(this.listOfSites[e]);this.FinalizeTriangulation()}}FinalizeTriangulation(){this.RemoveP1AndP2Triangles(),this.triangles.size>0&&this.MakePerimeterConvex()}MakePerimeterConvex(){let e=this.CreateDoubleLinkedListOfPerimeter();for(;;){const t=this.FindConcaveEdge(e);if(null==t)return;e=this.ShortcutTwoListElements(t)}}FindConcaveEdge(e){let n,t=e;do{if(n=t.Next,x.getTriangleOrientation(t.Start.point,t.End.point,n.End.point)==Ie.Counterclockwise)return t;t=n}while(n!=e);return null}static FindPivot(e){let t=e,n=e;do{n=n.Next,(n.Start.point.x<t.Start.point.x||n.Start.point.x==t.Start.point.x&&n.Start.point.y<t.Start.point.y)&&(t=n)}while(n!=e);return t}FindFirsePerimeterEdge(){for(const e of this.triangles)for(const t of e.TriEdges)if(null==t.GetOtherTriangle_T(e))return t;return null}CreateDoubleLinkedListOfPerimeter(){const e=this.FindFirsePerimeterEdge();let i,t=e,n=null,s=null;const o=new Array;do{i=xn.CreatePerimeterElementFromEdge(t),o.push(me.mkPP(i.Start.point,i.End.point)),t=xn.FindNextEdgeOnPerimeter(t),null!=s?(i.Prev=s,s.Next=i):n=i,s=i}while(t!=e);return n.Prev=i,i.Next=n,n}static FindNextEdgeOnPerimeter(e){var t;let n=null!==(t=e.CwTriangle)&&void 0!==t?t:e.CcwTriangle;for(e=n.TriEdges.getItem(n.TriEdges.index(e)+2);null!=e.CwTriangle&&null!=e.CcwTriangle;)n=e.GetOtherTriangle_T(n),e=n.TriEdges.getItem(n.TriEdges.index(e)+2);return e}static CreatePerimeterElementFromEdge(e){const t=new nP(e);return null!=e.CwTriangle?(t.Start=e.upperSite,t.End=e.lowerSite):(t.End=e.upperSite,t.Start=e.lowerSite),t}RemoveP1AndP2Triangles(){const e=new Set;for(const t of this.triangles)(t.Sites.has(this.p_1)||t.Sites.has(this.p_2))&&e.add(t);for(const t of e)xn.RemoveTriangleWithEdges(this.triangles,t)}static RemoveTriangleWithEdges(e,t){e.delete(t);for(const n of t.TriEdges)n.CwTriangle==t?n.CwTriangle=null:n.CcwTriangle=null,null==n.CwTriangle&&null==n.CcwTriangle&&gy(n.upperSite.Edges,n)}static RemoveTriangleButLeaveEdges(e,t){e.delete(t);for(const n of t.TriEdges)n.CwTriangle==t?n.CwTriangle=null:n.CcwTriangle=null}ProcessSite(e){this.PointEvent(e);for(let t=0;t<e.Edges.length;t++){const n=e.Edges[t];n.Constrained&&this.EdgeEvent(n)}}EdgeEvent(e){xn.EdgeIsProcessed(e)||new fy(e,this.triangles,this.front,this.createEdgeDelegate).Run()}static EdgeIsProcessed(e){return null!=e.CwTriangle||null!=e.CcwTriangle}ShowFrontWithSite(e,t=null){const n=new Array;if(null!=e.Edges)for(const i of e.Edges)n.push(Xe.mkDebugCurveTWCI(200,.8,i.Constrained?"Pink":"Brown",me.mkPP(i.upperSite.point,i.lowerSite.point)));n.push(Xe.mkDebugCurveTWCI(200,1,"Brown",mt.mkFullEllipseNNP(.5,.5,e.point)));for(const i of this.triangles)for(let s=0;s<3;s++){const o=i.TriEdges.getItem(s);n.push(Xe.mkDebugCurveTWCI(o.Constrained?155:100,o.Constrained?.8:.4,o.Constrained?"Pink":"Navy",me.mkPP(o.upperSite.point,o.lowerSite.point)))}if(null!=t)for(const i of t)n.push(Xe.mkDebugCurveTWCI(100,.5,"Red",i));for(const i of this.front)n.push(Xe.mkDebugCurveTWCI(100,5.5,"Green",me.mkPP(i.Edge.upperSite.point,i.Edge.lowerSite.point)))}Show(e){xn.ShowCdt(Array.from(this.triangles.values()),this.front,null,null,[],e)}static ShowCdt(e,t,n,i,s,o){let a=new Array;if(null!=n)for(const l of n)a.push(Xe.mkDebugCurveTWCI(200,.1,"Red",l));if(null!=i)for(const l of i)a.push(Xe.mkDebugCurveTWCI(200,.1,"Blue",l));if(null!=t)for(const l of t)a.push(Xe.mkDebugCurveTWCI(200,.1,"Green",me.mkPP(l.Edge.upperSite.point,l.Edge.lowerSite.point)));for(const l of e)for(let c=0;c<3;c++){const u=l.TriEdges.getItem(c);a.push(xn.GetDebugCurveOfCdtEdge(u))}a=a.concat(s)}static GetDebugCurveOfCdtEdge(e){return null==e.CcwTriangle||null==e.CwTriangle?Xe.mkDebugCurveTWCI(255,.5,e.Constrained?"Brown":"Black",me.mkPP(e.upperSite.point,e.lowerSite.point)):Xe.mkDebugCurveTWCI(200,e.Constrained?.8:.2,e.Constrained?"Pink":"Navy",me.mkPP(e.upperSite.point,e.lowerSite.point))}PointEvent(e){const t=this.ProjectToFront(e),n={rightSite:null},i=t.item.x+q.distanceEpsilon<e.point.x?this.MiddleCase(e,t,n):this.LeftCase(e,t,n);let s=this.InsertSiteIntoFront(i,e,n.rightSite);this.TriangulateEmptySpaceToTheRight(s),s=xn.FindNodeInFrontBySite(this.front,i),this.TriangulateEmptySpaceToTheLeft(s)}LeftCase(e,t,n){const i=t.item;this.InsertAndLegalizeTriangle(e,i);const s=this.front.previous(t),o=s.item.LeftSite;return n.rightSite=t.item.RightSite,this.InsertAndLegalizeTriangle(e,s.item),this.front.deleteNodeInternal(s),this.front.remove(i),o}MiddleCase(e,t,n){const i=t.item.LeftSite;return n.rightSite=t.item.RightSite,this.InsertAndLegalizeTriangle(e,t.item),this.front.deleteNodeInternal(t),i}TriangulateEmptySpaceToTheLeft(e){const t=e.item.RightSite;let n=this.front.previous(e);for(;null!=n;){const i=n.item,s=i.LeftSite,o=i.RightSite;if(!(o.point.sub(t.point).dot(s.point.sub(o.point))<0)){this.TryTriangulateBasinToTheLeft(e);break}e=this.ShortcutTwoFrontElements(n,e),n=this.front.previous(e)}}ShortcutTwoListElements(e){var t;const n=e.Next;let i=ni.mkSSSEE(e.Start,e.End,n.End,e.Edge,n.Edge,this.createEdgeDelegate);this.triangles.add(i);const s=i.TriEdges.getItem(2);this.LegalizeEdge(e.Start,i.OppositeEdge(e.Start)),i=null!==(t=s.CcwTriangle)&&void 0!==t?t:s.CwTriangle,this.LegalizeEdge(n.End,i.OppositeEdge(n.End));const o=new nP(s);return o.Start=e.Start,o.End=n.End,e.Prev.Next=o,o.Prev=e.Prev,o.Next=n.Next,n.Next.Prev=o,o}ShortcutTwoFrontElements(e,t){var n;const i=e.item,s=t.item;let o=ni.mkSSSEED(i.LeftSite,i.RightSite,s.RightSite,i.Edge,s.Edge,this.createEdgeDelegate);this.triangles.add(o),this.front.deleteNodeInternal(e),this.front.remove(s);const a=o.TriEdges.getItem(2);return this.LegalizeEdge(i.LeftSite,o.OppositeEdge(i.LeftSite)),o=null!==(n=a.CcwTriangle)&&void 0!==n?n:a.CwTriangle,this.LegalizeEdge(s.RightSite,o.OppositeEdge(s.RightSite)),this.front.insert(new Ol(i.LeftSite,a))}TryTriangulateBasinToTheLeft(e){if(!xn.DropsSharpEnoughToTheLeft(e.item))return;const t=new kt.K;for(t.push(e.item.LeftSite);;){const n=t.pop();e=xn.FindNodeInFrontBySite(this.front,n);const i=this.front.previous(e);if(null==i)return;if(x.getTriangleOrientation(i.item.LeftSite.point,e.item.LeftSite.point,e.item.RightSite.point)==Ie.Counterclockwise)t.push(i.item.LeftSite),this.ShortcutTwoFrontElements(i,e);else if(e.item.LeftSite.point.y>e.item.RightSite.point.y)t.push(i.item.LeftSite);else{if(i.item.LeftSite.point.y<=i.item.RightSite.point.y)return;t.push(i.item.LeftSite)}}}static DropsSharpEnoughToTheLeft(e){const t=e.Edge;if(e.RightSite!=t.upperSite)return!1;const n=t.lowerSite.point.sub(t.upperSite.point);return n.x>=.5*n.y}InsertSiteIntoFront(e,t,n){let i=null,s=null;for(const o of t.Edges)if(null==s&&o.lowerSite==e&&(s=o),null==i&&o.lowerSite==n&&(i=o),null!=s&&null!=i)break;return this.front.insert(new Ol(e,s)),this.front.insert(new Ol(t,i))}TriangulateEmptySpaceToTheRight(e){const n=e.item.LeftSite.point;let i=this.front.next(e);for(;null!=i;){const s=i.item,o=s.LeftSite,a=s.RightSite;if(!(o.point.sub(n).dot(a.point.sub(o.point))<0)){this.TryTriangulateBasinToTheRight(e);break}e=this.ShortcutTwoFrontElements(e,i),i=this.front.next(e)}}TryTriangulateBasinToTheRight(e){if(!xn.DropsSharpEnoughToTheRight(e.item))return;const t=new kt.K;for(t.push(e.item.LeftSite);;){const n=t.pop();e=xn.FindNodeInFrontBySite(this.front,n);const i=this.front.next(e);if(null==i)return;if(x.getTriangleOrientation(e.item.LeftSite.point,e.item.RightSite.point,i.item.RightSite.point)==Ie.Counterclockwise)this.ShortcutTwoFrontElements(e,i),t.push(n);else if(e.item.LeftSite.point.y>e.item.RightSite.point.y)t.push(e.item.RightSite);else{if(i.item.LeftSite.point.y>=i.item.RightSite.point.y)return;t.push(e.item.RightSite)}}}static DropsSharpEnoughToTheRight(e){const t=e.Edge;if(e.LeftSite!=t.upperSite)return!1;const n=t.lowerSite.point.sub(t.upperSite.point);return n.x<=-.5*n.y}static FindNodeInFrontBySite(e,t){return e.findLast(n=>n.LeftSite.point.x<=t.point.x)}InsertAndLegalizeTriangle(e,t){var n;if(x.getTriangleOrientation(e.point,t.LeftSite.point,t.RightSite.point)!=Ie.Collinear){const i=ni.mkSED(e,t.Edge,this.createEdgeDelegate);this.triangles.add(i),this.LegalizeEdge(e,i.TriEdges.getItem(0))}else{const i=t.Edge;gy(i.upperSite.Edges,i);let s=null!==(n=i.CcwTriangle)&&void 0!==n?n:i.CwTriangle;const o=s.OppositeSite(i);xn.RemoveTriangleButLeaveEdges(this.triangles,s),s=ni.mkSSSD(t.LeftSite,o,e,this.createEdgeDelegate);const a=ni.mkSSSD(t.RightSite,o,e,this.createEdgeDelegate);this.triangles.add(s),this.triangles.add(a),this.LegalizeEdge(e,s.OppositeEdge(e)),this.LegalizeEdge(e,a.OppositeEdge(e))}}LegalizeEdge(e,t){t.Constrained||null==t.CcwTriangle||null==t.CwTriangle||(t.CcwTriangle.Contains(e)?this.LegalizeEdgeForOtherCwTriangle(e,t):this.LegalizeEdgeForOtherCcwTriangle(e,t))}LegalizeEdgeForOtherCwTriangle(e,t){const n=t.CwTriangle.TriEdges.index(t);if(rP(e,t.upperSite,t.CwTriangle.Sites.getItem(n+2),t.lowerSite)){const i=iP(e,t);this.LegalizeEdge(e,i.CwTriangle.OppositeEdge(e)),this.LegalizeEdge(e,i.CcwTriangle.OppositeEdge(e))}}LegalizeEdgeForOtherCcwTriangle(e,t){const n=t.CcwTriangle.TriEdges.index(t);if(rP(e,t.lowerSite,t.CcwTriangle.Sites.getItem(n+2),t.upperSite)){const i=iP(e,t);this.LegalizeEdge(e,i.CwTriangle.OppositeEdge(e)),this.LegalizeEdge(e,i.CcwTriangle.OppositeEdge(e))}}ProjectToFront(e){return this.front.findLast(t=>t.x<=e.point.x)}}function gy(r,e){if(0==r.length)return;const t=r.findIndex(n=>e==n);t>=0&&(t!=r.length-1&&(r[t]=r[r.length-1]),r.pop())}function rP(r,e,t,n){return function v5(r,e,t,n){return x.getTriangleOrientation(e.point,r.point,t.point)==Ie.Clockwise&&x.getTriangleOrientation(t.point,r.point,n.point)==Ie.Clockwise}(r,e,t,n)&&py(r,e,t,n)}function py(r,e,t,n){const i=e.point.x-r.point.x,s=e.point.y-r.point.y,o=t.point.x-r.point.x,a=t.point.y-r.point.y,l=n.point.x-r.point.x,c=n.point.y-r.point.y,u=i*i+s*s,S=o*o+a*a,b=l*l+c*c;return i*(a*b-c*S)-o*(s*b-c*u)+l*(s*S-a*u)>q.tolerance}function iP(r,e){let t,n;e.CcwTriangle.Contains(r)?(t=e.CcwTriangle,n=e.CwTriangle):(t=e.CwTriangle,n=e.CcwTriangle);const i=t.TriEdges.index(e),s=n.TriEdges.index(e),o=n.Sites.getItem(s+2),a=t.TriEdges.getItem(i+1),l=n.TriEdges.getItem(s+1),c=nn.GetOrCreateEdge(r,o);return t.Sites.setItem(i+1,o),t.TriEdges.setItem(i,l),t.TriEdges.setItem(i+1,c),n.Sites.setItem(s+1,r),n.TriEdges.setItem(s,a),n.TriEdges.setItem(s+1,c),l.lowerSite==o?l.CcwTriangle=t:l.CwTriangle=t,a.lowerSite==r?a.CcwTriangle=n:a.CwTriangle=n,c.upperSite==r?(c.CcwTriangle=n,c.CwTriangle=t):(c.CcwTriangle=t,c.CwTriangle=n),gy(e.upperSite.Edges,e),c}class nn extends Zt{constructor(e,t,n){super(null),this.isolatedSites=[],this.obstacles=[],this.PointsToSites=new cr,this.cdtTree=null,this.isolatedSites=e,this.obstacles=t,this.isolatedSegments=n}static constructor_(e){const t=new nn(null,null,null);return t.isolatedSitesWithObject=e,t}FillAllInputSites(){if(null!=this.isolatedSitesWithObject)for(const e of this.isolatedSitesWithObject)this.AddSite(e[0],e[1]);if(null!=this.isolatedSites)for(const e of this.isolatedSites)this.AddSite(e,null);if(null!=this.obstacles)for(const e of this.obstacles)this.AddPolylineToAllInputSites(e);if(null!=this.isolatedSegments)for(const e of this.isolatedSegments)this.AddConstrainedEdge(e.A,e.B,null);this.AddP1AndP2(),this.allInputSites=Array.from(this.PointsToSites.values())}AddSite(e,t){let n;return(n=this.PointsToSites.get(e))?n.Owner=t:(n=Su.mkSO(e,t),this.PointsToSites.set(e,n)),n}AddP1AndP2(){const e=Ne.mkEmpty();for(const i of this.PointsToSites.keys())e.add(i);const t=Math.max(e.width/3,1),n=Math.max(e.height/3,1);this.P1=new Su(e.leftBottom.add(new x(-t,-n))),this.P2=new Su(e.rightBottom.add(new x(t,-n)))}AddPolylineToAllInputSites(e){for(let t=e.startPoint;null!=t.next;t=t.next)this.AddConstrainedEdge(t.point,t.next.point,e);e.closed&&this.AddConstrainedEdge(e.endPoint.point,e.startPoint.point,e)}AddConstrainedEdge(e,t,n){let s,o;nn.AbovePP(e,t)>0?(s=this.AddSite(e,n),o=this.AddSite(t,n)):(s=this.AddSite(t,n),o=this.AddSite(e,n)),nn.CreateEdgeOnOrderedCouple(s,o).Constrained=!0}static GetOrCreateEdge(e,t){if(1==nn.AboveCC(e,t)){const n=e.EdgeBetweenUpperSiteAndLowerSite(t);return null!=n?n:nn.CreateEdgeOnOrderedCouple(e,t)}{const n=t.EdgeBetweenUpperSiteAndLowerSite(e);return null!=n?n:nn.CreateEdgeOnOrderedCouple(t,e)}}static CreateEdgeOnOrderedCouple(e,t){return new y5(e,t)}GetTriangles(){return this.sweeper.triangles}run(){this.Initialization(),this.SweepAndFinalize()}SweepAndFinalize(){this.sweeper=new xn(this.allInputSites,this.P1,this.P2,nn.GetOrCreateEdge),this.sweeper.run()}Initialization(){this.FillAllInputSites(),this.allInputSites.sort(nn.OnComparison)}static OnComparison(e,t){return nn.AboveCC(e,t)}static AbovePP(e,t){let n=e.y-t.y;return n>0?1:n<0?-1:(n=e.x-t.x,n>0?-1:n<0?1:0)}static AboveCC(e,t){return nn.AbovePP(e.point,t.point)}RestoreEdgeCapacities(){for(const e of this.allInputSites)for(const t of e.Edges)t.Constrained||(t.ResidualCapacity=t.Capacity)}SetInEdges(){for(const e of this.PointsToSites.values())for(const t of e.Edges)t.lowerSite.AddInEdge(t)}FindSite(e){return this.PointsToSites.get(e)}static PointIsInsideOfTriangle(e,t){for(let n=0;n<3;n++){const i=t.Sites.getItem(n).point,s=t.Sites.getItem(n+1).point;if(x.signedDoubledTriangleArea(e,i,s)<-1*q.distanceEpsilon)return!1}return!0}GetCdtTree(){return null==this.cdtTree&&(this.cdtTree=en(Array.from(this.GetTriangles().values()).map(e=>Cn(e,e.BoundingBox())))),this.cdtTree}EdgeIsCorrect(e){const t=e.upperSite;let n=!1;for(const s of t.Edges)if(s==e){n=!0;break}return!!n&&this.PointsToSites.get(t.point)==t}}class Au{constructor(e,t){this.start=e,this.end=t}add(e){this.add_d(e)}add_rect(e){const t=e,n=this.clone();return n.add_d(t.start),n.add_d(t.end),n}clone(){return new Au(this.start,this.end)}contains_point(e){return this.contains_d(e)}contains_rect(e){const t=e;return this.contains_d(t.start)&&this.contains_d(t.end)}intersection_rect(e){const t=e;return new Au(Math.max(this.start,t.start),Math.min(this.end,t.end))}intersects_rect(e){return this.intersects(e)}contains_point_radius(e,t){return this.contains_d(e-t)&&this.contains_d(e+t)}static mkInterval(e,t){const n=new Au(e.start,e.end);return n.add_d(t.start),n.add_d(t.end),n}add_d(e){this.start>e&&(this.start=e),this.end<e&&(this.end=e)}get Start(){return this.start}set Start(e){this.start=e}get Length(){return this.end-this.start}contains_d(e){return this.start<=e&&e<=this.end}GetInRange(e){return e<this.start?this.start:e>this.end?this.end:e}intersects(e){return!(e.start>this.end+q.distanceEpsilon||e.end<this.start-q.distanceEpsilon)}}class sP{constructor(e){this.heapSize=0,this._priors=new Array(e),this._heap=new Array(e+1),this._reverse_heap=new Array(e)}get Count(){return this.heapSize}SwapWithParent(e){const t=this._heap[e>>1];this.PutAtI(e>>1,this._heap[e]),this.PutAtI(e,t)}Enqueue(e,t){this.heapSize++;let n=this.heapSize;for(this._priors[e]=t,this.PutAtI(n,e);n>1&&this._priors[this._heap[n>>1]]>t;)this.SwapWithParent(n),n>>=1}PutAtI(e,t){this._heap[e]=t,this._reverse_heap[t]=e}Dequeue(){if(0==this.heapSize)throw new Error;const e=this._heap[1];if(this.heapSize>1){this.PutAtI(1,this._heap[this.heapSize]);let t=1;for(;;){let n=t;const i=t<<1;i<=this.heapSize&&this._priors[this._heap[i]]<this._priors[this._heap[t]]&&(n=i);const s=i+1;if(s<=this.heapSize&&this._priors[this._heap[s]]<this._priors[this._heap[n]]&&(n=s),n==t)break;this.SwapWithParent(n),t=n}}return this.heapSize--,e}IsEmpty(){return 0==this.heapSize}DecreasePriority(e,t){this._priors[e]=t;let n=this._reverse_heap[e];for(;n>1&&this._priors[this._heap[n]]<this._priors[this._heap[n>>1]];)this.SwapWithParent(n),n>>=1}}class S5{constructor(e,t,n,i){this._numberOfOverlaps=0,this._proximityEdges=e,this._nodeSizes=t,this._nodePositions=n,this._forLayers=i,this._q=new sP(2*t.length)}Run(){return this.InitQueue(),this.FindOverlaps(),this._numberOfOverlaps}FindOverlaps(){for(;this._q.Count>0;){let e=this._q.Dequeue();e<this._nodePositions.length?(this.FindOverlapsWithInterval(e),this.AddIntervalToTree(e)):(e-=this._nodePositions.length,this.RemoveIntervalFromTree(e))}}RemoveIntervalFromTree(e){this._intervalTree.Remove(this.GetInterval(e),e)}AddIntervalToTree(e){const t=this.GetInterval(e);null==this._intervalTree&&(this._intervalTree=GE([])),this._intervalTree.Add(t,e)}FindOverlapsWithInterval(e){if(null==this._intervalTree)return;const t=this.GetInterval(e);for(const n of this._intervalTree.GetAllIntersecting(t)){const i=rs.GetIdealEdge(e,n,this._nodePositions[e],this._nodePositions[n],this._nodeSizes);if(i.overlapFactor<=1)return;this._proximityEdges.push(i),this._numberOfOverlaps++}}GetInterval(e){const t=this._nodeSizes[e].width/2,n=this._nodePositions[e].x;return new Au(n-t,n+t)}InitQueue(){for(let e=0;e<this._nodeSizes.length;e++){const t=this._nodeSizes[e].height/2,n=this._nodePositions[e].y;this._q.Enqueue(e,n-t),this._q.Enqueue(this._nodeSizes.length+e,n+t)}}}class oP{constructor(e,t,n){this.treeNodes=new Set,this.hedgehog=new Map,this.graph=e,this.weight=t,this.root=n,this.q=new sP(this.graph.nodeCount)}NodeIsInTree(e){return this.treeNodes.has(e)}GetTreeEdges(){const e=new Array;for(this.Init();e.length<this.graph.nodeCount-1&&this.q.Count>0;)this.AddEdgeToTree(e);return e}AddEdgeToTree(e){const t=this.q.Dequeue(),n=this.hedgehog.get(t);this.treeNodes.add(t),e.push(n),this.UpdateOutEdgesOfV(t),this.UpdateInEdgesOfV(t)}UpdateOutEdgesOfV(e){for(const t of this.graph.outEdges[e]){const n=t.target;if(this.NodeIsInTree(n))continue;const i=this.hedgehog.get(n);if(i){const s=this.weight(i),o=this.weight(t);o<s&&(this.q.DecreasePriority(n,o),this.hedgehog.set(n,t))}else this.q.Enqueue(n,this.weight(t)),this.hedgehog.set(n,t)}}UpdateInEdgesOfV(e){for(const t of this.graph.inEdges[e]){const n=t.source;if(this.NodeIsInTree(n))continue;const i=this.hedgehog.get(n);if(i){const s=this.weight(i),o=this.weight(t);o<s&&(this.q.DecreasePriority(n,o),this.hedgehog.set(n,t))}else this.q.Enqueue(n,this.weight(t)),this.hedgehog.set(n,t)}}Init(){this.treeNodes.add(this.root);for(const e of this.graph.outEdges[this.root]){const t=this.weight(e);this.q.Enqueue(e.target,t),this.hedgehog.set(e.target,e)}for(const e of this.graph.inEdges[this.root]){const t=this.weight(e);this.q.Enqueue(e.source,t),this.hedgehog.set(e.source,e)}}}class my{static GetMst(e,t){if(0==e.length)return null;const n=e.map(l=>new ot(l.source,l.target)),i=n.reduce((l,c)=>Math.max(l,Math.max(c.x,c.y)),0),s=new ul(i+1);for(let l=0;l<e.length;l++)s.setPair(n[l],e[l]);const o=bs(n,t);return new oP(o,l=>s.get(l.source,l.target).weight,n[0].source).GetTreeEdges().map(l=>s.get(l.source,l.target))}static GetMstOnCdt(e,t){const n=Array.from(e.PointsToSites.values()),i=new Map;for(let l=0;l<n.length;l++)i.set(n[l],l);const s=my.GetEdges(n,i),o=ET(Array.from(s.keys()));return new oP(o,l=>t(s.get(l.source,l.target)),0).GetTreeEdges().map(l=>s.get(l.source,l.target))}static GetEdges(e,t){const n=new ul(e.length);for(let i=0;i<e.length;i++){const s=e[i],o=t.get(s);for(const a of s.Edges)n.set(o,t.get(a.lowerSite),a)}return n}}class Ey{constructor(){this.epsilon=.01,this.iterationsMax=1e3,this.stopOnMaxIterat=!1,this.nodeSeparation=4,this.randomizationSeed=1,this.randomizeAllPointsOnStart=!1}get StopOnMaxIterat(){return this.stopOnMaxIterat}set StopOnMaxIterat(e){this.stopOnMaxIterat=e}get Epsilon(){return this.epsilon}set Epsilon(e){this.epsilon=e}get IterationsMax(){return this.iterationsMax}set IterationsMax(e){this.iterationsMax=e}get NodeSeparation(){return this.nodeSeparation}set NodeSeparation(e){this.nodeSeparation=e}get RandomizationSeed(){return this.randomizationSeed}set RandomizationSeed(e){this.randomizationSeed=e}get RandomizeAllPointsOnStart(){return this.randomizeAllPointsOnStart}set RandomizeAllPointsOnStart(e){this.randomizeAllPointsOnStart=e}Clone(){const e=new Ey;return e.Epsilon=this.Epsilon,e.IterationsMax=this.IterationsMax,e.StopOnMaxIterat=this.StopOnMaxIterat,e.NodeSeparation=this.NodeSeparation,e.RandomizationSeed=this.RandomizationSeed,e.RandomizeAllPointsOnStart=this.randomizeAllPointsOnStart,e}}class rs{constructor(e,t){this._settings=e,this._nodes=t}static RemoveOverlaps(e,t){const n=new Ey;n.RandomizeAllPointsOnStart=!0,n.NodeSeparation=t,new rs(n,e).RemoveOverlaps()}RemoveOverlaps(){if(this._nodes.length<3)return void this.RemoveOverlapsOnTinyGraph();const e={nodePositions:new Array,nodeSizes:new Array};for(function A5(r,e,t){t.nodePositions=e.map(n=>n.center),t.nodeSizes=e.map(n=>{const i=n.boundingBox.size;return i.width+=r.NodeSeparation,i.height+=r.NodeSeparation,i})}(this._settings,this._nodes,e),this.lastRunNumberIterations=0;this.OneIteration(e.nodePositions,e.nodeSizes,!1);)this.lastRunNumberIterations++;for(;this.OneIteration(e.nodePositions,e.nodeSizes,!0);)this.lastRunNumberIterations++;for(let t=0;t<this._nodes.length;t++)this._nodes[t].center=e.nodePositions[t]}RemoveOverlapsOnTinyGraph(){if(1!=this._nodes.length&&2==this._nodes.length){const e=this._nodes[0],t=this._nodes[1];x.closeDistEps(e.center,t.center)&&(t.center=t.center.add(new x(.001,0)));const n=this.GetIdealDistanceBetweenTwoNodes(e,t),i=x.middle(e.center,t.center);let s=e.center.sub(t.center);s=s.mul(n/s.length*.5),e.center=i.add(s),t.center=i.sub(s)}}GetIdealDistanceBetweenTwoNodes(e,t){const n=e.center.sub(t.center),i=Math.abs(n.x),s=Math.abs(n.y);let l=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY;return i>q.tolerance&&(l=((e.width+t.width)/2+this._settings.NodeSeparation)/i),s>q.tolerance&&(c=((e.height+t.height)/2+this._settings.NodeSeparation)/s),Math.min(l,c)*n.length}static AvgEdgeLength(e){let t=0,n=0;for(const i of e)for(const s of i.outEdges())n+=i.center.sub(s.target.center).length,t++;return t>0?n/t:1}OneIteration(e,t,n){const i=new Array;for(let u=0;u<e.length;u++)i.push([e[u],u]);const s=nn.constructor_(i);s.run();const o=new Map;for(let u=0;u<e.length;u++)o.set(s.PointsToSites.get(e[u]),u);let a=0;const l=new Array;for(const u of s.PointsToSites.values())for(const S of u.Edges){const b=S.upperSite.point,L=S.lowerSite.point,F=o.get(S.upperSite),G=o.get(S.lowerSite),J=rs.GetIdealEdge(F,G,b,L,t);l.push(J),J.overlapFactor>1&&a++}if(0==a||n){const u=this.FindProximityEdgesWithSweepLine(l,t,e);if(0==a&&0==u||0==a&&!n)return!1}const c=my.GetMst(l,e.length);return rs.MoveNodePositions(c,e,c[0].source),!0}FindProximityEdgesWithSweepLine(e,t,n){return new S5(e,t,n,this._overlapForLayers).Run()}static GetIdealEdge(e,t,n,i,s){const o={overlapFactor:0},a=rs.GetIdealEdgeLength(e,t,n,i,s,o),l=n.sub(i).length,c=Ne.mkSizeCenter(s[e],n),u=Ne.mkSizeCenter(s[t],i),S=o.overlapFactor>1?l-a:rs.GetDistanceRects(c,u);return{source:Math.min(e,t),target:Math.max(e,t),overlapFactor:o.overlapFactor,idealDistance:a,weight:S}}static GetIdealEdgeLength(e,t,n,i,s,o){const a=n.sub(i),l=a.length,c=Math.abs(a.x),u=Math.abs(a.y),S=(s[e].width+s[t].width)/2,b=(s[e].height+s[t].height)/2;if(c>=S||u>=b)return o.overlapFactor=1,a.length;let L;const F=1e-10;if(c>F)L=u>F?Math.min(S/c,b/u):S/c;else{if(!(u>F))return o.overlapFactor=2,Math.sqrt(S*S+b*b)/4;L=b/u}return L=Math.max(L,1.001),o.overlapFactor=L,L*l}static GetDistanceRects(e,t){if(e.intersects(t))return 0;let n=0,i=0;return(e.right<t.left||t.right<e.left)&&(i=e.left-t.right),e.top<t.bottom?n=t.bottom-e.top:t.top<e.bottom&&(n=e.bottom-t.top),Math.sqrt(i*i+n*n)}static MoveNodePositions(e,t,n){const i=t.map(o=>o.clone()),s=new Set;s.add(n);for(let o=0;o<e.length;o++){const a=e[o];s.has(a.source)?rs.MoveNode(a.source,a.target,i,t,s,a.idealDistance):rs.MoveNode(a.target,a.source,i,t,s,a.idealDistance)}}static MoveNode(e,t,n,i,s,o){let a=n[t].sub(n[e]);a=a.mul(o/a.length+.01),i[t]=i[e].add(a),s.add(t)}GetLastRunIterations(){return this.lastRunNumberIterations}}class nf extends Zt{constructor(e,t,n,i){super(n),this.settings=e,this.graph=t,this.length=i}run(){this.LayoutConnectedGraphWithMds(),this.SetGraphBoundingBox()}SetGraphBoundingBox(){this.graph.boundingBox=this.graph.pumpTheBoxToTheGraphWithMargins(this.settings.NodeSeparation/2)}static ScaleToAverageEdgeLength(e,t,n,i){const s=new Map;let o=0;for(const c of e.shallowNodes())s.set(c,o),o++;let a=0,l=0;for(const c of e.edges()){const u=s.get(c.source),S=s.get(c.target);l+=Math.sqrt(Math.pow(t[u]-t[S],2)+Math.pow(n[u]-n[S],2)),a+=i(c)}if(a>0&&(l/=a),l>0)for(let c=0;c<t.length;c++)t[c]/=l,n[c]/=l}static LayoutGraphWithMds(e,t,n,i){if(n.x=new Array(e.shallowNodeCount),n.y=new Array(e.shallowNodeCount),0==n.x.length)return;if(1==n.x.length)return void(n.x[0]=n.y[0]=0);const s=Math.min(t.PivotNumber,e.shallowNodeCount),o=t.GetNumberOfIterationsWithMajorization(e.shallowNodeCount),a=t.Exponent,l=new Array(s),c=new m5(e,l,i);if(c.run(),Ct.LandmarkClassicalScaling(c.Result,n,l),nf.ScaleToAverageEdgeLength(e,n.x,n.y,i),o>0){const S=new hy(e,i);S.run();const b=S.Result,L=Ct.ExponentialWeightMatrix(b,a);Ct.DistanceScalingSubset(b,n.x,n.y,L,o)}}LayoutConnectedGraphWithMds(){const e={x:[],y:[]};nf.LayoutGraphWithMds(this.graph,this.settings,e,this.length),0!=this.settings.RotationAngle&&class E5{static Rotate(e,t,n){const i=Math.sin(n*(Math.PI/180)),s=Math.cos(n*(Math.PI/180));for(let o=0;o<e.length;o++){const a=s*e[o]+i*t[o];t[o]=s*t[o]-i*e[o],e[o]=a}}}.Rotate(e.x,e.y,this.settings.RotationAngle);let t=0;for(const n of this.graph.shallowNodes())n.boundingBox&&(n.center=new x(e.x[t]*this.settings.ScaleX,e.y[t]*this.settings.ScaleY)),t++;this.settings.RemoveOverlaps&&rs.RemoveOverlaps(Array.from(this.graph.shallowNodes()),this.settings.NodeSeparation),this.graph.pumpTheBoxToTheGraphWithMargins(this.settings.NodeSeparation/2)}ScaleNodes(e,t){for(const n of e)n.center=n.center.mul(t)}static PackGraphs(e,t){if(0==e.length)return Ne.mkEmpty();if(1==e.length)return e[0].boundingBox;const n=e.map(o=>o.boundingBox),i=new Array;for(const o of e)i.push({g:o,lb:o.boundingBox.leftBottom.clone()});const s=new hT(n,t.PackingAspectRatio);s.run();for(const{g:o,lb:a}of i){const l=o.boundingBox.leftBottom.sub(a);o.translate(l)}return new Ne({left:0,bottom:0,right:s.PackedWidth,top:s.PackedHeight})}}class aP extends ST{constructor(){super(...arguments),this.pivotNumber=50,this.iterationsWithMajorization=30,this.scaleX=200,this.scaleY=200,this.exponent=-2,this.rotationAngle=0,this.removeOverlaps=!0,this._callIterationsWithMajorizationThreshold=3e3,this.adjustScale=!1}get RemoveOverlaps(){return this.removeOverlaps}set RemoveOverlaps(e){this.removeOverlaps=e}get PivotNumber(){return this.pivotNumber}set PivotNumber(e){this.pivotNumber=e}get IterationsWithMajorization(){return this.iterationsWithMajorization}set IterationsWithMajorization(e){this.iterationsWithMajorization=e}get ScaleX(){return this.scaleX}set ScaleX(e){this.scaleX=e}get ScaleY(){return this.scaleY}set ScaleY(e){this.scaleY=e}get Exponent(){return this.exponent}set Exponent(e){this.exponent=e}get RotationAngle(){return this.rotationAngle}set RotationAngle(e){this.rotationAngle=e%360}get IdealEdgeLength(){return this.edgeConstraints}set IdealEdgeLength(e){this.edgeConstraints=e}get AdjustScale(){return this.adjustScale}set AdjustScale(e){this.adjustScale=e}GetNumberOfIterationsWithMajorization(e){return e>this.CallIterationsWithMajorizationThreshold?0:this.IterationsWithMajorization}get CallIterationsWithMajorizationThreshold(){return this._callIterationsWithMajorizationThreshold}set CallIterationsWithMajorizationThreshold(e){this._callIterationsWithMajorizationThreshold=e}}class lP extends Zt{constructor(e,t,n,i){super(t),this.graph=e,this.length=n,this.settings=i,this.settings.ScaleX=this.settings.ScaleY=200}get scaleX(){return this.settings.ScaleX}set scaleX(e){this.settings.ScaleX=e}get scaleY(){return this.settings.ScaleY}set scaleY(e){this.settings.ScaleY=e}run(){new nf(this.settings,this.graph,this.cancelToken,this.length).run()}}function cP(r,e){r.layoutSettings||(r.layoutSettings=e);for(const t of r.shallowNodes())t instanceof Ii&&cP(t,r.layoutSettings)}function uP(r){for(;;){if(r.layoutSettings&&r.layoutSettings.edgeRoutingSettings)return r.layoutSettings.edgeRoutingSettings;const t=r.graph.parent;if(!t)break;r=An.getGeom(t)}const e=new vT;return e.EdgeRoutingMode=cn.Spline,e}function hP(r,e,t){const n=uP(r);if(n.EdgeRoutingMode==cn.Rectilinear)!function b5(r,e,t,n=1,i=3){p5.constructorGNANB(r,e,n,i,!0).run()}(r,e);else if(n.EdgeRoutingMode==cn.Spline||n.EdgeRoutingMode==cn.SplineBundling)!function Y5(r,e,t){const n=r.layoutSettings?r.layoutSettings.edgeRoutingSettings:uP(r);new xt(r,e,n.Padding,n.PolylinePadding,n.coneAngle,n.BundlingSettings,t).run()}(r,e,t);else if(n.EdgeRoutingMode==cn.StraightLine)!function U5(r,e,t){if(e)for(const n of e){if(t&&t.canceled)return;fr.RouteEdge(n,r.padding)}else for(const n of r.deepNodes()){if(t&&t.canceled)return;for(const i of n.outEdges())null==i.curve&&fr.RouteEdge(i,r.padding);for(const i of n.selfEdges())null==i.curve&&fr.RouteEdge(i,r.padding)}}(r,e,t);else if(null==r.graph.parent&&n.EdgeRoutingMode!=cn.None){const i=Array.from(r.deepEdges()).filter(s=>!s.curve);i.length>0&&new xt(r,i).run()}}function yy(r,e,t,n,i,s=!0){if(r.graph.isEmpty())return;const o=function b(){const F=new Set,G=r.graph;if(null==G.parent)return F;for(const J of G.shallowNodes){for(const te of J.outEdges){const ie=G.liftNode(te.target);(null==ie||ie==J)&&F.add(te)}for(const te of J.inEdges){const ie=G.liftNode(te.source);(null==ie||ie==J)&&F.add(te)}}for(const J of F)J.remove();return F}();!function S(F){for(const G of F.shallowNodes())if(G instanceof Ii){const J=G;if(yy(J,e,t,n,i),!J.graph.isEmpty()){const te=J.boundingBox;te&&!te.isEmpty()&&(G.boundaryCurve=tr.mkRectangleWithRoundedCorners(te.width,te.height,Math.min(10,te.width/10),Math.min(10,te.height/10),te.center))}}}(r);const a=function I5(r){const e=new Array;for(const t of r.deepNodes){const n=r.liftNode(t);if(null!=n)for(const i of t.outEdges.values()){const s=i.target,o=r.liftNode(s);if(null==o||n==t&&o==s||n==o)continue;i.remove();const a=new cT(n,o),l=new io(a);e.push([l,i])}}return e}(r.graph),l=function O5(r){const e=r.graph,t=function*zW(r){const e=new Set,t=new eo.c;for(const s of r.shallowNodes){if(e.has(s))continue;const o=new Array;for(i(s,t,e);t.length>0;){const a=t.dequeue();o.push(a);for(const l of n(a))i(l,t,e)}yield o}function*n(s){for(const o of s.outEdges)yield o.target;for(const o of s.inEdges)yield o.source}function i(s,o,a){a.has(s)||(o.enqueue(s),a.add(s))}}(e),n=[];let i=0;for(const s of t){const o=new Tr(e.id+i++);o.parent=e;const a=new Ii(o);a.layoutSettings=r.layoutSettings;for(const l of s)l.parent=o,o.addNode(l);n.push(a)}return n}(r);(function L(){if(0!=l.length){for(const F of l)t(F,e);i(r,l)}})(),a.forEach(F=>{F[0].edge.remove(),F[1].add()}),l.forEach(F=>{for(const G of F.graph.shallowNodes)G.parent=r.graph});const c=function u(F){const G=[];for(const J of F.deepNodes()){for(const te of J.outEdges())null==te.curve&&G.push(te);for(const te of J.selfEdges())null==te.curve&&G.push(te)}return G}(r);o.forEach(F=>F.add()),n(r,c,e),null==r.graph.parent&&s&&r.FlipYAndMoveLeftTopToOrigin()}class wy{static constructorStatic(e,t){const n=new wy;n.edges=e,n.nodeBoundaries=t,n.boundingBox=Ne.mkEmpty();for(const i of n.nodeBoundaries)n.boundingBox=n.boundingBox.addRec(i.boundingBox);return n}AddGraph(e){this.edges=this.edges.concat(e.edges),this.nodeBoundaries=gl(this.nodeBoundaries,e.nodeBoundaries),this.boundingBox.addRec(e.boundingBox)}AddNodeBoundary(e){this.nodeBoundaries.add(e),this.boundingBox.addRec(e.boundingBox)}}var Ru=(()=>{return(r=Ru||(Ru={}))[r.Success=0]="Success",r[r.Overlaps=1]="Overlaps",r[r.EdgeSeparationIsTooLarge=2]="EdgeSeparationIsTooLarge",Ru;var r})(),dP=h(2243);class rf{constructor(e,t,n){this.currentTriangle=e,this.start=t,this.end=n}get CurrentPiercedEdge(){return this.currentPiercedEdge}get CurrentTriangle(){return this.currentTriangle}*Triangles(){for(;this.MoveNext();)yield this.CurrentTriangle}FindFirstPiercedEdge(){const e=this.GetHyperplaneSign(this.currentTriangle.Sites.item0),t=this.GetHyperplaneSign(this.currentTriangle.Sites.item1);if(e!=t&&x.getTriangleOrientation(this.end,this.currentTriangle.Sites.item0.point,this.currentTriangle.Sites.item1.point)==Ie.Clockwise)return this.positiveSign=e,this.negativeSign=t,this.currentTriangle.TriEdges.item0;const n=this.GetHyperplaneSign(this.currentTriangle.Sites.item2);return t!=n&&x.getTriangleOrientation(this.end,this.currentTriangle.Sites.item1.point,this.currentTriangle.Sites.item2.point)==Ie.Clockwise?(this.positiveSign=t,this.negativeSign=n,this.currentTriangle.TriEdges.item1):(this.positiveSign=n,this.negativeSign=e,this.currentTriangle.TriEdges.item2)}static PointLocationForTriangle(e,t){let n=!1;for(let i=0;i<3;i++){const s=x.signedDoubledTriangleArea(e,t.Sites.getItem(i).point,t.Sites.getItem(i+1).point);if(s<-1*q.distanceEpsilon)return Fe.Outside;s<q.distanceEpsilon&&(n=!0)}return n?Fe.Boundary:Fe.Inside}FindNextPierced(){if(this.currentTriangle=this.currentPiercedEdge.GetOtherTriangle_T(this.currentTriangle),null==this.currentTriangle)return void(this.currentPiercedEdge=null);const e=this.currentTriangle.TriEdges.index(this.currentPiercedEdge);let t;const n=this.currentTriangle.Sites.getItem(e+2),i=this.GetHyperplaneSign(n);0==this.negativeSign?-1==i||0==i?(this.negativeSign=i,t=e+1):t=e+2:0==this.positiveSign?1==i||0==i?(this.positiveSign=i,t=e+2):t=e+1:i!=this.positiveSign?(this.negativeSign=i,t=e+1):(this.positiveSign=i,t=e+2),this.currentPiercedEdge=x.signedDoubledTriangleArea(this.end,this.currentTriangle.Sites.getItem(t).point,this.currentTriangle.Sites.getItem(t+1).point)<-q.distanceEpsilon?this.currentTriangle.TriEdges.getItem(t):null}GetHyperplaneSign(e){const t=x.signedDoubledTriangleArea(this.start,e.point,this.end);return t>q.distanceEpsilon?1:t<-1*q.distanceEpsilon?-1:0}MoveNext(){return null==this.currentPiercedEdge?this.currentPiercedEdge=this.FindFirstPiercedEdge():this.FindNextPierced(),null!=this.currentPiercedEdge}}class vy{constructor(e,t){this.ComputeForcesForBundles=!1,this.metroGraphData=e,this.bundlingSettings=t}EdgeIsLegal_(e,t,n,i){if(nn.PointIsInsideOfTriangle(t,n))return!0;const s=new rf(n,e,t);for(;s.MoveNext();){const o=s.CurrentPiercedEdge;if(o.Constrained&&!i.has(o.lowerSite.Owner))return!1}return!0}BundleAvoidsObstacles(e,t,n,i,s,o){o.closestDist=new Array;const a=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(e,t),l=this.FindCloseObstaclesForBundle(t.CdtTriangle,i,n,a,s);if(null==l)return!1;for(const c of l)o.closestDist.push(c[1]);return!0}FindCloseObstaclesForBundle(e,t,n,i,s){const o=new Map,a=[];if(!this.ThreadLineSegmentThroughTriangles(e,t,n,i,a))return null;if(!this.ComputeForcesForBundles&&!this.bundlingSettings.HighestQuality)return o;const l=new dP.HashSet;for(const c of a)for(const u of c.Sites){if(l.has(u))continue;l.add(u);const S=u.Owner;if(i.has(S))continue;const b=vy.FindPolylinePoint(S,u.point),L=me.minDistBetweenLineSegments(b.point,b.nextOnPolyline.point,t,n),F=L.dist,G=L.parab,J=L.parcd,te=me.minDistBetweenLineSegments(b.point,b.prevOnPolyline.point,t,n),ie=te.dist,he=te.parab,Ce=te.parcd;let be,Je,rt;if(F<ie){if(rt=F,rt>s)continue;be=b.point.add(b.nextOnPolyline.point.sub(b.point).mul(G)),Je=t.add(n.sub(t).mul(J))}else{if(rt=ie,rt>s)continue;be=b.point.add(b.prevOnPolyline.point.sub(b.point).mul(he)),Je=t.add(n.sub(t).mul(Ce))}o.get(S)||o.set(S,[be,Je])}return o}ThreadLineSegmentThroughTriangles(e,t,n,i,s){if(nn.PointIsInsideOfTriangle(n,e))return s.push(e),!0;const o=new rf(e,t,n);for(s.push(e);o.MoveNext();){s.push(o.CurrentTriangle);const a=o.CurrentPiercedEdge;if(a.Constrained&&!i.has(a.lowerSite.Owner))return!1}return null!=o.CurrentTriangle&&s.push(o.CurrentTriangle),!0}static PointLocationInsideTriangle(e,t){let n=!1;for(let i=0;i<3;i++){const s=x.signedDoubledTriangleArea(e,t.Sites.getItem(i).point,t.Sites.getItem(i+1).point);if(s<-1*q.distanceEpsilon)return Fe.Outside;s<q.distanceEpsilon&&(n=!0)}return n?Fe.Boundary:Fe.Inside}static FindPolylinePoint(e,t){for(const n of e.polylinePoints())if(n.point.equal(t))return n;throw new Error("polyline point "+t+" not found")}EdgeIsLegal(e,t,n,i){const o=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(e,t);return this.ThreadLineSegmentThroughTriangles(e.CdtTriangle,n,i,o,[])}static closedeb(e,t){return e.Position.sub(new x(360.561,428.416)).length<.1&&t.Position.sub(new x(414.281,440.732)).length<.1}EdgeIsLegalSSPPS(e,t,n){const i=e.Position,s=e.CdtTriangle,o=t.Position;if(nn.PointIsInsideOfTriangle(o,s))return!0;const a=new rf(s,i,o);for(;a.MoveNext();){const l=a.CurrentPiercedEdge;if(l.Constrained&&!n.has(l.lowerSite.Owner))return!1}return!0}}class Di{constructor(e,t,n,i){this.metroGraphData=e,this.obstaclesToIgnoreLambda=i,this.bundlingSettings=t,this.obstacleTree=n}ObstaclesToIgnoreForBundle(e,t){return null!=e&&null!=t?gl(this.obstaclesToIgnoreLambda(e),this.obstaclesToIgnoreLambda(t)):null==e&&null==t?new Set:this.obstaclesToIgnoreLambda(null!=e?e:t)}HubAvoidsObstaclesSPNBA(e,t,n,i){const s={minimalDistance:n};return Di.IntersectCircleWithTree(this.obstacleTree,t,n,this.obstaclesToIgnoreLambda(e),i.touchedObstacles,s)}HubAvoidsObstaclesPNS__(e,t,n){const i={touchedObstacles:Array()};return this.HubAvoidsObstaclesPNSTT(e,t,n,i,{minimalDistance:0})}GetMinimalDistanceToObstacles(e,t,n){const i=new Array,s={minimalDistance:n};return Di.IntersectCircleWithTree(this.obstacleTree,t,n,this.obstaclesToIgnoreLambda(e),i,s)?s.minimalDistance:0}HubAvoidsObstaclesPNSTT(e,t,n,i,s){return i.touchedObstacles=new Array,s.minimalDistance=t,Di.IntersectCircleWithTree(this.obstacleTree,e,t,n,i.touchedObstacles,s)}static IntersectCircleWithTree(e,t,n,i,s,o){if(!e.irect.contains_point_radius(t,n))return!0;if(null==e.UserData){let a=Di.IntersectCircleWithTree(e.Left,t,n,i,s,o);if(!a||(a=Di.IntersectCircleWithTree(e.Right,t,n,i,s,o),!a))return!1}else{const a=e.UserData;if(i.has(a))return!0;if(ee.PointRelativeToCurveLocation(t,a)!=Fe.Outside)return Di.containingPoly=a,!1;const c=a.value(a.closestParameter(t)),u=c.sub(t).length;u<=n&&s.push([a,c]),o.minimalDistance=Math.min(u,o.minimalDistance)}return!0}static Create4gon(e,t,n,i){let s=t.sub(e).normalize();return s=new x(s.y,-1*s.x),Me.mkFromPoints([e.add(s.mul(n/2)),e.sub(s.mul(n/2)),t.sub(s.mul(i/2)),t.add(s.mul(i/2))])}}class T5{constructor(e,t,n,i){this.Width=t,this.Polyline=e,this.sourceAndTargetLoosePolylines=n,this.Index=i}UpdateLengths(){let e=0;for(let t=this.Polyline.startPoint;null!=t.next;t=t.next)e+=t.next.point.sub(t.point).length;this.Length=e,this.IdealLength=this.Polyline.end.sub(this.Polyline.start).length}}class P5{constructor(e,t,n){this.metroline=e,this.station=t,this.polyPoint=n}get Metroline(){return this.metroline}get PolyPoint(){return this.polyPoint}}class N5{constructor(e,t,n){this.Radius=0,this.BundleBases=new Map,this.MetroNodeInfos=new Array,this._cachedIdealRadius=0,this.SerialNumber=e,this.IsReal=t,this.Position=n}debStop(){return 28==this.SerialNumber&&this.Position.sub(new x(841.2662778763244,303.3817005853006)).length<.001}get Position(){return this._Position}set Position(e){this._Position=e}getELP(){return this.EnterableLoosePolylines}setELP(e){this.EnterableLoosePolylines=e}addEL(e){this.EnterableLoosePolylines.add(e)}static less(e,t){return e.SerialNumber<t.SerialNumber}static greater(e,t){return e.SerialNumber>t.SerialNumber}get cachedIdealRadius(){return this._cachedIdealRadius}set cachedIdealRadius(e){this._cachedIdealRadius=e}AddEnterableLoosePolyline(e){null==this.EnterableLoosePolylines&&(this.EnterableLoosePolylines=new Set),this.EnterableLoosePolylines.add(e)}AddEnterableTightPolyline(e){null==this.EnterableTightPolylines&&(this.EnterableTightPolylines=new Set),this.EnterableTightPolylines.add(e)}}class D5{constructor(){this.Width=0,this.Metrolines=new Array,this.cachedBundleCost=0}get Count(){return this.Metrolines.length}}class jn{constructor(e,t){this.metroGraphData=e,this.bundlingSettings=t}CreateNodeRadii(){for(const e of this.metroGraphData.VirtualStations())e.Radius=0,e.cachedIdealRadius=jn.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,e);this.GrowHubs(!1),this.GrowHubs(!0);for(const e of this.metroGraphData.VirtualStations())e.Radius=Math.max(e.Radius,this.bundlingSettings.MinHubRadius)}GrowHubs(e){const t=new ho(Tt);for(const i of this.metroGraphData.VirtualStations())t.Enqueue(i,-this.CalculatePotential(i,e));let n=!1;for(;!t.IsEmpty();){const i={priority:0},s=t.DequeueAndGetPriority(i);if(i.priority>=0)break;this.TryGrowHub(s,e)&&(t.Enqueue(s,-this.CalculatePotential(s,e)),n=!0)}return n}TryGrowHub(e,t){const n=this.CalculateAllowedHubRadius(e);if(e.Radius>=n)return!1;const i=t?jn.CalculateIdealHubRadiusWithAdjacentEdges(this.bundlingSettings,e):e.cachedIdealRadius;if(e.Radius>=i)return!1;let o=.05*(i-e.Radius);o<1&&(o=1);const a=Math.min(e.Radius+o,n);return!(a<=e.Radius||(e.Radius=a,0))}CalculatePotential(e,t){const n=t?jn.CalculateIdealHubRadiusWithAdjacentEdges(this.bundlingSettings,e):e.cachedIdealRadius;return n<=e.Radius?0:(n-e.Radius)/n}CalculateAllowedHubRadius(e){let t=this.bundlingSettings.MaxHubRadius;for(const i of e.Neighbors){const s=i.Position.sub(e.Position).length;t=Math.min(t,s/1.05-i.Radius)}const n=this.metroGraphData.tightIntersections.GetMinimalDistanceToObstacles(e,e.Position,t);return n<t&&(t=n-.001),Math.max(t,.1)}static CalculateIdealHubRadius(e,t,n){let i=1;for(const s of n.Neighbors){const a=e.GetWidthSSN(s,n,t.EdgeSeparation)/2+t.EdgeSeparation;i=Math.max(i,a)}return i=Math.min(i,2*t.MaxHubRadius),i}static CalculateIdealHubRadiusWithNeighborsMBS(e,t,n){return jn.CalculateIdealHubRadiusWithNeighborsMBNP(e,t,n,n.Position)}static CalculateIdealHubRadiusWithNeighborsMBNP(e,t,n,i){let s=jn.CalculateIdealHubRadius(e,t,n);if(n.Neighbors.length>1){const o=n.Neighbors;for(let a=0;a<o.length;a++)s=Math.max(s,jn.GetMinRadiusForTwoAdjacentBundles(s,n,i,o[a],o[(a+1)%o.length],e,t))}return s=Math.min(s,2*t.MaxHubRadius),s}static CalculateIdealHubRadiusWithAdjacentEdges(e,t){let n=e.MaxHubRadius;for(const i of t.Neighbors)n=Math.min(n,t.Position.sub(i.Position).length/2);return n}static GetMinRadiusForTwoAdjacentBundles(e,t,n,i,s,o,a){const l=o.GetWidthSSN(t,i,a.EdgeSeparation),c=o.GetWidthSSN(t,s,a.EdgeSeparation);return jn.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(e,n,i.Position,s.Position,l,c,a)}static GetMinRadiusForTwoAdjacentBundlesNPPPNNB(e,t,n,i,s,o,a){if(s<q.distanceEpsilon||o<q.distanceEpsilon)return e;let l=x.anglePCP(n,t,i);if(l=Math.min(l,2*Math.PI-l),l<q.distanceEpsilon)return 2*a.MaxHubRadius;if(l>=Math.PI/2)return 1.05*e;const c=Math.sin(l),u=Math.cos(l),S=s/(4*c),b=o/(4*c);let L=2*Math.sqrt(S*S+(b*b+S*(b*u)*2));return L=Math.min(L,2*a.MaxHubRadius),L=Math.max(L,e),L}}class sf{constructor(e,t,n,i){this.metroGraphData=e,this.bundlingSettings=t,this.costCalculator=n,this.cdt=i}InitializeCostCache(){for(const e of this.metroGraphData.VirtualStations())e.cachedIdealRadius=jn.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,e),e.cachedRadiusCost=this.costCalculator.RadiusCost(e,e.Position),e.cachedBundleCost=0;for(const e of this.metroGraphData.VirtualEdges()){const t=e[0],n=e[1],i=this.metroGraphData.GetIjInfo(t,n);i.cachedBundleCost=this.costCalculator.BundleCost(t,n,t.Position),t.cachedBundleCost+=i.cachedBundleCost,n.cachedBundleCost+=i.cachedBundleCost}}UpdateCostCache(e){const t=this.cdt.GetCdtTree();e.CdtTriangle=t.FirstHitNodeWithPredicate(e.Position,sf.testPointInside).UserData,e.cachedIdealRadius=jn.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,e),e.cachedRadiusCost=this.costCalculator.RadiusCost(e,e.Position),e.cachedBundleCost=0;for(const n of e.Neighbors){n.IsReal||(n.cachedIdealRadius=jn.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,n),n.cachedRadiusCost=this.costCalculator.RadiusCost(n,n.Position));const i=this.metroGraphData.GetIjInfo(e,n);n.cachedBundleCost-=i.cachedBundleCost,i.cachedBundleCost=this.costCalculator.BundleCost(e,n,e.Position),e.cachedBundleCost+=i.cachedBundleCost,n.cachedBundleCost+=i.cachedBundleCost}}static testPointInside(e,t){return nn.PointIsInsideOfTriangle(e,t)?Pt.Stop:Pt.Continue}}class fP{constructor(){this.mainMap=new Map}get isEmpty(){return 0==this.mainMap.size||this.everyMapIsEmpty()}everyMapIsEmpty(){for(const e of this.mainMap.values())if(e.size)return!1;return!0}get(e,t){const n=this.mainMap.get(e);if(n)return n.get(t)}has(e,t){const n=this.mainMap.get(e);return!!n&&n.has(t)}set(e,t,n){let i=this.mainMap.get(e);i||(i=new Map,this.mainMap.set(e,i)),i.set(t,n)}*[Symbol.iterator](){for(const[e,t]of this.mainMap)for(const[n,i]of t)yield[e,n,i]}*keys(){for(const[e,t]of this.mainMap)for(const[n]of t)yield[e,n]}}class L5{constructor(e,t,n,i,s,o,a,l){this.cachedEnterableLooseForEnd=new cr,this.regularEdges=e,this.Cdt=null!=s?s:bl.CreateConstrainedDelaunayTriangulation(t),this.EdgeLooseEnterable=o,this.EdgeTightEnterable=a,this.LoosePolylineOfPort=l,this.looseIntersections=new Di(this,i,t,c=>c.getELP()),this.tightIntersections=new Di(this,i,n,c=>c.EnterableTightPolylines),this.cdtIntersections=new vy(this,i),this.Initialize(!1)}get Ink(){return this.ink}get Edges(){return this.regularEdges}VirtualStations(){return Array.from(this.Stations).filter(e=>!e.IsReal)}get Metrolines(){return this.metrolines}get LooseTree(){return this.looseIntersections.obstacleTree}get TightTree(){return this.tightIntersections.obstacleTree}*VirtualEdges(){for(const e of this.edgeInfoDictionary.keys())yield e}RealEdgeCount(e,t){const n=e.SerialNumber<t.SerialNumber?[e,t]:[t,e],i=this.edgeInfoDictionary.get(n[0],n[1]);return i?i.Count:0}MetroNodeInfosOfNode(e){return e.MetroNodeInfos}GetIjInfo(e,t){const n=e.SerialNumber<t.SerialNumber?[e,t]:[t,e];return this.edgeInfoDictionary.get(n[0],n[1])}MoveNode(e,t){const n=e.Position;this.PointToStations.deleteP(n),this.PointToStations.set(t,e),e.Position=t;for(const i of this.MetroNodeInfosOfNode(e))i.PolyPoint.point=t;for(const i of this.MetroNodeInfosOfNode(e)){const o=i.PolyPoint.prev.point,a=i.PolyPoint.next.point;i.Metroline.Length+=a.sub(t).length+o.sub(t).length-a.sub(n).length-o.sub(n).length}for(const i of e.Neighbors)this.ink+=t.sub(i.Position).length-n.sub(i.Position).length;this.SortNeighbors(e);for(const i of e.Neighbors)this.SortNeighbors(i)}GetWidthSSN(e,t,n){const i=e.SerialNumber<t.SerialNumber?[e,t]:[t,e],s=this.edgeInfoDictionary.get(i[0],i[1]);return s?s.Width+(s.Count-1)*n:0}GetWidthAN(e,t){let n=0;for(const s of e)n+=s.Width;const i=e.length;return n+=i>0?(i-1)*t:0,n}Initialize(e){this.SimplifyRegularEdges(),this.InitializeStationData(),this.InitializeEdgeData(),this.InitializeVirtualGraph(),this.InitializeEdgeNodeInfo(e),this.InitializeCdtInfo()}SimplifyRegularEdges(){for(const e of this.regularEdges)this.SimplifyRegularEdge(e)}SimplifyRegularEdge(e){const t=e.curve,n=new kt.K,i=new un;for(let s=t.endPoint;null!=s;s=s.prev){const o=s.point;if(i.has(s.point)){let a=s.next;for(;;){const l=n.top;if(l.equal(o))break;i.delete(l),n.pop(),a=a.next}a.prev=s.prev,a.prev.next=a}else n.push(o),i.add(o)}}InitializeStationData(){this.Stations=[],this.PointToStations=new cr;for(const e of this.regularEdges)this.ProcessPolylinePoints(e.curve)}ProcessPolylinePoints(e){let t=e.startPoint;for(this.RegisterStation(t,!0),t=t.next;t!=e.endPoint;t=t.next)this.RegisterStation(t,!1);this.RegisterStation(t,!0)}RegisterStation(e,t){if(!this.PointToStations.has(e.point)){const n=new N5(this.Stations.length,t,e.point);this.PointToStations.set(e.point,n),this.Stations.push(n)}}InitializeEdgeData(){this.metrolines=new Array;for(let e=0;e<this.regularEdges.length;e++)this.InitEdgeData(this.regularEdges[e],e)}InitEdgeData(e,t){const n=new T5(e.curve,e.lineWidth,this.EdgeSourceAndTargetFunc(e),t);this.metrolines.push(n),this.PointToStations.get(n.Polyline.start).BoundaryCurve=e.sourcePort.Curve,this.PointToStations.get(n.Polyline.end).BoundaryCurve=e.targetPort.Curve}EdgeSourceAndTargetFunc(e){return()=>[this.LoosePolylineOfPort(e.sourcePort),this.LoosePolylineOfPort(e.targetPort)]}InitializeVirtualGraph(){const e=new Map;for(const t of this.metrolines){let i,n=this.PointToStations.get(t.Polyline.start);for(let s=t.Polyline.startPoint;null!=s.next;s=s.next,n=i)i=this.PointToStations.get(s.next.point),Hd(e,n,i),Hd(e,i,n)}for(const t of this.Stations)t.Neighbors=Array.from(e.get(t))}GetUnorderedIjInfo(e,t){return e.SerialNumber<t.SerialNumber?this.GetCreateOrderedIjInfo(e,t):this.GetCreateOrderedIjInfo(t,e)}static closedeb(e,t){return e.Position.sub(new x(360.561,428.416)).length<.1&&t.Position.sub(new x(414.281,440.732)).length<.1}GetCreateOrderedIjInfo(e,t){let n=this.edgeInfoDictionary.get(e,t);return n||(n=new D5,this.edgeInfoDictionary.set(e,t,n),n)}InitializeEdgeNodeInfo(e){this.edgeInfoDictionary=new fP,this.InitAllMetroNodeInfos(e),this.SortAllNeighbors(),this.InitEdgeIjInfos(),this.ink=0;for(const t of this.VirtualEdges())this.ink+=t[0].Position.sub(t[1].Position).length}InitAllMetroNodeInfos(e){for(let t=0;t<this.metrolines.length;t++){const n=this.metrolines[t];this.InitMetroNodeInfos(n),this.InitNodeEnterableLoosePolylines(n,this.regularEdges[t]),e&&this.InitNodeEnterableTightPolylines(n,this.regularEdges[t]),n.UpdateLengths()}}InitMetroNodeInfos(e){for(let t=e.Polyline.startPoint;null!=t;t=t.next){const n=this.PointToStations.get(t.point);n.MetroNodeInfos.push(new P5(e,n,t))}}InitNodeEnterableLoosePolylines(e,t){const n=null!=this.EdgeLooseEnterable?this.EdgeLooseEnterable.get(t):new Set;for(let i=e.Polyline.startPoint.next;null!=i&&null!=i.next;i=i.next){const s=this.PointToStations.get(i.point);null!=s.getELP()?s.setELP(ao(s.getELP(),n)):s.setELP(new Set(n))}this.AddLooseEnterableForMetrolineStartEndPoints(e)}AddLooseEnterableForMetrolineStartEndPoints(e){this.AddLooseEnterableForEnd(e.Polyline.start),this.AddLooseEnterableForEnd(e.Polyline.end)}AddTightEnterableForMetrolineStartEndPoints(e){this.AddTightEnterableForEnd(e.Polyline.start),this.AddTightEnterableForEnd(e.Polyline.end)}AddLooseEnterableForEnd(e){const t=this.PointToStations.get(e);if(this.cachedEnterableLooseForEnd.has(e))t.setELP(this.cachedEnterableLooseForEnd.get(e));else{for(const n of this.LooseTree.AllHitItems_(e))ee.PointRelativeToCurveLocation(e,n)==Fe.Inside&&t.AddEnterableLoosePolyline(n);this.cachedEnterableLooseForEnd.set(e,t.getELP())}}AddTightEnterableForEnd(e){const t=this.PointToStations.get(e);for(const n of this.TightTree.AllHitItems_(e))ee.PointRelativeToCurveLocation(e,n)==Fe.Inside&&t.AddEnterableTightPolyline(n)}InitNodeEnterableTightPolylines(e,t){const n=null!=this.EdgeTightEnterable?this.EdgeTightEnterable.get(t):new Set;for(let i=e.Polyline.startPoint.next;null!=i&&null!=i.next;i=i.next){const s=this.PointToStations.get(i.point),o=s.EnterableTightPolylines;s.EnterableTightPolylines=null!=o?ao(o,n):new Set(n)}this.AddTightEnterableForMetrolineStartEndPoints(e)}SortAllNeighbors(){for(const e of this.Stations)this.SortNeighbors(e)}SortNeighbors(e){if(e.Neighbors.length<=2)return;const t=e.Neighbors[0].Position,n=e.Position;e.Neighbors.sort((i,s)=>Xo(t.sub(n),i.Position.sub(n),s.Position.sub(n)))}InitEdgeIjInfos(){for(const e of this.metrolines){let i,n=this.PointToStations.get(e.Polyline.start);for(let s=e.Polyline.startPoint;null!=s.next;s=s.next,n=i){i=this.PointToStations.get(s.next.point);const o=this.GetUnorderedIjInfo(n,i);o.Width+=e.Width,o.Metrolines.push(e)}}}InitializeCdtInfo(){const e=this.Cdt.GetCdtTree();for(const t of this.Stations)t.CdtTriangle=e.FirstHitNodeWithPredicate(t.Position,sf.testPointInside).UserData}PointIsAcceptableForEdge(e,t){if(null==this.LoosePolylineOfPort)return!0;const n=e.sourceAndTargetLoosePolylines();return ee.PointRelativeToCurveLocation(t,n[0])==Fe.Outside&&ee.PointRelativeToCurveLocation(t,n[1])==Fe.Outside}}function Xo(r,e,t){r=r.mul(1e3),e=e.mul(1e3),t=t.mul(1e3);const i=x.crossProduct(r,t),s=r.dot(t),o=x.crossProduct(r,e),a=r.dot(e);return nt(o,0)&&af(a,0)?nt(i,0)&&af(s,0)?0:1:nt(i,0)&&af(s,0)?-1:nt(o,0)||nt(i,0)||o*i>0?cl(x.crossProduct(t,e),0):-cl(Math.sign(o),0)}function af(r,e){return cl(r,e)>=0}let Gr=(()=>{class r{constructor(t,n){this.metroGraphData=t,this.bundlingSettings=n}static InkError(t,n,i){return(t-n)*i.InkImportance}static PathLengthsError(t,n,i,s){return s.PathLengthImportance/i*(t-n)}static RError(t,n,i){return t<=n?0:i.HubRepulsionImportance*((1-n/t)*(t-n))}static BundleError(t,n,i){return t<=n?0:i.BundleRepulsionImportance*((1-n/t)*(t-n))}static Cost(t,n){let i=n.InkImportance*t.Ink;for(const s of t.Metrolines)i+=n.PathLengthImportance*s.Length/s.IdealLength;return i+=this.CostOfForces(t),i}static CostOfForces(t){let n=0;for(const i of t.VirtualStations())n+=i.cachedRadiusCost;for(const i of t.VirtualEdges())n+=t.GetIjInfo(i[0],i[1]).cachedBundleCost;return n}InkGain(t,n){const i=this.metroGraphData.Ink;let s=this.metroGraphData.Ink;for(const o of t.Neighbors){const a=o.Position;s-=a.sub(t.Position).length,s+=a.sub(n).length}return r.InkError(i,s,this.bundlingSettings)}PathLengthsGain(t,n){let i=0;for(const s of this.metroGraphData.MetroNodeInfosOfNode(t)){const o=s.Metroline.Length,a=s.PolyPoint.prev.point,l=s.PolyPoint.next.point,c=s.Metroline.Length+l.sub(n).length+a.sub(n).length-l.sub(t.Position).length-a.sub(t.Position).length;i+=r.PathLengthsError(o,c,s.Metroline.IdealLength,this.bundlingSettings)}return i}RadiusGain(t,n){let i=0;return i+=t.cachedRadiusCost,i-=this.RadiusCost(t,n),i}RadiusCost(t,n){let i;i=x.closeDistEps(t.Position,n)?t.cachedIdealRadius:jn.CalculateIdealHubRadiusWithNeighborsMBNP(this.metroGraphData,this.bundlingSettings,t,n);const s={touchedObstacles:[]};if(!this.metroGraphData.looseIntersections.HubAvoidsObstaclesSPNBA(t,n,i,s))return r.Inf;let o=0;for(const a of s.touchedObstacles){const l=a[1].sub(n).length;o+=r.RError(i,l,this.bundlingSettings)}return o}BundleGain(t,n){let i=t.cachedBundleCost;for(const s of t.Neighbors){const o=this.BundleCost(t,s,n);if(af(o,r.Inf))return-r.Inf;i-=o}return i}BundleCost(t,n,i){const s=this.metroGraphData.GetWidthSSN(t,n,this.bundlingSettings.EdgeSeparation),o={closestDist:[]};if(!this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(t,n,i,n.Position,s,o))return r.Inf;let a=0;for(const l of o.closestDist){const c=l[0].sub(l[1]).length;a+=r.BundleError(s/2,c,this.bundlingSettings)}return a}}return r.Inf=1e9,r})();class x5{constructor(e){this.polylineToEdgeGeom=new Map,this.pathsThroughPoints=new cr,this.interestingPoints=new un,this.metroGraphData=e}get Polylines(){return Array.from(this.polylineToEdgeGeom.keys())}Run(){this.Init(),this.SwitchFlips()}Init(){for(const e of this.metroGraphData.Edges)this.polylineToEdgeGeom.set(e.curve,e);for(const e of this.Polylines)this.RegisterPolylinePointInPathsThrough(e.polylinePoints())}RegisterPolylinePointInPathsThrough(e){for(const t of e)this.RegisterPolylinePointInPathsThroughP(t)}RegisterPolylinePointInPathsThroughP(e){!function M5(r,e,t){let n=r.get(e);n||(n=new Set,r.set(e,n)),n.add(t)}(this.pathsThroughPoints,e.point,e)}UnregisterPolylinePointsInPathsThrough(e){for(const t of e)this.UnregisterPolylinePointInPathsThrough(t)}UnregisterPolylinePointInPathsThrough(e){!function _5(r,e,t){const n=r.get(e);!n||(n.delete(t),0==n.size&&r.deleteP(e))}(this.pathsThroughPoints,e.point,e)}SwitchFlips(){const e=new Set(this.Polylines),t=new eo.c;for(const n of this.Polylines)t.enqueue(n);for(;t.length>0;){const n=t.dequeue();e.delete(n);const i=this.ProcessPolyline(n);null!=i&&(e.has(n)||(e.add(n),t.enqueue(n)),e.has(i)||(e.add(i),t.enqueue(i)))}}ProcessPolyline(e){const t=new Map;for(let n=e.startPoint.next;null!=n;n=n.next){this.FillDepartedPolylinePoints(n,t);for(const i of this.pathsThroughPoints.get(n.point)){const s=t.get(i.polyline);if(s){if(this.ProcessFlip(n,s))return i.polyline;t.delete(i.polyline)}}}return null}FillDepartedPolylinePoints(e,t){const n=e.prev.point;for(const i of this.pathsThroughPoints.get(n))this.IsNeighborOnTheSamePolyline(i,e)||t.has(i.polyline)||t.set(i.polyline,i)}ProcessFlip(e,t){const n=e.polyline,i=t.polyline,s=e.point,o=t.point,a=this.polylineToEdgeGeom.get(n),l=this.polylineToEdgeGeom.get(i);if(a.lineWidth!=l.lineWidth||null==this.metroGraphData.EdgeLooseEnterable||!Vd(this.metroGraphData.EdgeLooseEnterable.get(a),this.metroGraphData.EdgeLooseEnterable.get(l)))return!1;let c=this.FindPointsOnPolyline(n,s,o);const u=c[0],S=c[1],b=c[2];c=this.FindPointsOnPolyline(i,s,o);const L=c[0],F=c[1],G=c[2],J=this.FindRelationOnFirstPoint(u,L,b,G),te=this.FindRelationOnLastPoint(S,F,b,G);return(2==J||2==te)&&1!=J&&1!=te&&(this.UnregisterPolylinePointsInPathsThrough(n.polylinePoints()),this.UnregisterPolylinePointsInPathsThrough(i.polylinePoints()),this.Swap(u,L,S,F,b,G),this.RegisterPolylinePointInPathsThrough(n.polylinePoints()),this.RegisterPolylinePointInPathsThrough(i.polylinePoints()),this.RegisterInterestingPoint(u.point),this.RegisterInterestingPoint(S.point),this.numberOfReducedCrossings++,!0)}FindPointsOnPolyline(e,t,n){let i,s;for(let o=e.startPoint;null!=o;o=o.next)if(null==i)if(o.point.equal(t)){if(null!=s)return[o,s,!1];i=o}else null==s&&o.point.equal(n)&&(s=o);else if(o.point.equal(n))return[i,o,!0]}PolylinePointsAreInForwardOrder(e,t){for(let n=e;null!=n;n=n.next)if(n==t)return!0;return!1}Next(e,t){return t?e.next:e.prev}Prev(e,t){return t?e.prev:e.next}FindRelationOnFirstPoint(e,t,n,i){const s=e,o=t;for(;;){const a=this.Prev(e,n),l=this.Prev(t,i);if(null==a||null==l)return 0;if(!a.point.equal(l.point))break;e=a,t=l}return this.PolylinesIntersect(s,o,e,t,n,i)}FindRelationOnLastPoint(e,t,n,i){const s=e,o=t;for(;;){const a=this.Next(e,n),l=this.Next(t,i);if(null==a||null==l)return 0;if(!a.point.equal(l.point))break;e=a,t=l}for(;this.Next(e,n).point.equal(this.Prev(t,i).point);)e=this.Next(e,n),t=this.Prev(t,i);return this.PolylinesIntersect(e,t,s,o,n,i)}PolylinesIntersect(e,t,n,i,s,o){const a=this.Prev(e,s),l=this.Next(e,s),c=this.Next(n,s),u=this.Prev(n,s),S=this.Next(t,o),b=this.Prev(i,o);if(e.point.equal(n.point)){const L=e.point;return Xo(u.point.sub(L),b.point.sub(L),l.point.sub(L))==Xo(u.point.sub(L),S.point.sub(L),l.point.sub(L))?1:2}return Xo(a.point.sub(e.point),l.point.sub(e.point),S.point.sub(e.point))==Xo(c.point.sub(n.point),b.point.sub(n.point),u.point.sub(n.point))?1:2}Swap(e,t,n,i,s,o){const a=this.GetRangeOnPolyline(this.Next(e,s),n,s),l=this.GetRangeOnPolyline(this.Next(t,o),i,o);this.ChangePolylineSegment(e,n,s,l),this.ChangePolylineSegment(t,i,o,a),Cu.RemoveSelfCyclesFromPolyline(e.polyline),Cu.RemoveSelfCyclesFromPolyline(t.polyline)}ChangePolylineSegment(e,t,n,i){let s=e;for(const o of i){const a=Pr.mkFromPoint(o.point);a.polyline=s.polyline,n?(a.prev=s,s.next=a):(a.next=s,s.prev=a),s=a}n?(s.next=t,t.prev=s):(s.prev=t,t.next=s)}GetRangeOnPolyline(e,t,n){const i=new Array;for(let s=e;s!=t;s=this.Next(s,n))i.push(s);return i}IsNeighborOnTheSamePolyline(e,t){return null!=e.prev&&e.prev.point.equal(t.point)||null!=e.next&&e.next.point.equal(t.point)}RegisterInterestingPoint(e){this.interestingPoints.has(e)||this.interestingPoints.add(e)}GetChangedHubs(){return this.interestingPoints}NumberOfReducedCrossings(){return this.numberOfReducedCrossings}PolylineIsOK(e){const t=new un;for(let n=e.startPoint;null!=n;n=n.next){if(n==e.startPoint){if(null!=n.prev)return!1}else if(n.prev.next!=n)return!1;if(n==e.endPoint){if(null!=n.next)return!1}else if(n.next.prev!=n)return!1;if(t.has(n.point))return!1;t.add(n.point)}return!(null!=e.startPoint.prev||null!=e.endPoint.next)}}class Cu{constructor(e,t){this.foundCrossings=new un,this.crossingsThatShouldBecomeHubs=new un,this.metroGraphData=e,this.polylineAcceptsPoint=t}*Vertices(){for(const e of this.Polylines)for(const t of e.polylinePoints())yield t}get Polylines(){return this.metroGraphData.Edges.map(e=>e.curve)}Edges(){const e=new fu;for(const t of this.Vertices())t.next&&e.set(new Gn(t.point,t.next.point),0);return Array.from(e.keys())}run(){if(0==this.metroGraphData.Edges.length)return!1;const e=new fu,t=new Bd(null);for(const a of this.Vertices()){const l=Ne.mkOnPoints([a.point]);l.pad(q.intersectionEpsilon),t.Add(l,a.point)}const n=FE(this.Edges(),a=>Ne.mkPP(a.First,a.Second));Un(n,n,(a,l)=>this.IntersectTwoEdges.bind(a,l,e,t)),this.SortInsertedPoints(e);const i=this.InsertPointsIntoPolylines(e),s=this.FixPaths(),o=this.RemoveUnimportantCrossings();return s||i||o}FixPaths(){let e=!1;return this.RemoveSelfCycles()&&(e=!0),this.ReduceEdgeCrossings()&&(e=!0),e}SortInsertedPoints(e){for(const t of e)this.SortInsideSegment(t[0],t[1])}SortInsideSegment(e,t){t.sort((n,i)=>Tt(wt(n,e.First),wt(i,e.First)))}InsertPointsIntoPolylines(e){let t=!1;for(const n of this.metroGraphData.Metrolines)return this.InsertPointsIntoPolyline(n,e)&&(t=!0),t}InsertPointsIntoPolyline(e,t){let n=!1;for(let i=e.Polyline.startPoint;null!=i.next;i=i.next)this.InsertPointsOnPolypoint(i,t,e)&&(n=!0);return n}InsertPointsOnPolypoint(e,t,n){const i=new Gn(e.point,e.next.point),s=e.point!=i.First,o=t.get(i);if(!o)return!1;const a=e.next,l=e.polyline;if(s)for(let c=o.length-1;c>=0;c--){if(null!=this.polylineAcceptsPoint&&!this.polylineAcceptsPoint(n,o[c]))continue;const u=Pr.mkFromPoint(o[c]);u.prev=e,u.polyline=l,e.next=u,e=u}else for(let c=0;c<o.length;c++){if(null!=this.polylineAcceptsPoint&&!this.polylineAcceptsPoint(n,o[c]))continue;const u=Pr.mkFromPoint(o[c]);u.prev=e,u.polyline=l,e.next=u,e=u}return e.next=a,a.prev=e,!0}RemoveSelfCycles(){let e=!1;for(const t of this.Polylines)Cu.RemoveSelfCyclesFromPolyline(t)&&(e=!0);return e}static RemoveSelfCyclesFromPolyline(e){let t=!1;const n=new cr;for(let i=e.startPoint;null!=i;i=i.next){const o=n.get(i.point);if(o){for(let a=o.next;a!=i.next;a=a.next)n.deleteP(a.point);o.next=i.next,i.next.prev=o,t=!0}else n.set(i.point,i)}return t}ReduceEdgeCrossings(){const e=new x5(this.metroGraphData);e.Run();for(const t of e.GetChangedHubs())this.crossingsThatShouldBecomeHubs.add(t);return e.NumberOfReducedCrossings()>0}RemoveUnimportantCrossings(){let e=!1;this.pointsToDelete=function w4(r,e){const t=new un;for(const n of r)e.has(n)||t.add(n);return t}(this.foundCrossings,this.crossingsThatShouldBecomeHubs);for(const t of this.Polylines)this.RemoveUnimportantCrossingsFromPolyline(t)&&(e=!0);return e}RemoveUnimportantCrossingsFromPolyline(e){let t=!1;for(let n=e.startPoint.next;null!=n&&null!=n.next;n=n.next)if(this.pointsToDelete.has(n.point)&&x.getTriangleOrientation(n.prev.point,n.point,n.next.point)==Ie.Collinear){const i=n.prev,s=n.next;i.next=s,s.prev=i,n=i,t=!0}return t}IntersectTwoEdges(e,t,n,i){const s=me.IntersectPPPP(e.First,e.Second,t.First,t.Second);if(s){const o=this.FindExistingVertexOrCreateNew(i,s);(this.AddVertexToSplittingList(e,n,o)||this.AddVertexToSplittingList(t,n,o))&&this.foundCrossings.add(o)}}FindExistingVertexOrCreateNew(e,t){const n=e.RootNode.FirstHitNode(t);if(null!=n)return n.UserData;const i=Ne.mkOnPoints([t]).pad(q.intersectionEpsilon);return e.Add(i,t),t}AddVertexToSplittingList(e,t,n){if(!ee.closeIntersectionPoints(n,e.First)&&!ee.closeIntersectionPoints(n,e.Second)){let i=t.get(e);if(i||(i=new Array,t.set(e,i)),!i.find(s=>s.equal(n)))return i.push(n),!0}return!1}}class gP{constructor(e,t,n,i){this.BelongsToRealNode=i,this.Curve=t,this.Position=n,this.points=new Array(e),this.tangents=new Array(e),this.OrientedHubSegments=new Array(e),this.ParameterSpan=this.Curve.parEnd-this.Curve.parStart}get Count(){return this.points.length}get CurveCenter(){return this.Curve.boundingBox.center}get OppositeBase(){return null!=this.OutgoingBundleInfo?this.OutgoingBundleInfo.TargetBase:this.IncomingBundleInfo.SourceBase}get length(){return this.points.length}get Points(){return this.points}get Tangents(){return this.tangents}get InitialMidParameter(){return this.initialMidParameter}set InitialMidParameter(e){this.initialMidParameter=e,this.InitialMidPoint=this.Curve.value(e)}get ParRight(){return this.parRight}set ParRight(e){this.parRight=e,this.RightPoint=this.Curve.value(this.parRight)}get ParLeft(){return this.parLeft}set ParLeft(e){this.parLeft=e,this.LeftPoint=this.Curve.value(this.parLeft)}get ParMid(){return(this.parRight+this.parLeft)/2}get MidPoint(){return x.middle(this.RightPoint,this.LeftPoint)}get Span(){return this.SpanBetweenTwoPoints(this.parRight,this.parLeft)}SpanBetweenTwoPoints(e,t){return e<=t?t-e:t-e+this.ParameterSpan}RotateLeftPoint(e,t){return 0==e?this.LeftPoint:this.RotatePoint(e,this.parLeft,t)}RotateRigthPoint(e,t){return 0==e?this.RightPoint:this.RotatePoint(e,this.parRight,t)}RotatePoint(e,t,n){return t=this.AdjustParam(t+=e*(this.ParameterSpan*n)),this.Curve.value(t)}AdjustParam(e){return e>this.Curve.parEnd?e=this.Curve.parStart+(e-this.Curve.parEnd):e<this.Curve.parStart&&(e=this.Curve.parEnd-(this.Curve.parStart-e)),e}RotateBy(e,t,n){const i=this.ParameterSpan*n;0!=e&&(this.ParRight=this.AdjustParam(this.ParRight+e*i)),0!=t&&(this.ParLeft=this.AdjustParam(this.ParLeft+t*i))}Intersect(e){return this.IntersectNNNB(this.parRight,this.parLeft,e.parRight,e.parLeft)}IntersectNNNB(e,t,n,i){return e>t?this.IntersectNNNB(e,this.Curve.parEnd,n,i)||this.IntersectNNNB(this.Curve.parStart,t,n,i):n>i?this.IntersectNNNB(e,t,n,this.Curve.parEnd)||this.IntersectNNNB(e,t,this.Curve.parStart,i):!(cl(t,n)||cl(i,e))}RelativeOrderOfBasesIsPreserved(e,t,n){const i=this.ParameterSpan*n,s=this.parRight+e*i,o=this.parRight<this.parLeft?this.parLeft+t*i:this.parLeft+this.ParameterSpan+t*i;if(s>o||this.SpanBetweenTwoPoints(s,o)>this.ParameterSpan/2)return!1;if(null==this.Prev||this.SpanBetweenTwoPoints(this.Prev.ParMid,this.ParMid)>i&&this.SpanBetweenTwoPoints(this.ParMid,this.Next.ParMid)>i)return!0;const a=this.RotateLeftPoint(t,n),l=this.RotateRigthPoint(e,n),c=x.middle(a,l),u=this.MidPoint;return!(x.getTriangleOrientation(this.CurveCenter,this.Prev.MidPoint,u)!=x.getTriangleOrientation(this.CurveCenter,this.Prev.MidPoint,c)||x.getTriangleOrientation(this.CurveCenter,this.Next.MidPoint,u)!=x.getTriangleOrientation(this.CurveCenter,this.Next.MidPoint,c))}}let F5=(()=>{class r{constructor(t,n,i,s,o){this.SourceBase=t,this.TargetBase=n,this.obstaclesToIgnore=i,this.EdgeSeparation=s,this.HalfWidthArray=o,this.TotalRequiredWidth=this.EdgeSeparation*(this.HalfWidthArray.length-1)+2*this.HalfWidthArray.reduce((l,c)=>l+c,0),this.longEnoughSideLength=t.Curve.boundingBox.addRec(n.Curve.boundingBox).diagonal;const a=Math.max(t.Curve.boundingBox.diagonal,n.Curve.boundingBox.diagonal);if(this.TotalRequiredWidth>a){const l=this.TotalRequiredWidth/a;for(let c=0;c<this.HalfWidthArray.length;c++)this.HalfWidthArray[c]/=l;this.TotalRequiredWidth/=l,this.EdgeSeparation/=l}}SetParamsFeasiblySymmetrically(t){this.CalculateTightObstaclesForBundle(t,this.obstaclesToIgnore),this.SetEndParamsSymmetrically()}CalculateTightObstaclesForBundle(t,n){const o=Di.Create4gon(this.SourceBase.Position,this.TargetBase.Position,this.SourceBase.Curve.boundingBox.diagonal/2*2,this.TargetBase.Curve.boundingBox.diagonal/2*2);this.tightObstaclesInTheBoundingBox=Array.from(t.AllHitItems(o.boundingBox,a=>!n.has(a)&&ee.ClosedCurveInteriorsIntersect(o,a)))}SetEndParamsSymmetrically(){const t=this.TargetBase.Position,n=this.SourceBase.Position,i=t.sub(n).normalize(),s=i.rotate90Ccw(),o=x.middle(t,n),a=i.mul(this.longEnoughSideLength),l=o.add(a),c=o.sub(a);if(this.SetRLParamsIfWidthIsFeasible(s.mul(this.TotalRequiredWidth/2),l,c))return void this.SetInitialMidParams();let u=this.TotalRequiredWidth,S=0,b=u/2;for(;u-S>r.FeasibleWidthEpsilon;)this.SetRLParamsIfWidthIsFeasible(s.mul(b/2),l,c)?S=b:u=b,b=.5*(u+S);b<=r.FeasibleWidthEpsilon&&(this.SetRLParamsIfWidthIsFeasible_(s.mul(r.FeasibleWidthEpsilon),new x(0,0),l,c)||this.SetRLParamsIfWidthIsFeasible_(new x(0,0),s.mul(-r.FeasibleWidthEpsilon),l,c))&&(b=2*r.FeasibleWidthEpsilon),this.SourceBase.InitialMidParameter=this.SourceBase.AdjustParam(this.SourceBase.ParRight+this.SourceBase.Span/2),this.TargetBase.InitialMidParameter=this.TargetBase.AdjustParam(this.TargetBase.ParRight+this.TargetBase.Span/2)}mkNameFromLRST(){return"/tmp/leftRight"+this.SourceBase.Position.toString()+"_"+this.TargetBase.Position.toString()+".svg"}SetRLParamsIfWidthIsFeasible(t,n,i){return this.SetRLParamsIfWidthIsFeasible_(t,t.neg(),n,i)}SetRLParamsIfWidthIsFeasible_(t,n,i,s){const o={par:0},a={par:0},l={par:0},c={par:0};let u=this.TrimSegWithBoundaryCurves(me.mkPP(i.add(t),s.add(t)),a,l);return null!=u&&!this.tightObstaclesInTheBoundingBox.find(b=>null!=ee.intersectionOne(u,b,!1))&&(u=this.TrimSegWithBoundaryCurves(me.mkPP(i.add(n),s.add(n)),c,o),null!=u)&&!this.tightObstaclesInTheBoundingBox.find(b=>null!=ee.intersectionOne(u,b,!1))&&(this.SourceBase.IsParent?(this.SourceBase.ParRight=a.par,this.SourceBase.ParLeft=c.par):(this.SourceBase.ParRight=c.par,this.SourceBase.ParLeft=a.par),this.TargetBase.IsParent?(this.TargetBase.ParRight=o.par,this.TargetBase.ParLeft=l.par):(this.TargetBase.ParRight=l.par,this.TargetBase.ParLeft=o.par),!0)}SetInitialMidParams(){const t={par:0},n={par:0};null!=this.TrimSegWithBoundaryCurves(me.mkPP(this.TargetBase.CurveCenter,this.TargetBase.CurveCenter),n,t)?(this.SourceBase.InitialMidParameter=n.par,this.TargetBase.InitialMidParameter=t.par):(this.SourceBase.InitialMidParameter=this.SourceBase.AdjustParam(this.SourceBase.ParRight+this.SourceBase.Span/2),this.TargetBase.InitialMidParameter=this.TargetBase.AdjustParam(this.TargetBase.ParRight+this.TargetBase.Span/2))}mkNameFromST(){return"/tmp/mparam"+this.SourceBase.Position.toString()+"_"+this.TargetBase.Position.toString()+".svg"}TrimSegWithBoundaryCurves(t,n,i){let o,a,s=ee.getAllIntersections(t,this.SourceBase.Curve,!0);return 0==s.length?(i.par=0,n.par=0,null):(o=1==s.length?s[0]:this.SourceBase.IsParent?s[0].par0<s[1].par0?s[1]:s[0]:s[0].par0<s[1].par0?s[0]:s[1],s=ee.getAllIntersections(t,this.TargetBase.Curve,!0),0==s.length?(i.par=0,n.par=0,null):(a=1==s.length?s[0]:this.TargetBase.IsParent?s[0].par0>s[1].par0?s[1]:s[0]:s[0].par0>s[1].par0?s[0]:s[1],n.par=o.par1,i.par=a.par1,me.mkPP(o.x,a.x)))}RotateBy(t,n,i,s,o){const a=0!=t||0!=n,l=0!=i||0!=s;a&&this.SourceBase.RotateBy(t,n,o),l&&this.TargetBase.RotateBy(i,s,o),this.UpdateSourceAndTargetBases(a,l)}UpdateSourceAndTargetBases(t,n){t&&this.UpdatePointsOnBundleBase(this.SourceBase),n&&this.UpdatePointsOnBundleBase(this.TargetBase),this.UpdateTangentsOnBases()}UpdateTangentsOnBases(){const t=this.TargetBase.length;for(let n=0;n<t;n++){let i=this.TargetBase.Points[n].sub(this.SourceBase.Points[t-1-n]);const s=i.length;s>=q.tolerance&&(i=i.div(s),this.TargetBase.Tangents[n]=i,this.SourceBase.Tangents[t-1-n]=i.neg())}}UpdatePointsOnBundleBase(t){const n=t.length,i=t.Points,s=me.mkPP(t.LeftPoint,t.RightPoint),o=1/this.TotalRequiredWidth;let a=this.HalfWidthArray[0];i[0]=s.value(a*o);for(let l=1;l<n;l++)a+=this.HalfWidthArray[l-1]+this.EdgeSeparation+this.HalfWidthArray[l],i[l]=s.value(a*o)}RotationIsLegal(t,n,i,s,o){if(this.SourceBase.IsParent||this.TargetBase.IsParent){if(0!=n||0!=s){const a=this.SourceBase.RotateLeftPoint(n,o),l=this.TargetBase.RotateLeftPoint(s,o);if(!this.LineIsLegal(a,l))return!1}if(0!=t||0!=i){const a=this.SourceBase.RotateRigthPoint(t,o),l=this.TargetBase.RotateRigthPoint(i,o);if(!this.LineIsLegal(a,l))return!1}}else{if(0!=n||0!=i){const a=this.SourceBase.RotateLeftPoint(n,o),l=this.TargetBase.RotateRigthPoint(i,o);if(!this.LineIsLegal(a,l))return!1}if(0!=t||0!=s){const a=this.SourceBase.RotateRigthPoint(t,o),l=this.TargetBase.RotateLeftPoint(s,o);if(!this.LineIsLegal(a,l))return!1}}return!((0!=t||0!=n)&&!this.SourceBase.RelativeOrderOfBasesIsPreserved(t,n,o)||(0!=i||0!=s)&&!this.TargetBase.RelativeOrderOfBasesIsPreserved(i,s,o))}LineIsLegal(t,n){return null==this.tightObstaclesInTheBoundingBox.find(i=>null!=ee.intersectionOne(me.mkPP(t,n),i,!1))}}return r.FeasibleWidthEpsilon=.1,r})();class pP{constructor(e,t,n,i){this.Segment=e,this.Reversed=t,this.Index=n,this.BundleBase=i}get Segment(){return this.segment}set Segment(e){this.segment=e}value(e){return this.Segment.value(this.Reversed?this.Segment.parEnd-e:e)}}let B5=(()=>{class r{constructor(t,n,i){this.fixedBundles=new dP.HashSet,this.stepsWithProgress=0,this.metroOrdering=t,this.metroGraphData=n,this.bundlingSettings=i}Run(){this.AllocateBundleBases(),this.SetBasesRightLeftParamsToTheMiddles(),this.bundlingSettings.KeepOverlaps?(this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs()):(this.SetRightLeftParamsFeasiblySymmetrically(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs(),this.bundlingSettings.RotateBundles&&this.RotateBundlesToDiminishCost(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases())}AllocateBundleBases(){this.externalBases=new Map,this.internalBases=new Map,this.Bundles=new Array;for(const t of this.metroGraphData.Stations)null==t.BoundaryCurve&&(t.BoundaryCurve=mt.mkCircle(t.Radius,t.Position));for(const t of this.metroGraphData.Stations)for(const n of t.Neighbors)if(t.SerialNumber<n.SerialNumber){const i=new gP(this.metroGraphData.RealEdgeCount(t,n),t.BoundaryCurve,t.Position,t.IsReal);t.BundleBases.set(n,i);const s=new gP(this.metroGraphData.RealEdgeCount(t,n),n.BoundaryCurve,n.Position,n.IsReal);n.BundleBases.set(t,s),ee.PointRelativeToCurveLocation(n.Position,t.BoundaryCurve)!=Fe.Outside?(i.IsParent=!0,pl(this.internalBases,t.BoundaryCurve,i),pl(this.externalBases,n.BoundaryCurve,s)):ee.PointRelativeToCurveLocation(t.Position,n.BoundaryCurve)!=Fe.Outside?(s.IsParent=!0,pl(this.externalBases,t.BoundaryCurve,i),pl(this.internalBases,n.BoundaryCurve,s)):(pl(this.externalBases,t.BoundaryCurve,i),pl(this.externalBases,n.BoundaryCurve,s));const o=this.metroGraphData.tightIntersections.ObstaclesToIgnoreForBundle(t,n),a=new F5(i,s,o,this.bundlingSettings.EdgeSeparation,Array.from(this.metroOrdering.GetOrder(t,n)).map(l=>l.Width/2));i.OutgoingBundleInfo=s.IncomingBundleInfo=a,this.Bundles.push(a)}this.SetBundleBaseNeighbors()}SetBundleBaseNeighbors(){for(const t of this.externalBases.keys()){const n=this.externalBases.get(t);this.SortBundlesCounterClockwise(n),this.SetLeftRightBases(n)}for(const t of this.internalBases.keys()){const n=this.internalBases.get(t);this.SortBundlesCounterClockwise(n),this.SetLeftRightBases(n)}}SortBundlesCounterClockwise(t){if(t.length>2){const n=t[0].OppositeBase.Position,i=t[0].CurveCenter;t.sort((s,o)=>Xo(n.sub(i),s.OppositeBase.Position.sub(i),o.OppositeBase.Position.sub(i)))}}SetLeftRightBases(t){const n=t.length;if(!(n<=1))for(let i=0;i<n;i++)t[i].Prev=t[(i-1+n)%n],t[i].Next=t[(i+1)%n]}CreateOrientedSegs(){for(const t of this.metroGraphData.Metrolines)this.CreateOrientedSegsOnLine(t)}CreateOrientedSegsOnLine(t){for(let n=t.Polyline.startPoint.next;null!=n.next;n=n.next)this.CreateOrientedSegsOnLineVertex(t,n)}CreateOrientedSegsOnLineVertex(t,n){const i=this.metroGraphData.PointToStations.get(n.prev.point),s=this.metroGraphData.PointToStations.get(n.point),o=this.metroGraphData.PointToStations.get(n.next.point),a=s.BundleBases.get(i),l=s.BundleBases.get(o),c=this.metroOrdering.GetLineIndexInOrder(i,s,t),u=this.metroOrdering.GetLineIndexInOrder(o,s,t),S=a.OrientedHubSegments[c]=new pP(null,!1,c,a),b=l.OrientedHubSegments[u]=new pP(null,!0,u,l);b.Other=S,S.Other=b}UpdateSourceAndTargetBases(){for(const t of this.Bundles)t.UpdateSourceAndTargetBases(!0,!0)}SetBasesRightLeftParamsToTheMiddles(){for(const t of this.Bundles){const n=t.SourceBase,i=t.TargetBase;n.ParLeft=n.ParRight=this.GetBaseMiddleParamInDirection(n,n.Position,i.Position),i.ParLeft=i.ParRight=this.GetBaseMiddleParamInDirection(i,i.Position,n.Position)}}GetBaseMiddleParamInDirection(t,n,i){const s=t.Curve;if(s instanceof mt){const l=s;if(l.isArc())return x.angle(l.aAxis,i.sub(n))}const a=ee.getAllIntersections(s,me.mkPP(n,i),!0);for(const l of a){const c=l.x;if(c.sub(n).dot(c.sub(i))<=0)return l.par0}throw new Error}SetRightLeftParamsFeasiblySymmetrically(){for(const t of this.Bundles)t.SetParamsFeasiblySymmetrically(this.metroGraphData.TightTree)}AdjustStartEndParamsToAvoidBaseOverlaps(){for(const t of this.externalBases.keys())this.AdjustCurrentBundleWidthsOnCurve(this.externalBases.get(t));for(const t of this.internalBases.keys())this.AdjustCurrentBundleWidthsOnCurve(this.internalBases.get(t))}AdjustCurrentBundleWidthsOnCurve(t){const n=t.length;if(!(n<=1))for(let i=0;i<n;i++){const s=t[i];this.ShrinkBasesToMakeTwoConsecutiveNeighborsHappy(s,s.Next)}}ShrinkBasesToMakeTwoConsecutiveNeighborsHappy(t,n){if(!t.Intersect(n))return;let i=t.ParRight,s=t.ParLeft,o=n.ParRight,a=n.ParLeft;const l=n.ParameterSpan;i>s&&(i-=l),o>a&&(o-=l),o>s&&(o-=l,a-=l),i>a&&(i-=l,s-=l);const c=this.RegularCut(i,s,o,a,t.Span,n.Span),u=x.getTriangleOrientation(n.CurveCenter,n.OppositeBase.InitialMidPoint,t.OppositeBase.InitialMidPoint);u==Ie.Clockwise?(s=c,o=c):u==Ie.Counterclockwise?(a=c,i=c):a-i>=s-o?(s=c,o=c):(a=c,i=c),n.ParRight=n.AdjustParam(o),n.ParLeft=n.AdjustParam(a),t.ParRight=t.AdjustParam(i),t.ParLeft=t.AdjustParam(s)}RegularCut(t,n,i,s,o,a){let l=(o*s+a*t)/(o+a);const c=Math.min(n,s),u=Math.max(t,i);return l<u&&(l=u),l>c&&(l=c),l}RotateBundlesToDiminishCost(){let t=r.MaxParameterChange;const n={cost:this.Cost()};let i=0;for(;i++<r.MaxIterations;){const s=n.cost;if(this.RotateBundlesToDiminishCostOneIteration(t,n),t=this.UpdateParameterChange(t,s,n.cost),t<r.MinParameterChange)break}}UpdateParameterChange(t,n,i){return i+1<n?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,this.fixedBundles.clear())):(this.stepsWithProgress=0,t*=.8,this.fixedBundles.clear()),t}RotateBundlesToDiminishCostOneIteration(t,n){let i=!1;for(const s of this.Bundles)this.fixedBundles.has(s)||(this.OptimizeBundle(s,t,n)?i=!0:this.fixedBundles.add(s));return i}OptimizeBundle(t,n,i){const s=this.CostBi(t);if(s<r.CostThreshold)return!1;let o=0,a=-1,l=-1;for(let c=0;c<r.Deltas.length-1;c++){let u=this.DeltaWithChangedAngles(r.Deltas[c][0],r.Deltas[c][1],0,0,t,s,n);u>r.CostDeltaThreshold&&u>o&&(l=c,a=r.Deltas.length-1,o=u),u=this.DeltaWithChangedAngles(0,0,r.Deltas[c][0],r.Deltas[c][1],t,s,n),u>r.CostDeltaThreshold&&u>o&&(l=r.Deltas.length-1,a=c,o=u)}return!(o<r.CostDeltaThreshold||(i.cost-=o,t.RotateBy(r.Deltas[l][0],r.Deltas[l][1],r.Deltas[a][0],r.Deltas[a][1],n),0))}DeltaWithChangedAngles(t,n,i,s,o,a,l){if(!o.RotationIsLegal(t,n,i,s,l))return 0;o.RotateBy(t,n,i,s,l);const c=this.CostBN(o,a);return o.RotateBy(-1*t,-1*n,-1*i,-1*s,l),a-c}CostBi(t){return r.SeparationCoeff*this.SeparationCost(t)+(r.SqueezeCoeff*this.SqueezeCost(t)+(r.AssymetryCoeff*this.AssymetryCost(t)+r.CenterCoeff*this.CenterCostBi(t)))}CostBN(t,n){let i=0;return i+=r.CenterCoeff*this.CenterCostBi(t),i>n||(i+=r.SeparationCoeff*this.SeparationCost(t),i>n)||(i+=r.SqueezeCoeff*this.SqueezeCost(t),i>n)||(i+=r.AssymetryCoeff*this.AssymetryCost(t)),i}SqueezeCost(t){const i=t.TargetBase.MidPoint.sub(t.SourceBase.MidPoint).normalize().rotate90Ccw(),s=Math.abs(t.SourceBase.RightPoint.sub(t.SourceBase.LeftPoint).dot(i)),o=Math.abs(t.TargetBase.RightPoint.sub(t.TargetBase.LeftPoint).dot(i)),a=Math.abs(t.TotalRequiredWidth-s)/t.TotalRequiredWidth,l=Math.abs(t.TotalRequiredWidth-o)/t.TotalRequiredWidth,c=Math.abs(s-o)/t.TotalRequiredWidth;return Math.exp(10*a)-1+(Math.exp(10*l)-1)+c}CenterCostBi(t){return t.SourceBase.BelongsToRealNode||t.TargetBase.BelongsToRealNode?this.CenterCostBb(t.SourceBase)+this.CenterCostBb(t.TargetBase):0}CenterCostBb(t){if(!t.BelongsToRealNode)return 0;const n=t.ParMid,i=Math.min(t.InitialMidParameter,n),s=Math.max(t.InitialMidParameter,n),o=Math.min(s-i,i+(t.ParameterSpan-s));return t.CurveCenter.equal(t.Position)||t.IsParent?o*o*25:o*o*500}AssymetryCost(t){return this.GetAssymetryCostForBase(t.SourceBase)+this.GetAssymetryCostForBase(t.TargetBase)}GetAssymetryCostForBase(t){if(t.BelongsToRealNode)return 0;const n=t.OppositeBase.BelongsToRealNode?200:500;let i=0;for(const s of t.OrientedHubSegments){const o=s.Index,a=s.Other.Index,u=s.Other.BundleBase,L=t.Count+u.Count;i+=this.GetAssymetryCostOnData(t.Points[o],t.Tangents[o],u.Points[a],u.Tangents[a],n)/L}return i}GetAssymetryCostOnData(t,n,i,s,o){const a=t.sub(i);if(a.length<q.distanceEpsilon)return 0;const c=n.add(s).dot(a),u=x.crossProduct(a,n),S=x.crossProduct(a,s),b=u-S;return 10*(c*c+b*b)+o*(u*u+S*S)}SeparationCost(t){return this.SeparationCostForBundleBase(t.SourceBase)+this.SeparationCostForBundleBase(t.TargetBase)}SeparationCostForBundleBase(t){return null==t.Prev?0:this.SeparationCostForAdjacentBundleBases(t,t.Prev)+this.SeparationCostForAdjacentBundleBases(t,t.Next)}SeparationCostForAdjacentBundleBases(t,n){const s=this.IntervalsOverlapLength(t.ParRight,t.ParLeft,n.ParRight,n.ParLeft,t.Curve),o=Math.min(t.Span,n.Span);return Math.exp(s/(10*o))-1}IntervalsOverlapLength(t,n,i,s,o){const a=o.parStart,l=o.parEnd;return t<n?i<s?this.IntersectRegularIntervals(t,n,i,s):this.IntersectRegularIntervals(t,n,i,l)+this.IntersectRegularIntervals(t,n,a,s):i<s?this.IntersectRegularIntervals(t,l,i,s)+this.IntersectRegularIntervals(a,n,i,s):this.IntersectRegularIntervals(t,l,i,l)+this.IntersectRegularIntervals(a,n,a,s)}IntersectRegularIntervals(t,n,i,s){const o=Math.max(t,i),a=Math.min(n,s);return o<a?a-o:0}Cost(){let t=0;for(const n of this.Bundles)t+=(r.SeparationCoeff*this.SeparationCost(n)+r.AssymetryCoeff*this.AssymetryCost(n))/2+r.SqueezeCoeff*this.SqueezeCost(n)+r.CenterCoeff*this.CenterCostBi(n);return t}}return r.Deltas=[[1,-1],[1,-1]],r.SeparationCoeff=1,r.SqueezeCoeff=1,r.CenterCoeff=10,r.AssymetryCoeff=1,r.MaxIterations=200,r.MaxParameterChange=8/360,r.MinParameterChange=.1/360,r.CostThreshold=1e-5,r.CostDeltaThreshold=.01,r})();class k5{constructor(){this.Metrolines=new Array}Add(e){this.Metrolines.push(e)}}class lf{constructor(e){this.Metrolines=e,this.BuildOrder()}*GetOrder(e,t){const n=new Gn(e.Position,t.Position),i=this.bundles.get(n).Metrolines;if(e.Position==n.First)for(let s=0;s<i.length;s++)yield i[s];else for(let s=i.length-1;s>=0;s--)yield i[s]}GetLineIndexInOrder(e,t,n){const i=new Gn(e.Position,t.Position),s=e.Position!=i.First,o=this.bundles.get(i).LineIndexInOrder;return s?o.size-1-o.get(n):o.get(n)}BuildOrder(){this.bundles=new fu;for(const e of this.Metrolines)for(let t=e.Polyline.startPoint;null!=t.next;t=t.next){const n=new Gn(t.point,t.next.point);let i=this.bundles.get(n);i||this.bundles.set(n,i=new k5),i.Add(e)}for(const e of this.bundles)this.BuildOrderPP(e[0],e[1])}BuildOrderPP(e,t){if(!t.orderFixed){t.Metrolines.sort((n,i)=>this.CompareLines(n,i,e.First,e.Second)),t.orderFixed=!0,t.LineIndexInOrder=new Map;for(let n=0;n<t.Metrolines.length;n++)t.LineIndexInOrder.set(t.Metrolines[n],n)}}CompareLines(e,t,n,i){const s={polyPoint:null,next:null,prev:null};this.FindStationOnLine(n,i,e,s);const o=s.polyPoint,a=s.next,l=s.prev;this.FindStationOnLine(n,i,t,s);const c=s.polyPoint,u=s.next,S=s.prev;let F,G,b=o,L=c;for(;null!=(G=l(b))&&null!=(F=S(L))&&G.point.equal(F.point);){const J=new Gn(G.point,b.point);if(this.bundles.get(J).orderFixed)return this.CompareOnFixedOrder(J,e,t,!G.point.equal(J.First));b=G,L=F}if(null!=G&&null!=F){const J=b.point;return-lf.IsLeft(a(b).point.sub(J),G.point.sub(J),F.point.sub(J))}for(b=o,L=c;null!=(G=a(b))&&null!=(F=u(L))&&G.point.equal(F.point);){const J=new Gn(G.point,b.point);if(this.bundles.get(J).orderFixed)return this.CompareOnFixedOrder(J,e,t,!b.point.equal(J.First));b=G,L=F}if(null!=G&&null!=F){const J=b.point;return lf.IsLeft(l(b).point.sub(J),G.point.sub(J),F.point.sub(J))}return Tt(e.Index,t.Index)}CompareOnFixedOrder(e,t,n,i){const s=this.bundles.get(e).LineIndexInOrder;return(i?-1:1)*Tt(s.get(t),s.get(n))}FindStationOnLine(e,t,n,i){for(let s=n.Polyline.startPoint;null!=s.next;s=s.next){if(s.point.equal(e)&&s.next.point.equal(t))return i.next=o=>o.next,i.prev=o=>o.prev,void(i.polyPoint=s);if(s.point.equal(t)&&s.next.point.equal(e))return i.next=o=>o.prev,i.prev=o=>o.next,void(i.polyPoint=s.next)}throw new Error}static IsLeft(e,t,n){return Xo(e,t,n)}}let cf=(()=>{class r extends Zt{constructor(t,n){super(null),this.metroGraphData=t,this.bundlingSettings=n}run(){this.CreateMetroOrdering(),this.InitRadii(),this.FinalizePaths()}InitRadii(){new jn(this.metroGraphData,this.bundlingSettings).CreateNodeRadii()}CreateMetroOrdering(){this.metroOrdering=new lf(this.metroGraphData.Metrolines)}FinalizePaths(){this.CreateBundleBases(),this.CreateSegmentsInsideHubs(),this.CreateCurves()}CreateBundleBases(){new B5(this.metroOrdering,this.metroGraphData,this.bundlingSettings).Run()}CreateCurves(){for(let t=0;t<this.metroGraphData.Metrolines.length;t++)this.CreateCurveLine(this.metroGraphData.Metrolines[t],this.metroGraphData.Edges[t])}CreateCurveLine(t,n){const i=new ee;let o=r.FindCurveStart(this.metroGraphData,this.metroOrdering,t);const a=r.HubSegsOfLine(this.metroGraphData,this.metroOrdering,t);for(const l of a)null!=l&&(i.addSegment(me.mkPP(o,l.start)),i.addSegment(l),o=l.end);i.addSegment(me.mkPP(o,r.FindCurveEnd(this.metroGraphData,this.metroOrdering,t))),n.curve=i}static FindCurveStart(t,n,i){const s=t.PointToStations.get(i.Polyline.startPoint.point),o=t.PointToStations.get(i.Polyline.startPoint.next.point),a=s.BundleBases.get(o),l=a.IsParent?n.GetLineIndexInOrder(s,o,i):n.GetLineIndexInOrder(o,s,i);return a.Points[l]}static FindCurveEnd(t,n,i){const s=t.PointToStations.get(i.Polyline.endPoint.prev.point),o=t.PointToStations.get(i.Polyline.endPoint.point),a=o.BundleBases.get(s),l=a.IsParent?n.GetLineIndexInOrder(o,s,i):n.GetLineIndexInOrder(s,o,i);return a.Points[l]}static*HubSegsOfLine(t,n,i){for(let s=i.Polyline.startPoint.next;null!=s.next;s=s.next)yield r.SegOnLineVertex(t,n,i,s)}static SegOnLineVertex(t,n,i,s){const o=t.PointToStations.get(s.prev.point),a=t.PointToStations.get(s.point),l=a.BundleBases.get(o),c=n.GetLineIndexInOrder(o,a,i);if(null==l.OrientedHubSegments[c]||null==l.OrientedHubSegments[c].Segment){const u=t.PointToStations.get(s.next.point),S=a.BundleBases.get(u),b=n.GetLineIndexInOrder(u,a,i);return me.mkPP(l.Points[c],S.Points[b])}return l.OrientedHubSegments[c].Segment}CreateSegmentsInsideHubs(){for(const t of this.metroGraphData.Metrolines)this.CreateOrientedSegsOnLine(t);this.bundlingSettings.UseCubicBezierSegmentsInsideOfHubs&&this.FanBezierSegs()}CreateOrientedSegsOnLine(t){for(let n=t.Polyline.startPoint.next;null!=n.next;n=n.next)this.CreateOrientedSegsOnLineVertex(t,n)}CreateOrientedSegsOnLineVertex(t,n){const i=this.metroGraphData.PointToStations.get(n.prev.point),s=this.metroGraphData.PointToStations.get(n.point),o=this.metroGraphData.PointToStations.get(n.next.point),a=s.BundleBases.get(i),l=s.BundleBases.get(o),c=this.metroOrdering.GetLineIndexInOrder(i,s,t),u=this.metroOrdering.GetLineIndexInOrder(o,s,t),S=this.bundlingSettings.UseCubicBezierSegmentsInsideOfHubs?r.StandardBezier(a.Points[c],a.Tangents[c],l.Points[u],l.Tangents[u]):r.BiArc(a.Points[c],a.Tangents[c],l.Points[u],l.Tangents[u]);a.OrientedHubSegments[c].Segment=S,l.OrientedHubSegments[u].Segment=S}static ShowHubs(t,n,i,s,o=[]){let a=r.GetAllDebugCurves(n,t);null!=i&&a.push(Xe.mkDebugCurveTWCI(255,1,"red",tr.CreateDiamond(5,25,i.Position))),a=a.concat(o)}static GetAllDebugCurves(t,n){return r.GraphNodes(n).concat(r.VertexDebugCurves(t,n)).concat(r.DebugEdges(n))}static DebugEdges(t){return t.Edges.map(n=>Xe.mkDebugCurveTWCI(40,.1,"gray",n.curve))}static VertexDebugCurves(t,n){return r.DebugCircles(n).concat(r.DebugHubBases(n)).concat(r.DebugSegs(n)).concat(r.BetweenHubs(t,n))}static BetweenHubs(t,n){const i=[];for(const s of n.Metrolines){const o=r.GetInterestingSegs(n,t,s),a=r.GetMonotoneColor(s.Polyline.start,s.Polyline.end,o);for(const l of o)i.push(Xe.mkDebugCurveTWCI(100,s.Width,a,me.mkPP(l[0],l[1])))}return i}static GetInterestingSegs(t,n,i){const s=new Array;if(0==t.Stations.length||null==t.Stations[0].BundleBases||0==t.Stations[0].BundleBases.size)return[];let o=r.FindCurveStart(t,n,i);const a=r.HubSegsOfLine(t,n,i);for(const l of a)null!=l&&(s.push([o,l.start]),o=l.end);return s.push([o,r.FindCurveEnd(t,n,i)]),s}static GetMonotoneColor(t,n,i){return"green"}static DebugHubBases(t){const n=new Array;for(const i of t.Stations)for(const s of i.BundleBases.values())n.push(Xe.mkDebugCurveTWCI(100,1,"red",me.mkPP(s.LeftPoint,s.RightPoint)));return n}static DebugCircles(t){return t.Stations.map(n=>Xe.mkDebugCurveTWCI(100,.1,"blue",tr.mkCircle(n.Radius,n.Position)))}static DebugSegs(t){const n=new Array;for(const i of t.VirtualStations())for(const s of i.BundleBases.values())for(const o of s.OrientedHubSegments)null!=o&&n.push(null==o.Segment?me.mkPP(s.Points[o.Index],o.Other.BundleBase.Points[o.Other.Index]):o.Segment);return n.map(i=>Xe.mkDebugCurveTWCI(100,.01,"green",i))}static GraphNodes(t){return t.Edges.map(i=>i.sourcePort.Curve).concat(t.Edges.map(i=>i.targetPort.Curve)).map(i=>Xe.mkDebugCurveTWCI(40,1,"black",i))}static BiArc(t,n,i,s){const o=t.sub(i);if(o.length<q.distanceEpsilon)return null;const a=o.dot(n.sub(s)),c=2*(-n.dot(s)-1),u=2*a,S=o.dot(o);let b;if(Math.abs(c)<q.distanceEpsilon){if(!(Math.abs(u)>q.distanceEpsilon))return null;b=-S/u}else{let te=u*u-4*c*S;te<0&&(te=0),te=Math.sqrt(te),b=(-u+te)/(2*c),b<0&&(b=(-u-te)/(2*c))}const L=t.add(n.mul(b)),F=i.add(s.mul(b)),G=x.middle(L,F),J=new ee;return J.addSegs([r.ArcOn(t,L,G),r.ArcOn(G,F,i)]),n.dot(i.sub(t))<=0&&n.dot(s)<=0?r.StandardBezier(t,n,i,s):J}static ArcOn(t,n,i){const s={center:null};if(Math.abs(x.signedDoubledTriangleArea(t,n,i))<1e-4||!r.FindArcCenter(t,n,i,s))return me.mkPP(t,i);const o=s.center,a=wt(t,o);if(wt(t,n)/a<1e-4)return me.mkPP(t,i);const c=t.sub(o);let u=Math.atan2(c.y,c.x);const S=i.sub(o);let b=Math.atan2(S.y,S.x),L=b-u;if(L<0&&(L+=2*Math.PI,b+=2*Math.PI),L<=Math.PI)return new mt(u,b,new x(a,0),new x(0,a),o);for(b>2*Math.PI&&(b-=2*Math.PI),u=Math.PI-u,b=Math.PI-b,u<0&&(u+=2*Math.PI);b<u;)b+=2*Math.PI;return L=b-u,new mt(u,b,new x(-a,0),new x(0,a),o)}static FindArcCenter(t,n,i,s){const o=n.sub(t).rotate90Cw(),a=n.sub(i).rotate90Cw();return s.center=x.lineLineIntersection(t,t.add(o),i,i.add(a)),null!=s.center}static StandardBezier(t,n,i,s){const o=wt(t,i)/4;return jt.mkBezier([t,t.add(n.mul(o)),i.add(s.mul(o)),i])}FanBezierSegs(){let t=!0,i=0;for(;t&&i++<5;){t=!1;for(const s of this.metroGraphData.Stations)for(const o of s.BundleBases.values())t||(t=this.FanEdgesOfHubSegment(o))}}FanEdgesOfHubSegment(t){let n=!1;for(let i=0;i<t.Count-1;i++)n||(n=this.FanCouple(t,i,t.CurveCenter,t.Curve.boundingBox.diagonal/2));return n}FanCouple(t,n,i,s){const o=t.OrientedHubSegments[n],a=t.OrientedHubSegments[n+1];if(null==o||me.IntersectPPPP(o.Segment.start,o.Segment.end,a.Segment.start,a.Segment.end)||x.getTriangleOrientation(o.value(0),o.value(.5),o.value(1))!=x.getTriangleOrientation(a.value(0),a.value(.5),a.value(1)))return!1;const c=this.BaseLength(o),u=this.BaseLength(a);return!(Math.abs(c-u)<q.intersectionEpsilon)&&(c>u?this.AdjustLongerSeg(o,a,i,s):this.AdjustLongerSeg(a,o,i,s))}AdjustLongerSeg(t,n,i,s){const o=t.value(0).sub(n.value(0)),a=t.value(1).sub(n.value(1)),l=Math.min(o.length,a.length),c=n.value(.5),u=Math.max(o.length,a.length);return 0!=this.NicelyAligned(t.Segment,o,a,c,l,u)&&this.FitLonger(t,o,a,c,l,u,i,s)}FitLonger(t,n,i,s,o,a,l,c){let u=t.Segment;const S=u.start,b=u.end;let L=0,G=u.start.mul(1-r.SqueezeBound).add(u.B(1).mul(r.SqueezeBound)),J=u.end.mul(1-r.SqueezeBound).add(u.B(2).mul(r.SqueezeBound)),te=u.B(1).mul(2).sub(u.start),ie=u.B(2).mul(2).sub(u.end);const he={highP:te};this.PullControlPointToTheCircle(u.start,he,l,c),te=he.highP;let Ce=this.NicelyAligned(u,n,i,s,o,a);for(;;){if(-1==Ce){const be=x.middle(u.B(1),G),Je=x.middle(u.B(2),J);te=u.B(1),ie=u.B(2),u=new jt(S,be,Je,b)}else{const be=x.middle(u.B(1),te),Je=(u.B(2),ie);G=u.B(1),J=u.B(2),u=new jt(S,be,Je,b)}if(0==(Ce=this.NicelyAligned(u,n,i,s,o,a)))return t.Segment=u,t.Other.Segment=u,!0;if(L++>10)return!1}}PullControlPointToTheCircle(t,n,i,s){const o=x.ProjectionToLine(t,n.highP,i),a=Math.sqrt(s*s-o.sub(i).lengthSquared),l=n.highP.sub(o),c=l.length;c>a&&(n.highP=o.add(l.mul(a/c)))}NicelyAligned(t,n,i,s,o,a){const c=t.value(.5).sub(s),u=c.length;return n.dot(c)<0||i.dot(c)<0||u<o-.001?1:u>a+.001?-1:0}BaseLength(t){return t.value(0).sub(t.value(1)).lengthSquared}}return r.SqueezeBound=.2,r})(),Iu=(()=>{class r{constructor(t,n){this.stepsWithProgress=0,this.metroGraphData=t,this.bundlingSettings=n,this.costCalculator=new Gr(this.metroGraphData,this.bundlingSettings),this.cache=new sf(this.metroGraphData,this.bundlingSettings,this.costCalculator,this.metroGraphData.Cdt)}static FixRouting(t,n){return this.FixRoutingMBP(t,n,null)}static FixRoutingMBP(t,n,i){return new r(t,n).FixRoutingP(i)}FixRoutingP(t){this.stationsForOptimizations=this.GetStationsForOptimizations(t),this.cache.InitializeCostCache();let n=r.MaxStep,i=Number.POSITIVE_INFINITY,s=this.metroGraphData.VirtualStations().map(a=>a.Position),o=0;for(;o++<r.MaxIterations;){const a=this.TryMoveStations();if(o<=1&&!a)return!1;if(!a)break;const l=i;i=Gr.Cost(this.metroGraphData,this.bundlingSettings),n=this.UpdateMaxStep(n,l,i);const c=s;if(s=this.metroGraphData.VirtualStations().map(u=>u.Position),n<r.MinStep||this.Converged(n,c,s))break}return!0}static stationsArePositionedCorrectly(t){for(const n of t.VirtualEdges())if(!this.edgeIsPositionedCorrectly(n,t))return!1;return!0}static edgeIsPositionedCorrectly(t,n){const i=t[0],s=t[1],o=n.looseIntersections.ObstaclesToIgnoreForBundle(i,s),a=me.mkPP(i.Position,s.Position),l=Array.from(n.looseIntersections.obstacleTree.GetNodeItemsIntersectingRectangle(a.boundingBox)).filter(c=>!o.has(c)).filter(c=>ee.CurvesIntersect(a,c));return!(l.length>0&&(cf.ShowHubs(n,null,null,"/tmp/badcross.svg",[Xe.mkDebugCurveTWCI(200,1,"Brown",a),Xe.mkDebugCurveTWCI(200,1,"Red",tr.mkCircle(2,i.Position)),Xe.mkDebugCurveTWCI(200,1,"Blue",tr.mkCircle(5,s.Position)),Xe.mkDebugCurveTWCI(100,1,"Blue",tr.mkCircle(5,s.Position))].concat(l.map(c=>Xe.mkDebugCurveTWCI(100,1,"Pink",c)))),1))}GetStationsForOptimizations(t){if(null==t)return new Set(this.metroGraphData.VirtualStations());{const n=new Set;for(const i of t){const s=this.metroGraphData.PointToStations.get(i);s&&!s.IsReal&&n.add(s)}return n}}Converged(t,n,i){let s=0,o=0;for(let l=0;l<n.length;l++)o+=n[l].sub(i[l]).lengthSquared,s+=n[l].lengthSquared;return Math.sqrt(o/s)<r.MinRelativeChange}UpdateMaxStep(t,n,i){return i+1<n?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,t=Math.min(r.MaxStep,t/.8))):(this.stepsWithProgress=0,t*=.8),t}TryMoveStations(){let t=!1;const n=new Set;for(const i of this.stationsForOptimizations)if(this.TryMoveStation(i)){t=!0,n.add(i);for(const s of i.Neighbors)s.IsReal||n.add(s)}return this.stationsForOptimizations=n,t}TryMoveStation(t){let n=this.BuildDirection(t);if(0==n.length)return!1;let i=this.BuildStepLength(t,n);if(i<r.MinStep&&(n=function G5(){return new x(1+2*jE(),1+2*jE())}(),i=this.BuildStepLength(t,n),i<r.MinStep))return!1;const s=n.mul(i),o=t.Position.add(s);return!(this.metroGraphData.PointToStations.has(o)||!this.moveIsLegalForAdjacentBundles(t,o)||(this.metroGraphData.MoveNode(t,o),this.cache.UpdateCostCache(t),0))}moveIsLegalForAdjacentBundles(t,n){for(const i of this.metroGraphData.looseIntersections.obstacleTree.AllHitItems(Ne.mkOnPoints([n]),s=>ee.PointRelativeToCurveLocation(n,s)!=Fe.Outside))if(0==t.getELP().has(i))return!1;for(const i of t.Neighbors){const s=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(i,t);if(!this.metroGraphData.cdtIntersections.EdgeIsLegal_(i.Position,n,i.CdtTriangle,s))return!1}return!0}BuildDirection(t){const n=this.BuildForceForInk(t),i=this.BuildForceForPathLengths(t),s=this.BuildForceForRadius(t),o=this.BuildForceForBundle(t),a=n.add(i.add(s.add(o)));return a.length<.1?new x(0,0):a.normalize()}BuildStepLength(t,n){let i=r.MinStep,s=this.CostGain(t,t.Position.add(n.mul(i)));if(s<.01)return 0;for(;2*i<=r.MaxStep;){const o=this.CostGain(t,t.Position.add(n.mul(2*i)));if(o<=s)break;i*=2,s=o}return i}CostGain(t,n){const s=this.costCalculator.RadiusGain(t,n);if(s<-12345678)return-12345678;const o=this.costCalculator.BundleGain(t,n);return o<-12345678?-12345678:s+this.costCalculator.InkGain(t,n)+this.costCalculator.PathLengthsGain(t,n)+o}BuildForceForInk(t){let n=new x(0,0);for(const s of t.Neighbors){const o=s.Position.sub(t.Position);n=n.add(o.normalize())}return n.mul(this.bundlingSettings.InkImportance)}BuildForceForPathLengths(t){let n=new x(0,0);for(const s of this.metroGraphData.MetroNodeInfosOfNode(t)){const o=s.Metroline,l=s.PolyPoint.prev.point,c=s.PolyPoint.next.point.sub(t.Position),u=l.sub(t.Position);n=n.add(c.div(c.length*o.IdealLength)),n=n.add(u.div(u.length*o.IdealLength))}return n.mul(this.bundlingSettings.PathLengthImportance)}BuildForceForRadius(t){let n=new x(0,0);const i=t.cachedIdealRadius,s={touchedObstacles:[]};if(!this.metroGraphData.looseIntersections.HubAvoidsObstaclesSPNBA(t,t.Position,i,s))throw cf.ShowHubs(this.metroGraphData,null,t,"/tmp/hubs.svg",[Xe.mkDebugCurveTWCI(255,1,"Brown",Di.containingPoly),Xe.mkDebugCurveTWCI(100,1,"Blue",tr.mkCircle(i,t.Position))]),new Error;for(const l of s.touchedObstacles){const u=2*(1-l[1].sub(t.Position).length/i),S=t.Position.sub(l[1]).normalize();n=n.add(S.mul(u))}return n.mul(this.bundlingSettings.HubRepulsionImportance)}BuildForceForBundle(t){let n=new x(0,0);for(const s of t.Neighbors){const o=this.metroGraphData.GetWidthSSN(t,s,this.bundlingSettings.EdgeSeparation),a={closestDist:[]};this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(t,s,t.Position,s.Position,o/2,a)||cf.ShowHubs(this.metroGraphData,null,t,"/tmp/inside_forbid.svg",[Xe.mkDebugCurveTWCI(100,.2,"Blue",me.mkPP(t.Position,s.Position)),Xe.mkDebugCurveTWCI(100,.2,"Red",tr.mkCircle(2,t.Position)),Xe.mkDebugCurveTWCI(100,.2,"Red",tr.mkCircle(3,s.Position))]);for(const c of a.closestDist){const S=2*(1-c[0].sub(c[1]).length/(o/2)),b=c[0].sub(c[1]).normalize().neg();n=n.add(b.mul(S))}}return n.mul(this.bundlingSettings.BundleRepulsionImportance)}}return r.MaxIterations=100,r.MaxStep=50,r.MinStep=1,r.MinRelativeChange=5e-4,r})();class Zo{constructor(e,t){this.metroGraphData=e,this.bundlingSettings=t}static FixRouting(e,t){const n=new Zo(e,t);n.GlueConflictingStations(),n.UnglueEdgesFromBundleToSaveInk(!0);let i=0;for(;++i<10;){let o=n.GlueConflictingStations();if(o||(o=n.RelaxConstrainedEdges()),o||(o=i<=3&&n.UnglueEdgesFromBundleToSaveInk(!1)),o||(o=n.GlueCollinearNeighbors(i)),o||(o=3==i&&n.RemoveDoublePathCrossings()),!o)break}for(e.cdtIntersections.ComputeForcesForBundles=!0,n.RemoveDoublePathCrossings(),n.UnglueEdgesFromBundleToSaveInk(!0);n.GlueConflictingStations(););e.Initialize(!0)}GlueConflictingStations(){const e=this.GetCirclesHierarchy();if(null==e)return!1;const t=new Map,n=new Set;if(Un(e,e,(s,o)=>this.TryToGlueStations(s,o,t,n)),0==t.size)return!1;for(let s=0;s<this.metroGraphData.Edges.length;s++)this.RegenerateEdge(t,s);const i=new un;for(const s of n){i.add(s.Position);for(const o of s.Neighbors)o.IsReal||i.add(o.Position)}return this.metroGraphData.Initialize(!1),Iu.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,i),!0}GetCirclesHierarchy(){for(const n of this.metroGraphData.VirtualStations())n.Radius=this.GetCurrentHubRadius(n);return en(this.metroGraphData.VirtualStations().map(function t(n){const i=n.Position,s=Math.max(n.Radius,5),o=new x(s,s);return Cn(n,Ne.mkPP(i.add(o),i.sub(o)))}))}GetCurrentHubRadius(e){if(e.IsReal)return e.BoundaryCurve.boundingBox.diagonal/2;{let n=this.metroGraphData.looseIntersections.GetMinimalDistanceToObstacles(e,e.Position,e.cachedIdealRadius);for(const i of e.Neighbors)n=Math.min(n,e.Position.sub(i.Position).length);return n}}TryToGlueStations(e,t,n,i){if(!Vd(e.getELP(),t.getELP()))return!1;e.Position.sub(t.Position).length>=Math.max(e.Radius,5)+Math.max(t.Radius,5)||this.TryGlueOrdered(e,t,i,n)||this.TryGlueOrdered(t,e,i,n)}TryGlueOrdered(e,t,n,i){return!(i.has(e)||n.has(e)||!this.StationGluingIsAllowed(e,t,i)||(this.Map(e,t,n,i),0))}Map(e,t,n,i){i.set(e,t),n.add(t)}StationGluingIsAllowed(e,t,n){for(const s of e.Neighbors){const o=Zo.Glued(s,n),a=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(o,e);if(!this.metroGraphData.cdtIntersections.EdgeIsLegalSSPPS(o,t,a))return!1}return!(this.ComputeCostDeltaAfterStationGluing(e,t,n)<0)}ComputeCostDeltaAfterStationGluing(e,t,n){const i=e.Position.sub(t.Position).length;if(e.Radius>=i||t.Radius>=i)return 1;let s=0;const o=this.metroGraphData.Ink;let a=this.metroGraphData.Ink-t.Position.sub(e.Position).length;for(const l of e.Neighbors){const c=Zo.Glued(l,n);a-=c.Position.sub(e.Position).length,a+=0==this.metroGraphData.RealEdgeCount(c,t)?c.Position.sub(t.Position).length:0}s+=Gr.InkError(o,a,this.bundlingSettings);for(const l of this.metroGraphData.MetroNodeInfosOfNode(e)){const c=l.Metroline.Length;let u=l.Metroline.Length;const S=l.PolyPoint,b=S.prev,L=S.next;u-=b.point.sub(e.Position).length+L.point.sub(e.Position).length,u+=b.point.sub(t.Position).length+L.point.sub(t.Position).length,s+=Gr.PathLengthsError(c,u,l.Metroline.IdealLength,this.bundlingSettings)}return s}RegenerateEdge(e,t){const n=this.metroGraphData.Metrolines[t].Polyline;for(const o of n)if(!this.metroGraphData.PointToStations.has(o))return;let i=!1;for(const o of n)if(e.has(this.metroGraphData.PointToStations.get(o))){i=!0;break}if(!i)return;const s=Array.from(n).map(o=>this.metroGraphData.PointToStations.get(o));this.metroGraphData.Edges[t].curve=Me.mkFromPoints(Zo.GluedPolyline(s,e))}static GluedPolyline(e,t){let n;const i=new kt.K;i.push(e[0]);const s=new Set;for(n=1;n<e.length-1;n++){const o=Zo.Glued(e[n],t);if(s.has(o))for(;i.top!=o;)s.delete(i.pop());else x.closeDistEps(o.Position,i.top.Position)||(s.add(o),i.push(o))}return i.push(e[n]),Array.from(i).reverse().map(o=>o.Position)}static Glued(e,t){var n;return null!==(n=t.get(e))&&void 0!==n?n:e}UnglueEdgesFromBundleToSaveInk(e){const t=new fu;this.ink=this.metroGraphData.Ink,this.polylineLength=new Map;for(const s of this.metroGraphData.Metrolines){this.polylineLength.set(s,s.Length);for(let o=s.Polyline.startPoint;null!=o.next;o=o.next)IT(t,new Gn(o.point,o.next.point),s)}const n=new un;let i=!1;for(const s of this.metroGraphData.Metrolines){const o=ao(this.metroGraphData.PointToStations.get(s.Polyline.start).getELP(),this.metroGraphData.PointToStations.get(s.Polyline.end).getELP());this.TrySeparateOnPolyline(s,t,n,o)&&(i=!0)}return i&&this.metroGraphData.Initialize(!1),(e||i)&&Iu.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,e?null:n),i}TrySeparateOnPolyline(e,t,n,i){let s=!1,o=!0;for(;o;){o=!1;for(let a=e.Polyline.startPoint;null!=a.next&&null!=a.next.next;a=a.next)this.TryShortcutPolypoint(a,t,n,i)&&(o=!0);o&&(s=!0)}return s}TryShortcutPolypoint(e,t,n,i){return!!this.SeparationShortcutAllowed(e,t,i)&&(n.add(e.point),n.add(e.next.point),n.add(e.next.next.point),this.RemoveShortcuttedPolypoint(e,t),!0)}SeparationShortcutAllowed(e,t,n){const i=e.point,s=e.next.point,o=e.next.next.point,a=this.metroGraphData.PointToStations.get(i),l=this.metroGraphData.PointToStations.get(s),c=this.metroGraphData.PointToStations.get(o),u=gl(a.getELP(),c.getELP()),S=function v4(r){if(0==r.length)return new Set;let e=r[0];for(let t=1;t<r.length;t++)e=ao(e,r[t]);return e}([n,l.getELP(),u]);return!(!this.metroGraphData.cdtIntersections.EdgeIsLegalSSPPS(a,c,S)||this.GetInkgain(e,t,i,s,o)<0)}GetInkgain(e,t,n,i,s){const[o,a,l]=this.FindPolylines(e,t);let c=0;const u=this.ink;let S=this.ink;const b=n.sub(i).length,L=i.sub(s).length,F=n.sub(s).length;o.size==l.size&&(S-=b),a.size==l.size&&(S-=L);const G=t.get(new Gn(n,s));(!G||0==G.size)&&(S+=F),c+=Gr.InkError(u,S,this.bundlingSettings);for(const be of l){const Je=this.polylineLength.get(be);c+=Gr.PathLengthsError(Je,Je-(b+L-F),be.IdealLength,this.bundlingSettings)}let J=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get(n));const te=this.metroGraphData.GetWidthAN(Array.from(l),this.bundlingSettings.EdgeSeparation),ie=this.metroGraphData.GetWidthAN(Array.from(fl(o,l)),this.bundlingSettings.EdgeSeparation);let he=jn.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(J,n,s,i,te,ie,this.bundlingSettings);he>J&&(c-=Gr.RError(he,J,this.bundlingSettings)),J=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get(s));const Ce=this.metroGraphData.GetWidthAN(Array.from(fl(a,l)),this.bundlingSettings.EdgeSeparation);return he=jn.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(J,s,i,n,Ce,te,this.bundlingSettings),he>J&&(c-=Gr.RError(he,J,this.bundlingSettings)),c}RemoveShortcuttedPolypoint(e,t){const n=e.point,i=e.next.point,s=e.next.next.point,[o,a,l]=this.FindPolylines(e,t),c=wt(n,i),u=wt(i,s),S=wt(n,s);o.size==l.size&&(this.ink-=c),a.size==l.size&&(this.ink-=u);const b=t.get(new Gn(n,s));(!b||0==b.size)&&(this.ink+=S);for(const L of l){const F=this.polylineLength.get(L);this.polylineLength.set(L,F-(c+u-S))}for(const L of l){const F=Array.from(L.Polyline.polylinePoints()).find(G=>G.point.equal(i));this.RemovePolypoint(F),OT(t,[n,i],L),OT(t,[i,s],L),S4(t,[n,s],L)}}FindPolylines(e,t){const i=e.next.point,s=e.next.next.point,o=t.get_(e.point,i),a=t.get_(i,s);return[o,a,ao(o,a)]}RemovePolypoint(e){const t=e.prev,n=e.next;t.next=n,n.prev=t}GlueCollinearNeighbors(e){const t=new un;let n=!1;for(const i of this.metroGraphData.Stations)this.GlueCollinearNeighborsSPN(i,t,e)&&(n=!0);return n&&(this.metroGraphData.Initialize(!1),Iu.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,t)),n}GlueCollinearNeighborsSPN(e,t,n){if(e.Neighbors.length<=1)return!1;const i=new fP,s=e.Neighbors;for(let o=0;o<s.length;o++)this.TryToGlueEdges(e,s[o],s[(o+1)%s.length],i,n);if(i.isEmpty)return!1;for(const o of i)this.GlueEdge(o),t.add(o[0].Position),t.add(o[1].Position),t.add(o[2]);return!0}TryToGlueEdges(e,t,n,i,s){if(x.anglePCP(t.Position,e.Position,n.Position)<this.bundlingSettings.AngleThreshold){const a=wt(t.Position,e.Position),l=wt(n.Position,e.Position),c=Math.min(a,l)/Math.max(a,l);if(c<.05)return;if(a<l){if(this.EdgeGluingIsAllowedSSS(e,t,n))return void this.AddEdgeToGlue(e,n,t,t.Position,i)}else if(this.EdgeGluingIsAllowedSSS(e,n,t))return void this.AddEdgeToGlue(e,t,n,n.Position,i);if(s<5&&c>.5){const u=this.ConstructGluingPoint(e,t,n);this.EdgeGluingIsAllowedSSSP(e,t,n,u)&&this.AddEdgeToGlue(e,n,t,u,i)}}}ConstructGluingPoint(e,t,n){const i=Math.min(wt(t.Position,e.Position),wt(n.Position,e.Position)/2),s=t.Position.sub(e.Position).normalize().add(n.Position.sub(e.Position).normalize());return e.Position.add(s.mul(i/2))}EdgeGluingIsAllowedSSS(e,t,n){if(t.IsReal||n.IsReal||!Vd(t.getELP(),n.getELP())||!this.metroGraphData.cdtIntersections.EdgeIsLegal(t,n,t.Position,n.Position))return!1;const i=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(e,n);return!(Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(me.mkPP(e.Position,t.Position),this.metroGraphData.LooseTree).find(l=>!i.has(l.seg1))||Et.IntersectionsOfLineAndRectangleNodeOverPolylineLR(me.mkPP(t.Position,n.Position),this.metroGraphData.LooseTree).find(l=>!i.has(l.seg1))||this.ComputeCostDeltaAfterEdgeGluing(e,t,n,t.Position)<0)}EdgeGluingIsAllowedSSSP(e,t,n,i){return!(!this.metroGraphData.looseIntersections.HubAvoidsObstaclesPNS__(i,0,ao(t.getELP(),n.getELP()))||!this.metroGraphData.cdtIntersections.EdgeIsLegal(e,null,e.Position,i)||!this.metroGraphData.cdtIntersections.EdgeIsLegal(t,null,t.Position,i)||!this.metroGraphData.cdtIntersections.EdgeIsLegal(n,null,n.Position,i)||this.ComputeCostDeltaAfterEdgeGluing(e,t,n,i)<0)}ComputeCostDeltaAfterEdgeGluing(e,t,n,i){let s=0;const o=this.metroGraphData.Ink,a=this.metroGraphData.Ink-wt(e.Position,n.Position)-wt(e.Position,t.Position)+wt(e.Position,i)+wt(i,t.Position)+wt(i,n.Position);s+=Gr.InkError(o,a,this.bundlingSettings);for(const S of this.metroGraphData.GetIjInfo(e,n).Metrolines){const b=S.Length,L=S.Length-wt(e.Position,n.Position)+wt(e.Position,i)+wt(i,n.Position);s+=Gr.PathLengthsError(b,L,S.IdealLength,this.bundlingSettings)}for(const S of this.metroGraphData.GetIjInfo(e,t).Metrolines){const b=S.Length,L=S.Length-wt(e.Position,t.Position)+wt(e.Position,i)+wt(i,t.Position);s+=Gr.PathLengthsError(b,L,S.IdealLength,this.bundlingSettings)}const l=e.cachedIdealRadius,c=this.GetCurrentHubRadius(e),u=jn.GetMinRadiusForTwoAdjacentBundles(c,e,e.Position,t,n,this.metroGraphData,this.bundlingSettings);return u>c&&(s+=Gr.RError(u,c,this.bundlingSettings)),l>wt(e.Position,i)&&!e.IsReal&&(s-=Gr.RError(l,wt(e.Position,i),this.bundlingSettings)),s}AddEdgeToGlue(e,t,n,i,s){s.has(n,e)||s.has(t,e)||s.has(e,n)||s.has(e,t)||(s.set(e,n,i),s.set(e,t,i))}GlueEdge(e){const t=e[0],n=e[1],i=e[2];for(const s of t.MetroNodeInfos.map(o=>o.PolyPoint))null!=s.next&&s.next.point.equal(n.Position)?this.SplitPolylinePoint(s,i):null!=s.prev&&s.prev.point.equal(n.Position)&&this.SplitPolylinePoint(s.prev,i)}SplitPolylinePoint(e,t){if(e.point==t||e.next.point==t)return;const n=Pr.mkFromPoint(t);n.polyline=e.polyline,n.next=e.next,n.prev=e,n.next.prev=n,n.prev.next=n}RelaxConstrainedEdges(){const e=new un;let t=!1;for(const n of this.metroGraphData.VirtualEdges())this.RelaxConstrainedEdge(n[0],n[1],e)&&(t=!0);return t&&(this.metroGraphData.Initialize(!1),Iu.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,e)),t}RelaxConstrainedEdge(e,t,n){const i=this.metroGraphData.GetWidthSSN(e,t,this.bundlingSettings.EdgeSeparation),s={closestDist:new Array};this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(e,t,e.Position,t.Position,.99*i/2,s);const o=s.closestDist;if(o.length>0){let l,a=-1;for(const c of o){if(Math.min(wt(e.Position,c[1]),wt(t.Position,c[1]))/wt(e.Position,t.Position)<.1)continue;const L=wt(c[0],c[1]);(-1==a||L<a)&&(a=L,l=c[1])}if(-1==a||!this.metroGraphData.looseIntersections.HubAvoidsObstaclesPNS__(l,0,ao(e.getELP(),t.getELP())))return!1;n.add(l),n.add(e.Position),n.add(t.Position);for(const c of this.metroGraphData.GetIjInfo(e,t).Metrolines){let u=null;for(const S of c.Polyline.polylinePoints())if(S.point.equal(e.Position)){u=S;break}null!=u.next&&u.next.point.equal(t.Position)?this.SplitPolylinePoint(u,l):this.SplitPolylinePoint(u.prev,l)}return!0}return!1}RemoveDoublePathCrossings(){const e=new Cu(this.metroGraphData,this.metroGraphData.PointIsAcceptableForEdge.bind(this)).run();return e&&(this.metroGraphData.Initialize(!1),Iu.FixRouting(this.metroGraphData,this.bundlingSettings)),e}}class uf{constructor(e,t,n){this.upperBound=Number.POSITIVE_INFINITY,this._visGraph=n,n.ClearPrevEdgesTable();for(const i of n.Vertices())i.Distance=Number.POSITIVE_INFINITY;this.sources=e,this.targets=new Set(t)}GetPath(){const e=new ho;for(const t of this.sources)t.Distance=0,e.Enqueue(t,0);for(;!e.IsEmpty()&&(this._current=e.Dequeue(),!this.targets.has(this._current));){for(const t of this._current.OutEdges)this.PassableOutEdge(t)&&this.ProcessNeighbor(e,t,t.Target);for(const t of this._current.InEdges.filter(this.PassableInEdge.bind))this.ProcessNeighbor(e,t,t.Source)}return null==this._visGraph.PreviosVertex(this._current)?null:this.CalculatePath()}PassableOutEdge(e){return this.targets.has(e.Target)||!uf.IsForbidden(e)}PassableInEdge(e){return this.targets.has(e.Source)||!uf.IsForbidden(e)}static IsForbidden(e){return(null!=e.IsPassable&&!e.IsPassable()||e)instanceof Xi}ProcessNeighbor(e,t,n){const s=this._current.Distance+t.Length;s>=this.upperBound||(this.targets.has(n)&&(this.upperBound=s,this.closestTarget=n),null==this._visGraph.PreviosVertex(n)?(n.Distance=s,this._visGraph.SetPreviousEdge(n,t),e.Enqueue(n,s)):s<n.Distance&&(n.Distance=s,this._visGraph.SetPreviousEdge(n,t),e.DecreasePriority(n,s)))}CalculatePath(){if(null==this.closestTarget)return null;const e=new Array;let t=this.closestTarget;do{e.push(t),t=this._visGraph.PreviosVertex(t)}while(t.Distance>0);return e.push(t),e.reverse()}}let bl=(()=>{class r extends Zt{constructor(t,n,i,s,o,a,l,c,u,S){super(null),this.bundlingSettings=s,this.edgesToRoute=t,this.regularEdges=t.filter(b=>b.source!=b.target),this.VisibilityGraph=i,this.shortestPathRouter=n,this.LoosePadding=o,this.LooseHierarchy=l,this.TightHierarchy=a,this.EdgeLooseEnterable=c,this.EdgeTightEnterable=u,this.loosePolylineOfPort=S}ThereAreOverlaps(t){return ei(t,t,ee.CurvesIntersect)}run(){this.ThereAreOverlaps(this.TightHierarchy)?this.Status=Ru.Overlaps:(this.FixLocationsForHookAnywherePorts(this.edgesToRoute),this.RoutePathsWithSteinerDijkstra()?(this.FixChildParentEdges(),this.bundlingSettings.StopAfterShortestPaths||this.OrderOptimizeNudgeEtc(),this.RouteSelfEdges(),this.FixArrowheads()):this.Status=Ru.EdgeSeparationIsTooLarge)}OrderOptimizeNudgeEtc(){const t=new L5(this.regularEdges,this.LooseHierarchy,this.TightHierarchy,this.bundlingSettings,this.shortestPathRouter.CdtProperty,this.EdgeLooseEnterable,this.EdgeTightEnterable,this.loosePolylineOfPort);Zo.FixRouting(t,this.bundlingSettings),new cf(t,this.bundlingSettings).run()}FixChildParentEdges(){for(const t of this.regularEdges){const n=t.sourcePort,i=t.targetPort;if(n.Curve.boundingBox.containsRect(i.Curve.boundingBox)){const s=ee.intersectionOne(n.Curve,me.mkPP(t.curve.start,t.curve.end),!1);t.curve.startPoint.point=s.x}if(i.Curve.boundingBox.containsRect(n.Curve.boundingBox)){const s=ee.intersectionOne(i.Curve,me.mkPP(t.curve.start,t.curve.end),!0);t.curve.endPoint.point=s.x}}}static CreateConstrainedDelaunayTriangulation(t){const n=Array.from(t.GetAllLeaves());let i=t.irect;return i=i.pad(i.diagonal/4),r.GetConstrainedDelaunayTriangulation(n.concat([i.perimeter()]))}static GetConstrainedDelaunayTriangulation(t){const n=new nn(null,t,null);return n.run(),n}FixLocationsForHookAnywherePorts(t){for(const n of t){let i=n.sourcePort instanceof Yn;if(i){const s=n.sourcePort;s.SetLocation(this.FigureOutHookLocation(s.LoosePolyline,n.targetPort,n))}else if(i=n.targetPort instanceof Yn,i){const s=n.targetPort;s.SetLocation(this.FigureOutHookLocation(s.LoosePolyline,n.sourcePort,n))}}}FigureOutHookLocation(t,n,i){return n instanceof Zr?this.FigureOutHookLocationForClusterOtherPort(t,n,i):this.FigureOutHookLocationForSimpleOtherPort(t,n,i)}FigureOutHookLocationForClusterOtherPort(t,n,i){const s=this.shortestPathRouter.MakeTransparentShapesOfEdgeGeometry(i),a=new uf(Array.from(n.LoosePolyline).map(this.VisibilityGraph.FindVertex.bind),Array.from(t).map(this.VisibilityGraph.FindVertex.bind),this.VisibilityGraph).GetPath();for(const l of s)l.IsTransparent=!1;return a[a.length-1].point}FigureOutHookLocationForSimpleOtherPort(t,n,i){const s=n.Location,o=this.shortestPathRouter.MakeTransparentShapesOfEdgeGeometry(i),l=new hu(this.VisibilityGraph.FindVertex(s),Array.from(t).map(c=>this.VisibilityGraph.FindVertex(c)),this.VisibilityGraph).GetPath();for(const c of o)c.IsTransparent=!1;return l[l.length-1].point}RoutePathsWithSteinerDijkstra(){return this.shortestPathRouter.VisibilityGraph=this.VisibilityGraph,this.shortestPathRouter.BundlingSettings=this.bundlingSettings,this.shortestPathRouter.geomEdges=this.regularEdges,this.shortestPathRouter.ObstacleHierarchy=this.LooseHierarchy,this.shortestPathRouter.RouteEdges(),!(null!=this.shortestPathRouter.CdtProperty&&!this.AnalyzeEdgeSeparation())}AnalyzeEdgeSeparation(){const t=new Map;this.shortestPathRouter.FillCrossedCdtEdges(t);const n=this.GetPathsOnCdtEdge(t),i=this.CalculateMaxAllowedEdgeSeparation(n);if(i>=this.bundlingSettings.EdgeSeparation)return!0;if(i<=.02){for(const s of this.regularEdges)s.curve=null;return!1}return this.bundlingSettings.EdgeSeparation=i,this.shortestPathRouter.RouteEdges(),!0}GetPathsOnCdtEdge(t){const n=new Map;for(const i of t.keys())for(const s of t.get(i))Hd(n,s,i);return n}CalculateMaxAllowedEdgeSeparation(t){let n=.01,i=10;if(this.EdgeSeparationIsOkMN(t,i))return i;for(;Math.abs(i-n)>.01;){const s=(n+i)/2;this.EdgeSeparationIsOkMN(t,s)?n=s:i=s}return n}EdgeSeparationIsOkMN(t,n){const i=t.size;if(0==i)return!0;let s=0;for(const o of t.keys())this.EdgeSeparationIsOk(o,t.get(o),n)&&s++;return s/i>this.bundlingSettings.MinimalRatioOfGoodCdtEdges}EdgeSeparationIsOk(t,n,i){return Array.from(n).map(o=>o.lineWidth).reduce((o,a)=>o+a,0)+(n.size-1)*i<=t.Capacity}RouteSelfEdges(){for(const t of this.edgesToRoute)t.source==t.target&&(t.curve=io.RouteSelfEdge(t.source.boundaryCurve,2*this.LoosePadding,{smoothedPolyline:null}))}FixArrowheads(){for(const t of this.edgesToRoute)ro.trimSplineAndCalculateArrowheadsII(t,t.source.boundaryCurve,t.target.boundaryCurve,t.curve,!1)}}return r.SuperLoosePaddingCoefficient=1.1,r})();class V5{constructor(e,t,n){this.numberOfPassedPaths=0,this.VisibilityEdge=e,this.Source=t,this.Target=n}get TargetPoint(){return this.Target.Point}get SourcePoint(){return this.Source.Point}get IsOccupied(){return this.numberOfPassedPaths>0}get IsPassable(){return this.Target.IsTargetOfRouting||this.Source.IsSourceOfRouting||null==this.VisibilityEdge.IsPassable||this.VisibilityEdge.IsPassable()}AddOccupiedEdge(){this.numberOfPassedPaths++}RemoveOccupiedEdge(){this.numberOfPassedPaths--}}class H5{constructor(e){this.InBoneEdges=new Array,this.OutBoneEdges=new Array,this.VisibilityVertex=e}get Prev(){return null==this.PrevEdge?null:this.PrevEdge.Source==this?this.PrevEdge.Target:this.PrevEdge.Source}get Point(){return this.VisibilityVertex.point}get Cost(){return this.IsSourceOfRouting?this.cost:null==this.Prev?Number.POSITIVE_INFINITY:this.cost}set Cost(e){this.cost=e}SetPreviousToNull(){this.PrevEdge=null}}class go{constructor(e,t,n){this.EdgesToRoutes=new Map,this.EdgesToRouteSources=new Map,this.MakeTransparentShapesOfEdgeGeometry=e,this.CdtProperty=t,this.Gates=n}CreateGraphElements(){for(const e of this.vertexArray){const t=e.VisibilityVertex;for(const n of t.InEdges){const i=new V5(n,this.VisibilityVerticesToSdVerts.get(n.Source),this.VisibilityVerticesToSdVerts.get(n.Target)),s=this.VisibilityVerticesToSdVerts.get(n.Source);e.InBoneEdges.push(i),s.OutBoneEdges.push(i)}}}CreateRoutingGraph(){this.vertexArray=[],this.VisibilityVerticesToSdVerts=new Map;for(const e of this.VisibilityGraph.Vertices()){const t=new H5(e);this.vertexArray.push(t),this.VisibilityVerticesToSdVerts.set(e,t)}this.CreateGraphElements()}RouteEdges(){this.Initialize(),this.RestoreCapacities();for(const e of this.geomEdges)this.EdgesToRoutes.set(e,this.RouteEdge(e));this.RerouteEdges();for(const e of this.geomEdges)this.SetEdgeGeometryCurve(e)}SetEdgeGeometryCurve(e){const t=new Me;let n=this.EdgesToRouteSources.get(e);t.addPoint(n.Point);for(const o of this.EdgesToRoutes.get(e))o.SourcePoint.equal(n.Point)?(t.addPoint(o.TargetPoint),n=o.Target):(t.addPoint(o.SourcePoint),n=o.Source);e.curve=t,e.sourcePort instanceof Zr&&go.ExtendPolylineStartToClusterBoundary(t,e.sourcePort.Curve),e.targetPort instanceof Zr&&go.ExtendPolylineEndToClusterBoundary(t,e.targetPort.Curve)}static ExtendPolylineEndToClusterBoundary(e,t){const n=t.closestParameter(e.end);e.addPoint(t.value(n))}static ExtendPolylineStartToClusterBoundary(e,t){const n=t.closestParameter(e.start);e.PrependPoint(t.value(n))}RerouteEdges(){this.RestoreCapacities();for(const e of this.geomEdges){const t=this.RerouteEdge(e);this.EdgesToRoutes.set(e,t)}}RestoreCapacities(){null!=this.CdtProperty&&this.CdtProperty.RestoreEdgeCapacities()}RerouteEdge(e){const t=this.EdgesToRoutes.get(e);for(const n of t)n.RemoveOccupiedEdge();return this.RouteEdge(e)}RouteEdge(e){this.CurrentEdgeGeometry=e;for(let i=0;i<this.vertexArray.length;i++){const s=this.vertexArray[i];s.SetPreviousToNull(),s.IsTargetOfRouting=s.IsSourceOfRouting=!1}const t=this.MakeTransparentShapesOfEdgeGeometry(e),n=this.RouteEdgeWithGroups();for(const i of t)i.IsTransparent=!1;return n}RouteEdgeWithGroups(){for(let e=0;e<2;e++){this.SetLengthCoefficient(),this.Queue=new ho,this.sourceLoosePoly=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.sourcePort,!0),this.targetLoosePoly=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.targetPort,!1);const t=this.RouteOnKnownSourceTargetVertices(this.CurrentEdgeGeometry.targetPort.Location.sub(this.CurrentEdgeGeometry.sourcePort.Location).normalize(),0==e);if(null!=t)return t;for(let n=0;n<this.vertexArray.length;n++)this.vertexArray[n].SetPreviousToNull()}throw new Error}RouteOnKnownSourceTargetVertices(e,t){for(this.LowestCostToTarget=Number.POSITIVE_INFINITY,this.ClosestTargetVertex=null;this.Queue.count>0;){const n={priority:0},i=this.Queue.DequeueAndGetPriority(n);if(!(n.priority>=this.LowestCostToTarget)){for(let s=0;s<i.OutBoneEdges.length;s++){const o=i.OutBoneEdges[s];o.IsPassable&&this.ProcessOutcomingBoneEdge(i,o,e,t)}for(let s=0;s<i.InBoneEdges.length;s++){const o=i.InBoneEdges[s];o.IsPassable&&this.ProcessIncomingBoneEdge(i,o,e,t)}}}return this.GetPathAndUpdateRelatedCosts()}ProcessOutcomingBoneEdge(e,t,n,i){i&&n.dot(t.TargetPoint.sub(t.SourcePoint))<0||this.ProcessBoneEdge(e,t.Target,t)}ProcessIncomingBoneEdge(e,t,n,i){i&&n.dot(t.SourcePoint.sub(t.TargetPoint))<0||this.ProcessBoneEdge(e,t.Source,t)}ProcessBoneEdge(e,t,n){const i=this.GetEdgeAdditionalCost(n,e.Cost);if(!(t.Cost<=i))if(t.Cost=i,t.PrevEdge=n,this.Queue.ContainsElement(t))this.Queue.DecreasePriority(t,i);else{if(t.IsTargetOfRouting){let s=0;return this.CurrentEdgeGeometry.targetPort instanceof Zr&&(s=this.LengthCoefficient*t.Point.sub(this.CurrentEdgeGeometry.targetPort.Location).length),void(i+s<this.LowestCostToTarget&&(this.LowestCostToTarget=i+s,this.ClosestTargetVertex=t))}this.Enqueue(t)}}GetPathAndUpdateRelatedCosts(){let e=this.ClosestTargetVertex;if(null==e)return null;const t=new Array;for(;null!=e.PrevEdge;)t.push(e.PrevEdge),this.RegisterPathInBoneEdge(e.PrevEdge),e=e.Prev;return this.EdgesToRouteSources.set(this.CurrentEdgeGeometry,e),t.reverse(),t}RegisterPathInBoneEdge(e){e.AddOccupiedEdge(),null!=this.CdtProperty&&0!=this.BundlingSettings.CapacityOverflowCoefficient&&this.UpdateResidualCostsOfCrossedCdtEdges(e)}UpdateResidualCostsOfCrossedCdtEdges(e){for(const t of e.CrossedCdtEdges)this.AdjacentToSourceOrTarget(t)||(t.ResidualCapacity-=t.ResidualCapacity==t.Capacity?this.CurrentEdgeGeometry.lineWidth:this.CurrentEdgeGeometry.lineWidth+this.BundlingSettings.EdgeSeparation)}H(e){return e.Cost+this.LengthCoefficient*e.Point.sub(this.CurrentEdgeGeometry.targetPort.Location).length}GetEdgeAdditionalCost(e,t){const n=e.TargetPoint.sub(e.SourcePoint).length;return this.LengthCoefficient*n+t+(e.IsOccupied?0:this.BundlingSettings.InkImportance*n)+this.CapacityOverflowCost(e)}CapacityOverflowCost(e){if(null==this.CdtProperty||0==this.BundlingSettings.CapacityOverflowCoefficient)return 0;let t=0;for(const n of this.CrossedCdtEdgesOfBoneEdge(e))t+=this.CostOfCrossingCdtEdgeLocal(this.capacityOverlowPenaltyMultiplier,this.BundlingSettings,this.CurrentEdgeGeometry,n);return t}CrossedCdtEdgesOfBoneEdge(e){return Array.from(null!=e.CrossedCdtEdges?e.CrossedCdtEdges:e.CrossedCdtEdges=this.ThreadBoneEdgeThroughCdt(e))}ThreadBoneEdgeThroughCdt(e){const t=e.SourcePoint,n=e.Source.Triangle,i=new Set,s=e.TargetPoint;if(nn.PointIsInsideOfTriangle(s,n))return i;const o=new rf(n,t,s);for(;o.MoveNext();){const a=o.CurrentPiercedEdge;this.Gates.has(a)&&i.add(a)}return i}static CostOfCrossingCdtEdge(e,t,n,i){let s=n.lineWidth;i.Capacity!=i.ResidualCapacity&&(s+=t.EdgeSeparation);const o=i.ResidualCapacity-s;return o>=0?0:o*e*-1}CostOfCrossingCdtEdgeLocal(e,t,n,i){return this.AdjacentToSourceOrTarget(i)?0:go.CostOfCrossingCdtEdge(e,t,n,i)}AdjacentToSourceOrTarget(e){return e.upperSite.Owner==this.sourceLoosePoly||e.lowerSite.Owner==this.sourceLoosePoly||e.upperSite.Owner==this.targetLoosePoly||e.lowerSite.Owner==this.targetLoosePoly}SetLengthCoefficient(){const e=this.GetIdealDistanceBetweenSourceAndTarget(this.CurrentEdgeGeometry);this.LengthCoefficient=this.BundlingSettings.PathLengthImportance/e}GetIdealDistanceBetweenSourceAndTarget(e){return e.sourcePort.Location.sub(e.targetPort.Location).length}SetPortVerticesAndObstacles(e,t){let n;if(e instanceof Zr){n=e.LoosePolyline;for(const s of n){let o=0;t&&(o=this.LengthCoefficient*s.sub(this.CurrentEdgeGeometry.sourcePort.Location).length),this.AddAndEnqueueVertexToEnds(s,t,o)}}else if(e instanceof Yn){n=e.LoosePolyline;for(const s of n)this.AddAndEnqueueVertexToEnds(s,t,0)}else{this.AddAndEnqueueVertexToEnds(e.Location,t,0);const i=Array.from(this.ObstacleHierarchy.GetNodeItemsIntersectingRectangle(e.Curve.boundingBox));let s=i[0].boundingBox.diagonal;n=i[0];for(let o=1;o<i.length;o++){const a=i[o],l=a.boundingBox.diagonal;l<s&&(s=l,n=a)}}return n}Enqueue(e){this.Queue.Enqueue(e,this.H(e))}AddAndEnqueueVertexToEnds(e,t,n){const i=this.FindVertex(e),s=this.VisibilityVerticesToSdVerts.get(i);t?(s.IsSourceOfRouting=!0,s.Cost=n,this.Enqueue(s)):s.IsTargetOfRouting=!0}FindVertex(e){return this.VisibilityGraph.FindVertex(e)}Initialize(){this.CreateRoutingGraph(),null!=this.CdtProperty&&(this.capacityOverlowPenaltyMultiplier=go.CapacityOverflowPenaltyMultiplier(this.BundlingSettings),this.SetVertexTriangles(),this.CalculateCapacitiesOfTrianglulation())}CalculateCapacitiesOfTrianglulation(){for(const e of this.Gates)go.CalculateCdtEdgeCapacityForEdge(e)}static CalculateCdtEdgeCapacityForEdge(e){if(e.Constrained||null==e.CwTriangle||null==e.CcwTriangle)return;const t=e.upperSite.Owner,n=e.lowerSite.Owner;if(t!=n){const i=dr.DistancePoint(new dr(t),e.lowerSite.point),s=dr.DistancePoint(new dr(n),e.upperSite.point);e.Capacity=(i+s)/2}}SetVertexTriangles(){Mr(en(Array.from(this.CdtProperty.GetTriangles()).map(n=>Cn(n,n.BoundingBox()))),en(this.vertexArray.map(n=>Cn(n,Ne.mkOnPoints([n.Point])))),(n,i)=>this.TryToAssigenTriangleToVertex(n,i));for(const n of this.vertexArray);}TryToAssigenTriangleToVertex(e,t){null==t.Triangle&&nn.PointIsInsideOfTriangle(t.Point,e)&&(t.Triangle=e)}static CapacityOverflowPenaltyMultiplier(e){return e.CapacityOverflowCoefficient*(e.PathLengthImportance+e.InkImportance)}FillCrossedCdtEdges(e){for(const t of this.geomEdges){this.sourceLoosePoly=this.SetPortVerticesAndObstacles(t.sourcePort,!0),this.targetLoosePoly=this.SetPortVerticesAndObstacles(t.targetPort,!1);for(const n of this.EdgesToRoutes.get(t))for(const i of this.CrossedCdtEdgesOfBoneEdge(n))this.AdjacentToSourceOrTarget(i)||Hd(e,t,i)}}}class hf{constructor(e,t,n,i,s){this.multiEdges=e,this.interactiveEdgeRouter=t,this.bundlingSettings=i,this.transparentShapeSetter=s,this.nodeTree=FE(n,o=>o.boundingBox)}run(){for(const e of this.GetIndependantPreGraphs())new bl(e.edges,new go(this.transparentShapeSetter,null,null),this.interactiveEdgeRouter.VisibilityGraph,this.bundlingSettings,this.interactiveEdgeRouter.LoosePadding,this.interactiveEdgeRouter.TightHierarchy,this.interactiveEdgeRouter.LooseHierarchy,null,null,null).run()}GetPortCurve(e){return this.nodeTree.FirstHitNodeWithPredicate(e.Location,(n,i)=>ee.PointRelativeToCurveLocation(n,i)!=Fe.Outside?Pt.Stop:Pt.Continue).UserData}GetIndependantPreGraphs(){const e=this.CreateInitialPregraphs();for(;;){const t=e.length;if(this.UniteConnectedPreGraphs({preGraphs:e}),t<=e.length)break}return e}UniteConnectedPreGraphs(e){const t=hf.GetIntersectionGraphOfPreGraphs(e.preGraphs);if(null==t)return;const n=ru(t),i=new Array;for(const s of n){let o=null;for(const a of s)null==o?(o=e.preGraphs[a],i.push(o)):o.AddGraph(e.preGraphs[a])}e.preGraphs=i;for(const s of e.preGraphs)this.AddIntersectingNodes(s)}AddIntersectingNodes(e){const t=e.boundingBox;for(const n of this.nodeTree.GetNodeItemsIntersectingRectangle(t))e.AddNodeBoundary(n)}static GetIntersectionGraphOfPreGraphs(e){const t=hf.EnumeratePairsOfIntersectedPreGraphs(e);return t.length?bs(t,e.length):null}static EnumeratePairsOfIntersectedPreGraphs(e){const n=FE(Array.from(Array(e.length).keys()),s=>e[s].boundingBox),i=new Array;return Un(n,n,(s,o)=>i.push(new ot(s,o))),i}CreateInitialPregraphs(){return this.multiEdges.map(e=>this.CreatePregraphFromSetOfEdgeGeometries(e))}CreatePregraphFromSetOfEdgeGeometries(e){const t=new Set,n=e[0],i=this.GetPortCurve(n.sourcePort),s=i.boundingBox;t.add(i),t.add(n.targetPort.Curve),s.addRec(n.targetPort.Curve.boundingBox);const o=this.nodeTree.GetNodeItemsIntersectingRectangle(s);for(const a of o)t.add(a);return wy.constructorStatic(e,t)}}class xt extends Zt{constructor(e,t,n=2,i=1.5,s=Math.PI/180*30,o=null,a=null){super(a),this.continueOnOverlaps=!0,this.shapesToTightLooseCouples=new Map,this.portLocationsToLoosePolylines=new cr,this.multiEdgesSeparation=5,this.routeMultiEdgesAsBundles=!0,this.UsePolylineEndShortcutting=!0,this.UseInnerPolylingShortcutting=!0,this.AllowedShootingStraightLines=!0,this._overlapsDetected=!1,this.KeepOriginalSpline=!1,this.ArrowHeadRatio=0,this.bidirectional=!1,this._edges=t,this.BundlingSettings=o,this.geomGraph=e,this.LoosePadding=i,this.tightPadding=n,this.coneAngle=s}get ContinueOnOverlaps(){return this.continueOnOverlaps}set ContinueOnOverlaps(e){this.continueOnOverlaps=e}*edges(){if(null!=this._edges)for(const e of this._edges)yield e}get LoosePadding(){return this.loosePadding}set LoosePadding(e){this.loosePadding=e}get MultiEdgesSeparation(){return this.multiEdgesSeparation}set MultiEdgesSeparation(e){this.multiEdgesSeparation=e}static mk2(e,t){return xt.mk5(e,t.Padding,t.PolylinePadding,t.ConeAngle,t.BundlingSettings)}static mk4(e,t,n,i){return new xt(e,Array.from(e.edges()),t,n,i,null)}static mk5(e,t,n,i,s){return new xt(e,Array.from(e.edges()),t,n,i,s)}static mk6(e,t,n,i,s,o){const a=xt.mk4(e,t,n,i),l=Ti.GetShapes(s,o);return a.Initialize(l,i),a}Initialize(e,t){this.rootShapes=e.filter(n=>null==n.Parents||0==n.Parents.length),this.coneAngle=t,0==this.coneAngle&&(this.coneAngle=Math.PI/6)}run(){if(this.geomGraph.isEmpty())return;const e=_r.GetShapes(this.geomGraph,this._edges);null==this.BundlingSettings&&this.geomGraph.layoutSettings&&this.geomGraph.layoutSettings.edgeRoutingSettings&&this.geomGraph.layoutSettings.edgeRoutingSettings.BundlingSettings&&(this.BundlingSettings=this.geomGraph.layoutSettings.edgeRoutingSettings.BundlingSettings),this.Initialize(e,this.coneAngle),this.GetOrCreateRoot(),this.RouteOnRoot(),this.RemoveRoot()}RouteOnRoot(){this.CalculatePortsToShapes(),this.CalculatePortsToEnterableShapes(),this.CalculateShapeToBoundaries(this.root),(!this.OverlapsDetected||this.ContinueOnOverlaps)&&(this.BindLooseShapes(),this.SetLoosePolylinesForAnywherePorts(),this.CalculateVisibilityGraph(),this.RouteOnVisGraph())}CalculatePortsToEnterableShapes(){this.portsToEnterableShapes=new Map;for(const[e,t]of this.portsToShapes){const n=new Set;xt.EdgesAttachedToPortAvoidTheNode(e)||n.add(t),this.portsToEnterableShapes.set(e,n)}for(const e of this.rootShapes)for(const t of e.Descendants())for(const n of t.Ports)au(this.portsToEnterableShapes.get(n),Array.from(t.Ancestors()).filter(s=>null!=s.BoundaryCurve))}static EdgesAttachedToPortAvoidTheNode(e){return e instanceof hr||e instanceof Zr}SetLoosePolylinesForAnywherePorts(){for(const[e,t]of this.shapesToTightLooseCouples)for(const n of e.Ports)n instanceof Yn&&(n.LoosePolyline=t.LooseShape.BoundaryCurve),n instanceof Zr&&(n.LoosePolyline=t.LooseShape.BoundaryCurve)}BindLooseShapes(){this.looseRoot=new yl;for(const e of this.root.Children){const t=this.shapesToTightLooseCouples.get(e).LooseShape;this.BindLooseShapesUnderShape(e),this.looseRoot.AddChild(t)}}BindLooseShapesUnderShape(e){const t=this.shapesToTightLooseCouples.get(e).LooseShape;for(const n of e.Children){const i=this.shapesToTightLooseCouples.get(n).LooseShape;t.AddChild(i),this.BindLooseShapesUnderShape(n)}}CalculateShapeToBoundaries(e){if(this.ProgressStep(),0==e.Children.length)return;for(const n of e.Children)this.CalculateShapeToBoundaries(n);const t=new ry(e,this.tightPadding,this.AdjustedLoosePadding,this.shapesToTightLooseCouples);t.Calculate(),this.OverlapsDetected||(this.OverlapsDetected=t.OverlapsDetected)}get OverlapsDetected(){return this._overlapsDetected}set OverlapsDetected(e){this._overlapsDetected=e}get AdjustedLoosePadding(){return null==this.BundlingSettings?this.LoosePadding:this.LoosePadding*bl.SuperLoosePaddingCoefficient}GroupEdgesByPassport(){const e=new Array;for(const t of this._edges){const n=this.EdgePassport(t);let i=e.find(s=>Vd(s.passport,n));i||(i={passport:n,edges:[]},e.push(i)),i.edges.push(t)}return e}RouteOnVisGraph(){if(this.ancestorSets=xt.GetAncestorSetsMap(Array.from(this.root.Descendants())),null==this.BundlingSettings)for(const e of this.GroupEdgesByPassport()){const n=this.GetObstaclesFromPassport(e.passport),i=this.CreateInteractiveEdgeRouter(Array.from(n));this.RouteEdgesWithTheSamePassport(e,i,n)}else this.RouteBundles()}RouteEdgesWithTheSamePassport(e,t,n){const i={regularEdges:[],multiEdges:[]};if(this.RouteMultiEdgesAsBundles){this.SplitOnRegularAndMultiedges(e.edges,i);for(const s of i.regularEdges)this.RouteEdge(t,s);null!=i.multiEdges&&(this.ScaleDownLooseHierarchy(t,n),this.RouteMultiEdges(i.multiEdges,t,e.passport))}else for(const s of e.edges)this.RouteEdge(t,s)}get RouteMultiEdgesAsBundles(){return this.routeMultiEdgesAsBundles}set RouteMultiEdgesAsBundles(e){this.routeMultiEdgesAsBundles=e}RouteEdge(e,t){const n=this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes(t);this.ProgressStep(),this.RouteEdgeInternal(t,e),xt.SetTransparency(n,!1)}ScaleDownLooseHierarchy(e,t){const n=new Array;for(const i of t){const s=this.shapesToTightLooseCouples.get(i);n.push(ti.LoosePolylineWithFewCorners(s.TightPolyline,s.Distance/1.1))}e.LooseHierarchy=xt.CreateLooseObstacleHierarachy(n),e.ClearActivePolygons(),e.AddActivePolygons(n.map(i=>new dr(i)))}RouteMultiEdges(e,t,n){const i=[];for(const a of n)for(const l of a.Children)i.push(l.BoundaryCurve);const s=new wT;s.InkImportance=1e-5,s.EdgeSeparation=this.MultiEdgesSeparation,new hf(e,t,i,s,a=>this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes(a)).run()}SplitOnRegularAndMultiedges(e,t){const n=new fu;for(const i of e)xt.IsEdgeToParent(i)?t.regularEdges.push(i):xt.RegisterInPortLocationsToEdges(i,n);t.multiEdges=null;for(const i of n.values())1==i.length||this.OverlapsDetected?t.regularEdges.push(i[0]):(null==t.multiEdges&&(t.multiEdges=new Array),t.multiEdges.push(i))}static RegisterInPortLocationsToEdges(e,t){let n;const i=new Gn(e.sourcePort.Location,e.targetPort.Location);n=t.get(i),n||(n=new Array,t.set(i,n)),n.push(e)}static IsEdgeToParent(e){return e.sourcePort instanceof Yn||e.targetPort instanceof Yn}CreateInteractiveEdgeRouter(e){const t=new Set(e.map(i=>this.shapesToTightLooseCouples.get(i).LooseShape.BoundaryCurve)),n=new Et(this.cancelToken);return n.ObstacleCalculator=new ti(e.map(i=>i.BoundaryCurve),this.tightPadding,this.loosePadding,!1),n.VisibilityGraph=this.visGraph,n.TightHierarchy=this.CreateTightObstacleHierarachy(e),n.LooseHierarchy=xt.CreateLooseObstacleHierarachy(Array.from(t)),n.UseSpanner=!0,n.LookForRoundedVertices=!0,n.TightPadding=this.tightPadding,n.LoosePadding=this.LoosePadding,n.UseEdgeLengthMultiplier=this.UseEdgeLengthMultiplier,n.UsePolylineEndShortcutting=this.UsePolylineEndShortcutting,n.UseInnerPolylingShortcutting=this.UseInnerPolylingShortcutting,n.AllowedShootingStraightLines=this.AllowedShootingStraightLines,n.AddActivePolygons(Array.from(t).map(i=>new dr(i))),n}GetObstaclesFromPassport(e){if(0==e.size)return new Set(this.root.Children);const t=this.GetCommonAncestorsAbovePassport(e),n=this.GetAllAncestors(e),i=new Set;for(const a of e)for(const l of a.Children)n.has(l)||i.add(l);const s=gl(new Set(e),i),o=new eo.c;for(const a of e)t.has(a)||o.enqueue(a);for(;o.length>0;){const a=o.dequeue();for(const l of a.Parents){for(const c of l.Children)n.has(c)||i.add(c);!t.has(l)&&!s.has(l)&&(o.enqueue(l),s.add(l))}}return i}GetAllAncestors(e){if(0==e.size)return new Set;let t=new Set(e);for(const n of e)t=gl(t,this.ancestorSets.get(n));return t}GetCommonAncestorsAbovePassport(e){if(0==e.size)return new Set;const t=Array.from(e);let n=this.ancestorSets.get(t[0]);for(let i=1;i<t.length;i++)n=ao(n,this.ancestorSets.get(t[i]));return n}RouteBundles(){this.ScaleLooseShapesDown(),this.CalculateEdgeEnterablePolylines();const e=this.GetLooseHierarchy(),t=bl.CreateConstrainedDelaunayTriangulation(e),n=new go(s=>this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes(s),t,this.FindCdtGates(t));new bl(this._edges,n,this.visGraph,this.BundlingSettings,this.LoosePadding,this.GetTightHierarchy(),e,this.enterableLoose,this.enterableTight,s=>this.LoosePolyOfOriginalShape(this.portsToShapes.get(s))).run()}CreateTheMapToParentLooseShapes(e,t){for(const n of e.Children){const s=this.shapesToTightLooseCouples.get(n).LooseShape.BoundaryCurve;t.set(s,e),this.CreateTheMapToParentLooseShapes(n,t)}}FindCdtGates(e){const t=new Map;this.CreateTheMapToParentLooseShapes(this.root,t);const n=new Set;for(const i of e.PointsToSites.values())for(const s of i.Edges){if(null==s.CwTriangle&&null==s.CcwTriangle)continue;const o=i.Owner,a=s.lowerSite.Owner;if(o==a)continue;const l=t.get(o);l&&l==t.get(a)&&n.add(s)}return n}CalculateEdgeEnterablePolylines(){this.enterableLoose=new Map,this.enterableTight=new Map;for(const e of this.edges()){const t=new Set,n=new Set;this.GetEdgeEnterablePolylines(e,t,n),this.enterableLoose.set(e,t),this.enterableTight.set(e,n)}}GetEdgeEnterablePolylines(e,t,n){const i=this.portsToShapes.get(e.sourcePort),s=this.portsToShapes.get(e.targetPort);i!=this.root&&this.GetEnterablesForShape(i,t,n),s!=this.root&&this.GetEnterablesForShape(s,t,n)}GetEnterablesForShape(e,t,n){for(const i of this.ancestorSets.get(e)){const s=this.LoosePolyOfOriginalShape(i);s&&t.add(s);const o=this.TightPolyOfOriginalShape(i);o&&n.add(o)}}GetTightHierarchy(){return en(Array.from(this.shapesToTightLooseCouples.values()).map(e=>Cn(e.TightPolyline,e.TightPolyline.boundingBox)))}GetLooseHierarchy(){const e=new Set;for(const t of this.shapesToTightLooseCouples.values())e.add(t.LooseShape.BoundaryCurve);return en(Array.from(e).map(t=>Cn(t,t.boundingBox)))}ScaleLooseShapesDown(){for(const[,e]of this.shapesToTightLooseCouples)e.LooseShape.BoundaryCurve=ti.LoosePolylineWithFewCorners(e.TightPolyline,e.Distance/bl.SuperLoosePaddingCoefficient)}EdgePassport(e){const t=new Set,n=this.portsToShapes.get(e.sourcePort),i=this.portsToShapes.get(e.targetPort);return this.IsAncestor(n,i)?(au(t,i.Parents),t.add(n),t):this.IsAncestor(i,n)?(au(t,n.Parents),t.add(i),t):(n!=this.looseRoot&&au(t,n.Parents),i!=this.looseRoot&&au(t,i.Parents),t)}*AllPorts(){for(const e of this.edges())yield e.sourcePort,yield e.targetPort}CalculatePortsToShapes(){this.portsToShapes=new Map;for(const e of this.root.Descendants())for(const t of e.Ports)this.portsToShapes.set(t,e);for(const e of this.AllPorts())this.portsToShapes.has(e)||(this.root.Ports.add(e),this.portsToShapes.set(e,this.root))}RouteEdgeInternal(e,t){const n=new Array;e.sourcePort instanceof Yn||zo(n,this.AddVisibilityEdgesFromPort(e.sourcePort)),e.targetPort instanceof Yn||zo(n,this.AddVisibilityEdgesFromPort(e.targetPort));const i={smoothedPolyline:null};if(e.curve=x.closeDistEps(e.sourcePort.Location,e.targetPort.Location)?io.RouteSelfEdge(e.sourcePort.Curve,Math.max(2*this.LoosePadding,e.GetMaxArrowheadLength()),i):t.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(e.sourcePort,e.targetPort,!0,i),e.smoothedPolyline=i.smoothedPolyline,null==e.curve)throw new Error;for(const s of n)tn.RemoveEdge(s);ro.trimSplineAndCalculateArrowheadsII(e,e.sourcePort.Curve,e.targetPort.Curve,e.curve,!1)}*AddVisibilityEdgesFromPort(e){let t,n;if(e instanceof hr||!(t=this.portsToShapes.get(e))||!(n=this.shapesToTightLooseCouples.get(t)))return;const i=n.LooseShape;for(const s of i.BoundaryCurve)null==this.visGraph.FindEdgePP(e.Location,s)&&(yield this.visGraph.AddEdgePP(e.Location,s))}MakeTransparentShapesOfEdgeGeometryAndGetTheShapes(e){const t=this.portsToShapes.get(e.sourcePort),n=this.portsToShapes.get(e.targetPort),i=new Array;for(const s of this.GetTransparentShapes(e.sourcePort,e.targetPort,t,n))null!=s&&i.push(this.LooseShapeOfOriginalShape(s));for(const s of this.portsToEnterableShapes.get(e.sourcePort))i.push(this.LooseShapeOfOriginalShape(s));for(const s of this.portsToEnterableShapes.get(e.targetPort))i.push(this.LooseShapeOfOriginalShape(s));return xt.SetTransparency(i,!0),i}LooseShapeOfOriginalShape(e){return e==this.root?this.looseRoot:this.shapesToTightLooseCouples.get(e).LooseShape}LoosePolyOfOriginalShape(e){return this.LooseShapeOfOriginalShape(e).BoundaryCurve}TightPolyOfOriginalShape(e){return e==this.root?null:this.shapesToTightLooseCouples.get(e).TightPolyline}*GetTransparentShapes(e,t,n,i){for(const s of this.ancestorSets.get(n))yield s;for(const s of this.ancestorSets.get(i))yield s;xt.EdgesAttachedToPortAvoidTheNode(e)||(yield n),xt.EdgesAttachedToPortAvoidTheNode(t)||(yield i)}static SetTransparency(e,t){for(const n of e)n.IsTransparent=t}IsAncestor(e,t){let n;return null!=t&&null!=(n=this.ancestorSets.get(t))&&n.has(e)}static CreateLooseObstacleHierarachy(e){return en(e.map(t=>Cn(t,t.boundingBox)))}CreateTightObstacleHierarachy(e){return en(e.map(n=>this.shapesToTightLooseCouples.get(n).TightPolyline).map(n=>Cn(n,n.boundingBox)))}CalculateVisibilityGraph(){const e=null!=this.LineSweeperPorts?un.mk(this.LineSweeperPorts):new un;this.ProcessHookAnyWherePorts(e),this.portRTree=GE(Array.from(e.values()).map(t=>[Ne.rectangleOnPoint(t),t])),this.visGraph=new tn,this.FillVisibilityGraphUnderShape(this.root)}static ShowVisGraph(e,t,n,i=null,s=null){const o=Array.from(t.Edges).map(a=>Xe.mkDebugCurveTWCI(100,1,null!=a.IsPassable&&a.IsPassable()?"green":"black",me.mkPP(a.SourcePoint,a.TargetPoint)));if(null!=n)for(const a of n){o.push(Xe.mkDebugCurveTWCI(100,.3,"brown",a));for(const l of a)o.push(Xe.mkDebugCurveTWCI(100,1,"green",tr.mkCircle(1,l)))}if(null!=i)for(const a of i)o.push(Xe.mkDebugCurveTWCI(100,10,"navy",a));if(null!=s)for(const a of s)o.push(Xe.mkDebugCurveTWCI(100,10,"red",a))}ProcessHookAnyWherePorts(e){for(const t of this.edges())t.sourcePort instanceof Yn||t.sourcePort instanceof Zr||e.add(t.sourcePort.Location),t.targetPort instanceof Yn||t.targetPort instanceof Zr||e.add(t.targetPort.Location)}FillVisibilityGraphUnderShape(e){const t=e.Children;for(const u of t)this.FillVisibilityGraphUnderShape(u);const n=this.shapesToTightLooseCouples.get(e),i=n?n.LooseShape.BoundaryCurve:null,s=n?n.LooseShape:this.looseRoot,o=new Set(s.Children.map(u=>u.BoundaryCurve)),a=this.RemoveInsidePortsAndSplitBoundaryIfNeeded(i);let l=new tn,c=uu.mk([],l,this.coneAngle,a,i);c.run(),l=new tn,c=uu.mk(Array.from(o),l,this.coneAngle,a,i),c.run(),this.ProgressStep();for(const u of l.Edges)this.TryToCreateNewEdgeAndSetIsPassable(u,s);this.AddBoundaryEdgesToVisGraph(i)}get Bidirectional(){return this.bidirectional}set Bidirectional(e){this.bidirectional=e}TryToCreateNewEdgeAndSetIsPassable(e,t){let n=this.visGraph.FindEdgePP(e.SourcePoint,e.TargetPoint);null==n&&(n=this.visGraph.AddEdgePP(e.SourcePoint,e.TargetPoint),null!=t&&(n.IsPassable=()=>t.IsTransparent))}AddBoundaryEdgesToVisGraph(e){if(null==e)return;let t;for(let n=e.startPoint;t=n.nextOnPolyline,this.visGraph.AddEdgePP(n.point,t.point),t!=e.startPoint;n=t);}RemoveInsidePortsAndSplitBoundaryIfNeeded(e){const t=new un;if(null==e){for(const s of this.portRTree.GetAllLeaves())t.add(s);return this.portRTree.Clear(),t}const i=this.portRTree.GetAllIntersecting(e.boundingBox);for(const s of i)switch(ee.PointRelativeToCurveLocation(s,e)){case Fe.Inside:t.add(s),this.portLocationsToLoosePolylines.set(s,e),this.portRTree.Remove(Ne.rectangleOnPoint(s),s);break;case Fe.Boundary:this.portRTree.Remove(Ne.rectangleOnPoint(s),s),this.portLocationsToLoosePolylines.set(s,e);const o=xt.FindPointOnPolylineToInsertAfter(e,s);if(null==o)throw new Error;bn.InsertPointIntoPolylineAfter(e,o,s)}return t}static FindPointOnPolylineToInsertAfter(e,t){for(let n=e.startPoint;;){const i=n.nextOnPolyline;if(x.closeDistEps(t,n.point)||x.closeDistEps(t,i.point))return null;if(nt(x.distToLineSegment(t,n.point,i.point).dist,0))return n;if(n=i,n==e.startPoint)throw new Error}}GetOrCreateRoot(){if(1==this.rootShapes.length){const e=this.rootShapes[0];if(null==e.BoundaryCurve)return void(this.root=e)}this.rootWasCreated=!0,this.root=new yl(null);for(const e of this.rootShapes)this.root.AddChild(e)}RemoveRoot(){if(this.rootWasCreated)for(const e of this.rootShapes)e.RemoveParent(this.root)}static GetAncestorSetsMap(e){const t=new Map;for(const n of e.filter(i=>!t.has(i)))t.set(n,xt.GetAncestorSet(n,t));return t}static GetAncestorSet(e,t){const n=new Set(e.Parents);for(const i of e.Parents){let s=t.get(i);s||t.set(i,s=xt.GetAncestorSet(i,t));for(const o of s)n.add(o)}return n}static CreatePortsIfNeeded(e){for(const t of e){if(null==t.sourcePort){const n=t;new lo(()=>n.source.boundaryCurve,()=>n.source.center,new x(0,0))}if(null==t.targetPort){const n=t;new lo(()=>n.target.boundaryCurve,()=>n.target.center,new x(0,0))}}}static ComputeLooseSplinePadding(e,t){return(e-2*t)/8}}class fr extends Zt{constructor(e,t){super(null),this.edges=e,this.padding=t}run(){xt.CreatePortsIfNeeded(this.edges);for(const e of this.edges)fr.RouteEdge(e,this.padding)}static RouteEdge(e,t){const n=e;null==n.sourcePort&&(n.sourcePort=lo.mk(()=>e.source.boundaryCurve,()=>e.source.center)),null==n.targetPort&&(n.targetPort=lo.mk(()=>e.target.boundaryCurve,()=>e.target.center)),fr.ContainmentLoop(n,t)||(n.curve=fr.GetEdgeLine(e)),ro.trimSplineAndCalculateArrowheadsII(n,n.sourcePort.Curve,n.targetPort.Curve,e.curve,!1)}static ContainmentLoop(e,t){const n=e.sourcePort.Curve,i=e.targetPort.Curve;if(null==n||null==i)return!1;const s=n.boundingBox,o=i.boundingBox,a=s.containsRect(o),l=!a&&o.containsRect(s);return!(!a&&!l||(e.curve=fr.CreateLoop(s,o,l,t),0))}static CreateLoop(e,t,n,i){return n?fr.CreateLoop_(e,t,i,!1):fr.CreateLoop_(t,e,i,!0)}static CreateLoop_(e,t,n,i){const s=e.center,o=fr.FindClosestPointOnBoxBoundary(e.center,t);let a=o.sub(s);const c=(Math.abs(a.x)<q.distanceEpsilon?Math.min(s.y-t.bottom,t.top-s.y):Math.min(s.x-t.left,t.right-s.x))/2,u=Math.min(n,c);a.length<=q.distanceEpsilon&&(a=new x(1,0));const S=a.normalize(),b=S.rotate(Math.PI/2),L=o.add(S.mul(n)),F=L.add(b.mul(u)),G=o.add(b.mul(u)),J=s.add(b.mul(u));return wn.mkFromPoints(i?[J,G,F,L,o,s]:[s,o,L,F,G,J]).createCurve()}static FindClosestPointOnBoxBoundary(e,t){const n=e.x-t.left<t.right-e.x?t.left:t.right,i=e.y-t.bottom<t.top-e.y?t.bottom:t.top;return Math.abs(n-e.x)<Math.abs(i-e.y)?new x(n,e.y):new x(e.x,i)}static GetEdgeLine(e){let t,n,i,s;null==e.sourcePort?(t=e.source.center,n=e.source.boundaryCurve):(t=e.sourcePort.Location,n=e.sourcePort.Curve),null==e.targetPort?(i=e.target.center,s=e.target.boundaryCurve):(i=e.targetPort.Location,s=e.targetPort.Curve);let o=me.mkPP(t,i),a=ee.getAllIntersections(n,o,!1);if(a.length>0){let l=o.trim(a[0].par1,1);l instanceof me&&(o=l,a=ee.getAllIntersections(s,o,!1),a.length>0&&(l=o.trim(0,a[0].par1),l instanceof me&&(o=l)))}return o}static CreateSimpleEdgeCurveWithUnderlyingPolyline(e){const t=e.source.center,n=e.target.center;e.source==e.target?(e.underlyingPolyline=fr.CreateUnderlyingPolylineForSelfEdge(t,2/(3*e.source.boundaryCurve.boundingBox.width),e.source.boundingBox.height/4),e.curve=e.underlyingPolyline.createCurve()):(e.underlyingPolyline=wn.mkFromPoints([t,n]),e.curve=e.underlyingPolyline.createCurve()),ro.trimSplineAndCalculateArrowheadsII(e,e.source.boundaryCurve,e.target.boundaryCurve,e.curve,!1)}static CreateUnderlyingPolylineForSelfEdge(e,t,n){const i=e.add(new x(0,n)),s=e.add(new x(t,n)),o=e.add(new x(t,-1*n)),a=e.add(new x(0,-1*n));let l=Bt.mkSiteP(e);const c=new wn(l);return l=Bt.mkSiteSP(l,i),l=Bt.mkSiteSP(l,s),l=Bt.mkSiteSP(l,o),l=Bt.mkSiteSP(l,a),Bt.mkSiteSP(l,e),c}static SetStraightLineEdgesWithUnderlyingPolylines(e){xt.CreatePortsIfNeeded(Array.from(e.edges()));for(const t of e.edges())fr.CreateSimpleEdgeCurveWithUnderlyingPolyline(t)}}class po extends Zt{constructor(e,t,n,i,s,o){super(null),this.settings=e,this.OriginalGraph=t,this.Database=n,this.ProperLayeredGraph=s,this.LayerArrays=i,this.IntGraph=o}run(){this.createSplines()}createSplines(){this.createRegularSplines(),this.createSelfSplines(),null!=this.IntGraph&&this.RouteFlatEdges(),null==this.OriginalGraph.graph.parent&&this.RouteUnroutedEdges()}RouteUnroutedEdges(){for(const e of this.OriginalGraph.deepNodes())for(const t of e.outEdges())t.curve||fr.RouteEdge(t,Math.max(t.source.padding,t.target.padding))}RouteFlatEdges(){}createRegularSplines(){for(const e of this.Database.RegularMultiedges()){const t=e.length,n=1==t&&!this.FanAtSourceOrTarget(e[0]);for(let i=Math.floor(t/2);i<t;i++)this.createSplineForNonSelfEdge(e[i],n);for(let i=Math.floor(t/2)-1;i>=0;i--)this.createSplineForNonSelfEdge(e[i],n)}}FanAtSourceOrTarget(e){return this.ProperLayeredGraph.OutDegreeIsMoreThanOne(e.source)||this.ProperLayeredGraph.InDegreeIsMoreThanOne(e.target)}createSelfSplines(){for(const[e,t]of this.Database.Multiedges.keyValues()){const n=e;if(n.x==n.y){const i=this.Database.Anchors[n.x];let s=i.leftAnchor;for(const o of t){const a=this.settings.NodeSeparation+(this.settings.MinNodeWidth+s),l=i.bottomAnchor/2,c=i.origin,u=c.add(new x(0,l)),S=c.add(new x(a,l)),b=c.add(new x(a,-1*l)),L=c.add(new x(0,-1*l));let F=Bt.mkSiteP(c);const G=new wn(F);F=Bt.mkSiteSP(F,u),F=Bt.mkSiteSP(F,S),F=Bt.mkSiteSP(F,b),F=Bt.mkSiteSP(F,L),Bt.mkSiteSP(F,c);const J=G.createCurve();if(o.curve=J,o.edge.underlyingPolyline=G,s=a,null!=o.edge.label){s+=o.edge.label.width;const te=o.edge.label.center=new x(J.value((J.parStart+J.parEnd)/2).x+o.labelWidth/2,i.y),ie=new x(o.edge.label.width/2,o.edge.label.height/2),he=Ne.mkPP(te.add(ie),te.sub(ie));o.edge.label.boundingBox=he}ro.trimSplineAndCalculateArrowheadsII(o.edge,o.edge.source.boundaryCurve,o.edge.target.boundaryCurve,J,!1)}}}}createSplineForNonSelfEdge(e,t){null!=e.LayerEdges&&(this.drawSplineBySmothingThePolyline(e,t),e.IsVirtualEdge||(e.updateEdgeLabelPosition(this.Database.Anchors),ro.trimSplineAndCalculateArrowheadsII(e.edge,e.edge.source.boundaryCurve,e.edge.target.boundaryCurve,e.curve,!0)))}drawSplineBySmothingThePolyline(e,t){const n=new Vn(e,this.Database.Anchors,this.OriginalGraph,this.settings,this.LayerArrays,this.ProperLayeredGraph,this.Database),i=n.getSpline(t);e.reversed?(e.curve=i.reverse(),e.underlyingPolyline=n.Reverse().GetPolyline):(e.curve=i,e.underlyingPolyline=n.GetPolyline)}static UpdateLabel(e,t){let n=null;t.labelIsToTheRightOfTheSpline?(e.label.center=new x(t.x+t.rightAnchor/2,t.y),n=me.mkPP(e.labelBBox.leftTop,e.labelBBox.leftBottom)):t.labelIsToTheLeftOfTheSpline&&(e.label.center=new x(t.x-t.leftAnchor/2,t.y),n=me.mkPP(e.labelBBox.rightTop,e.labelBBox.rightBottom));const i=po.GetSegmentInFrontOfLabel(e.curve,e.label.center.y);if(null!=i&&0==ee.getAllIntersections(e.curve,ee.polyFromBox(e.labelBBox),!1).length){const s={curveClosestPoint:void 0,labelSideClosest:void 0};if(po.FindClosestPoints(s,i,n))po.ShiftLabel(e,s);else{const o=i.closestParameter(n.start),a=i.closestParameter(n.end);i.value(o).sub(n.start).length<i.value(a).sub(n.end).length?(s.curveClosestPoint=i.value(o),s.labelSideClosest=n.start):(s.curveClosestPoint=i.value(a),s.labelSideClosest=n.end),po.ShiftLabel(e,s)}}}static ShiftLabel(e,t){const n=e.lineWidth/2,i=t.curveClosestPoint.sub(t.labelSideClosest),s=i.length;s>n&&(e.label.center=e.label.center.add(i.div(s*(s-n))))}static FindClosestPoints(e,t,n){const i=ee.minDistWithinIntervals(t,n,t.parStart,t.parEnd,n.parStart,n.parEnd,(t.parStart+t.parEnd)/2,(n.parStart+n.parEnd)/2);return!!i&&(e.curveClosestPoint=i.aX,e.labelSideClosest=i.bX,!0)}static GetSegmentInFrontOfLabel(e,t){if(e instanceof ee){const n=e;for(const i of n.segs)if((i.start.y-t)*(i.end.y-t)<=0)return i}return null}static GetNodeKind(e,t){return 0==e?On.Top:e<t.count?On.Internal:On.Bottom}}function W5(r,e){new Sy(r,r.layoutSettings,e).run()}function j5(r,e=null,t=!0){cP(r,r.layoutSettings?r.layoutSettings:new Gd),yy(r,e,W5,hP,mT,t)}class Sy extends Zt{constructor(e,t,n){if(super(n),this.LayersAreDoubled=!1,null==e)return;this.originalGraph=e,this.sugiyamaSettings=t;const i=Array.from(e.shallowNodes());this.nodeIdToIndex=new Map;let s=0;for(const a of i)this.nodeIdToIndex.set(a.id,s++);const o=[];for(const a of this.originalGraph.edges()){const l=this.nodeIdToIndex.get(a.source.id);if(null==l)continue;const c=this.nodeIdToIndex.get(a.target.id);if(null==c)continue;const u=new Oi(l,c,a);o.push(u)}this.IntGraph=new iu(o,e.shallowNodeCount),this.IntGraph.nodes=i,this.database=new p4(i.length);for(const a of this.IntGraph.edges)this.database.registerOriginalEdgeInMultiedges(a);this.cycleRemoval()}get verticalConstraints(){return this.sugiyamaSettings.verticalConstraints}get HorizontalConstraints(){return this.sugiyamaSettings.horizontalConstraints}run(){0!=this.originalGraph.shallowNodeCount?(function oj(r,e){if(e.isIdentity())return;const t=e.inverse();for(const n of r.shallowNodes())n.transform(t);for(const n of r.edges())if(null!=n.label){const i=Ne.mkPP(t.multiplyPoint(new x(0,0)),t.multiplyPoint(new x(n.label.width,n.label.height)));n.label.width=i.width,n.label.height=i.height}}(this.originalGraph,this.sugiyamaSettings.transform),this.engineLayerArrays=this.calculateLayers(),this.sugiyamaSettings.edgeRoutingSettings.EdgeRoutingMode==cn.SugiyamaSplines&&this.runPostLayering(),function aj(r,e){if(!e.isIdentity()){for(const t of r.shallowNodes())t.transform(e);for(const t of r.edges())if(null!=t.label){const n=Ne.mkPP(e.multiplyPoint(new x(0,0)),e.multiplyPoint(new x(t.label.width,t.label.height)));t.label.width=n.width,t.label.height=n.height}!function lj(r,e){for(const t of r.edges())null!=t.label&&(t.label.center=e.multiplyPoint(t.label.center)),cj(e,t)}(r,e)}}(this.originalGraph,this.sugiyamaSettings.transform),this.originalGraph.updateBoundingBox(),this.SetMargins()):this.originalGraph.boundingBox=Ne.mkEmpty()}SetMargins(){this.originalGraph.boundingBox.right+=this.sugiyamaSettings.margins.right,this.originalGraph.boundingBox.top+=this.sugiyamaSettings.margins.bottom,this.originalGraph.boundingBox.left-=this.sugiyamaSettings.margins.left,this.originalGraph.boundingBox.bottom-=this.sugiyamaSettings.margins.bottom}runPostLayering(){const t=null!=this.constrainedOrdering?cn.Spline:this.sugiyamaSettings.edgeRoutingSettings.EdgeRoutingMode;switch(t){case cn.SugiyamaSplines:this.calculateEdgeSplines();break;case cn.StraightLine:case cn.Spline:case cn.SplineBundling:throw new Error("not implemented");case cn.Rectilinear:case cn.RectilinearToCenter:throw new Error("Not implemented yet");default:throw new Error("Unexpected mode "+t)}}SetLabels(){throw new Error("not implementedt")}cycleRemoval(){const e=this.sugiyamaSettings.verticalConstraints,t=e.isEmpty?so.getFeedbackSet(this.IntGraph):e.getFeedbackSetExternal(this.IntGraph,this.nodeIdToIndex);this.database.addFeedbackSet(t)}calculateLayers(){this.CreateGluedDagSkeletonForLayering();const e=this.CalculateLayerArrays();return this.UpdateNodePositionData(),e}UpdateNodePositionData(){this.TryToSatisfyMinWidhtAndMinHeight();for(let e=0;e<this.IntGraph.nodeCount&&e<this.database.Anchors.length;e++)this.IntGraph.nodes[e].center=this.database.Anchors[e].origin;if(this.sugiyamaSettings.GridSizeByX>0)for(let e=0;e<this.originalGraph.shallowNodeCount;e++)this.SnapLeftSidesOfTheNodeToGrid(e,this.sugiyamaSettings.GridSizeByX)}SnapLeftSidesOfTheNodeToGrid(e,t){const n=this.IntGraph.nodes[e],i=this.database.Anchors[e];i.leftAnchor-=t/2,i.rightAnchor-=t/2;const s=n.boundingBox.left,a=s-Math.floor(s/t)*t;Math.abs(a)<.001||(n.center=Math.abs(a)<=t/2?n.center.add(new x(-a,0)):n.center.add(new x(t-a,0)),i.x=n.center.x)}TryToSatisfyMinWidhtAndMinHeight(){this.TryToSatisfyMinWidth(),this.TryToSatisfyMinHeight()}TryToSatisfyMinWidth(){0!=this.sugiyamaSettings.MinimalWidth&&this.GetCurrentWidth()<this.sugiyamaSettings.MinimalWidth&&this.StretchWidth()}StretchWidth(){const e=new Xr;for(const n of this.originalGraph.shallowNodes())e.AddValue(n.boundingBox.width/2),e.AddValue(this.sugiyamaSettings.MinimalWidth-n.boundingBox.width/2);const t=new Xr;for(const n of this.NodeAnchors())t.AddValue(n.x);if(t.length>q.distanceEpsilon){const n=e.length/t.length;if(n>1)for(const i of this.anchors)i.x*=n}}TryToSatisfyMinHeight(){0!=this.sugiyamaSettings.MinimalHeight&&this.GetCurrentHeight()<this.sugiyamaSettings.MinimalHeight&&this.StretchHeight()}GetCurrentHeight(){const e=new Xr;for(const t of this.NodeAnchors())e.AddValue(t.top),e.AddValue(t.bottom);return e.length}StretchHeight(){const e=new Xr;for(const n of this.originalGraph.shallowNodes())e.AddValue(n.boundingBox.height/2),e.AddValue(this.sugiyamaSettings.MinimalHeight-n.boundingBox.height/2);const t=new Xr;for(const n of this.NodeAnchors())t.AddValue(n.y);if(t.length>q.distanceEpsilon){const n=e.length/t.length;if(n>1)for(const i of this.anchors)i.y*=n}}*NodeAnchors(){const e=Math.min(this.IntGraph.nodeCount,this.anchors.length);for(let t=0;t<e;t++)yield this.anchors[t]}GetCurrentWidth(){const e=new Xr;for(const t of this.NodeAnchors())e.AddValue(t.left),e.AddValue(t.right);return e.length}ExtendLayeringToUngluedSameLayerVertices(e){const t=this.verticalConstraints;for(let n=0;n<e.length;n++)e[n]=e[t.nodeToRepr(n)];return e}calculateEdgeSplines(){new po(this.sugiyamaSettings,this.originalGraph,this.database,this.engineLayerArrays,this.properLayeredGraph,this.IntGraph).run()}YLayeringAndOrdering(e){let t=e.GetLayers();YE.Balance(this.gluedDagSkeletonForLayering,t,this.GetNodeCountsOfGluedDag(),null),t=this.ExtendLayeringToUngluedSameLayerVertices(t);let n=new Ts(t);if(null==this.HorizontalConstraints||this.HorizontalConstraints.IsEmpty)return n=this.YLayeringAndOrderingWithoutHorizontalConstraints(n),n;throw new Error("not implemented")}CreateProperLayeredGraph(e){const t=e.length;let n=0;for(const s of this.database.SkeletonEdges()){const o=q5(e,s);o>0&&(s.LayerEdges=new Array(o));let a=0;if(o>1){let l=t+n++,c=new oo(s.source,l,s.CrossingWeight,s.weight);s.LayerEdges[a++]=c;for(let u=0;u<o-2;u++)l++,n++,c=new oo(l-1,l,s.CrossingWeight,s.weight),s.LayerEdges[a++]=c;c=new oo(l,s.target,s.CrossingWeight,s.weight),s.LayerEdges[a]=c}else if(1==o){const l=new oo(s.source,s.target,s.CrossingWeight,s.weight);s.LayerEdges[a]=l}}const i=new Array(this.originalGraph.shallowNodeCount+n).fill(0);for(const s of this.database.SkeletonEdges())if(null!=s.LayerEdges){let o=e[s.source];i[s.source]=o--;for(const a of s.LayerEdges)i[a.Target]=o--}else i[s.source]=e[s.source],i[s.target]=e[s.target];return this.properLayeredGraph=new Uo(new iu(Array.from(this.database.SkeletonEdges()),e.length)),this.properLayeredGraph.BaseGraph.nodes=this.IntGraph.nodes,new Ts(i)}YLayeringAndOrderingWithoutHorizontalConstraints(e){const t=this.CreateProperLayeredGraph(e.y);return ml.OrderLayers(this.properLayeredGraph,t,this.originalGraph.shallowNodeCount,this.sugiyamaSettings,this.cancelToken),Ud.UpdateLayerArrays1(this.properLayeredGraph,t),t}CalculateYLayers(){const e=this.YLayeringAndOrdering(new P4(this.gluedDagSkeletonForLayering,this.cancelToken));return null!=this.constrainedOrdering?e:this.InsertLayersIfNeeded(e)}InsertLayersIfNeeded(e){this.InsertVirtualEdgesIfNeeded(e);const t=this.AnalyzeNeedToInsertLayersAndHasMultiedges(e);if(t.needToInsertLayers){const n=su.InsertLayers(this.properLayeredGraph,e,this.database,this.IntGraph);this.properLayeredGraph=n.layeredGraph,e=n.la,this.LayersAreDoubled=!0}else if(t.multipleEdges){const n=Wo.InsertPaths(this.properLayeredGraph,e,this.database,this.IntGraph);this.properLayeredGraph=n.layeredGraph,e=n.la}return this.RecreateIntGraphFromDataBase(),e}RecreateIntGraphFromDataBase(){let e=new Array;for(const t of this.database.Multiedges.values())e=e.concat(t);this.IntGraph.SetEdges(e,this.IntGraph.nodeCount)}InsertVirtualEdgesIfNeeded(e){if(null==this.constrainedOrdering)for(const[t,n]of this.database.Multiedges.keyValues())if(n.length%2==0&&e.y[t.x]-1==e.y[t.y]){const i=new io(null),s=new Oi(t.x,t.y,i);s.IsVirtualEdge=!0,n.splice(n.length/2,0,s),this.IntGraph.addEdge(s)}}AnalyzeNeedToInsertLayersAndHasMultiedges(e){let t=!1,n=!1;for(const i of this.IntGraph.edges)if(i.hasLabel&&e.y[i.source]!=e.y[i.target]){t=!0;break}if(0==t&&null==this.constrainedOrdering)for(const[i,s]of this.database.Multiedges.keyValues())if(s.length>1&&(n=!0,e.y[i.x]-e.y[i.y]==1)){t=!0;break}return{needToInsertLayers:t,multipleEdges:n}}UseBrandesXCalculations(e){return e.x.length>=this.sugiyamaSettings.BrandesThreshold}CalculateAnchorsAndYPositions(e){this.anchors=function K5(r,e,t,n,i){const s=r.Anchors=new Array(e.NodeCount);for(let o=0;o<s.length;o++)s[o]=new Dr(i.LabelCornersPreserveCoefficient);for(let o=0;o<t.shallowNodeCount;o++)Sy.CalcAnchorsForOriginalNode(o,n,s,r,i);for(const o of r.AllIntEdges())if(null!=o.LayerEdges){for(const a of o.LayerEdges){const l=a.Target;if(l!=o.target){const c=s[l];r.MultipleMiddles.has(l)?(c.leftAnchor=c.rightAnchor=4,c.topAnchor=c.bottomAnchor=EP(i)/2):(c.leftAnchor=c.rightAnchor=.5,c.topAnchor=c.bottomAnchor=EP(i)/2)}}if(o.hasLabel){const l=s[o.LayerEdges[o.LayerEdges.length/2].Source],u=o.labelHeight;l.rightAnchor=o.labelWidth,l.leftAnchor=8,l.topAnchor<u/2&&(l.topAnchor=l.bottomAnchor=u/2),l.labelIsToTheRightOfTheSpline=!0}}return s}(this.database,this.properLayeredGraph,this.originalGraph,this.IntGraph,this.sugiyamaSettings),function J5(r,e,t,n,i,s,o){const a=n.Anchors;let l=t.Margins+e,c=0;for(const u of r.Layers){let S=0,b=0;for(const te of u){const ie=a[te];ie.bottomAnchor>S&&(S=ie.bottomAnchor),ie.topAnchor>b&&(b=ie.topAnchor)}Q5(u,S,b,t.shallowNodeCount,n.Anchors);const F=l+S+yP(n,r,c,i,s,l);let G=F+b;if(X5(s)){G+=mP(G,s.GridSizeByY);for(const te of u)a[te].top=G}else if(Z5(s)){let te=F-S;te+=mP(te,te);for(const ie of u)a[ie].bottom=te,G=Math.max(a[ie].top,G)}else for(const te of u)a[te].y=F;l=G+s.ActualLayerSeparation(o),c++}yP(n,r,c,i,s,l)}(e,500,this.originalGraph,this.database,this.IntGraph,this.sugiyamaSettings,this.LayersAreDoubled)}OptimizeEdgeLabelsLocations(){for(let e=0;e<this.anchors.length;e++){const t=this.anchors[e];if(t.labelIsToTheRightOfTheSpline){const n=this.GetSuccessorAndPredecessor(e);if(!ej(t,n.predecessor,n.successor)){const i=n.predecessor.origin.sub(t.origin).length+n.successor.origin.sub(t.origin).length,o=new x(t.right-t.leftAnchor,t.y);n.predecessor.origin.sub(o).length+n.successor.origin.sub(o).length<i&&wP(t)}}}}GetSuccessorAndPredecessor(e){let t,n;for(const i of this.properLayeredGraph.InEdges(e))t=i.Source;for(const i of this.properLayeredGraph.OutEdges(e))n=i.Target;return{predecessor:this.anchors[t],successor:this.anchors[n]}}CalculateLayerArrays(){const e=this.CalculateYLayers();return null==this.constrainedOrdering?(this.CalculateAnchorsAndYPositions(e),this.UseBrandesXCalculations(e)?this.CalculateXPositionsByBrandes(e):this.CalculateXLayersByGansnerNorth(e)):this.anchors=this.database.Anchors,this.OptimizeEdgeLabelsLocations(),this.engineLayerArrays=e,this.StraightensShortEdges(),this.CalculateOriginalGraphBox(),e}StretchToDesiredAspectRatio(e,t){e>t?this.StretchInYDirection(e/t):e<t&&this.StretchInXDirection(t/e)}StretchInYDirection(e){const t=(this.originalGraph.boundingBox.top+this.originalGraph.boundingBox.bottom)/2;for(const i of this.database.Anchors)i.bottomAnchor=i.bottomAnchor*e,i.topAnchor=i.topAnchor*e,i.y=t+e*(i.y-t);const n=this.originalGraph.height*e;this.originalGraph.boundingBox=new Ne({left:this.originalGraph.boundingBox.left,top:t+n/2,right:this.originalGraph.boundingBox.right,bottom:t-n/2})}StretchInXDirection(e){const t=(this.originalGraph.boundingBox.left+this.originalGraph.boundingBox.right)/2;for(const i of this.database.Anchors)i.leftAnchor=i.leftAnchor*e,i.rightAnchor=i.rightAnchor*e,i.x=t+e*(i.x-t);const n=this.originalGraph.width*e;this.originalGraph.boundingBox=new Ne({left:t-n/2,top:this.originalGraph.boundingBox.top,right:t+n/2,bottom:this.originalGraph.boundingBox.bottom})}CalculateOriginalGraphBox(){if(0==this.anchors.length)return 0;const e=new Ne({left:this.anchors[0].left,top:this.anchors[0].top,right:this.anchors[0].right,bottom:this.anchors[0].bottom});for(let i=1;i<this.anchors.length;i++){const s=this.anchors[i];e.add(s.leftTop),e.add(s.rightBottom)}const t=e.leftTop.sub(e.rightBottom).length/2,n=new x(-1*t,t);return e.add(e.leftTop.add(n)),e.add(e.rightBottom.sub(n)),this.originalGraph.boundingBox=e,0!=e.height?e.width/e.height:0}StraightensShortEdges(){for(;this.StraightenEdgePaths(););}StraightenEdgePaths(){let e=!1;for(const t of this.database.AllIntEdges())2==t.LayerSpan&&(e=this.ShiftVertexWithNeighbors(t.LayerEdges[0].Source,t.LayerEdges[0].Target,t.LayerEdges[1].Target)||e);return e}ShiftVertexWithNeighbors(e,t,n){const i=this.database.Anchors[e],s=this.database.Anchors[n],o=this.database.Anchors[t],a=(s.x-i.x)/(s.y-i.y)*(o.y-i.y)+i.x,l=1e-4;return a>o.x+l?this.TryShiftToTheRight(a,t):a<o.x-l&&this.TryShiftToTheLeft(a,t)}TryShiftToTheLeft(e,t){const i=this.engineLayerArrays.x[t];if(i>0){const o=Math.max(this.database.Anchors[this.engineLayerArrays.Layers[this.engineLayerArrays.y[t]][i-1]].right+(this.sugiyamaSettings.NodeSeparation+this.database.Anchors[t].leftAnchor),e);return o<this.database.Anchors[t].x-1&&(this.database.Anchors[t].x=o,!0)}return this.database.Anchors[t].x=e,!0}TryShiftToTheRight(e,t){const n=this.engineLayerArrays.Layers[this.engineLayerArrays.y[t]],i=this.engineLayerArrays.x[t];if(i<n.length-1){const o=Math.min(this.database.Anchors[n[i+1]].left-(this.sugiyamaSettings.NodeSeparation-this.database.Anchors[t].rightAnchor),e);return o>this.database.Anchors[t].x+1&&(this.database.Anchors[t].x=o,!0)}return this.database.Anchors[t].x=e,!0}CalculateXLayersByGansnerNorth(e){this.xLayoutGraph=this.CreateXLayoutGraph(e),this.CalculateXLayersByGansnerNorthOnProperLayeredGraph()}CalculateXLayersByGansnerNorthOnProperLayeredGraph(){const e=new NT(this.xLayoutGraph,null).GetLayers();for(let t=0;t<this.database.Anchors.length;t++)this.anchors[t].x=e[t]}CreateXLayoutGraph(e){let t=this.properLayeredGraph.NodeCount;const n=new Array;for(const s of this.properLayeredGraph.Edges){const o=new Oi(t,s.Source,null),a=new Oi(t,s.Target,null);a.weight=s.Weight,o.weight=s.Weight,o.separation=0,a.separation=0,t++,n.push(o),n.push(a)}for(const s of e.Layers)for(let o=s.length-1;o>0;o--){const a=s[o],l=s[o-1],c=new Oi(a,l,null);c.separation=Math.ceil(this.database.Anchors[a].leftAnchor+(this.database.Anchors[l].rightAnchor+this.sugiyamaSettings.NodeSeparation)+.5),n.push(c)}const i=new D4(this.IntGraph,this.properLayeredGraph,e,n,t);return i.SetEdgeWeights(),i}CalculateXPositionsByBrandes(e){N4.CalculateXCoordinates(e,this.properLayeredGraph,this.originalGraph.shallowNodeCount,this.database.Anchors,this.sugiyamaSettings.NodeSeparation)}GluedDagSkeletonEdges(){const e=new ul(this.IntGraph.nodeCount);for(const[n,i]of this.database.Multiedges.keyValues()){if(n.isDiagonal())continue;const s=this.verticalConstraints.gluedIntEdge(i[0]);s.source!=s.target&&e.set(s.source,s.target,s)}const t=Array.from(this.verticalConstraints.gluedUpDownIntConstraints.values()).map(n=>function $5(r,e){const t=new Oi(r.x,r.y,e);return t.weight=0,t.separation=1,t}(n,null));for(const n of t)e.set(n.source,n.target,n);return Array.from(e.values())}static CalcAnchorsForOriginalNode(e,t,n,i,s){const o={leftAnchor:0,rightAnchor:0,topAnchor:0,bottomAnchor:0};null!=t.nodes&&function rj(r,e,t){r.rightAnchor=r.leftAnchor=(e.width+t.GridSizeByX)/2,r.topAnchor=r.bottomAnchor=e.height/2}(o,t.nodes[e],s),function ij(r,e,t,n){const i=function sj(r,e,t,n){let i=0;const s=r.GetMultiedge(e,e);if(s.length>0){for(const o of s)null!=o.edge.label&&(t.rightAnchor+=o.edge.label.width,t.topAnchor<o.edge.label.height/2&&(t.topAnchor=t.bottomAnchor=o.edge.label.height/2));i+=(n.NodeSeparation+n.MinNodeWidth)*s.length}return i}(t,r,e,n);e.rightAnchor+=i}(e,o,i,s);const a=s.MinNodeWidth/2;o.leftAnchor<a&&(o.leftAnchor=a),o.rightAnchor<a&&(o.rightAnchor=a);const l=s.MinNodeHeight/2;o.topAnchor<l&&(o.topAnchor=l),o.bottomAnchor<l&&(o.bottomAnchor=l),n[e]=Dr.mkAnchor(o.leftAnchor,o.rightAnchor,o.topAnchor,o.bottomAnchor,t.nodes[e],s.LabelCornersPreserveCoefficient),n[e].padding=t.nodes[e].padding}CreateGluedDagSkeletonForLayering(){this.gluedDagSkeletonForLayering=new iu(this.GluedDagSkeletonEdges(),this.originalGraph.shallowNodeCount),this.SetGluedEdgesWeights()}SetGluedEdgesWeights(){const e=new ul(this.IntGraph.nodeCount);for(const t of this.gluedDagSkeletonForLayering.edges)e.set(t.source,t.target,t);for(const[t,n]of this.database.Multiedges.keyValues())if(t.x!=t.y){const i=this.verticalConstraints.gluedIntPair(t);if(i.x==i.y)continue;const s=e.get(i.x,i.y);for(const o of n)s.weight+=o.weight}}GetNodeCountsOfGluedDag(){return this.verticalConstraints.isEmpty?new Array(this.IntGraph.nodeCount).fill(1):this.verticalConstraints.getGluedNodeCounts()}}function mP(r,e){if(0==e)return 0;const n=r-Math.floor(r/e)*e;return Math.abs(n)<1e-4?0:e-n}function EP(r){return 1.5*r.MinNodeHeight/8}function yP(r,e,t,n,i,s){let o=0;if(t>0){const a=function tj(r,e,t){const n=new bi;for(const i of r)if(!(i>=t.nodeCount))for(const s of t.outEdges[i])e[s.source]==e[s.target]&&n.addNN(s.source,s.target);return Array.from(n.values())}(e.Layers[t-1],e.y,n);if(a.length){const l=i.LayerSeparation/3,c=s;o=Math.max(...a.map(u=>function nj(r,e,t,n){let i=0;const s=n.GetMultiedgeI(r);for(const o of s){i+=t;const a=o.edge.label;null!=a&&(a.center=new x(a.center.x,e+i+a.height/2),i+=a.height)}return i}(u,c,l,r)))}}return o}function q5(r,e){return r[e.source]-r[e.target]}function Q5(r,e,t,n,i){if(function z5(r,e){for(const t of r)if(t<e)return!0;return!1}(r,n))for(const s of r)if(s>=n){const o=i[s];o.bottomAnchor=e,o.topAnchor=t}}function X5(r){return r.SnapToGridByY==dl.Top}function Z5(r){return r.SnapToGridByY==dl.Bottom}function ej(r,e,t){if(r.labelIsToTheRightOfTheSpline){if(x.getTriangleOrientation(e.origin,r.origin,t.origin)==Ie.Clockwise)return!0;const n=r.leftAnchor,i=r.rightAnchor,s=r.x;return wP(r),x.getTriangleOrientation(e.origin,r.origin,t.origin)==Ie.Counterclockwise||(r.x=s,r.leftAnchor=n,r.rightAnchor=i,r.labelIsToTheRightOfTheSpline=!0,r.labelIsToTheLeftOfTheSpline=!1,!1)}return!1}function wP(r){const e=r.right,t=r.leftAnchor;r.leftAnchor=r.rightAnchor,r.rightAnchor=t,r.x=e-r.rightAnchor,r.labelIsToTheLeftOfTheSpline=!0,r.labelIsToTheRightOfTheSpline=!1}function cj(r,e){if(null!=e.curve){e.curve=e.curve.transform(r);const t=e;null!=t.sourceArrowhead&&(t.sourceArrowhead.tipPosition=r.multiplyPoint(t.sourceArrowhead.tipPosition)),null!=t.targetArrowhead&&(t.targetArrowhead.tipPosition=r.multiplyPoint(t.targetArrowhead.tipPosition)),function uj(r,e){if(null!=r.underlyingPolyline)for(let t=r.underlyingPolyline.headSite;null!=t;t=t.next)t.point=e.multiplyPoint(t.point)}(e,r)}}class dj{constructor(e,t,n){this.useMSAGLLayeredLayout=e,this.nodeWidth=t,this.nodeHeight=n,this.cachedGeomGraph=void 0}run(e){var t,n;if(!this.cachedGeomGraph){const s=this.createGeomGraph(e);if(this.useMSAGLLayeredLayout){const o=new Gd;o.layerDirection=Nr.LR,o.LayerSeparation=150,o.MinNodeHeight=this.nodeHeight,o.MinNodeWidth=this.nodeWidth,s.layoutSettings=o,j5(s)}else!function C5(r,e){function t(s){s.layoutSettings||(s.layoutSettings=function i(s){return s.shallowNodeCount<200||s.edgeCount<200?new Gd:new aP}(s))}t(r),yy(r,e,function n(s,o){if(t(s),s.layoutSettings instanceof Gd)new Sy(s,s.layoutSettings,o).run();else{if(!(s.layoutSettings instanceof aP))throw Error("not implemented");new lP(s,o,()=>1,s.layoutSettings).run()}},hP,mT)}(s,void 0);this.cachedGeomGraph=s}e.edgeLabels=[];for(const s of this.cachedGeomGraph.shallowNodes()){const o=e.nodes.find(a=>a.id===s.id);if((null===(t=o.position)||void 0===t?void 0:t.x)===s.center.x&&(null===(n=o.position)||void 0===n?void 0:n.y)===s.center.y)break;o.position={x:s.center.x,y:s.center.y},o.dimension={width:o.dimension.width,height:o.dimension.height}}const i=Array.from(this.cachedGeomGraph.edges());for(const s of e.edges)this.updateGraphEdge(e,s,i);return e}updateEdge(e,t){return e}setNode(e,t,n,i,s=new x(0,0)){let o=e.graph.findNode(t);null==o&&e.graph.addNode(o=new uT(t));const a=new _E(o);return a.boundaryCurve=tr.mkCircle(10,new x(10,10)),a}createGeomGraph(e){const t=Ii.mk("graph",new tu(0,0));return e.nodes.forEach(n=>{this.setNode(t,n.id,n.dimension.width,n.dimension.height)}),e.edges.forEach(n=>{t.setEdge(n.source,n.target)}),t}updateGraphEdge(e,t,n){var i;if(!t.points||0===t.points.length){const s=n.find(o=>o.source.id===t.source&&o.target.id===t.target);t.points=this.getPointsFromGeoEdge(s)}if((null===(i=t.points)||void 0===i?void 0:i.length)>0){const s=`${t.source}\x01${t.target}\x01\0`,o=e.edgeLabels[s];o?o.points=t.points:e.edgeLabels[s]={points:t.points}}return e}getPointsFromGeoEdge(e){const t=[],n=function n4(r,e){return ME(r.parStart,r.start,r.parEnd,r.end,r,e)}(e.curve,e.curve.end.sub(e.curve.start).length/20);for(let i=0;i<n.length;i++)t.push({y:n[i].y,x:n[i].x});return t.push({y:e.targetArrowhead.tipPosition.y,x:e.targetArrowhead.tipPosition.x}),t}}function fj(r,e){1&r&&(Jt(),Ot(0,"marker",4),Rr(1,"path",5),Mt())}function gj(r,e){1&r&&(Jt(),Ot(0,"g",6),Rr(1,"path",7),Mt())}function pj(r,e){if(1&r&&(Ot(0,"ngx-graph",1),$t(1,fj,2,0,"ng-template",null,2,Fp),$t(3,gj,2,0,"ng-template",null,3,Fp),Mt()),2&r){const t=dt();ht("links",t.links)("nodes",t.nodes)("layout",t.useMsaglLayout?t.msaglLayout:void 0)("curve",t.curve)("enableZoom",!0)("nodeWidth",t.nodeWidth)("nodeHeight",t.nodeHeight)("draggingEnabled",!1)("autoZoom",!0)}}let mj=(()=>{class r{constructor(){this.nodes=void 0,this.links=void 0,this.nodeWidth=10,this.nodeHeight=10,this.useMsaglLayout=!0,this.useMSAGLLayeredLayout=!1,this.curve=JG}ngOnInit(){this.msaglLayout=new dj(this.useMSAGLLayeredLayout,this.nodeWidth,this.nodeHeight)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=ks({type:r,selectors:[["ngx-graph-msagl"]],inputs:{nodes:"nodes",links:"links",nodeWidth:"nodeWidth",nodeHeight:"nodeHeight",useMsaglLayout:"useMsaglLayout",useMSAGLLayeredLayout:"useMSAGLLayeredLayout"},decls:1,vars:1,consts:[[3,"links","nodes","layout","curve","enableZoom","nodeWidth","nodeHeight","draggingEnabled","autoZoom",4,"ngIf"],[3,"links","nodes","layout","curve","enableZoom","nodeWidth","nodeHeight","draggingEnabled","autoZoom"],["defsTemplate",""],["linkTemplate",""],["id","arrow","viewBox","0 -5 10 10","refX","8","refY","0","markerWidth","2","markerHeight","2","orient","auto"],["d","M0,-5L10,0L0,5",1,"arrow-head"],[1,"edge"],["stroke-width","1","marker-end","url(#arrow)",1,"line"]],template:function(t,n){1&t&&$t(0,pj,5,9,"ngx-graph",0),2&t&&ht("ngIf",n.nodes&&n.links)},directives:[pm,O3],styles:["[_nghost-%COMP%]    {display:block;height:inherit;width:inherit}"],changeDetection:0}),r})(),Ej=(()=>{class r{constructor(){this.nodes=[],this.links=[],this.title="ngx-msagl",this.nodes=aT.t,this.links=aT.$}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=ks({type:r,selectors:[["app-root"]],decls:4,vars:2,consts:[[1,"containerRoute"],[3,"nodes","links"]],template:function(t,n){1&t&&(Rr(0,"app-bar"),Ot(1,"section",0),Rr(2,"ngx-graph-msagl",1)(3,"router-outlet"),Mt()),2&t&&(pt(2),ht("nodes",n.nodes)("links",n.links))},directives:[WW,mj,CE],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh}[_nghost-%COMP%]   .containerRoute[_ngcontent-%COMP%]{height:calc(100% - 36px);width:100%}"]}),r})(),yj=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=mr({type:r,bootstrap:[Ej]}),r.\u0275inj=ir({providers:[],imports:[[d2,HW,ek,Ck,T3]]}),r})();(function $1(){if(aC)throw new Error("Cannot enable prod mode after platform setup.");oC=!1})(),u2().bootstrapModule(yj).catch(r=>console.error(r))},9695:(D,T,h)=>{D.exports={graphlib:h(6456),layout:h(4850),debug:h(1914),util:{time:h(1510).time,notime:h(1510).notime},version:h(8126)}},2234:(D,T,h)=>{"use strict";var p=h(5760),I=h(7365);D.exports={run:function C(R){var d="greedy"===R.graph().acyclicer?I(R,function f(v){return function(g){return v.edge(g).weight}}(R)):function w(R){var d=[],f={},v={};return p.forEach(R.nodes(),function g(y){p.has(v,y)||(v[y]=!0,f[y]=!0,p.forEach(R.outEdges(y),function(m){p.has(f,m.w)?d.push(m):g(m.w)}),delete f[y])}),d}(R);p.forEach(d,function(v){var g=R.edge(v);R.removeEdge(v),g.forwardName=v.name,g.reversed=!0,R.setEdge(v.w,v.v,g,p.uniqueId("rev"))})},undo:function E(R){p.forEach(R.edges(),function(d){var f=R.edge(d);if(f.reversed){R.removeEdge(d);var v=f.forwardName;delete f.reversed,delete f.forwardName,R.setEdge(d.w,d.v,f,v)}})}}},9999:(D,T,h)=>{var p=h(5760),I=h(1510);function w(E,R,d,f,v,g){var m=v[R][g-1],O=I.addDummyNode(E,"border",{width:0,height:0,rank:g,borderType:R},d);v[R][g]=O,E.setParent(O,f),m&&E.setEdge(m,O,{weight:1})}D.exports=function C(E){p.forEach(E.children(),function R(d){var f=E.children(d),v=E.node(d);if(f.length&&p.forEach(f,R),p.has(v,"minRank")){v.borderLeft=[],v.borderRight=[];for(var g=v.minRank,y=v.maxRank+1;g<y;++g)w(E,"borderLeft","_bl",d,v,g),w(E,"borderRight","_br",d,v,g)}})}},3870:(D,T,h)=>{"use strict";var p=h(5760);function w(g){p.forEach(g.nodes(),function(y){E(g.node(y))}),p.forEach(g.edges(),function(y){E(g.edge(y))})}function E(g){var y=g.width;g.width=g.height,g.height=y}function d(g){g.y=-g.y}function v(g){var y=g.x;g.x=g.y,g.y=y}D.exports={adjust:function I(g){var y=g.graph().rankdir.toLowerCase();("lr"===y||"rl"===y)&&w(g)},undo:function C(g){var y=g.graph().rankdir.toLowerCase();("bt"===y||"rl"===y)&&function R(g){p.forEach(g.nodes(),function(y){d(g.node(y))}),p.forEach(g.edges(),function(y){var m=g.edge(y);p.forEach(m.points,d),p.has(m,"y")&&d(m)})}(g),("lr"===y||"rl"===y)&&(function f(g){p.forEach(g.nodes(),function(y){v(g.node(y))}),p.forEach(g.edges(),function(y){var m=g.edge(y);p.forEach(m.points,v),p.has(m,"x")&&v(m)})}(g),w(g))}}},3226:D=>{function T(){var I={};I._next=I._prev=I,this._sentinel=I}function h(I){I._prev._next=I._next,I._next._prev=I._prev,delete I._next,delete I._prev}function p(I,C){if("_next"!==I&&"_prev"!==I)return C}D.exports=T,T.prototype.dequeue=function(){var I=this._sentinel,C=I._prev;if(C!==I)return h(C),C},T.prototype.enqueue=function(I){var C=this._sentinel;I._prev&&I._next&&h(I),I._next=C._next,C._next._prev=I,C._next=I,I._prev=C},T.prototype.toString=function(){for(var I=[],C=this._sentinel,w=C._prev;w!==C;)I.push(JSON.stringify(w,p)),w=w._prev;return"["+I.join(", ")+"]"}},1914:(D,T,h)=>{var p=h(5760),I=h(1510),C=h(6456).Graph;D.exports={debugOrdering:function w(E){var R=I.buildLayerMatrix(E),d=new C({compound:!0,multigraph:!0}).setGraph({});return p.forEach(E.nodes(),function(f){d.setNode(f,{label:f}),d.setParent(f,"layer"+E.node(f).rank)}),p.forEach(E.edges(),function(f){d.setEdge(f.v,f.w,{},f.name)}),p.forEach(R,function(f,v){d.setNode("layer"+v,{rank:"same"}),p.reduce(f,function(y,m){return d.setEdge(y,m,{style:"invis"}),m})}),d}}},6456:(D,T,h)=>{var p;try{p=h(5510)}catch(I){}p||(p=window.graphlib),D.exports=p},7365:(D,T,h)=>{var p=h(5760),I=h(6456).Graph,C=h(3226);D.exports=function E(g,y){if(g.nodeCount()<=1)return[];var m=function f(g,y){var m=new I,O=0,P=0;p.forEach(g.nodes(),function(B){m.setNode(B,{v:B,in:0,out:0})}),p.forEach(g.edges(),function(B){var Y=m.edge(B.v,B.w)||0,_=y(B);m.setEdge(B.v,B.w,Y+_),P=Math.max(P,m.node(B.v).out+=_),O=Math.max(O,m.node(B.w).in+=_)});var N=p.range(P+O+3).map(function(){return new C}),M=O+1;return p.forEach(m.nodes(),function(B){v(N,M,m.node(B))}),{graph:m,buckets:N,zeroIdx:M}}(g,y||w),O=function R(g,y,m){for(var M,O=[],P=y[y.length-1],N=y[0];g.nodeCount();){for(;M=N.dequeue();)d(g,y,m,M);for(;M=P.dequeue();)d(g,y,m,M);if(g.nodeCount())for(var B=y.length-2;B>0;--B)if(M=y[B].dequeue()){O=O.concat(d(g,y,m,M,!0));break}}return O}(m.graph,m.buckets,m.zeroIdx);return p.flatten(p.map(O,function(P){return g.outEdges(P.v,P.w)}),!0)};var w=p.constant(1);function d(g,y,m,O,P){var N=P?[]:void 0;return p.forEach(g.inEdges(O.v),function(M){var B=g.edge(M),Y=g.node(M.v);P&&N.push({v:M.v,w:M.w}),Y.out-=B,v(y,m,Y)}),p.forEach(g.outEdges(O.v),function(M){var B=g.edge(M),_=g.node(M.w);_.in-=B,v(y,m,_)}),g.removeNode(O.v),N}function v(g,y,m){m.out?m.in?g[m.out-m.in+y].enqueue(m):g[g.length-1].enqueue(m):g[0].enqueue(m)}},4850:(D,T,h)=>{"use strict";var p=h(5760),I=h(2234),C=h(1496),w=h(4124),E=h(1510).normalizeRanks,R=h(162),d=h(1510).removeEmptyRanks,f=h(1230),v=h(9999),g=h(3870),y=h(2974),m=h(8226),O=h(1510),P=h(6456).Graph;D.exports=function N(ae,ue){var pe=ue&&ue.debugTiming?O.time:O.notime;pe("layout",function(){var ce=pe("  buildLayoutGraph",function(){return function W(ae){var ue=new P({multigraph:!0,compound:!0}),pe=xe(ae.graph());return ue.setGraph(p.merge({},_,Se(pe,Y),p.pick(pe,K))),p.forEach(ae.nodes(),function(ce){var ve=xe(ae.node(ce));ue.setNode(ce,p.defaults(Se(ve,Q),ne)),ue.setParent(ce,ae.parent(ce))}),p.forEach(ae.edges(),function(ce){var ve=xe(ae.edge(ce));ue.setEdge(ce,p.merge({},re,Se(ve,X),p.pick(ve,U)))}),ue}(ae)});pe("  runLayout",function(){!function M(ae,ue){ue("    makeSpaceForEdgeLabels",function(){!function k(ae){var ue=ae.graph();ue.ranksep/=2,p.forEach(ae.edges(),function(pe){var ce=ae.edge(pe);ce.minlen*=2,"c"!==ce.labelpos.toLowerCase()&&("TB"===ue.rankdir||"BT"===ue.rankdir?ce.width+=ce.labeloffset:ce.height+=ce.labeloffset)})}(ae)}),ue("    removeSelfEdges",function(){!function ge(ae){p.forEach(ae.edges(),function(ue){if(ue.v===ue.w){var pe=ae.node(ue.v);pe.selfEdges||(pe.selfEdges=[]),pe.selfEdges.push({e:ue,label:ae.edge(ue)}),ae.removeEdge(ue)}})}(ae)}),ue("    acyclic",function(){I.run(ae)}),ue("    nestingGraph.run",function(){f.run(ae)}),ue("    rank",function(){w(O.asNonCompoundGraph(ae))}),ue("    injectEdgeLabelProxies",function(){!function V(ae){p.forEach(ae.edges(),function(ue){var pe=ae.edge(ue);if(pe.width&&pe.height){var ce=ae.node(ue.v),ve=ae.node(ue.w);O.addDummyNode(ae,"edge-proxy",{rank:(ve.rank-ce.rank)/2+ce.rank,e:ue},"_ep")}})}(ae)}),ue("    removeEmptyRanks",function(){d(ae)}),ue("    nestingGraph.cleanup",function(){f.cleanup(ae)}),ue("    normalizeRanks",function(){E(ae)}),ue("    assignRankMinMax",function(){!function H(ae){var ue=0;p.forEach(ae.nodes(),function(pe){var ce=ae.node(pe);ce.borderTop&&(ce.minRank=ae.node(ce.borderTop).rank,ce.maxRank=ae.node(ce.borderBottom).rank,ue=p.max(ue,ce.maxRank))}),ae.graph().maxRank=ue}(ae)}),ue("    removeEdgeLabelProxies",function(){!function $(ae){p.forEach(ae.nodes(),function(ue){var pe=ae.node(ue);"edge-proxy"===pe.dummy&&(ae.edge(pe.e).labelRank=pe.rank,ae.removeNode(ue))})}(ae)}),ue("    normalize.run",function(){C.run(ae)}),ue("    parentDummyChains",function(){R(ae)}),ue("    addBorderSegments",function(){v(ae)}),ue("    order",function(){y(ae)}),ue("    insertSelfEdges",function(){!function Ee(ae){var ue=O.buildLayerMatrix(ae);p.forEach(ue,function(pe){var ce=0;p.forEach(pe,function(ve,Oe){var Ye=ae.node(ve);Ye.order=Oe+ce,p.forEach(Ye.selfEdges,function(it){O.addDummyNode(ae,"selfedge",{width:it.label.width,height:it.label.height,rank:Ye.rank,order:Oe+ ++ce,e:it.e,label:it.label},"_se")}),delete Ye.selfEdges})})}(ae)}),ue("    adjustCoordinateSystem",function(){g.adjust(ae)}),ue("    position",function(){m(ae)}),ue("    positionSelfEdges",function(){!function ye(ae){p.forEach(ae.nodes(),function(ue){var pe=ae.node(ue);if("selfedge"===pe.dummy){var ce=ae.node(pe.e.v),ve=ce.x+ce.width/2,Oe=ce.y,Ye=pe.x-ve,it=ce.height/2;ae.setEdge(pe.e,pe.label),ae.removeNode(ue),pe.label.points=[{x:ve+2*Ye/3,y:Oe-it},{x:ve+5*Ye/6,y:Oe-it},{x:ve+Ye,y:Oe},{x:ve+5*Ye/6,y:Oe+it},{x:ve+2*Ye/3,y:Oe+it}],pe.label.x=pe.x,pe.label.y=pe.y}})}(ae)}),ue("    removeBorderNodes",function(){!function fe(ae){p.forEach(ae.nodes(),function(ue){if(ae.children(ue).length){var pe=ae.node(ue),ce=ae.node(pe.borderTop),ve=ae.node(pe.borderBottom),Oe=ae.node(p.last(pe.borderLeft)),Ye=ae.node(p.last(pe.borderRight));pe.width=Math.abs(Ye.x-Oe.x),pe.height=Math.abs(ve.y-ce.y),pe.x=Oe.x+pe.width/2,pe.y=ce.y+pe.height/2}}),p.forEach(ae.nodes(),function(ue){"border"===ae.node(ue).dummy&&ae.removeNode(ue)})}(ae)}),ue("    normalize.undo",function(){C.undo(ae)}),ue("    fixupEdgeLabelCoords",function(){!function z(ae){p.forEach(ae.edges(),function(ue){var pe=ae.edge(ue);if(p.has(pe,"x"))switch(("l"===pe.labelpos||"r"===pe.labelpos)&&(pe.width-=pe.labeloffset),pe.labelpos){case"l":pe.x-=pe.width/2+pe.labeloffset;break;case"r":pe.x+=pe.width/2+pe.labeloffset}})}(ae)}),ue("    undoCoordinateSystem",function(){g.undo(ae)}),ue("    translateGraph",function(){!function se(ae){var ue=Number.POSITIVE_INFINITY,pe=0,ce=Number.POSITIVE_INFINITY,ve=0,Oe=ae.graph(),Ye=Oe.marginx||0,it=Oe.marginy||0;function rr(rn){var vn=rn.x,ct=rn.y,Li=rn.width,ut=rn.height;ue=Math.min(ue,vn-Li/2),pe=Math.max(pe,vn+Li/2),ce=Math.min(ce,ct-ut/2),ve=Math.max(ve,ct+ut/2)}p.forEach(ae.nodes(),function(rn){rr(ae.node(rn))}),p.forEach(ae.edges(),function(rn){var vn=ae.edge(rn);p.has(vn,"x")&&rr(vn)}),ue-=Ye,ce-=it,p.forEach(ae.nodes(),function(rn){var vn=ae.node(rn);vn.x-=ue,vn.y-=ce}),p.forEach(ae.edges(),function(rn){var vn=ae.edge(rn);p.forEach(vn.points,function(ct){ct.x-=ue,ct.y-=ce}),p.has(vn,"x")&&(vn.x-=ue),p.has(vn,"y")&&(vn.y-=ce)}),Oe.width=pe-ue+Ye,Oe.height=ve-ce+it}(ae)}),ue("    assignNodeIntersects",function(){!function j(ae){p.forEach(ae.edges(),function(ue){var Oe,Ye,pe=ae.edge(ue),ce=ae.node(ue.v),ve=ae.node(ue.w);pe.points?(Oe=pe.points[0],Ye=pe.points[pe.points.length-1]):(pe.points=[],Oe=ve,Ye=ce),pe.points.unshift(O.intersectRect(ce,Oe)),pe.points.push(O.intersectRect(ve,Ye))})}(ae)}),ue("    reversePoints",function(){!function le(ae){p.forEach(ae.edges(),function(ue){var pe=ae.edge(ue);pe.reversed&&pe.points.reverse()})}(ae)}),ue("    acyclic.undo",function(){I.undo(ae)})}(ce,pe)}),pe("  updateInputGraph",function(){!function B(ae,ue){p.forEach(ae.nodes(),function(pe){var ce=ae.node(pe),ve=ue.node(pe);ce&&(ce.x=ve.x,ce.y=ve.y,ue.children(pe).length&&(ce.width=ve.width,ce.height=ve.height))}),p.forEach(ae.edges(),function(pe){var ce=ae.edge(pe),ve=ue.edge(pe);ce.points=ve.points,p.has(ve,"x")&&(ce.x=ve.x,ce.y=ve.y)}),ae.graph().width=ue.graph().width,ae.graph().height=ue.graph().height}(ae,ce)})})};var Y=["nodesep","edgesep","ranksep","marginx","marginy"],_={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},K=["acyclicer","ranker","rankdir","align"],Q=["width","height"],ne={width:0,height:0},X=["minlen","weight","width","height","labeloffset"],re={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},U=["labelpos"];function Se(ae,ue){return p.mapValues(p.pick(ae,ue),Number)}function xe(ae){var ue={};return p.forEach(ae,function(pe,ce){ue[ce.toLowerCase()]=pe}),ue}},5760:(D,T,h)=>{var p;try{p={cloneDeep:h(733),constant:h(6684),defaults:h(8800),each:h(5474),filter:h(5281),find:h(2516),flatten:h(2274),forEach:h(9851),forIn:h(1176),has:h(4842),isUndefined:h(4235),last:h(5809),map:h(9984),mapValues:h(203),max:h(8176),merge:h(567),min:h(9439),minBy:h(9525),now:h(1710),pick:h(6372),range:h(361),reduce:h(1337),sortBy:h(2906),uniqueId:h(1541),values:h(377),zipObject:h(1617)}}catch(I){}p||(p=window._),D.exports=p},1230:(D,T,h)=>{var p=h(5760),I=h(1510);function w(f,v,g,y,m,O,P){var N=f.children(P);if(N.length){var M=I.addBorderNode(f,"_bt"),B=I.addBorderNode(f,"_bb"),Y=f.node(P);f.setParent(M,P),Y.borderTop=M,f.setParent(B,P),Y.borderBottom=B,p.forEach(N,function(_){w(f,v,g,y,m,O,_);var K=f.node(_),Q=K.borderTop?K.borderTop:_,ne=K.borderBottom?K.borderBottom:_,X=K.borderTop?y:2*y,re=Q!==ne?1:m-O[P]+1;f.setEdge(M,Q,{weight:X,minlen:re,nestingEdge:!0}),f.setEdge(ne,B,{weight:X,minlen:re,nestingEdge:!0})}),f.parent(P)||f.setEdge(v,M,{weight:0,minlen:m+O[P]})}else P!==v&&f.setEdge(v,P,{weight:0,minlen:g})}D.exports={run:function C(f){var v=I.addDummyNode(f,"root",{},"_root"),g=function E(f){var v={};function g(y,m){var O=f.children(y);O&&O.length&&p.forEach(O,function(P){g(P,m+1)}),v[y]=m}return p.forEach(f.children(),function(y){g(y,1)}),v}(f),y=p.max(p.values(g))-1,m=2*y+1;f.graph().nestingRoot=v,p.forEach(f.edges(),function(P){f.edge(P).minlen*=m});var O=function R(f){return p.reduce(f.edges(),function(v,g){return v+f.edge(g).weight},0)}(f)+1;p.forEach(f.children(),function(P){w(f,v,m,O,y,g,P)}),f.graph().nodeRankFactor=m},cleanup:function d(f){var v=f.graph();f.removeNode(v.nestingRoot),delete v.nestingRoot,p.forEach(f.edges(),function(g){f.edge(g).nestingEdge&&f.removeEdge(g)})}}},1496:(D,T,h)=>{"use strict";var p=h(5760),I=h(1510);D.exports={run:function C(R){R.graph().dummyChains=[],p.forEach(R.edges(),function(d){!function w(R,d){var f=d.v,v=R.node(f).rank,g=d.w,y=R.node(g).rank,m=d.name,O=R.edge(d),P=O.labelRank;if(y!==v+1){var N,M,B;for(R.removeEdge(d),B=0,++v;v<y;++B,++v)O.points=[],N=I.addDummyNode(R,"edge",M={width:0,height:0,edgeLabel:O,edgeObj:d,rank:v},"_d"),v===P&&(M.width=O.width,M.height=O.height,M.dummy="edge-label",M.labelpos=O.labelpos),R.setEdge(f,N,{weight:O.weight},m),0===B&&R.graph().dummyChains.push(N),f=N;R.setEdge(f,g,{weight:O.weight},m)}}(R,d)})},undo:function E(R){p.forEach(R.graph().dummyChains,function(d){var g,f=R.node(d),v=f.edgeLabel;for(R.setEdge(f.edgeObj,v);f.dummy;)g=R.successors(d)[0],R.removeNode(d),v.points.push({x:f.x,y:f.y}),"edge-label"===f.dummy&&(v.x=f.x,v.y=f.y,v.width=f.width,v.height=f.height),f=R.node(d=g)})}}},3034:(D,T,h)=>{var p=h(5760);D.exports=function I(C,w,E){var d,R={};p.forEach(E,function(f){for(var g,y,v=C.parent(f);v;){if((g=C.parent(v))?(y=R[g],R[g]=v):(y=d,d=v),y&&y!==v)return void w.setEdge(y,v);v=g}})}},1323:(D,T,h)=>{var p=h(5760);D.exports=function I(C,w){return p.map(w,function(E){var R=C.inEdges(E);if(R.length){var d=p.reduce(R,function(f,v){var g=C.edge(v),y=C.node(v.v);return{sum:f.sum+g.weight*y.order,weight:f.weight+g.weight}},{sum:0,weight:0});return{v:E,barycenter:d.sum/d.weight,weight:d.weight}}return{v:E}})}},1686:(D,T,h)=>{var p=h(5760),I=h(6456).Graph;D.exports=function C(E,R,d){var f=function w(E){for(var R;E.hasNode(R=p.uniqueId("_root")););return R}(E),v=new I({compound:!0}).setGraph({root:f}).setDefaultNodeLabel(function(g){return E.node(g)});return p.forEach(E.nodes(),function(g){var y=E.node(g),m=E.parent(g);(y.rank===R||y.minRank<=R&&R<=y.maxRank)&&(v.setNode(g),v.setParent(g,m||f),p.forEach(E[d](g),function(O){var P=O.v===g?O.w:O.v,N=v.edge(P,g),M=p.isUndefined(N)?0:N.weight;v.setEdge(P,g,{weight:E.edge(O).weight+M})}),p.has(y,"minRank")&&v.setNode(g,{borderLeft:y.borderLeft[R],borderRight:y.borderRight[R]}))}),v}},8796:(D,T,h)=>{"use strict";var p=h(5760);function C(w,E,R){for(var d=p.zipObject(R,p.map(R,function(O,P){return P})),f=p.flatten(p.map(E,function(O){return p.sortBy(p.map(w.outEdges(O),function(P){return{pos:d[P.w],weight:w.edge(P).weight}}),"pos")}),!0),v=1;v<R.length;)v<<=1;var g=2*v-1;v-=1;var y=p.map(new Array(g),function(){return 0}),m=0;return p.forEach(f.forEach(function(O){var P=O.pos+v;y[P]+=O.weight;for(var N=0;P>0;)P%2&&(N+=y[P+1]),y[P=P-1>>1]+=O.weight;m+=O.weight*N})),m}D.exports=function I(w,E){for(var R=0,d=1;d<E.length;++d)R+=C(w,E[d-1],E[d]);return R}},2974:(D,T,h)=>{"use strict";var p=h(5760),I=h(9402),C=h(8796),w=h(1057),E=h(1686),R=h(3034),d=h(6456).Graph,f=h(1510);function g(O,P,N){return p.map(P,function(M){return E(O,M,N)})}function y(O,P){var N=new d;p.forEach(O,function(M){var B=M.graph().root,Y=w(M,B,N,P);p.forEach(Y.vs,function(_,K){M.node(_).order=K}),R(M,N,Y.vs)})}function m(O,P){p.forEach(P,function(N){p.forEach(N,function(M,B){O.node(M).order=B})})}D.exports=function v(O){var P=f.maxRank(O),N=g(O,p.range(1,P+1),"inEdges"),M=g(O,p.range(P-1,-1,-1),"outEdges"),B=I(O);m(O,B);for(var _,Y=Number.POSITIVE_INFINITY,K=0,Q=0;Q<4;++K,++Q){y(K%2?N:M,K%4>=2),B=f.buildLayerMatrix(O);var ne=C(O,B);ne<Y&&(Q=0,_=p.cloneDeep(B),Y=ne)}m(O,_)}},9402:(D,T,h)=>{"use strict";var p=h(5760);D.exports=function I(C){var w={},E=p.filter(C.nodes(),function(g){return!C.children(g).length}),R=p.max(p.map(E,function(g){return C.node(g).rank})),d=p.map(p.range(R+1),function(){return[]}),v=p.sortBy(E,function(g){return C.node(g).rank});return p.forEach(v,function f(g){if(!p.has(w,g)){w[g]=!0;var y=C.node(g);d[y.rank].push(g),p.forEach(C.successors(g),f)}}),d}},3826:(D,T,h)=>{"use strict";var p=h(5760);D.exports=function I(E,R){var d={};return p.forEach(E,function(v,g){var y=d[v.v]={indegree:0,in:[],out:[],vs:[v.v],i:g};p.isUndefined(v.barycenter)||(y.barycenter=v.barycenter,y.weight=v.weight)}),p.forEach(R.edges(),function(v){var g=d[v.v],y=d[v.w];!p.isUndefined(g)&&!p.isUndefined(y)&&(y.indegree++,g.out.push(d[v.w]))}),function C(E){var R=[];function d(g){return function(y){y.merged||(p.isUndefined(y.barycenter)||p.isUndefined(g.barycenter)||y.barycenter>=g.barycenter)&&function w(E,R){var d=0,f=0;E.weight&&(d+=E.barycenter*E.weight,f+=E.weight),R.weight&&(d+=R.barycenter*R.weight,f+=R.weight),E.vs=R.vs.concat(E.vs),E.barycenter=d/f,E.weight=f,E.i=Math.min(R.i,E.i),R.merged=!0}(g,y)}}function f(g){return function(y){y.in.push(g),0==--y.indegree&&E.push(y)}}for(;E.length;){var v=E.pop();R.push(v),p.forEach(v.in.reverse(),d(v)),p.forEach(v.out,f(v))}return p.map(p.filter(R,function(g){return!g.merged}),function(g){return p.pick(g,["vs","i","barycenter","weight"])})}(p.filter(d,function(v){return!v.indegree}))}},1057:(D,T,h)=>{var p=h(5760),I=h(1323),C=h(3826),w=h(3803);D.exports=function E(f,v,g,y){var m=f.children(v),O=f.node(v),P=O?O.borderLeft:void 0,N=O?O.borderRight:void 0,M={};P&&(m=p.filter(m,function(ne){return ne!==P&&ne!==N}));var B=I(f,m);p.forEach(B,function(ne){if(f.children(ne.v).length){var X=E(f,ne.v,g,y);M[ne.v]=X,p.has(X,"barycenter")&&function d(f,v){p.isUndefined(f.barycenter)?(f.barycenter=v.barycenter,f.weight=v.weight):(f.barycenter=(f.barycenter*f.weight+v.barycenter*v.weight)/(f.weight+v.weight),f.weight+=v.weight)}(ne,X)}});var Y=C(B,g);!function R(f,v){p.forEach(f,function(g){g.vs=p.flatten(g.vs.map(function(y){return v[y]?v[y].vs:y}),!0)})}(Y,M);var _=w(Y,y);if(P&&(_.vs=p.flatten([P,_.vs,N],!0),f.predecessors(P).length)){var K=f.node(f.predecessors(P)[0]),Q=f.node(f.predecessors(N)[0]);p.has(_,"barycenter")||(_.barycenter=0,_.weight=0),_.barycenter=(_.barycenter*_.weight+K.order+Q.order)/(_.weight+2),_.weight+=2}return _}},3803:(D,T,h)=>{var p=h(5760),I=h(1510);function w(R,d,f){for(var v;d.length&&(v=p.last(d)).i<=f;)d.pop(),R.push(v.vs),f++;return f}D.exports=function C(R,d){var f=I.partition(R,function(M){return p.has(M,"barycenter")}),v=f.lhs,g=p.sortBy(f.rhs,function(M){return-M.i}),y=[],m=0,O=0,P=0;v.sort(function E(R){return function(d,f){return d.barycenter<f.barycenter?-1:d.barycenter>f.barycenter?1:R?f.i-d.i:d.i-f.i}}(!!d)),P=w(y,g,P),p.forEach(v,function(M){P+=M.vs.length,y.push(M.vs),m+=M.barycenter*M.weight,O+=M.weight,P=w(y,g,P)});var N={vs:p.flatten(y,!0)};return O&&(N.barycenter=m/O,N.weight=O),N}},162:(D,T,h)=>{var p=h(5760);D.exports=function I(E){var R=function w(E){var R={},d=0;return p.forEach(E.children(),function f(v){var g=d;p.forEach(E.children(v),f),R[v]={low:g,lim:d++}}),R}(E);p.forEach(E.graph().dummyChains,function(d){for(var f=E.node(d),v=f.edgeObj,g=function C(E,R,d,f){var O,P,v=[],g=[],y=Math.min(R[d].low,R[f].low),m=Math.max(R[d].lim,R[f].lim);O=d;do{O=E.parent(O),v.push(O)}while(O&&(R[O].low>y||m>R[O].lim));for(P=O,O=f;(O=E.parent(O))!==P;)g.push(O);return{path:v.concat(g.reverse()),lca:P}}(E,R,v.v,v.w),y=g.path,m=g.lca,O=0,P=y[O],N=!0;d!==v.w;){if(f=E.node(d),N){for(;(P=y[O])!==m&&E.node(P).maxRank<f.rank;)O++;P===m&&(N=!1)}if(!N){for(;O<y.length-1&&E.node(P=y[O+1]).minRank<=f.rank;)O++;P=y[O]}E.setParent(d,P),d=E.successors(d)[0]}})}},4058:(D,T,h)=>{"use strict";var p=h(5760),I=h(6456).Graph,C=h(1510);function w(Y,_){var K={};return p.reduce(_,function Q(ne,X){var re=0,U=0,W=ne.length,k=p.last(X);return p.forEach(X,function(V,H){var $=function R(Y,_){if(Y.node(_).dummy)return p.find(Y.predecessors(_),function(K){return Y.node(K).dummy})}(Y,V),se=$?Y.node($).order:W;($||V===k)&&(p.forEach(X.slice(U,H+1),function(j){p.forEach(Y.predecessors(j),function(z){var le=Y.node(z),fe=le.order;(fe<re||se<fe)&&(!le.dummy||!Y.node(j).dummy)&&d(K,z,j)})}),U=H+1,re=se)}),X}),K}function E(Y,_){var K={};function Q(X,re,U,W,k){var V;p.forEach(p.range(re,U),function(H){Y.node(V=X[H]).dummy&&p.forEach(Y.predecessors(V),function($){var se=Y.node($);se.dummy&&(se.order<W||se.order>k)&&d(K,$,V)})})}return p.reduce(_,function ne(X,re){var W,U=-1,k=0;return p.forEach(re,function(V,H){if("border"===Y.node(V).dummy){var $=Y.predecessors(V);$.length&&(W=Y.node($[0]).order,Q(re,k,H,U,W),k=H,U=W)}Q(re,k,re.length,W,X.length)}),re}),K}function d(Y,_,K){if(_>K){var Q=_;_=K,K=Q}var ne=Y[_];ne||(Y[_]=ne={}),ne[K]=!0}function f(Y,_,K){if(_>K){var Q=_;_=K,K=Q}return p.has(Y[_],K)}function v(Y,_,K,Q){var ne={},X={},re={};return p.forEach(_,function(U){p.forEach(U,function(W,k){ne[W]=W,X[W]=W,re[W]=k})}),p.forEach(_,function(U){var W=-1;p.forEach(U,function(k){var V=Q(k);if(V.length)for(var H=((V=p.sortBy(V,function(z){return re[z]})).length-1)/2,$=Math.floor(H),se=Math.ceil(H);$<=se;++$){var j=V[$];X[k]===k&&W<re[j]&&!f(K,k,j)&&(X[j]=k,X[k]=ne[k]=ne[j],W=re[j])}})}),{root:ne,align:X}}function g(Y,_,K,Q,ne){var X={},re=function y(Y,_,K,Q){var ne=new I,X=Y.graph(),re=function M(Y,_,K){return function(Q,ne,X){var k,re=Q.node(ne),U=Q.node(X),W=0;if(W+=re.width/2,p.has(re,"labelpos"))switch(re.labelpos.toLowerCase()){case"l":k=-re.width/2;break;case"r":k=re.width/2}if(k&&(W+=K?k:-k),k=0,W+=(re.dummy?_:Y)/2,W+=(U.dummy?_:Y)/2,W+=U.width/2,p.has(U,"labelpos"))switch(U.labelpos.toLowerCase()){case"l":k=U.width/2;break;case"r":k=-U.width/2}return k&&(W+=K?k:-k),k=0,W}}(X.nodesep,X.edgesep,Q);return p.forEach(_,function(U){var W;p.forEach(U,function(k){var V=K[k];if(ne.setNode(V),W){var H=K[W],$=ne.edge(H,V);ne.setEdge(H,V,Math.max(re(Y,k,W),$||0))}W=k})}),ne}(Y,_,K,ne),U=ne?"borderLeft":"borderRight";function W(H,$){for(var se=re.nodes(),j=se.pop(),z={};j;)z[j]?H(j):(z[j]=!0,se.push(j),se=se.concat($(j))),j=se.pop()}return W(function k(H){X[H]=re.inEdges(H).reduce(function($,se){return Math.max($,X[se.v]+re.edge(se))},0)},re.predecessors.bind(re)),W(function V(H){var $=re.outEdges(H).reduce(function(j,z){return Math.min(j,X[z.w]-re.edge(z))},Number.POSITIVE_INFINITY),se=Y.node(H);$!==Number.POSITIVE_INFINITY&&se.borderType!==U&&(X[H]=Math.max(X[H],$))},re.successors.bind(re)),p.forEach(Q,function(H){X[H]=X[K[H]]}),X}function m(Y,_){return p.minBy(p.values(_),function(K){var Q=Number.NEGATIVE_INFINITY,ne=Number.POSITIVE_INFINITY;return p.forIn(K,function(X,re){var U=function B(Y,_){return Y.node(_).width}(Y,re)/2;Q=Math.max(X+U,Q),ne=Math.min(X-U,ne)}),Q-ne})}function O(Y,_){var K=p.values(_),Q=p.min(K),ne=p.max(K);p.forEach(["u","d"],function(X){p.forEach(["l","r"],function(re){var k,U=X+re,W=Y[U];if(W!==_){var V=p.values(W);(k="l"===re?Q-p.min(V):ne-p.max(V))&&(Y[U]=p.mapValues(W,function(H){return H+k}))}})})}function P(Y,_){return p.mapValues(Y.ul,function(K,Q){if(_)return Y[_.toLowerCase()][Q];var ne=p.sortBy(p.map(Y,Q));return(ne[1]+ne[2])/2})}D.exports={positionX:function N(Y){var ne,_=C.buildLayerMatrix(Y),K=p.merge(w(Y,_),E(Y,_)),Q={};p.forEach(["u","d"],function(re){ne="u"===re?_:p.values(_).reverse(),p.forEach(["l","r"],function(U){"r"===U&&(ne=p.map(ne,function(H){return p.values(H).reverse()}));var W=("u"===re?Y.predecessors:Y.successors).bind(Y),k=v(0,ne,K,W),V=g(Y,ne,k.root,k.align,"r"===U);"r"===U&&(V=p.mapValues(V,function(H){return-H})),Q[re+U]=V})});var X=m(Y,Q);return O(Q,X),P(Q,Y.graph().align)},findType1Conflicts:w,findType2Conflicts:E,addConflict:d,hasConflict:f,verticalAlignment:v,horizontalCompaction:g,alignCoordinates:O,findSmallestWidthAlignment:m,balance:P}},8226:(D,T,h)=>{"use strict";var p=h(5760),I=h(1510),C=h(4058).positionX;D.exports=function w(R){(function E(R){var d=I.buildLayerMatrix(R),f=R.graph().ranksep,v=0;p.forEach(d,function(g){var y=p.max(p.map(g,function(m){return R.node(m).height}));p.forEach(g,function(m){R.node(m).y=v+y/2}),v+=y+f})})(R=I.asNonCompoundGraph(R)),p.forEach(C(R),function(d,f){R.node(f).x=d})}},6632:(D,T,h)=>{"use strict";var p=h(5760),I=h(6456).Graph,C=h(1916).slack;function E(f,v){return p.forEach(f.nodes(),function g(y){p.forEach(v.nodeEdges(y),function(m){var O=m.v,P=y===O?m.w:O;!f.hasNode(P)&&!C(v,m)&&(f.setNode(P,{}),f.setEdge(y,P,{}),g(P))})}),f.nodeCount()}function R(f,v){return p.minBy(v.edges(),function(g){if(f.hasNode(g.v)!==f.hasNode(g.w))return C(v,g)})}function d(f,v,g){p.forEach(f.nodes(),function(y){v.node(y).rank+=g})}D.exports=function w(f){var m,O,v=new I({directed:!1}),g=f.nodes()[0],y=f.nodeCount();for(v.setNode(g,{});E(v,f)<y;)m=R(v,f),O=v.hasNode(m.v)?C(f,m):-C(f,m),d(v,f,O);return v}},4124:(D,T,h)=>{"use strict";var I=h(1916).longestPath,C=h(6632),w=h(3804);D.exports=function E(v){switch(v.graph().ranker){case"network-simplex":default:!function f(v){w(v)}(v);break;case"tight-tree":!function d(v){I(v),C(v)}(v);break;case"longest-path":R(v)}};var R=I},3804:(D,T,h)=>{"use strict";var p=h(5760),I=h(6632),C=h(1916).slack,w=h(1916).longestPath,E=h(6456).alg.preorder,R=h(6456).alg.postorder,d=h(1510).simplify;function f(K){K=d(K),w(K);var ne,Q=I(K);for(m(Q),v(Q,K);ne=P(Q);)M(Q,K,ne,N(Q,K,ne))}function v(K,Q){var ne=R(K,K.nodes());ne=ne.slice(0,ne.length-1),p.forEach(ne,function(X){!function g(K,Q,ne){var X=K.node(ne);K.edge(ne,X.parent).cutvalue=y(K,Q,ne)}(K,Q,X)})}function y(K,Q,ne){var re=K.node(ne).parent,U=!0,W=Q.edge(ne,re),k=0;return W||(U=!1,W=Q.edge(re,ne)),k=W.weight,p.forEach(Q.nodeEdges(ne),function(V){var H=V.v===ne,$=H?V.w:V.v;if($!==re){var se=H===U,j=Q.edge(V).weight;if(k+=se?j:-j,function Y(K,Q,ne){return K.hasEdge(Q,ne)}(K,ne,$)){var z=K.edge(ne,$).cutvalue;k+=se?-z:z}}}),k}function m(K,Q){arguments.length<2&&(Q=K.nodes()[0]),O(K,{},1,Q)}function O(K,Q,ne,X,re){var U=ne,W=K.node(X);return Q[X]=!0,p.forEach(K.neighbors(X),function(k){p.has(Q,k)||(ne=O(K,Q,ne,k,X))}),W.low=U,W.lim=ne++,re?W.parent=re:delete W.parent,ne}function P(K){return p.find(K.edges(),function(Q){return K.edge(Q).cutvalue<0})}function N(K,Q,ne){var X=ne.v,re=ne.w;Q.hasEdge(X,re)||(X=ne.w,re=ne.v);var U=K.node(X),W=K.node(re),k=U,V=!1;U.lim>W.lim&&(k=W,V=!0);var H=p.filter(Q.edges(),function($){return V===_(0,K.node($.v),k)&&V!==_(0,K.node($.w),k)});return p.minBy(H,function($){return C(Q,$)})}function M(K,Q,ne,X){K.removeEdge(ne.v,ne.w),K.setEdge(X.v,X.w,{}),m(K),v(K,Q),function B(K,Q){var ne=p.find(K.nodes(),function(re){return!Q.node(re).parent}),X=E(K,ne);X=X.slice(1),p.forEach(X,function(re){var U=K.node(re).parent,W=Q.edge(re,U),k=!1;W||(W=Q.edge(U,re),k=!0),Q.node(re).rank=Q.node(U).rank+(k?W.minlen:-W.minlen)})}(K,Q)}function _(K,Q,ne){return ne.low<=Q.lim&&Q.lim<=ne.lim}D.exports=f,f.initLowLimValues=m,f.initCutValues=v,f.calcCutValue=y,f.leaveEdge=P,f.enterEdge=N,f.exchangeEdges=M},1916:(D,T,h)=>{"use strict";var p=h(5760);D.exports={longestPath:function I(w){var E={};p.forEach(w.sources(),function R(d){var f=w.node(d);if(p.has(E,d))return f.rank;E[d]=!0;var v=p.min(p.map(w.outEdges(d),function(g){return R(g.w)-w.edge(g).minlen}));return(v===Number.POSITIVE_INFINITY||null==v)&&(v=0),f.rank=v})},slack:function C(w,E){return w.node(E.w).rank-w.node(E.v).rank-w.edge(E).minlen}}},1510:(D,T,h)=>{"use strict";var p=h(5760),I=h(6456).Graph;function C(B,Y,_,K){var Q;do{Q=p.uniqueId(K)}while(B.hasNode(Q));return _.dummy=Y,B.setNode(Q,_),Q}function O(B){return p.max(p.map(B.nodes(),function(Y){var _=B.node(Y).rank;if(!p.isUndefined(_))return _}))}D.exports={addDummyNode:C,simplify:function w(B){var Y=(new I).setGraph(B.graph());return p.forEach(B.nodes(),function(_){Y.setNode(_,B.node(_))}),p.forEach(B.edges(),function(_){var K=Y.edge(_.v,_.w)||{weight:0,minlen:1},Q=B.edge(_);Y.setEdge(_.v,_.w,{weight:K.weight+Q.weight,minlen:Math.max(K.minlen,Q.minlen)})}),Y},asNonCompoundGraph:function E(B){var Y=new I({multigraph:B.isMultigraph()}).setGraph(B.graph());return p.forEach(B.nodes(),function(_){B.children(_).length||Y.setNode(_,B.node(_))}),p.forEach(B.edges(),function(_){Y.setEdge(_,B.edge(_))}),Y},successorWeights:function R(B){var Y=p.map(B.nodes(),function(_){var K={};return p.forEach(B.outEdges(_),function(Q){K[Q.w]=(K[Q.w]||0)+B.edge(Q).weight}),K});return p.zipObject(B.nodes(),Y)},predecessorWeights:function d(B){var Y=p.map(B.nodes(),function(_){var K={};return p.forEach(B.inEdges(_),function(Q){K[Q.v]=(K[Q.v]||0)+B.edge(Q).weight}),K});return p.zipObject(B.nodes(),Y)},intersectRect:function f(B,Y){var U,W,_=B.x,K=B.y,Q=Y.x-_,ne=Y.y-K,X=B.width/2,re=B.height/2;if(!Q&&!ne)throw new Error("Not possible to find intersection inside of the rectangle");return Math.abs(ne)*X>Math.abs(Q)*re?(ne<0&&(re=-re),U=re*Q/ne,W=re):(Q<0&&(X=-X),U=X,W=X*ne/Q),{x:_+U,y:K+W}},buildLayerMatrix:function v(B){var Y=p.map(p.range(O(B)+1),function(){return[]});return p.forEach(B.nodes(),function(_){var K=B.node(_),Q=K.rank;p.isUndefined(Q)||(Y[Q][K.order]=_)}),Y},normalizeRanks:function g(B){var Y=p.min(p.map(B.nodes(),function(_){return B.node(_).rank}));p.forEach(B.nodes(),function(_){var K=B.node(_);p.has(K,"rank")&&(K.rank-=Y)})},removeEmptyRanks:function y(B){var Y=p.min(p.map(B.nodes(),function(ne){return B.node(ne).rank})),_=[];p.forEach(B.nodes(),function(ne){var X=B.node(ne).rank-Y;_[X]||(_[X]=[]),_[X].push(ne)});var K=0,Q=B.graph().nodeRankFactor;p.forEach(_,function(ne,X){p.isUndefined(ne)&&X%Q!=0?--K:K&&p.forEach(ne,function(re){B.node(re).rank+=K})})},addBorderNode:function m(B,Y,_,K){var Q={width:0,height:0};return arguments.length>=4&&(Q.rank=_,Q.order=K),C(B,"border",Q,Y)},maxRank:O,partition:function P(B,Y){var _={lhs:[],rhs:[]};return p.forEach(B,function(K){Y(K)?_.lhs.push(K):_.rhs.push(K)}),_},time:function N(B,Y){var _=p.now();try{return Y()}finally{console.log(B+" time: "+(p.now()-_)+"ms")}},notime:function M(B,Y){return Y()}}},8126:D=>{D.exports="0.8.5"},5510:(D,T,h)=>{var p=h(1838);D.exports={Graph:p.Graph,json:h(1088),alg:h(3430),version:p.version}},6730:(D,T,h)=>{var p=h(9138);D.exports=function I(C){var R,w={},E=[];function d(f){p.has(w,f)||(w[f]=!0,R.push(f),p.each(C.successors(f),d),p.each(C.predecessors(f),d))}return p.each(C.nodes(),function(f){R=[],d(f),R.length&&E.push(R)}),E}},2163:(D,T,h)=>{var p=h(9138);function C(w,E,R,d,f,v){p.has(d,E)||(d[E]=!0,R||v.push(E),p.each(f(E),function(g){C(w,g,R,d,f,v)}),R&&v.push(E))}D.exports=function I(w,E,R){p.isArray(E)||(E=[E]);var d=(w.isDirected()?w.successors:w.neighbors).bind(w),f=[],v={};return p.each(E,function(g){if(!w.hasNode(g))throw new Error("Graph does not have node: "+g);C(w,g,"post"===R,v,d,f)}),f}},5668:(D,T,h)=>{var p=h(1718),I=h(9138);D.exports=function C(w,E,R){return I.transform(w.nodes(),function(d,f){d[f]=p(w,f,E,R)},{})}},1718:(D,T,h)=>{var p=h(9138),I=h(1919);D.exports=function w(R,d,f,v){return function E(R,d,f,v){var m,O,g={},y=new I,P=function(N){var M=N.v!==m?N.v:N.w,B=g[M],Y=f(N),_=O.distance+Y;if(Y<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+N+" Weight: "+Y);_<B.distance&&(B.distance=_,B.predecessor=m,y.decrease(M,_))};for(R.nodes().forEach(function(N){var M=N===d?0:Number.POSITIVE_INFINITY;g[N]={distance:M},y.add(N,M)});y.size()>0&&(m=y.removeMin(),(O=g[m]).distance!==Number.POSITIVE_INFINITY);)v(m).forEach(P);return g}(R,String(d),f||C,v||function(g){return R.outEdges(g)})};var C=p.constant(1)},9611:(D,T,h)=>{var p=h(9138),I=h(3585);D.exports=function C(w){return p.filter(I(w),function(E){return E.length>1||1===E.length&&w.hasEdge(E[0],E[0])})}},2881:(D,T,h)=>{var p=h(9138);D.exports=function C(E,R,d){return function w(E,R,d){var f={},v=E.nodes();return v.forEach(function(g){f[g]={},f[g][g]={distance:0},v.forEach(function(y){g!==y&&(f[g][y]={distance:Number.POSITIVE_INFINITY})}),d(g).forEach(function(y){var m=y.v===g?y.w:y.v,O=R(y);f[g][m]={distance:O,predecessor:g}})}),v.forEach(function(g){var y=f[g];v.forEach(function(m){var O=f[m];v.forEach(function(P){var M=y[P],B=O[P],Y=O[g].distance+M.distance;Y<B.distance&&(B.distance=Y,B.predecessor=M.predecessor)})})}),f}(E,R||I,d||function(f){return E.outEdges(f)})};var I=p.constant(1)},3430:(D,T,h)=>{D.exports={components:h(6730),dijkstra:h(1718),dijkstraAll:h(5668),findCycles:h(9611),floydWarshall:h(2881),isAcyclic:h(6693),postorder:h(6694),preorder:h(5330),prim:h(6823),tarjan:h(3585),topsort:h(2180)}},6693:(D,T,h)=>{var p=h(2180);D.exports=function I(C){try{p(C)}catch(w){if(w instanceof p.CycleException)return!1;throw w}return!0}},6694:(D,T,h)=>{var p=h(2163);D.exports=function I(C,w){return p(C,w,"post")}},5330:(D,T,h)=>{var p=h(2163);D.exports=function I(C,w){return p(C,w,"pre")}},6823:(D,T,h)=>{var p=h(9138),I=h(6568),C=h(1919);D.exports=function w(E,R){var g,d=new I,f={},v=new C;function y(O){var P=O.v===g?O.w:O.v,N=v.priority(P);if(void 0!==N){var M=R(O);M<N&&(f[P]=g,v.decrease(P,M))}}if(0===E.nodeCount())return d;p.each(E.nodes(),function(O){v.add(O,Number.POSITIVE_INFINITY),d.setNode(O)}),v.decrease(E.nodes()[0],0);for(var m=!1;v.size()>0;){if(g=v.removeMin(),p.has(f,g))d.setEdge(g,f[g]);else{if(m)throw new Error("Input graph is not connected: "+E);m=!0}E.nodeEdges(g).forEach(y)}return d}},3585:(D,T,h)=>{var p=h(9138);D.exports=function I(C){var w=0,E=[],R={},d=[];function f(v){var g=R[v]={onStack:!0,lowlink:w,index:w++};if(E.push(v),C.successors(v).forEach(function(O){p.has(R,O)?R[O].onStack&&(g.lowlink=Math.min(g.lowlink,R[O].index)):(f(O),g.lowlink=Math.min(g.lowlink,R[O].lowlink))}),g.lowlink===g.index){var m,y=[];do{m=E.pop(),R[m].onStack=!1,y.push(m)}while(v!==m);d.push(y)}}return C.nodes().forEach(function(v){p.has(R,v)||f(v)}),d}},2180:(D,T,h)=>{var p=h(9138);function I(w){var E={},R={},d=[];if(p.each(w.sinks(),function f(v){if(p.has(R,v))throw new C;p.has(E,v)||(R[v]=!0,E[v]=!0,p.each(w.predecessors(v),f),delete R[v],d.push(v))}),p.size(E)!==w.nodeCount())throw new C;return d}function C(){}D.exports=I,I.CycleException=C,C.prototype=new Error},1919:(D,T,h)=>{var p=h(9138);function I(){this._arr=[],this._keyIndices={}}D.exports=I,I.prototype.size=function(){return this._arr.length},I.prototype.keys=function(){return this._arr.map(function(C){return C.key})},I.prototype.has=function(C){return p.has(this._keyIndices,C)},I.prototype.priority=function(C){var w=this._keyIndices[C];if(void 0!==w)return this._arr[w].priority},I.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},I.prototype.add=function(C,w){var E=this._keyIndices;if(C=String(C),!p.has(E,C)){var R=this._arr,d=R.length;return E[C]=d,R.push({key:C,priority:w}),this._decrease(d),!0}return!1},I.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var C=this._arr.pop();return delete this._keyIndices[C.key],this._heapify(0),C.key},I.prototype.decrease=function(C,w){var E=this._keyIndices[C];if(w>this._arr[E].priority)throw new Error("New priority is greater than current priority. Key: "+C+" Old: "+this._arr[E].priority+" New: "+w);this._arr[E].priority=w,this._decrease(E)},I.prototype._heapify=function(C){var w=this._arr,E=2*C,R=E+1,d=C;E<w.length&&(d=w[E].priority<w[d].priority?E:d,R<w.length&&(d=w[R].priority<w[d].priority?R:d),d!==C&&(this._swap(C,d),this._heapify(d)))},I.prototype._decrease=function(C){for(var R,w=this._arr,E=w[C].priority;0!==C&&!(w[R=C>>1].priority<E);)this._swap(C,R),C=R},I.prototype._swap=function(C,w){var E=this._arr,R=this._keyIndices,d=E[C],f=E[w];E[C]=f,E[w]=d,R[f.key]=C,R[d.key]=w}},6568:(D,T,h)=>{"use strict";var p=h(9138);D.exports=E;var C="\0";function E(y){this._isDirected=!p.has(y,"directed")||y.directed,this._isMultigraph=!!p.has(y,"multigraph")&&y.multigraph,this._isCompound=!!p.has(y,"compound")&&y.compound,this._label=void 0,this._defaultNodeLabelFn=p.constant(void 0),this._defaultEdgeLabelFn=p.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[C]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function R(y,m){y[m]?y[m]++:y[m]=1}function d(y,m){--y[m]||delete y[m]}function f(y,m,O,P){var N=""+m,M=""+O;if(!y&&N>M){var B=N;N=M,M=B}return N+"\x01"+M+"\x01"+(p.isUndefined(P)?"\0":P)}function v(y,m,O,P){var N=""+m,M=""+O;if(!y&&N>M){var B=N;N=M,M=B}var Y={v:N,w:M};return P&&(Y.name=P),Y}function g(y,m){return f(y,m.v,m.w,m.name)}E.prototype._nodeCount=0,E.prototype._edgeCount=0,E.prototype.isDirected=function(){return this._isDirected},E.prototype.isMultigraph=function(){return this._isMultigraph},E.prototype.isCompound=function(){return this._isCompound},E.prototype.setGraph=function(y){return this._label=y,this},E.prototype.graph=function(){return this._label},E.prototype.setDefaultNodeLabel=function(y){return p.isFunction(y)||(y=p.constant(y)),this._defaultNodeLabelFn=y,this},E.prototype.nodeCount=function(){return this._nodeCount},E.prototype.nodes=function(){return p.keys(this._nodes)},E.prototype.sources=function(){var y=this;return p.filter(this.nodes(),function(m){return p.isEmpty(y._in[m])})},E.prototype.sinks=function(){var y=this;return p.filter(this.nodes(),function(m){return p.isEmpty(y._out[m])})},E.prototype.setNodes=function(y,m){var O=arguments,P=this;return p.each(y,function(N){O.length>1?P.setNode(N,m):P.setNode(N)}),this},E.prototype.setNode=function(y,m){return p.has(this._nodes,y)?(arguments.length>1&&(this._nodes[y]=m),this):(this._nodes[y]=arguments.length>1?m:this._defaultNodeLabelFn(y),this._isCompound&&(this._parent[y]=C,this._children[y]={},this._children[C][y]=!0),this._in[y]={},this._preds[y]={},this._out[y]={},this._sucs[y]={},++this._nodeCount,this)},E.prototype.node=function(y){return this._nodes[y]},E.prototype.hasNode=function(y){return p.has(this._nodes,y)},E.prototype.removeNode=function(y){var m=this;if(p.has(this._nodes,y)){var O=function(P){m.removeEdge(m._edgeObjs[P])};delete this._nodes[y],this._isCompound&&(this._removeFromParentsChildList(y),delete this._parent[y],p.each(this.children(y),function(P){m.setParent(P)}),delete this._children[y]),p.each(p.keys(this._in[y]),O),delete this._in[y],delete this._preds[y],p.each(p.keys(this._out[y]),O),delete this._out[y],delete this._sucs[y],--this._nodeCount}return this},E.prototype.setParent=function(y,m){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(p.isUndefined(m))m=C;else{for(var O=m+="";!p.isUndefined(O);O=this.parent(O))if(O===y)throw new Error("Setting "+m+" as parent of "+y+" would create a cycle");this.setNode(m)}return this.setNode(y),this._removeFromParentsChildList(y),this._parent[y]=m,this._children[m][y]=!0,this},E.prototype._removeFromParentsChildList=function(y){delete this._children[this._parent[y]][y]},E.prototype.parent=function(y){if(this._isCompound){var m=this._parent[y];if(m!==C)return m}},E.prototype.children=function(y){if(p.isUndefined(y)&&(y=C),this._isCompound){var m=this._children[y];if(m)return p.keys(m)}else{if(y===C)return this.nodes();if(this.hasNode(y))return[]}},E.prototype.predecessors=function(y){var m=this._preds[y];if(m)return p.keys(m)},E.prototype.successors=function(y){var m=this._sucs[y];if(m)return p.keys(m)},E.prototype.neighbors=function(y){var m=this.predecessors(y);if(m)return p.union(m,this.successors(y))},E.prototype.isLeaf=function(y){return 0===(this.isDirected()?this.successors(y):this.neighbors(y)).length},E.prototype.filterNodes=function(y){var m=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});m.setGraph(this.graph());var O=this;p.each(this._nodes,function(M,B){y(B)&&m.setNode(B,M)}),p.each(this._edgeObjs,function(M){m.hasNode(M.v)&&m.hasNode(M.w)&&m.setEdge(M,O.edge(M))});var P={};function N(M){var B=O.parent(M);return void 0===B||m.hasNode(B)?(P[M]=B,B):B in P?P[B]:N(B)}return this._isCompound&&p.each(m.nodes(),function(M){m.setParent(M,N(M))}),m},E.prototype.setDefaultEdgeLabel=function(y){return p.isFunction(y)||(y=p.constant(y)),this._defaultEdgeLabelFn=y,this},E.prototype.edgeCount=function(){return this._edgeCount},E.prototype.edges=function(){return p.values(this._edgeObjs)},E.prototype.setPath=function(y,m){var O=this,P=arguments;return p.reduce(y,function(N,M){return P.length>1?O.setEdge(N,M,m):O.setEdge(N,M),M}),this},E.prototype.setEdge=function(){var y,m,O,P,N=!1,M=arguments[0];"object"==typeof M&&null!==M&&"v"in M?(y=M.v,m=M.w,O=M.name,2===arguments.length&&(P=arguments[1],N=!0)):(y=M,m=arguments[1],O=arguments[3],arguments.length>2&&(P=arguments[2],N=!0)),y=""+y,m=""+m,p.isUndefined(O)||(O=""+O);var B=f(this._isDirected,y,m,O);if(p.has(this._edgeLabels,B))return N&&(this._edgeLabels[B]=P),this;if(!p.isUndefined(O)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(y),this.setNode(m),this._edgeLabels[B]=N?P:this._defaultEdgeLabelFn(y,m,O);var Y=v(this._isDirected,y,m,O);return y=Y.v,m=Y.w,Object.freeze(Y),this._edgeObjs[B]=Y,R(this._preds[m],y),R(this._sucs[y],m),this._in[m][B]=Y,this._out[y][B]=Y,this._edgeCount++,this},E.prototype.edge=function(y,m,O){var P=1===arguments.length?g(this._isDirected,arguments[0]):f(this._isDirected,y,m,O);return this._edgeLabels[P]},E.prototype.hasEdge=function(y,m,O){var P=1===arguments.length?g(this._isDirected,arguments[0]):f(this._isDirected,y,m,O);return p.has(this._edgeLabels,P)},E.prototype.removeEdge=function(y,m,O){var P=1===arguments.length?g(this._isDirected,arguments[0]):f(this._isDirected,y,m,O),N=this._edgeObjs[P];return N&&(y=N.v,m=N.w,delete this._edgeLabels[P],delete this._edgeObjs[P],d(this._preds[m],y),d(this._sucs[y],m),delete this._in[m][P],delete this._out[y][P],this._edgeCount--),this},E.prototype.inEdges=function(y,m){var O=this._in[y];if(O){var P=p.values(O);return m?p.filter(P,function(N){return N.v===m}):P}},E.prototype.outEdges=function(y,m){var O=this._out[y];if(O){var P=p.values(O);return m?p.filter(P,function(N){return N.w===m}):P}},E.prototype.nodeEdges=function(y,m){var O=this.inEdges(y,m);if(O)return O.concat(this.outEdges(y,m))}},1838:(D,T,h)=>{D.exports={Graph:h(6568),version:h(5089)}},1088:(D,T,h)=>{var p=h(9138),I=h(6568);function w(d){return p.map(d.nodes(),function(f){var v=d.node(f),g=d.parent(f),y={v:f};return p.isUndefined(v)||(y.value=v),p.isUndefined(g)||(y.parent=g),y})}function E(d){return p.map(d.edges(),function(f){var v=d.edge(f),g={v:f.v,w:f.w};return p.isUndefined(f.name)||(g.name=f.name),p.isUndefined(v)||(g.value=v),g})}D.exports={write:function C(d){var f={options:{directed:d.isDirected(),multigraph:d.isMultigraph(),compound:d.isCompound()},nodes:w(d),edges:E(d)};return p.isUndefined(d.graph())||(f.value=p.clone(d.graph())),f},read:function R(d){var f=new I(d.options).setGraph(d.value);return p.each(d.nodes,function(v){f.setNode(v.v,v.value),v.parent&&f.setParent(v.v,v.parent)}),p.each(d.edges,function(v){f.setEdge({v:v.v,w:v.w,name:v.name},v.value)}),f}}},9138:(D,T,h)=>{var p;try{p={clone:h(1094),constant:h(6684),each:h(5474),filter:h(5281),has:h(4842),isArray:h(1503),isEmpty:h(1973),isFunction:h(5946),isUndefined:h(4235),keys:h(118),map:h(9984),reduce:h(1337),size:h(5637),transform:h(9416),union:h(8921),values:h(377)}}catch(I){}p||(p=window._),D.exports=p},5089:D=>{D.exports="2.1.8"},2186:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});class h{constructor(...C){this._head=this._tail=null,this._length=0,C.length>0&&C.forEach(w=>{this.append(w)})}*iterator(){let C=this._head;for(;C;)yield C.value,C=C.next}[Symbol.iterator](){return this.iterator()}get head(){return this._head?this._head.value:null}get tail(){return this._tail?this._tail.value:null}get length(){return this._length}insert(C,w,E=!1){if(E&&this.isDuplicate(C))return!1;let R=new p(C),d=this._head;if(!d)return!1;for(;;){if(d.value===w)return R.next=d.next,R.prev=d,d.next=R,R.next?R.next.prev=R:this._tail=R,this._length++,!0;if(!d.next)return!1;d=d.next}}append(C,w=!1){if(w&&this.isDuplicate(C))return!1;let E=new p(C);return this._tail?(this._tail.next=E,E.prev=this._tail,this._tail=E):this._head=this._tail=E,this._length++,!0}prepend(C,w=!1){if(w&&this.isDuplicate(C))return!1;let E=new p(C);return this._head?(E.next=this._head,this._head.prev=E,this._head=E):this._head=this._tail=E,this._length++,!0}remove(C){let w=this._head;if(w){if(w.value===C)return this._head=w.next,this._head.prev=null,w.next=w.prev=null,this._length--,w.value;for(;;){if(w.value===C)return w.next?(w.prev.next=w.next,w.next.prev=w.prev,w.next=w.prev=null):(w.prev.next=null,this._tail=w.prev,w.next=w.prev=null),this._length--,w.value;if(!w.next)return;w=w.next}}}removeHead(){let C=this._head;if(C)return this._head.next?(this._head.next.prev=null,this._head=this._head.next,C.next=C.prev=null):(this._head=null,this._tail=null),this._length--,C.value}removeTail(){let C=this._tail;if(C)return this._tail.prev?(this._tail.prev.next=null,this._tail=this._tail.prev,C.next=C.prev=null):(this._head=null,this._tail=null),this._length--,C.value}first(C){let w=this.iterator(),E=[],R=Math.min(C,this.length);for(let d=0;d<R;d++){let f=w.next();E.push(f.value)}return E}toArray(){return[...this]}isDuplicate(C){return new Set(this.toArray()).has(C)}}T.LinkedList=h;class p{constructor(C){this.value=C,this.next=null,this.prev=null}}T.LinkedListItem=p},7244:(D,T,h)=>{var C=h(3436)(h(2119),"DataView");D.exports=C},4994:(D,T,h)=>{var p=h(4312),I=h(6421),C=h(5764),w=h(8685),E=h(6676);function R(d){var f=-1,v=null==d?0:d.length;for(this.clear();++f<v;){var g=d[f];this.set(g[0],g[1])}}R.prototype.clear=p,R.prototype.delete=I,R.prototype.get=C,R.prototype.has=w,R.prototype.set=E,D.exports=R},9215:(D,T,h)=>{var p=h(1840),I=h(4378),C=h(4981),w=h(7343),E=h(8895);function R(d){var f=-1,v=null==d?0:d.length;for(this.clear();++f<v;){var g=d[f];this.set(g[0],g[1])}}R.prototype.clear=p,R.prototype.delete=I,R.prototype.get=C,R.prototype.has=w,R.prototype.set=E,D.exports=R},1501:(D,T,h)=>{var C=h(3436)(h(2119),"Map");D.exports=C},9850:(D,T,h)=>{var p=h(638),I=h(1184),C=h(866),w=h(3771),E=h(1772);function R(d){var f=-1,v=null==d?0:d.length;for(this.clear();++f<v;){var g=d[f];this.set(g[0],g[1])}}R.prototype.clear=p,R.prototype.delete=I,R.prototype.get=C,R.prototype.has=w,R.prototype.set=E,D.exports=R},4267:(D,T,h)=>{var C=h(3436)(h(2119),"Promise");D.exports=C},6323:(D,T,h)=>{var C=h(3436)(h(2119),"Set");D.exports=C},8849:(D,T,h)=>{var p=h(9850),I=h(4600),C=h(1387);function w(E){var R=-1,d=null==E?0:E.length;for(this.__data__=new p;++R<d;)this.add(E[R])}w.prototype.add=w.prototype.push=I,w.prototype.has=C,D.exports=w},2858:(D,T,h)=>{var p=h(9215),I=h(3720),C=h(4410),w=h(5576),E=h(2247),R=h(1585);function d(f){var v=this.__data__=new p(f);this.size=v.size}d.prototype.clear=I,d.prototype.delete=C,d.prototype.get=w,d.prototype.has=E,d.prototype.set=R,D.exports=d},443:(D,T,h)=>{var p=h(2119);D.exports=p.Symbol},3457:(D,T,h)=>{var p=h(2119);D.exports=p.Uint8Array},4243:(D,T,h)=>{var C=h(3436)(h(2119),"WeakMap");D.exports=C},6999:D=>{D.exports=function T(h,p,I){switch(I.length){case 0:return h.call(p);case 1:return h.call(p,I[0]);case 2:return h.call(p,I[0],I[1]);case 3:return h.call(p,I[0],I[1],I[2])}return h.apply(p,I)}},6837:D=>{D.exports=function T(h,p){for(var I=-1,C=null==h?0:h.length;++I<C&&!1!==p(h[I],I,h););return h}},9779:D=>{D.exports=function T(h,p){for(var I=-1,C=null==h?0:h.length,w=0,E=[];++I<C;){var R=h[I];p(R,I,h)&&(E[w++]=R)}return E}},1253:(D,T,h)=>{var p=h(4164);D.exports=function I(C,w){return!(null==C||!C.length)&&p(C,w,0)>-1}},177:D=>{D.exports=function T(h,p,I){for(var C=-1,w=null==h?0:h.length;++C<w;)if(I(p,h[C]))return!0;return!1}},2271:(D,T,h)=>{var p=h(5334),I=h(7151),C=h(1503),w=h(891),E=h(8442),R=h(8159),f=Object.prototype.hasOwnProperty;D.exports=function v(g,y){var m=C(g),O=!m&&I(g),P=!m&&!O&&w(g),N=!m&&!O&&!P&&R(g),M=m||O||P||N,B=M?p(g.length,String):[],Y=B.length;for(var _ in g)(y||f.call(g,_))&&(!M||!("length"==_||P&&("offset"==_||"parent"==_)||N&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||E(_,Y)))&&B.push(_);return B}},4633:D=>{D.exports=function T(h,p){for(var I=-1,C=null==h?0:h.length,w=Array(C);++I<C;)w[I]=p(h[I],I,h);return w}},5059:D=>{D.exports=function T(h,p){for(var I=-1,C=p.length,w=h.length;++I<C;)h[w+I]=p[I];return h}},8745:D=>{D.exports=function T(h,p,I,C){var w=-1,E=null==h?0:h.length;for(C&&E&&(I=h[++w]);++w<E;)I=p(I,h[w],w,h);return I}},9503:D=>{D.exports=function T(h,p){for(var I=-1,C=null==h?0:h.length;++I<C;)if(p(h[I],I,h))return!0;return!1}},5481:(D,T,h)=>{var I=h(1847)("length");D.exports=I},9276:(D,T,h)=>{var p=h(5683),I=h(217);D.exports=function C(w,E,R){(void 0!==R&&!I(w[E],R)||void 0===R&&!(E in w))&&p(w,E,R)}},9719:(D,T,h)=>{var p=h(5683),I=h(217),w=Object.prototype.hasOwnProperty;D.exports=function E(R,d,f){var v=R[d];(!w.call(R,d)||!I(v,f)||void 0===f&&!(d in R))&&p(R,d,f)}},3503:(D,T,h)=>{var p=h(217);D.exports=function I(C,w){for(var E=C.length;E--;)if(p(C[E][0],w))return E;return-1}},4121:(D,T,h)=>{var p=h(1989),I=h(118);D.exports=function C(w,E){return w&&p(E,I(E),w)}},9287:(D,T,h)=>{var p=h(1989),I=h(6555);D.exports=function C(w,E){return w&&p(E,I(E),w)}},5683:(D,T,h)=>{var p=h(6713);D.exports=function I(C,w,E){"__proto__"==w&&p?p(C,w,{configurable:!0,enumerable:!0,value:E,writable:!0}):C[w]=E}},4462:(D,T,h)=>{var p=h(2858),I=h(6837),C=h(9719),w=h(4121),E=h(9287),R=h(9292),d=h(9454),f=h(4444),v=h(9905),g=h(7597),y=h(6967),m=h(8794),O=h(6782),P=h(7878),N=h(4264),M=h(1503),B=h(891),Y=h(3222),_=h(5940),K=h(799),Q=h(118),ne=h(6555),W="[object Arguments]",se="[object Function]",fe="[object Object]",ct={};ct[W]=ct["[object Array]"]=ct["[object ArrayBuffer]"]=ct["[object DataView]"]=ct["[object Boolean]"]=ct["[object Date]"]=ct["[object Float32Array]"]=ct["[object Float64Array]"]=ct["[object Int8Array]"]=ct["[object Int16Array]"]=ct["[object Int32Array]"]=ct["[object Map]"]=ct["[object Number]"]=ct[fe]=ct["[object RegExp]"]=ct["[object Set]"]=ct["[object String]"]=ct["[object Symbol]"]=ct["[object Uint8Array]"]=ct["[object Uint8ClampedArray]"]=ct["[object Uint16Array]"]=ct["[object Uint32Array]"]=!0,ct["[object Error]"]=ct[se]=ct["[object WeakMap]"]=!1,D.exports=function Li(ut,is,Ms,by,Tl,ss){var Ht,ea=1&is,Pl=2&is,df=4&is;if(Ms&&(Ht=Tl?Ms(ut,by,Tl,ss):Ms(ut)),void 0!==Ht)return Ht;if(!_(ut))return ut;var ff=M(ut);if(ff){if(Ht=O(ut),!ea)return d(ut,Ht)}else{var _s=m(ut),gf=_s==se||"[object GeneratorFunction]"==_s;if(B(ut))return R(ut,ea);if(_s==fe||_s==W||gf&&!Tl){if(Ht=Pl||gf?{}:N(ut),!ea)return Pl?v(ut,E(Ht,ut)):f(ut,w(Ht,ut))}else{if(!ct[_s])return Tl?ut:{};Ht=P(ut,_s,ea)}}ss||(ss=new p);var pf=ss.get(ut);if(pf)return pf;ss.set(ut,Ht),K(ut)?ut.forEach(function(Hr){Ht.add(Li(Hr,is,Ms,Hr,ut,ss))}):Y(ut)&&ut.forEach(function(Hr,xi){Ht.set(xi,Li(Hr,is,Ms,xi,ut,ss))});var mf=ff?void 0:(df?Pl?y:g:Pl?ne:Q)(ut);return I(mf||ut,function(Hr,xi){mf&&(Hr=ut[xi=Hr]),C(Ht,xi,Li(Hr,is,Ms,xi,ut,ss))}),Ht}},8858:(D,T,h)=>{var p=h(5940),I=Object.create,C=function(){function w(){}return function(E){if(!p(E))return{};if(I)return I(E);w.prototype=E;var R=new w;return w.prototype=void 0,R}}();D.exports=C},3132:(D,T,h)=>{var p=h(5184),C=h(6539)(p);D.exports=C},7308:(D,T,h)=>{var p=h(4129);D.exports=function I(C,w,E){for(var R=-1,d=C.length;++R<d;){var f=C[R],v=w(f);if(null!=v&&(void 0===g?v==v&&!p(v):E(v,g)))var g=v,y=f}return y}},3609:(D,T,h)=>{var p=h(3132);D.exports=function I(C,w){var E=[];return p(C,function(R,d,f){w(R,d,f)&&E.push(R)}),E}},5317:D=>{D.exports=function T(h,p,I,C){for(var w=h.length,E=I+(C?1:-1);C?E--:++E<w;)if(p(h[E],E,h))return E;return-1}},686:(D,T,h)=>{var p=h(5059),I=h(5039);D.exports=function C(w,E,R,d,f){var v=-1,g=w.length;for(R||(R=I),f||(f=[]);++v<g;){var y=w[v];E>0&&R(y)?E>1?C(y,E-1,R,d,f):p(f,y):d||(f[f.length]=y)}return f}},755:(D,T,h)=>{var I=h(456)();D.exports=I},5184:(D,T,h)=>{var p=h(755),I=h(118);D.exports=function C(w,E){return w&&p(w,E,I)}},5456:(D,T,h)=>{var p=h(6884),I=h(8533);D.exports=function C(w,E){for(var R=0,d=(E=p(E,w)).length;null!=w&&R<d;)w=w[I(E[R++])];return R&&R==d?w:void 0}},8247:(D,T,h)=>{var p=h(5059),I=h(1503);D.exports=function C(w,E,R){var d=E(w);return I(w)?d:p(d,R(w))}},3337:(D,T,h)=>{var p=h(443),I=h(1318),C=h(2902),R=p?p.toStringTag:void 0;D.exports=function d(f){return null==f?void 0===f?"[object Undefined]":"[object Null]":R&&R in Object(f)?I(f):C(f)}},1100:D=>{D.exports=function T(h,p){return h>p}},4781:D=>{var h=Object.prototype.hasOwnProperty;D.exports=function p(I,C){return null!=I&&h.call(I,C)}},9989:D=>{D.exports=function T(h,p){return null!=h&&p in Object(h)}},4164:(D,T,h)=>{var p=h(5317),I=h(968),C=h(4977);D.exports=function w(E,R,d){return R==R?C(E,R,d):p(E,I,d)}},186:(D,T,h)=>{var p=h(3337),I=h(2671);D.exports=function w(E){return I(E)&&"[object Arguments]"==p(E)}},5740:(D,T,h)=>{var p=h(8325),I=h(2671);D.exports=function C(w,E,R,d,f){return w===E||(null==w||null==E||!I(w)&&!I(E)?w!=w&&E!=E:p(w,E,R,d,C,f))}},8325:(D,T,h)=>{var p=h(2858),I=h(3914),C=h(8583),w=h(2286),E=h(8794),R=h(1503),d=h(891),f=h(8159),g="[object Arguments]",y="[object Array]",m="[object Object]",P=Object.prototype.hasOwnProperty;D.exports=function N(M,B,Y,_,K,Q){var ne=R(M),X=R(B),re=ne?y:E(M),U=X?y:E(B),W=(re=re==g?m:re)==m,k=(U=U==g?m:U)==m,V=re==U;if(V&&d(M)){if(!d(B))return!1;ne=!0,W=!1}if(V&&!W)return Q||(Q=new p),ne||f(M)?I(M,B,Y,_,K,Q):C(M,B,re,Y,_,K,Q);if(!(1&Y)){var H=W&&P.call(M,"__wrapped__"),$=k&&P.call(B,"__wrapped__");if(H||$){var se=H?M.value():M,j=$?B.value():B;return Q||(Q=new p),K(se,j,Y,_,Q)}}return!!V&&(Q||(Q=new p),w(M,B,Y,_,K,Q))}},7021:(D,T,h)=>{var p=h(8794),I=h(2671);D.exports=function w(E){return I(E)&&"[object Map]"==p(E)}},431:(D,T,h)=>{var p=h(2858),I=h(5740);D.exports=function E(R,d,f,v){var g=f.length,y=g,m=!v;if(null==R)return!y;for(R=Object(R);g--;){var O=f[g];if(m&&O[2]?O[1]!==R[O[0]]:!(O[0]in R))return!1}for(;++g<y;){var P=(O=f[g])[0],N=R[P],M=O[1];if(m&&O[2]){if(void 0===N&&!(P in R))return!1}else{var B=new p;if(v)var Y=v(N,M,P,R,d,B);if(!(void 0===Y?I(M,N,3,v,B):Y))return!1}}return!0}},968:D=>{D.exports=function T(h){return h!=h}},7304:(D,T,h)=>{var p=h(5946),I=h(1943),C=h(5940),w=h(2827),R=/^\[object .+?Constructor\]$/,y=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");D.exports=function m(O){return!(!C(O)||I(O))&&(p(O)?y:R).test(w(O))}},771:(D,T,h)=>{var p=h(8794),I=h(2671);D.exports=function w(E){return I(E)&&"[object Set]"==p(E)}},1083:(D,T,h)=>{var p=h(3337),I=h(6231),C=h(2671),V={};V["[object Float32Array]"]=V["[object Float64Array]"]=V["[object Int8Array]"]=V["[object Int16Array]"]=V["[object Int32Array]"]=V["[object Uint8Array]"]=V["[object Uint8ClampedArray]"]=V["[object Uint16Array]"]=V["[object Uint32Array]"]=!0,V["[object Arguments]"]=V["[object Array]"]=V["[object ArrayBuffer]"]=V["[object Boolean]"]=V["[object DataView]"]=V["[object Date]"]=V["[object Error]"]=V["[object Function]"]=V["[object Map]"]=V["[object Number]"]=V["[object Object]"]=V["[object RegExp]"]=V["[object Set]"]=V["[object String]"]=V["[object WeakMap]"]=!1,D.exports=function H($){return C($)&&I($.length)&&!!V[p($)]}},6517:(D,T,h)=>{var p=h(8133),I=h(9458),C=h(2608),w=h(1503),E=h(7495);D.exports=function R(d){return"function"==typeof d?d:null==d?C:"object"==typeof d?w(d)?I(d[0],d[1]):p(d):E(d)}},1172:(D,T,h)=>{var p=h(5488),I=h(5491),w=Object.prototype.hasOwnProperty;D.exports=function E(R){if(!p(R))return I(R);var d=[];for(var f in Object(R))w.call(R,f)&&"constructor"!=f&&d.push(f);return d}},2809:(D,T,h)=>{var p=h(5940),I=h(5488),C=h(2158),E=Object.prototype.hasOwnProperty;D.exports=function R(d){if(!p(d))return C(d);var f=I(d),v=[];for(var g in d)"constructor"==g&&(f||!E.call(d,g))||v.push(g);return v}},9069:D=>{D.exports=function T(h,p){return h<p}},2046:(D,T,h)=>{var p=h(3132),I=h(6507);D.exports=function C(w,E){var R=-1,d=I(w)?Array(w.length):[];return p(w,function(f,v,g){d[++R]=E(f,v,g)}),d}},8133:(D,T,h)=>{var p=h(431),I=h(2379),C=h(642);D.exports=function w(E){var R=I(E);return 1==R.length&&R[0][2]?C(R[0][0],R[0][1]):function(d){return d===E||p(d,E,R)}}},9458:(D,T,h)=>{var p=h(5740),I=h(8817),C=h(8492),w=h(5352),E=h(2442),R=h(642),d=h(8533);D.exports=function g(y,m){return w(y)&&E(m)?R(d(y),m):function(O){var P=I(O,y);return void 0===P&&P===m?C(O,y):p(m,P,3)}}},3842:(D,T,h)=>{var p=h(2858),I=h(9276),C=h(755),w=h(3675),E=h(5940),R=h(6555),d=h(9351);D.exports=function f(v,g,y,m,O){v!==g&&C(g,function(P,N){if(O||(O=new p),E(P))w(v,g,N,y,f,m,O);else{var M=m?m(d(v,N),P,N+"",v,g,O):void 0;void 0===M&&(M=P),I(v,N,M)}},R)}},3675:(D,T,h)=>{var p=h(9276),I=h(9292),C=h(5208),w=h(9454),E=h(4264),R=h(7151),d=h(1503),f=h(1330),v=h(891),g=h(5946),y=h(5940),m=h(7614),O=h(8159),P=h(9351),N=h(8067);D.exports=function M(B,Y,_,K,Q,ne,X){var re=P(B,_),U=P(Y,_),W=X.get(U);if(W)p(B,_,W);else{var k=ne?ne(re,U,_+"",B,Y,X):void 0,V=void 0===k;if(V){var H=d(U),$=!H&&v(U),se=!H&&!$&&O(U);k=U,H||$||se?d(re)?k=re:f(re)?k=w(re):$?(V=!1,k=I(U,!0)):se?(V=!1,k=C(U,!0)):k=[]:m(U)||R(U)?(k=re,R(re)?k=N(re):(!y(re)||g(re))&&(k=E(U))):V=!1}V&&(X.set(U,k),Q(k,U,K,ne,X),X.delete(U)),p(B,_,k)}}},6119:(D,T,h)=>{var p=h(4633),I=h(5456),C=h(6517),w=h(2046),E=h(8750),R=h(5647),d=h(1215),f=h(2608),v=h(1503);D.exports=function g(y,m,O){m=m.length?p(m,function(M){return v(M)?function(B){return I(B,1===M.length?M[0]:M)}:M}):[f];var P=-1;m=p(m,R(C));var N=w(y,function(M,B,Y){return{criteria:p(m,function(K){return K(M)}),index:++P,value:M}});return E(N,function(M,B){return d(M,B,O)})}},3021:(D,T,h)=>{var p=h(5495),I=h(8492);D.exports=function C(w,E){return p(w,E,function(R,d){return I(w,d)})}},5495:(D,T,h)=>{var p=h(5456),I=h(5963),C=h(6884);D.exports=function w(E,R,d){for(var f=-1,v=R.length,g={};++f<v;){var y=R[f],m=p(E,y);d(m,y)&&I(g,C(y,E),m)}return g}},1847:D=>{D.exports=function T(h){return function(p){return null==p?void 0:p[h]}}},9222:(D,T,h)=>{var p=h(5456);D.exports=function I(C){return function(w){return p(w,C)}}},6307:D=>{var T=Math.ceil,h=Math.max;D.exports=function p(I,C,w,E){for(var R=-1,d=h(T((C-I)/(w||1)),0),f=Array(d);d--;)f[E?d:++R]=I,I+=w;return f}},3570:D=>{D.exports=function T(h,p,I,C,w){return w(h,function(E,R,d){I=C?(C=!1,E):p(I,E,R,d)}),I}},3269:(D,T,h)=>{var p=h(2608),I=h(3983),C=h(2185);D.exports=function w(E,R){return C(I(E,R,p),E+"")}},5963:(D,T,h)=>{var p=h(9719),I=h(6884),C=h(8442),w=h(5940),E=h(8533);D.exports=function R(d,f,v,g){if(!w(d))return d;for(var y=-1,m=(f=I(f,d)).length,O=m-1,P=d;null!=P&&++y<m;){var N=E(f[y]),M=v;if("__proto__"===N||"constructor"===N||"prototype"===N)return d;if(y!=O){var B=P[N];void 0===(M=g?g(B,N,P):void 0)&&(M=w(B)?B:C(f[y+1])?[]:{})}p(P,N,M),P=P[N]}return d}},9510:(D,T,h)=>{var p=h(6684),I=h(6713),C=h(2608);D.exports=I?function(E,R){return I(E,"toString",{configurable:!0,enumerable:!1,value:p(R),writable:!0})}:C},8750:D=>{D.exports=function T(h,p){var I=h.length;for(h.sort(p);I--;)h[I]=h[I].value;return h}},5334:D=>{D.exports=function T(h,p){for(var I=-1,C=Array(h);++I<h;)C[I]=p(I);return C}},3935:(D,T,h)=>{var p=h(443),I=h(4633),C=h(1503),w=h(4129),R=p?p.prototype:void 0,d=R?R.toString:void 0;D.exports=function f(v){if("string"==typeof v)return v;if(C(v))return I(v,f)+"";if(w(v))return d?d.call(v):"";var g=v+"";return"0"==g&&1/v==-1/0?"-0":g}},3348:(D,T,h)=>{var p=h(2760),I=/^\s+/;D.exports=function C(w){return w&&w.slice(0,p(w)+1).replace(I,"")}},5647:D=>{D.exports=function T(h){return function(p){return h(p)}}},707:(D,T,h)=>{var p=h(8849),I=h(1253),C=h(177),w=h(5972),E=h(4575),R=h(4174);D.exports=function f(v,g,y){var m=-1,O=I,P=v.length,N=!0,M=[],B=M;if(y)N=!1,O=C;else if(P>=200){var Y=g?null:E(v);if(Y)return R(Y);N=!1,O=w,B=new p}else B=g?[]:M;e:for(;++m<P;){var _=v[m],K=g?g(_):_;if(_=y||0!==_?_:0,N&&K==K){for(var Q=B.length;Q--;)if(B[Q]===K)continue e;g&&B.push(K),M.push(_)}else O(B,K,y)||(B!==M&&B.push(K),M.push(_))}return M}},9179:(D,T,h)=>{var p=h(4633);D.exports=function I(C,w){return p(w,function(E){return C[E]})}},8645:D=>{D.exports=function T(h,p,I){for(var C=-1,w=h.length,E=p.length,R={};++C<w;)I(R,h[C],C<E?p[C]:void 0);return R}},5972:D=>{D.exports=function T(h,p){return h.has(p)}},1481:(D,T,h)=>{var p=h(2608);D.exports=function I(C){return"function"==typeof C?C:p}},6884:(D,T,h)=>{var p=h(1503),I=h(5352),C=h(2855),w=h(3943);D.exports=function E(R,d){return p(R)?R:I(R,d)?[R]:C(w(R))}},3362:(D,T,h)=>{var p=h(3457);D.exports=function I(C){var w=new C.constructor(C.byteLength);return new p(w).set(new p(C)),w}},9292:(D,T,h)=>{D=h.nmd(D);var p=h(2119),I=T&&!T.nodeType&&T,C=I&&D&&!D.nodeType&&D,E=C&&C.exports===I?p.Buffer:void 0,R=E?E.allocUnsafe:void 0;D.exports=function d(f,v){if(v)return f.slice();var g=f.length,y=R?R(g):new f.constructor(g);return f.copy(y),y}},7e3:(D,T,h)=>{var p=h(3362);D.exports=function I(C,w){var E=w?p(C.buffer):C.buffer;return new C.constructor(E,C.byteOffset,C.byteLength)}},4098:D=>{var T=/\w*$/;D.exports=function h(p){var I=new p.constructor(p.source,T.exec(p));return I.lastIndex=p.lastIndex,I}},2533:(D,T,h)=>{var p=h(443),I=p?p.prototype:void 0,C=I?I.valueOf:void 0;D.exports=function w(E){return C?Object(C.call(E)):{}}},5208:(D,T,h)=>{var p=h(3362);D.exports=function I(C,w){var E=w?p(C.buffer):C.buffer;return new C.constructor(E,C.byteOffset,C.length)}},3443:(D,T,h)=>{var p=h(4129);D.exports=function I(C,w){if(C!==w){var E=void 0!==C,R=null===C,d=C==C,f=p(C),v=void 0!==w,g=null===w,y=w==w,m=p(w);if(!g&&!m&&!f&&C>w||f&&v&&y&&!g&&!m||R&&v&&y||!E&&y||!d)return 1;if(!R&&!f&&!m&&C<w||m&&E&&d&&!R&&!f||g&&E&&d||!v&&d||!y)return-1}return 0}},1215:(D,T,h)=>{var p=h(3443);D.exports=function I(C,w,E){for(var R=-1,d=C.criteria,f=w.criteria,v=d.length,g=E.length;++R<v;){var y=p(d[R],f[R]);if(y)return R>=g?y:y*("desc"==E[R]?-1:1)}return C.index-w.index}},9454:D=>{D.exports=function T(h,p){var I=-1,C=h.length;for(p||(p=Array(C));++I<C;)p[I]=h[I];return p}},1989:(D,T,h)=>{var p=h(9719),I=h(5683);D.exports=function C(w,E,R,d){var f=!R;R||(R={});for(var v=-1,g=E.length;++v<g;){var y=E[v],m=d?d(R[y],w[y],y,R,w):void 0;void 0===m&&(m=w[y]),f?I(R,y,m):p(R,y,m)}return R}},4444:(D,T,h)=>{var p=h(1989),I=h(9383);D.exports=function C(w,E){return p(w,I(w),E)}},9905:(D,T,h)=>{var p=h(1989),I=h(3051);D.exports=function C(w,E){return p(w,I(w),E)}},4610:(D,T,h)=>{var p=h(2119);D.exports=p["__core-js_shared__"]},4944:(D,T,h)=>{var p=h(3269),I=h(3342);D.exports=function C(w){return p(function(E,R){var d=-1,f=R.length,v=f>1?R[f-1]:void 0,g=f>2?R[2]:void 0;for(v=w.length>3&&"function"==typeof v?(f--,v):void 0,g&&I(R[0],R[1],g)&&(v=f<3?void 0:v,f=1),E=Object(E);++d<f;){var y=R[d];y&&w(E,y,d,v)}return E})}},6539:(D,T,h)=>{var p=h(6507);D.exports=function I(C,w){return function(E,R){if(null==E)return E;if(!p(E))return C(E,R);for(var d=E.length,f=w?d:-1,v=Object(E);(w?f--:++f<d)&&!1!==R(v[f],f,v););return E}}},456:D=>{D.exports=function T(h){return function(p,I,C){for(var w=-1,E=Object(p),R=C(p),d=R.length;d--;){var f=R[h?d:++w];if(!1===I(E[f],f,E))break}return p}}},4653:(D,T,h)=>{var p=h(6517),I=h(6507),C=h(118);D.exports=function w(E){return function(R,d,f){var v=Object(R);if(!I(R)){var g=p(d,3);R=C(R),d=function(m){return g(v[m],m,v)}}var y=E(R,d,f);return y>-1?v[g?R[y]:y]:void 0}}},7509:(D,T,h)=>{var p=h(6307),I=h(3342),C=h(2232);D.exports=function w(E){return function(R,d,f){return f&&"number"!=typeof f&&I(R,d,f)&&(d=f=void 0),R=C(R),void 0===d?(d=R,R=0):d=C(d),f=void 0===f?R<d?1:-1:C(f),p(R,d,f,E)}}},4575:(D,T,h)=>{var p=h(6323),I=h(2552),C=h(4174),E=p&&1/C(new p([,-0]))[1]==1/0?function(R){return new p(R)}:I;D.exports=E},6713:(D,T,h)=>{var p=h(3436),I=function(){try{var C=p(Object,"defineProperty");return C({},"",{}),C}catch(w){}}();D.exports=I},3914:(D,T,h)=>{var p=h(8849),I=h(9503),C=h(5972);D.exports=function R(d,f,v,g,y,m){var O=1&v,P=d.length,N=f.length;if(P!=N&&!(O&&N>P))return!1;var M=m.get(d),B=m.get(f);if(M&&B)return M==f&&B==d;var Y=-1,_=!0,K=2&v?new p:void 0;for(m.set(d,f),m.set(f,d);++Y<P;){var Q=d[Y],ne=f[Y];if(g)var X=O?g(ne,Q,Y,f,d,m):g(Q,ne,Y,d,f,m);if(void 0!==X){if(X)continue;_=!1;break}if(K){if(!I(f,function(re,U){if(!C(K,U)&&(Q===re||y(Q,re,v,g,m)))return K.push(U)})){_=!1;break}}else if(Q!==ne&&!y(Q,ne,v,g,m)){_=!1;break}}return m.delete(d),m.delete(f),_}},8583:(D,T,h)=>{var p=h(443),I=h(3457),C=h(217),w=h(3914),E=h(3205),R=h(4174),K=p?p.prototype:void 0,Q=K?K.valueOf:void 0;D.exports=function ne(X,re,U,W,k,V,H){switch(U){case"[object DataView]":if(X.byteLength!=re.byteLength||X.byteOffset!=re.byteOffset)return!1;X=X.buffer,re=re.buffer;case"[object ArrayBuffer]":return!(X.byteLength!=re.byteLength||!V(new I(X),new I(re)));case"[object Boolean]":case"[object Date]":case"[object Number]":return C(+X,+re);case"[object Error]":return X.name==re.name&&X.message==re.message;case"[object RegExp]":case"[object String]":return X==re+"";case"[object Map]":var $=E;case"[object Set]":if($||($=R),X.size!=re.size&&!(1&W))return!1;var j=H.get(X);if(j)return j==re;W|=2,H.set(X,re);var z=w($(X),$(re),W,k,V,H);return H.delete(X),z;case"[object Symbol]":if(Q)return Q.call(X)==Q.call(re)}return!1}},2286:(D,T,h)=>{var p=h(7597),w=Object.prototype.hasOwnProperty;D.exports=function E(R,d,f,v,g,y){var m=1&f,O=p(R),P=O.length;if(P!=p(d).length&&!m)return!1;for(var B=P;B--;){var Y=O[B];if(!(m?Y in d:w.call(d,Y)))return!1}var _=y.get(R),K=y.get(d);if(_&&K)return _==d&&K==R;var Q=!0;y.set(R,d),y.set(d,R);for(var ne=m;++B<P;){var X=R[Y=O[B]],re=d[Y];if(v)var U=m?v(re,X,Y,d,R,y):v(X,re,Y,R,d,y);if(!(void 0===U?X===re||g(X,re,f,v,y):U)){Q=!1;break}ne||(ne="constructor"==Y)}if(Q&&!ne){var W=R.constructor,k=d.constructor;W!=k&&"constructor"in R&&"constructor"in d&&!("function"==typeof W&&W instanceof W&&"function"==typeof k&&k instanceof k)&&(Q=!1)}return y.delete(R),y.delete(d),Q}},3975:(D,T,h)=>{var p=h(2274),I=h(3983),C=h(2185);D.exports=function w(E){return C(I(E,void 0,p),E+"")}},9122:D=>{var T="object"==typeof global&&global&&global.Object===Object&&global;D.exports=T},7597:(D,T,h)=>{var p=h(8247),I=h(9383),C=h(118);D.exports=function w(E){return p(E,C,I)}},6967:(D,T,h)=>{var p=h(8247),I=h(3051),C=h(6555);D.exports=function w(E){return p(E,C,I)}},4537:(D,T,h)=>{var p=h(3819);D.exports=function I(C,w){var E=C.__data__;return p(w)?E["string"==typeof w?"string":"hash"]:E.map}},2379:(D,T,h)=>{var p=h(2442),I=h(118);D.exports=function C(w){for(var E=I(w),R=E.length;R--;){var d=E[R],f=w[d];E[R]=[d,f,p(f)]}return E}},3436:(D,T,h)=>{var p=h(7304),I=h(1990);D.exports=function C(w,E){var R=I(w,E);return p(R)?R:void 0}},9519:(D,T,h)=>{var I=h(9385)(Object.getPrototypeOf,Object);D.exports=I},1318:(D,T,h)=>{var p=h(443),I=Object.prototype,C=I.hasOwnProperty,w=I.toString,E=p?p.toStringTag:void 0;D.exports=function R(d){var f=C.call(d,E),v=d[E];try{d[E]=void 0;var g=!0}catch(m){}var y=w.call(d);return g&&(f?d[E]=v:delete d[E]),y}},9383:(D,T,h)=>{var p=h(9779),I=h(9975),w=Object.prototype.propertyIsEnumerable,E=Object.getOwnPropertySymbols;D.exports=E?function(d){return null==d?[]:(d=Object(d),p(E(d),function(f){return w.call(d,f)}))}:I},3051:(D,T,h)=>{var p=h(5059),I=h(9519),C=h(9383),w=h(9975);D.exports=Object.getOwnPropertySymbols?function(d){for(var f=[];d;)p(f,C(d)),d=I(d);return f}:w},8794:(D,T,h)=>{var p=h(7244),I=h(1501),C=h(4267),w=h(6323),E=h(4243),R=h(3337),d=h(2827),f="[object Map]",g="[object Promise]",y="[object Set]",m="[object WeakMap]",O="[object DataView]",P=d(p),N=d(I),M=d(C),B=d(w),Y=d(E),_=R;(p&&_(new p(new ArrayBuffer(1)))!=O||I&&_(new I)!=f||C&&_(C.resolve())!=g||w&&_(new w)!=y||E&&_(new E)!=m)&&(_=function(K){var Q=R(K),ne="[object Object]"==Q?K.constructor:void 0,X=ne?d(ne):"";if(X)switch(X){case P:return O;case N:return f;case M:return g;case B:return y;case Y:return m}return Q}),D.exports=_},1990:D=>{D.exports=function T(h,p){return null==h?void 0:h[p]}},7283:(D,T,h)=>{var p=h(6884),I=h(7151),C=h(1503),w=h(8442),E=h(6231),R=h(8533);D.exports=function d(f,v,g){for(var y=-1,m=(v=p(v,f)).length,O=!1;++y<m;){var P=R(v[y]);if(!(O=null!=f&&g(f,P)))break;f=f[P]}return O||++y!=m?O:!!(m=null==f?0:f.length)&&E(m)&&w(P,m)&&(C(f)||I(f))}},7609:D=>{var R=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");D.exports=function d(f){return R.test(f)}},4312:(D,T,h)=>{var p=h(862);D.exports=function I(){this.__data__=p?p(null):{},this.size=0}},6421:D=>{D.exports=function T(h){var p=this.has(h)&&delete this.__data__[h];return this.size-=p?1:0,p}},5764:(D,T,h)=>{var p=h(862),w=Object.prototype.hasOwnProperty;D.exports=function E(R){var d=this.__data__;if(p){var f=d[R];return"__lodash_hash_undefined__"===f?void 0:f}return w.call(d,R)?d[R]:void 0}},8685:(D,T,h)=>{var p=h(862),C=Object.prototype.hasOwnProperty;D.exports=function w(E){var R=this.__data__;return p?void 0!==R[E]:C.call(R,E)}},6676:(D,T,h)=>{var p=h(862);D.exports=function C(w,E){var R=this.__data__;return this.size+=this.has(w)?0:1,R[w]=p&&void 0===E?"__lodash_hash_undefined__":E,this}},6782:D=>{var h=Object.prototype.hasOwnProperty;D.exports=function p(I){var C=I.length,w=new I.constructor(C);return C&&"string"==typeof I[0]&&h.call(I,"index")&&(w.index=I.index,w.input=I.input),w}},7878:(D,T,h)=>{var p=h(3362),I=h(7e3),C=h(4098),w=h(2533),E=h(5208);D.exports=function U(W,k,V){var H=W.constructor;switch(k){case"[object ArrayBuffer]":return p(W);case"[object Boolean]":case"[object Date]":return new H(+W);case"[object DataView]":return I(W,V);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return E(W,V);case"[object Map]":case"[object Set]":return new H;case"[object Number]":case"[object String]":return new H(W);case"[object RegExp]":return C(W);case"[object Symbol]":return w(W)}}},4264:(D,T,h)=>{var p=h(8858),I=h(9519),C=h(5488);D.exports=function w(E){return"function"!=typeof E.constructor||C(E)?{}:p(I(E))}},5039:(D,T,h)=>{var p=h(443),I=h(7151),C=h(1503),w=p?p.isConcatSpreadable:void 0;D.exports=function E(R){return C(R)||I(R)||!!(w&&R&&R[w])}},8442:D=>{var h=/^(?:0|[1-9]\d*)$/;D.exports=function p(I,C){var w=typeof I;return!!(C=null==C?9007199254740991:C)&&("number"==w||"symbol"!=w&&h.test(I))&&I>-1&&I%1==0&&I<C}},3342:(D,T,h)=>{var p=h(217),I=h(6507),C=h(8442),w=h(5940);D.exports=function E(R,d,f){if(!w(f))return!1;var v=typeof d;return!!("number"==v?I(f)&&C(d,f.length):"string"==v&&d in f)&&p(f[d],R)}},5352:(D,T,h)=>{var p=h(1503),I=h(4129),C=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,w=/^\w*$/;D.exports=function E(R,d){if(p(R))return!1;var f=typeof R;return!("number"!=f&&"symbol"!=f&&"boolean"!=f&&null!=R&&!I(R))||w.test(R)||!C.test(R)||null!=d&&R in Object(d)}},3819:D=>{D.exports=function T(h){var p=typeof h;return"string"==p||"number"==p||"symbol"==p||"boolean"==p?"__proto__"!==h:null===h}},1943:(D,T,h)=>{var w,p=h(4610),I=(w=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"";D.exports=function C(w){return!!I&&I in w}},5488:D=>{var T=Object.prototype;D.exports=function h(p){var I=p&&p.constructor;return p===("function"==typeof I&&I.prototype||T)}},2442:(D,T,h)=>{var p=h(5940);D.exports=function I(C){return C==C&&!p(C)}},1840:D=>{D.exports=function T(){this.__data__=[],this.size=0}},4378:(D,T,h)=>{var p=h(3503),C=Array.prototype.splice;D.exports=function w(E){var R=this.__data__,d=p(R,E);return!(d<0||(d==R.length-1?R.pop():C.call(R,d,1),--this.size,0))}},4981:(D,T,h)=>{var p=h(3503);D.exports=function I(C){var w=this.__data__,E=p(w,C);return E<0?void 0:w[E][1]}},7343:(D,T,h)=>{var p=h(3503);D.exports=function I(C){return p(this.__data__,C)>-1}},8895:(D,T,h)=>{var p=h(3503);D.exports=function I(C,w){var E=this.__data__,R=p(E,C);return R<0?(++this.size,E.push([C,w])):E[R][1]=w,this}},638:(D,T,h)=>{var p=h(4994),I=h(9215),C=h(1501);D.exports=function w(){this.size=0,this.__data__={hash:new p,map:new(C||I),string:new p}}},1184:(D,T,h)=>{var p=h(4537);D.exports=function I(C){var w=p(this,C).delete(C);return this.size-=w?1:0,w}},866:(D,T,h)=>{var p=h(4537);D.exports=function I(C){return p(this,C).get(C)}},3771:(D,T,h)=>{var p=h(4537);D.exports=function I(C){return p(this,C).has(C)}},1772:(D,T,h)=>{var p=h(4537);D.exports=function I(C,w){var E=p(this,C),R=E.size;return E.set(C,w),this.size+=E.size==R?0:1,this}},3205:D=>{D.exports=function T(h){var p=-1,I=Array(h.size);return h.forEach(function(C,w){I[++p]=[w,C]}),I}},642:D=>{D.exports=function T(h,p){return function(I){return null!=I&&I[h]===p&&(void 0!==p||h in Object(I))}}},719:(D,T,h)=>{var p=h(535);D.exports=function C(w){var E=p(w,function(d){return 500===R.size&&R.clear(),d}),R=E.cache;return E}},862:(D,T,h)=>{var I=h(3436)(Object,"create");D.exports=I},5491:(D,T,h)=>{var I=h(9385)(Object.keys,Object);D.exports=I},2158:D=>{D.exports=function T(h){var p=[];if(null!=h)for(var I in Object(h))p.push(I);return p}},3597:(D,T,h)=>{D=h.nmd(D);var p=h(9122),I=T&&!T.nodeType&&T,C=I&&D&&!D.nodeType&&D,E=C&&C.exports===I&&p.process,R=function(){try{return C&&C.require&&C.require("util").types||E&&E.binding&&E.binding("util")}catch(f){}}();D.exports=R},2902:D=>{var h=Object.prototype.toString;D.exports=function p(I){return h.call(I)}},9385:D=>{D.exports=function T(h,p){return function(I){return h(p(I))}}},3983:(D,T,h)=>{var p=h(6999),I=Math.max;D.exports=function C(w,E,R){return E=I(void 0===E?w.length-1:E,0),function(){for(var d=arguments,f=-1,v=I(d.length-E,0),g=Array(v);++f<v;)g[f]=d[E+f];f=-1;for(var y=Array(E+1);++f<E;)y[f]=d[f];return y[E]=R(g),p(w,this,y)}}},2119:(D,T,h)=>{var p=h(9122),I="object"==typeof self&&self&&self.Object===Object&&self,C=p||I||Function("return this")();D.exports=C},9351:D=>{D.exports=function T(h,p){if(("constructor"!==p||"function"!=typeof h[p])&&"__proto__"!=p)return h[p]}},4600:D=>{D.exports=function h(p){return this.__data__.set(p,"__lodash_hash_undefined__"),this}},1387:D=>{D.exports=function T(h){return this.__data__.has(h)}},4174:D=>{D.exports=function T(h){var p=-1,I=Array(h.size);return h.forEach(function(C){I[++p]=C}),I}},2185:(D,T,h)=>{var p=h(9510),C=h(29)(p);D.exports=C},29:D=>{var p=Date.now;D.exports=function I(C){var w=0,E=0;return function(){var R=p(),d=16-(R-E);if(E=R,d>0){if(++w>=800)return arguments[0]}else w=0;return C.apply(void 0,arguments)}}},3720:(D,T,h)=>{var p=h(9215);D.exports=function I(){this.__data__=new p,this.size=0}},4410:D=>{D.exports=function T(h){var p=this.__data__,I=p.delete(h);return this.size=p.size,I}},5576:D=>{D.exports=function T(h){return this.__data__.get(h)}},2247:D=>{D.exports=function T(h){return this.__data__.has(h)}},1585:(D,T,h)=>{var p=h(9215),I=h(1501),C=h(9850);D.exports=function E(R,d){var f=this.__data__;if(f instanceof p){var v=f.__data__;if(!I||v.length<199)return v.push([R,d]),this.size=++f.size,this;f=this.__data__=new C(v)}return f.set(R,d),this.size=f.size,this}},4977:D=>{D.exports=function T(h,p,I){for(var C=I-1,w=h.length;++C<w;)if(h[C]===p)return C;return-1}},2315:(D,T,h)=>{var p=h(5481),I=h(7609),C=h(1149);D.exports=function w(E){return I(E)?C(E):p(E)}},2855:(D,T,h)=>{var p=h(719),I=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,C=/\\(\\)?/g,w=p(function(E){var R=[];return 46===E.charCodeAt(0)&&R.push(""),E.replace(I,function(d,f,v,g){R.push(v?g.replace(C,"$1"):f||d)}),R});D.exports=w},8533:(D,T,h)=>{var p=h(4129);D.exports=function C(w){if("string"==typeof w||p(w))return w;var E=w+"";return"0"==E&&1/w==-1/0?"-0":E}},2827:D=>{var h=Function.prototype.toString;D.exports=function p(I){if(null!=I){try{return h.call(I)}catch(C){}try{return I+""}catch(C){}}return""}},2760:D=>{var T=/\s/;D.exports=function h(p){for(var I=p.length;I--&&T.test(p.charAt(I)););return I}},1149:D=>{var T="\\ud800-\\udfff",E="["+T+"]",R="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",d="\\ud83c[\\udffb-\\udfff]",v="[^"+T+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",y="[\\ud800-\\udbff][\\udc00-\\udfff]",O="(?:"+R+"|"+d+")?",P="[\\ufe0e\\ufe0f]?",M=P+O+"(?:\\u200d(?:"+[v,g,y].join("|")+")"+P+O+")*",B="(?:"+[v+R+"?",R,g,y,E].join("|")+")",Y=RegExp(d+"(?="+d+")|"+B+M,"g");D.exports=function _(K){for(var Q=Y.lastIndex=0;Y.test(K);)++Q;return Q}},1094:(D,T,h)=>{var p=h(4462);D.exports=function C(w){return p(w,4)}},733:(D,T,h)=>{var p=h(4462);D.exports=function w(E){return p(E,5)}},6684:D=>{D.exports=function T(h){return function(){return h}}},8800:(D,T,h)=>{var p=h(3269),I=h(217),C=h(3342),w=h(6555),E=Object.prototype,R=E.hasOwnProperty,d=p(function(f,v){f=Object(f);var g=-1,y=v.length,m=y>2?v[2]:void 0;for(m&&C(v[0],v[1],m)&&(y=1);++g<y;)for(var O=v[g],P=w(O),N=-1,M=P.length;++N<M;){var B=P[N],Y=f[B];(void 0===Y||I(Y,E[B])&&!R.call(f,B))&&(f[B]=O[B])}return f});D.exports=d},5474:(D,T,h)=>{D.exports=h(9851)},217:D=>{D.exports=function T(h,p){return h===p||h!=h&&p!=p}},5281:(D,T,h)=>{var p=h(9779),I=h(3609),C=h(6517),w=h(1503);D.exports=function E(R,d){return(w(R)?p:I)(R,C(d,3))}},2516:(D,T,h)=>{var C=h(4653)(h(6397));D.exports=C},6397:(D,T,h)=>{var p=h(5317),I=h(6517),C=h(4401),w=Math.max;D.exports=function E(R,d,f){var v=null==R?0:R.length;if(!v)return-1;var g=null==f?0:C(f);return g<0&&(g=w(v+g,0)),p(R,I(d,3),g)}},2274:(D,T,h)=>{var p=h(686);D.exports=function I(C){return null!=C&&C.length?p(C,1):[]}},9851:(D,T,h)=>{var p=h(6837),I=h(3132),C=h(1481),w=h(1503);D.exports=function E(R,d){return(w(R)?p:I)(R,C(d))}},1176:(D,T,h)=>{var p=h(755),I=h(1481),C=h(6555);D.exports=function w(E,R){return null==E?E:p(E,I(R),C)}},8817:(D,T,h)=>{var p=h(5456);D.exports=function I(C,w,E){var R=null==C?void 0:p(C,w);return void 0===R?E:R}},4842:(D,T,h)=>{var p=h(4781),I=h(7283);D.exports=function C(w,E){return null!=w&&I(w,E,p)}},8492:(D,T,h)=>{var p=h(9989),I=h(7283);D.exports=function C(w,E){return null!=w&&I(w,E,p)}},2608:D=>{D.exports=function T(h){return h}},7151:(D,T,h)=>{var p=h(186),I=h(2671),C=Object.prototype,w=C.hasOwnProperty,E=C.propertyIsEnumerable,R=p(function(){return arguments}())?p:function(d){return I(d)&&w.call(d,"callee")&&!E.call(d,"callee")};D.exports=R},1503:D=>{D.exports=Array.isArray},6507:(D,T,h)=>{var p=h(5946),I=h(6231);D.exports=function C(w){return null!=w&&I(w.length)&&!p(w)}},1330:(D,T,h)=>{var p=h(6507),I=h(2671);D.exports=function C(w){return I(w)&&p(w)}},891:(D,T,h)=>{D=h.nmd(D);var p=h(2119),I=h(3580),C=T&&!T.nodeType&&T,w=C&&D&&!D.nodeType&&D,R=w&&w.exports===C?p.Buffer:void 0;D.exports=(R?R.isBuffer:void 0)||I},1973:(D,T,h)=>{var p=h(1172),I=h(8794),C=h(7151),w=h(1503),E=h(6507),R=h(891),d=h(5488),f=h(8159),m=Object.prototype.hasOwnProperty;D.exports=function O(P){if(null==P)return!0;if(E(P)&&(w(P)||"string"==typeof P||"function"==typeof P.splice||R(P)||f(P)||C(P)))return!P.length;var N=I(P);if("[object Map]"==N||"[object Set]"==N)return!P.size;if(d(P))return!p(P).length;for(var M in P)if(m.call(P,M))return!1;return!0}},5946:(D,T,h)=>{var p=h(3337),I=h(5940);D.exports=function d(f){if(!I(f))return!1;var v=p(f);return"[object Function]"==v||"[object GeneratorFunction]"==v||"[object AsyncFunction]"==v||"[object Proxy]"==v}},6231:D=>{D.exports=function h(p){return"number"==typeof p&&p>-1&&p%1==0&&p<=9007199254740991}},3222:(D,T,h)=>{var p=h(7021),I=h(5647),C=h(3597),w=C&&C.isMap,E=w?I(w):p;D.exports=E},5940:D=>{D.exports=function T(h){var p=typeof h;return null!=h&&("object"==p||"function"==p)}},2671:D=>{D.exports=function T(h){return null!=h&&"object"==typeof h}},7614:(D,T,h)=>{var p=h(3337),I=h(9519),C=h(2671),d=Function.prototype.toString,f=Object.prototype.hasOwnProperty,v=d.call(Object);D.exports=function g(y){if(!C(y)||"[object Object]"!=p(y))return!1;var m=I(y);if(null===m)return!0;var O=f.call(m,"constructor")&&m.constructor;return"function"==typeof O&&O instanceof O&&d.call(O)==v}},799:(D,T,h)=>{var p=h(771),I=h(5647),C=h(3597),w=C&&C.isSet,E=w?I(w):p;D.exports=E},248:(D,T,h)=>{var p=h(3337),I=h(1503),C=h(2671);D.exports=function E(R){return"string"==typeof R||!I(R)&&C(R)&&"[object String]"==p(R)}},4129:(D,T,h)=>{var p=h(3337),I=h(2671);D.exports=function w(E){return"symbol"==typeof E||I(E)&&"[object Symbol]"==p(E)}},8159:(D,T,h)=>{var p=h(1083),I=h(5647),C=h(3597),w=C&&C.isTypedArray,E=w?I(w):p;D.exports=E},4235:D=>{D.exports=function T(h){return void 0===h}},118:(D,T,h)=>{var p=h(2271),I=h(1172),C=h(6507);D.exports=function w(E){return C(E)?p(E):I(E)}},6555:(D,T,h)=>{var p=h(2271),I=h(2809),C=h(6507);D.exports=function w(E){return C(E)?p(E,!0):I(E)}},5809:D=>{D.exports=function T(h){var p=null==h?0:h.length;return p?h[p-1]:void 0}},9984:(D,T,h)=>{var p=h(4633),I=h(6517),C=h(2046),w=h(1503);D.exports=function E(R,d){return(w(R)?p:C)(R,I(d,3))}},203:(D,T,h)=>{var p=h(5683),I=h(5184),C=h(6517);D.exports=function w(E,R){var d={};return R=C(R,3),I(E,function(f,v,g){p(d,v,R(f,v,g))}),d}},8176:(D,T,h)=>{var p=h(7308),I=h(1100),C=h(2608);D.exports=function w(E){return E&&E.length?p(E,C,I):void 0}},535:(D,T,h)=>{var p=h(9850);function C(w,E){if("function"!=typeof w||null!=E&&"function"!=typeof E)throw new TypeError("Expected a function");var R=function(){var d=arguments,f=E?E.apply(this,d):d[0],v=R.cache;if(v.has(f))return v.get(f);var g=w.apply(this,d);return R.cache=v.set(f,g)||v,g};return R.cache=new(C.Cache||p),R}C.Cache=p,D.exports=C},567:(D,T,h)=>{var p=h(3842),C=h(4944)(function(w,E,R){p(w,E,R)});D.exports=C},9439:(D,T,h)=>{var p=h(7308),I=h(9069),C=h(2608);D.exports=function w(E){return E&&E.length?p(E,C,I):void 0}},9525:(D,T,h)=>{var p=h(7308),I=h(6517),C=h(9069);D.exports=function w(E,R){return E&&E.length?p(E,I(R,2),C):void 0}},2552:D=>{D.exports=function T(){}},1710:(D,T,h)=>{var p=h(2119);D.exports=function(){return p.Date.now()}},6372:(D,T,h)=>{var p=h(3021),C=h(3975)(function(w,E){return null==w?{}:p(w,E)});D.exports=C},7495:(D,T,h)=>{var p=h(1847),I=h(9222),C=h(5352),w=h(8533);D.exports=function E(R){return C(R)?p(w(R)):I(R)}},361:(D,T,h)=>{var I=h(7509)();D.exports=I},1337:(D,T,h)=>{var p=h(8745),I=h(3132),C=h(6517),w=h(3570),E=h(1503);D.exports=function R(d,f,v){var g=E(d)?p:w,y=arguments.length<3;return g(d,C(f,4),v,y,I)}},5637:(D,T,h)=>{var p=h(1172),I=h(8794),C=h(6507),w=h(248),E=h(2315);D.exports=function f(v){if(null==v)return 0;if(C(v))return w(v)?E(v):v.length;var g=I(v);return"[object Map]"==g||"[object Set]"==g?v.size:p(v).length}},2906:(D,T,h)=>{var p=h(686),I=h(6119),C=h(3269),w=h(3342),E=C(function(R,d){if(null==R)return[];var f=d.length;return f>1&&w(R,d[0],d[1])?d=[]:f>2&&w(d[0],d[1],d[2])&&(d=[d[0]]),I(R,p(d,1),[])});D.exports=E},9975:D=>{D.exports=function T(){return[]}},3580:D=>{D.exports=function T(){return!1}},2232:(D,T,h)=>{var p=h(1467),I=1/0;D.exports=function w(E){return E?(E=p(E))===I||E===-I?17976931348623157e292*(E<0?-1:1):E==E?E:0:0===E?E:0}},4401:(D,T,h)=>{var p=h(2232);D.exports=function I(C){var w=p(C),E=w%1;return w==w?E?w-E:w:0}},1467:(D,T,h)=>{var p=h(3348),I=h(5940),C=h(4129),E=/^[-+]0x[0-9a-f]+$/i,R=/^0b[01]+$/i,d=/^0o[0-7]+$/i,f=parseInt;D.exports=function v(g){if("number"==typeof g)return g;if(C(g))return NaN;if(I(g)){var y="function"==typeof g.valueOf?g.valueOf():g;g=I(y)?y+"":y}if("string"!=typeof g)return 0===g?g:+g;g=p(g);var m=R.test(g);return m||d.test(g)?f(g.slice(2),m?2:8):E.test(g)?NaN:+g}},8067:(D,T,h)=>{var p=h(1989),I=h(6555);D.exports=function C(w){return p(w,I(w))}},3943:(D,T,h)=>{var p=h(3935);D.exports=function I(C){return null==C?"":p(C)}},9416:(D,T,h)=>{var p=h(6837),I=h(8858),C=h(5184),w=h(6517),E=h(9519),R=h(1503),d=h(891),f=h(5946),v=h(5940),g=h(8159);D.exports=function y(m,O,P){var N=R(m),M=N||d(m)||g(m);if(O=w(O,4),null==P){var B=m&&m.constructor;P=M?N?new B:[]:v(m)&&f(B)?I(E(m)):{}}return(M?p:C)(m,function(Y,_,K){return O(P,Y,_,K)}),P}},8921:(D,T,h)=>{var p=h(686),I=h(3269),C=h(707),w=h(1330),E=I(function(R){return C(p(R,1,w,!0))});D.exports=E},1541:(D,T,h)=>{var p=h(3943),I=0;D.exports=function C(w){var E=++I;return p(w)+E}},377:(D,T,h)=>{var p=h(9179),I=h(118);D.exports=function C(w){return null==w?[]:p(w,I(w))}},1617:(D,T,h)=>{var p=h(9719),I=h(8645);D.exports=function C(w,E){return I(w||[],E||[],p)}},5114:(D,T,h)=>{"use strict";const I=h(2186);T.c=class C extends I.LinkedList{constructor(...E){super(...E)}get front(){return this.head}enqueue(E){this.append(E)}dequeue(){return this.removeHead()}}},5341:(D,T,h)=>{"use strict";const I=h(2186);T.K=class C extends I.LinkedList{constructor(...E){super(...E)}get top(){return this.head}get size(){return this.length}push(E){this.prepend(E)}pop(){return this.removeHead()}}},9737:function(D,T){"use strict";var h=this&&this.__spreadArrays||function(){for(var C=0,w=0,E=arguments.length;w<E;w++)C+=arguments[w].length;var R=Array(C),d=0;for(w=0;w<E;w++)for(var f=arguments[w],v=0,g=f.length;v<g;v++,d++)R[d]=f[v];return R};Object.defineProperty(T,"__esModule",{value:!0}),T.StringBuilder=T.String=void 0;var p=function(){function C(){}return C.IsNullOrWhiteSpace=function(w){try{return null==w||"undefined"==w||w.toString().replace(/\s/g,"").length<1}catch(E){return console.log(E),!1}},C.Join=function(w){for(var E=[],R=1;R<arguments.length;R++)E[R-1]=arguments[R];try{var d=E[0];if(Array.isArray(d)||d instanceof Array){for(var f=C.Empty,g=0;g<d.length;g++){var y=d[g];f+=g<d.length-1?y+w:y}return f}if("object"==typeof d){var m=C.Empty,O=d,P=Object.keys(d);return P.forEach(function(M){m+=O[M]+w}),m=m.slice(0,m.length-w.length)}var N=E;return C.join.apply(C,h([w],N))}catch(M){return console.log(M),C.Empty}},C.Format=function(w){for(var E=[],R=1;R<arguments.length;R++)E[R-1]=arguments[R];try{return w.match(C.regexNumber)?C.format(C.regexNumber,w,E):w.match(C.regexObject)?C.format(C.regexObject,w,E,!0):w}catch(d){return console.log(d),C.Empty}},C.format=function(w,E,R,d){return void 0===d&&(d=!1),E.replace(w,function(f,v){var y,g=f.split(":");return g.length>1&&(v=g[0].replace("{",""),f=g[1].replace("}","")),null==(y=d?R[0][v]:R[v])||null==y||f.match(/{\d+}/)||void 0!==(y=C.parsePattern(f,y))&&null!=y?y:C.Empty})},C.parsePattern=function(w,E){switch(w){case"L":return E.toLocaleLowerCase();case"U":return E.toLocaleUpperCase();case"d":if("string"==typeof E)return C.getDisplayDateFromString(E);if(E instanceof Date)return C.Format("{0:00}.{1:00}.{2:0000}",E.getDate(),E.getMonth(),E.getFullYear());break;case"s":if("string"==typeof E)return C.getSortableDateFromString(E);if(E instanceof Date)return C.Format("{0:0000}-{1:00}-{2:00}",E.getFullYear(),E.getMonth(),E.getDate());break;case"n":"string"!=typeof E&&(E=E.toString());var R=E.replace(/,/g,".");if(isNaN(parseFloat(R))||R.length<=3)break;var d=R.split(/[^0-9]+/g),f=d;d.length>1&&(f=[C.join.apply(C,h([""],d.splice(0,d.length-1))),d[d.length-1]]);var v=f[0],g=v.length%3,y=g>0?v.substring(0,g):C.Empty,O=v.substring(g).match(/.{3}/g);return(y=y+"."+C.Join(".",O))+(f.length>1?","+f[1]:"");case"x":return this.decimalToHexString(E);case"X":return this.decimalToHexString(E,!0)}return"number"!=typeof E&&isNaN(E)||isNaN(+w)||C.IsNullOrWhiteSpace(E)?E:C.formatNumber(E,w)},C.decimalToHexString=function(w,E){void 0===E&&(E=!1);var d=parseFloat(w).toString(16);return E?d.toLocaleUpperCase():d},C.getDisplayDateFromString=function(w){var E;if((E=w.split("-")).length<=1)return w;var R=E[E.length-1],d=E[E.length-2],f=E[E.length-3];return(R=(R=R.split("T")[0]).split(" ")[0])+"."+d+"."+f},C.getSortableDateFromString=function(w){var E=w.replace(",","").split(".");if(E.length<=1)return w;var R=E[E.length-1].split(" "),d=C.Empty;R.length>1&&(d=R[R.length-1]);var y=E[E.length-1].split(" ")[0]+"-"+E[E.length-2]+"-"+E[E.length-3];return!C.IsNullOrWhiteSpace(d)&&d.length>1?y+="T"+d:y+="T00:00:00",y},C.formatNumber=function(w,E){var R=E.length,d=w.toString();if(R<=d.length)return d;var f=R-d.length;return new Array(f+=1).join("0")+d},C.join=function(w){for(var E=[],R=1;R<arguments.length;R++)E[R-1]=arguments[R];for(var d=C.Empty,f=0;f<E.length;f++)if(!("string"==typeof E[f]&&C.IsNullOrWhiteSpace(E[f])||"number"!=typeof E[f]&&"string"!=typeof E[f])){var v=""+E[f];d+=v;for(var g=f+1;g<E.length;g++)if(!C.IsNullOrWhiteSpace(E[g])){d+=w,f=g-1;break}}return d},C.regexNumber=/{(\d+(:\w*)?)}/g,C.regexObject=/{(\w+(:\w*)?)}/g,C.Empty="",C}();T.String=p;var I=function(){function C(w){this.Values=[],p.IsNullOrWhiteSpace(w)||(this.Values=new Array(w))}return C.prototype.ToString=function(){return this.Values.join("")},C.prototype.Append=function(w){this.Values.push(w)},C.prototype.AppendLine=function(w){this.Values.push("\r\n"+w)},C.prototype.AppendFormat=function(w){for(var E=[],R=1;R<arguments.length;R++)E[R-1]=arguments[R];this.Values.push(p.Format.apply(p,h([w],E)))},C.prototype.AppendLineFormat=function(w){for(var E=[],R=1;R<arguments.length;R++)E[R-1]=arguments[R];this.Values.push("\r\n"+p.Format.apply(p,h([w],E)))},C.prototype.Clear=function(){this.Values=[]},C}();T.StringBuilder=I},7824:(D,T,h)=>{"use strict";function p(I){for(var C in I)T.hasOwnProperty(C)||(T[C]=I[C])}Object.defineProperty(T,"__esModule",{value:!0}),p(h(5085)),p(h(6243)),p(h(1786)),p(h(225)),p(h(6767)),p(h(345)),p(h(5675)),p(h(6461)),p(h(8802)),p(h(3900)),p(h(8866)),p(h(4655)),p(h(4068)),p(h(3858)),p(h(8237)),p(h(3292))},5085:function(D,T,h){"use strict";var E,p=this&&this.__extends||(E=function(R,d){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var g in v)v.hasOwnProperty(g)&&(f[g]=v[g])})(R,d)},function(R,d){function f(){this.constructor=R}E(R,d),R.prototype=null===d?Object.create(d):(f.prototype=d.prototype,new f)});Object.defineProperty(T,"__esModule",{value:!0});var I=h(5675),C=function(E){function R(d){var f=E.call(this)||this,g=d;return g.trigger&&(f.trigger=g.trigger),g.kick&&(f.kick=g.kick),g.drag&&(f.drag=g.drag),g.on&&(f.on=g.on),f.dragstart=f.dragStart=I.Layout.dragStart,f.dragend=f.dragEnd=I.Layout.dragEnd,f}return p(R,E),R.prototype.trigger=function(d){},R.prototype.kick=function(){},R.prototype.drag=function(){},R.prototype.on=function(d,f){return this},R}(I.Layout);T.LayoutAdaptor=C,T.adaptor=function w(E){return new C(E)}},3292:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var p=h(5675),I=h(6767);T.gridify=function C(R,d,f,v){R.cola.start(0,0,0,10,!1);var g=function w(R,d,f,v){R.forEach(function(y){y.routerNode={name:y.name,bounds:y.bounds.inflate(-f)}}),d.forEach(function(y){y.routerNode={bounds:y.bounds.inflate(-v),children:(void 0!==y.groups?y.groups.map(function(m){return R.length+m.id}):[]).concat(void 0!==y.leaves?y.leaves.map(function(m){return m.index}):[])}});var g=R.concat(d).map(function(y,m){return y.routerNode.id=m,y.routerNode});return new I.GridRouter(g,{getChildren:function(y){return y.children},getBounds:function(y){return y.bounds}},f-v)}(R.cola.nodes(),R.cola.groups(),f,v);return g.routeEdges(R.powerGraph.powerEdges,d,function(y){return y.source.routerNode.id},function(y){return y.target.routerNode.id})},T.powerGraphGridLayout=function E(R,d,f){var v;R.nodes.forEach(function(O,P){return O.index=P}),(new p.Layout).avoidOverlaps(!1).nodes(R.nodes).links(R.links).powerGraphGroups(function(O){(v=O).groups.forEach(function(P){return P.padding=f})});var g=R.nodes.length,y=[],m=R.nodes.slice(0);return m.forEach(function(O,P){return O.index=P}),v.groups.forEach(function(O){var P=O.index=O.id+g;m.push(O),void 0!==O.leaves&&O.leaves.forEach(function(N){return y.push({source:P,target:N.index})}),void 0!==O.groups&&O.groups.forEach(function(N){return y.push({source:P,target:N.id+g})})}),v.powerEdges.forEach(function(O){y.push({source:O.source.index,target:O.target.index})}),(new p.Layout).size(d).nodes(m).links(y).avoidOverlaps(!1).linkDistance(30).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(100,0,0,0,!1),{cola:(new p.Layout).convergenceThreshold(.001).size(d).avoidOverlaps(!0).nodes(R.nodes).links(R.links).groupCompactness(1e-4).linkDistance(30).symmetricDiffLinkLengths(5).powerGraphGroups(function(O){(v=O).groups.forEach(function(P){P.padding=f})}).start(50,0,100,0,!1),powerGraph:v}}},6243:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var p=h(9346),I=h(2487);T.d3adaptor=function C(E){return!E||function w(E){return E.version&&null!==E.version.match(/^3\./)}(E)?new p.D3StyleLayoutAdaptor:new I.D3StyleLayoutAdaptor(E)}},9346:function(D,T,h){"use strict";var E,p=this&&this.__extends||(E=function(R,d){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var g in v)v.hasOwnProperty(g)&&(f[g]=v[g])})(R,d)},function(R,d){function f(){this.constructor=R}E(R,d),R.prototype=null===d?Object.create(d):(f.prototype=d.prototype,new f)});Object.defineProperty(T,"__esModule",{value:!0});var I=h(5675),C=function(E){function R(){var d=E.call(this)||this;d.event=d3.dispatch(I.EventType[I.EventType.start],I.EventType[I.EventType.tick],I.EventType[I.EventType.end]);var f=d;return d.drag=function(){if(!g)var g=d3.behavior.drag().origin(I.Layout.dragOrigin).on("dragstart.d3adaptor",I.Layout.dragStart).on("drag.d3adaptor",function(y){I.Layout.drag(y,d3.event),f.resume()}).on("dragend.d3adaptor",I.Layout.dragEnd);if(!arguments.length)return g;this.call(g)},d}return p(R,E),R.prototype.trigger=function(d){var f={type:I.EventType[d.type],alpha:d.alpha,stress:d.stress};this.event[f.type](f)},R.prototype.kick=function(){var d=this;d3.timer(function(){return E.prototype.tick.call(d)})},R.prototype.on=function(d,f){return this.event.on("string"==typeof d?d:I.EventType[d],f),this},R}(I.Layout);T.D3StyleLayoutAdaptor=C,T.d3adaptor=function w(){return new C}},2487:function(D,T,h){"use strict";var w,p=this&&this.__extends||(w=function(E,R){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,f){d.__proto__=f}||function(d,f){for(var v in f)f.hasOwnProperty(v)&&(d[v]=f[v])})(E,R)},function(E,R){function d(){this.constructor=E}w(E,R),E.prototype=null===R?Object.create(R):(d.prototype=R.prototype,new d)});Object.defineProperty(T,"__esModule",{value:!0});var I=h(5675),C=function(w){function E(R){var d=w.call(this)||this;d.d3Context=R,d.event=R.dispatch(I.EventType[I.EventType.start],I.EventType[I.EventType.tick],I.EventType[I.EventType.end]);var f=d;return d.drag=function(){if(!g)var g=R.drag().subject(I.Layout.dragOrigin).on("start.d3adaptor",I.Layout.dragStart).on("drag.d3adaptor",function(y){I.Layout.drag(y,R.event),f.resume()}).on("end.d3adaptor",I.Layout.dragEnd);if(!arguments.length)return g;arguments[0].call(g)},d}return p(E,w),E.prototype.trigger=function(R){var d={type:I.EventType[R.type],alpha:R.alpha,stress:R.stress};this.event.call(d.type,d)},E.prototype.kick=function(){var R=this,d=this.d3Context.timer(function(){return w.prototype.tick.call(R)&&d.stop()})},E.prototype.on=function(R,d){return this.event.on("string"==typeof R?R:I.EventType[R],d),this},E}(I.Layout);T.D3StyleLayoutAdaptor=C},1786:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var h=function(){function C(){this.locks={}}return C.prototype.add=function(w,E){this.locks[w]=E},C.prototype.clear=function(){this.locks={}},C.prototype.isEmpty=function(){for(var w in this.locks)return!1;return!0},C.prototype.apply=function(w){for(var E in this.locks)w(Number(E),this.locks[E])},C}();T.Locks=h;var p=function(){function C(w,E,R){void 0===R&&(R=null),this.D=E,this.G=R,this.threshold=1e-4,this.numGridSnapNodes=0,this.snapGridSize=100,this.snapStrength=1e3,this.scaleSnapByMaxH=!1,this.random=new I,this.project=null,this.x=w,this.k=w.length;var d=this.n=w[0].length;this.H=new Array(this.k),this.g=new Array(this.k),this.Hd=new Array(this.k),this.a=new Array(this.k),this.b=new Array(this.k),this.c=new Array(this.k),this.d=new Array(this.k),this.e=new Array(this.k),this.ia=new Array(this.k),this.ib=new Array(this.k),this.xtmp=new Array(this.k),this.locks=new h,this.minD=Number.MAX_VALUE;for(var v,f=d;f--;)for(v=d;--v>f;){var g=E[f][v];g>0&&g<this.minD&&(this.minD=g)}for(this.minD===Number.MAX_VALUE&&(this.minD=1),f=this.k;f--;){for(this.g[f]=new Array(d),this.H[f]=new Array(d),v=d;v--;)this.H[f][v]=new Array(d);this.Hd[f]=new Array(d),this.a[f]=new Array(d),this.b[f]=new Array(d),this.c[f]=new Array(d),this.d[f]=new Array(d),this.e[f]=new Array(d),this.ia[f]=new Array(d),this.ib[f]=new Array(d),this.xtmp[f]=new Array(d)}}return C.createSquareMatrix=function(w,E){for(var R=new Array(w),d=0;d<w;++d){R[d]=new Array(w);for(var f=0;f<w;++f)R[d][f]=E(d,f)}return R},C.prototype.offsetDir=function(){for(var w=this,E=new Array(this.k),R=0,d=0;d<this.k;++d){var f=E[d]=this.random.getNextBetween(.01,1)-.5;R+=f*f}return R=Math.sqrt(R),E.map(function(v){return v*(w.minD/R)})},C.prototype.computeDerivatives=function(w){var E=this,R=this.n;if(!(R<1)){for(var d,f=new Array(this.k),v=new Array(this.k),g=new Array(this.k),y=0,m=0;m<R;++m){for(d=0;d<this.k;++d)g[d]=this.g[d][m]=0;for(var O=0;O<R;++O)if(m!==O){for(var P=R;P--;){var N=0;for(d=0;d<this.k;++d){var M=f[d]=w[d][m]-w[d][O];N+=v[d]=M*M}if(N>1e-9)break;var B=this.offsetDir();for(d=0;d<this.k;++d)w[d][O]+=B[d]}var Y=Math.sqrt(N),_=this.D[m][O],K=null!=this.G?this.G[m][O]:1;if(K>1&&Y>_||!isFinite(_)){for(d=0;d<this.k;++d)this.H[d][m][O]=0;continue}K>1&&(K=1);var Q=_*_,ne=2*K*(Y-_)/(Q*Y),X=Y*Y*Y,re=2*-K/(Q*X);for(isFinite(ne)||console.log(ne),d=0;d<this.k;++d)this.g[d][m]+=f[d]*ne,g[d]-=this.H[d][m][O]=re*(X+_*(v[d]-N)+Y*N)}for(d=0;d<this.k;++d)y=Math.max(y,this.H[d][m][m]=g[d])}var U=this.snapGridSize/2,W=this.snapGridSize,V=this.snapStrength/(U*U),H=this.numGridSnapNodes;for(m=0;m<H;++m)for(d=0;d<this.k;++d){var $=this.x[d][m],se=$/W,j=se%1,z=se-j;-U<(M=Math.abs(j)<=.5?$-z*W:$>0?$-(z+1)*W:$-(z-1)*W)&&M<=U&&(this.scaleSnapByMaxH?(this.g[d][m]+=y*V*M,this.H[d][m][m]+=y*V):(this.g[d][m]+=V*M,this.H[d][m][m]+=V))}this.locks.isEmpty()||this.locks.apply(function(fe,ge){for(d=0;d<E.k;++d)E.H[d][fe][fe]+=y,E.g[d][fe]-=y*(ge[d]-w[d][fe])})}},C.dotProd=function(w,E){for(var R=0,d=w.length;d--;)R+=w[d]*E[d];return R},C.rightMultiply=function(w,E,R){for(var d=w.length;d--;)R[d]=C.dotProd(w[d],E)},C.prototype.computeStepSize=function(w){for(var E=0,R=0,d=0;d<this.k;++d)E+=C.dotProd(this.g[d],w[d]),C.rightMultiply(this.H[d],w[d],this.Hd[d]),R+=C.dotProd(w[d],this.Hd[d]);return 0!==R&&isFinite(R)?1*E/R:0},C.prototype.reduceStress=function(){this.computeDerivatives(this.x);for(var w=this.computeStepSize(this.g),E=0;E<this.k;++E)this.takeDescentStep(this.x[E],this.g[E],w);return this.computeStress()},C.copy=function(w,E){for(var R=w.length,d=E[0].length,f=0;f<R;++f)for(var v=0;v<d;++v)E[f][v]=w[f][v]},C.prototype.stepAndProject=function(w,E,R,d){C.copy(w,E),this.takeDescentStep(E[0],R[0],d),this.project&&this.project[0](w[0],w[1],E[0]),this.takeDescentStep(E[1],R[1],d),this.project&&this.project[1](E[0],w[1],E[1]);for(var f=2;f<this.k;f++)this.takeDescentStep(E[f],R[f],d)},C.mApply=function(w,E,R){for(var d=w;d-- >0;)for(var f=E;f-- >0;)R(d,f)},C.prototype.matrixApply=function(w){C.mApply(this.k,this.n,w)},C.prototype.computeNextPosition=function(w,E){var R=this;this.computeDerivatives(w);var d=this.computeStepSize(this.g);if(this.stepAndProject(w,E,this.g,d),this.project){this.matrixApply(function(v,g){return R.e[v][g]=w[v][g]-E[v][g]});var f=this.computeStepSize(this.e);f=Math.max(.2,Math.min(f,1)),this.stepAndProject(w,E,this.e,f)}},C.prototype.run=function(w){for(var E=Number.MAX_VALUE,R=!1;!R&&w-- >0;){var d=this.rungeKutta();R=Math.abs(E/d-1)<this.threshold,E=d}return E},C.prototype.rungeKutta=function(){var w=this;this.computeNextPosition(this.x,this.a),C.mid(this.x,this.a,this.ia),this.computeNextPosition(this.ia,this.b),C.mid(this.x,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d);var E=0;return this.matrixApply(function(R,d){var f=(w.a[R][d]+2*w.b[R][d]+2*w.c[R][d]+w.d[R][d])/6,v=w.x[R][d]-f;E+=v*v,w.x[R][d]=f}),E},C.mid=function(w,E,R){C.mApply(w.length,w[0].length,function(d,f){return R[d][f]=w[d][f]+(E[d][f]-w[d][f])/2})},C.prototype.takeDescentStep=function(w,E,R){for(var d=0;d<this.n;++d)w[d]=w[d]-R*E[d]},C.prototype.computeStress=function(){for(var w=0,E=0,R=this.n-1;E<R;++E)for(var d=E+1,f=this.n;d<f;++d){for(var v=0,g=0;g<this.k;++g){var y=this.x[g][E]-this.x[g][d];v+=y*y}v=Math.sqrt(v);var m=this.D[E][d];if(isFinite(m)){var O=m-v;w+=O*O/(m*m)}}return w},C.zeroDistance=1e-10,C}();T.Descent=p;var I=function(){function C(w){void 0===w&&(w=1),this.seed=w,this.a=214013,this.c=2531011,this.m=2147483648,this.range=32767}return C.prototype.getNext=function(){return this.seed=(this.seed*this.a+this.c)%this.m,(this.seed>>16)/this.range},C.prototype.getNextBetween=function(w,E){return w+this.getNext()*(E-w)},C}();T.PseudoRandom=I},225:function(D,T,h){"use strict";var j,p=this&&this.__extends||(j=function(z,le){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(fe,ge){fe.__proto__=ge}||function(fe,ge){for(var Ee in ge)ge.hasOwnProperty(Ee)&&(fe[Ee]=ge[Ee])})(z,le)},function(z,le){function fe(){this.constructor=z}j(z,le),z.prototype=null===le?Object.create(le):(fe.prototype=le.prototype,new fe)});Object.defineProperty(T,"__esModule",{value:!0});var I=h(4068),C=function j(){};T.Point=C;var w=function j(z,le,fe,ge){this.x1=z,this.y1=le,this.x2=fe,this.y2=ge};T.LineSegment=w;var E=function(j){function z(){return null!==j&&j.apply(this,arguments)||this}return p(z,j),z}(C);function R(j,z,le){return(z.x-j.x)*(le.y-j.y)-(le.x-j.x)*(z.y-j.y)}function d(j,z,le){return R(j,z,le)>0}function f(j,z,le){return R(j,z,le)<0}function O(j,z){var le=z.slice(0);return le.push(z[0]),{rtan:P(j,le),ltan:N(j,le)}}function P(j,z){var fe,ge,Ee,Se,le=z.length-1;if(f(j,z[1],z[0])&&!d(j,z[le-1],z[0]))return 0;for(fe=0,ge=le;;){if(ge-fe==1)return d(j,z[fe],z[ge])?fe:ge;if((Se=f(j,z[(Ee=Math.floor((fe+ge)/2))+1],z[Ee]))&&!d(j,z[Ee-1],z[Ee]))return Ee;d(j,z[fe+1],z[fe])?Se||d(j,z[fe],z[Ee])?ge=Ee:fe=Ee:Se&&f(j,z[fe],z[Ee])?ge=Ee:fe=Ee}}function N(j,z){var fe,ge,Ee,Se,le=z.length-1;if(d(j,z[le-1],z[0])&&!f(j,z[1],z[0]))return 0;for(fe=0,ge=le;;){if(ge-fe==1)return f(j,z[fe],z[ge])?fe:ge;if(Se=f(j,z[(Ee=Math.floor((fe+ge)/2))+1],z[Ee]),d(j,z[Ee-1],z[Ee])&&!Se)return Ee;f(j,z[fe+1],z[fe])?Se?f(j,z[fe],z[Ee])?ge=Ee:fe=Ee:ge=Ee:Se?fe=Ee:d(j,z[fe],z[Ee])?ge=Ee:fe=Ee}}function M(j,z,le,fe,ge,Ee){var ye,Se;Se=fe(j[ye=le(z[0],j)],z);for(var xe=!1;!xe;){for(xe=!0;ye===j.length-1&&(ye=0),!ge(z[Se],j[ye],j[ye+1]);)++ye;for(;0===Se&&(Se=z.length-1),!Ee(j[ye],z[Se],z[Se-1]);)--Se,xe=!1}return{t1:ye,t2:Se}}function Y(j,z){return M(j,z,P,N,d,f)}T.PolyPoint=E,T.isLeft=R,T.ConvexHull=function v(j){var fe,z=j.slice(0).sort(function(ce,ve){return ce.x!==ve.x?ve.x-ce.x:ve.y-ce.y}),le=j.length,Ee=z[0].x;for(fe=1;fe<le&&z[fe].x===Ee;++fe);var ye=fe-1,Se=[];if(Se.push(z[0]),ye===le-1)z[ye].y!==z[0].y&&Se.push(z[ye]);else{var xe,ae=le-1,ue=z[le-1].x;for(fe=le-2;fe>=0&&z[fe].x===ue;fe--);for(xe=fe+1,fe=ye;++fe<=xe;)if(!(R(z[0],z[xe],z[fe])>=0&&fe<xe)){for(;Se.length>1&&!(R(Se[Se.length-2],Se[Se.length-1],z[fe])>0);)Se.length-=1;0!=fe&&Se.push(z[fe])}ae!=xe&&Se.push(z[ae]);var pe=Se.length;for(fe=xe;--fe>=ye;)if(!(R(z[ae],z[ye],z[fe])>=0&&fe>ye)){for(;Se.length>pe&&!(R(Se[Se.length-2],Se[Se.length-1],z[fe])>0);)Se.length-=1;0!=fe&&Se.push(z[fe])}}return Se},T.clockwiseRadialSweep=function g(j,z,le){z.slice(0).sort(function(fe,ge){return Math.atan2(fe.y-j.y,fe.x-j.x)-Math.atan2(ge.y-j.y,ge.x-j.x)}).forEach(le)},T.tangent_PolyPolyC=M,T.LRtangent_PolyPolyC=function B(j,z){var le=Y(z,j);return{t1:le.t2,t2:le.t1}},T.RLtangent_PolyPolyC=Y,T.LLtangent_PolyPolyC=function _(j,z){return M(j,z,N,N,f,f)},T.RRtangent_PolyPolyC=function K(j,z){return M(j,z,P,P,d,d)};var Q=function j(z,le){this.t1=z,this.t2=le};T.BiTangent=Q;var ne=function j(){};T.BiTangents=ne;var X=function(j){function z(){return null!==j&&j.apply(this,arguments)||this}return p(z,j),z}(C);T.TVGPoint=X;var re=function j(z,le,fe,ge){this.id=z,this.polyid=le,this.polyvertid=fe,this.p=ge,ge.vv=this};T.VisibilityVertex=re;var U=function(){function j(z,le){this.source=z,this.target=le}return j.prototype.length=function(){var z=this.source.p.x-this.target.p.x,le=this.source.p.y-this.target.p.y;return Math.sqrt(z*z+le*le)},j}();T.VisibilityEdge=U;var W=function(){function j(z,le){if(this.P=z,this.V=[],this.E=[],le)this.V=le.V.slice(0),this.E=le.E.slice(0);else{for(var fe=z.length,ge=0;ge<fe;ge++){for(var Ee=z[ge],ye=0;ye<Ee.length;++ye){var xe=new re(this.V.length,ge,ye,Ee[ye]);this.V.push(xe),ye>0&&this.E.push(new U(Ee[ye-1].vv,xe))}Ee.length>1&&this.E.push(new U(Ee[0].vv,Ee[Ee.length-1].vv))}for(ge=0;ge<fe-1;ge++){var ae=z[ge];for(ye=ge+1;ye<fe;ye++){var ue=z[ye],pe=V(ae,ue);for(var ce in pe){var ve=pe[ce];this.addEdgeIfVisible(ae[ve.t1],ue[ve.t2],ge,ye)}}}}}return j.prototype.addEdgeIfVisible=function(z,le,fe,ge){this.intersectsPolys(new w(z.x,z.y,le.x,le.y),fe,ge)||this.E.push(new U(z.vv,le.vv))},j.prototype.addPoint=function(z,le){var fe=this.P.length;this.V.push(new re(this.V.length,fe,0,z));for(var ge=0;ge<fe;++ge)if(ge!==le){var Ee=this.P[ge],ye=O(z,Ee);this.addEdgeIfVisible(z,Ee[ye.ltan],le,ge),this.addEdgeIfVisible(z,Ee[ye.rtan],le,ge)}return z.vv},j.prototype.intersectsPolys=function(z,le,fe){for(var ge=0,Ee=this.P.length;ge<Ee;++ge)if(ge!=le&&ge!=fe&&k(z,this.P[ge]).length>0)return!0;return!1},j}();function k(j,z){for(var le=[],fe=1,ge=z.length;fe<ge;++fe){var Ee=I.Rectangle.lineIntersection(j.x1,j.y1,j.x2,j.y2,z[fe-1].x,z[fe-1].y,z[fe].x,z[fe].y);Ee&&le.push(Ee)}return le}function V(j,z){for(var le=j.length-1,fe=z.length-1,ge=new ne,Ee=0;Ee<le;++Ee)for(var ye=0;ye<fe;++ye){var Se=j[0==Ee?le-1:Ee-1],xe=j[Ee],ae=j[Ee+1],ue=z[0==ye?fe-1:ye-1],pe=z[ye],ce=z[ye+1],ve=R(Se,xe,pe),Oe=R(xe,ue,pe),Ye=R(xe,pe,ce),it=R(ue,pe,xe),rr=R(pe,Se,xe),rn=R(pe,xe,ae);ve>=0&&Oe>=0&&Ye<0&&it>=0&&rr>=0&&rn<0?ge.ll=new Q(Ee,ye):ve<=0&&Oe<=0&&Ye>0&&it<=0&&rr<=0&&rn>0?ge.rr=new Q(Ee,ye):ve<=0&&Oe>0&&Ye<=0&&it>=0&&rr<0&&rn>=0?ge.rl=new Q(Ee,ye):ve>=0&&Oe<0&&Ye>=0&&it<=0&&rr>0&&rn<=0&&(ge.lr=new Q(Ee,ye))}return ge}function $(j,z){return!j.every(function(le){return!function H(j,z){for(var le=1,fe=z.length;le<fe;++le)if(f(z[le-1],z[le],j))return!1;return!0}(le,z)})}T.TangentVisibilityGraph=W,T.tangents=V,T.polysOverlap=function se(j,z){if($(j,z)||$(z,j))return!0;for(var le=1,fe=j.length;le<fe;++le){var ge=j[le],Ee=j[le-1];if(k(new w(Ee.x,Ee.y,ge.x,ge.y),z).length>0)return!0}return!1}},6767:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var p=h(4068),I=h(8237),C=h(3858),w=function f(v,g,y){this.id=v,this.rect=g,this.children=y,this.leaf=void 0===y||0===y.length};T.NodeWrapper=w;var E=function f(v,g,y,m,O){void 0===m&&(m=null),void 0===O&&(O=null),this.id=v,this.x=g,this.y=y,this.node=m,this.line=O};T.Vert=E;var R=function(){function f(v,g){this.s=v,this.t=g;var y=f.findMatch(v,g),m=g.slice(0).reverse(),O=f.findMatch(v,m);y.length>=O.length?(this.length=y.length,this.si=y.si,this.ti=y.ti,this.reversed=!1):(this.length=O.length,this.si=O.si,this.ti=g.length-O.ti-O.length,this.reversed=!0)}return f.findMatch=function(v,g){for(var y=v.length,m=g.length,O={length:0,si:-1,ti:-1},P=new Array(y),N=0;N<y;N++){P[N]=new Array(m);for(var M=0;M<m;M++)if(v[N]===g[M]){var B=P[N][M]=0===N||0===M?1:P[N-1][M-1]+1;B>O.length&&(O.length=B,O.si=N-B+1,O.ti=M-B+1)}else P[N][M]=0}return O},f.prototype.getSequence=function(){return this.length>=0?this.s.slice(this.si,this.si+this.length):[]},f}();T.LongestCommonSubsequence=R;var d=function(){function f(v,g,y){var m=this;void 0===y&&(y=12),this.originalnodes=v,this.groupPadding=y,this.leaves=null,this.nodes=v.map(function(X,re){return new w(re,g.getBounds(X),g.getChildren(X))}),this.leaves=this.nodes.filter(function(X){return X.leaf}),this.groups=this.nodes.filter(function(X){return!X.leaf}),this.cols=this.getGridLines("x"),this.rows=this.getGridLines("y"),this.groups.forEach(function(X){return X.children.forEach(function(re){return m.nodes[re].parent=X})}),this.root={children:[]},this.nodes.forEach(function(X){void 0===X.parent&&(X.parent=m.root,m.root.children.push(X.id)),X.ports=[]}),this.backToFront=this.nodes.slice(0),this.backToFront.sort(function(X,re){return m.getDepth(X)-m.getDepth(re)}),this.backToFront.slice(0).reverse().filter(function(X){return!X.leaf}).forEach(function(X){var re=p.Rectangle.empty();X.children.forEach(function(U){return re=re.union(m.nodes[U].rect)}),X.rect=re.inflate(m.groupPadding)});var P=this.midPoints(this.cols.map(function(X){return X.pos})),N=this.midPoints(this.rows.map(function(X){return X.pos})),M=P[0],B=P[P.length-1],Y=N[0],_=N[N.length-1],K=this.rows.map(function(X){return{x1:M,x2:B,y1:X.pos,y2:X.pos}}).concat(N.map(function(X){return{x1:M,x2:B,y1:X,y2:X}})),Q=this.cols.map(function(X){return{x1:X.pos,x2:X.pos,y1:Y,y2:_}}).concat(P.map(function(X){return{x1:X,x2:X,y1:Y,y2:_}})),ne=K.concat(Q);ne.forEach(function(X){return X.verts=[]}),this.verts=[],this.edges=[],K.forEach(function(X){return Q.forEach(function(re){var U=new E(m.verts.length,re.x1,X.y1);X.verts.push(U),re.verts.push(U),m.verts.push(U);for(var W=m.backToFront.length;W-- >0;){var k=m.backToFront[W],V=k.rect,H=Math.abs(U.x-V.cx()),$=Math.abs(U.y-V.cy());if(H<V.width()/2&&$<V.height()/2){U.node=k;break}}})}),ne.forEach(function(X,re){m.nodes.forEach(function($,se){$.rect.lineIntersections(X.x1,X.y1,X.x2,X.y2).forEach(function(j,z){var le=new E(m.verts.length,j.x,j.y,$,X);m.verts.push(le),X.verts.push(le),$.ports.push(le)})});var U=Math.abs(X.y1-X.y2)<.1,W=function($,se){return U?se.x-$.x:se.y-$.y};X.verts.sort(W);for(var k=1;k<X.verts.length;k++){var V=X.verts[k-1],H=X.verts[k];V.node&&V.node===H.node&&V.node.leaf||m.edges.push({source:V.id,target:H.id,length:Math.abs(W(V,H))})}})}return f.prototype.avg=function(v){return v.reduce(function(g,y){return g+y})/v.length},f.prototype.getGridLines=function(v){for(var g=[],y=this.leaves.slice(0,this.leaves.length);y.length>0;){var m=y.filter(function(P){return P.rect["overlap"+v.toUpperCase()](y[0].rect)}),O={nodes:m,pos:this.avg(m.map(function(P){return P.rect["c"+v]()}))};g.push(O),O.nodes.forEach(function(P){return y.splice(y.indexOf(P),1)})}return g.sort(function(P,N){return P.pos-N.pos}),g},f.prototype.getDepth=function(v){for(var g=0;v.parent!==this.root;)g++,v=v.parent;return g},f.prototype.midPoints=function(v){for(var g=v[1]-v[0],y=[v[0]-g/2],m=1;m<v.length;m++)y.push((v[m]+v[m-1])/2);return y.push(v[v.length-1]+g/2),y},f.prototype.findLineage=function(v){var g=[v];do{g.push(v=v.parent)}while(v!==this.root);return g.reverse()},f.prototype.findAncestorPathBetween=function(v,g){for(var y=this.findLineage(v),m=this.findLineage(g),O=0;y[O]===m[O];)O++;return{commonAncestor:y[O-1],lineages:y.slice(O).concat(m.slice(O))}},f.prototype.siblingObstacles=function(v,g){var y=this,m=this.findAncestorPathBetween(v,g),O={};m.lineages.forEach(function(N){return O[N.id]={}});var P=m.commonAncestor.children.filter(function(N){return!(N in O)});return m.lineages.filter(function(N){return N.parent!==m.commonAncestor}).forEach(function(N){return P=P.concat(N.parent.children.filter(function(M){return M!==N.id}))}),P.map(function(N){return y.nodes[N]})},f.getSegmentSets=function(v,g,y){for(var m=[],O=0;O<v.length;O++)for(var P=v[O],N=0;N<P.length;N++)(M=P[N]).edgeid=O,M.i=N,Math.abs(M[1][g]-M[0][g])<.1&&m.push(M);m.sort(function(Q,ne){return Q[0][g]-ne[0][g]});for(var Y=[],_=null,K=0;K<m.length;K++){var M=m[K];(!_||Math.abs(M[0][g]-_.pos)>.1)&&Y.push(_={pos:M[0][g],segments:[]}),_.segments.push(M)}return Y},f.nudgeSegs=function(v,g,y,m,O,P){var N=m.length;if(!(N<=1)){for(var M=m.map(function(k){return new I.Variable(k[0][v])}),B=[],Y=0;Y<N;Y++)for(var _=0;_<N;_++)if(Y!==_){var K=m[Y],ne=K.edgeid,X=m[_].edgeid,re=-1,U=-1;"x"==v?O(ne,X)&&(K[0][g]<K[1][g]?(re=_,U=Y):(re=Y,U=_)):O(ne,X)&&(K[0][g]<K[1][g]?(re=Y,U=_):(re=_,U=Y)),re>=0&&B.push(new I.Constraint(M[re],M[U],P))}new I.Solver(M,B).solve(),M.forEach(function(k,V){var H=m[V],$=k.position();H[0][v]=H[1][v]=$;var se=y[H.edgeid];H.i>0&&(se[H.i-1][1][v]=$),H.i<se.length-1&&(se[H.i+1][0][v]=$)})}},f.nudgeSegments=function(v,g,y,m,O){for(var P=f.getSegmentSets(v,g,y),N=0;N<P.length;N++){for(var M=P[N],B=[],Y=0;Y<M.segments.length;Y++){var _=M.segments[Y];B.push({type:0,s:_,pos:Math.min(_[0][y],_[1][y])}),B.push({type:1,s:_,pos:Math.max(_[0][y],_[1][y])})}B.sort(function(ne,X){return ne.pos-X.pos+ne.type-X.type});var K=[],Q=0;B.forEach(function(ne){0===ne.type?(K.push(ne.s),Q++):Q--,0==Q&&(f.nudgeSegs(g,y,v,K,m,O),K=[])})}},f.prototype.routeEdges=function(v,g,y,m){var O=this,P=v.map(function(B){return O.route(y(B),m(B))}),N=f.orderEdges(P),M=P.map(function(B){return f.makeSegments(B)});return f.nudgeSegments(M,"x","y",N,g),f.nudgeSegments(M,"y","x",N,g),f.unreverseEdges(M,P),M},f.unreverseEdges=function(v,g){v.forEach(function(y,m){g[m].reversed&&(y.reverse(),y.forEach(function(P){P.reverse()}))})},f.angleBetween2Lines=function(v,g){var y=Math.atan2(v[0].y-v[1].y,v[0].x-v[1].x),m=Math.atan2(g[0].y-g[1].y,g[0].x-g[1].x),O=y-m;return(O>Math.PI||O<-Math.PI)&&(O=m-y),O},f.isLeft=function(v,g,y){return(g.x-v.x)*(y.y-v.y)-(g.y-v.y)*(y.x-v.x)<=0},f.getOrder=function(v){for(var g={},y=0;y<v.length;y++){var m=v[y];void 0===g[m.l]&&(g[m.l]={}),g[m.l][m.r]=!0}return function(O,P){return void 0!==g[O]&&g[O][P]}},f.orderEdges=function(v){for(var g=[],y=0;y<v.length-1;y++)for(var m=y+1;m<v.length;m++){var M,B,Y,O=v[y],P=v[m],N=new R(O,P);if(0!==N.length){if(N.reversed&&(P.reverse(),P.reversed=!0,N=new R(O,P)),(N.si<=0||N.ti<=0)&&(N.si+N.length>=O.length||N.ti+N.length>=P.length)){g.push({l:y,r:m});continue}N.si+N.length>=O.length||N.ti+N.length>=P.length?(M=O[N.si+1],Y=O[N.si-1],B=P[N.ti-1]):(M=O[N.si+N.length-2],B=O[N.si+N.length],Y=P[N.ti+N.length]),f.isLeft(M,B,Y)?g.push({l:m,r:y}):g.push({l:y,r:m})}}return f.getOrder(g)},f.makeSegments=function(v){function g(B){return{x:B.x,y:B.y}}for(var m=[],O=g(v[0]),P=1;P<v.length;P++){var N=g(v[P]),M=P<v.length-1?v[P+1]:null;(!M||(B=O,Y=N,_=M,!(Math.abs((Y.x-B.x)*(_.y-B.y)-(Y.y-B.y)*(_.x-B.x))<.001)))&&(m.push([O,N]),O=N)}var B,Y,_;return m},f.prototype.route=function(v,g){var y=this,m=this.nodes[v],O=this.nodes[g];this.obstacles=this.siblingObstacles(m,O);var P={};this.obstacles.forEach(function(U){return P[U.id]=U}),this.passableEdges=this.edges.filter(function(U){var W=y.verts[U.source],k=y.verts[U.target];return!(W.node&&W.node.id in P||k.node&&k.node.id in P)});for(var N=1;N<m.ports.length;N++)this.passableEdges.push({source:m.ports[0].id,target:m.ports[N].id,length:0});for(N=1;N<O.ports.length;N++)this.passableEdges.push({source:O.ports[0].id,target:O.ports[N].id,length:0});var re=new C.Calculator(this.verts.length,this.passableEdges,function(U){return U.source},function(U){return U.target},function(U){return U.length}).PathFromNodeToNodeWithPrevCost(m.ports[0].id,O.ports[0].id,function(U,W,k){var V=y.verts[U],H=y.verts[W],$=y.verts[k],se=Math.abs($.x-V.x),j=Math.abs($.y-V.y);return V.node===m&&V.node===H.node||H.node===O&&H.node===$.node?0:se>1&&j>1?1e3:0}).reverse().map(function(U){return y.verts[U]});return re.push(this.nodes[O.id].ports[0]),re.filter(function(U,W){return!(W<re.length-1&&re[W+1].node===m&&U.node===m||W>0&&U.node===O&&re[W-1].node===O)})},f.getRoutePath=function(v,g,y,m){var N,M,B,se,j,O={routepath:"M "+v[0][0].x+" "+v[0][0].y+" ",arrowpath:""};if(v.length>1)for(var P=0;P<v.length;P++){var Y=(M=(N=v[P])[1].x)-N[0].x,_=(B=N[1].y)-N[0].y;if(P<v.length-1){Math.abs(Y)>0?M-=Y/Math.abs(Y)*g:B-=_/Math.abs(_)*g,O.routepath+="L "+M+" "+B+" ";var K=v[P+1],Q=K[0].x,ne=K[0].y;Y=K[1].x-Q,_=K[1].y-ne;var W,k,U=f.angleBetween2Lines(N,K)<0?1:0;Math.abs(Y)>0?(W=Q+Y/Math.abs(Y)*g,k=ne):(W=Q,k=ne+_/Math.abs(_)*g);var V=Math.abs(W-M),H=Math.abs(k-B);O.routepath+="A "+V+" "+H+" 0 0 "+U+" "+W+" "+k+" "}else{var $=[M,B];Math.abs(Y)>0?(se=[M-=Y/Math.abs(Y)*m,B+y],j=[M,B-y]):(se=[M+y,B-=_/Math.abs(_)*m],j=[M-y,B]),O.routepath+="L "+M+" "+B+" ",m>0&&(O.arrowpath="M "+$[0]+" "+$[1]+" L "+se[0]+" "+se[1]+" L "+j[0]+" "+j[1])}}else Y=(M=(N=v[0])[1].x)-N[0].x,_=(B=N[1].y)-N[0].y,$=[M,B],Math.abs(Y)>0?(se=[M-=Y/Math.abs(Y)*m,B+y],j=[M,B-y]):(se=[M+y,B-=_/Math.abs(_)*m],j=[M-y,B]),O.routepath+="L "+M+" "+B+" ",m>0&&(O.arrowpath="M "+$[0]+" "+$[1]+" L "+se[0]+" "+se[1]+" L "+j[0]+" "+j[1]);return O},f}();T.GridRouter=d},345:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var h_GOLDEN_SECTION=(1+Math.sqrt(5))/2;T.applyPacking=function p(C,w,E,P,O,f){void 0===O&&(O=1),void 0===f&&(f=!0);var y=w,m=E,N=(O=void 0!==O?O:1,P=void 0!==P?P:0,0),M=0,B=0,Y=0,_=[];function X(k,V){_=[],N=0,M=0,Y=0;for(var H=0;H<k.length;H++)re(k[H],V);return Math.abs(function W(){return N/M}()-O)}function re(k,V){for(var H=void 0,$=0;$<_.length;$++)if(_[$].space_left>=k.height&&_[$].x+_[$].width+k.width+10-V<=1e-4){H=_[$];break}_.push(k),void 0!==H?(k.x=H.x+H.width+10,k.y=H.bottom,k.space_left=k.height,k.bottom=k.y,H.space_left-=k.height+10,H.bottom+=k.height+10):(k.y=Y,Y+=k.height+10,k.x=0,k.bottom=k.y,k.space_left=k.height),k.y+k.height-M>-1e-4&&(M=k.y+k.height-0),k.x+k.width-N>-1e-4&&(N=k.x+k.width-0)}0!=C.length&&(function K(k){k.forEach(function(H){!function V(H){var $=Number.MAX_VALUE,se=Number.MAX_VALUE,j=0,z=0;H.array.forEach(function(le){var fe=void 0!==le.width?le.width:P,ge=void 0!==le.height?le.height:P;fe/=2,ge/=2,j=Math.max(le.x+fe,j),$=Math.min(le.x-fe,$),z=Math.max(le.y+ge,z),se=Math.min(le.y-ge,se)}),H.width=j-$,H.height=z-se}(H)})}(C),function ne(k,V){var H=Number.POSITIVE_INFINITY,$=0;k.sort(function(ae,ue){return ue.height-ae.height});for(var se=Se=B=k.reduce(function(ae,ue){return ae.width<ue.width?ae.width:ue.width}),j=xe=function U(k){var V=0;return k.forEach(function(H){return V+=H.width+10}),V}(k),z=0,le=Number.MAX_VALUE,fe=Number.MAX_VALUE,ge=-1,Ee=Number.MAX_VALUE,ye=Number.MAX_VALUE;Ee>B||ye>1e-4;){if(1!=ge){var Se=j-(j-se)/h_GOLDEN_SECTION;le=X(k,Se)}if(0!=ge){var xe=se+(j-se)/h_GOLDEN_SECTION;fe=X(k,xe)}if(Ee=Math.abs(Se-xe),ye=Math.abs(le-fe),le<H&&(H=le,$=Se),fe<H&&(H=fe,$=xe),le>fe?(se=Se,Se=xe,le=fe,ge=1):(j=xe,xe=Se,fe=le,ge=0),z++>100)break}X(k,$)}(C),f&&function Q(k){k.forEach(function(V){var H={x:0,y:0};V.array.forEach(function(j){H.x+=j.x,H.y+=j.y}),H.x/=V.array.length,H.y/=V.array.length;var se_x=V.x-(H.x-V.width/2)+y/2-N/2,se_y=V.y-(H.y-V.height/2)+m/2-M/2;V.array.forEach(function(j){j.x+=se_x,j.y+=se_y})})}(C))},T.separateGraphs=function I(C,w){for(var E={},R={},d=[],f=0,v=0;v<w.length;v++){var g=w[v],y=g.source,m=g.target;R[y.index]?R[y.index].push(m):R[y.index]=[m],R[m.index]?R[m.index].push(y):R[m.index]=[y]}for(v=0;v<C.length;v++){var O=C[v];E[O.index]||P(O,!0)}function P(N,M){if(void 0===E[N.index]){M&&(f++,d.push({array:[]})),E[N.index]=f,d[f-1].array.push(N);var B=R[N.index];if(B)for(var Y=0;Y<B.length;Y++)P(B[Y],!1)}}return d}},5675:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var f,y,p=h(3900),I=h(8802),C=h(1786),w=h(4068),E=h(3858),R=h(225),d=h(345);function v(y){return void 0!==y.leaves||void 0!==y.groups}(y=f=T.EventType||(T.EventType={}))[y.start=0]="start",y[y.tick=1]="tick",y[y.end=2]="end";var g=function(){function y(){var m=this;this._canvasSize=[1,1],this._linkDistance=20,this._defaultNodeSize=10,this._linkLengthCalculator=null,this._linkType=null,this._avoidOverlaps=!1,this._handleDisconnected=!0,this._running=!1,this._nodes=[],this._groups=[],this._rootGroup=null,this._links=[],this._constraints=[],this._distanceMatrix=null,this._descent=null,this._directedLinkConstraints=null,this._threshold=.01,this._visibilityGraph=null,this._groupCompactness=1e-6,this.event=null,this.linkAccessor={getSourceIndex:y.getSourceIndex,getTargetIndex:y.getTargetIndex,setLength:y.setLinkLength,getType:function(O){return"function"==typeof m._linkType?m._linkType(O):0}}}return y.prototype.on=function(m,O){return this.event||(this.event={}),"string"==typeof m?this.event[f[m]]=O:this.event[m]=O,this},y.prototype.trigger=function(m){this.event&&void 0!==this.event[m.type]&&this.event[m.type](m)},y.prototype.kick=function(){for(;!this.tick(););},y.prototype.tick=function(){if(this._alpha<this._threshold)return this._running=!1,this.trigger({type:f.end,alpha:this._alpha=0,stress:this._lastStress}),!0;var P,N,m=this._nodes.length;for(this._descent.locks.clear(),N=0;N<m;++N)(P=this._nodes[N]).fixed&&((void 0===P.px||void 0===P.py)&&(P.px=P.x,P.py=P.y),this._descent.locks.add(N,[P.px,P.py]));var B=this._descent.rungeKutta();return 0===B?this._alpha=0:void 0!==this._lastStress&&(this._alpha=B),this._lastStress=B,this.updateNodePositions(),this.trigger({type:f.tick,alpha:this._alpha,stress:this._lastStress}),!1},y.prototype.updateNodePositions=function(){for(var P,m=this._descent.x[0],O=this._descent.x[1],N=this._nodes.length;N--;)(P=this._nodes[N]).x=m[N],P.y=O[N]},y.prototype.nodes=function(m){if(!m){if(0===this._nodes.length&&this._links.length>0){var O=0;this._links.forEach(function(N){O=Math.max(O,N.source,N.target)}),this._nodes=new Array(++O);for(var P=0;P<O;++P)this._nodes[P]={}}return this._nodes}return this._nodes=m,this},y.prototype.groups=function(m){var O=this;return m?(this._groups=m,this._rootGroup={},this._groups.forEach(function(P){void 0===P.padding&&(P.padding=1),void 0!==P.leaves&&P.leaves.forEach(function(N,M){"number"==typeof N&&((P.leaves[M]=O._nodes[N]).parent=P)}),void 0!==P.groups&&P.groups.forEach(function(N,M){"number"==typeof N&&((P.groups[M]=O._groups[N]).parent=P)})}),this._rootGroup.leaves=this._nodes.filter(function(P){return void 0===P.parent}),this._rootGroup.groups=this._groups.filter(function(P){return void 0===P.parent}),this):this._groups},y.prototype.powerGraphGroups=function(m){var O=p.getGroups(this._nodes,this._links,this.linkAccessor,this._rootGroup);return this.groups(O.groups),m(O),this},y.prototype.avoidOverlaps=function(m){return arguments.length?(this._avoidOverlaps=m,this):this._avoidOverlaps},y.prototype.handleDisconnected=function(m){return arguments.length?(this._handleDisconnected=m,this):this._handleDisconnected},y.prototype.flowLayout=function(m,O){return arguments.length||(m="y"),this._directedLinkConstraints={axis:m,getMinSeparation:"number"==typeof O?function(){return O}:O},this},y.prototype.links=function(m){return arguments.length?(this._links=m,this):this._links},y.prototype.constraints=function(m){return arguments.length?(this._constraints=m,this):this._constraints},y.prototype.distanceMatrix=function(m){return arguments.length?(this._distanceMatrix=m,this):this._distanceMatrix},y.prototype.size=function(m){return m?(this._canvasSize=m,this):this._canvasSize},y.prototype.defaultNodeSize=function(m){return m?(this._defaultNodeSize=m,this):this._defaultNodeSize},y.prototype.groupCompactness=function(m){return m?(this._groupCompactness=m,this):this._groupCompactness},y.prototype.linkDistance=function(m){return m?(this._linkDistance="function"==typeof m?m:+m,this._linkLengthCalculator=null,this):this._linkDistance},y.prototype.linkType=function(m){return this._linkType=m,this},y.prototype.convergenceThreshold=function(m){return m?(this._threshold="function"==typeof m?m:+m,this):this._threshold},y.prototype.alpha=function(m){return arguments.length?(m=+m,this._alpha?this._alpha=m>0?m:0:m>0&&(this._running||(this._running=!0,this.trigger({type:f.start,alpha:this._alpha=m}),this.kick())),this):this._alpha},y.prototype.getLinkLength=function(m){return"function"==typeof this._linkDistance?+this._linkDistance(m):this._linkDistance},y.setLinkLength=function(m,O){m.length=O},y.prototype.getLinkType=function(m){return"function"==typeof this._linkType?this._linkType(m):0},y.prototype.symmetricDiffLinkLengths=function(m,O){var P=this;return void 0===O&&(O=1),this.linkDistance(function(N){return m*N.length}),this._linkLengthCalculator=function(){return I.symmetricDiffLinkLengths(P._links,P.linkAccessor,O)},this},y.prototype.jaccardLinkLengths=function(m,O){var P=this;return void 0===O&&(O=1),this.linkDistance(function(N){return m*N.length}),this._linkLengthCalculator=function(){return I.jaccardLinkLengths(P._links,P.linkAccessor,O)},this},y.prototype.start=function(m,O,P,N,M,B){var Y=this;void 0===m&&(m=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===M&&(M=!0),void 0===B&&(B=!0);var $,Q=this.nodes().length,ne=Q+2*this._groups.length,re=this._canvasSize[0],U=this._canvasSize[1],W=new Array(ne),k=new Array(ne),V=null,H=this._avoidOverlaps;this._nodes.forEach(function(Ee,ye){Ee.index=ye,void 0===Ee.x&&(Ee.x=re/2,Ee.y=U/2),W[ye]=Ee.x,k[ye]=Ee.y}),this._linkLengthCalculator&&this._linkLengthCalculator(),this._distanceMatrix?$=this._distanceMatrix:($=new E.Calculator(ne,this._links,y.getSourceIndex,y.getTargetIndex,function(Ee){return Y.getLinkLength(Ee)}).DistanceMatrix(),V=C.Descent.createSquareMatrix(ne,function(){return 2}),this._links.forEach(function(Ee){"number"==typeof Ee.source&&(Ee.source=Y._nodes[Ee.source]),"number"==typeof Ee.target&&(Ee.target=Y._nodes[Ee.target])}),this._links.forEach(function(Ee){var ye=y.getSourceIndex(Ee),Se=y.getTargetIndex(Ee);V[ye][Se]=V[Se][ye]=Ee.weight||1}));var se=C.Descent.createSquareMatrix(ne,function(Ee,ye){return $[Ee][ye]});if(this._rootGroup&&void 0!==this._rootGroup.groups){var _=Q;this._groups.forEach(function(ye){(function(ye,Se,xe,ae){V[ye][Se]=V[Se][ye]=xe,se[ye][Se]=se[Se][ye]=.1})(_,_+1,Y._groupCompactness),W[_]=0,k[_++]=0,W[_]=0,k[_++]=0})}else this._rootGroup={leaves:this._nodes,groups:[]};var z=this._constraints||[];for(this._directedLinkConstraints&&(this.linkAccessor.getMinSeparation=this._directedLinkConstraints.getMinSeparation,z=z.concat(I.generateDirectedEdgeConstraints(Q,this._links,this._directedLinkConstraints.axis,this.linkAccessor))),this.avoidOverlaps(!1),this._descent=new C.Descent([W,k],se),this._descent.locks.clear(),_=0;_<Q;++_){var le=this._nodes[_];le.fixed&&(le.px=le.x,le.py=le.y,this._descent.locks.add(_,[le.x,le.y]))}if(this._descent.threshold=this._threshold,this.initialLayout(m,W,k),z.length>0&&(this._descent.project=new w.Projection(this._nodes,this._groups,this._rootGroup,z).projectFunctions()),this._descent.run(O),this.separateOverlappingComponents(re,U,B),this.avoidOverlaps(H),H&&(this._nodes.forEach(function(Ee,ye){Ee.x=W[ye],Ee.y=k[ye]}),this._descent.project=new w.Projection(this._nodes,this._groups,this._rootGroup,z,!0).projectFunctions(),this._nodes.forEach(function(Ee,ye){W[ye]=Ee.x,k[ye]=Ee.y})),this._descent.G=V,this._descent.run(P),N){this._descent.snapStrength=1e3,this._descent.snapGridSize=this._nodes[0].width,this._descent.numGridSnapNodes=Q,this._descent.scaleSnapByMaxH=Q!=ne;var ge=C.Descent.createSquareMatrix(ne,function(Ee,ye){return Ee>=Q||ye>=Q?V[Ee][ye]:0});this._descent.G=ge,this._descent.run(N)}return this.updateNodePositions(),this.separateOverlappingComponents(re,U,B),M?this.resume():this},y.prototype.initialLayout=function(m,O,P){if(this._groups.length>0&&m>0){var N=this._nodes.length,M=this._links.map(function(Y){return{source:Y.source.index,target:Y.target.index}}),B=this._nodes.map(function(Y){return{index:Y.index}});this._groups.forEach(function(Y,_){B.push({index:Y.index=N+_})}),this._groups.forEach(function(Y,_){void 0!==Y.leaves&&Y.leaves.forEach(function(K){return M.push({source:Y.index,target:K.index})}),void 0!==Y.groups&&Y.groups.forEach(function(K){return M.push({source:Y.index,target:K.index})})}),(new y).size(this.size()).nodes(B).links(M).avoidOverlaps(!1).linkDistance(this.linkDistance()).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(m,0,0,0,!1),this._nodes.forEach(function(Y){O[Y.index]=B[Y.index].x,P[Y.index]=B[Y.index].y})}else this._descent.run(m)},y.prototype.separateOverlappingComponents=function(m,O,P){var N=this;if(void 0===P&&(P=!0),!this._distanceMatrix&&this._handleDisconnected){var M=this._descent.x[0],B=this._descent.x[1];this._nodes.forEach(function(_,K){_.x=M[K],_.y=B[K]});var Y=d.separateGraphs(this._nodes,this._links);d.applyPacking(Y,m,O,this._defaultNodeSize,1,P),this._nodes.forEach(function(_,K){N._descent.x[0][K]=_.x,N._descent.x[1][K]=_.y,_.bounds&&(_.bounds.setXCentre(_.x),_.bounds.setYCentre(_.y))})}},y.prototype.resume=function(){return this.alpha(.1)},y.prototype.stop=function(){return this.alpha(0)},y.prototype.prepareEdgeRouting=function(m){void 0===m&&(m=0),this._visibilityGraph=new R.TangentVisibilityGraph(this._nodes.map(function(O){return O.bounds.inflate(-m).vertices()}))},y.prototype.routeEdge=function(m,O,P){void 0===O&&(O=5);var N=[],M=new R.TangentVisibilityGraph(this._visibilityGraph.P,{V:this._visibilityGraph.V,E:this._visibilityGraph.E}),B={x:m.source.x,y:m.source.y},Y={x:m.target.x,y:m.target.y},_=M.addPoint(B,m.source.index),K=M.addPoint(Y,m.target.index);M.addEdgeIfVisible(B,Y,m.source.index,m.target.index),void 0!==P&&P(M);var U=new E.Calculator(M.V.length,M.E,function(se){return se.source.id},function(se){return se.target.id},function(se){return se.length()}).PathFromNodeToNode(_.id,K.id);if(1===U.length||U.length===M.V.length){var W=w.makeEdgeBetween(m.source.innerBounds,m.target.innerBounds,O);N=[W.sourceIntersection,W.arrowStart]}else{for(var k=U.length-2,V=M.V[U[k]].p,H=M.V[U[0]].p,$=(N=[m.source.innerBounds.rayIntersection(V.x,V.y)],k);$>=0;--$)N.push(M.V[U[$]].p);N.push(w.makeEdgeTo(H,m.target.innerBounds,O))}return N},y.getSourceIndex=function(m){return"number"==typeof m.source?m.source:m.source.index},y.getTargetIndex=function(m){return"number"==typeof m.target?m.target:m.target.index},y.linkId=function(m){return y.getSourceIndex(m)+"-"+y.getTargetIndex(m)},y.dragStart=function(m){v(m)?y.storeOffset(m,y.dragOrigin(m)):(y.stopNode(m),m.fixed|=2)},y.stopNode=function(m){m.px=m.x,m.py=m.y},y.storeOffset=function(m,O){void 0!==m.leaves&&m.leaves.forEach(function(P){P.fixed|=2,y.stopNode(P),P._dragGroupOffsetX=P.x-O.x,P._dragGroupOffsetY=P.y-O.y}),void 0!==m.groups&&m.groups.forEach(function(P){return y.storeOffset(P,O)})},y.dragOrigin=function(m){return v(m)?{x:m.bounds.cx(),y:m.bounds.cy()}:m},y.drag=function(m,O){v(m)?(void 0!==m.leaves&&m.leaves.forEach(function(P){m.bounds.setXCentre(O.x),m.bounds.setYCentre(O.y),P.px=P._dragGroupOffsetX+O.x,P.py=P._dragGroupOffsetY+O.y}),void 0!==m.groups&&m.groups.forEach(function(P){return y.drag(P,O)})):(m.px=O.x,m.py=O.y)},y.dragEnd=function(m){v(m)?(void 0!==m.leaves&&m.leaves.forEach(function(O){y.dragEnd(O),delete O._dragGroupOffsetX,delete O._dragGroupOffsetY}),void 0!==m.groups&&m.groups.forEach(y.dragEnd)):m.fixed&=-7},y.mouseOver=function(m){m.fixed|=4,m.px=m.x,m.py=m.y},y.mouseOut=function(m){m.fixed&=-5},y}();T.Layout=g},6461:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var p=h(3858),I=h(1786),C=h(4068),w=h(8802),E=function(){function v(g,y){this.source=g,this.target=y}return v.prototype.actualLength=function(g){var y=this;return Math.sqrt(g.reduce(function(m,O){var P=O[y.target]-O[y.source];return m+P*P},0))},v}();T.Link3D=E,T.Node3D=function v(g,y,m){void 0===g&&(g=0),void 0===y&&(y=0),void 0===m&&(m=0),this.x=g,this.y=y,this.z=m};var d=function(){function v(g,y,m){var O=this;void 0===m&&(m=1),this.nodes=g,this.links=y,this.idealLinkLength=m,this.constraints=null,this.useJaccardLinkLengths=!0,this.result=new Array(v.k);for(var P=0;P<v.k;++P)this.result[P]=new Array(g.length);g.forEach(function(N,M){for(var B=0,Y=v.dims;B<Y.length;B++){var _=Y[B];void 0===N[_]&&(N[_]=Math.random())}O.result[0][M]=N.x,O.result[1][M]=N.y,O.result[2][M]=N.z})}return v.prototype.linkLength=function(g){return g.actualLength(this.result)},v.prototype.start=function(g){var y=this;void 0===g&&(g=100);var m=this.nodes.length,O=new f;this.useJaccardLinkLengths&&w.jaccardLinkLengths(this.links,O,1.5),this.links.forEach(function(_){return _.length*=y.idealLinkLength});var P=new p.Calculator(m,this.links,function(_){return _.source},function(_){return _.target},function(_){return _.length}).DistanceMatrix(),N=I.Descent.createSquareMatrix(m,function(_,K){return P[_][K]}),M=I.Descent.createSquareMatrix(m,function(){return 2});this.links.forEach(function(_){var K=_.source,Q=_.target;return M[K][Q]=M[Q][K]=1}),this.descent=new I.Descent(this.result,N),this.descent.threshold=.001,this.descent.G=M,this.constraints&&(this.descent.project=new C.Projection(this.nodes,null,null,this.constraints).projectFunctions());for(var B=0;B<this.nodes.length;B++){var Y=this.nodes[B];Y.fixed&&this.descent.locks.add(B,[Y.x,Y.y,Y.z])}return this.descent.run(g),this},v.prototype.tick=function(){this.descent.locks.clear();for(var g=0;g<this.nodes.length;g++){var y=this.nodes[g];y.fixed&&this.descent.locks.add(g,[y.x,y.y,y.z])}return this.descent.rungeKutta()},v.k=(v.dims=["x","y","z"]).length,v}();T.Layout3D=d;var f=function(){function v(){}return v.prototype.getSourceIndex=function(g){return g.source},v.prototype.getTargetIndex=function(g){return g.target},v.prototype.getLength=function(g){return g.length},v.prototype.setLength=function(g,y){g.length=y},v}()},8802:(D,T)=>{"use strict";function h(f,v){var g={};for(var y in f)g[y]={};for(var y in v)g[y]={};return Object.keys(g).length}function p(f,v){var g=0;for(var y in f)void 0!==v[y]&&++g;return g}function C(f,v,g,y){var m=function I(f,v){var g={},y=function(m,O){void 0===g[m]&&(g[m]={}),g[m][O]={}};return f.forEach(function(m){var O=v.getSourceIndex(m),P=v.getTargetIndex(m);y(O,P),y(P,O)}),g}(f,y);f.forEach(function(O){var P=m[y.getSourceIndex(O)],N=m[y.getTargetIndex(O)];y.setLength(O,1+v*g(P,N))})}function d(f,v,g){var y=[],m=0,O=[],P=[];function N(U){U.index=U.lowlink=m++,O.push(U),U.onStack=!0;for(var W=0,k=U.out;W<k.length;W++){var V=k[W];void 0===V.index?(N(V),U.lowlink=Math.min(U.lowlink,V.lowlink)):V.onStack&&(U.lowlink=Math.min(U.lowlink,V.index))}if(U.lowlink===U.index){for(var H=[];O.length&&((V=O.pop()).onStack=!1,H.push(V),V!==U););P.push(H.map(function($){return $.id}))}}for(var M=0;M<f;M++)y.push({id:M,out:[]});for(var B=0,Y=v;B<Y.length;B++){var _=Y[B],K=y[g.getSourceIndex(_)],Q=y[g.getTargetIndex(_)];K.out.push(Q)}for(var ne=0,X=y;ne<X.length;ne++){var re=X[ne];void 0===re.index&&N(re)}return P}Object.defineProperty(T,"__esModule",{value:!0}),T.symmetricDiffLinkLengths=function w(f,v,g){void 0===g&&(g=1),C(f,g,function(y,m){return Math.sqrt(h(y,m)-p(y,m))},v)},T.jaccardLinkLengths=function E(f,v,g){void 0===g&&(g=1),C(f,g,function(y,m){return Math.min(Object.keys(y).length,Object.keys(m).length)<1.1?0:p(y,m)/h(y,m)},v)},T.generateDirectedEdgeConstraints=function R(f,v,g,y){var m=d(f,v,y),O={};m.forEach(function(N,M){return N.forEach(function(B){return O[B]=M})});var P=[];return v.forEach(function(N){var M=y.getSourceIndex(N),B=y.getTargetIndex(N);O[M]!==O[B]&&P.push({axis:g,left:M,right:B,gap:y.getMinSeparation(N)})}),P},T.stronglyConnectedComponents=d},3900:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var h=function v(g,y,m){this.source=g,this.target=y,this.type=m};T.PowerEdge=h;var p=function(){function v(g,y,m,O){var P=this;if(this.linkAccessor=m,this.modules=new Array(g),this.roots=[],O)this.initModulesFromGroup(O);else{this.roots.push(new E);for(var N=0;N<g;++N)this.roots[0].add(this.modules[N]=new C(N))}this.R=y.length,y.forEach(function(M){var B=P.modules[m.getSourceIndex(M)],Y=P.modules[m.getTargetIndex(M)],_=m.getType(M);B.outgoing.add(_,Y),Y.incoming.add(_,B)})}return v.prototype.initModulesFromGroup=function(g){var y=new E;this.roots.push(y);for(var m=0;m<g.leaves.length;++m){var O=g.leaves[m],P=new C(O.id);this.modules[O.id]=P,y.add(P)}if(g.groups)for(var N=0;N<g.groups.length;++N){var M=g.groups[N],B={};for(var Y in M)"leaves"!==Y&&"groups"!==Y&&M.hasOwnProperty(Y)&&(B[Y]=M[Y]);y.add(new C(-1-N,new R,new R,this.initModulesFromGroup(M),B))}return y},v.prototype.merge=function(g,y,m){void 0===m&&(m=0);var O=g.incoming.intersection(y.incoming),P=g.outgoing.intersection(y.outgoing),N=new E;N.add(g),N.add(y);var M=new C(this.modules.length,P,O,N);this.modules.push(M);var B=function(Y,_,K){Y.forAll(function(Q,ne){Q.forAll(function(X){var re=X[_];re.add(ne,M),re.remove(ne,g),re.remove(ne,y),g[K].remove(ne,X),y[K].remove(ne,X)})})};return B(P,"incoming","outgoing"),B(O,"outgoing","incoming"),this.R-=O.count()+P.count(),this.roots[m].remove(g),this.roots[m].remove(y),this.roots[m].add(M),M},v.prototype.rootMerges=function(g){void 0===g&&(g=0);for(var y=this.roots[g].modules(),m=y.length,O=new Array(m*(m-1)),P=0,N=0,M=m-1;N<M;++N)for(var B=N+1;B<m;++B){var Y=y[N],_=y[B];O[P]={id:P,nEdges:this.nEdges(Y,_),a:Y,b:_},P++}return O},v.prototype.greedyMerge=function(){for(var g=0;g<this.roots.length;++g)if(!(this.roots[g].modules().length<2)){var m=this.rootMerges(g).sort(function(O,P){return O.nEdges==P.nEdges?O.id-P.id:O.nEdges-P.nEdges})[0];if(!(m.nEdges>=this.R))return this.merge(m.a,m.b,g),!0}},v.prototype.nEdges=function(g,y){var m=g.incoming.intersection(y.incoming),O=g.outgoing.intersection(y.outgoing);return this.R-m.count()-O.count()},v.prototype.getGroupHierarchy=function(g){var y=this,m=[];return I(this.roots[0],{},m),this.allEdges().forEach(function(N){var M=y.modules[N.source],B=y.modules[N.target];g.push(new h(void 0===M.gid?N.source:m[M.gid],void 0===B.gid?N.target:m[B.gid],N.type))}),m},v.prototype.allEdges=function(){var g=[];return v.getEdges(this.roots[0],g),g},v.getEdges=function(g,y){g.forAll(function(m){m.getEdges(y),v.getEdges(m.children,y)})},v}();function I(v,g,y){v.forAll(function(m){if(m.isLeaf())g.leaves||(g.leaves=[]),g.leaves.push(m.id);else{var O=g;if(m.gid=y.length,!m.isIsland()||m.isPredefined()){if(O={id:m.gid},m.isPredefined())for(var P in m.definition)O[P]=m.definition[P];g.groups||(g.groups=[]),g.groups.push(m.gid),y.push(O)}I(m.children,O,y)}})}T.Configuration=p;var C=function(){function v(g,y,m,O,P){void 0===y&&(y=new R),void 0===m&&(m=new R),void 0===O&&(O=new E),this.id=g,this.outgoing=y,this.incoming=m,this.children=O,this.definition=P}return v.prototype.getEdges=function(g){var y=this;this.outgoing.forAll(function(m,O){m.forAll(function(P){g.push(new h(y.id,P.id,O))})})},v.prototype.isLeaf=function(){return 0===this.children.count()},v.prototype.isIsland=function(){return 0===this.outgoing.count()&&0===this.incoming.count()},v.prototype.isPredefined=function(){return void 0!==this.definition},v}();T.Module=C;var E=function(){function v(){this.table={}}return v.prototype.count=function(){return Object.keys(this.table).length},v.prototype.intersection=function(g){var y=new v;return y.table=function w(v,g){var y={};for(var m in v)m in g&&(y[m]=v[m]);return y}(this.table,g.table),y},v.prototype.intersectionCount=function(g){return this.intersection(g).count()},v.prototype.contains=function(g){return g in this.table},v.prototype.add=function(g){this.table[g.id]=g},v.prototype.remove=function(g){delete this.table[g.id]},v.prototype.forAll=function(g){for(var y in this.table)g(this.table[y])},v.prototype.modules=function(){var g=[];return this.forAll(function(y){y.isPredefined()||g.push(y)}),g},v}();T.ModuleSet=E;var R=function(){function v(){this.sets={},this.n=0}return v.prototype.count=function(){return this.n},v.prototype.contains=function(g){var y=!1;return this.forAllModules(function(m){!y&&m.id==g&&(y=!0)}),y},v.prototype.add=function(g,y){(g in this.sets?this.sets[g]:this.sets[g]=new E).add(y),++this.n},v.prototype.remove=function(g,y){var m=this.sets[g];m.remove(y),0===m.count()&&delete this.sets[g],--this.n},v.prototype.forAll=function(g){for(var y in this.sets)g(this.sets[y],Number(y))},v.prototype.forAllModules=function(g){this.forAll(function(y,m){return y.forAll(g)})},v.prototype.intersection=function(g){var y=new v;return this.forAll(function(m,O){if(O in g.sets){var P=m.intersection(g.sets[O]),N=P.count();N>0&&(y.sets[O]=P,y.n+=N)}}),y},v}();T.LinkSets=R,T.getGroups=function f(v,g,y,m){for(var P=new p(v.length,g,y,m);P.greedyMerge(););var N=[],M=P.getGroupHierarchy(N);return N.forEach(function(B){var Y=function(_){var K=B[_];"number"==typeof K&&(B[_]=v[K])};Y("source"),Y("target")}),{groups:M,powerEdges:N}}},8866:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var h=function(){function I(C){this.elem=C,this.subheaps=[]}return I.prototype.toString=function(C){for(var w="",E=!1,R=0;R<this.subheaps.length;++R){var d=this.subheaps[R];d.elem?(E&&(w+=","),w+=d.toString(C),E=!0):E=!1}return""!==w&&(w="("+w+")"),(this.elem?C(this.elem):"")+w},I.prototype.forEach=function(C){this.empty()||(C(this.elem,this),this.subheaps.forEach(function(w){return w.forEach(C)}))},I.prototype.count=function(){return this.empty()?0:1+this.subheaps.reduce(function(C,w){return C+w.count()},0)},I.prototype.min=function(){return this.elem},I.prototype.empty=function(){return null==this.elem},I.prototype.contains=function(C){if(this===C)return!0;for(var w=0;w<this.subheaps.length;w++)if(this.subheaps[w].contains(C))return!0;return!1},I.prototype.isHeap=function(C){var w=this;return this.subheaps.every(function(E){return C(w.elem,E.elem)&&E.isHeap(C)})},I.prototype.insert=function(C,w){return this.merge(new I(C),w)},I.prototype.merge=function(C,w){return this.empty()?C:C.empty()?this:w(this.elem,C.elem)?(this.subheaps.push(C),this):(C.subheaps.push(this),C)},I.prototype.removeMin=function(C){return this.empty()?null:this.mergePairs(C)},I.prototype.mergePairs=function(C){if(0==this.subheaps.length)return new I(null);if(1==this.subheaps.length)return this.subheaps[0];var w=this.subheaps.pop().merge(this.subheaps.pop(),C),E=this.mergePairs(C);return w.merge(E,C)},I.prototype.decreaseKey=function(C,w,E,R){var d=C.removeMin(R);C.elem=d.elem,C.subheaps=d.subheaps,null!==E&&null!==d.elem&&E(C.elem,C);var f=new I(w);return null!==E&&E(w,f),this.merge(f,R)},I}();T.PairingHeap=h;var p=function(){function I(C){this.lessThan=C}return I.prototype.top=function(){return this.empty()?null:this.root.elem},I.prototype.push=function(){for(var C=[],w=0;w<arguments.length;w++)C[w]=arguments[w];for(var E,d,R=0;d=C[R];++R)E=new h(d),this.root=this.empty()?E:this.root.merge(E,this.lessThan);return E},I.prototype.empty=function(){return!this.root||!this.root.elem},I.prototype.isHeap=function(){return this.root.isHeap(this.lessThan)},I.prototype.forEach=function(C){this.root.forEach(C)},I.prototype.pop=function(){if(this.empty())return null;var C=this.root.min();return this.root=this.root.removeMin(this.lessThan),C},I.prototype.reduceKey=function(C,w,E){void 0===E&&(E=null),this.root=this.root.decreaseKey(C,w,E,this.lessThan)},I.prototype.toString=function(C){return this.root.toString(C)},I.prototype.count=function(){return this.root.count()},I}();T.PriorityQueue=p},4655:function(D,T){"use strict";var E,h=this&&this.__extends||(E=function(R,d){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var g in v)v.hasOwnProperty(g)&&(f[g]=v[g])})(R,d)},function(R,d){function f(){this.constructor=R}E(R,d),R.prototype=null===d?Object.create(d):(f.prototype=d.prototype,new f)});Object.defineProperty(T,"__esModule",{value:!0});var p=function(){function E(){this.findIter=function(R){for(var d=this._root,f=this.iterator();null!==d;){var v=this._comparator(R,d.data);if(0===v)return f._cursor=d,f;f._ancestors.push(d),d=d.get_child(v>0)}return null}}return E.prototype.clear=function(){this._root=null,this.size=0},E.prototype.find=function(R){for(var d=this._root;null!==d;){var f=this._comparator(R,d.data);if(0===f)return d.data;d=d.get_child(f>0)}return null},E.prototype.lowerBound=function(R){return this._bound(R,this._comparator)},E.prototype.upperBound=function(R){var d=this._comparator;return this._bound(R,function f(v,g){return d(g,v)})},E.prototype.min=function(){var R=this._root;if(null===R)return null;for(;null!==R.left;)R=R.left;return R.data},E.prototype.max=function(){var R=this._root;if(null===R)return null;for(;null!==R.right;)R=R.right;return R.data},E.prototype.iterator=function(){return new I(this)},E.prototype.each=function(R){for(var f,d=this.iterator();null!==(f=d.next());)R(f)},E.prototype.reach=function(R){for(var f,d=this.iterator();null!==(f=d.prev());)R(f)},E.prototype._bound=function(R,d){for(var f=this._root,v=this.iterator();null!==f;){var g=this._comparator(R,f.data);if(0===g)return v._cursor=f,v;v._ancestors.push(f),f=f.get_child(g>0)}for(var y=v._ancestors.length-1;y>=0;--y)if(d(R,(f=v._ancestors[y]).data)>0)return v._cursor=f,v._ancestors.length=y,v;return v._ancestors.length=0,v},E}();T.TreeBase=p;var I=function(){function E(R){this._tree=R,this._ancestors=[],this._cursor=null}return E.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},E.prototype.next=function(){if(null===this._cursor){var R=this._tree._root;null!==R&&this._minNode(R)}else if(null===this._cursor.right){var d;do{if(d=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===d)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return null!==this._cursor?this._cursor.data:null},E.prototype.prev=function(){if(null===this._cursor){var R=this._tree._root;null!==R&&this._maxNode(R)}else if(null===this._cursor.left){var d;do{if(d=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===d)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return null!==this._cursor?this._cursor.data:null},E.prototype._minNode=function(R){for(;null!==R.left;)this._ancestors.push(R),R=R.left;this._cursor=R},E.prototype._maxNode=function(R){for(;null!==R.right;)this._ancestors.push(R),R=R.right;this._cursor=R},E}();T.Iterator=I;var C=function(){function E(R){this.data=R,this.left=null,this.right=null,this.red=!0}return E.prototype.get_child=function(R){return R?this.right:this.left},E.prototype.set_child=function(R,d){R?this.right=d:this.left=d},E}(),w=function(E){function R(d){var f=E.call(this)||this;return f._root=null,f._comparator=d,f.size=0,f}return h(R,E),R.prototype.insert=function(d){var f=!1;if(null===this._root)this._root=new C(d),f=!0,this.size++;else{var v=new C(void 0),g=!1,y=!1,m=null,O=v,P=null,N=this._root;for(O.right=this._root;;){if(null===N?(N=new C(d),P.set_child(g,N),f=!0,this.size++):R.is_red(N.left)&&R.is_red(N.right)&&(N.red=!0,N.left.red=!1,N.right.red=!1),R.is_red(N)&&R.is_red(P)){var M=O.right===m;N===P.get_child(y)?O.set_child(M,R.single_rotate(m,!y)):O.set_child(M,R.double_rotate(m,!y))}var B=this._comparator(N.data,d);if(0===B)break;y=g,null!==m&&(O=m),m=P,P=N,N=N.get_child(g=B<0)}this._root=v.right}return this._root.red=!1,f},R.prototype.remove=function(d){if(null===this._root)return!1;var f=new C(void 0),v=f;v.right=this._root;for(var g=null,y=null,m=null,O=!0;null!==v.get_child(O);){var P=O;y=g,g=v,v=v.get_child(O);var N=this._comparator(d,v.data);if(O=N>0,0===N&&(m=v),!R.is_red(v)&&!R.is_red(v.get_child(O)))if(R.is_red(v.get_child(!O))){var M=R.single_rotate(v,O);g.set_child(P,M),g=M}else if(!R.is_red(v.get_child(!O))){var B=g.get_child(!P);if(null!==B)if(R.is_red(B.get_child(!P))||R.is_red(B.get_child(P))){var Y=y.right===g;R.is_red(B.get_child(P))?y.set_child(Y,R.double_rotate(g,P)):R.is_red(B.get_child(!P))&&y.set_child(Y,R.single_rotate(g,P));var _=y.get_child(Y);_.red=!0,v.red=!0,_.left.red=!1,_.right.red=!1}else g.red=!1,B.red=!0,v.red=!0}}return null!==m&&(m.data=v.data,g.set_child(g.right===v,v.get_child(null===v.left)),this.size--),this._root=f.right,null!==this._root&&(this._root.red=!1),null!==m},R.is_red=function(d){return null!==d&&d.red},R.single_rotate=function(d,f){var v=d.get_child(!f);return d.set_child(!f,v.get_child(f)),v.set_child(f,d),d.red=!0,v.red=!1,v},R.double_rotate=function(d,f){return d.set_child(!f,R.single_rotate(d.get_child(!f),!f)),R.single_rotate(d,f)},R}(p);T.RBTree=w},4068:function(D,T,h){"use strict";var U,p=this&&this.__extends||(U=function(W,k){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,H){V.__proto__=H}||function(V,H){for(var $ in H)H.hasOwnProperty($)&&(V[$]=H[$])})(W,k)},function(W,k){function V(){this.constructor=W}U(W,k),W.prototype=null===k?Object.create(k):(V.prototype=k.prototype,new V)});Object.defineProperty(T,"__esModule",{value:!0});var I=h(8237),C=h(4655);function w(U){return U.bounds=void 0!==U.leaves?U.leaves.reduce(function(W,k){return k.bounds.union(W)},E.empty()):E.empty(),void 0!==U.groups&&(U.bounds=U.groups.reduce(function(W,k){return w(k).union(W)},U.bounds)),U.bounds=U.bounds.inflate(U.padding),U.bounds}T.computeGroupBounds=w;var E=function(){function U(W,k,V,H){this.x=W,this.X=k,this.y=V,this.Y=H}return U.empty=function(){return new U(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},U.prototype.cx=function(){return(this.x+this.X)/2},U.prototype.cy=function(){return(this.y+this.Y)/2},U.prototype.overlapX=function(W){var k=this.cx(),V=W.cx();return k<=V&&W.x<this.X?this.X-W.x:V<=k&&this.x<W.X?W.X-this.x:0},U.prototype.overlapY=function(W){var k=this.cy(),V=W.cy();return k<=V&&W.y<this.Y?this.Y-W.y:V<=k&&this.y<W.Y?W.Y-this.y:0},U.prototype.setXCentre=function(W){var k=W-this.cx();this.x+=k,this.X+=k},U.prototype.setYCentre=function(W){var k=W-this.cy();this.y+=k,this.Y+=k},U.prototype.width=function(){return this.X-this.x},U.prototype.height=function(){return this.Y-this.y},U.prototype.union=function(W){return new U(Math.min(this.x,W.x),Math.max(this.X,W.X),Math.min(this.y,W.y),Math.max(this.Y,W.Y))},U.prototype.lineIntersections=function(W,k,V,H){for(var $=[[this.x,this.y,this.X,this.y],[this.X,this.y,this.X,this.Y],[this.X,this.Y,this.x,this.Y],[this.x,this.Y,this.x,this.y]],se=[],j=0;j<4;++j){var z=U.lineIntersection(W,k,V,H,$[j][0],$[j][1],$[j][2],$[j][3]);null!==z&&se.push({x:z.x,y:z.y})}return se},U.prototype.rayIntersection=function(W,k){var V=this.lineIntersections(this.cx(),this.cy(),W,k);return V.length>0?V[0]:null},U.prototype.vertices=function(){return[{x:this.x,y:this.y},{x:this.X,y:this.y},{x:this.X,y:this.Y},{x:this.x,y:this.Y}]},U.lineIntersection=function(W,k,V,H,$,se,j,z){var le=V-W,fe=j-$,ge=H-k,Ee=z-se,ye=Ee*le-fe*ge;if(0==ye)return null;var Se=W-$,xe=k-se,ue=(fe*xe-Ee*Se)/ye,ce=(le*xe-ge*Se)/ye;return ue>=0&&ue<=1&&ce>=0&&ce<=1?{x:W+ue*le,y:k+ue*ge}:null},U.prototype.inflate=function(W){return new U(this.x-W,this.X+W,this.y-W,this.Y+W)},U}();T.Rectangle=E,T.makeEdgeBetween=function R(U,W,k){var V=U.rayIntersection(W.cx(),W.cy())||{x:U.cx(),y:U.cy()},H=W.rayIntersection(U.cx(),U.cy())||{x:W.cx(),y:W.cy()},$=H.x-V.x,se=H.y-V.y,j=Math.sqrt($*$+se*se),z=j-k;return{sourceIntersection:V,targetIntersection:H,arrowStart:{x:V.x+z*$/j,y:V.y+z*se/j}}},T.makeEdgeTo=function d(U,W,k){var V=W.rayIntersection(U.x,U.y);V||(V={x:W.cx(),y:W.cy()});var H=V.x-U.x,$=V.y-U.y,se=Math.sqrt(H*H+$*$);return{x:V.x-k*H/se,y:V.y-k*$/se}};var f=function U(W,k,V){this.v=W,this.r=k,this.pos=V,this.prev=y(),this.next=y()},v=function U(W,k,V){this.isOpen=W,this.v=k,this.pos=V};function g(U,W){return U.pos>W.pos?1:U.pos<W.pos||U.isOpen?-1:W.isOpen?1:0}function y(){return new C.RBTree(function(U,W){return U.pos-W.pos})}var m={getCentre:function(U){return U.cx()},getOpen:function(U){return U.y},getClose:function(U){return U.Y},getSize:function(U){return U.width()},makeRect:function(U,W,k,V){return new E(k-V/2,k+V/2,U,W)},findNeighbours:function M(U,W){var k=function(V,H){for(var se,$=W.findIter(U);null!==(se=$[V]());){var j=se.r.overlapX(U.r);if((j<=0||j<=se.r.overlapY(U.r))&&(U[V].insert(se),se[H].insert(U)),j<=0)break}};k("next","prev"),k("prev","next")}},O={getCentre:function(U){return U.cy()},getOpen:function(U){return U.x},getClose:function(U){return U.X},getSize:function(U){return U.height()},makeRect:function(U,W,k,V){return new E(U,W,k-V/2,k+V/2)},findNeighbours:function B(U,W){var k=function(V,H){var $=W.findIter(U)[V]();null!==$&&$.r.overlapX(U.r)>0&&(U[V].insert($),$[H].insert(U))};k("next","prev"),k("prev","next")}};function P(U,W,k,V){void 0===V&&(V=!1);var H=U.padding,$=void 0!==U.groups?U.groups.length:0,se=void 0!==U.leaves?U.leaves.length:0,j=$?U.groups.reduce(function(Oe,Ye){return Oe.concat(P(Ye,W,k,!0))},[]):[],z=(V?2:0)+se+$,le=new Array(z),fe=new Array(z),ge=0,Ee=function(Oe,Ye){fe[ge]=Oe,le[ge++]=Ye};if(V){var ye=U.bounds,Se=W.getCentre(ye),xe=W.getSize(ye)/2,ae=W.getOpen(ye),ue=W.getClose(ye),pe=Se-xe+H/2,ce=Se+xe-H/2;U.minVar.desiredPosition=pe,Ee(W.makeRect(ae,ue,pe,H),U.minVar),U.maxVar.desiredPosition=ce,Ee(W.makeRect(ae,ue,ce,H),U.maxVar)}se&&U.leaves.forEach(function(Oe){return Ee(Oe.bounds,Oe.variable)}),$&&U.groups.forEach(function(Oe){var Ye=Oe.bounds;Ee(W.makeRect(W.getOpen(Ye),W.getClose(Ye),W.getCentre(Ye),W.getSize(Ye)),Oe.minVar)});var ve=N(fe,le,W,k);return $&&(le.forEach(function(Oe){Oe.cOut=[],Oe.cIn=[]}),ve.forEach(function(Oe){Oe.left.cOut.push(Oe),Oe.right.cIn.push(Oe)}),U.groups.forEach(function(Oe){var Ye=(Oe.padding-W.getSize(Oe.bounds))/2;Oe.minVar.cIn.forEach(function(it){return it.gap+=Ye}),Oe.minVar.cOut.forEach(function(it){it.left=Oe.maxVar,it.gap+=Ye})})),j.concat(ve)}function N(U,W,k,V){var H,$=U.length,se=2*$;console.assert(W.length>=$);var j=new Array(se);for(H=0;H<$;++H){var z=U[H],le=new f(W[H],z,k.getCentre(z));j[H]=new v(!0,le,k.getOpen(z)),j[H+$]=new v(!1,le,k.getClose(z))}j.sort(g);var fe=new Array,ge=y();for(H=0;H<se;++H){var Ee=j[H];if(le=Ee.v,Ee.isOpen)ge.insert(le),k.findNeighbours(le,ge);else{ge.remove(le);var ye=function(ae,ue){var pe=(k.getSize(ae.r)+k.getSize(ue.r))/2+V;fe.push(new I.Constraint(ae.v,ue.v,pe))},Se=function(ae,ue,pe){for(var ce,ve=le[ae].iterator();null!==(ce=ve[ae]());)pe(ce,le),ce[ue].remove(le)};Se("prev","next",function(ae,ue){return ye(ae,ue)}),Se("next","prev",function(ae,ue){return ye(ue,ae)})}}return console.assert(0===ge.size),fe}function Y(U,W){return N(U,W,m,1e-6)}function _(U,W){return N(U,W,O,1e-6)}function K(U){return P(U,m,1e-6)}function Q(U){return P(U,O,1e-6)}T.generateXConstraints=Y,T.generateYConstraints=_,T.generateXGroupConstraints=K,T.generateYGroupConstraints=Q,T.removeOverlaps=function ne(U){var W=U.map(function(H){return new I.Variable(H.cx())}),k=Y(U,W),V=new I.Solver(W,k);V.solve(),W.forEach(function(H,$){return U[$].setXCentre(H.position())}),W=U.map(function(H){return new I.Variable(H.cy())}),k=_(U,W),(V=new I.Solver(W,k)).solve(),W.forEach(function(H,$){return U[$].setYCentre(H.position())})};var X=function(U){function W(k,V){var H=U.call(this,0,V)||this;return H.index=k,H}return p(W,U),W}(I.Variable);T.IndexedVariable=X;var re=function(){function U(W,k,V,H,$){var se=this;if(void 0===V&&(V=null),void 0===H&&(H=null),void 0===$&&($=!1),this.nodes=W,this.groups=k,this.rootGroup=V,this.avoidOverlaps=$,this.variables=W.map(function(z,le){return z.variable=new X(le,1)}),H&&this.createConstraints(H),$&&V&&void 0!==V.groups){W.forEach(function(z){if(z.width&&z.height){var le=z.width/2,fe=z.height/2;z.bounds=new E(z.x-le,z.x+le,z.y-fe,z.y+fe)}else z.bounds=new E(z.x,z.x,z.y,z.y)}),w(V);var j=W.length;k.forEach(function(z){se.variables[j]=z.minVar=new X(j++,void 0!==z.stiffness?z.stiffness:.01),se.variables[j]=z.maxVar=new X(j++,void 0!==z.stiffness?z.stiffness:.01)})}}return U.prototype.createSeparation=function(W){return new I.Constraint(this.nodes[W.left].variable,this.nodes[W.right].variable,W.gap,void 0!==W.equality&&W.equality)},U.prototype.makeFeasible=function(W){var k=this;if(this.avoidOverlaps){var V="x",H="width";"x"===W.axis&&(V="y",H="height");var $=W.offsets.map(function(j){return k.nodes[j.node]}).sort(function(j,z){return j[V]-z[V]}),se=null;$.forEach(function(j){if(se){var z=se[V]+se[H];z>j[V]&&(j[V]=z)}se=j})}},U.prototype.createAlignment=function(W){var k=this,V=this.nodes[W.offsets[0].node].variable;this.makeFeasible(W);var H="x"===W.axis?this.xConstraints:this.yConstraints;W.offsets.slice(1).forEach(function($){H.push(new I.Constraint(V,k.nodes[$.node].variable,$.offset,!0))})},U.prototype.createConstraints=function(W){var k=this,V=function(H){return void 0===H.type||"separation"===H.type};this.xConstraints=W.filter(function(H){return"x"===H.axis&&V(H)}).map(function(H){return k.createSeparation(H)}),this.yConstraints=W.filter(function(H){return"y"===H.axis&&V(H)}).map(function(H){return k.createSeparation(H)}),W.filter(function(H){return"alignment"===H.type}).forEach(function(H){return k.createAlignment(H)})},U.prototype.setupVariablesAndBounds=function(W,k,V,H){this.nodes.forEach(function($,se){$.fixed?($.variable.weight=$.fixedWeight?$.fixedWeight:1e3,V[se]=H($)):$.variable.weight=1;var j=($.width||0)/2,z=($.height||0)/2,le=W[se],fe=k[se];$.bounds=new E(le-j,le+j,fe-z,fe+z)})},U.prototype.xProject=function(W,k,V){!this.rootGroup&&!this.avoidOverlaps&&!this.xConstraints||this.project(W,k,W,V,function(H){return H.px},this.xConstraints,K,function(H){return H.bounds.setXCentre(V[H.variable.index]=H.variable.position())},function(H){var $=V[H.minVar.index]=H.minVar.position(),se=V[H.maxVar.index]=H.maxVar.position(),j=H.padding/2;H.bounds.x=$-j,H.bounds.X=se+j})},U.prototype.yProject=function(W,k,V){!this.rootGroup&&!this.yConstraints||this.project(W,k,k,V,function(H){return H.py},this.yConstraints,Q,function(H){return H.bounds.setYCentre(V[H.variable.index]=H.variable.position())},function(H){var $=V[H.minVar.index]=H.minVar.position(),se=V[H.maxVar.index]=H.maxVar.position(),j=H.padding/2;H.bounds.y=$-j,H.bounds.Y=se+j})},U.prototype.projectFunctions=function(){var W=this;return[function(k,V,H){return W.xProject(k,V,H)},function(k,V,H){return W.yProject(k,V,H)}]},U.prototype.project=function(W,k,V,H,$,se,j,z,le){this.setupVariablesAndBounds(W,k,H,$),this.rootGroup&&this.avoidOverlaps&&(w(this.rootGroup),se=se.concat(j(this.rootGroup))),this.solve(this.variables,se,V,H),this.nodes.forEach(z),this.rootGroup&&this.avoidOverlaps&&(this.groups.forEach(le),w(this.rootGroup))},U.prototype.solve=function(W,k,V,H){var $=new I.Solver(W,k);$.setStartingPositions(V),$.setDesiredPositions(H),$.solve()},U}();T.Projection=re},3858:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var p=h(8866),I=function R(d,f){this.id=d,this.distance=f},C=function R(d){this.id=d,this.neighbours=[]},w=function R(d,f,v){this.node=d,this.prev=f,this.d=v},E=function(){function R(d,f,v,g,y){this.n=d,this.es=f,this.neighbours=new Array(this.n);for(var m=this.n;m--;)this.neighbours[m]=new C(m);for(m=this.es.length;m--;){var O=this.es[m],P=v(O),N=g(O),M=y(O);this.neighbours[P].neighbours.push(new I(N,M)),this.neighbours[N].neighbours.push(new I(P,M))}}return R.prototype.DistanceMatrix=function(){for(var d=new Array(this.n),f=0;f<this.n;++f)d[f]=this.dijkstraNeighbours(f);return d},R.prototype.DistancesFromNode=function(d){return this.dijkstraNeighbours(d)},R.prototype.PathFromNodeToNode=function(d,f){return this.dijkstraNeighbours(d,f)},R.prototype.PathFromNodeToNodeWithPrevCost=function(d,f,v){var g=new p.PriorityQueue(function(Q,ne){return Q.d<=ne.d}),y=this.neighbours[d],m=new w(y,null,0),O={};for(g.push(m);!g.empty()&&(y=(m=g.pop()).node).id!==f;)for(var P=y.neighbours.length;P--;){var N=y.neighbours[P],M=this.neighbours[N.id];if(!m.prev||M.id!==m.prev.node.id){var B=M.id+","+y.id;if(!(B in O&&O[B]<=m.d)){var Y=m.prev?v(m.prev.node.id,y.id,M.id):0,_=m.d+N.distance+Y;O[B]=_,g.push(new w(M,m,_))}}}for(var K=[];m.prev;)K.push((m=m.prev).node.id);return K},R.prototype.dijkstraNeighbours=function(d,f){void 0===f&&(f=-1);for(var v=new p.PriorityQueue(function(Y,_){return Y.d<=_.d}),g=this.neighbours.length,y=new Array(g);g--;){var m=this.neighbours[g];m.d=g===d?0:Number.POSITIVE_INFINITY,m.q=v.push(m)}for(;!v.empty();){var O=v.pop();if(y[O.id]=O.d,O.id===f){for(var P=[],N=O;void 0!==N.prev;)P.push(N.prev.id),N=N.prev;return P}for(g=O.neighbours.length;g--;){var M=O.neighbours[g],B=(N=this.neighbours[M.id],O.d+M.distance);O.d!==Number.MAX_VALUE&&N.d>B&&(N.d=B,N.prev=O,v.reduceKey(N.q,N,function(_,K){return _.q=K}))}}return y},R}();T.Calculator=E},8237:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var h=function(){function d(f){this.scale=f,this.AB=0,this.AD=0,this.A2=0}return d.prototype.addVariable=function(f){var v=this.scale/f.scale,y=f.weight;this.AB+=y*v*(f.offset/f.scale),this.AD+=y*v*f.desiredPosition,this.A2+=y*v*v},d.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},d}();T.PositionStats=h;var p=function(){function d(f,v,g,y){void 0===y&&(y=!1),this.left=f,this.right=v,this.gap=g,this.equality=y,this.active=!1,this.unsatisfiable=!1,this.left=f,this.right=v,this.gap=g,this.equality=y}return d.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},d}();T.Constraint=p;var I=function(){function d(f,v,g){void 0===v&&(v=1),void 0===g&&(g=1),this.desiredPosition=f,this.weight=v,this.scale=g,this.offset=0}return d.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},d.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},d.prototype.visitNeighbours=function(f,v){var g=function(y,m){return y.active&&f!==m&&v(y,m)};this.cOut.forEach(function(y){return g(y,y.right)}),this.cIn.forEach(function(y){return g(y,y.left)})},d}();T.Variable=I;var C=function(){function d(f){this.vars=[],f.offset=0,this.ps=new h(f.scale),this.addVariable(f)}return d.prototype.addVariable=function(f){f.block=this,this.vars.push(f),this.ps.addVariable(f),this.posn=this.ps.getPosn()},d.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var f=0,v=this.vars.length;f<v;++f)this.ps.addVariable(this.vars[f]);this.posn=this.ps.getPosn()},d.prototype.compute_lm=function(f,v,g){var y=this,m=f.dfdv();return f.visitNeighbours(v,function(O,P){var N=y.compute_lm(P,f,g);P===O.right?(m+=N*O.left.scale,O.lm=N):(m+=N*O.right.scale,O.lm=-N),g(O)}),m/f.scale},d.prototype.populateSplitBlock=function(f,v){var g=this;f.visitNeighbours(v,function(y,m){m.offset=f.offset+(m===y.right?y.gap:-y.gap),g.addVariable(m),g.populateSplitBlock(m,f)})},d.prototype.traverse=function(f,v,g,y){var m=this;void 0===g&&(g=this.vars[0]),void 0===y&&(y=null),g.visitNeighbours(y,function(O,P){v.push(f(O)),m.traverse(f,v,P,g)})},d.prototype.findMinLM=function(){var f=null;return this.compute_lm(this.vars[0],null,function(v){!v.equality&&(null===f||v.lm<f.lm)&&(f=v)}),f},d.prototype.findMinLMBetween=function(f,v){this.compute_lm(f,null,function(){});var g=null;return this.findPath(f,null,v,function(y,m){!y.equality&&y.right===m&&(null===g||y.lm<g.lm)&&(g=y)}),g},d.prototype.findPath=function(f,v,g,y){var m=this,O=!1;return f.visitNeighbours(v,function(P,N){!O&&(N===g||m.findPath(N,f,g,y))&&(O=!0,y(P,N))}),O},d.prototype.isActiveDirectedPathBetween=function(f,v){if(f===v)return!0;for(var g=f.cOut.length;g--;){var y=f.cOut[g];if(y.active&&this.isActiveDirectedPathBetween(y.right,v))return!0}return!1},d.split=function(f){return f.active=!1,[d.createSplitBlock(f.left),d.createSplitBlock(f.right)]},d.createSplitBlock=function(f){var v=new d(f);return v.populateSplitBlock(f,null),v},d.prototype.splitBetween=function(f,v){var g=this.findMinLMBetween(f,v);if(null!==g){var y=d.split(g);return{constraint:g,lb:y[0],rb:y[1]}}return null},d.prototype.mergeAcross=function(f,v,g){v.active=!0;for(var y=0,m=f.vars.length;y<m;++y){var O=f.vars[y];O.offset+=g,this.addVariable(O)}this.posn=this.ps.getPosn()},d.prototype.cost=function(){for(var f=0,v=this.vars.length;v--;){var g=this.vars[v],y=g.position()-g.desiredPosition;f+=y*y*g.weight}return f},d}();T.Block=C;var w=function(){function d(f){this.vs=f;var v=f.length;for(this.list=new Array(v);v--;){var g=new C(f[v]);this.list[v]=g,g.blockInd=v}}return d.prototype.cost=function(){for(var f=0,v=this.list.length;v--;)f+=this.list[v].cost();return f},d.prototype.insert=function(f){f.blockInd=this.list.length,this.list.push(f)},d.prototype.remove=function(f){var v=this.list.length-1,g=this.list[v];this.list.length=v,f!==g&&(this.list[f.blockInd]=g,g.blockInd=f.blockInd)},d.prototype.merge=function(f){var v=f.left.block,g=f.right.block,y=f.right.offset-f.left.offset-f.gap;v.vars.length<g.vars.length?(g.mergeAcross(v,f,y),this.remove(v)):(v.mergeAcross(g,f,-y),this.remove(g))},d.prototype.forEach=function(f){this.list.forEach(f)},d.prototype.updateBlockPositions=function(){this.list.forEach(function(f){return f.updateWeightedPosition()})},d.prototype.split=function(f){var v=this;this.updateBlockPositions(),this.list.forEach(function(g){var y=g.findMinLM();null!==y&&y.lm<E.LAGRANGIAN_TOLERANCE&&(g=y.left.block,C.split(y).forEach(function(m){return v.insert(m)}),v.remove(g),f.push(y))})},d}();T.Blocks=w;var E=function(){function d(f,v){this.vs=f,this.cs=v,this.vs=f,f.forEach(function(g){g.cIn=[],g.cOut=[]}),this.cs=v,v.forEach(function(g){g.left.cOut.push(g),g.right.cIn.push(g)}),this.inactive=v.map(function(g){return g.active=!1,g}),this.bs=null}return d.prototype.cost=function(){return this.bs.cost()},d.prototype.setStartingPositions=function(f){this.inactive=this.cs.map(function(v){return v.active=!1,v}),this.bs=new w(this.vs),this.bs.forEach(function(v,g){return v.posn=f[g]})},d.prototype.setDesiredPositions=function(f){this.vs.forEach(function(v,g){return v.desiredPosition=f[g]})},d.prototype.mostViolated=function(){for(var f=Number.MAX_VALUE,v=null,g=this.inactive,y=g.length,m=y,O=0;O<y;++O){var P=g[O];if(!P.unsatisfiable){var N=P.slack();if((P.equality||N<f)&&(f=N,v=P,m=O,P.equality))break}}return m!==y&&(f<d.ZERO_UPPERBOUND&&!v.active||v.equality)&&(g[m]=g[y-1],g.length=y-1),v},d.prototype.satisfy=function(){null==this.bs&&(this.bs=new w(this.vs)),this.bs.split(this.inactive);for(var f=null;(f=this.mostViolated())&&(f.equality||f.slack()<d.ZERO_UPPERBOUND&&!f.active);){var v=f.left.block;if(v!==f.right.block)this.bs.merge(f);else{if(v.isActiveDirectedPathBetween(f.right,f.left)){f.unsatisfiable=!0;continue}var y=v.splitBetween(f.left,f.right);if(null===y){f.unsatisfiable=!0;continue}this.bs.insert(y.lb),this.bs.insert(y.rb),this.bs.remove(v),this.inactive.push(y.constraint),f.slack()>=0?this.inactive.push(f):this.bs.merge(f)}}},d.prototype.solve=function(){this.satisfy();for(var f=Number.MAX_VALUE,v=this.bs.cost();Math.abs(f-v)>1e-4;)this.satisfy(),f=v,v=this.bs.cost();return v},d.LAGRANGIAN_TOLERANCE=-1e-4,d.ZERO_UPPERBOUND=-1e-10,d}();T.Solver=E,T.removeOverlapInOneDimension=function R(d,f,v){for(var g=d.map(function(X){return new I(X.desiredCenter)}),y=[],m=d.length,O=0;O<m-1;O++)y.push(new p(g[O],g[O+1],(d[O].size+d[O+1].size)/2));var M=g[0],B=g[m-1],Y=d[0].size/2,_=d[m-1].size/2,K=null,Q=null;return f&&(K=new I(f,1e3*M.weight),g.push(K),y.push(new p(K,M,Y))),v&&(Q=new I(v,1e3*B.weight),g.push(Q),y.push(new p(B,Q,_))),new E(g,y).solve(),{newCenters:g.slice(0,d.length).map(function(X){return X.position()}),lowerBound:K?K.position():M.position()-Y,upperBound:Q?Q.position():B.position()+_}}},655:(D,T,h)=>{"use strict";h.r(T),h.d(T,{__assign:()=>C,__asyncDelegator:()=>_,__asyncGenerator:()=>Y,__asyncValues:()=>K,__await:()=>B,__awaiter:()=>f,__classPrivateFieldGet:()=>U,__classPrivateFieldSet:()=>W,__createBinding:()=>g,__decorate:()=>E,__exportStar:()=>y,__extends:()=>I,__generator:()=>v,__importDefault:()=>re,__importStar:()=>X,__makeTemplateObject:()=>Q,__metadata:()=>d,__param:()=>R,__read:()=>O,__rest:()=>w,__spread:()=>P,__spreadArray:()=>M,__spreadArrays:()=>N,__values:()=>m});var p=function(k,V){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,$){H.__proto__=$}||function(H,$){for(var se in $)Object.prototype.hasOwnProperty.call($,se)&&(H[se]=$[se])})(k,V)};function I(k,V){if("function"!=typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function H(){this.constructor=k}p(k,V),k.prototype=null===V?Object.create(V):(H.prototype=V.prototype,new H)}var C=function(){return C=Object.assign||function(V){for(var H,$=1,se=arguments.length;$<se;$++)for(var j in H=arguments[$])Object.prototype.hasOwnProperty.call(H,j)&&(V[j]=H[j]);return V},C.apply(this,arguments)};function w(k,V){var H={};for(var $ in k)Object.prototype.hasOwnProperty.call(k,$)&&V.indexOf($)<0&&(H[$]=k[$]);if(null!=k&&"function"==typeof Object.getOwnPropertySymbols){var se=0;for($=Object.getOwnPropertySymbols(k);se<$.length;se++)V.indexOf($[se])<0&&Object.prototype.propertyIsEnumerable.call(k,$[se])&&(H[$[se]]=k[$[se]])}return H}function E(k,V,H,$){var z,se=arguments.length,j=se<3?V:null===$?$=Object.getOwnPropertyDescriptor(V,H):$;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(k,V,H,$);else for(var le=k.length-1;le>=0;le--)(z=k[le])&&(j=(se<3?z(j):se>3?z(V,H,j):z(V,H))||j);return se>3&&j&&Object.defineProperty(V,H,j),j}function R(k,V){return function(H,$){V(H,$,k)}}function d(k,V){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(k,V)}function f(k,V,H,$){return new(H||(H=Promise))(function(j,z){function le(Ee){try{ge($.next(Ee))}catch(ye){z(ye)}}function fe(Ee){try{ge($.throw(Ee))}catch(ye){z(ye)}}function ge(Ee){Ee.done?j(Ee.value):function se(j){return j instanceof H?j:new H(function(z){z(j)})}(Ee.value).then(le,fe)}ge(($=$.apply(k,V||[])).next())})}function v(k,V){var $,se,j,z,H={label:0,sent:function(){if(1&j[0])throw j[1];return j[1]},trys:[],ops:[]};return z={next:le(0),throw:le(1),return:le(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function le(ge){return function(Ee){return function fe(ge){if($)throw new TypeError("Generator is already executing.");for(;H;)try{if($=1,se&&(j=2&ge[0]?se.return:ge[0]?se.throw||((j=se.return)&&j.call(se),0):se.next)&&!(j=j.call(se,ge[1])).done)return j;switch(se=0,j&&(ge=[2&ge[0],j.value]),ge[0]){case 0:case 1:j=ge;break;case 4:return H.label++,{value:ge[1],done:!1};case 5:H.label++,se=ge[1],ge=[0];continue;case 7:ge=H.ops.pop(),H.trys.pop();continue;default:if(!(j=(j=H.trys).length>0&&j[j.length-1])&&(6===ge[0]||2===ge[0])){H=0;continue}if(3===ge[0]&&(!j||ge[1]>j[0]&&ge[1]<j[3])){H.label=ge[1];break}if(6===ge[0]&&H.label<j[1]){H.label=j[1],j=ge;break}if(j&&H.label<j[2]){H.label=j[2],H.ops.push(ge);break}j[2]&&H.ops.pop(),H.trys.pop();continue}ge=V.call(k,H)}catch(Ee){ge=[6,Ee],se=0}finally{$=j=0}if(5&ge[0])throw ge[1];return{value:ge[0]?ge[1]:void 0,done:!0}}([ge,Ee])}}}var g=Object.create?function(k,V,H,$){void 0===$&&($=H),Object.defineProperty(k,$,{enumerable:!0,get:function(){return V[H]}})}:function(k,V,H,$){void 0===$&&($=H),k[$]=V[H]};function y(k,V){for(var H in k)"default"!==H&&!Object.prototype.hasOwnProperty.call(V,H)&&g(V,k,H)}function m(k){var V="function"==typeof Symbol&&Symbol.iterator,H=V&&k[V],$=0;if(H)return H.call(k);if(k&&"number"==typeof k.length)return{next:function(){return k&&$>=k.length&&(k=void 0),{value:k&&k[$++],done:!k}}};throw new TypeError(V?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(k,V){var H="function"==typeof Symbol&&k[Symbol.iterator];if(!H)return k;var se,z,$=H.call(k),j=[];try{for(;(void 0===V||V-- >0)&&!(se=$.next()).done;)j.push(se.value)}catch(le){z={error:le}}finally{try{se&&!se.done&&(H=$.return)&&H.call($)}finally{if(z)throw z.error}}return j}function P(){for(var k=[],V=0;V<arguments.length;V++)k=k.concat(O(arguments[V]));return k}function N(){for(var k=0,V=0,H=arguments.length;V<H;V++)k+=arguments[V].length;var $=Array(k),se=0;for(V=0;V<H;V++)for(var j=arguments[V],z=0,le=j.length;z<le;z++,se++)$[se]=j[z];return $}function M(k,V,H){if(H||2===arguments.length)for(var j,$=0,se=V.length;$<se;$++)(j||!($ in V))&&(j||(j=Array.prototype.slice.call(V,0,$)),j[$]=V[$]);return k.concat(j||V)}function B(k){return this instanceof B?(this.v=k,this):new B(k)}function Y(k,V,H){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var se,$=H.apply(k,V||[]),j=[];return se={},z("next"),z("throw"),z("return"),se[Symbol.asyncIterator]=function(){return this},se;function z(Se){$[Se]&&(se[Se]=function(xe){return new Promise(function(ae,ue){j.push([Se,xe,ae,ue])>1||le(Se,xe)})})}function le(Se,xe){try{!function fe(Se){Se.value instanceof B?Promise.resolve(Se.value.v).then(ge,Ee):ye(j[0][2],Se)}($[Se](xe))}catch(ae){ye(j[0][3],ae)}}function ge(Se){le("next",Se)}function Ee(Se){le("throw",Se)}function ye(Se,xe){Se(xe),j.shift(),j.length&&le(j[0][0],j[0][1])}}function _(k){var V,H;return V={},$("next"),$("throw",function(se){throw se}),$("return"),V[Symbol.iterator]=function(){return this},V;function $(se,j){V[se]=k[se]?function(z){return(H=!H)?{value:B(k[se](z)),done:"return"===se}:j?j(z):z}:j}}function K(k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var H,V=k[Symbol.asyncIterator];return V?V.call(k):(k=m(k),H={},$("next"),$("throw"),$("return"),H[Symbol.asyncIterator]=function(){return this},H);function $(j){H[j]=k[j]&&function(z){return new Promise(function(le,fe){!function se(j,z,le,fe){Promise.resolve(fe).then(function(ge){j({value:ge,done:le})},z)}(le,fe,(z=k[j](z)).done,z.value)})}}}function Q(k,V){return Object.defineProperty?Object.defineProperty(k,"raw",{value:V}):k.raw=V,k}var ne=Object.create?function(k,V){Object.defineProperty(k,"default",{enumerable:!0,value:V})}:function(k,V){k.default=V};function X(k){if(k&&k.__esModule)return k;var V={};if(null!=k)for(var H in k)"default"!==H&&Object.prototype.hasOwnProperty.call(k,H)&&g(V,k,H);return ne(V,k),V}function re(k){return k&&k.__esModule?k:{default:k}}function U(k,V,H,$){if("a"===H&&!$)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof V?k!==V||!$:!V.has(k))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===H?$:"a"===H?$.call(k):$?$.value:V.get(k)}function W(k,V,H,$,se){if("m"===$)throw new TypeError("Private method is not writable");if("a"===$&&!se)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof V?k!==V||!se:!V.has(k))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===$?se.call(k,H):se?se.value=H:V.set(k,H),H}},8270:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.KeyedMultiCollection=T.ReadonlyKeyedMultiCollection=T.KeyedCollection=T.ReadonlyKeyedCollection=T.IndexedCollection=T.FixedSizeIndexedCollection=T.ReadonlyIndexedCollection=T.Collection=T.ReadonlyCollection=void 0;const p=h(1344),I=h(9440);var C,m,w,E,R,d,f,v,g,y;(m=C=T.ReadonlyCollection||(T.ReadonlyCollection={})).size=Symbol.for("@esfx/collection-core!ReadonlyCollection.size"),m.has=Symbol.for("@esfx/collection-core!ReadonlyCollection.has"),m.isReadonlyCollection=function O(N){return p.isIterable(N)&&m.size in N&&m.has in N},m.name="ReadonlyCollection",m.hasInstance=function P(N){return p.isIterable(N)&&m.size in N&&m.has in N},function(m){m.size=C.size,m.has=C.has,m.isReadonlyCollection=C.isReadonlyCollection,m.add=Symbol.for("@esfx/collection-core!Collection.add"),m.delete=Symbol.for("@esfx/collection-core!Collection.delete"),m.clear=Symbol.for("@esfx/collection-core!Collection.clear"),m.isCollection=function O(N){return m.hasInstance(N)},m.name="Collection",m.hasInstance=function P(N){return C.hasInstance(N)&&m.add in N&&m.delete in N&&m.clear in N}}(w=T.Collection||(T.Collection={})),function(m){m.size=C.size,m.has=C.has,m.isReadonlyCollection=C.isReadonlyCollection,m.indexOf=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.indexOf"),m.getAt=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.getAt"),m.isReadonlyIndexedCollection=function O(N){return m.hasInstance(N)},m.name="ReadonlyIndexedCollection",m.hasInstance=function P(N){return C.hasInstance(N)&&m.indexOf in N&&m.getAt in N}}(E=T.ReadonlyIndexedCollection||(T.ReadonlyIndexedCollection={})),function(m){m.size=C.size,m.has=C.has,m.isReadonlyCollection=C.isReadonlyCollection,m.indexOf=E.indexOf,m.getAt=E.getAt,m.isReadonlyIndexedCollection=E.isReadonlyIndexedCollection,m.setAt=Symbol.for("@esfx/collection-core!FixedSizeIndexedCollection.setAt"),m.isFixedSizeIndexedCollection=function O(N){return m.hasInstance(N)},m.name="FixedSizeIndexedCollection",m.hasInstance=function P(N){return E.hasInstance(N)&&m.setAt in N}}(R=T.FixedSizeIndexedCollection||(T.FixedSizeIndexedCollection={})),function(m){m.size=C.size,m.has=C.has,m.isReadonlyCollection=C.isReadonlyCollection,m.indexOf=E.indexOf,m.getAt=E.getAt,m.isReadonlyIndexedCollection=E.isReadonlyIndexedCollection,m.setAt=R.setAt,m.isFixedSizeIndexedCollection=R.isFixedSizeIndexedCollection,m.add=w.add,m.delete=w.delete,m.clear=w.clear,m.isCollection=w.isCollection,m.insertAt=Symbol.for("@esfx/collection-core!IndexedCollection.insertAt"),m.removeAt=Symbol.for("@esfx/collection-core!IndexedCollection.removeAt"),m.isIndexedCollection=function O(N){return m.hasInstance(N)},m.name="IndexedCollection",m.hasInstance=function P(N){return R.hasInstance(N)&&m.insertAt in N&&m.removeAt in N}}(d=T.IndexedCollection||(T.IndexedCollection={})),function(m){m.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.size"),m.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.has"),m.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.get"),m.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.keys"),m.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.values"),m.isReadonlyKeyedCollection=function O(N){return m.hasInstance(N)},m.name="ReadonlyKeyedCollection",m.hasInstance=function P(N){return p.isIterable(N)&&m.size in N&&m.has in N&&m.get in N&&m.keys in N&&m.values in N}}(f=T.ReadonlyKeyedCollection||(T.ReadonlyKeyedCollection={})),function(m){m.size=f.size,m.has=f.has,m.get=f.get,m.keys=f.keys,m.values=f.values,m.isReadonlyKeyedCollection=f.isReadonlyKeyedCollection,m.set=Symbol.for("@esfx/collection-core!KeyedCollection.set"),m.delete=Symbol.for("@esfx/collection-core!KeyedCollection.delete"),m.clear=Symbol.for("@esfx/collection-core!KeyedCollection.clear"),m.isKeyedCollection=function O(N){return m.hasInstance(N)},m.name="KeyedCollection",m.hasInstance=function P(N){return f.hasInstance(N)&&m.set in N&&m.delete in N&&m.clear in N}}(v=T.KeyedCollection||(T.KeyedCollection={})),function(m){m.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.size"),m.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.has"),m.hasValue=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.hasValue"),m.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.get"),m.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.keys"),m.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.values"),m.isReadonlyKeyedMultiCollection=function O(N){return m.hasInstance(N)},m.name="ReadonlyKeyedMultiCollection",m.hasInstance=function P(N){return p.isIterable(N)&&m.size in N&&m.has in N&&m.hasValue in N&&m.get in N&&m.keys in N&&m.values in N}}(g=T.ReadonlyKeyedMultiCollection||(T.ReadonlyKeyedMultiCollection={})),function(m){m.size=g.size,m.has=g.has,m.hasValue=g.hasValue,m.get=g.get,m.keys=g.keys,m.values=g.values,m.isReadonlyKeyedMultiCollection=g.isReadonlyKeyedMultiCollection,m.add=Symbol.for("@esfx/collection-core!KeyedMultiCollection.add"),m.delete=Symbol.for("@esfx/collection-core!KeyedMultiCollection.delete"),m.deleteValue=Symbol.for("@esfx/collection-core!KeyedMultiCollection.deleteValue"),m.clear=Symbol.for("@esfx/collection-core!KeyedMultiCollection.clear"),m.isKeyedMultiCollection=function O(N){return m.hasInstance(N)},m.name="KeyedMultiCollection",m.hasInstance=function P(N){return g.hasInstance(N)&&m.add in N&&m.delete in N&&m.deleteValue in N&&m.clear in N}}(y=T.KeyedMultiCollection||(T.KeyedMultiCollection={})),I.deprecateProperty(C,"isReadonlyCollection","Use 'ReadonlyCollection.hasInstance' instead."),I.deprecateProperty(w,"isReadonlyCollection","Use 'ReadonlyCollection.hasInstance' instead."),I.deprecateProperty(w,"isCollection","Use 'Collection.hasInstance' instead."),I.deprecateProperty(E,"isReadonlyCollection","Use 'ReadonlyCollection.hasInstance' instead."),I.deprecateProperty(E,"isReadonlyIndexedCollection","Use 'ReadonlyIndexedCollection.hasInstance' instead."),I.deprecateProperty(R,"isReadonlyCollection","Use 'ReadonlyCollection.hasInstance' instead."),I.deprecateProperty(R,"isReadonlyIndexedCollection","Use 'ReadonlyIndexedCollection.hasInstance' instead."),I.deprecateProperty(R,"isFixedSizeIndexedCollection","Use 'FixedSizeIndexedCollection.hasInstance' instead."),I.deprecateProperty(d,"isReadonlyCollection","Use 'ReadonlyCollection.hasInstance' instead."),I.deprecateProperty(d,"isReadonlyIndexedCollection","Use 'ReadonlyIndexedCollection.hasInstance' instead."),I.deprecateProperty(d,"isFixedSizeIndexedCollection","Use 'FixedSizeIndexedCollection.hasInstance' instead."),I.deprecateProperty(d,"isCollection","Use 'Collection.hasInstance' instead."),I.deprecateProperty(d,"isIndexedCollection","Use 'IndexedCollection.hasInstance' instead."),I.deprecateProperty(f,"isReadonlyKeyedCollection","Use 'ReadonlyKeyedCollection.hasInstance' instead."),I.deprecateProperty(v,"isReadonlyKeyedCollection","Use 'ReadonlyKeyedCollection.hasInstance' instead."),I.deprecateProperty(v,"isKeyedCollection","Use 'KeyedCollection.hasInstance' instead."),I.deprecateProperty(g,"isReadonlyKeyedMultiCollection","Use 'ReadonlyKeyedMultiCollection.hasInstance' instead."),I.deprecateProperty(y,"isReadonlyKeyedMultiCollection","Use 'ReadonlyKeyedMultiCollection.hasInstance' instead."),I.deprecateProperty(y,"isKeyedMultiCollection","Use 'KeyedMultiCollection.hasInstance' instead.")},8090:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.HashMap=void 0;const p=h(8270),I=h(839),C=h(1344),w=h(1301);class E{constructor(...d){let f,v,g;if(d.length>0){const y=d[0];"number"==typeof y?(f=y,d.length>1&&(g=d[1])):C.isIterable(y)||void 0===y?(v=y,d.length>1&&(g=d[1])):g=y}if(void 0===f&&(f=0),void 0===g&&(g=I.Equaler.defaultEqualer),f<0)throw new RangeError;if(this._hashData=w.createHashData(g,f),v)for(const[y,m]of v)this.set(y,m)}get equaler(){return this._hashData.equaler}get size(){return this._hashData.size-this._hashData.freeSize}has(d){return w.findEntryIndex(this._hashData,d)>=0}get(d){return w.findEntryValue(this._hashData,d)}set(d,f){return w.insertEntry(this._hashData,d,f),this}delete(d){return w.deleteEntry(this._hashData,d)}clear(){w.clearEntries(this._hashData)}ensureCapacity(d){return w.ensureCapacity(this._hashData,d)}trimExcess(d){w.trimExcessEntries(this._hashData,d)}keys(){return w.iterateEntries(this._hashData.head,w.selectEntryKey)}values(){return w.iterateEntries(this._hashData.head,w.selectEntryValue)}entries(){return w.iterateEntries(this._hashData.head,w.selectEntryEntry)}[Symbol.iterator](){return this.entries()}forEach(d,f){w.forEachEntry(this,this._hashData.head,d,f)}get[p.ReadonlyKeyedCollection.size](){return this.size}[p.ReadonlyKeyedCollection.has](d){return this.has(d)}[p.ReadonlyKeyedCollection.get](d){return this.get(d)}[p.ReadonlyKeyedCollection.keys](){return this.keys()}[p.ReadonlyKeyedCollection.values](){return this.values()}[p.KeyedCollection.set](d,f){this.set(d,f)}[p.KeyedCollection.delete](d){return this.delete(d)}[p.KeyedCollection.clear](){this.clear()}}T.HashMap=E,Object.defineProperty(E,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"HashMap"})},6471:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.HashSet=void 0;const p=h(8270),I=h(839),C=h(1344),w=h(1301);class E{constructor(...d){let f,v,g;if(d.length>0){const y=d[0];"number"==typeof y?(f=y,d.length>1&&(g=d[1])):C.isIterable(y)?(v=y,d.length>1&&(g=d[1])):g=y}if(void 0===f&&(f=0),void 0===g&&(g=I.Equaler.defaultEqualer),f<0)throw new RangeError;if(this._hashData=w.createHashData(g,f),v)for(const y of v)this.add(y)}get equaler(){return this._hashData.equaler}get size(){return this._hashData.size-this._hashData.freeSize}has(d){return w.findEntryIndex(this._hashData,d)>=0}add(d){return w.insertEntry(this._hashData,d,d),this}tryAdd(d){const f=this.size;return w.insertEntry(this._hashData,d,d),this.size>f}delete(d){return w.deleteEntry(this._hashData,d)}clear(){w.clearEntries(this._hashData)}ensureCapacity(d){return w.ensureCapacity(this._hashData,d)}trimExcess(d){w.trimExcessEntries(this._hashData,d)}keys(){return w.iterateEntries(this._hashData.head,w.selectEntryKey)}values(){return w.iterateEntries(this._hashData.head,w.selectEntryValue)}entries(){return w.iterateEntries(this._hashData.head,w.selectEntryEntry)}[Symbol.iterator](){return this.values()}forEach(d,f){w.forEachEntry(this,this._hashData.head,d,f)}get[p.Collection.size](){return this.size}[p.Collection.has](d){return this.has(d)}[p.Collection.add](d){this.add(d)}[p.Collection.delete](d){return this.delete(d)}[p.Collection.clear](){this.clear()}}T.HashSet=E,Object.defineProperty(E,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"HashSet"})},6289:(D,T,h)=>{"use strict";var p,I,C;Object.defineProperty(T,"__esModule",{value:!0}),T.LinkedList=T.LinkedListNode=void 0;const w=h(1344),E=h(8270),R=h(839),d=Symbol("LinkedListNode.list"),f=Symbol("LinkedListNode.previous"),v=Symbol("LinkedListNode.next");class g{constructor(O){this[p]=void 0,this[I]=void 0,this[C]=void 0,this.value=O}get list(){return this[d]}get previous(){if(this[f]&&this.list&&this!==this.list.first)return this[f]}get next(){if(this[v]&&this.list&&this[v]!==this.list.first)return this[v]}detachSelf(){return!!this.list&&this.list.deleteNode(this)}}T.LinkedListNode=g,p=d,I=f,C=v,Object.defineProperty(g.prototype,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"LinkedListNode"});class y{constructor(...O){let P,N;if(this._size=0,this._head=void 0,O.length>0&&(w.isIterable(O[0])||w.isMissing(O[0])?(P=O[0],O.length>1&&(N=O[1])):N=O[0]),w.isMissing(N)&&(N=R.Equaler.defaultEqualer),this._equaler="function"==typeof N?R.Equaler.create(N):N,P)for(const M of P)this.push(M)}get equaler(){return this._equaler}get first(){return this._head}get last(){if(this._head)return this._head[f]}get size(){return this._size}[Symbol.iterator](){return this.values()}*values(){for(const O of this.nodes())yield O.value}*nodes(){let O,P=this.first;for(;void 0!==P;)O=P,P=O.next,yield O}*drain(){for(const O of this.nodes())this.deleteNode(O),yield O.value}nodeOf(O,P){if(!w.isMissing(P)&&!w.isInstance(P,g))throw new TypeError("LinkedListNode expected: fromNode");if(!w.isMissing(P)&&P.list!==this)throw new TypeError("Wrong list.");for(let N=P||this.first;N;N=N.next)if(this._equaler.equals(N.value,O))return N}lastNodeOf(O,P){if(!w.isMissing(P)&&!w.isInstance(P,g))throw new TypeError("LinkedListNode expected: fromNode");if(!w.isMissing(P)&&P.list!==this)throw new TypeError("Wrong list.");for(let N=P||this.last;N;N=N.previous)if(this._equaler.equals(N.value,O))return N}find(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.first;for(;void 0!==M;){N=M,M=N.next;const B=N.value;if(O.call(P,B,N,this))return B}}findLast(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.last;for(;void 0!==M;){N=M,M=N.previous;const B=N.value;if(O.call(P,B,N,this))return B}}findNode(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.first;for(;void 0!==M;)if(N=M,M=N.next,O.call(P,N.value,N,this))return N}findLastNode(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.last;for(;void 0!==M;)if(N=M,M=N.previous,O.call(P,N.value,N,this))return N}has(O){return void 0!==this.nodeOf(O)}insertBefore(O,P){if(!w.isMissing(O)&&!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: node");if(!w.isMissing(O)&&O.list!==this)throw new Error("Wrong list.");return this._insertNode(O||void 0,new g(P),0)}insertNodeBefore(O,P){if(!w.isMissing(O)&&!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: node");if(!w.isInstance(P,g))throw new TypeError("LinkedListNode expected: newNode");if(!w.isMissing(O)&&O.list!==this)throw new Error("Wrong list.");if(!w.isMissing(P.list))throw new Error("Node is already attached to a list.");this._insertNode(O||void 0,P,0)}insertAfter(O,P){if(!w.isMissing(O)&&!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: node");if(!w.isMissing(O)&&O.list!==this)throw new Error("Wrong list.");return this._insertNode(O||void 0,new g(P),1)}insertNodeAfter(O,P){if(!w.isMissing(O)&&!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: node");if(!w.isInstance(P,g))throw new TypeError("LinkedListNode expected: newNode");if(!w.isMissing(O)&&O.list!==this)throw new Error("Wrong list.");if(!w.isMissing(P.list))throw new Error("Node is already attached to a list.");this._insertNode(O||void 0,P,1)}push(O){return this._insertNode(void 0,new g(O),1)}pushNode(O){if(!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: newNode");if(!w.isMissing(O.list))throw new Error("Node is already attached to a list.");this._insertNode(void 0,O,1)}pop(){const O=this.popNode();return O?O.value:void 0}popNode(){const O=this.last;if(this.deleteNode(O))return O}shift(){const O=this.shiftNode();return O?O.value:void 0}shiftNode(){const O=this.first;if(this.deleteNode(O))return O}unshift(O){return this._insertNode(void 0,new g(O),0)}unshiftNode(O){if(!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: newNode");if(!w.isMissing(O.list))throw new Error("Node is already attached to a list.");this._insertNode(void 0,O,0)}delete(O){const P=this.nodeOf(O);if(P&&this.deleteNode(P))return P}deleteNode(O){if(!w.isMissing(O)&&!w.isInstance(O,g))throw new TypeError("LinkedListNode expected: node");if(!w.isMissing(O)&&!w.isMissing(O.list)&&O.list!==this)throw new TypeError("Wrong list.");return!w.isMissing(O)&&!w.isMissing(O.list)&&this._deleteNode(O)}deleteAll(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: predicate");let N=0,M=this.first;for(;M;){const B=M.next;O.call(P,M.value,M,this)&&M.list===this&&(this._deleteNode(M),++N),M=B}return N}clear(){for(;this.size>0;)this.deleteNode(this.last)}forEach(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.first;for(;void 0!==M;)N=M,M=N.next,O.call(P,N.value,N,this)}map(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");const N=new y;let M,B=this.first;for(;void 0!==B;){M=B,B=M.next;const Y=O.call(P,M.value,M,this);N.push(Y)}return N}filter(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");const N=new y(this.equaler);let M,B=this.first;for(;void 0!==B;){M=B,B=M.next;const Y=M.value;O.call(P,Y,M,this)&&N.push(Y)}return N}reduce(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let B,N=arguments.length>1,M=P,Y=this.first;for(;void 0!==Y;){B=Y,Y=B.next;const _=B.value;N?M=O(M,_,B,this):(M=_,N=!0)}return M}reduceRight(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let B,N=arguments.length>1,M=P,Y=this.last;for(;void 0!==Y;){B=Y;const _=B.value;N?M=O(M,_,B,this):(M=_,N=!0),Y=B.previous}return M}some(O,P){if(!w.isMissing(O)&&!w.isFunction(O))throw new TypeError("Function expected: callback");let N,M=this.first;for(;void 0!==M;)if(N=M,M=N.next,!O||O.call(P,N.value,N,this))return!0;return!1}every(O,P){if(!w.isFunction(O))throw new TypeError("Function expected: callback");let M,N=!1,B=this.first;for(;void 0!==B;){if(M=B,B=M.next,!O.call(P,M.value,M,this))return!1;N=!0}return N}_deleteNode(O){return O[v]===O?this._head=void 0:(O[v][f]=O[f],O[f][v]=O[v],this._head===O&&(this._head=O[v])),O[d]=void 0,O[v]=void 0,O[f]=void 0,this._size--,!0}_insertNode(O,P,N){if(P[d]=this,void 0===this._head)P[v]=P,P[f]=P,this._head=P;else switch(N){case 0:void 0===O?(O=this._head,this._head=P):O===this._head&&(this._head=P),P[v]=O,P[f]=O[f],O[f][v]=P,O[f]=P;break;case 1:void 0===O&&(O=this._head[f]),P[f]=O,P[v]=O[v],O[v][f]=P,O[v]=P}return this._size++,P}get[E.ReadonlyCollection.size](){return this.size}[E.ReadonlyCollection.has](O){return this.has(O)}[E.Collection.add](O){this.push(O)}[E.Collection.delete](O){return!!this.delete(O)}[E.Collection.clear](){this.clear()}}T.LinkedList=y,Object.defineProperty(y.prototype,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"LinkedList"})},6207:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.MultiMap=void 0;const p=h(1344),I=h(839),C=h(8270),w=h(8090),E=h(6471);class R{constructor(...g){let y,m,O;this._size=0,function f(v){return(v.length<1||p.isNumber(v[0]))&&(v.length<2||!p.isDefined(v[1])||p.isObject(v[1]))}(g)?[y,O={}]=g:(y=0,function d(v){return(v.length<1||!p.isDefined(v[0])||p.isIterable(v[0]))&&(v.length<2||!p.isDefined(v[1])||p.isObject(v[1]))}(g)?[m,O={}]=g:O={});const{keyEqualer:P=I.Equaler.defaultEqualer,valueEqualer:N=I.Equaler.defaultEqualer}=O;if(this._map=new w.HashMap(y,P),this._keyEqualer=P,this._valueEqualer=N,m)for(const[M,B]of m)this.add(M,B)}get keyEqualer(){return this._keyEqualer}get valueEqualer(){return this._valueEqualer}get size(){return this._size}has(g){return this._map.has(g)}hasValue(g,y){const m=this._map.get(g);return!!m&&m.has(y)}get(g){return this._map.get(g)}add(g,y){let m=this._map.get(g);m||(m=new E.HashSet(this._valueEqualer),this._map.set(g,m));const O=m.size;return m.add(y),this._size+=m.size-O,this}delete(g){const y=this._map.get(g);return y?(this._size-=y.size,this._map.delete(g),y.size):0}deleteValue(g,y){const m=this._map.get(g);if(m){const O=m.size;if(m.delete(y))return this._size+=m.size-O,m.size<=0&&this._map.delete(g),!0}return!1}clear(){this._map.clear(),this._size=0}ensureCapacity(g){return this._map.ensureCapacity(g)}trimExcess(g){this._map.trimExcess(g)}keys(){return this._map.keys()}*values(){for(const g of this._map.values())yield*g}*entries(){for(const[g,y]of this._map)for(const m of y)yield[g,m]}[Symbol.iterator](){return this.entries()}forEach(g,y){for(const[m,O]of this._map)for(const P of O)g.call(y,P,m,this)}get[C.ReadonlyKeyedMultiCollection.size](){return this.size}[C.ReadonlyKeyedMultiCollection.has](g){return this.has(g)}[C.ReadonlyKeyedMultiCollection.hasValue](g,y){return this.hasValue(g,y)}[C.ReadonlyKeyedMultiCollection.get](g){return this.get(g)}[C.ReadonlyKeyedMultiCollection.keys](){return this.keys()}[C.ReadonlyKeyedMultiCollection.values](){return this.values()}[C.KeyedMultiCollection.add](g,y){this.add(g,y)}[C.KeyedMultiCollection.delete](g){return this.delete(g)}[C.KeyedMultiCollection.deleteValue](g,y){return this.deleteValue(g,y)}[C.KeyedMultiCollection.clear](){this.clear()}}T.MultiMap=R,Object.defineProperty(R,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"MultiMap"})},5027:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.SortedMap=void 0;const p=h(1344),I=h(4045),C=h(8270),w=h(839);class E{constructor(...d){let f,v;if(this._keys=[],this._values=[],d.length>0){const g=d[0];p.isIterable(g)||void 0===g?(f=g,d.length>1&&(v=d[1])):v=g}if(void 0===v&&(v=w.Comparer.defaultComparer),this._comparer="function"==typeof v?w.Comparer.create(v):v,f)for(const[g,y]of f)this.set(g,y)}get comparer(){return this._comparer}get size(){return this._keys.length}has(d){return I.binarySearch(this._keys,d,this._comparer)>=0}get(d){const f=I.binarySearch(this._keys,d,this._comparer);return f>=0?this._values[f]:void 0}set(d,f){const v=I.binarySearch(this._keys,d,this._comparer);return v>=0?this._values[v]=f:(this._keys.splice(~v,0,d),this._values.splice(~v,0,f)),this}delete(d){const f=I.binarySearch(this._keys,d,this._comparer);return f>=0&&(this._keys.splice(f,1),this._values.splice(f,1),!0)}clear(){this._keys.length=0,this._values.length=0}keys(){return this._keys.values()}values(){return this._values.values()}*entries(){for(let d=0;d<this._keys.length;d++)yield[this._keys[d],this._values[d]]}[Symbol.iterator](){return this.entries()}forEach(d,f){for(const[v,g]of this)d.call(f,g,v,this)}get[C.KeyedCollection.size](){return this.size}[C.KeyedCollection.has](d){return this.has(d)}[C.KeyedCollection.get](d){return this.get(d)}[C.KeyedCollection.set](d,f){this.set(d,f)}[C.KeyedCollection.delete](d){return this.delete(d)}[C.KeyedCollection.clear](){this.clear()}[C.KeyedCollection.keys](){return this.keys()}[C.KeyedCollection.values](){return this.values()}}T.SortedMap=E,Object.defineProperty(E,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"SortedMap"})},4027:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.SortedSet=void 0;const p=h(4045),I=h(1344),C=h(8270),w=h(839);class E{constructor(...d){let f,v;if(this._values=[],d.length>0){const g=d[0];I.isIterable(g)||void 0===g?(f=g,d.length>1&&(v=d[1])):v=g}if(void 0===v&&(v=w.Comparer.defaultComparer),this._comparer="function"==typeof v?w.Comparer.create(v):v,f)for(const g of f)this.add(g)}get comparer(){return this._comparer}get size(){return this._values.length}has(d){return p.binarySearch(this._values,d,this._comparer)>=0}add(d){const f=p.binarySearch(this._values,d,this._comparer);return f>=0?this._values[f]=d:this._values.splice(~f,0,d),this}delete(d){const f=p.binarySearch(this._values,d,this._comparer);return f>=0&&(this._values.splice(f,1),!0)}clear(){this._values.length=0}keys(){return this._values.values()}values(){return this._values.values()}*entries(){for(let d=0;d<this._values.length;d++)yield[this._values[d],this._values[d]]}[Symbol.iterator](){return this.values()}forEach(d,f){for(const v of this)d.call(f,v,v,this)}get[C.Collection.size](){return this.size}[C.Collection.has](d){return this.has(d)}[C.Collection.add](d){this.add(d)}[C.Collection.delete](d){return this.delete(d)}[C.Collection.clear](){this.clear()}}T.SortedSet=E,Object.defineProperty(E,Symbol.toStringTag,{enumerable:!1,configurable:!0,writable:!0,value:"SortedSet"})},2243:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});const p=h(655);p.__exportStar(h(5027),T),p.__exportStar(h(4027),T),p.__exportStar(h(8090),T),p.__exportStar(h(6471),T),p.__exportStar(h(6207),T),p.__exportStar(h(6289),T)},839:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.rawHash=T.tupleStructuralComparer=T.tupleComparer=T.structuralComparer=T.defaultComparer=T.Comparer=T.combineHashes=T.tupleStructuralEqualer=T.tupleEqualer=T.structuralEqualer=T.defaultEqualer=T.Equaler=T.StructuralComparable=T.StructuralEquatable=T.Comparable=T.Equatable=void 0;const p=h(7354);var I,C,w,E,R,d;function v(g){let y=!1;return()=>{y||(y=!0,"object"==typeof process&&process.emitWarning?process.emitWarning(g,"Deprecation"):"object"==typeof console&&console.warn(`Deprecation: ${g}`))}}(function(g){function y(m){let O;return null!=m&&g.equals in(O=Object(m))&&g.hash in O}g.equals=Symbol.for("@esfx/equatable:Equatable.equals"),g.hash=Symbol.for("@esfx/equatable:Equatable.hash"),g.name="Equatable",g.hasInstance=y,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:y})})(I=T.Equatable||(T.Equatable={})),function(g){const y=v("Use 'Equatable.hasInstance' instead.");g.isEquatable=function m(O){return y(),g.hasInstance(O)}}(I=T.Equatable||(T.Equatable={})),function(g){function y(m){return null!=m&&g.compareTo in Object(m)}g.compareTo=Symbol.for("@esfx/equatable:Comparable.compareTo"),g.name="Comparable",g.hasInstance=y,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:y})}(C=T.Comparable||(T.Comparable={})),function(g){const y=v("Use 'Comparable.hasInstance' instead.");g.isComparable=function m(O){return y(),g.hasInstance(O)}}(C=T.Comparable||(T.Comparable={})),function(g){function y(m){let O;return null!=m&&g.structuralEquals in(O=Object(m))&&g.structuralHash in O}g.structuralEquals=Symbol.for("@esfx/equatable:StructualEquatable.structuralEquals"),g.structuralHash=Symbol.for("@esfx/equatable:StructuralEquatable.structuralHash"),g.name="StructuralEquatable",g.hasInstance=y,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:y})}(w=T.StructuralEquatable||(T.StructuralEquatable={})),function(g){const y=v("Use 'StructuralEquatable.hasInstance' instead.");g.isStructuralEquatable=function m(O){return y(),g.hasInstance(O)}}(w=T.StructuralEquatable||(T.StructuralEquatable={})),function(g){function y(m){return null!=m&&g.structuralCompareTo in Object(m)}g.structuralCompareTo=Symbol.for("@esfx/equatable:StructuralComparable.structuralCompareTo"),g.name="StructuralComparable",g.hasInstance=y,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:y})}(E=T.StructuralComparable||(T.StructuralComparable={})),function(g){const y=v("Use 'StructuralComparable.hasInstance' instead.");g.isStructuralComparable=function m(O){return y(),g.hasInstance(O)}}(E=T.StructuralComparable||(T.StructuralComparable={})),function(g){const y=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Equaler"});function m(N,M=g.defaultEqualer.hash){return Object.setPrototypeOf({equals:N,hash:M},y)}function O(N,M,B=7){if("number"!=typeof N)throw new TypeError("Integer expected: x");if("number"!=typeof M)throw new TypeError("Integer expected: y");if("number"!=typeof B)throw new TypeError("Integer expected: rotate");if(isNaN(N)||!isFinite(N))throw new RangeError("Argument must be a finite number value: x");if(isNaN(M)||!isFinite(M))throw new RangeError("Argument must be a finite number value: y");if(isNaN(B)||!isFinite(B))throw new RangeError("Argument must be a finite number value: rotate");for(;B<0;)B+=32;for(;B>=32;)B-=32;return(N<<B|N>>>32-B)^M}function P(N){return"object"==typeof N&&null!==N&&"function"==typeof N.equals&&"function"==typeof N.hash}g.defaultEqualer=m((N,M)=>I.hasInstance(N)?N[I.equals](M):I.hasInstance(M)?M[I.equals](N):Object.is(N,M),N=>I.hasInstance(N)?N[I.hash]():p.hashUnknown(N)),g.structuralEqualer=m((N,M)=>w.hasInstance(N)?N[w.structuralEquals](M,g.structuralEqualer):w.hasInstance(M)?M[w.structuralEquals](N,g.structuralEqualer):g.defaultEqualer.equals(N,M),N=>w.hasInstance(N)?N[w.structuralHash](g.structuralEqualer):g.defaultEqualer.hash(N)),g.tupleEqualer=m((N,M)=>{if(!Array.isArray(N)&&null!=N||!Array.isArray(M)&&null!=M)throw new TypeError("Array expected");if(N===M)return!0;if(!N||!M||N.length!==M.length)return!1;for(let B=0;B<N.length;B++)if(!g.defaultEqualer.equals(N[B],M[B]))return!1;return!0},N=>{if(null==N)return 0;if(!Array.isArray(N))throw new TypeError("Array expected");let M=0;for(const B of N)M=O(M,g.defaultEqualer.hash(B));return M}),g.tupleStructuralEqualer=m((N,M)=>{if(!Array.isArray(N)&&null!=N||!Array.isArray(M)&&null!=M)throw new TypeError("Array expected");if(N===M)return!0;if(!N||!M||N.length!==M.length)return!1;for(let B=0;B<N.length;B++)if(!g.structuralEqualer.equals(N[B],M[B]))return!1;return!0},N=>{if(null==N)return 0;if(!Array.isArray(N))throw new TypeError("Array expected");let M=0;for(const B of N)M=O(M,g.structuralEqualer.hash(B));return M}),g.create=m,g.combineHashes=O,g.hasInstance=P,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:P})}(R=T.Equaler||(T.Equaler={})),T.defaultEqualer=R.defaultEqualer,T.structuralEqualer=R.structuralEqualer,T.tupleEqualer=R.tupleEqualer,T.tupleStructuralEqualer=R.tupleEqualer,T.combineHashes=R.combineHashes,function(g){const y=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Comparer"});function m(P){return Object.setPrototypeOf({compare:P},y)}function O(P){return"object"==typeof P&&null!==P&&"function"==typeof P.compare}g.defaultComparer=m((P,N)=>C.hasInstance(P)?P[C.compareTo](N):C.hasInstance(N)?-N[C.compareTo](P):P<N?-1:P>N?1:0),g.structuralComparer=m((P,N)=>E.hasInstance(P)?P[E.structuralCompareTo](N,g.structuralComparer):E.hasInstance(N)?-N[E.structuralCompareTo](P,g.structuralComparer):g.defaultComparer.compare(P,N)),g.tupleComparer=m((P,N)=>{if(!Array.isArray(P)&&null!=P||!Array.isArray(N)&&null!=N)throw new TypeError("Array expected");let M;if(M=g.defaultComparer.compare(P.length,N.length))return M;for(let B=0;B<P.length;B++)if(M=g.defaultComparer.compare(P[B],N[B]))return M;return 0}),g.tupleStructuralComparer=m((P,N)=>{if(!Array.isArray(P)&&null!=P||!Array.isArray(N)&&null!=N)throw new TypeError("Array expected");let M;if(M=g.defaultComparer.compare(P.length,N.length))return M;for(let B=0;B<P.length;B++)if(M=g.structuralComparer.compare(P[B],N[B]))return M;return 0}),g.create=m,g.hasInstance=O,Object.defineProperty(g,Symbol.hasInstance,{configurable:!0,writable:!0,value:O})}(d=T.Comparer||(T.Comparer={})),T.defaultComparer=d.defaultComparer,T.structuralComparer=d.structuralComparer,T.tupleComparer=d.tupleComparer,T.tupleStructuralComparer=d.tupleStructuralComparer,T.rawHash=function f(g){return p.hashUnknown(g)}},7354:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.hashUnknown=void 0;const p=h(7155);let I,C,w,E,R,d;const m=new DataView(new ArrayBuffer(8)),O=p.createSeed(),P=p.createSeed(),N=p.createSeed(),M=p.createSeed(),B=p.createSeed();let Y=O,_=P,K=B,Q=N,ne=M;function se(ce,ve,Oe){if(!Buffer.isEncoding(ve))throw new RangeError(`Invalid encoding: ${ve}`);return function $(ce,ve){const Oe=ce.buffer.slice(ce.byteOffset,ce.byteOffset+ce.byteLength);return p.hash(Oe,ve)}(Buffer.from(ce,ve),Oe)}function j(ce,ve){return(ce<<7|ce>>>25)^ve}const fe="function"==typeof BigInt?function z(){const ce=BigInt(0),ve=BigInt(4294967295),Oe=BigInt(32);return function Ye(it){if(it===ce)return 0;let rr=it<ce?-1:it>ce?1:0;for(it<ce&&(it=-it);it!==ce;)rr=j(rr,Number(it&ve)),it>>=Oe;return rr}}():function le(){return function ce(ve){return se(ve.toString(),"ascii",K)}}(),ye="description"in Symbol.prototype?ce=>ce.description:ce=>{const ve=ce.toString();return ve.startsWith("Symbol(")&&ve.endsWith(")")?ve.slice(7,-1):ve};function ue(ce){let ve=E&&E.get(ce);return void 0===ve&&(E||(E=new WeakMap),ve=function ae(ce){let ve;return null===ce?ve=C||(C={next:1}):(ve=I&&I.get(ce),ve||(I||(I=new WeakMap),I.set(ce,ve={next:1}))),ve}(Object.getPrototypeOf(ce)).next++,ve=j(Y,ve),E.set(ce,ve)),ve}function pe(ce){switch(typeof ce){case"boolean":return function X(ce){return ce?1:0}(ce);case"number":return function H(ce){return function re(ce){return Number.isInteger(ce)&&ce>=-2147483648&&ce<=2147483647}(ce)?ce:function W(ce){return Number.isInteger(ce)&&ce>=0&&ce<=4294967295}(ce)?function k(ce){return ce>>0}(ce):function V(ce){return m.setFloat64(0,ce),m.getInt32(0,!0)^m.getInt32(4,!0)}(ce)}(ce);case"bigint":return fe(ce);case"string":return function ge(ce){return se(ce,"utf8",_)}(ce);case"symbol":return function xe(ce){const ve=Symbol.keyFor(ce);return void 0!==ve?function Ee(ce,ve){let Oe=R&&R.get(ce);return void 0===Oe&&(Oe=se(ve,"utf8",ne),R||(R=new Map),R.set(ce,Oe)),Oe}(ce,ve):function Se(ce){let ve=d&&d.get(ce);if(void 0===ve){w||(w={next:1}),ve=j(Q,w.next++);const Oe=ye(ce);Oe&&(ve=se(Oe,"utf8",ve)),d||(d=new Map),d.set(ce,ve)}return ve}(ce)}(ce);case"function":return ue(ce);case"object":if(null!==ce)return ue(ce);default:return 0}}var ce;T.hashUnknown=pe,(ce=pe=T.hashUnknown||(T.hashUnknown={})).getState=function ve(){return{weakPrototypeCounters:I,nullPrototypeCounter:C,localSymbolCounter:w,weakObjectHashes:E,globalSymbolHashes:R,localSymbolHashes:d,objectSeed:Y,stringSeed:_,bigIntSeed:K,localSymbolSeed:Q,globalSymbolSeed:ne}},ce.setState=function Oe(Ye){({weakPrototypeCounters:I,nullPrototypeCounter:C,localSymbolCounter:w,weakObjectHashes:E,globalSymbolHashes:R,localSymbolHashes:d,objectSeed:Y=O,stringSeed:_=P,bigIntSeed:K=B,localSymbolSeed:Q=N,globalSymbolSeed:ne=M}=Ye)}},7155:(D,T)=>{"use strict";function h(){return 4294967295*Math.random()>>>0}Object.defineProperty(T,"__esModule",{value:!0}),T.hash=T.defaultSeed=T.createSeed=void 0,T.createSeed=h,T.defaultSeed=h();const p=3432918353,I=461845907;T.hash=function w(E,R){const d=new DataView(E);let g,f=R>>>0,v=0;for(;v<d.byteLength-4;)g=d.getUint32(v,!0),g*=p,g=g<<15|g>>>17,g*=I,f^=g,f=f<<13|f>>>19,f=5*f+3864292196,v+=4;if(v<d.byteLength){switch(g=0,d.byteLength-v){case 3:g|=d.getUint8(v+2)<<16;case 2:g|=d.getUint8(v+1)<<8;case 1:g|=d.getUint8(v+0)<<0}g*=p,g=g<<15|g>>>17,g*=I,f^=g}return f^=d.byteLength,f^=f>>>16,f*=2246822507,f^=f>>>13,f*=3266489909,f^=f>>>16,f}},4045:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.binarySearch=void 0,T.binarySearch=function h(p,I,C){if(0===p.length)return-1;let w=0,E=p.length-1;for(;w<=E;){const R=w+(E-w>>1);switch(Math.sign(C.compare(p[R],I))){case-1:w=R+1;break;case 0:return R;case 1:E=R-1}}return~w}},1301:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.forEachEntry=T.iterateEntries=T.selectEntryEntry=T.selectEntryValue=T.selectEntryKey=T.trimExcessEntries=T.ensureCapacity=T.clearEntries=T.deleteEntry=T.insertEntry=T.findEntryValue=T.findEntryIndex=T.resizeHashData=T.initializeHashData=T.createHashData=T.createHashEntry=void 0;const p=h(502),I=2**31-1;function E(_,K){const Q=p.getPrime(K);return _.freeList=-1,_.buckets=new Int32Array(Q),_.entries=new Array(Q),Q}function R(_,K){const Q=_.size,ne=new Int32Array(K),X=_.entries?_.entries.slice():[];X.length=K;for(let re=0;re<Q;re++){const U=X[re];if(U&&U.hashCode>=0){const W=U.hashCode%K;U.next=ne[W]-1,ne[W]=re+1}}_.buckets=ne,_.entries=X}function d(_,K){let Q=-1;const{buckets:ne,entries:X,equaler:re}=_;if(ne&&X){let U=re.hash(K)&I;for(Q=ne[U%ne.length]-1;Q>>>0<X.length&&(X[Q].hashCode!==U||!re.equals(X[Q].key,K));)Q=X[Q].next}return Q}T.createHashEntry=function C(){return{prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0}},T.createHashData=function w(_,K){const Q={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0},ne={buckets:void 0,entries:void 0,freeSize:0,freeList:0,size:0,equaler:_,head:Q,tail:Q};return E(ne,K),ne},T.initializeHashData=E,T.resizeHashData=R,T.findEntryIndex=d,T.findEntryValue=function f(_,K){const Q=d(_,K);return Q>=0?_.entries[Q].value:void 0},T.insertEntry=function v(_,K,Q){if(_.buckets||E(_,0),!_.buckets||!_.entries)throw new Error;const ne=_.equaler.hash(K)&I;let X=ne%_.buckets.length,re=_.buckets[X]-1;for(;re>>>0<_.entries.length;){const H=_.entries[re];if(H.hashCode===ne&&_.equaler.equals(H.key,K))return void(H.value=Q);re=H.next}let W,U=!1;if(_.freeSize>0)W=_.freeList,U=!0,_.freeSize--;else{const H=_.size;if(H===_.entries.length){if(R(_,p.expandPrime(_.size)),!_.buckets||!_.entries)throw new Error;X=ne%_.buckets.length}W=H,_.size=H+1}const k=_.entries[W]||(_.entries[W]={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0});U&&(_.freeList=k.next),k.hashCode=ne,k.next=_.buckets[X]-1,k.key=K,k.value=Q,k.skipNextEntry=!1;const V=_.tail;V.nextEntry=k,k.prevEntry=V,_.tail=k,_.buckets[X]=W+1},T.deleteEntry=function g(_,K){if(_.buckets&&_.entries){const Q=_.equaler.hash(K)&I,ne=Q%_.buckets.length;let re,X=-1;for(let U=_.buckets[ne]-1;U>=0;U=re.next){if(re=_.entries[U],re.hashCode===Q&&_.equaler.equals(re.key,K)){X<0?_.buckets[ne]=re.next+1:_.entries[X].next=re.next;const W=re.prevEntry;return W.nextEntry=re.nextEntry,W.nextEntry&&(W.nextEntry.prevEntry=W),_.tail===re&&(_.tail=W),re.hashCode=-1,re.next=_.freeList,re.key=void 0,re.value=void 0,re.prevEntry=void 0,re.nextEntry=W,re.skipNextEntry=!0,_.freeList=U,_.freeSize++,!0}X=U}}return!1},T.clearEntries=function y(_){if(_.size>0){_.buckets&&_.buckets.fill(0),_.entries&&_.entries.fill(void 0);let Q=_.head.nextEntry;for(;Q;){const ne=Q.nextEntry;Q.prevEntry=void 0,Q.nextEntry=_.head,Q.skipNextEntry=!0,Q=ne}_.head.nextEntry=void 0,_.tail=_.head,_.size=0,_.freeList=-1,_.freeSize=0}},T.ensureCapacity=function m(_,K){if(K<0)throw new RangeError;const Q=_.entries?_.entries.length:0;if(Q>=K)return Q;if(!_.buckets)return E(_,K);const ne=p.getPrime(K);return R(_,p.getPrime(K)),ne},T.trimExcessEntries=function O(_,K=_.size-_.freeSize){if(K<_.size)throw new RangeError;if(!_.buckets||!_.entries)return;const Q=p.getPrime(K),ne=_.entries;if(Q>=(ne?ne.length:0))return;const X=_.size;if(E(_,Q),!_.buckets||!_.entries)throw new Error;let re=0;for(let U=0;U<X;U++){const W=ne[U].hashCode;if(W>=0){const k=W%Q;_.entries[re]=ne[U],_.entries[re].next=_.buckets[k]-1,_.buckets[k]=re+1,re++}}_.size=re,_.freeSize=0},T.selectEntryKey=function P(_){return _.key},T.selectEntryValue=function N(_){return _.value},T.selectEntryEntry=function M(_){return[_.key,_.value]},T.iterateEntries=function*B(_,K){let Q=_;for(;Q;){const ne=Q.skipNextEntry;Q=Q.nextEntry,!ne&&Q&&(yield K(Q))}},T.forEachEntry=function Y(_,K,Q,ne){let X=K;for(;X;){const re=X.skipNextEntry;X=X.nextEntry,!re&&X&&Q.call(ne,X.value,X.key,_)}}},502:(D,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.expandPrime=T.getPrime=T.isPrime=void 0;const p=2146435069,C=[3,7,11,17,23,29,37,47,59,71,89,107,131,163,197,239,293,353,431,521,631,761,919,1103,1327,1597,1931,2333,2801,3371,4049,4861,5839,7013,8419,10103,12143,14591,17519,21023,25229,30293,36353,43627,52361,62851,75431,90523,108631,130363,156437,187751,225307,270371,324449,389357,467237,560689,672827,807403,968897,1162687,1395263,1674319,2009191,2411033,2893249,3471899,4166287,4999559,5999471,7199369];function w(d){if(1&d){const f=0|Math.sqrt(d);for(let v=3;v<=f;v+=2)if(!(d%v))return!1;return!0}return 2===d}function E(d){if(d<0)throw new RangeError;for(let f=0;f<C.length;f++){const v=C[f];if(v>=d)return v}for(let f=1|d;f<2147483647;f+=2)if(w(f)&&(f-1)%101)return f;return d}T.isPrime=w,T.getPrime=E,T.expandPrime=function R(d){const f=2*d;return f>p&&p>d?p:E(f)}},9440:(D,T,h)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.deprecateProperty=T.deprecate=void 0;const C=function p(){try{return h(Object(function(){var f=new Error("Cannot find module 'util'");throw f.code="MODULE_NOT_FOUND",f}())).deprecate}catch(R){}}()||function I(){const R="object"==typeof process&&"function"==typeof process.emitWarning?function d(f,v="Warning",g=d){process.emitWarning(f,v,g)}:"function"==typeof Error.captureStackTrace?function d(f,v="Warning",g=d){"string"==typeof f&&((f=new Error(f)).name=v),Error.captureStackTrace(f,g),console.warn(f)}:function(f,v="Warning"){"string"==typeof f?console.warn(`${v}:`,f):console.warn(f)};return(d,f)=>{let v=!1;function g(...y){return v||(v=!0,R(f,"DeprecationWarning",d)),new.target?Reflect.construct(d,y,new.target):d.apply(this,y)}return Object.setPrototypeOf(g,d),d.prototype&&(g.prototype=d.prototype),g}}();function w(R,d){return C(R,d)}T.deprecate=w,T.deprecateProperty=function E(R,d,f){let v=Object.getOwnPropertyDescriptor(R,d);if(v&&v.configurable){let g=!1;v.get&&(v.get=w(v.get,f),g=!0),v.set&&(v.set=w(v.set,f),g=!0),"function"==typeof v.value&&(v.value=w(v.value,f),g=!0),g&&Object.defineProperty(R,d,v)}return R}},1344:(D,T)=>{"use strict";function h(P){return"function"==typeof P}function p(P){return"function"==typeof P||void 0===P}function I(P){return"object"==typeof P&&null!==P||"function"==typeof P}function w(P){return null==P}Object.defineProperty(T,"__esModule",{value:!0}),T.isPrimitive=T.isPropertyKey=T.isString=T.isBoolean=T.isNumber=T.isIterator=T.isAsyncIterable=T.isIterable=T.isDefined=T.isMissing=T.isInstance=T.isObject=T.isFunctionOrUndefined=T.isFunction=void 0,T.isFunction=h,T.isFunctionOrUndefined=p,T.isObject=I,T.isInstance=function C(P,N){return!w(P)&&P instanceof N},T.isMissing=w,T.isDefined=function E(P){return null!=P},T.isIterable=function R(P){return null!=P&&Symbol.iterator in Object(P)},T.isAsyncIterable=function d(P){return null!=P&&Symbol.asyncIterator in Object(P)},T.isIterator=function f(P){return I(P)&&h(P.next)&&p(P.throw)&&p(P.return)&&p(P[Symbol.iterator])},T.isNumber=function v(P){return"number"==typeof P},T.isBoolean=function g(P){return"boolean"==typeof P},T.isString=function y(P){return"string"==typeof P},T.isPropertyKey=function m(P){return"string"==typeof P||"symbol"==typeof P||"number"==typeof P},T.isPrimitive=function O(P){return"function"!=typeof P&&("object"!=typeof P||null===P)}}},D=>{D(D.s=9602)}]);